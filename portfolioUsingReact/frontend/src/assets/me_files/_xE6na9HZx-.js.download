;/*FB_PKG_DELIM*/

__d("BasePopoverDownEdgeArrow.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({height:12,viewBox:"0 0 21 12",width:21},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{d:"M20.685.12c-2.229.424-4.278 1.914-6.181 3.403L5.4 10.94c-2.026 2.291-5.434.62-5.4-2.648V.12h20.684z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("BasePopoverDownInsetArrow.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({height:12,viewBox:"0 0 25 12",width:25},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{d:"M24.553.103c-2.791.32-5.922 1.53-7.78 3.455l-9.62 7.023c-2.45 2.54-5.78 1.645-5.78-2.487V2.085C1.373 1.191.846.422.1.102h24.453z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("BasePopoverRightEdgeArrow.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({height:21,viewBox:"0 0 12 21",width:12},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{d:"M20.685.12c-2.229.424-4.278 1.914-6.181 3.403L5.4 10.94c-2.026 2.291-5.434.62-5.4-2.648V.12Z",transform:"rotate(-90 10.498 10.488)"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("BasePopoverRightInsetArrow.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({height:25,viewBox:"0 0 12 25",width:12},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{d:"M24.553.103c-2.791.32-5.922 1.53-7.78 3.455l-9.62 7.023c-2.45 2.54-5.78 1.645-5.78-2.487V2.085C1.373 1.19.846.422.1.102z",transform:"rotate(-90 12.5 12.48)"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;g["default"]=a}),98);
__d("BasePopoverSVGArrowContainer.react",["BaseContextualLayerContextSizeContext","BaseContextualLayerLayerAdjustmentContext","BaseContextualLayerOrientationContext","BasePopoverDownEdgeArrow.svg.react","BasePopoverDownInsetArrow.svg.react","BasePopoverRightEdgeArrow.svg.react","BasePopoverRightInsetArrow.svg.react","Locale","react","stylex","testID"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");b=d("react");var i=b.useContext,j=b.useMemo,k=3,l=c("Locale").isRTL(),m=25,n={arrow:{position:"x10l6tqk",$$css:!0},container:{position:"x1n2onr6",$$css:!0}},o={above:{filter:"x1fayt1i",marginBottom:"x1fqp7bg",$$css:!0},below:{filter:"x1fayt1i",marginTop:"xcxhlts",$$css:!0},end:{filter:"x1fayt1i",marginStart:"x13ibhcj",$$css:!0},start:{filter:"x1fayt1i",marginEnd:"x1jqylkn",$$css:!0}},p={above:{top:"x11k2h6o",$$css:!0},below:{bottom:"xng853d",$$css:!0},end:{end:"x1gozi89",$$css:!0},start:{start:"x1ke83zm",$$css:!0}},q={end:{end:"xds687c",$$css:!0},middle:{start:"xu8u0ou",$$css:!0},start:{start:"x17qophe",$$css:!0},stretch:{$$css:!0}},r={end:{bottom:"x1ey2m1c",$$css:!0},middle:{top:"x18g6o9x",$$css:!0},start:{top:"x13vifvy",$$css:!0},stretch:{$$css:!0}};function s(a,b,c){c=c-k;if(!a)return b==="end"||b==="middle"?c*-1:c;return l&&b==="start"||!l&&b==="end"?c*-1:c}function t(a,b,c,d){if(c==="edge"||d==null)return{};c=a==="below"||a==="above";a=c?d.width:d.height;d=a>0?a/2:0;if(d===0)return{};a=s(c,b,b==="middle"?m/2:d);return{transform:c?"translateX("+a+"px)":"translateY("+a+"px)"}}function u(a,b){return a==="above"||a==="below"?b==="middle"?c("BasePopoverDownInsetArrow.svg.react"):c("BasePopoverDownEdgeArrow.svg.react"):b==="middle"?c("BasePopoverRightInsetArrow.svg.react"):c("BasePopoverRightEdgeArrow.svg.react")}function a(a,b){var d,e=a.arrowAlignment,f=a.children,g=a.testid,k=a.withArrow,m=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["arrowAlignment","children","testid","withArrow","xstyle"]);var s=i(c("BaseContextualLayerOrientationContext")),v=s.align,w=s.position,x=i(c("BaseContextualLayerContextSizeContext"));s=u(w,v);var y=(d=i(c("BaseContextualLayerLayerAdjustmentContext")))!=null?d:0;d=j(function(){var a=l?"start":"end",b=l?"end":"start",c=v==="end"&&!l||v==="start"&&l,d=1,f=1,g=0,h=0;switch(w){case"above":g+=-y;c&&(d=-1);break;case"below":g+=-y;f=-1;c&&(d=-1);break;case b:h+=-y;v==="start"&&(f=-1);break;case a:h+=-y;d=-1;v==="start"&&(f=-1);break}return{arrowStyle:{transform:"scale("+d+", "+f+") translate("+g+"px, "+h+"px)"},containerStyle:t(w,v,e,x)}},[v,e,x,y,w]);var z=d.arrowStyle;d=d.containerStyle;return h.jsxs("div",babelHelpers["extends"]({},a,{className:c("stylex")(n.container,m,k&&o[w]),ref:b,style:k?d:void 0},c("testID")(g),{children:[f,k?h.jsx(s,{className:c("stylex")(n.arrow,p[w],(w==="start"||w==="end")&&r[v],(w==="above"||w==="below")&&q[v]),fill:"var(--card-background)",style:z}):null]}))}a.displayName=a.name+" [from "+f.id+"]";e=h.forwardRef(a);g["default"]=e}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.add(b)}f.addDeviceChangeAlertsTxn=a}),66);
__d("MAWDbAppDataTxns",["MAWAckLevel","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on sent appData"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on non existing appData"]);i=function(){return a};return a}function a(a,b,c){return a.appData.get({externalId:b}).then(function(b){if(!b){d("WALogger").LOG(i());return null}if(b.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());return b}var e=babelHelpers["extends"]({},b,{ack:c});return a.appData.put(e).then(function(){return e})})}function b(a,b){return a.appData.bulkGet(b)}g.updateAppDataSystemAck=a;g.bulkGetAppData=b}),98);
__d("MAWDbCollectionVersionsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.collectionVersions.where("collection").equals(b).first()}function b(a){return a.collectionVersions.toArray()}function c(a,b){return a.collectionVersions.add(b)}f.getCollectionVersionByCollection=a;f.getAllCollectionVersions=b;f.addCollectionVersion=c}),66);
__d("MAWDbContactsTxns",["LSDataTraceCheckPoint.re","MAWDexieTable","MAWTraceUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.contacts.where("contactJid").anyOf(b).toArray()}function b(a,b){return a.contacts.get({contactJid:b})}function h(a,b){b?d("MAWTraceUtils").recordCheckpointForTrace(a,c("LSDataTraceCheckPoint.re").labyrinthWebUploadContactNameNull,[],!1):d("MAWTraceUtils").recordCheckpointForTrace(a,c("LSDataTraceCheckPoint.re").labyrinthWebUploadContactNameNotNull,[],!1)}function e(a,b,c){if(b==null){c!=null&&h(c,!0);return d("MAWDexieTable").dexieResolve()}return a.contacts.get({contactJid:b}).then(function(a){if(a==null){c!=null&&h(c,!0);return null}c!=null&&h(c,!1);return a.nameForSearch})}g.getContacts=a;g.getContact=b;g.maybeGetContactName=e}),98);
__d("MAWDbGetDeviceChangeAlertsByOptionsTxn",["MAWDbMetaTxns","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WATimeUtils").pastUnixTime(30*d("WATimeUtils").DAY_SECONDS);function a(a,b){var c=b.after,e=b.isArchived,f=e===void 0?!1:e;e=b.limit;var g=e===void 0?20:e,i=a.deviceChangeAlerts;return d("MAWDbMetaTxns").getAllMeta(a).then(function(a){var b=a[3].value.deviceId;return(c==null?i:i.where("deviceChangeAlertsId").above(c)).filter(function(a){return a.isArchived===f&&a.ts>=h}).reverse().limit(g).toArray().then(function(a){return a.map(function(a){var c=d("WAJids").extractDeviceId(a.deviceJid);return babelHelpers["extends"]({},a,{isCurrentDevice:b===c})})})})}g.getDeviceChangeAlertsByOptionsTxn=a}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn",["MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.deviceChangeAlerts.filter(function(a){return a.isArchived===!1}).toArray().then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UnArchivedSelfDeviceChangeAlerts",value:a.length})})}g.getUnArchivedDeviceChangeAlertsCountTxn=a}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypes","MAWIndexedDb","WADualSendMsgUtils","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return i(a,c.jid).then(function(e){var f=c.participantVersion;e.success&&e.value.participantVersion!=null&&c.participantVersion==null&&(f=e.value.participantVersion);e=c.subject.content;e!=null&&e.length===0&&(e=void 0);var g={correspondingOpenThreadKey:d,creationTs:c.creationTs,creator:c.creator,groupJid:c.jid,inviter:c.inviter,name:e,nameOwner:c.subject.user,nameTs:c.subject.ts,participantVersion:f,threadId:b};return j(a,g).then(function(){return g})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return h(a,b).then(function(c){return c.success?c:h(a,d("WAJids").unsafeCoerceToGroupJid(d("WADualSendMsgUtils").prependDualSendPrefix(b)))})}function b(a,b){return k(a,b).then(function(e){var f=new Map(),g=new Map();e.forEach(function(a,c){if(a==null){c=b[c];var e=d("WAJids").unsafeCoerceToGroupJid(d("WADualSendMsgUtils").prependDualSendPrefix(c));g.set(e,c)}else f.set(a.groupJid,d("WAResultOrError").makeResult(a))});var h=Array.from(g.keys());return k(a,h).then(function(a){a.forEach(function(a,b){b=g.get(h[b]);if(b==null)throw c("err")("originalGroupJid is null - should never happen for flow");a==null?f.set(b,d("WAResultOrError").makeError("missing")):f.set(b,d("WAResultOrError").makeResult(a))});return f})})}function j(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedGroupInfo(b)})})}function e(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedGroupInfo(a)})})})}function k(a,b){return a.groupInfo.bulkGet(b)}function f(a,b){return a.groupInfo.get({threadId:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=i;g.bulkGetGroupInfo=b;g.updateGroupInfo=j;g.bulkUpdateGroupInfo=e;g.getGroupInfos=k;g.getGroupInfoByThreadId=f;g.deleteGroupInfo=l}),98);
__d("MAWDbGroupInviteTxns",["MAWDbParticipant","MAWDexieTable","MAWGlobals","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites["delete"]([c,b])}function c(a,b){return a.groupInvites.where(["invitedParticipantId","inviterJid"]).between([b,d("MAWDexieTable").DEXIE_MIN_KEY],[b,d("MAWDexieTable").DEXIE_MAX_KEY])["delete"]()}function h(a,b,c){return a.groupInvites.get([c,b])}function e(a,b){return a.groupInvites.where(["invitedParticipantId","inviterJid"]).between([b,d("MAWDexieTable").DEXIE_MIN_KEY],[b,d("MAWDexieTable").DEXIE_MAX_KEY]).toArray()}function f(a,b){if(b.type===d("WAMsgType").MSG_TYPE.GROUP_INVITE){var c=b.author;b=d("MAWDbParticipant").craftParticipantId(b.thread,b.invitedParticipantUserJid);c=c===d("WAJids").AUTHOR_ME?d("MAWGlobals").getMyUserJid():d("WAJids").authorAsUserJid(c);return!c?d("MAWDexieTable").dexieResolve():h(a,c,b)}else return d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvite=b;g.deleteGroupInvitesByInvitedParticipantId=c;g.maybeGetGroupInvite=h;g.getGroupInvitesByInvitedParticipantId=e;g.getAndCheckGroupInviteFromMsg=f}),98);
__d("MAWDbMissingKeysTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.missingKeys.toArray()}function b(a,b){return a.missingKeys.put(b)}f.getAllMissingKeys=a;f.putMissingKey=b}),66);
__d("MAWBridgeParticipants",["WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=a.deliveredWatermarkTs,e=a.lastReadActionTs,f=a.lastReadWatermarkTs,g=a.threadId,h=a.type;a=a.userJid;return{deliveredWatermarkTs:c||d("WATimeUtils").castToUnixTime(0),fbid:d("WAJids").extractUserId(a),isAdmin:h==="superadmin"||h==="admin",isDualSend:b,isInvited:h==="invitedParticipant",isSuperAdmin:h==="superadmin",lastReadActionTs:(c=e)!=null?c:d("WATimeUtils").castToUnixTime(0),readWatermarkTs:f||d("WATimeUtils").castToUnixTime(0),threadId:g}}function a(a){return{participants:a.map(function(a){var b=a.isDualSend;a=babelHelpers.objectWithoutPropertiesLoose(a,["isDualSend"]);return h(a,b)})}}g.createBridgeParticipant=h;g.createBridgeParticipants=a}),98);
__d("MAWDbParticipantTxns",["MAWBridgeParticipants","MAWBridgeTypes","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","WAJids","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e){d===void 0&&(d="participant");return h(a,b,[{addressable:e,type:d,userJid:c}]).then(function(a){return a[0]})}function h(a,b,c,d){return i(a,c.map(function(a){return babelHelpers["extends"]({},a,{threadId:b})}),d)}function i(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var e=[];b.forEach(function(a){var b=a.addressable,c=a.threadId,f=a.type;a=a.userJid;e.push({addressable:b,deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),id:d("MAWDbParticipant").craftParticipantId(c,a),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0),threadId:c,type:f,userJid:a})});return a.participants.bulkPut(e).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(e.map(function(a){return babelHelpers["extends"]({},a,{isDualSend:!!c})}))});return e})}function b(a,b,c){return a.participants.bulkPut(b).then(function(){b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(b.map(function(a){return babelHelpers["extends"]({},a,{isDualSend:!!c})}))});return b})}function j(a,b,c){if(c.length===0)return d("MAWDexieTable").dexieResolve();c=c.map(function(a){return d("MAWDbParticipant").craftParticipantId(b,a)});return k(a,c)}function e(a,b,c){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.map(function(a){return d("MAWDbParticipant").craftParticipantId(a,c)});return k(a,b)}function k(a,b){return a.participants.bulkDelete(b).then(function(){b.forEach(function(a){a=d("MAWDbParticipant").getThreadIdAndUserJidFromParticipantId(a);var b=a.threadId;a=a.userJid;d("MAWIndexedDb").afterTransaction({tag:"ParticipantRemoved",value:d("MAWBridgeTypes").createBridgeRemovedParticipant(b,a)})})})}function f(a,b){return a.participants.where("threadId").equals(b)["delete"]()}function l(a,b,c,d,e,f){return m(a,[{deliveredWatermarkTs:c,isDualSend:f,lastReadActionTs:e,lastReadWatermarkTs:d,participantId:b}]).then(function(a){return a[0]})}function m(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);var c=new Map(),e=[];b.forEach(function(a){e.push(a.participantId),c.set(a.participantId,a)});return u(a,e).then(function(b){b=b.filter(Boolean);var e=[],f=[];b.forEach(function(a){var b=c.get(a.id);if(b==null)return;var d=b.deliveredWatermarkTs,g=b.isDualSend,h=b.lastReadActionTs;b=b.lastReadWatermarkTs;var i=a.deliveredWatermarkTs,j=a.lastReadWatermarkTs,k=a.lastReadActionTs,l=d>i,m=b>j,n=k==null||h>k;if(!l&&!m&&!n){f.push(a);return}e.push(babelHelpers["extends"]({},a,{deliveredWatermarkTs:l?d:i,isDualSend:g,lastReadActionTs:n?h:k,lastReadWatermarkTs:m?b:j}))});return a.participants.bulkPut(e.map(function(a){a.isDualSend;a=babelHelpers.objectWithoutPropertiesLoose(a,["isDualSend"]);return a})).then(function(){e.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ReceivedReceipt",value:d("MAWBridgeTypes").createBridgeReceivedReceipt(a.threadId,d("WAJids").extractUserId(a.userJid),a.deliveredWatermarkTs,a.lastReadWatermarkTs,a.lastReadActionTs,a.isDualSend)})});return[].concat(e,f)})})}function n(a,b){return a.participants.where("threadId").equals(b).toArray()}function o(a,b){return a.participants.where("threadId").anyOf(b).toArray()}function p(a,b){return n(a,b).then(function(a){return a.filter(function(a){return a.type==="invitedParticipant"})})}function q(a,b,c){return a.participants.get(d("MAWDbParticipant").craftParticipantId(b,c)).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function r(a,b,c){return n(a,b).then(function(e){var f=e.map(function(a){return a.userJid});e=e.map(function(a){return{addressable:a.addressable,type:a.type,userJid:a.userJid}});return d("MAWDexieTable").dexieAll([j(a,b,f),h(a,c,e)]).then(function(){})})}function s(a,b){var e=Array.from(b.keys());return o(a,e).then(function(e){var f=e.map(function(a){return d("MAWDbParticipant").craftParticipantId(a.threadId,a.userJid)});e=e.map(function(a){var d=b.get(a.threadId);if(d==null)throw c("err")("New Thread Id is null - should not happen flow");return{addressable:a.addressable,threadId:d,type:a.type,userJid:a.userJid}});return d("MAWDexieTable").dexieAll([k(a,f),i(a,e)]).then(function(){})})}function t(a,b,c,e){c=c.map(function(a){return d("MAWDbParticipant").craftParticipantId(b,a)});return c.length===0?d("MAWDexieTable").dexieResolve([]):u(a,c).then(function(b){var c=[];b.forEach(function(a){a!=null&&a.type!==e&&c.push(babelHelpers["extends"]({},a,{type:e}))});return c.length===0?[]:a.participants.bulkPut(c).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(c.map(function(a){return babelHelpers["extends"]({},a,{isDualSend:!1})}))});return c})})}function u(a,b){return a.participants.bulkGet(b)}g.addParticipant=a;g.bulkAddParticipants=h;g.bulkAddParticipantsInThreads=i;g.bulkUpdateParticipants=b;g.bulkDeleteParticipantsInThread=j;g.bulkDeleteParticipantAcrossThreads=e;g.bulkDeleteParticipants=k;g.deleteAllParticipantsForThread=f;g.updateParticipantTimestamps=l;g.bulkUpdateParticipantTimestamps=m;g.getParticipantsInThread=n;g.getParticipantsInThreads=o;g.getInvitedParticipantsInThread=p;g.getParticipant=q;g.migrateParticipantsToNewThread=r;g.bulkMigrateParticipantsToNewThreads=s;g.setParticipantTypesForUsers=t;g.bulkGetParticipants=u}),98);
__d("MAWDbPendingMutationsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.pendingMutations.where("collection").equals(b).toArray()}function b(a){return a.pendingMutations.toArray()}function c(a,b){return a.pendingMutations.add(b)}f.getPendingMutationsByCollection=a;f.getAllPendingMutations=b;f.addPendingMutation=c}),66);
__d("MAWDbPendingReceipt",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){return a+"_"+b+"_"+c}f.craftPendingReceiptId=a}),66);
__d("MAWDbPendingReceiptTxns",["MAWDbPendingReceipt","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){var b=a.author,c=a.externalId;a=a.thread;return d("MAWDbPendingReceipt").craftPendingReceiptId(a,c,b)});return a.pendingReceipts.where("id").anyOf(c).toArray().then(function(c){var e=new Map();c.forEach(function(a){e.set(a.id,a)});var f=b.map(function(a){var b=a.author,c=a.externalId,f=a.thread,g=d("MAWDbPendingReceipt").craftPendingReceiptId(f,c,b),h=e.get(g),i=(h=h)!=null?h:{author:b,deliveryReceipts:[],externalId:c,id:g,readReceipts:[],thread:f};b===d("WAJids").AUTHOR_ME?(a.deliveryReceipts.forEach(function(a){i.deliveryReceipts.push(a)}),a.readReceipts.forEach(function(a){i.readReceipts.push(a)})):(i.deliveryReceipts=[],a.readReceipts.forEach(function(a){i.readReceipts.push(a)}));return i});return a.pendingReceipts.bulkPut(f).then(function(){return f})})}function b(a,b){return a.pendingReceipts.bulkGet(b)}g.bulkAddPendingReceipts=a;g.getPendingReceipts=b}),98);
__d("MAWDbPersonalSenderKeyStatusTxns",["WADualSendMsgUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h={hasSenderKey:new Set(),rotateSenderKey:!0,senderKeyId:null,senderKeyTs:d("WATimeUtils").castToUnixTime(0)};function a(a,b){b=d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b;var c=babelHelpers["extends"]({},h,{groupJid:b});return a.personalSenderKeyStatuses.put(c).then(function(){return c})}function b(a,b,c){return k(a,b).then(function(b){var d=[];b.forEach(function(a){if(a==null||a.rotateSenderKey)return;c.forEach(function(b){return a.hasSenderKey["delete"](b)});d.push(a)});return a.personalSenderKeyStatuses.bulkPut(d).then(function(){return b})})}function c(a,b){b=b.map(function(a){return d("WADualSendMsgUtils").isDualSendJid(a)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a):a});return a.personalSenderKeyStatuses.bulkDelete(b)}function e(a,b){return i(a,[b]).then(function(a){return a[0]})}function i(a,b){return k(a,b).then(function(b){var c=[];b.forEach(function(a){if(a==null)return;a.rotateSenderKey=!0;c.push(a)});return a.personalSenderKeyStatuses.bulkPut(c).then(function(){return b})})}function f(a,b){return a.personalSenderKeyStatuses.bulkPut(b).then(function(){})}function j(a,b,c,d){return a.personalSenderKeyStatuses.get(b).then(function(e){var f=babelHelpers["extends"]({},e||h,{groupJid:b,rotateSenderKey:!1,senderKeyId:c,senderKeyTs:d});return a.personalSenderKeyStatuses.put(f).then(function(){return f})})}function k(a,b){return a.personalSenderKeyStatuses.bulkGet(b)}g.putNewPersonalSenderKeyStatus=a;g.removeDevicesToMultiplePersonalSenderKeyStatuses=b;g.bulkDeletePersonalSenderKeyStatus=c;g.setRotateSenderKeyToTrue=e;g.bulkSetRotateSenderKeyToTrue=i;g.bulkUpdateSenderKeyStatus=f;g.updateSenderKeyStatusAsRotated=j;g.bulkGetPersonalSenderKeyStatuses=k}),98);
__d("MAWDbPrekeyTxns",["MAWBridge","MAWSignalUtils","WAOdsEnums","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.prekeyGeneration.get(b).then(function(b){if(b==null)throw c("err")("Expected a prekey generation row");b=d("MAWSignalUtils").getPrekeyIdsInRange(b.startingId,b.endingId);return h(a,b).then(function(a){return a.filter(Boolean).map(function(a){return a.encoded})})})}function b(a,b){var c=0,e=0;return a.prekey.bulkGet(b).then(function(a){return a.map(function(a){if(a!=null){a.isDeleted===!0&&c++;a.isDeleted=!0;return a}else{e++;return}}).filter(Boolean)}).then(function(b){return a.prekey.bulkPut(b)}).then(function(){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{amount:c,entity:d("WAOdsEnums").Entity.GET_PREKEY,key:"mark_as_deleted_before_deleting"}),d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{amount:e,entity:d("WAOdsEnums").Entity.GET_PREKEY,key:"miss_prekey_before_deleting"})})}function h(a,b){return a.prekey.bulkGet(b).then(function(a){return a.filter(function(a){return(a==null?void 0:a.isDeleted)!==!0})})}function e(a,b){return a.prekeyGeneration.bulkGet(b)}g.getPrekeysForGeneration=a;g.bulkDeletePreKeys=b;g.getPrekeys=h;g.getPrekeyGenerations=e}),98);
__d("MAWAuthor",["MAWGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return a==null||a===d("WAJids").AUTHOR_SYSTEM?null:d("WAJids").isAuthorMe(a)?d("MAWGlobals").getMyUserJid():d("WAJids").authorAsUserJid(a)};g.getAuthorUserJid=a}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWDbMsg","MAWGlobals","MAWLocalizationType","WAJids","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){return{ack:d("MAWAckLevel").ACK.sent,altIndex:(g=g)!=null?g:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWGlobals").getDependencies().generateExternalId(),msgContent:a,msgId:e,thread:b,threadJid:c,ts:(g=f)!=null?g:d("WATimeUtils").unixTime(),type:d("WAMsgType").MSG_TYPE.ADMIN}}function b(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["MAWAdminMsgNormalized","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.msgContent.adminType;a=d("MAWLocalizationUtils").isAdminMsgNormalized(c)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(c,a.msgContent.adminMsgContent):{contactIds:[],contents:a.msgContent.adminMsgContent};var e=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(e),strings:[].concat(a)},snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWGating","MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if((a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3)&&d("MAWGating").isHotLikeEnabled()){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,e.contactIDs.push(b));return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"]);s=function(){return a};return a}function a(a,b){var c=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,e={contactIDs:[],strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(s());switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(q()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(p()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,e.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,e.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,e.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,e.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(j()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,e.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?c=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i()):(c=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,e.contactIDs.push(b));break;default:d("WALogger").ERROR(h())}return{snippetParams:e,snippetSenderContactId:b,snippetType:c}}g["default"]=a}),98);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadSnippetUtils",["MAWEphemeralMsgUtils","MAWGating","MAWLocalizationType","MAWLocalizationUtils","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(!d("MAWGating").isDeviceAdminMessagesSnippetDisabled())return!1;if(a.type===d("WAMsgType").MSG_TYPE.REVOKED)return!0;if(a.type!==d("WAMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a)}function i(a){return a.find(function(a){return!h(a)})}function a(a,b,c){return c==null?a.messages.where("thread").equals(b.chatId).reverse().limit(10).toArray().then(i):a.messages.where("thread").equals(b.chatId).filter(function(a){return d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a)&&!h(a)}).reverse().first()}g.isDbMsgDisabledForThreadSnippet=h;g.findMostRecentSnippet=i;g.findMostRecentSnippetMsgFromThread=a}),98);
__d("MAWThreadSnippetBuildTxns",["MAWBridgeTypes","MAWDbGroupInfoTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWJids","MAWLocalizationType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWThreadSnippetUtils","WADualSendMsgUtils","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b;d("WAJids").isAuthorMe(a)?b=d("MAWJids").userIdFromJid(d("MAWGlobals").getMyUserJid()):d("WAJids").isAuthorSystem(a)||(b=d("MAWJids").userIdFromJid(a));return b}function i(a,b,e){var f=h(b.author);return d("MAWDexieTable").dexieAll([d("MAWDbGroupInfoTxns").getGroupInfoByThreadId(a,e.chatId)]).then(function(a){a=a[0];a=a.success;switch(b.type){case d("WAMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(b,f,a);case d("WAMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(b,f);case d("WAMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(b,f);case d("WAMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(b,f);case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(b,f);case d("WAMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(b,f);case d("WAMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(b,f);case d("WAMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(b,f);case d("WAMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(b,f);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:f,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}})}function a(a,b,c,e){return d("MAWDexieTable").dexieAll([d("MAWDbGroupInfoTxns").getGroupInfoByThreadId(a,e)]).then(function(a){a=a[0];a=a.success;return j(b,c,a)})}function j(a,b,c){a=d("MAWJids").userIdFromJid(a);var e={contactIDs:[],strings:[]};c=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;e.contactIDs.push(a);e.strings.push(b);return{snippetParams:e,snippetSenderContactId:a,snippetType:c}}function k(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(a.jid),snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:"0",snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET,threadId:a.chatId})});return null}function b(a,b){var c=function(c){return function(e){var f=e.snippetParams,g=e.snippetSenderContactId,h=e.snippetType;return a.threads.update(b.chatId,{snippetMsg:c.msgId}).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(b.jid),snippetParams:f,snippetSenderContactId:g,snippetType:h,threadId:b.chatId})});return c})}};return a.messages.where("thread").equals(b.chatId).last().then(function(e){if(e==null)return k(b);else if(d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(e))return d("MAWThreadSnippetUtils").findMostRecentSnippetMsgFromThread(a,b).then(function(d){return d==null?k(b):i(a,d,b).then(c(d))});return i(a,e,b).then(c(e))})}g.getSnippetContactId=h;g.buildThreadSnippet=i;g.buildReactionThreadSnippet=a;g.getReactionSnippetParams=j;g.updateThreadSnippet=b}),98);
__d("MAWDbReactionsTxns",["MAWAuthor","MAWBridgeTypes","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","MAWGK","MAWIndexedDb","MAWThreadSnippetBuildTxns","WADualSendMsgUtils","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);i=function(){return a};return a}var j=function(a){return a};function a(a,b,c){var e=babelHelpers["extends"]({},b,{nextInChatMsgId:b.nextInChatMsgId+1}),f=d("MAWDexieTable").dexieResolve();k(c)&&(f=d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(a,c.author,c.reaction,b.chatId).then(function(a){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(b.jid),snippetParams:c,snippetSenderContactId:e,snippetType:a,threadId:b.chatId})})}));return d("MAWDexieTable").dexieAll([a.threads.put(e),a.reactions.put(j(c)),f]).then(function(a){a=a[1];return a})}function b(a,b){return a.reactions.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function k(a){return a.author!=="@me"&&a.author!=="@system"&&a.reactToAuthor==="@me"&&a.reaction!=null&&c("MAWGK").msgr_reaction_thread_bump_dogfooding}function l(a,b){return a.reactions.where("reactToMsgId").anyOf(b).toArray()}function e(a,b){return l(a,[b])}function f(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function m(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.reactions.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function n(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author,e=b.chatId;b=b.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&d("MAWDbMsg").getThreadIdFromMsgId(a.reactionId)===e}).toArray()})).then(function(b){b=b.reduce(function(a,b){return a.concat(b)},[]);d("WALogger").LOG(i(),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function o(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(h(),a)})}g.coerceToReaction=j;g.putReaction=a;g.getReaction=b;g.isIncomingReaction=k;g.getReactionsFromMessages=l;g.getReactionsFromMessage=e;g.maybeGetReactionByProtocolMsgId=f;g.getReactionMapByProtocolMsgId=m;g.deleteReactionsByUniqueMsgIdentifiers=n;g.deleteAllReactionsForMessages=o}),98);
__d("MAWDbReceiptTxns",["WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly fetched null data from a msgIdToReceiptData map"]);h=function(){return a};return a}function a(a,b,c,d){return i(a,[{deliveryReceipts:c==="delivered"?d:[],msgId:b,readReceipts:c==="read"?d:[],senderReceipts:c==="sender"?d:[]}]).then(function(a){return a[0]||{type:"missing"}})}function i(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){e.set(a.msgId,a)});return a.receipts.where("msgId").anyOf(c).toArray().then(function(b){var c=b.map(function(a){var b=e.get(a.msgId);if(b==null){d("WALogger").ERROR(h());return null}var c=new Set(),f=a.statusTsPerUser,g=a.permittedIdentitiesPerDevice,i=b.deliveryReceipts,m=b.readReceipts;b=b.senderReceipts;[{receiptType:"delivered",receivers:i},{receiptType:"read",receivers:m},{receiptType:"sender",receivers:b}].forEach(function(a){var b=a.receiptType;a=a.receivers;a.forEach(function(a){var e=a.device;a=a.ts;var h=d("WAJids").extractUserJid(e),i=!1;if(b!=="sender"){var l=f.get(h);if(l==null)return;a=j(l,b,a);f.set(h,a);i=k(l,a)}l=g!=null?g["delete"](e):!1;(l||i)&&c.add(h)})});i=babelHelpers["extends"]({},a,{permittedIdentitiesPerDevice:l(g),statusTsPerUser:f});return{affectedUserJids:c,receipt:i,type:c.size>0?"updated":"unchanged"}}).filter(Boolean);return a.receipts.bulkPut(c.map(function(a){return a.receipt})).then(function(){return c})})}function j(a,b,c){var d=(a==null?void 0:a.deliveredTs)||c;a=a==null?void 0:a.readTs;b==="read"&&a==null&&(a=c);return{deliveredTs:d,readTs:a}}function k(a,b){return((b==null?void 0:b.deliveredTs)||0)>((a==null?void 0:a.deliveredTs)||0)||((b==null?void 0:b.readTs)||0)>((a==null?void 0:a.readTs)||0)}function l(a){if(a==null||a.size===0)return;return a}function b(a,b){b=b.map(function(a){return a.msgId});return a.receipts.bulkDelete(b)}function c(a,b){return a.receipts.bulkGet(b)}function e(a,b){return a.receipts.add(b)}function f(a,b){return a.receipts.bulkPut(b)}g.writeReceiptsForDevices=a;g.bulkWriteReceiptsForDevices=i;g.bulkDeleteAllReceiptsForMessages=b;g.getReceipts=c;g.addReceipt=e;g.bulkPutReceipt=f}),98);
__d("WAByteArray",[],(function(a,b,c,d,e,f){function a(a,b){b=b;var c=new Uint8Array(a);for(a=a-1;a>=0;a--)c[a]=b&255,b>>>=8;return c}function b(a){return a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset)}function c(a,b){if(!a||!b)return!1;a=new Uint8Array(a);b=new Uint8Array(b);var c=a.length,d=b.length;if(c!==d)return!1;for(d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}f.intToBytes=a;f.uint8ArrayToBuffer=b;f.compareArrayBuffer=c}),66);
__d("MAWDbSenderKeySessionTxns",["MAWDexieTable","MAWGlobals","WAByteArray","WAResultOrError","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){return a.id});return d("MAWGlobals").getConfig().useCryptoManagerV2()?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):h(a,c).then(function(a){for(var c=0;c<a.length;c++){var e=a[c]?d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(a[c].record)):null,f=b[c].oldHash;if(e==null&&f==null||e!=null&&f!=null&&d("WASignalOther").areSessionHashesEqual(e,f))continue;else return d("WAResultOrError").makeError("mismatch")}return d("WAResultOrError").makeResult()})}function b(a,b){return a.senderKeySessions.bulkPut(b).then(function(){})}function c(a,b){return a.senderKeySessions.where("groupJid").equals(b)["delete"]()}function h(a,b){return a.senderKeySessions.bulkGet(b)}g.bulkCheckSenderKeySessionsMatch=a;g.bulkPutSenderKeySessions=b;g.deleteSenderKeysByGroupJid=c;g.getSenderKeySessionsBySenderKeySessionId=h}),98);
__d("MAWDbSessionTxns",["MAWDexieTable","WAByteArray","WAGlobals","WAResultOrError","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){return a.id});return d("WAGlobals").getConfig().useCryptoManagerV2()?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):h(a,c).then(function(a){for(var c=0;c<a.length;c++){var e=a[c]?d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(a[c].session)):null,f=b[c].oldHash;if(e==null&&f==null||e!=null&&f!=null&&d("WASignalOther").areSessionHashesEqual(e,f))continue;return d("WAResultOrError").makeError("mismatch")}return d("WAResultOrError").makeResult()})}function b(a,b){return a.session.bulkPut(b).then(function(){})}function h(a,b){return a.session.bulkGet(b)}g.bulkCheckSessionsMatch=a;g.bulkSaveSessions=b;g.bulkGetSessions=h}),98);
__d("MAWDbSignedPrekeyTxns",["MAWDbMetaTxns","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWDbMetaTxns").maybeGetLastSignedPrekeyId(a).then(function(b){if(b==null)throw c("err")("Last signed prekey id and signed prekey store should both have values or both be null");return a.signedPrekey.get({keyId:b}).then(function(a){if(a==null)throw c("err")("No signed prekey matches the lastSignedPrekeyId supplied");return a.encoded})})}function b(a,b){return a.signedPrekey.bulkGet(b)}g.getLatestSignedPreKey=a;g.getSignedPrekeys=b}),98);
__d("MAWDbSyncActionsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.syncActions.put(b)}function b(a,b){return a.syncActions.get(b)}function c(a,b){return a.syncActions.where("collection").anyOf(b).toArray()}function d(a,b){return a.syncActions.where("actionState").anyOf(b).toArray()}f.putSyncAction=a;f.getSyncActionBySyncActionIndex=b;f.getSyncActionsByCollections=c;f.getSyncActionsByActionStates=d}),66);
__d("MAWDbSyncKeysTxns",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.syncKeys.toArray()}function b(a,b){return a.syncKeys.where("keyId").equals(d("WASyncdKeyTypes").fromSyncKeyId(b)).first()}function c(a,b){return a.syncKeys.add(b)}g.getAllSyncKeys=a;g.getSyncKeyBySyncKeyId=b;g.addSyncKey=c}),98);
__d("MAWDbGetAlertsWithDeviceJidTxn",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.deviceChangeAlerts.filter(function(a){return a.deviceJid===b&&!a.loggedOut}).toArray().then(function(a){a.length>1&&c("err")("Invalid result, more than one active devices with the same deviceJid: "+b);return a[0]})}g.getAlertsWithDeviceJidTxn=a}),98);
__d("MAWDbUpdateDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.put(b)}f.updateDeviceChangeAlertsTxn=a}),66);
__d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["MAWDbGetAlertsWithDeviceJidTxn","MAWDbUpdateDeviceChangeAlertsTxn"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b).then(function(b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))})}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("MAWDebugHydrateOfflineQueue",["MAWExternalId","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,c){var e=c.maxMessages,f=c.minMessages;return d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY})(function(c){return c.participants.toArray().then(function(b){return b.filter(function(b){return b.userJid===a.contactJid})}).then(function(a){a=a.map(function(a){return a.threadId});return c.threads.bulkGet(a).then(function(a){return Array.from(new Set(a.filter(function(a){return(a==null?void 0:a.archived)!==!0}).map(function(a){return a==null?void 0:a.jid}).filter(Boolean)))})}).then(function(a){setTimeout(function(){var c,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:c=a,g=Array.isArray(c),h=0,c=g?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 1:if(!g){m.next=7;break}if(!(h>=c.length)){m.next=4;break}return m.abrupt("break",22);case 4:i=c[h++];m.next=11;break;case 7:h=c.next();if(!h.done){m.next=10;break}return m.abrupt("break",22);case 10:i=h.value;case 11:j=i,k=Math.floor(Math.random()*e)+f,l=0;case 14:if(!(l<k)){m.next=20;break}m.next=17;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(j,{content:"Message "+l},d("MAWExternalId").generateExternalId())));case 17:l++;m.next=14;break;case 20:m.next=1;break;case 22:case"end":return m.stop()}},null,this)},0)})})()},i=function(a){return d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY})(function(b){var d=/^[0-9]+@/.test(a);d=d?b.contacts.filter(function(b){return b.contactJid===a}).toArray():b.contacts.toArray().then(function(b){return b.filter(function(b){return b.nameForSearch===a})});return d.then(function(a){if(a.length===0)throw c("err")("No participant found");a=a[0];return a})})()};function a(a,b){b=b||{};var c=b.maxMessages,d=c===void 0?30:c;c=b.minMessages;var e=c===void 0?1:c;return i(a).then(function(a){return h(a,{maxMessages:d,minMessages:e})})}g.debugHydrateOfflineQueue=a}),98);
__d("MAWEncryptedBackupCacheManager",[],(function(a,b,c,d,e,f){"use strict";var g=new Map(),h=new Map();function a(a,b){h.set(a,{cache:b,status:"restoring"})}function b(a){a.forEach(function(a){var b=h.get(a);b!=null&&h.set(a,{cache:b.cache,status:"done"})})}function c(a){a=h.get(a);if(a!=null)return a.status;else return"none"}function d(a){return(a=h.get(a))==null?void 0:a.cache}function e(a){return h["delete"](a)}function i(a,b){var c=g.get(a)||new Set();c.add(b);g.set(a,c)}function j(a,b){a=g.get(a);return a!=null?a==null?void 0:a.has(b):!1}function k(a,b){a=g.get(a);a!=null&&a["delete"](b)}function l(a){return h.has(a)}f.restoredCache=h;f.addMsgEntryToRestoredCache=a;f.setRestoredCacheStatusAsDone=b;f.getRestoredCacheStatus=c;f.getRestoredCache=d;f.removeFromRestoredCache=e;f.addMsgEntryToReuploadCache=i;f.checkForMsgEntryInReuploadCache=j;f.removeMsgEntryFromReuploadCache=k;f.peekRestoreCache=l}),66);
__d("MAWMsgCleaner",["Promise","WAAssertUnreachable","WALogger","WAShiftTimer","WATimeUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow "," msgs' content cleaned"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::_purgeNow"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["","::update ",""]);j=function(){return a};return a}a="Unsend";e="Ephemeral";f="DeleteForMe";var k="PendingStanza",l="Xma",m={UNSEND:a,EPHEMERAL:e,DELETE_FOR_ME:f,PENDING_STANZA:k,XMA:l},n=function(){function a(a,b){var c=this;this.$1=new(d("WAShiftTimer").ShiftTimer)(function(){c.$2()});this.getNextTs=a.getNextTs;this.removeExpired=a.removeExpired;this.cleanerType=b;this.purgeEnabled=a.purgeEnabled;this.$1.forceRunNow()}var c=a.prototype;c.update=function(a){var b=o(this.cleanerType);d("WALogger").LOG(j(),b,a);this.$1.onOrBefore(d("WATimeUtils").cappedMillisecondsUntil(a))};c.$2=function(){var a=this;if(!this.purgeEnabled())return b("Promise").resolve();var c=o(this.cleanerType);d("WALogger").LOG(i(),c);return this.removeExpired().then(function(b){b>0&&d("WALogger").LOG(h(),c,b);return a.getNextTs()}).then(function(b){b!=null&&a.update(b)})};return a}();function o(a){switch(a){case"Unsend":return"UnsendMsgCleaner";case"Ephemeral":return"EphemeralCleaner";case"DeleteForMe":return"DeleteForMeCleaner";case"PendingStanza":return"PendingStanzaCleaner";case"Xma":return"XmaCleaner";default:return c("WAAssertUnreachable")(a)}}var p=n;g.UNSEND=a;g.EPHEMERAL=e;g.DELETE_FOR_ME=f;g.PENDING_STANZA=k;g.XMA=l;g.CLEANER_TYPE=m;g.MsgCleaner=n;g.MSG_CLEANER_FOR_TESTING_ONLY=p}),98);
__d("MAWEphemeralCleaner",["MAWGating","MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCleaner: Adding timestamps for UI(",") and backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startEphemeralCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a,b){d("MAWGating").isEphemeralMessagesEnabled()&&(d("WALogger").LOG(j()),k==null&&(k={backend:new(d("MAWMsgCleaner").MsgCleaner)(b,d("MAWMsgCleaner").CLEANER_TYPE.EPHEMERAL),ui:new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.EPHEMERAL)}))}function b(a,b){if(d("MAWGating").isEphemeralMessagesEnabled())if(k==null){var e="Trying to add new ephemeral timestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),e);throw c("err")(e)}else{e=k;var f=e.backend;e=e.ui;d("WALogger").DEV(h(),a,b);e.update(a);f.update(b)}}function e(){return k}function f(){k=null}g.startEphemeralCleaner=a;g.addNewEphemeralTimestamp=b;g.getEphemeralCleaner_FOR_TESTING_ONLY=e;g.resetEphemeralCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWAdminMsgBuildTxns",["MAWDbMsg","MAWDbThreadTxns","MAWLocalizationType","MAWLocalizationUtils","MAWWriteMsgTxns","WALogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeReachabilityErrorAdminMsg failed to create or get 1:1 thread"]);h=function(){return a};return a}function a(a,b){return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return}b=b.value;var c=d("MAWDbMsg").craftMsgId(b.chatId,b.nextInChatMsgId);c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR,version:0},b.chatId,b.jid,c,d("WATimeUtils").castMillisTimeToUnixTime(b.lastReadMsgTs));return d("MAWWriteMsgTxns").writeMsg(a,c,b).then(function(){})})}function b(a,b){return d("MAWDbThreadTxns").getThread(a,b).then(function(e){if(!e.success)throw c("err")("missing thread when write e2ee thread description");e=e.value;var f=i(e);return d("MAWWriteMsgTxns").writeMsg(a,f,e,{sortOrderMs:0}).then(function(){return d("MAWDbThreadTxns").getThread(a,b).then(function(a){if(!a.success)throw c("err")("missing thread when write e2ee thread description");return a.value})})})}function i(a){var b=d("MAWDbMsg").craftMsgId(a.chatId,a.nextInChatMsgId),c=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(a.chatId);return d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION,version:0},a.chatId,a.jid,b,d("WATimeUtils").castToUnixTime(0),c)}g.writeReachabilityErrorAdminMsg=a;g.writeE2EEThreadDescriptionMsg=b;g.buildE2EEThreadDescriptionMsg=i}),98);
__d("MAWBridgeThread",["MAWTimeUtils.bs","WADualSendMsgUtils","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return!0},user:function(a){return!1}});return{authoritativeThreadKey:c,cannotReplyReason:a.cannotReplyReason,chatId:a.chatId,clientThreadKey:b,folder:a.folder,isDualSend:d("WADualSendMsgUtils").isDualSendJid(a.jid),isGroup:e,jid:a.jid,lastActivityTs:d("MAWTimeUtils.bs").getMillisTime(a.newestMsgTs)||d("WATimeUtils").castToMillisTime(0),lastReadTs:d("MAWTimeUtils.bs").getMillisTime(a.lastReadMsgTs)||d("WATimeUtils").castToMillisTime(0),muteCallsExpireTimeMs:(c=a.muteCallsExpireTimeMs)!=null?c:0,muteExpireTimeMs:(b=a.muteExpireTimeMs)!=null?b:0}}function b(a,b,c){return{lastActivityTimestampMs:c,lastReadWatermarkTs:b,threadId:a}}g.createBridgeThread=a;g.createBridgeThreadTimestampsUpdated=b}),98);
__d("MAWGetOrCreateThreadTxns",["MAWAdminMsgBuildTxns","MAWBridgeThread","MAWBridgeTypes","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWGating","MAWIndexedDb","WADualSendMsgUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.authoritativeThreadKey,e=b.clientThreadKey,f=b.createTs,g=b.deduplicationKey,h=b.folder,i=b.jid,j=b.lastActivityTimestamp,k=b.lastReadWatermarkTimestamp,l=function(){return a.threads.get({jid:i}).then(function(b){if(b==null){var c,l;c=(c=(c=j)!=null?c:f)!=null?c:d("WATimeUtils").millisTime();var m=c!=null?d("WATimeUtils").castToMillisTime(c-1):null;l=(l=k)!=null?l:m;var n={deduplicationKey:g,folder:h!=null?h:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:i,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:l,newestMsg:null,newestMsgTs:c,nextInChatMsgId:1,oldestMsg:null,optimisticThreadKey:(m=e)!=null?m:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(c,i)};return a.threads.add(n).then(function(a){return{created:!0,thread:babelHelpers["extends"]({},n,{chatId:a})}})}else if(h!=null||e!=null){var o=babelHelpers["extends"]({},b,{cannotReplyReason:null,deduplicationKey:g,folder:h!=null?h:b.folder,optimisticThreadKey:e!=null?e:b.optimisticThreadKey});return a.threads.update(b.chatId,o).then(function(){return{created:!1,thread:o}})}return{created:!1,thread:b}}).then(function(b){var e=b.created,f=b.thread;d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(f,f.optimisticThreadKey,c)});var g=e&&d("MAWGating").isOccamadillo()?d("MAWAdminMsgBuildTxns").writeE2EEThreadDescriptionMsg(a,f.chatId):d("MAWDexieTable").dexieResolve(f);if(!e){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({folder:(e=f==null?void 0:f.folder)!=null?e:d("MAWFolderTypes").FOLDER_ID.INBOX,isDualSend:d("WADualSendMsgUtils").isDualSendJid(f.jid),threadId:f.chatId})})}return g.then(function(a){return{created:b.created,thread:a}})})};if(g!=null)return a.threads.get({deduplicationKey:g}).then(function(a){if(a!=null)return{created:!1,thread:a};else return l()});else return l()}g.getOrCreateThread=a}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypes","MAWDbGroupInviteTxns","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=d("WAGlobals").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){var f=d("MAWDbParticipant").craftParticipantId(b.chatId,e);c.push(d("MAWDbGroupInviteTxns").getGroupInvitesByInvitedParticipantId(a,f))},user:function(){}})});return d("MAWDexieTable").dexieAll(c).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypes").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWLoadMessageRequestCapabilitiesTxns",["MAWBridgeTypes","MAWDbContactsTxns","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){return d("WAJids").interpretAsUserJid(a.jid)}).filter(Boolean);return d("MAWDbContactsTxns").getContacts(a,c).then(function(a){a.forEach(function(a,c){c=b[c];d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:d("MAWBridgeTypes").createBridgeOneToOneMessageRequestLoadedData(c.chatId,a)})})})}g.loadMessageRequestDataForThreads=a}),98);
__d("MAWBridgeMsgCountdown",["MAWDbMsg","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["createBridgeMsgsStartCountdown: msg ",", expiration ",", ms until countdown ",", duration ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calling the messages starting countdown bridge event with remaning time less or equal to 0"]);i=function(){return a};return a}function a(a){return{msgs:a.map(function(a){var b,c=a.messageExpirationTs;b=(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec;if(c==null||b==null)return;var e=d("WATimeUtils").cappedMillisecondsUntil(c);if(e<=0){d("WALogger").LOG(i());return}var f=b*1e3;e>f&&(e=f);d("WALogger").LOG(h(),a.msgId,c,e,b);return{chatId:a.thread,countdownTs:c,millisecondsUntilCountdownTs:e,msgId:a.msgId,ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)}}).filter(Boolean)}}function b(a,b){return{countdownTs:b,msgId:a}}g.createBridgeMsgsStartCountdown=a;g.createBridgeMsgClearCountdown=b}),98);
__d("MAWBridgeXMA",["MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWBridge - createBridgeXMA received unexpected media type - ",""]);h=function(){return a};return a}function i(a){if(a==null)return void 0;switch(a){case"Image":case"Sticker":return"image/png";case"Gif":return"image/gif";case"Video":return"video/mp4";case"Ptt":return"audio/wav"}}function a(a,b,c){var e=c.ctas,f=c.defaultCTA,g=c.defaultPreviewMediaId,j=c.faviconMediaId,k=c.headerMediaId,l=c.headerTitle,m=c.maxSubtitleNumOfLines,n=c.maxTitleNumOfLines,o=c.msgId,p=c.overlayIconGlyph,q=c.subtitleText,r=c.targetId,s=c.targetType,t=c.targetUsername,u=c.titleText,v=c.xmaId;c=c.xmaLayoutType;b!=null&&b.mediaType!==d("MAWDbMedia").IMAGE&&d("WALogger").WARN(h(),b.mediaType);return{ctas:e,defaultCTA:f,defaultPreviewMediaId:g,duration:null,faviconMediaId:j,filesize:b==null?void 0:b.size,headerMediaId:k,headerTitle:l,maxSubtitleNumOfLines:m,maxTitleNumOfLines:n,mediaType:b==null?void 0:b.mediaType,msgId:o,overlayIconGlyph:p,playableUrlMimeType:i(b==null?void 0:b.mediaType),previewHeight:b==null?void 0:(e=b.validatedImageInfo)==null?void 0:e.jpegThumbnailHeight,previewHeightLarge:b==null?void 0:(f=b.validatedImageInfo)==null?void 0:f.height,previewUrlMimeType:i(b==null?void 0:b.mediaType),previewWidth:b==null?void 0:(g=b.validatedImageInfo)==null?void 0:g.jpegThumbnailWidth,previewWidthLarge:b==null?void 0:(j=b.validatedImageInfo)==null?void 0:j.width,subtitleText:q,targetId:r,targetType:s,targetUsername:t,threadId:a,titleText:u,ts:b==null?void 0:b.ts,xmaId:v,xmaLayoutType:c}}function b(a,b){var c=a.msgId;a=a.thread;return{msgId:c,threadId:a,xmaId:b}}function c(a,b){var c=a.msgId;a=a.thread;return{msgId:c,threadId:a,xmaId:b}}g.createBridgeXMA=a;g.createBridgeXMAShareExpired=b;g.createBridgeXMAShareTombstoned=c}),98);
__d("MAWLoadMsgsTxns",["MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeTypes","MAWBridgeXMA","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWXMAUtils","WADualSendMsgUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);h=function(){return a};return a}function i(a,b,c){return d("MAWDbMediaTxns").getMediaFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbChunkTxns").hasMediaChunk(a,b.hashedPlaintextHash).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(c,b,a)})})}))})}function j(a,b,c){return!d("MAWGating").isXMAFeedPostShareEnabled()?d("MAWDexieTable").dexieResolve([]):d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(c,a,b)})})}))})}function k(a,b){var c=b.author,e=b.reaction,f=b.reactToMsgId;b=b.ts;if(f==null||e==null)return;d("MAWIndexedDb").afterTransaction({tag:"UpsertReaction",value:d("MAWBridgeTypes").createBridgeUpsertReaction({author:c,chatId:a,reaction:e,reactToMsgId:f,ts:b})})}function l(a,b,c){b=b.map(function(a){a=a.msgId;return a});return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){a.forEach(function(a){return k(c,a)});return a})}function a(a,b,c,e,f){f===void 0&&(f=!1);return d("MAWDbMsgTxns").getMsgsFromOffset(a,b,c,e,f,!1).then(function(b){var c=b.msgs,e=babelHelpers.objectWithoutPropertiesLoose(b,["msgs"]);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return babelHelpers["extends"]({msgs:c,replyMediaInfo:a},e)})}).then(function(c){var e=c.hasMore,g=c.msgs,k=c.replyMediaInfo;if(g.length>0){c=g.filter(function(a){return a.ephemeralCounterStarted});var m=g.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(k||[])[b])}).filter(Boolean);m.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:m}});c.length>0&&(d("WALogger").LOG(h(),c.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(c)}));d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypes").createBridgeMsgsLoadedInfo(b,g,f,e,d("WADualSendMsgUtils").isDualSendJid((m=g[0])==null?void 0:m.threadJid))})}return d("MAWDexieTable").dexieAll([l(a,g,b),i(a,g,b),j(a,g,b)]).then(function(a){a=a[0];return{hasMore:e,msgs:g,reactions:a}})})}g.afterLoadReaction=k;g.loadMsgsAndMediaFromOffset=a}),98);
__d("MAWLoadThreadsTxns",["MAWBridgeParticipants","MAWBridgeThread","MAWBridgeTypes","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMessageRequestCapabilitiesTxns","MAWLoadMsgsTxns","MAWThreadSnippetBuildTxns","WADualSendMsgUtils","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){b.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid))})});return d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return j(a,b,c)}),[h(a,b),l(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(a,b),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function b(a,b,c){return d("MAWDexieTable").dexieAll([h(a,[b]),j(a,b,c),i(a,b)]).then(function(){m(a,b.chatId,d("WADualSendMsgUtils").isDualSendJid(b.jid))})}function h(a,b){if(b.length===0)return;return d("MAWDbParticipantTxns").getParticipantsInThreads(a,b.map(function(a){return a.chatId})).then(function(a){var c=new Map(b.map(function(a){return[a.chatId,a.jid]}));a=a.map(function(a){return babelHelpers["extends"]({},a,{isDualSend:(a=d("WADualSendMsgUtils").isDualSendJid(c.get(a.threadId)))!=null?a:!1})});d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})})}function i(a,b){var c=b.chatId,e=b.newestMsg,f=b.snippetMsg;f=(f=f)!=null?f:e;return f==null?d("MAWDexieTable").dexieResolve():d("MAWDexieTable").dexieAll([a.messages.get({msgId:f}),d("MAWDbReactionsTxns").getReactionsFromMessages(a,[f])]).then(function(e){var f=e[0];e=e[1];if(f==null)return;e=e==null?void 0:e.slice().reverse().find(function(a){return d("MAWDbReactionsTxns").isIncomingReaction(a)&&(f==null?void 0:f.ts)<a.ts});e!=null&&d("MAWLoadMsgsTxns").afterLoadReaction(c,e);return k(a,f,b,e).then(function(a){if(a!=null){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(b.jid),snippetParams:c,snippetSenderContactId:e,snippetType:a,threadId:b.chatId})})}})})}function j(a,b,c){var e=b.chatId;b=b.newestMsg;return b==null?d("MAWDexieTable").dexieResolve():d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,e,b,c,!0)}function k(a,b,c,e){return e!=null?d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(a,e==null?void 0:e.author,e==null?void 0:e.reaction,c.chatId):b==null?d("MAWDexieTable").dexieResolve(null):d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b,c)}function l(a,b){var c=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return c.push(a)},user:function(){}})});return a.groupInfo.bulkGet(c).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedGroupInfo(a)})})})}function m(a,b,c){var e=d("MAWGlobals").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,e).then(function(a){if(!a.success){d("WALogger").LOG(["[Occamadillo] User is not a participant of thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);a={cannotReplyReason:"viewer_not_subscribed",isDualSend:c,threadId:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread(a)})}})}g.loadContentsForThreads=a;g.loadParticipantsAndMsgs=b}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWGetOrCreateThreadTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){return h(a,b,c,e).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1).then(function(){return b})})}function h(a,b,c,e){return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getOrRepairGroupThreadByJid(a,b,c)},user:function(b){var f;return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),folder:(f=c)!=null?f:void 0,userJid:b})}})}function b(a,b,c,e){return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThreadByJidForIncomingMsg(a,b,c)},user:function(b){var f;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),folder:(f=c)!=null?f:void 0,jid:b})}})}function c(a,b){b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){return d("MAWLoadThreadsTxns").loadContentsForThreads(a,b.filter(Boolean),1).then(function(){})})}g.fetchAndEmitThread=a;g.fetchOrSetupThread=h;g.fetchThreadForIncomingMsgs=b;g.emitThreadContents=c}),98);
__d("MAWBridgeUpload",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c,d,e,f){return{actionType:e,echoDocument:d,messageId:a,sortOrderMs:c,threadId:b,traceId:f}}function b(a,b,c,d,e,f){return{actionType:f,echoDocument:e,folderType:b,threadId:a,transportKey:c,ts:d}}function c(a,b,c,d,e,f){return{deliveryObjectId:a,mediaType:b,messageId:c,productType:d,threadId:e,traceId:f}}f.createBridgeUploadMessage=a;f.createBridgeUploadThread=b;f.createBridgeUploadAttachment=c}),66);
__d("EchoCommonUtils",[],(function(a,b,c,d,e,f){"use strict";c="Echo-Doc-Version";function a(a,b){var c=a.localKey;a=a.transportKey;return c+"@"+a+"-"+b}function b(a,b,c){return a==null?{localKey:b,transportKey:c}:{displayName:a,localKey:b,transportKey:c}}f.ECHO_COMMON_FIELD_DOCUMENT_VERSION=c;f.getEchoAddressFieldNameWithSuffix=a;f.craftEchoAddress=b}),66);
__d("EchoConstants",[],(function(a,b,c,d,e,f){"use strict";a=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"'," ","(",")",",",":",";","<",">","@","[","]","\\"]);f.ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE=a}),66);
__d("EchoDecodingUtils",["invariant","EchoConstants","WALogger"],(function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] "," not a valid number in echo message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail to decode if the input string does not have CRLF"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Address  decode failed with value: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddressList detected"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid transportKey in address detected"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid localKey in address detected"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] parse localKey in address failed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echoDecodeAddress failed"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] conditional quote mode decode failed"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] invalid input to echoDecodeAddress"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Fail decoding because we didn't have a closing quote"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Field name is blank"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] This is a raw line and we cannot decode its field name and value."]);u=function(){return a};return a}function v(a,b){if(a.length===0)return;var c=a.indexOf(":");if(c===-1){d("WALogger").ERROR(u());return}var e=a.substring(0,c).trim();a=a.substring(c+1).trim();if(e.length===0){d("WALogger").ERROR(t());return}if(a.length===0){b.has(e)&&b["delete"](e);return}b.set(e,a)}function w(a,b,c){c===void 0&&(c=new Set());var e=!1,f=b==="conditional"&&a[0]==='"',g="",h=f?1:0;while(h<a.length){var i=a[h];if(b==="conditional"&&!f&&i==='"')break;if(!f&&c.has(i))break;if(f&&!e&&i==='"'){f=!1;h++;break}if(f&&!e&&i==="\\"){if(h===a.length-1)break;e=!0}else e&&i==="r"?g+="\r":e&&i==="n"?g+="\n":g+=i,e=!1;h++}if(f||g.length===0){d("WALogger").ERROR(s());return{remainder:a,result:null,success:!1}}return{remainder:a.substring(h),result:g,success:!0}}function x(a){if(a.length===0){d("WALogger").ERROR(r());return{remainder:a,result:null,success:!1}}var b=a.trimLeft();b=w(b,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE);if(!b.success){d("WALogger").ERROR(q());return{remainder:a,result:null,success:!1}}b.result!=null||h(0,47923);if(b.remainder[0]==="@"){var c=y(b.remainder,b.result);return{remainder:c.remainder,result:c.result,success:c.success}}c=b.result;b=b.remainder.trimLeft();if(b.startsWith("<")){b=y(b.substring(1));var e=b.result,f=b.remainder;if(b.success&&e!=null&&f.startsWith(">"))if(c.length===0)return{remainder:f.substring(1),result:e,success:!0};else return{remainder:f.substring(1),result:babelHelpers["extends"]({},e,{displayName:c}),success:!0}}d("WALogger").ERROR(p());return{remainder:a,result:null,success:!1}}function y(a,b){var c=b==null?a.trimLeft():a;b=b;if(b==null){var e=w(c,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE);if(!e.success){d("WALogger").ERROR(o());return{remainder:a,result:null,success:!1}}b=e.result;c=e.remainder}if(b==null||b.length===0||c[0]!=="@"){d("WALogger").ERROR(n());return{remainder:a,result:null,success:!1}}e=w(c.substring(1),"never",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE);c=e.result;if(e.success&&c!=null&&c.length>0)return{remainder:e.remainder,result:{localKey:b,transportKey:c},success:!0};else{d("WALogger").ERROR(m());return{remainder:a,result:null,success:!1}}}function z(a){if(a.length===0){d("WALogger").ERROR(l());return{result:null,success:!1}}var b=x(a);if(!b.success){d("WALogger").ERROR(k(),a);return{result:null,success:!1}}b.result!=null||h(0,47927);a=[b.result];b=b.remainder;while(b.startsWith(",")){var c=x(b.substring(1).trimLeft());if(c.success)c.result!=null&&a.push(c.result),b=c.remainder;else break}return{result:a,success:!0}}function a(a){var b=new Map(),c=a.split("\r\n");if(c.length===1&&c[0]===a){d("WALogger").ERROR(j());return b}c.forEach(function(a){return v(a,b)});return b}function b(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};b=w(a,"conditional");a=b.result;b=b.success;return{result:a,success:b}}function c(a,b){a=A(a,b);return{result:(b=a.result)!=null?b:0,success:a.success}}function A(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};a=parseInt(a,10);if(isNaN(a)){d("WALogger").ERROR(i(),b);return{result:null,success:!1}}else return Number.isSafeInteger(a)?{result:a,success:!0}:{result:a>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,success:!0}}function e(a,b){a=B(a,b);return{result:(b=a.result)!=null?b:!1,success:a.success}}function B(a,b){a=A(a,b);return!a.success||a.result!==0&&a.result!==1?{result:null,success:!1}:{result:a.result===1,success:!0}}function f(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};b=x(a);a=b.result;b=b.success;return{result:a,success:b}}function C(a,b){a=a.get(b);return a==null||a.length===0?{result:null,success:!1}:z(a)}function D(a,b){a=a.get(b);if(a==null||a.length===0)return{result:null,success:!1};b=a.split(",").map(function(a){return a.trim()}).filter(Boolean);return b.length===0?{result:null,success:!1}:{result:b,success:!0}}g.echoDecodeAddress=x;g.echoDecodeFields=a;g.echoDecodeStringField=b;g.echoDecodeIntField=c;g.echoDecodeNullableIntField=A;g.echoDecodeBooleanField=e;g.echoDecodeNullableBooleanField=B;g.echoDecodeAddressField=f;g.echoDecodeAddressListField=C;g.echoDecodeObjectIdListField=D}),98);
__d("EchoEncodingUtils",["invariant","EchoConstants","WABase64"],(function(a,b,c,d,e,f,g,h){"use strict";var i=new Set(['"',"\\","\n","\r","\0"]),j=new Set(["\0","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f",'"',"\\"]);function k(a,b){for(var b=b,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;if(a.indexOf(e)>=0)return!0}return!1}function l(a,b,c){c===void 0&&(c=new Set());a.length>0||h(0,47406);var d=b;b==="conditional"&&(k(a,c)?d="always":d="never");if(d==="never")return a;b='"';for(c=0;c<a.length;c++){d=a[c];i.has(d)?(b+="\\",d==="\r"?b+="r":d==="\n"?b+="n":b+=d):b+=d}return b+'"'}function m(a){Number.isSafeInteger(a)||h(0,47496);return a.toString()}function n(a){var b="",c=a.displayName,e=a.localKey;a=a.transportKey;c!=null&&c.length>0&&(b+=l(c,"always")+" <");b+=l(e,"conditional",d("EchoConstants").ADDRESS_LOCAL_KEY_CHARS_NEED_QUOTE)+"@"+a;c!=null&&c.length>0&&(b+=">");return b}function o(a,b,c){c!=null&&c.length!==0&&a.set(b,l(c,"conditional",j))}function a(a,b,c){if(c!=null){c=m(c);o(a,b,c)}}function b(a,b,c){if(c!=null){c=m(c?1:0);o(a,b,c)}}function c(a,b,c){c!=null&&a.set(b,n(c))}function e(a,b,c){if(c!=null){var d="";c.forEach(function(a,b){d+=n(a),b<c.length-1&&(d+=", ")});a.set(b,d)}}function f(a){var b="";a.forEach(function(a,c){b=b+c+": "+a+"\r\n"});return b}function p(a){return d("WABase64").encodeB64UrlSafe(a)}g.echoSetStringField=o;g.echoSetIntField=a;g.echoSetBooleanField=b;g.echoSetAddressField=c;g.echoSetAddressListField=e;g.echoEncodeFields=f;g.convertMediaKeyToString=p}),98);
__d("EchoThread",["invariant","$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils"],(function(a,b,c,d,e,f,g,h){"use strict";var i="Thread-ID",j="Display-Name",k="Display-Image-URL",l="Sort-Order",m="Display-Timestamp",n="Is-Group-Thread",o="Needs-Admin-Approval-For-New-Participant",p="Custom-Emoji",q="Mute-Expiration-Timestamp",r="Folder-Type",s="Ephemeral-Options-Duration",t="Ephemeral-Options-Last-Updated",u="Participants",v="Admin-Type",w="X-Thread-Type",x="X-Thread-ID",y=1,z=b("$InternalEnum")({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5}),A=b("$InternalEnum")({NONE:"none",ADMIN:"admin",SUPER_ADMIN:"super_admin"}),B=b("$InternalEnum")({UNKNOWN:0,ONE_TO_ONE:1,GROUP_THREAD:2,ROOM:3,MONTAGE:4,MARKETPLACE:5,FOLDER:6,ENCRYPTED_ONE_TO_ONE:7,ENCRYPTED_GROUP_DISAPPEARING:8,CARRIER_MESSAGING_ONE_TO_ONE:10,CARRIER_MESSAGING_GROUP:11,ENCRYPTED_ONE_TO_ONE_DISAPPEARING:13,ENCRYPTED_OVER_WA_ONE_TO_ONE:15,ENCRYPTED_OVER_WA_GROUP:16,COMMUNITY_GROUP:18});function C(a){a=z.cast(a);return(a=a)!=null?a:z.OTHER}function D(a){a=B.cast(a);return(a=a)!=null?a:B.UNKNOWN}function E(a,b){d("EchoEncodingUtils").echoSetStringField(a,i,b.threadId),d("EchoEncodingUtils").echoSetStringField(a,j,b.displayName),d("EchoEncodingUtils").echoSetStringField(a,k,b.displayImageUrl),d("EchoEncodingUtils").echoSetIntField(a,l,b.sortOrder),d("EchoEncodingUtils").echoSetIntField(a,m,b.displayTimestamp),d("EchoEncodingUtils").echoSetBooleanField(a,n,b.isGroupThread),d("EchoEncodingUtils").echoSetBooleanField(a,o,b.needsAdminApprovalForNewParticipant),d("EchoEncodingUtils").echoSetStringField(a,p,b.customEmoji),d("EchoEncodingUtils").echoSetIntField(a,q,b.muteExpirationTimestamp),d("EchoEncodingUtils").echoSetIntField(a,r,b.folderType),d("EchoEncodingUtils").echoSetIntField(a,s,b.ephemeralOptionsDurationInSec),d("EchoEncodingUtils").echoSetIntField(a,t,b.ephemeralOptionsLastUpdatedAuthoritativeTimestamp),d("EchoEncodingUtils").echoSetAddressListField(a,u,b.participantsList),F(a,b.adminList),b.xThreadType!=null&&d("EchoEncodingUtils").echoSetIntField(a,w,b.xThreadType),d("EchoEncodingUtils").echoSetStringField(a,x,b.xThreadId),d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION,b.version)}function F(a,b){if(b==null||b.length===0)return;b.forEach(function(b){var c=b.adminType;c!==A.NONE&&d("EchoEncodingUtils").echoSetStringField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,v),c)})}function G(a,b){var c=[];b.forEach(function(b){var e=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b,v);e=d("EchoDecodingUtils").echoDecodeStringField(a,e);if(e.success){e=(e=A.cast(e.result))!=null?e:A.NONE;c.push({address:b,adminType:e})}});return c}function a(a){var b=new Map();E(b,a);return d("EchoEncodingUtils").echoEncodeFields(b)}function c(a){a=d("EchoDecodingUtils").echoDecodeFields(a);if(a.size===0)return null;var b=d("EchoDecodingUtils").echoDecodeStringField(a,i),c=d("EchoDecodingUtils").echoDecodeIntField(a,l),e=d("EchoDecodingUtils").echoDecodeIntField(a,r),f=d("EchoDecodingUtils").echoDecodeAddressListField(a,u),g=d("EchoDecodingUtils").echoDecodeBooleanField(a,n),v=d("EchoDecodingUtils").echoDecodeIntField(a,m),z=d("EchoDecodingUtils").echoDecodeIntField(a,w),A;z.success&&z.result!=null&&(A=D(z.result));if(b.success&&c.success&&e.success&&f.success&&g.success&&v.success&&A!=null){b.result!=null||h(0,47884);z=f.result;z!=null||h(0,47911);f={threadId:b.result,sortOrder:c.result,displayTimestamp:v.result,isGroupThread:g.result,folderType:C(e.result),participantsList:z,xThreadType:A};b=d("EchoDecodingUtils").echoDecodeStringField(a,j);b.success&&b.result!=null&&(f.displayName=b.result);c=d("EchoDecodingUtils").echoDecodeStringField(a,k);c.success&&c.result!=null&&(f.displayImageUrl=c.result);v=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,o);v.success&&v.result!=null&&(f.needsAdminApprovalForNewParticipant=v.result);g=d("EchoDecodingUtils").echoDecodeStringField(a,p);g.success&&g.result!=null&&(f.customEmoji=g.result);e=d("EchoDecodingUtils").echoDecodeNullableIntField(a,q);e.success&&e.result!=null&&(f.muteExpirationTimestamp=e.result);b=d("EchoDecodingUtils").echoDecodeNullableIntField(a,s);b.success&&b.result!=null&&(f.ephemeralOptionsDurationInSec=b.result);c=d("EchoDecodingUtils").echoDecodeNullableIntField(a,t);c.success&&c.result!=null&&(f.ephemeralOptionsLastUpdatedAuthoritativeTimestamp=c.result);v=G(a,z);v.length>0&&(f.adminList=v);g=d("EchoDecodingUtils").echoDecodeStringField(a,x);g.success&&g.result!=null&&(f.xThreadId=g.result);e=d("EchoDecodingUtils").echoDecodeNullableIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION);f.version=e.success&&e.result!=null?e.result:y;return f}else return null}g.ECHO_THREAD_MIGRATION_DOCUMENT_VERSION=y;g.FolderType=z;g.AdminType=A;g.XThreadType=B;g.encodeEchoThread=a;g.decodeEchoThread=c}),98);
__d("MAWUploadThreadTxns",["EchoCommonUtils","EchoThread","MAWDbContactsTxns","MAWDexieTable","MAWFolderTypes","MAWTimeUtils.bs","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a){case d("MAWFolderTypes").FOLDER_ID.INBOX:return d("EchoThread").FolderType.INBOX;case d("MAWFolderTypes").FOLDER_ID.PENDING:return d("EchoThread").FolderType.PENDING;case d("MAWFolderTypes").FOLDER_ID.ARCHIVED:return d("EchoThread").FolderType.ARCHIVED;default:return d("EchoThread").FolderType.INBOX}}function a(a){return h(a).toString()}function i(a,b){return a.participants.where("threadId").equals(b).toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbContactsTxns").maybeGetContactName(a,b.userJid).then(function(a){return d("EchoCommonUtils").craftEchoAddress(a,d("WAJids").userIdFromJid(b.userJid),"AdvancedCrypto")})}))})}function b(a,b){var c=d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return!0},user:function(a){return!1}}),e=d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}});a=i(a,b.chatId);return a.then(function(a){return{displayImageUrl:"",displayName:"",displayTimestamp:d("MAWTimeUtils.bs").getMillisTime(b.newestMsgTs)||0,folderType:h(b.folder),isGroupThread:c,participantsList:a,sortOrder:0,threadId:e,version:d("EchoThread").ECHO_THREAD_MIGRATION_DOCUMENT_VERSION,xThreadId:e,xThreadType:c?d("EchoThread").XThreadType.ENCRYPTED_OVER_WA_GROUP:d("EchoThread").XThreadType.ENCRYPTED_OVER_WA_ONE_TO_ONE}})}g.getFolderTypeAsText=a;g.constructEchoThread=b}),98);
__d("MAWBridgeEventTransmitter",["MAWBridge","MAWBridgeTypes","MAWBridgeUpload","MAWIndexedDb","MAWJidUtils","MAWTimeUtils.bs","MAWUploadThreadTxns","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"IssuePointQuery",value:d("MAWBridgeTypes").createBridgeIssuePointQuery(a,c,b)}]})}function b(a){d("MAWIndexedDb").afterTransaction({tag:"UploadThread",value:d("MAWBridgeUpload").createBridgeUploadThread(d("MAWJidUtils").threadIdForChatJid(a.jid),d("MAWUploadThreadTxns").getFolderTypeAsText(a.folder),"AdvancedCrypto",(a=d("MAWTimeUtils.bs").getMillisTime(a.newestMsgTs))!=null?a:d("WATimeUtils").castToMillisTime(1),null,2)})}g.issuePointQuery=a;g.uploadThread=b}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDexieTable","MAWGlobals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("MAWGlobals").getMyUserJid();f=d("MAWDbParticipant").craftParticipantId(b,f);return d("MAWDbGroupInviteTxns").deleteGroupInvitesByInvitedParticipantId(a,f).then(function(){return c})}else{var g=[];e.forEach(function(c){c=d("MAWDbParticipant").craftParticipantId(b,c.userJid);g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByInvitedParticipantId(a,c))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("WASortedLists",[],(function(a,b,c,d,e,f){function a(){return[]}function b(){return[]}function c(a,b){return a.filter(b)}function d(a,b){return l(a.map(b))}function e(a,b){var c=a.length===b.length;for(var d=0;c&&d<a.length;d++)a[d]!==b[d]&&(c=!1);return c}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a;return a.concat([b]).sort()}function h(a,b){if(a.length<b.length)return!1;var c=!0;for(var d=0,e=0;c&&e<b.length;e++)do c=a[d]===b[e];while(!c&&++d<a.length);return c}function i(a,b){var c=[];for(var d=0,e=0;d<a.length;d++){var f=a[d];while(e<b.length&&f>b[e])e++;(e===b.length||f<b[e])&&c.push(f)}return c}function j(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length){var f=a[d],g=b[e];f<g?d++:f===g?(c.push(f),d++,e++):e++}return c}function k(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length)a[d]<b[e]?c.push(a[d++]):a[d]===b[e]?(c.push(a[d++]),e++):c.push(b[e++]);while(d<a.length)c.push(a[d++]);while(e<b.length)c.push(b[e++]);return c}function l(a){return m(a.slice().sort())}function m(a){var b=!1;for(var c=0;c<a.length-1;c++)a[c]===a[c+1]&&(b=!0);if(!b)return a;c=[];for(b=0;b<a.length-1;b++)a[b]!==a[b+1]&&c.push(a[b]);c.push(a[a.length-1]);return c}function n(a){return Array.from(a).sort()}function o(a){return a.slice().sort()}function p(a,b,c){var d=null;for(var e=0;!d&&e<a.length;e++)a[e]===b&&(d=a.slice(),d[e]=c,d=m(d.sort()));return d||a}function q(a){return[a]}function r(a){return a.length<1}function s(a,b,c){return a.slice(b,c)}f.emptySet=a;f.emptyList=b;f.filter=c;f.map=d;f.areEqual=e;f.addToSet=g;f.contains=h;f.subtract=i;f.intersect=j;f.joinUniq=k;f.sortAndDedupe=l;f.asSortedSet=n;f.sort=o;f.swapIn=p;f.singleElement=q;f.isEmpty=r;f.slice=s}),66);
__d("MAWThreadManagementTxns",["MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypes","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbReceiptTxns","MAWDbThreadTxns","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWGlobals","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWJids","MAWLoadMessageRequestCapabilitiesTxns","WADualSendMsgUtils","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"]);h=function(){return a};return a}e=30*d("WATimeUtils").DAY_SECONDS;function i(a,b){var c=b.authoritativeThreadKey,e=b.createTs,f=b.folder,g=b.lastActivityTimestamp,h=b.lastReadWatermarkTimestamp,i=b.offlineThreadingId,j=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:c,clientThreadKey:i,createTs:e,folder:f,jid:j,lastActivityTimestamp:g,lastReadWatermarkTimestamp:h}).then(function(b){var c=b.created,e=b.thread;b=[d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(a,[e])];if(c){b.push(d("MAWDbParticipantTxns").addParticipant(a,e.chatId,d("WADualSendMsgUtils").isDualSendJid(j)?d("WADualSendMsgUtils").removeDualSendPrefixForUser(j):j));var f=d("MAWGlobals").getMyUserJid();f!==e.jid&&b.push(d("MAWDbParticipantTxns").addParticipant(a,e.chatId,f))}else b.push(d("MAWDbParticipantTxns").getParticipantsInThread(a,e.chatId).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a.map(function(a){return babelHelpers["extends"]({},a,{isDualSend:d("WADualSendMsgUtils").isDualSendJid(e.jid)})}))})}));return d("MAWDexieTable").dexieAll(b).then(function(){return{created:c,thread:e}})})}function a(a,b){var c;c=(c=b.xThreadId)!=null?c:b.threadId;if(b.isGroupThread){b=d("MAWJids").toGroupJid(c);return l(a,b,d("MAWFolderTypes").FOLDER_ID.INBOX)}else{b=d("MAWJids").toUserJid(c);return i(a,{folder:d("MAWFolderTypes").FOLDER_ID.INBOX,userJid:b})}}function j(a,b,c){return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(b.creationTs),folder:c,jid:b.groupJid}).then(function(c){var e=c.created,f=c.thread;c=f.chatId;if(e){var g=b.threadId,h=babelHelpers["extends"]({},b,{threadId:c});return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").migrateParticipantsToNewThread(a,g,c),d("MAWDbGroupInfoTxns").updateGroupInfo(a,h)]).then(function(){return{created:e,groupInfo:h,thread:f}})}return{created:e,groupInfo:b,thread:f}})}function k(a,b,c){return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(b.creationTs),folder:c,jid:b.groupJid}).then(function(a){var c=a.created;a=a.thread;return{created:c,groupInfo:b,thread:a}})}function l(a,b,c){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){return b.success?j(a,b.value,c):null})}function b(a,b,c){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){return b.success?k(a,b.value,c):null})}function m(a,b){var c=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&c.push(a)});var e=[],f=[];c.forEach(function(a){a.mediaId!=null&&(e.push(a.mediaId),f.push(a.msgId))});return a.media.bulkGet(e).then(function(b){var c=[],e=[];b.forEach(function(a,b){if(a!=null){var g=f[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),e.push(a.mediaId))}});b=a.media.bulkDelete(e);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h(),e.length,c.length)})})}function n(a,b){return a.messages.where("thread").equals(b.chatId).toArray().then(function(c){return o(a,b,c,!0)})}function c(a,b,c){var e=c==null?void 0:c.lastMessageTimestamp;if(c==null)return n(a,b);var f=a.messages.where("thread").equals(b.chatId).toArray();return f.then(function(f){var g=[],h=new Set();e!=null&&f.forEach(function(a){a.ts<=e+1&&(h.add(a.msgId),g.push(a))});if((c==null?void 0:c.messages.length)!==0){var i=new Set();c.messages.forEach(function(a){i.add((a=a.key)==null?void 0:a.id)});f.forEach(function(a){i.has(a.externalId)&&!h.has(a.msgId)&&(h.add(a.msgId),g.push(a))})}if(g.length!==f.length)for(var j=f,k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}m=m;if(!h.has(m.msgId)&&m.type!==d("WAMsgType").ADMIN)return o(a,b,g,!1)}return o(a,b,f,!0)})}function o(a,b,c,e){var f=d("WAJids").interpretAsGroupJid(b.jid),g=e?d("MAWDbThreadTxns").deleteThreadRow(a,b.chatId):d("MAWDexieTable").dexieResolve(),h=f==null&&e?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.chatId):d("MAWDexieTable").dexieResolve(),i=d("MAWDexieTable").dexieResolve(!1),j=d("MAWDexieTable").dexieResolve();f!=null&&e&&(i=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,b.chatId),j=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,f));return d("MAWDexieTable").dexieAll([m(a,c),d("MAWDbReceiptTxns").bulkDeleteAllReceiptsForMessages(a,c),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,c),d("MAWDbMsgTxns").deleteMessages(a,c),g,h,j,i]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a[6];a=a[7];if(e){d("MAWBridgeEventTransmitter").uploadThread(b);if(f!=null&&a){a=d("MAWGlobals").getMyUserJid();a=d("MAWDbParticipant").craftParticipantId(b.chatId,a);d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypes").createBridgeDeleteGroupInvite(a)})}d("MAWIndexedDb").afterTransaction({tag:"ThreadHidden",value:b.chatId})}else d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(b.chatId,c)})})}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=e;g.getOrSetupOneToOneThread=i;g.getOrCreateThreadFromEchoThread=a;g.getOrRepairGroupThread=j;g.getGroupThreadForIncomingMsg=k;g.getOrRepairGroupThreadByJid=l;g.getGroupThreadByJidForIncomingMsg=b;g.deleteAllThreadData=n;g.metaSyncChatDeleteThread=c}),98);
__d("MAWDbPendingStanza",["WAAssertUnreachable"],(function(a,b,c,d,e,f,g){"use strict";var h="revoked",i="deleteForMe",j="deleteThread";b="Revoked";d="DeleteForMe";e="DeleteThread";f={DELETE_FOR_ME:d,DELETE_THREAD:e,REVOKED:b};function a(a){switch(a){case"Revoked":return h;case"DeleteForMe":return i;case"DeleteThread":return j;default:return c("WAAssertUnreachable")(a)}}g.PENDING_REVOKED=h;g.PENDING_DELETE_FOR_ME=i;g.PENDING_DELETE_THREAD=j;g.REVOKED=b;g.DELETE_FOR_ME=d;g.DELETE_THREAD=e;g.PENDING_TYPE=f;g.getPendingSuffix=a}),98);
__d("MAWPendingStanzaCleaner",["MAWGating","MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["PendingStanzaCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j=null,k=d("MAWGating").isUnsendGlobalEnabled()||d("MAWGating").isUnsendLocallyEnabled();function a(a){k&&(j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.PENDING_STANZA)))}function b(a){if(k)if(j==null){var b="Trying to add new PendingStanzaCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),j.update(a)}function e(){return j}function f(){j=null}g.startPendingStanzaCleaner=a;g.addNewPendingStanzaCleanerTimestamp=b;g.getPendingStanzaCleaner_FOR_TESTING_ONLY=e;g.resetPendingStanzaCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWDbPendingStanzaTxns",["MAWDbPendingStanza","MAWPendingStanzaCleaner","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){var g=d("MAWDbPendingStanza").getPendingSuffix(f);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+g).filter(function(a){a=a.pendingContent;return a.type===f&&a.content.author===c&&a.content.thread!=null&&a.content.thread===e}).first()}function b(a,b,c,e,f){f=d("MAWDbPendingStanza").getPendingSuffix(f);var g=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+c);c={deleteTs:g,externalIdWithType:e+"_"+f,pendingContent:b};return a.pendingStanzas.add(c).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(g)})}function c(a,b){var c=d("MAWDbPendingStanza").getPendingSuffix(d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD);return a.pendingStanzas.where("externalIdWithType").equals(b+"_"+c).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.pendingContent.type==="DeleteThread"){a=a.pendingContent.content.metaSyncMessageRange.lastMessageTimestamp;a!=null&&b.push(a)}});if(b.length===0)return null;b.sort(function(a,b){return b-a});a=b[0];return{lastMessageTimestamp:a}})}g.maybeGetPendingStanzaByExternalId=a;g.putPendingStanza=b;g.maybeGetDeleteThreadFromPendingStanza=c}),98);
__d("MAWDeleteForMeMsgContentCleaner",["MAWGating","MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeleteForMeMsgContentCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startDeleteForMeMsgContentCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("MAWGating").isUnsendLocallyEnabled()&&(d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.DELETE_FOR_ME)))}function b(a){if(d("MAWGating").isUnsendLocallyEnabled())if(k==null){var b="Trying to add new DeleteForMeContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startDeleteForMeMsgContentCleaner=a;g.addNewDeleteForMeMsgContentCleanerTimestamp=b;g.getDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetDeleteForMeMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("WAArmadilloApplication.pb",["WAArmadilloXMA.pb","WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={ES_OPEN:1,ES_CLOSE:2};b={SCREENSHOT_IMAGE:1,SCREEN_RECORDING:2};c={PLAYED:0,SCREENSHOT:1,FORCE_DISABLE:2};e={VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2};f={SMALL_LIKE:1,MEDIUM_LIKE:2,LARGE_LIKE:3};var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null),n=babelHelpers["extends"]({},null),o=babelHelpers["extends"]({},null),p=babelHelpers["extends"]({},null),q=babelHelpers["extends"]({},null),r=babelHelpers["extends"]({},null),s=babelHelpers["extends"]({},null),t=babelHelpers["extends"]({},null),u=babelHelpers["extends"]({},null),v=babelHelpers["extends"]({},null),w=babelHelpers["extends"]({},null),x=babelHelpers["extends"]({},null),y=babelHelpers["extends"]({},null),z=babelHelpers["extends"]({},null),A=babelHelpers["extends"]({},null),B=babelHelpers["extends"]({},null),C=babelHelpers["extends"]({},null),D=babelHelpers["extends"]({},null),E=babelHelpers["extends"]({},null);h.internalSpec={payload:[1,d("WAProtoConst").TYPES.MESSAGE,j],metadata:[2,d("WAProtoConst").TYPES.MESSAGE,i]};i.internalSpec={};j.internalSpec={content:[1,d("WAProtoConst").TYPES.MESSAGE,z],applicationData:[2,d("WAProtoConst").TYPES.MESSAGE,o],signal:[3,d("WAProtoConst").TYPES.MESSAGE,l],subProtocol:[4,d("WAProtoConst").TYPES.MESSAGE,k],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};k.internalSpec={futureProof:[1,d("WAProtoConst").TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};l.internalSpec={encryptedBackupsSecrets:[1,d("WAProtoConst").TYPES.MESSAGE,m],__oneofs__:{signal:["encryptedBackupsSecrets"]}};m.internalSpec={backupId:[1,d("WAProtoConst").TYPES.UINT64],serverDataId:[2,d("WAProtoConst").TYPES.UINT64],epoch:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,n],tempOcmfClientState:[4,d("WAProtoConst").TYPES.BYTES],mailboxRootKey:[5,d("WAProtoConst").TYPES.BYTES],obliviousValidationToken:[6,d("WAProtoConst").TYPES.BYTES]};n.internalSpec={id:[1,d("WAProtoConst").TYPES.UINT64],anonId:[2,d("WAProtoConst").TYPES.BYTES],rootKey:[3,d("WAProtoConst").TYPES.BYTES],status:[4,d("WAProtoConst").TYPES.ENUM,a]};o.internalSpec={metadataSync:[1,d("WAProtoConst").TYPES.MESSAGE,y],__oneofs__:{applicationData:["metadataSync"]}};p.internalSpec={actionTimestamp:[1,d("WAProtoConst").TYPES.INT64],chatAction:[101,d("WAProtoConst").TYPES.MESSAGE,s],messageAction:[102,d("WAProtoConst").TYPES.MESSAGE,q],__oneofs__:{actionType:["chatAction","messageAction"]}};q.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec],messageDelete:[101,d("WAProtoConst").TYPES.MESSAGE,r],__oneofs__:{action:["messageDelete"]}};r.internalSpec={};s.internalSpec={chatId:[1,d("WAProtoConst").TYPES.STRING],chatArchive:[101,d("WAProtoConst").TYPES.MESSAGE,v],chatDelete:[102,d("WAProtoConst").TYPES.MESSAGE,u],chatRead:[103,d("WAProtoConst").TYPES.MESSAGE,t],__oneofs__:{action:["chatArchive","chatDelete","chatRead"]}};t.internalSpec={messageRange:[1,d("WAProtoConst").TYPES.MESSAGE,x],read:[2,d("WAProtoConst").TYPES.BOOL]};u.internalSpec={messageRange:[1,d("WAProtoConst").TYPES.MESSAGE,x]};v.internalSpec={messageRange:[1,d("WAProtoConst").TYPES.MESSAGE,x],archived:[2,d("WAProtoConst").TYPES.BOOL]};w.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec],timestamp:[2,d("WAProtoConst").TYPES.INT64]};x.internalSpec={lastMessageTimestamp:[1,d("WAProtoConst").TYPES.INT64],lastSystemMessageTimestamp:[2,d("WAProtoConst").TYPES.INT64],messages:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,w]};y.internalSpec={actions:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,p]};z.internalSpec={commonSticker:[1,d("WAProtoConst").TYPES.MESSAGE,E],screenshotAction:[3,d("WAProtoConst").TYPES.MESSAGE,A],extendedContentMessage:[4,d("WAProtoConst").TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec],ravenMessage:[5,d("WAProtoConst").TYPES.MESSAGE,D],ravenActionNotifMessage:[6,d("WAProtoConst").TYPES.MESSAGE,C],extendedMessageContentWithSear:[7,d("WAProtoConst").TYPES.MESSAGE,B],__oneofs__:{content:["commonSticker","screenshotAction","extendedContentMessage","ravenMessage","ravenActionNotifMessage","extendedMessageContentWithSear"]}};A.internalSpec={screenshotType:[1,d("WAProtoConst").TYPES.ENUM,b]};B.internalSpec={searId:[1,d("WAProtoConst").TYPES.STRING],payload:[2,d("WAProtoConst").TYPES.BYTES],nativeUrl:[3,d("WAProtoConst").TYPES.STRING],searAssociatedMessage:[4,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],searSentWithMessageId:[5,d("WAProtoConst").TYPES.STRING]};C.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec],actionTimestamp:[2,d("WAProtoConst").TYPES.INT64],actionType:[3,d("WAProtoConst").TYPES.ENUM,c]};D.internalSpec={ephemeralType:[1,d("WAProtoConst").TYPES.ENUM,e],imageMessage:[2,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],videoMessage:[3,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],__oneofs__:{mediaContent:["imageMessage","videoMessage"]}};E.internalSpec={stickerType:[1,d("WAProtoConst").TYPES.ENUM,f]};g.ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS=a;g.ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE=b;g.ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE=c;g.ARMADILLO_CONTENT_RAVEN_MESSAGE_EPHEMERAL_TYPE=e;g.ARMADILLO_CONTENT_COMMON_STICKER_STICKER_TYPE=f;g.ArmadilloSpec=h;g.Armadillo$MetadataSpec=i;g.Armadillo$PayloadSpec=j;g.Armadillo$SubProtocolPayloadSpec=k;g.Armadillo$SignalSpec=l;g.Armadillo$Signal$EncryptedBackupsSecretsSpec=m;g.Armadillo$Signal$EncryptedBackupsSecrets$EpochSpec=n;g.Armadillo$ApplicationDataSpec=o;g.Armadillo$ApplicationData$MetadataSyncActionSpec=p;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageActionSpec=q;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction$ActionMessageDeleteSpec=r;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatActionSpec=s;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatReadSpec=t;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatDeleteSpec=u;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatArchiveSpec=v;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageSpec=w;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageRangeSpec=x;g.Armadillo$ApplicationData$MetadataSyncNotificationSpec=y;g.Armadillo$ContentSpec=z;g.Armadillo$Content$ScreenshotActionSpec=A;g.Armadillo$Content$ExtendedContentMessageWithSearSpec=B;g.Armadillo$Content$RavenActionNotifMessageSpec=C;g.Armadillo$Content$RavenMessageSpec=D;g.Armadillo$Content$CommonStickerSpec=E}),98);
__d("MAWEphemeralUtil",["MAWAckLevel","MAWBridgeMsgCountdown","MAWDbMsg","MAWGlobals","MAWIndexedDb","MAWLocalizationType","WAArmadilloApplication.pb","WAJids","WALogger","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The new ephemeral setting timestamp should be greater than the existing timestamp"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New ephemeral duration should be different from the existing duration"]);i=function(){return a};return a}function a(a,b,c,d,e,f){d=d!==b&&c===a&&f<=e;return d||a>c}function b(a,b,c){if(a==null)return!0;a=a.ephemeralSetting;if(a!=null&&a.ephemeralExpirationInSec===b){d("WALogger").ERROR(i());return!1}if(a!=null&&a.ephemeralLastUpdatedOrSetTimestamp>c){d("WALogger").ERROR(h());return!1}return!0}function e(a){a={ack:d("MAWAckLevel").ACK.sent,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWGlobals").getDependencies().generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES},ts:a,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};return{unstoredDbMedia:null,unstoredDbMsg:a,unstoredDbReaction:null}}function f(a,b){var e;switch(b){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE;break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING;break;default:throw c("err")("Received unexpected screenshot action type")}b={ack:d("MAWAckLevel").ACK.sent,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWGlobals").getDependencies().generateExternalId(),msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,screenshotActionType:e},ts:a,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return{unstoredDbMedia:null,unstoredDbMsg:b,unstoredDbReaction:void 0}}function j(a){return d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){throw c("err")("Received invalid chatJid. We only support ephemeral messaging in 1:1 threads.")},user:function(a){return a}})}function k(a){a!=null&&a.messageExpirationTs!=null&&a.ephemeralCounterStarted===!0&&d("MAWIndexedDb").afterTransaction({tag:"MsgClearCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgClearCountdown(a.msgId,a.messageExpirationTs)})}g.shouldUpdateContactEphemeralSetting=a;g.shouldUpdateForOutgoingUserEphemeralSettingChange=b;g.buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder=e;g.buildUnstoredDbEphemeralScreenshotActionMsgWithoutContentPlaceholder=f;g.getUserJidForEphemeralSetting=j;g.maybeClearEphemeralMsgCountdown=k}),98);
__d("MAWExpiredXMACleaner",["MAWGating","MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startExpiredXMACleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("MAWGating").isXMAFeedPostShareEnabled()&&(d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA)))}function b(a){if(d("MAWGating").isXMAFeedPostShareEnabled())if(k==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWCastToMsgrServerMediaType",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaType: "," for castToMsgrServerMediaType method"]);h=function(){return a};return a}function a(a){switch(a){case"image":case"video":case"gif":case"sticker":return a;case"ptt":return"audio";case"xma-image":return"xma";default:d("WALogger").ERROR(h(),a);return null}}g.castToMsgrServerMediaType=a}),98);
__d("MAWMediaBackupTxns",["MAWDbMediaTxns","MAWDexieTable","MAWGating","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fbid already exists for objectId"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaId or msgId cannot differ for an objectId in mediaBackup"]);i=function(){return a};return a}function a(a,b,c,e,f){return e==null||!d("MAWGating").isMediaBackupTableEnabled()?d("MAWDexieTable").dexieResolve():d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,e).then(function(g){if(g==null){var j={mediaId:b,msgId:c,objectId:e};f!=null&&(j=babelHelpers["extends"]({},j,{fbid:f}));return a.mediaBackup.add(j).then(function(a){return babelHelpers["extends"]({},j,{mediaBackupId:a})})}else if(g.mediaId!==b||g.msgId!==c){d("WALogger").ERROR(i());return g}else{if(g.fbid==null&&f!=null){var k=babelHelpers["extends"]({},g,{fbid:f});return a.mediaBackup.put(k).then(function(a){return k})}else d("WALogger").WARN(h());return g}})}g.linkMediaBackup=a}),98);
__d("MAWMediaManagementTxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWMediaBackupTxns","WALogger","WAMediaUtils","WASortedLists","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing, can't upate media with encoded data"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing, can't upate media info"]);i=function(){return a};return a}function j(a,b,c,e,f,g,h,i,j,k,m){m===void 0&&(m=!1);return d("MAWDbMediaTxns").maybeGetMediaFromHash(a,i).then(function(n){var o=l(g,j,k);if(n){var p=o?n.mediaEntries.set(b,o):n.mediaEntries,q=babelHelpers["extends"]({},n,{mediaEntries:p,msgIds:d("WASortedLists").addToSet(n.msgIds,b)});return a.media.put(q).then(function(c){var e=d("MAWDexieTable").dexieResolve();m||(e=d("MAWDbMsgTxns").updateMediaId(a,b,c));return e.then(function(){return d("MAWMediaBackupTxns").linkMediaBackup(a,c,b,j,k).then(function(){return q})})})}else{p=new Map();o&&p.set(b,o);var r=babelHelpers["extends"]({hashedPlaintextHash:i,mediaEntries:p,mediaType:e,msgIds:d("WASortedLists").singleElement(b),plaintextHash:c,size:f,ts:d("WATimeUtils").unixTime()},h);j!=null&&(r=babelHelpers["extends"]({},r,{objectId:j}));k!=null&&(r=babelHelpers["extends"]({},r,{fbid:k}));return a.media.add(r).then(function(c){var e=d("MAWDexieTable").dexieResolve();m||(e=d("MAWDbMsgTxns").updateMediaId(a,b,c));return e.then(function(){var e=babelHelpers["extends"]({},r,{mediaId:c});return d("MAWMediaBackupTxns").linkMediaBackup(a,e.mediaId,b,j,k).then(function(){return e})})})}})}var k=function(a,b,e,f,g,h,i,k,l,m){m===void 0&&(m=!1);return d("MAWDbMsgTxns").maybeGetMsg(a,b).then(function(d){if(d==null)throw c("err")("Do not have the media message "+b+" in db when attachHashToMediaMsg");else return j(a,b,e,i,k,void 0,l,f,g,h,m)})};e=function(a,b,c){return d("MAWDbMediaTxns").maybeGetMediaFromHash(a,b).then(function(b){if(b!=null){b=babelHelpers["extends"]({},b,c);return a.media.update(b.mediaId,b).then(function(){})}else d("WALogger").WARN(i())})};f=function(a,b,c,e){return d("MAWDbMediaTxns").maybeGetMediaFromHash(a,b).then(function(b){if(b!=null){var f=e?b.mediaEntries.set(c,e):b.mediaEntries;b=babelHelpers["extends"]({},b,{mediaEntries:f});a.media.update(b.mediaId,b)}else d("WALogger").WARN(h())})};function a(a,b,c,e,f,g,h,i,j,l,m){m===void 0&&(m=!1);return d("MAWDexieTable").dexieAll([k(a,b,e,f,g,h,i,l.size,j,m),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,e,f,c,l.type)]).then(function(a){a=a[0];return a})}function l(a,b,c){var e;a=a;a!=null&&b!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedObjectId(e,b));a!=null&&c!=null&&(e=d("WAMediaUtils").decodeMediaEntryData(a),a=d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(e,c));return a}function b(a,b,c){var e=new Map();a.mediaEntries.forEach(function(a,f){var g=d("WAMediaUtils").decodeMediaEntryData(a);g=g.objectId===b?d("WAMediaUtils").encodeMediaEntryWithUpdatedFbid(g,c):a;e.set(f,g)});return e}g.linkMedia=j;g.attachHashToMediaMsg=k;g.updateMediaEntryWithValidatedMediaInfo=e;g.updateMediaWithEncodedMediaEntryData=f;g.attachHashAndSaveMedia=a;g.updateBackupFbidInMediaEntries=b}),98);
__d("MAWMsgType",["WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([d("WAMsgType").MSG_TYPE.IMAGE,d("WAMsgType").MSG_TYPE.VIDEO,d("WAMsgType").MSG_TYPE.PTT,d("WAMsgType").MSG_TYPE.GIF,d("WAMsgType").MSG_TYPE.STICKER,d("WAMsgType").MSG_TYPE.XMA]);a=function(a){return h.has(a)};g.isMAWSupportedMediaType=a}),98);
__d("MAWHandleUnstoredMediaTxns",["MAWBridgeTypes","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWDbChunkTxns","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWJidUtils","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgType","WALogger","WAMediaUtils","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing mandatory args for incoming media msg"]);h=function(){return a};return a}function a(a,b,c,e){e===void 0&&(e=!1);var f={validatedAudioInfo:b.validatedAudioInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},g=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash),i=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry),j=i.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(i.objectId):null;return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").linkMedia(a,c.msgId,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,f,g,j,void 0,e),d("MAWDbChunkTxns").hasMediaChunk(a,g)]).then(function(a){var b=a[0];a=a[1];c.type!==d("WAMsgType").MSG_TYPE.REVOKED&&!e&&d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(c.thread,b,a)});return b}).then(function(a){if(d("MAWGating").isAttachmentBackupEnabled()){var b=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(i.serverMediaType);if(d("MAWMsgType").isMAWSupportedMediaType(c.type)){var e=c.threadJid;j!=null&&b!=null&&e!=null?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(j,b,c.externalId,d("MAWGlobals").getConfig().productTypeForEBAttachments,d("MAWJidUtils").threadIdForChatJid(e))}):d("WALogger").WARN(h())}}return a})}function b(a,b,c){var e={validatedAudioInfo:b.validatedAudioInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},f=d("MAWMediaUtils").genHMACPlaintextHash(b.plaintextHash);return d("MAWMediaManagementTxns").linkMedia(a,c.msgId,b.plaintextHash,b.mediaType,b.size,b.mediaEntry,e,f).then(function(b){var d=babelHelpers["extends"]({},c,{mediaId:b.mediaId});return a.unrenderedMessages.put(d).then(function(){return b})})}g.handleUnstoredDbMedia=a;g.handleUnstoredMediaOfDeleteForMeMsg=b}),98);
__d("MAWUnsendMsgContentCleaner",["MAWGating","MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["UnsendMsgContentCleaner: Adding timestamps (",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startUnsendMsgContentCleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("MAWGating").isUnsendGlobalEnabled()&&(d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.UNSEND)))}function b(a){if(d("MAWGating").isUnsendGlobalEnabled())if(k==null){var b="Trying to add new UnsendMsgContentCleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startUnsendMsgContentCleaner=a;g.addNewUnsendMsgContentCleanerTimestamp=b;g.getUnsendMsgContentCleaner_FOR_TESTING_ONLY=e;g.resetUnsendMsgContentCleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWUpdateQuotedMsgTxns",["MAWAuthor","MAWBridgeMsg","MAWDexieTable","MAWIndexedDb","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e,f){var g=d("MAWAuthor").getAuthorUserJid(e);return a.messages.where("quoteExternalId").equals(c).toArray().then(function(c){if(c.length===0)return;c=c.filter(function(a){var c=a.quote;a=a.thread;return d("MAWAuthor").getAuthorUserJid(c==null?void 0:c.content.author)===g&&a===b});var e=c.map(function(a){var b;b=Object.assign({},(b=a.quote)==null?void 0:b.content,f.content);b=babelHelpers["extends"]({},a.quote,f,{content:b});return babelHelpers["extends"]({},a,{quote:b})});return a.messages.bulkPut(e).then(function(){return e})})},i=function(a,b,c,e,f){f===void 0&&(f=d("WAMsgType").MSG_TYPE.UNAVAILABLE);f={content:{mediaId:void 0,msgContent:void 0,type:f}};return h(a,b,c,e,f).then(function(a){if(a==null)return;a.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})};a=function(a,b,c){c===void 0&&(c=d("WAMsgType").MSG_TYPE.UNAVAILABLE);var e=b.author,f=b.chat,g=b.externalId;return a.threads.get({jid:f}).then(function(b){if(b==null)return;return i(a,b.chatId,g,e,c)})};b=function(a,b,c){var e=c.author,f=c.externalId,g=c.mediaId,i=c.msgContent,j=c.ts;c=c.type;if(!d("WAMsgType").isQuotedMsgType(c))return d("MAWDexieTable").dexieResolve();g={author:e,externalId:f,mediaId:g,msgContent:i,ts:j,type:c};return h(a,b,f,e,{content:g})};g.updateQuotedMsg=h;g.disassociateQuotedMsg=i;g.disassociateQuotedMessageByProtocolMsgId=a;g.associateQuotedMessage=b}),98);
__d("EchoMessageMediaFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: can not find attachment where x-content-type is full"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: can not parse objects ids. ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing enum fields from media fields"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] multi blob media message: primary attachment object id is null"]);m=function(){return a};return a}var n="X-Object-Id",o="X-Attachment-Object-Ids",p="Attachment-Type",q="Content-Type",r="X-Encrypted-Hash",s="X-Attachment-Type",t="X-Backup-Ent-Fbid",u="X-Backup-Status",v="X-Content-Type",w="X-Direct-Path",x="Height",y="X-Media-Key",z="X-Media-Key-Timestamp",A="Playable-Duration",B="Preview-Height",C="Preview-Content-Type",D="Preview-Width",E="Size",F="Width",G="X-Plaintext-Hash",H=(e=b("$InternalEnum"))({IMAGE:"image",STICKER:"sticker",VIDEO:"video",GIF:"animated_image",PTT:"audio",XMA:"xma"}),I=e({FULL:"full",PREVIEW:"preview"}),J=e({IMAGE_JPEG:"image/jpeg",IMAGE_PNG:"image/png",STICKER:"image/webp",GIF:"image/gif",AUDIO_MP4:"audio/mp4",AUDIO_WAV:"audio/wav",XMA:"xma"}),K=e({INVALID:"-1",IMAGE:"0",PTT:"1",AUDIO:"2",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",PROFILE_PICTURE:"7",APP_STATE:"8",HISTORY_SYNC:"9",THUMBNAIL_IMAGE:"10",THUMBNAIL_VIDEO:"11",THUMBNAIL_GIF:"12",THUMBNAIL_DOCUMENT:"13",THUMBNAIL_LINK:"14",NOVI_IMAGE:"15",NOVI_VIDEO:"16",KYCID:"17",WAFFLE_IMAGE:"18",WAFFLE_VIDEO:"19",WAFFLE_GIF:"20",PAYMENT_BG_IMAGE:"21",XMA_IMAGE:"22",PAYMENT_BR_DOCUMENT:"23",BIZ_COVER_PHOTO:"24",MESSENGER_PREVIEW:"25"});function a(a,b){d("EchoEncodingUtils").echoSetStringField(a,n,b.attachmentObjectId),d("EchoEncodingUtils").echoSetStringField(a,p,b.attachmentType),d("EchoEncodingUtils").echoSetStringField(a,G,b.plaintextHash),d("EchoEncodingUtils").echoSetStringField(a,r,b.hashedPlaintextHash),d("EchoEncodingUtils").echoSetIntField(a,E,b.size),d("EchoEncodingUtils").echoSetStringField(a,y,b.mediaKey),d("EchoEncodingUtils").echoSetIntField(a,z,b.mediaKeyTimestamp),d("EchoEncodingUtils").echoSetStringField(a,w,b.directPath),d("EchoEncodingUtils").echoSetStringField(a,q,b.mediaContentType),d("EchoEncodingUtils").echoSetIntField(a,F,b.width),d("EchoEncodingUtils").echoSetIntField(a,x,b.height),d("EchoEncodingUtils").echoSetStringField(a,C,b.previewContentType),d("EchoEncodingUtils").echoSetIntField(a,D,b.previewContentWidth),d("EchoEncodingUtils").echoSetIntField(a,B,b.previewContentHeight),d("EchoEncodingUtils").echoSetIntField(a,A,b.mediaPlayableDuration),b.xAttachmentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,s,b.xAttachmentType),d("EchoEncodingUtils").echoSetStringField(a,v,b.xContentType),d("EchoEncodingUtils").echoSetStringField(a,t,b.backupEntFbid),d("EchoEncodingUtils").echoSetStringField(a,u,b.mediaBackupStatus)}function c(a){var b={},c=!1,e=!1;if(P(a)){var f=Q(a);if(f==null){d("WALogger").ERROR(m());return null}c=N(a,b,f);e=M(a,b,f);f=L(a,b,f)}else c=N(a,b),e=M(a,b),f=L(a,b);if(!c||!e||!f)return null;b;return b}function L(a,b,c){c=[{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO],fieldName:"height",id:x},{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO],fieldName:"width",id:F},{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO,K.AUDIO],fieldName:"mediaKeyTimestamp",id:c!=null?c+"-"+z:z},{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO,K.AUDIO],fieldName:"previewContentHeight",id:B},{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO,K.AUDIO],fieldName:"previewContentWidth",id:D},{attachmentTypes:[K.VIDEO,K.AUDIO],fieldName:"mediaPlayableDuration",id:A},{attachmentTypes:[K.IMAGE,K.GIF,K.STICKER,K.VIDEO,K.AUDIO],fieldName:"size",id:E}];for(var e=0;e<c.length;e++){var f=c[e],g=f.attachmentTypes,h=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var i=f.result;f=f.success;if(f&&i!=null)b[h]=i;else if(!!O(g,b.xAttachmentType)){d("WALogger").ERROR(l(),h);return!1}}return!0}function M(a,b,c){var e;c!=null?(b.attachmentObjectId=c,e=[{fieldName:"hashedPlaintextHash",id:c+"-"+r},{fieldName:"mediaKey",id:c+"-"+y},{fieldName:"plaintextHash",id:c+"-"+G},{fieldName:"directPath",id:c+"-"+w},{fieldName:"mediaContentType",id:q},{fieldName:"xContentType",id:c+"-"+v},{fieldName:"mediaBackupStatus",id:c+"-"+u}],c=c+"-"+t):(e=[{fieldName:"hashedPlaintextHash",id:r},{fieldName:"mediaKey",id:y},{fieldName:"attachmentObjectId",id:n},{fieldName:"plaintextHash",id:G},{fieldName:"directPath",id:w},{fieldName:"mediaContentType",id:q},{fieldName:"xContentType",id:v},{fieldName:"mediaBackupStatus",id:u}],c=t);for(var e=e,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;var i=h.fieldName;h=h.id;h=d("EchoDecodingUtils").echoDecodeStringField(a,h);var j=h.result;h=h.success;if(h&&j!=null)b[i]=j;else{d("WALogger").ERROR(k(),i);return!1}}h=d("EchoDecodingUtils").echoDecodeStringField(a,c);j=h.result;i=h.success;i&&j!=null&&(b.backupEntFbid=j);return!0}function N(a,b,c){var e=d("EchoDecodingUtils").echoDecodeStringField(a,p);e=H.cast(e.result);var f=d("EchoDecodingUtils").echoDecodeStringField(a,C);f=J.cast(f.result);a=d("EchoDecodingUtils").echoDecodeStringField(a,c!=null?c+"-"+s:s);a.success&&a.result!=null&&(c=R(a.result),c!=null&&(b.xAttachmentType=c));if(e!=null&&f!=null){b.attachmentType=e;b.previewContentType=f;return!0}d("WALogger").ERROR(j());return!1}function O(a,b){return a.reduce(function(a,c){return a||c===b},!1)}function P(a){return a.has(o)}function Q(a){var b=d("EchoDecodingUtils").echoDecodeObjectIdListField(a,o),c=b.result;b=b.success;if(!b||c==null||c.length===0){d("WALogger").ERROR(i(),c);return null}b=c.find(function(b){b=b+"-"+v;b=d("EchoDecodingUtils").echoDecodeStringField(a,b);var c=b.result;b=b.success;if(b&&c!=null&&I.cast(c)===I.FULL)return!0});if(b==null){d("WALogger").ERROR(h());return null}return b}function R(a){a=K.cast(a);return(a=a)!=null?a:K.INVALID}g.AttachmentType=H;g.EchoMessageMediaPreviewType=J;g.EchoMessageActMediaAttachmentType=K;g.echoMessageSetMediaMetadataFields=a;g.echoMessageDecodeMediaDataFields=c}),98);
__d("EchoMessageQuoteFieldUtils",["EchoDecodingUtils","EchoEncodingUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Reply-Message-Id",i="Reply-Message-Sender",j="Reply-Sort-Order";function a(a){var b={},c=k(a,b),d=l(a,b);a=m(a,b);if(!c||!d||!a)return null;b;return b}function b(a,b){b=b.quoteData;if(b==null)return;d("EchoEncodingUtils").echoSetStringField(a,h,b.quoteMessageId);d("EchoEncodingUtils").echoSetAddressField(a,i,b.quoteMessageSender);d("EchoEncodingUtils").echoSetIntField(a,j,b.quoteSortOrderInMs)}function k(a,b){var c=[{fieldName:"quoteMessageSender",id:i}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeAddressField(a,f);var h=f.result;f=f.success;if(f&&h!=null)b[g]=h;else return!1}return!0}function l(a,b){var c=[{fieldName:"quoteMessageId",id:h}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeStringField(a,f);var i=f.result;f=f.success;if(f&&i!=null)b[g]=i;else return!1}return!0}function m(a,b){var c=[{fieldName:"quoteSortOrderInMs",id:j}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var h=f.result;f=f.success;if(f&&h!=null)b[g]=h;else return!1}return!0}g.echoMessageDecodeQuoteFields=a;g.echoMessageSetQuoteFields=b}),98);
__d("EchoMessageReceiptStatusFieldUtils",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error occurred while decoding participants from echo doc, error: ",""]);h=function(){return a};return a}var i="Receipt-Status",j="Receipt-Timestamp",k=b("$InternalEnum")({UNKNOWN:"unknown",SENDING:"sending",SERVER_RECEIVED:"server_received",DELIVERED:"delivered",READ:"read",ERROR:"error",NON_RETRYABLE_ERROR:"non_retryable_error"});function a(a,b){if(b==null||b.length===0)return;b.forEach(function(b){d("EchoEncodingUtils").echoSetStringField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,i),b.status),b.timestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(b.address,j),b.timestampMs)})}function c(a){var b=[];l(a).forEach(function(c){var e=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,i);e=d("EchoDecodingUtils").echoDecodeStringField(a,e);if(e.success){e=(e=k.cast(e.result))!=null?e:k.UNKNOWN;var f=d("EchoCommonUtils").getEchoAddressFieldNameWithSuffix(c,j);f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,f);f.result!=null?b.push({address:c,status:e,timestampMs:f.result}):b.push({address:c,status:e})}});return b}function l(a){var b=new Set();for(var a=a.keys(),c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(f.includes(i))try{f=f.split("@");var g=f[0];f=m(f[1]);b.add({localKey:g,transportKey:f})}catch(a){d("WALogger").ERROR(h(),a)}}return Array.from(b)}function m(a){a=a.split(i);return a[0].split("-")[0]}g.MessageReceiptStatus=k;g.echoMessageSetReceiptStatusDataFields=a;g.echoMessageDecodeReceiptStatusDataFields=c}),98);
__d("EchoMessageXMAFieldUtils",["$InternalEnum","EchoDecodingUtils","EchoEncodingUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from xma fields"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Missing "," from media fields"]);k=function(){return a};return a}var l="XMA-Default-CTA",m="XMA-Gating-Type",n="XMA-Header-Subtitle",o="XMA-Header-Title",p="XMA-Is-Tombstoned",q="XMA-Layout-Type",r="XMA-Max-Subtitle-Num-Lines",s="XMA-Max-Title-Num-Lines",t="XMA-Subtitle-Text",u="XMA-Target-Expiry",v="XMA-Target-ID",w="XMA-Target-Type",x="XMA-Target-Username",y="XMA-Title-Text",z=b("$InternalEnum").Mirrored(["SINGLE","HSCROLL","VSTACK","PORTRAIT"]),A=b("$InternalEnum").Mirrored(["NONE","IG_STORY_PHOTO_MENTION","IG_SINGLE_IMAGE_POST_SHARE","IG_MULTIPOST_SHARE","IG_SINGLE_VIDEO_POST_SHARE","IG_STORY_PHOTO_SHARE","IG_STORY_VIDEO_SHARE","IG_CLIPS_SHARE","IG_IGTV_SHARE","IG_SHOP_SHARE","IG_PROFILE_SHARE","IG_STORY_PHOTO_HIGHLIGHT_SHARE","IG_STORY_VIDEO_HIGHLIGHT_SHARE","IG_STORY_REPLY","IG_STORY_REACTION","FB_FEED_SHARE","FB_STORY_REPLY","FB_STORY_SHARE","FB_STORY_MENTION","FB_FEED_VIDEO_SHARE","FB_GAMING_CUSTOM_UPDATE","FB_PRODUCER_STORY_REPLY","MSG_EXTERNAL_LINK_SHARE","RTC_AUDIO_CALL","RTC_VIDEO_CALL","RTC_MISSED_AUDIO_CALL","RTC_MISSED_VIDEO_CALL","RTC_GROUP_AUDIO_CALL","RTC_GROUP_VIDEO_CALL"]),B=b("$InternalEnum").Mirrored(["NONE","PRIVATE","SENSITIVE","MISINFORMATION","MEDIA_LABEL","POST_COVER","POST_LABEL","WARNING_SCREENS","INFO","EYE_OFF","NEWS_OFF","WARNING"]);function a(a,b){b.xmaLayoutType!=null&&d("EchoEncodingUtils").echoSetStringField(a,q,b.xmaLayoutType),b.xmaTargetType!=null&&d("EchoEncodingUtils").echoSetStringField(a,w,b.xmaTargetType),d("EchoEncodingUtils").echoSetStringField(a,x,b.xmaTargetUsername),d("EchoEncodingUtils").echoSetStringField(a,v,b.xmaTargetId),b.xmaTargetExpiry!=null&&d("EchoEncodingUtils").echoSetIntField(a,u,b.xmaTargetExpiry),d("EchoEncodingUtils").echoSetStringField(a,l,b.xmaDefaultCTA),d("EchoEncodingUtils").echoSetStringField(a,o,b.xmaHeaderTitle),d("EchoEncodingUtils").echoSetStringField(a,n,b.xmaHeaderSubtitle),d("EchoEncodingUtils").echoSetStringField(a,y,b.xmaTitleText),d("EchoEncodingUtils").echoSetStringField(a,t,b.xmaSubtitleText),b.xmaMaxTitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,s,b.xmaMaxTitleNumLines),b.xmaMaxSubtitleNumLines!=null&&d("EchoEncodingUtils").echoSetIntField(a,r,b.xmaMaxSubtitleNumLines),b.xmaGatingType!=null&&d("EchoEncodingUtils").echoSetStringField(a,m,b.xmaGatingType),d("EchoEncodingUtils").echoSetBooleanField(a,p,b.xmaIsTombstoned)}function c(a){var b={},c=C(a,b),d=D(a,b),e=E(a,b);a=F(a,b);if(!c||!d||!e||!a)return null;b;return b}function C(a,b){var c=d("EchoDecodingUtils").echoDecodeStringField(a,q);c=z.cast(c.result);c!=null&&(b.xmaLayoutType=c);c=d("EchoDecodingUtils").echoDecodeStringField(a,w);c=A.cast(c.result);c!=null&&(b.xmaTargetType=c);c=d("EchoDecodingUtils").echoDecodeStringField(a,m);a=B.cast(c.result);a!=null&&(b.xmaGatingType=a);return!0}function D(a,b){var c=[{fieldName:"xmaTargetUsername",id:x},{fieldName:"xmaTargetId",id:v},{fieldName:"xmaDefaultCTA",id:l},{fieldName:"xmaHeaderTitle",id:o},{fieldName:"xmaHeaderSubtitle",id:n},{fieldName:"xmaTitleText",id:y},{fieldName:"xmaSubtitleText",id:t}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeStringField(a,f);var h=f.result;f=f.success;f&&h!=null?b[g]=h:d("WALogger").WARN(k(),g)}return!0}function E(a,b){var c=[{fieldName:"xmaTargetExpiry",id:u},{fieldName:"xmaMaxTitleNumLines",id:s},{fieldName:"xmaMaxSubtitleNumLines",id:r}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;f=d("EchoDecodingUtils").echoDecodeIntField(a,f);var h=f.result;f=f.success;f&&h!=null?b[g]=h:d("WALogger").WARN(j(),g)}return!0}function F(a,b){var c=[{fieldName:"xmaIsTombstoned",id:p}];for(var e=0;e<c.length;e++){var f=c[e],g=f.fieldName;f=f.id;var j=d("EchoDecodingUtils").echoDecodeBooleanField(a,f),k=j.result;j=j.success;if(j&&k!=null)b[g]=k;else{if(f===p){d("WALogger").ERROR(i(),g);return!1}d("WALogger").WARN(h(),g)}}return!0}g.XMALayoutType=z;g.XMAContentType=A;g.XMAGatingType=B;g.echoMessageSetXMAFields=a;g.decodeXMAFields=c}),98);
__d("EchoMessage",["$InternalEnum","EchoCommonUtils","EchoDecodingUtils","EchoEncodingUtils","EchoMessageMediaFieldUtils","EchoMessageQuoteFieldUtils","EchoMessageReceiptStatusFieldUtils","EchoMessageXMAFieldUtils","FBLogger","MAWGating","WALogger","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory xma data is missing from xma message, msgId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] You might want to enable enable_encrypted_backups_attachments when messages are of type attachment"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory media data is missing from media message, msgId: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] fieldsMap is empty for the echo message"]);k=function(){return a};return a}var l="Message-ID",m="Thread-ID",n="Sort-Order",o="Display-Timestamp",p="Authoritative-Timestamp",q="From",r="Text",s="Text-Size",t="Send-Error",u="Is-Tombstoned",v="Expire-Timestamp",w="Delete-Timestamp",x="Ephemeral-Duration",y="Message-Content-Type",z="Message-Content-Subtype",A="Is-Forwarded",B="X-Offline-Threading-ID",C="X-Thread-ID",D="X-Message-Placeholder-Type",E="Reactions",F="Reaction-Authoritative-Timestamps",G="X-Reaction-Offline-Threading-IDs",H="Echo-Serialization-Origin",I="Revoke-Sent-Timestamp",J="Revoke-Unsent-Timestamp",K=1,L=(f=b("$InternalEnum"))({NONE:"none",SMALL:"small",MEDIUM:"medium",LARGE:"large"}),M=f({NONE:"none",UNSEND:"unsend"}),N=f({DECRYPTION_FAILURE:"decryption_failure",UNSUPPORTED_NEEDS_UPDATE:"unsupported_needs_update",TEXT:"text",ADMIN_MESSAGE:"admin_message",MEDIA:"media",XMA:"xma",NULL_STATE:"null_state",PLACEHOLDER:"placeholder"}),O=f({NO_PLACEHOLDER:"0",DECRYPTION_FAILURE:"-1",CLIENT_NOT_SUPPORTED_NEED_UPDATE:"-2",UNAVIALABLE_DEVICE:"-3"}),P=f({UNKNOWN:"Unknown",WEB:"Web",MOBILE:"Mobile"});function a(a){var b=new Map();V(b,a);"mediaData"in a&&a.mediaData&&d("EchoMessageMediaFieldUtils").echoMessageSetMediaMetadataFields(b,a.mediaData);return d("EchoEncodingUtils").echoEncodeFields(b)}function e(a){a=d("EchoDecodingUtils").echoDecodeFields(a);if(a.size===0){d("WALogger").ERROR(k());return null}var b=d("EchoDecodingUtils").echoDecodeStringField(a,l),e=d("EchoDecodingUtils").echoDecodeStringField(a,m),f=d("EchoDecodingUtils").echoDecodeIntField(a,n),g=d("EchoDecodingUtils").echoDecodeIntField(a,o),L=d("EchoDecodingUtils").echoDecodeStringField(a,y),O=d("EchoDecodingUtils").echoDecodeStringField(a,z);if(b.success&&e.success&&f.success&&g.success){if(b.result==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded messageId cannot be null");if(e.result==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded threadId cannot be null");if(L.result==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("The decoded contentTypeString cannot be null");b={messageId:b.result,threadId:e.result,sortOrderMs:f.result,displayTimestampMs:g.result,contentType:R(L.result),contentSubtype:S(O.result)};e=d("EchoDecodingUtils").echoDecodeAddressField(a,q);e.success&&e.result!=null&&(b.from=e.result);f=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,u);f.success&&f.result!=null&&(b.isTombstoned=f.result);g=d("EchoDecodingUtils").echoDecodeStringField(a,r);g.success&&g.result!=null&&(b.text=g.result);L=d("EchoDecodingUtils").echoDecodeStringField(a,s);if(L.success&&L.result!=null){O=Q(L.result);b.textSize=O}e=d("EchoDecodingUtils").echoDecodeStringField(a,D);if(e.success&&e.result!=null){f=T(e.result);b.xMessagePlaceholderType=f}g=d("EchoDecodingUtils").echoDecodeStringField(a,t);g.success&&g.result!=null&&(b.sendError=g.result);L=d("EchoDecodingUtils").echoDecodeNullableIntField(a,v);L.success&&L.result!=null&&(b.expireTimestampMs=L.result);O=d("EchoDecodingUtils").echoDecodeNullableIntField(a,w);O.success&&O.result!=null&&(b.deleteTimestampMs=O.result);e=d("EchoDecodingUtils").echoDecodeNullableIntField(a,x);e.success&&e.result!=null&&(b.ephemeralDurationInSec=e.result);f=d("EchoDecodingUtils").echoDecodeNullableIntField(a,p);f.success&&f.result!=null&&(b.authoritativeTimestampMs=f.result);g=d("EchoMessageReceiptStatusFieldUtils").echoMessageDecodeReceiptStatusDataFields(a);g.length>0&&(b.receiptStatusList=g);L=d("EchoDecodingUtils").echoDecodeNullableBooleanField(a,A);L.success&&L.result!=null&&(b.isForwarded=L.result);O=d("EchoDecodingUtils").echoDecodeStringField(a,B);O.success&&O.result!=null&&(b.xOfflineThreadingId=O.result);e=d("EchoDecodingUtils").echoDecodeStringField(a,C);e.success&&e.result!=null&&(b.xThreadId=e.result);f=d("EchoDecodingUtils").echoDecodeStringField(a,H);f.success&&f.result!=null&&(b.serializationOrigin=U(f.result));g=d("EchoDecodingUtils").echoDecodeNullableIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION);b.version=g.success&&g.result!=null?g.result:K;L=d("EchoDecodingUtils").echoDecodeAddressListField(a,E);L.success&&L.result!=null&&(b.reactions=L.result);O=d("EchoDecodingUtils").echoDecodeAddressListField(a,F);O.success&&O.result!=null&&(b.reactionAuthoritativeTimestampMs=O.result);e=d("EchoDecodingUtils").echoDecodeAddressListField(a,G);e.success&&e.result!=null&&(b.reactionXOfflineThreadingIds=e.result);f=d("EchoMessageQuoteFieldUtils").echoMessageDecodeQuoteFields(a);f!=null&&(b.quoteData=f);if((b==null?void 0:b.contentType)===N.MEDIA||(b==null?void 0:b.contentType)===N.XMA)if(c("qex")._("1763")){g=d("EchoMessageMediaFieldUtils").echoMessageDecodeMediaDataFields(a);g!=null?b.mediaData=g:d("WALogger").ERROR(j(),b.messageId)}else d("WALogger").WARN(i());if(b.contentType===N.PLACEHOLDER&&b.contentSubtype===M.UNSEND){L=d("EchoDecodingUtils").echoDecodeNullableIntField(a,I);L.success&&L.result!=null&&(b.revokeSentTimestampMs=L.result);O=d("EchoDecodingUtils").echoDecodeNullableIntField(a,J);O.success&&O.result!=null&&(b.revokeUnsentTimestampMS=O.result)}if(b.contentType===N.XMA&&d("MAWGating").isXMABackupEnabled()){e=d("EchoMessageXMAFieldUtils").decodeXMAFields(a);if(e!=null)b.xmaData=e;else{d("WALogger").ERROR(h(),b.messageId);return null}}return b}else return null}function Q(a){return(a=L.cast(a))!=null?a:L.NONE}function R(a){return(a=N.cast(a))!=null?a:N.TEXT}function S(a){return(a=M.cast(a))!=null?a:M.NONE}function T(a){return(a=O.cast(a))!=null?a:O.NO_PLACEHOLDER}function U(a){return(a=P.cast(a))!=null?a:P.UNKNOWN}function V(a,b){d("EchoEncodingUtils").echoSetStringField(a,l,b.messageId);d("EchoEncodingUtils").echoSetStringField(a,m,b.threadId);d("EchoEncodingUtils").echoSetIntField(a,n,b.sortOrderMs);d("EchoEncodingUtils").echoSetIntField(a,o,b.displayTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,p,b.authoritativeTimestampMs);d("EchoEncodingUtils").echoSetAddressField(a,q,b.from);d("EchoEncodingUtils").echoSetStringField(a,r,b.text);b.textSize!=null&&d("EchoEncodingUtils").echoSetStringField(a,s,b.textSize);b.xMessagePlaceholderType!=null&&d("EchoEncodingUtils").echoSetStringField(a,D,b.xMessagePlaceholderType);d("EchoEncodingUtils").echoSetStringField(a,t,b.sendError);d("EchoEncodingUtils").echoSetBooleanField(a,u,b.isTombstoned);d("EchoEncodingUtils").echoSetIntField(a,v,b.expireTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,w,b.deleteTimestampMs);d("EchoEncodingUtils").echoSetIntField(a,x,b.ephemeralDurationInSec);b.contentType!=null&&d("EchoEncodingUtils").echoSetStringField(a,y,b.contentType);d("EchoMessageReceiptStatusFieldUtils").echoMessageSetReceiptStatusDataFields(a,b.receiptStatusList);d("EchoEncodingUtils").echoSetBooleanField(a,A,b.isForwarded);d("EchoEncodingUtils").echoSetStringField(a,B,b.xOfflineThreadingId);d("EchoEncodingUtils").echoSetStringField(a,C,b.xThreadId);d("EchoEncodingUtils").echoSetIntField(a,d("EchoCommonUtils").ECHO_COMMON_FIELD_DOCUMENT_VERSION,b.version);b.contentSubtype!=null&&d("EchoEncodingUtils").echoSetStringField(a,z,b.contentSubtype);d("EchoEncodingUtils").echoSetAddressListField(a,E,b.reactions);d("EchoEncodingUtils").echoSetAddressListField(a,F,b.reactionAuthoritativeTimestampMs);d("EchoEncodingUtils").echoSetAddressListField(a,G,b.reactionXOfflineThreadingIds);d("EchoMessageQuoteFieldUtils").echoMessageSetQuoteFields(a,b);b.serializationOrigin!=null&&d("EchoEncodingUtils").echoSetStringField(a,H,b.serializationOrigin);b.revokeSentTimestampMs!=null&&d("EchoEncodingUtils").echoSetIntField(a,I,b.revokeSentTimestampMs);b.revokeUnsentTimestampMS!=null&&d("EchoEncodingUtils").echoSetIntField(a,J,b.revokeUnsentTimestampMS);b=b.xmaData;b!=null&&d("EchoMessageXMAFieldUtils").echoMessageSetXMAFields(a,b)}g.ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION=K;g.MessageTextSize=L;g.EchoMessageContentSubtype=M;g.EchoMessageContentType=N;g.EchoMessagePlaceholderType=O;g.EchoSerializationOriginType=P;g.encodeEchoMessage=a;g.decodeEchoMessage=e}),98);
__d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentOverlayIconGlyph: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO:return d("EchoMessageXMAFieldUtils").XMAGatingType.INFO;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF:return d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING:return d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE:return d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE:return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAGatingType.NONE}}g.convertExtendedContentOverlayIconGlyphToXMAGatingType=a}),98);
__d("MAWConvertExtendedContentTargetTypeToXMATargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentTargetType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:return d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:return d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMAContentType.NONE}}g.convertExtendedContentTargetTypeToXMATargetType=a}),98);
__d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid ExtendedContentXMLLayoutType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE:return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT:return d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT;default:d("WALogger").ERROR(h(),a);return d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE}}g.convertExtendedContentXMLLayoutTypeToXMALayoutType=a}),98);
__d("MAWGetAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid AttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").AttachmentType.PTT;case"gif":return d("EchoMessageMediaFieldUtils").AttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").AttachmentType.STICKER;case"xma-image":return d("EchoMessageMediaFieldUtils").AttachmentType.XMA;default:d("WALogger").WARN(h(),a);return null}}g.getAttachmentTypeForServerMediaType=a}),98);
__d("MAWGetMediaAttachmentTypeForServerMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid EchoMessageActMediaAttachmentType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.IMAGE;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.VIDEO;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.STICKER;case"audio":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.AUDIO;case"document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.DOCUMENT;case"ppic":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.PROFILE_PICTURE;case"md-app-state":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.APP_STATE;case"md-msg-hist":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.HISTORY_SYNC;case"thumbnail-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_IMAGE;case"thumbnail-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_VIDEO;case"thumbnail-gif":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_GIF;case"thumbnail-document":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_DOCUMENT;case"thumbnail-link":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.THUMBNAIL_LINK;case"novi-video":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_VIDEO;case"novi-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.NOVI_IMAGE;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageActMediaAttachmentType.XMA_IMAGE;default:d("WALogger").ERROR(h(),a);return null}}g.getMediaAttachmentTypeForServerMediaType=a}),98);
__d("MAWGetPreviewContentTypeForMediaType",["EchoMessageMediaFieldUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid EchoMessageMediaPreviewType: ",""]);h=function(){return a};return a}function a(a){switch(a){case"image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;case"gif":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.GIF;case"sticker":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.STICKER;case"video":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_MP4;case"ptt":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.AUDIO_WAV;case"xma-image":return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG;default:d("WALogger").ERROR(h(),a);return d("EchoMessageMediaFieldUtils").EchoMessageMediaPreviewType.IMAGE_JPEG}}g.getPreviewContentTypeForMediaType=a}),98);
__d("MAWUploadMessageTxns",["EchoCommonUtils","EchoEncodingUtils","EchoMessage","EchoMessageReceiptStatusFieldUtils","LSDataTraceCheckPoint.re","MAWBridgeEventTransmitter","MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType","MAWConvertExtendedContentTargetTypeToXMATargetType","MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType","MAWDbContactsTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWGating","MAWGetAttachmentTypeForServerMediaType","MAWGetMediaAttachmentTypeForServerMediaType","MAWGetPreviewContentTypeForMediaType","MAWGlobals","MAWJidUtils","MAWJids","MAWMsgType","MAWTraceUtils","MAWUploadMessagesBackup","MAWVault","WAArmadilloXMA.pb","WAJids","WALogger","WAMediaUtils","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(a,b,e){return a.threads.get(b).then(function(a){if(a==null){e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadThreadNotPresent,[],!1);throw c("err")("constructEchoMessage: thread not present")}e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadThreadPresent,[],!1);return a.jid})}function j(a,b,e,f){return a.receipts.get(b.msgId).then(function(g){var h=[];g!=null&&g.statusTsPerUser.forEach(function(c,f){h.push(d("MAWDbContactsTxns").maybeGetContactName(a,f).then(function(a){var g=d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.UNKNOWN,h;f===e?(g=d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.READ,h=b.ts):c.readTs!=null?(g=d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.READ,h=c.readTs):c.deliveredTs!=null&&(g=d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.DELIVERED,h=c.deliveredTs);a={address:d("EchoCommonUtils").craftEchoAddress(a,d("MAWJids").userIdFromJid(f),"AdvancedCrypto"),status:g};h!=null&&(a.timestampMs=h*1e3);return a}))});d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetReceiptStatusListSuccessful,[],!1);return d("MAWDexieTable").dexieAll(h)})}var k="You unsent a message";function l(a){switch(a.specialTextSize){case 1:return d("EchoMessage").MessageTextSize.SMALL;case 2:return d("EchoMessage").MessageTextSize.MEDIUM;case 3:return d("EchoMessage").MessageTextSize.LARGE;default:return d("EchoMessage").MessageTextSize.NONE}}function m(a,b,e){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(b){if((b==null?void 0:b.previewMediaIds)==null||b.previewMediaIds.length===0){d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadXmaNotFoundInIdb,[],!1);return d("MAWDexieTable").dexieResolve({echoMessage:null,maybeErrorDetail:{errorMsg:"constructEchoMessage: XMA not found in IndexedDB",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}})}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.previewMediaIds[0]).then(function(a){if(a==null){d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadMediaNotFoundForXmaInIdb,[],!1);return d("MAWDexieTable").dexieResolve({echoMessage:null,maybeErrorDetail:{errorMsg:"constructEchoMessage: DbMedia is null for the XMA message",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}})}return a.fbid==null?d("MAWDexieTable").dexieResolve({echoMessage:null,maybeErrorDetail:{errorMsg:"constructEchoMessage: fbid is null for the XMA message",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}}):p(b,e)})})}function a(a,b,e,f){if(b.type!==d("WAMsgType").MSG_TYPE.TEXT&&b.type!==d("WAMsgType").MSG_TYPE.REVOKED&&b.type!==d("WAMsgType").MSG_TYPE.XMA&&!d("MAWMsgType").isMAWSupportedMediaType(b.type))return d("MAWDexieTable").dexieResolve({echoMessage:null,externalId:b.externalId,maybeErrorDetail:{errorMsg:'constructEchoMessage: "'+String(b.type)+'" NYI',uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}});if(b.type===d("WAMsgType").MSG_TYPE.XMA&&!d("MAWGating").isXMABackupEnabled())return d("MAWDexieTable").dexieResolve({echoMessage:null,externalId:b.externalId,maybeErrorDetail:{errorMsg:'constructEchoMessage: "'+String(b.type)+'" is XMA but user is not enabled for XMA QE param',uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN}});var g=b.threadJid!=null?d("MAWDexieTable").dexieResolve(b.threadJid):i(a,b.thread,e),p=s(b,e),q=p.senderId;p=p.senderJid;var r=d("MAWDbContactsTxns").maybeGetContactName(a,p,e);p=j(a,b,p,e);var v={mediaMetadata:null},w;try{w=d("MAWDbMsg").isMediaMsg(b)||b.type===d("WAMsgType").MSG_TYPE.XMA}catch(a){var x="[labyrinth_web] Invalid msg type for isMediaMsg check: "+a;d("WALogger").ERROR(h(),x);v.maybeErrorDetail={errorMsg:x,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};w=!1}x=w?n(a,b,e):d("MAWDexieTable").dexieResolve(v);w=o(a,b);v=b.quote!=null?u(a,b.quote,b.thread,g,f,e):d("MAWDexieTable").dexieResolve();e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetQuoteMsgSuccessful,[],!1);f=b.quote!=null?t(a,v,e):d("MAWDexieTable").dexieResolve();e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetQuoteSenderNameSuccessful,[],!1);a=!d("MAWGating").isXMABackupEnabled()||!d("MAWDbMsg").isXMAMsg(b)?d("MAWDexieTable").dexieResolve(null):m(a,b,e);return d("MAWDexieTable").dexieAll([g,r,p,x,w,v,f,a]).then(function(a){var f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],m=a[5],n=a[6];a=a[7];f=d("MAWJidUtils").threadIdForChatJid(f);var o=b.serverTs;o={authoritativeTimestampMs:o!=null?o*1e3:void 0,contentSubtype:d("EchoMessage").EchoMessageContentSubtype.NONE,contentType:d("EchoMessage").EchoMessageContentType.TEXT,displayTimestampMs:b.ts*1e3,from:d("EchoCommonUtils").craftEchoAddress(g,q,"AdvancedCrypto"),isForwarded:b.isForwarded,messageId:b.externalId,receiptStatusList:h,serializationOrigin:d("EchoMessage").EchoSerializationOriginType.WEB,sortOrderMs:d("MAWDbMsg").getSortOrderWithFallback(b),textSize:l(b),threadId:f,version:d("EchoMessage").ECHO_MESSAGE_MIGRATION_DOCUMENT_VERSION,xMessagePlaceholderType:d("EchoMessage").EchoMessagePlaceholderType.NO_PLACEHOLDER,xOfflineThreadingId:b.externalId,xThreadId:f};b.type===d("WAMsgType").MSG_TYPE.TEXT?o=babelHelpers["extends"]({},o,{text:d("MAWVault").unvault(b.msgContent.content)}):b.type===d("WAMsgType").MSG_TYPE.REVOKED&&(o.contentType=d("EchoMessage").EchoMessageContentType.PLACEHOLDER,o.contentSubtype=d("EchoMessage").EchoMessageContentSubtype.UNSEND,o.revokeSentTimestampMs=b.originalTs,o.revokeUnsentTimestampMS=b.unsendMsgContentDeleteTs,o.text=k);if(m!=null){g=s(m);h=g.senderId;f=d("EchoCommonUtils").craftEchoAddress(n,h,"AdvancedCrypto");m.sortOrderMs!=null&&(o.quoteData={quoteMessageId:m.externalId,quoteMessageSender:f,quoteSortOrderInMs:m.sortOrderMs})}if(d("MAWMsgType").isMAWSupportedMediaType(b.type)){g=i.mediaMetadata;if(g!=null)o=babelHelpers["extends"]({},o,{contentType:d("EchoMessage").EchoMessageContentType.MEDIA,mediaData:g});else{e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadMissingMediaDataForMediaMsg,[],!1);return{echoMessage:o,externalId:b.externalId,maybeErrorDetail:i.maybeErrorDetail}}}if(a!=null&&a.xmaData!=null&&b.type===d("WAMsgType").MSG_TYPE.XMA)o.xmaData=a.xmaData,o.contentType=d("EchoMessage").EchoMessageContentType.XMA;else if(a!=null&&a.xmaData==null&&b.type===d("WAMsgType").MSG_TYPE.XMA){e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadXmaDataIsNull,[],!1);return{echoMessage:o,externalId:b.externalId,maybeErrorDetail:a.maybeErrorDetail}}e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadEchoMessageCreationSuccessful,[],!1);return{echoMessage:babelHelpers["extends"]({},o,j),externalId:b.externalId}})}function n(a,b,e){var f={mediaMetadata:null};if(b.type===d("WAMsgType").MSG_TYPE.XMA)return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId)).then(function(b){if(b!=null)return q(a,b);else{f.maybeErrorDetail={errorMsg:"[labyrinth_web] Media meta data couldn't be created for XMA",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(f)}});if(!d("MAWMsgType").isMAWSupportedMediaType(b.type)){e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadUnsupportedMediaType,[],!1);f.maybeErrorDetail={errorMsg:"[labyrinth_web] Media type is not supported for msg, type: "+b.type,uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.WARN};return d("MAWDexieTable").dexieResolve(f)}if(b.mediaId==null){e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadNoMediaIdFoundInMediaMsg,[],!1);f.maybeErrorDetail={errorMsg:"[labyrinth_web] No media id found in a media msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(f)}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.mediaId).then(function(g){if(!g){e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadNoMediaEntryForMediaId,[],!1);f.maybeErrorDetail={errorMsg:"[labyrinth_web] No media db entry for media id",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(f)}var h=d("MAWGating").isMediaBackupTableEnabled()?d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,b.msgId):d("MAWDexieTable").dexieResolve();return h.then(function(a){return d("MAWDexieTable").dexieResolve(r(b.msgId,g,!1,a))})})}function o(a,b,e){return d("MAWDbReactionsTxns").getReactionsFromMessage(a,b.msgId).then(function(a){if(a!=null&&a.length>0){var b=d("WAJids").extractUserId(d("MAWGlobals").getMyUserJid()),f=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.reaction,c,"AdvancedCrypto")}),g=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress((a.ts*1e3).toString(),c,"AdvancedCrypto")});a=a.map(function(a){var c=d("WAJids").authorToUserId(a.author,b);return d("EchoCommonUtils").craftEchoAddress(a.externalId.toString(),c,"AdvancedCrypto")});e!=null&&d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetReactionDataSuccessful,[],!1);return{reactionAuthoritativeTimestampMs:g,reactions:f,reactionXOfflineThreadingIds:a}}})}function p(a,b){var e={mediaMetadata:null,xmaData:null};if(a.isTombstoned==null){e.maybeErrorDetail={errorMsg:"[labyrinth_web] no isTombstoned to construct XMAData",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return e}var f={xmaHeaderSubtitle:a.overlayTitle,xmaHeaderTitle:a.headerTitle,xmaIsTombstoned:a.isTombstoned,xmaMaxSubtitleNumLines:a.maxSubtitleNumOfLines,xmaMaxTitleNumLines:a.maxTitleNumOfLines,xmaSubtitleText:a.subtitleText,xmaTargetExpiry:a.targetExpiringAtSec,xmaTargetId:a.targetId,xmaTargetUsername:a.targetUsername,xmaTitleText:a.titleText},g=a.xmaLayoutType||d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;f=babelHelpers["extends"]({},f,{xmaLayoutType:d("MAWConvertExtendedContentXMLLayoutTypeToXMALayoutType").convertExtendedContentXMLLayoutTypeToXMALayoutType(g)});a.targetType!=null&&(f=babelHelpers["extends"]({},f,{xmaTargetType:d("MAWConvertExtendedContentTargetTypeToXMATargetType").convertExtendedContentTargetTypeToXMATargetType(a.targetType)}));a.overlayIconGlyph!=null&&(f=babelHelpers["extends"]({},f,{xmaGatingType:d("MAWConvertExtendedContentOverlayIconGlyphToXMAGatingType").convertExtendedContentOverlayIconGlyphToXMAGatingType(a.overlayIconGlyph)}));a.defaultCTA!=null&&a.defaultCTA.nativeUrl!=null&&(f=babelHelpers["extends"]({},f,{xmaDefaultCTA:a.defaultCTA.nativeUrl}));e.xmaData=f;b!=null&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetXmaDataSuccessful,[],!1);return e}function q(a,b){var c={mediaMetadata:null};if(b.previewMediaIds==null){c.maybeErrorDetail={errorMsg:"[labyrinth_web] No mediaId found in DbXMA payload",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(c)}var e=b.previewMediaIds[0];return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,e).then(function(e){if(!e){c.maybeErrorDetail={errorMsg:"[labyrinth_web] No media db entry for media id to be used for xma",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(c)}var f=b.msgId;if(f==null){c.maybeErrorDetail={errorMsg:"[labyrinth_web] No message id found in a xma msg",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return d("MAWDexieTable").dexieResolve(c)}var g=d("MAWGating").isMediaBackupTableEnabled()?d("MAWDbMediaTxns").maybeGetMediaBackupRowFromMsgId(a,f):d("MAWDexieTable").dexieResolve();return g.then(function(a){return d("MAWDexieTable").dexieResolve(r(f,e,!0,a))})})}function r(a,b,c,e){var f={mediaMetadata:null},g=e!=null?e.fbid:b.fbid;a=b.mediaEntries.get(a);if(a==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no media entry to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}a=d("WAMediaUtils").decodeMediaEntryData(a);e=e!=null?e.objectId:b.objectId;if(e==null)return f;var h=d("MAWGetAttachmentTypeForServerMediaType").getAttachmentTypeForServerMediaType(a.serverMediaType);if(h==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no attachment type to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}var i=a.mediaKey;if(i==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no mediaKey to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}var j=a.mediaKeyTimestamp;if(j==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no mediaKeyTimestamp to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}var k=a.directPath;if(k==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no directPath to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}if(a.serverMediaType==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no mediaContentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}c=c?"image/jpeg":d("WAMediaUtils").getMimeTypeFromServerMediaType(a.serverMediaType);var l=d("MAWGetMediaAttachmentTypeForServerMediaType").getMediaAttachmentTypeForServerMediaType(a.serverMediaType);if(l==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no xAttachmentType to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}if(a.serverMediaType!=null&&a.serverMediaType in{gif:1,image:1,sticker:1}&&b.validatedImageInfo==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no imageinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}if(a.serverMediaType==="video"&&b.validatedVideoInfo==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no videoinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}if(a.serverMediaType==="ptt"&&b.validatedAudioInfo==null){f.maybeErrorDetail={errorMsg:"[labyrinth_web] no audioinfo to construct mediaMetadata",uploadErrorType:d("MAWUploadMessagesBackup").UploadErrorType.FATAL};return f}f=0;var m=0,n=0,o=0,p=0;a=d("MAWGetPreviewContentTypeForMediaType").getPreviewContentTypeForMediaType(a.serverMediaType);if(b.validatedImageInfo!=null){var q;f=(q=b.validatedImageInfo.width)!=null?q:0;m=(q=b.validatedImageInfo.height)!=null?q:0;o=(q=b.validatedImageInfo.jpegThumbnailWidth)!=null?q:0;p=(q=b.validatedImageInfo.jpegThumbnailHeight)!=null?q:0}if(b.validatedVideoInfo!=null){f=(q=b.validatedVideoInfo.width)!=null?q:0;m=(q=b.validatedVideoInfo.height)!=null?q:0;o=(q=b.validatedVideoInfo.jpegThumbnailWidth)!=null?q:0;p=(q=b.validatedVideoInfo.jpegThumbnailHeight)!=null?q:0;n=(q=b.validatedVideoInfo.duration)!=null?q:0}if(b.validatedAudioInfo!=null){n=(q=b.validatedAudioInfo.duration)!=null?q:0}q={attachmentObjectId:e,attachmentType:h,directPath:k,hashedPlaintextHash:b.hashedPlaintextHash,height:m,mediaBackupStatus:"success",mediaContentType:c,mediaKey:d("EchoEncodingUtils").convertMediaKeyToString(i),mediaKeyTimestamp:j,mediaPlayableDuration:n,plaintextHash:b.plaintextHash,previewContentHeight:p,previewContentType:a,previewContentWidth:o,size:b.size,width:f,xAttachmentType:l,xContentType:"full"};g!=null&&(q=babelHelpers["extends"]({},q,{backupEntFbid:g}));return{mediaMetadata:q}}function s(a,b){a=d("WAJids").authorToUserId(a.author,d("MAWJids").userIdFromJid(d("MAWGlobals").getMyUserJid()));var e=d("MAWJids").toUserJid(a);b!=null&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetSenderInfoSuccessful,[],!1);return{senderId:a,senderJid:e}}function t(a,b,e){return b.then(function(b){if(b!=null){b=s(b);b=b.senderJid;b=d("MAWDbContactsTxns").maybeGetContactName(a,b);d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetSenderDisplayNameForQuotedMsgNotNull,[],!1);return b}d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebUploadGetSenderDisplayNameForQuotedMsgNull,[],!1);return null})}function u(a,b,e,f,g,h){var i=b.content.msgId,j=b.content.externalId;return g!=null?d("MAWDexieTable").dexieResolve(g):d("MAWDbMsgTxns").maybeGetMsg(a,i).then(function(a){if(a==null){d("MAWTraceUtils").recordCheckpointForTrace(h,c("LSDataTraceCheckPoint.re").labyrinthWebUploadRepliedMessageNotInDb,[],!1);return f.then(function(a){a=d("MAWJidUtils").threadIdForChatJid(a);if(!d("MAWEncryptedBackupCacheManager").peekRestoreCache(j)){d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(e,j);d("MAWBridgeEventTransmitter").issuePointQuery(j,a);return null}else{a=(a=d("MAWEncryptedBackupCacheManager").getRestoredCache(j))==null?void 0:a.dbMsg;return d("MAWDexieTable").dexieResolve(a)}})}else{d("MAWTraceUtils").recordCheckpointForTrace(h,c("LSDataTraceCheckPoint.re").labyrinthWebUploadRepliedMessageInDb,[],!1);return d("MAWDexieTable").dexieResolve(a)}})}g.constructEchoMessage=a;g.constructXMAData=p;g.constructMediaMetadata=r}),98);
__d("EchoBackupCompareUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b;return{contentSubtype:a.contentSubtype,contentType:a.contentType,reactionTsList:(b=a.reactionAuthoritativeTimestampMs)==null?void 0:b.map(function(a){return a.displayName==null?null:Number(a.displayName)/1e3}).filter(Boolean).sort(),receiptTsList:(b=a.receiptStatusList)==null?void 0:b.map(function(a){return a.timestampMs==null?null:a.timestampMs/1e3}).filter(Boolean).sort()}}function g(a,b){if(a==null&&b==null)return!0;return a!=null&&b!=null?a.length===b.length&&a.every(function(a,c){return a===b[c]}):!1}function b(a,b){return b!=null&&a.contentSubtype===b.contentSubtype&&a.contentType===b.contentType&&g(a.reactionTsList,b.reactionTsList)&&g(a.receiptTsList,b.receiptTsList)}f.buildEchoDocCacheValue=a;f.echoEquals=b}),66);
__d("MAWDbXMA",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.convertNumbersToXMAIds=a}),66);
__d("MAWUploadRetryStatusUtil",["MAWGating","MAWGlobals","MAWIndexedDb","MAWTransactionMode","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unhandled error in postBackupWriteCompletionHook job: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] postBackupWriteCompletionHook get null/empty input."]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({retroactiveBackupsState:d("MAWTransactionMode").READONLY})(function(a){return a.retroactiveBackupsState.count().then(function(a){return a>0?!0:!1})});c=d("MAWIndexedDb").makeMsgrTransactor({uploadRetryStatus:d("MAWTransactionMode").READWRITE})(function(a,b){return a.uploadRetryStatus.bulkAdd(b.map(function(a){return{externalId:a.msg.externalId,lastRetryTs:a.lastRetryTs,retriedTimes:a.retriedTimes,traceId:a.traceId}})).then(function(a){})});var j=d("MAWIndexedDb").makeMsgrTransactor({uploadRetryStatus:d("MAWTransactionMode").READWRITE})(function(a,b){return a.uploadRetryStatus.where("traceId").anyOf(b)["delete"]()});e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("postBackupWriteCompletionHook",function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.traceIdArray;if(d("MAWGating").isEncryptedBackupsUploadTrackingEnabled()){e.next=3;break}return e.abrupt("return");case 3:if(!(c==null||c.length===0)){e.next=6;break}d("WALogger").ERROR(i());return e.abrupt("return");case 6:e.prev=6;e.next=9;return b("regeneratorRuntime").awrap(j(c));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](6),d("WALogger").ERROR(h(),e.t0);case 14:case"end":return e.stop()}},null,this,[[6,11]])}).end();g.checkRetroactiveBackupsStateStore=a;g.bulkInsert=c;g.bulkRemove=j;g.postBackupWriteCompletionHook=e}),98);
__d("MAWUploadMessagesBackup",["$InternalEnum","EchoBackupCompareUtils","EchoMessage","LSDataTraceCheckPoint.re","LSDataTraceType.re","MAWBridge","MAWBridgeEventTransmitter","MAWBridgeUpload","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDbXMA","MAWDexieTable","MAWEBSwitch","MAWEncryptedBackupCacheManager","MAWGating","MAWGlobals","MAWHMACKey","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWQplProxy","MAWTraceUtils","MAWTransactionMode","MAWUploadMessageTxns","MAWUploadRetryStatusUtil","Promise","WADualSendMsgUtils","WAGlobals","WAJids","WALogger","WAMsgType","WAStanzaUtils","WATimeUtils","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot proceed with encodeAndSendEchoMessage: Encrypted Backups are not enabled"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unhandled error in uploadMessagesBackup job: ",""]);l=function(){return a};return a}e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("echoSerialization",function(a){var c,e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:c=a.messageIds,e=a.oldTraceIdMap,f=a.reactionIds,g=a.receiptIds,h=a.xmaIds;k.prev=1;i=m(g);j=d("MAWDbXMA").convertNumbersToXMAIds(h);k.next=6;return b("regeneratorRuntime").awrap(o(c,f,i,j,e));case 6:k.next=11;break;case 8:k.prev=8,k.t0=k["catch"](1),d("WALogger").ERROR(l(),k.t0);case 11:case"end":return k.stop()}},null,this,[[1,8]])}).end();function m(a){return a==null?[]:a.filter(Boolean).map(function(a){if(a!=null)return d("MAWDbMsg").toMsgId(a)}).filter(Boolean)}var n=b("$InternalEnum").Mirrored(["FATAL","WARN"]);function o(a,e,f,g,h){var i=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521480064,"835"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled()},"int":{timestamp:Date.now()}});a=t(a,e,f,g,i).then(function(a){i.endSuccess(),x(a,void 0,!1,h)}).then(function(a){});return b("Promise").all([a]).then(function(){})}function p(a,b,c){c==null?void 0:c.addPoint("message_lookup_start");return a.messages.bulkGet(b).then(function(a){return a.filter(Boolean)}).then(function(a){c==null?void 0:c.addPoint("message_lookup_end");return a})}function q(a,b,c){c==null?void 0:c.addPoint("receipts_lookup_start");return a.messages.where("msgId").anyOf(b).toArray().then(function(a){return a.filter(Boolean)}).then(function(a){c==null?void 0:c.addPoint("receipts_lookup_end");return a})}function r(a,b,c){c==null?void 0:c.addPoint("reactions_lookup_start");return a.reactions.bulkGet(b).then(function(b){b=b.filter(Boolean).map(function(b){return d("MAWDbThreadTxns").getThreadByJid(a,b.threadJid).then(function(c){var e=c.success?c.value:null;if(e!=null&&e.chatId!=null){c=b.reactToAuthor;c=c===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:c;return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.reactToExternalId,e.chatId,c).then(function(a){if(a==null&&!d("MAWEncryptedBackupCacheManager").peekRestoreCache(b.reactToExternalId)){var c=d("MAWJidUtils").threadIdForChatJid(e.jid);d("MAWEncryptedBackupCacheManager").addMsgEntryToReuploadCache(e.chatId,b.reactToExternalId);d("MAWBridgeEventTransmitter").issuePointQuery(b.reactToExternalId,c)}return a})}})});return d("MAWDexieTable").dexieAll(b).then(function(a){c==null?void 0:c.addPoint("reactions_lookup_end");return a.filter(Boolean)})})}function s(a,b,c){c==null?void 0:c.addPoint("xma_lookup_start");b=b.filter(Boolean);return a.xma.bulkGet(b).then(function(b){b=b.map(function(a){return a==null?void 0:a.associatedMessageId}).filter(Boolean);return a.messages.where("msgId").anyOf(b).toArray()}).then(function(a){c==null?void 0:c.addPoint("xma_lookup_end");return a})}var t=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("uploadMsgBackupGetMsgs",!1,{},!0)))(function(a,b,c,d,e,f){return z(a,b,c,d,e,f)});function u(a){a=[a];d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:a})}function v(a){var e=new Map();a.forEach(function(a){return e.set(a.dbMsg.externalId,a)});return b("Promise").all(a.map(function(a){return y(a.dbMsg,a.traceId,a.quotedMsg)})).then(function(a){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:f=[];g=a.map(function(a){var b=e.get(a.externalId)||{dbMsg:null,traceId:null},g=b.dbMsg;b=b.traceId;if(a.maybeErrorDetail!=null){b!=null&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebUploadInvalidEchoMessageSerializationResponse,[],!1);f.push(b);return a}var h=a.echoMessage;if((h==null?void 0:h.xOfflineThreadingId)==null){a.maybeErrorDetail={errorMsg:"[labyrinth_web] xOfflineThreadingId should not be empty in the EchoMessage",uploadErrorType:n.FATAL};f.push(b);return a}var i=h.xOfflineThreadingId,j=d("WAStanzaUtils").toStanzaId(i);if(d("MAWEncryptedBackupCacheManager").getRestoredCacheStatus(j)==="done"){var k=d("EchoBackupCompareUtils").buildEchoDocCacheValue(h);k=d("EchoBackupCompareUtils").echoEquals(k,d("MAWEncryptedBackupCacheManager").getRestoredCache(j));d("MAWEncryptedBackupCacheManager").removeFromRestoredCache(j);if(k){a.maybeErrorDetail={errorMsg:"[labyrinth_web] duplicate message upload request, aborting it",uploadErrorType:n.WARN};b!=null&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebUploadDuplicateRequest,[],!1);f.push(b);return a}}g!=null&&b!=null&&u({tag:"UploadMessage",value:d("MAWBridgeUpload").createBridgeUploadMessage(i,h.threadId,d("MAWDbMsg").getSortOrderWithFallback(g),d("EchoMessage").encodeEchoMessage(h),1,b)});b!=null&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebUploadIssueMessageUploadUiEvent,[],!1);return a});if(!d("MAWGating").isEncryptedBackupsUploadTrackingEnabled()){h.next=5;break}h.next=5;return b("regeneratorRuntime").awrap(d("MAWUploadRetryStatusUtil").bulkRemove(f.filter(Boolean)));case 5:return h.abrupt("return",g);case 6:case"end":return h.stop()}},null,this)})}function w(a){var b=new Set(),c=[];a.forEach(function(a){d("MAWEncryptedBackupCacheManager").getRestoredCacheStatus(a.externalId)!=="restoring"&&!b.has(a.externalId)&&(b.add(a.externalId),c.push(a))});return c}function x(a,e,f,g){if(!c("MAWEBSwitch").isEnabled()){d("WALogger").LOG(k());return b("Promise").resolve()}var h=w(a).filter(function(a){return a.type!==d("WAMsgType").MSG_TYPE.UNAVAILABLE&&a.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT&&a.serverTs!=null&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)&&!d("WADualSendMsgUtils").isDualSendJid(a.threadJid)}).map(function(a){var b=d("MAWTraceUtils").startNewTrace(c("LSDataTraceType.re").encryptedBackupsUpload,d("MAWTraceUtils").CONTEXT_BACKUP_UPLOAD);f!=null&&f&&d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebRetroactiveBackupsStartUploadMsg,[],!1);return{lastRetryTs:d("WATimeUtils").millisTime(),msg:a,retriedTimes:0,traceId:b}});return(d("MAWGating").isEncryptedBackupsUploadTrackingEnabled()?d("MAWUploadRetryStatusUtil").bulkInsert(h):b("Promise").resolve()).then(function(a){return A(h.map(function(a){var b=a.msg.quoteExternalId;if(b!=null)return{dbMsg:a.msg,quotedMsg:e==null?void 0:e.get(b),traceId:a.traceId};else return{dbMsg:a.msg,traceId:a.traceId}}),g)}).then(function(){return b("Promise").resolve()})}var y=d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,mediaBackup:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(d("MAWUploadMessageTxns").constructEchoMessage);function z(a,b,c,e,f,g){b=p(a,b,g);e=q(a,e,g);c=r(a,c,g);a=d("MAWGating").isXMABackupEnabled()?s(a,f,g):d("MAWDexieTable").dexieResolve([]);return d("MAWDexieTable").dexieAll([b,e,c,a]).then(function(a){return a.flat()})}function A(a,e){var f=new Map();a.forEach(function(a){var b=a.dbMsg;a=a.traceId;d("MAWTraceUtils").recordCheckpointForTrace(a,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageUploadBegin,[d("MAWTraceUtils").getTagForMsgType(b.type)],!1);var g=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521475102,"868"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled()},"int":{sort_order:b.sortOrderMs,timestamp:Date.now()},string:{hashed_msgid:B(b.externalId),message_id:b.externalId,message_type:b.type.toString(),org_trace_id:e==null?void 0:e.get(b.externalId),trace_id:a}});f.set(b.externalId,{constructEchoFlow:g,traceId:a})});a=v(a)["catch"](function(a){a="[labyrinth_web] Error while encode and upload message to backup: "+String(a);d("WALogger").ERROR(j(),a);for(var e=f.values(),g=Array.isArray(e),h=0,e=g?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=e.length)break;i=e[h++]}else{h=e.next();if(h.done)break;i=h.value}i=i;d("MAWTraceUtils").recordFailureAndFlushForTraceId(i.traceId,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageUploadFailure,[],a);i.constructEchoFlow.endFail("serialisation_failure")}return b("Promise").resolve()});return a.then(function(a){a==null?void 0:a.forEach(function(a){var b;b=(b=a.echoMessage)==null?void 0:b.messageId;if(b!=null&&f.has(d("WAStanzaUtils").toStanzaId(b))){var e;b=f.get(d("WAStanzaUtils").toStanzaId(b))||{constructEchoFlow:null,traceId:null};var g=b.constructEchoFlow;b=b.traceId;e=a==null?void 0:(e=a.maybeErrorDetail)==null?void 0:e.uploadErrorType;a=a==null?void 0:(a=a.maybeErrorDetail)==null?void 0:a.errorMsg;if(e!=null)switch(e){case n.WARN:a!=null&&d("WALogger").WARN(i(),a);g==null?void 0:g.endSuccess({bool:{is_skipped:!0}});b!=null&&d("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageUploadInvalidRequest,[]);break;case n.FATAL:a=(e=a)!=null?e:"[labyrinth_web] unknown error in the upload message flow";d("WALogger").ERROR(h(),a);b!=null&&d("MAWTraceUtils").recordFailureAndFlushForTraceId(b,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageUploadFailure,[],a);g==null?void 0:g.endFail("serialisation_failure");break}else g==null?void 0:g.endSuccess()}});return b("Promise").resolve()})}function B(a){if(a==null)return"";var b=d("MAWGlobals").getHMACKey();return d("MAWHMACKey").hmacTweetNaCl(a,b)}function a(a,b){var e=d("MAWTraceUtils").startNewTrace(c("LSDataTraceType.re").encryptedBackupsUpload,d("MAWTraceUtils").CONTEXT_BACKUP_UPLOAD);d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageUploadBegin,[d("MAWTraceUtils").getTagForMsgType(a.type)],!1);b=b==null?a.thread.toString():d("MAWJidUtils").threadIdForChatJid(b);d("MAWIndexedDb").afterTransaction({tag:"UploadMessage",value:d("MAWBridgeUpload").createBridgeUploadMessage(a.externalId,b,d("MAWDbMsg").getSortOrderWithFallback(a),null,2,e)})}g.uploadMessagesBackup=e;g.convertStringMsgIdtoMsgId=m;g.UploadErrorType=n;g.getMsgs=t;g.deduplicateMessageArray=w;g.uploadUniqueMessage=x;g.getMessagesBackupForUpload=z;g.hashIdentifier=B;g.sendDeleteEchoMessage=a}),98);
__d("MAWWriteMsgSideEffectTxns",["MAWDbMsg","MAWDbParticipant","MAWDbParticipantTxns","MAWDexieTable","WADualSendMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=d("MAWDbMsg").getCanonicalTsFromMsg(b),e=b.author;return e!=="@me"&&e!=="@system"?d("MAWDbParticipantTxns").updateParticipantTimestamps(a,d("MAWDbParticipant").craftParticipantId(b.thread,e),c,c,c,d("WADualSendMsgUtils").isDualSendJid(b.threadJid)):d("MAWDexieTable").dexieResolve()}g.updateParticipantTimestampsForMsg=a}),98);
__d("MAWXMAManagementTxns",["MAWDexieTable","MAWHandleUnstoredMediaTxns","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f=!1);var g=b.unstoredFavicon,i=b.unstoredHeaderMedia,j=b.unstoredPreviews,k=new Map();if(!f){g!=null&&k.set(g.plaintextHash,d("MAWHandleUnstoredMediaTxns").handleUnstoredDbMedia(a,g,c,!0));if(i!=null){f=k.get(i.plaintextHash);f==null&&k.set(i.plaintextHash,d("MAWHandleUnstoredMediaTxns").handleUnstoredDbMedia(a,i,c,!0))}j!=null&&j.forEach(function(b){var e=k.get(b.plaintextHash);e==null&&k.set(b.plaintextHash,d("MAWHandleUnstoredMediaTxns").handleUnstoredDbMedia(a,b,c,!0))})}f=Array.from(k.values());return d("MAWDexieTable").dexieAll(f).then(function(d){var f=d.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map()),k=i!=null?f.get(i.plaintextHash):void 0,l=g!=null?f.get(g.plaintextHash):void 0,m=j!=null?j.map(function(a){return f.get(a.plaintextHash)}).filter(Boolean):[];d=m.map(function(a){return a.mediaId});return h(a,b.unstoredDbXMA,l==null?void 0:l.mediaId,k==null?void 0:k.mediaId,d,c,e).then(function(a){return{dbXMA:a,favicon:l,headerMedia:k,previews:[].concat(m).filter(Boolean)}})})}function h(a,b,c,d,e,f,g){b=babelHelpers["extends"]({},b,{associatedMessageId:g==null?void 0:g,defaultPreviewMediaId:e[0],faviconMediaId:c,headerMediaId:d,msgId:f.msgId,previewMediaIds:e});return a.xma.add(b).then(function(b){return a.xma.get(b)})}function b(a,b,c,e,f,g,h,i,j){var k=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec),l=k?babelHelpers["extends"]({},j,{associatedMessageId:h==null?void 0:h,author:i.author,ctas:void 0,defaultCTA:void 0,defaultPreviewMediaId:void 0,externalId:i.externalId,faviconMediaId:void 0,headerMediaId:void 0,headerTitle:void 0,isTombstoned:!0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,msgId:g,overlayDescription:void 0,overlayIconGlyph:void 0,overlayTitle:void 0,previewMediaIds:void 0,subtitleText:void 0,targetId:void 0,targetType:f,targetUsername:void 0,threadJid:i.chat,titleText:void 0}):babelHelpers["extends"]({},j,{associatedMessageId:h==null?void 0:h,author:i.author,defaultPreviewMediaId:b==null?void 0:b,externalId:i.externalId,faviconMediaId:e==null?void 0:e,headerMediaId:c==null?void 0:c,isTombstoned:!1,msgId:g,previewMediaIds:b!=null?[b]:[],targetType:f,threadJid:i.chat});return a.xma.add(l).then(function(a){return babelHelpers["extends"]({},l,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.handleUnstoredDbXMA=h;g.saveXMA=b}),98);
__d("MAWWriteMsgTxns",["ArmadilloDataTraceType.bs","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypes","MAWBridgeXMA","MAWDbMsg","MAWDbMsgTxns","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbReactionsTxns","MAWDbThread","MAWDbThreadTxns","MAWDbXMATxns","MAWDeleteForMeMsgContentCleaner","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralUtil","MAWExpiredXMACleaner","MAWFolderTypes","MAWGating","MAWHandleUnstoredMediaTxns","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWLocalizationType","MAWLocalizationUtils","MAWPendingStanzaCleaner","MAWThreadEvent","MAWThreadFetchAndEmitTxns","MAWThreadSnippetBuildTxns","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetUtils","MAWTimeUtils.bs","MAWUnsendMsgContentCleaner","MAWUpdateQuotedMsgTxns","MAWUploadMessagesBackup","MAWWriteMsgSideEffectTxns","MAWXMAManagementTxns","MAWXMAUtils","WAArmadilloXMA.pb","WADualSendMsgUtils","WAJids","WALogger","WAMsgType","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["more than one message matched the externalId: "," in the thread: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["fail to write revoke message in db"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeMsgAfterTransaction - sortOrderMs: ",""]);j=function(){return a};return a}var k=6*d("WATimeUtils").HOUR_SECONDS,l=30*d("WATimeUtils").DAY_SECONDS;function m(a,b,c,e){c=c.newestMsg;if(e!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},b,{sortOrderMs:e}));else if(c==null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},b,{sortOrderMs:d("MAWDbMsg").getSortOrderWithFallback(b)}));else return d("MAWDbMsgTxns").maybeGetMsg(a,c).then(function(a){if(a==null||a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE)&&a.sortOrderMs===0)return babelHelpers["extends"]({},b,{sortOrderMs:d("MAWDbMsg").getSortOrderWithFallback(b)});else{a=d("MAWDbMsg").getSortOrderWithFallback(a);return babelHelpers["extends"]({},b,{sortOrderMs:d("MAWDbMsg").getSortOrderFromPrevious(b,a)})}})}function a(a,b,e,f){var g=a.ts;g=d("WATimeUtils").castUnixTimeToMillisTime(g);var h=d("MAWTimeUtils.bs").getMillisTime(b.newestMsgTs)||d("WATimeUtils").castToMillisTime(0);g=g>h?g:h;h=a.msgId;var i=a.msgId;h=babelHelpers["extends"]({},b,{newestMsg:h,newestMsgTs:g,nextInChatMsgId:b.nextInChatMsgId+1,oldestMsg:i,threadOrder:d("MAWDbThread").craftThreadOrder(g,b.jid)});d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(a)||(h.snippetMsg=a.msgId);var j=b.oldestMsg!=null&&a.msgId!==b.oldestMsg,k=!d("MAWGating").isOccamadillo()&&v(h);k&&(h=babelHelpers["extends"]({},h,{archived:!1,folder:d("MAWFolderTypes").FOLDER_ID.INBOX}));e.push(a);f.push(h);e=d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(a)?null:c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,d("MAWThreadSnippetBuildTxns").getSnippetContactId(a.author));f=h.chatId;var l=h,m=l.jid;l=l.lastReadMsgTs;o({dbMsg:a,isFirstMsg:!1,jid:m,snippet:e,threadId:f,updatedThread:h,shouldBeUnarchived:k,isOldestMsgUpdated:j,oldestMsg:i,lastActivityTs:g,lastReadTs:l,prevOldestMsg:b.oldestMsg==null?void 0:b.oldestMsg})}function n(a,b,c,e){e===void 0&&(e={});e=e;var f=e.optimisticMsg,g=e.openMessageOtid,h=e.quotedReplyAttachmentMeta,i=e.isCiphertextUpdateForXMAMessageWithAssociatedMsg,k=i===void 0?!1:i;i=e.isFirstMsg;var l=i===void 0?!1:i;i=e.isOutgoing;var n=i===void 0?!1:i,p=e.openMessageParticipantCount,q=e.participantCount,r=e.sortOrderMs;i=b.ts;e=d("WATimeUtils").castUnixTimeToMillisTime(i);i=d("MAWTimeUtils.bs").getMillisTime(c.newestMsgTs)||d("WATimeUtils").castToMillisTime(0);var s=e>i?e:i;return d("MAWDbMsgTxns").calculateOldestAndNewestMsg(a,c.oldestMsg,c.newestMsg,b,r).then(function(e){var i=e.newestMsg,t=e.oldestMsg,u=babelHelpers["extends"]({},c,{newestMsg:i,newestMsgTs:s,nextInChatMsgId:c.nextInChatMsgId+1,oldestMsg:t,threadOrder:d("MAWDbThread").craftThreadOrder(s,c.jid)});d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)||(u.snippetMsg=b.msgId);var w=c.oldestMsg!=null&&t!==c.oldestMsg,x=!d("MAWGating").isOccamadillo()&&v(u);x&&(u=babelHelpers["extends"]({},u,{archived:!1,folder:d("MAWFolderTypes").FOLDER_ID.INBOX}));i=(e=d("MAWTimeUtils.bs").getMillisTime(c.lastReadMsgTs))!=null?e:0;e=(e=d("MAWTimeUtils.bs").getMillisTime(c.newestMsgTs))!=null?e:0;i=i<e;(b.author===d("WAJids").AUTHOR_ME||b.type===d("WAMsgType").MSG_TYPE.ADMIN&&d("MAWLocalizationUtils").isParticipantChangeAdminMsg(b.msgContent.adminType)&&!i)&&(u=babelHelpers["extends"]({},u,{lastReadMsg:b.msgId,lastReadMsgTs:s}));e=k?d("MAWDexieTable").dexieResolve(b):m(a,b,c,r);return e.then(function(b){return d("MAWDexieTable").dexieAll([a.messages.add(b).then(function(a){return babelHelpers["extends"]({},b,{rowId:a})}),a.threads.put(u),d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)?null:d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b,c)]).then(function(a){var b=a[0],e=a[1];a=a[2];var i=u,k=i.jid;i=i.lastReadMsgTs;if(b.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||b.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX)return b;n&&d("WALogger").LOG(j(),b.sortOrderMs);o({dbMsg:b,isFirstMsg:l,jid:k,openMessageOtid:g,openMessageParticipantCount:p,optimisticMsg:f,participantCount:q,quotedReplyAttachmentMeta:h,snippet:a,threadId:e,updatedThread:u,shouldBeUnarchived:x,isOldestMsgUpdated:w,oldestMsg:t,lastActivityTs:s,lastReadTs:i,prevOldestMsg:c.oldestMsg==null?void 0:c.oldestMsg});return b})})})}function o(a){var b=a.dbMsg,c=a.isFirstMsg,e=a.jid,f=a.openMessageOtid,g=a.openMessageParticipantCount,h=a.optimisticMsg,i=a.participantCount,j=a.quotedReplyAttachmentMeta,k=a.snippet,l=a.threadId,m=a.updatedThread,n=a.shouldBeUnarchived,o=a.isOldestMsgUpdated,p=a.oldestMsg,q=a.lastActivityTs,r=a.lastReadTs;a=a.prevOldestMsg;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(b,e,d("ArmadilloDataTraceType.bs").armadilloMessageSend,f,c,g,i)});d("MAWXMAUtils").isXMAStoryReply(b.xmaMessageType)||d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b,h,j)});if(k!=null){f=k.snippetParams;c=k.snippetSenderContactId;g=k.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadBumped",value:d("MAWBridgeTypes").createBridgeBumpedThread(l,d("WADualSendMsgUtils").isDualSendJid(e),q,r,g,f,c)})}a==null&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypes").createBridgeMsgsLoadedInfo(l,[b],!0,!1,d("WADualSendMsgUtils").isDualSendJid(b.threadJid))});n&&d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({cannotReplyReason:m.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,isDualSend:d("WADualSendMsgUtils").isDualSendJid(m.jid),threadId:m.chatId})});o&&d("MAWIndexedDb").afterTransaction({tag:"UpdateMinMessage",value:d("MAWBridgeTypes").createBridgeUpdateMinMessage(p,d("MAWDbMsg").getSortOrderWithFallback(b),l)})}function b(a,b,c){c=babelHelpers["extends"]({},c,{nextInChatMsgId:c.nextInChatMsgId+1});return d("MAWDexieTable").dexieAll([a.unrenderedMessages.add(b),a.threads.put(c)]).then(function(){})}function p(a,b){return b!=null&&b.lastMessageTimestamp!=null&&b.lastMessageTimestamp>=a.ts}function q(a,b,e,f,g){g===void 0&&(g=!1);f=d("MAWGating").isBulkifyHIMEnabled()?d("MAWThreadFetchAndEmitTxns").fetchThreadForIncomingMsgs(a,e,f,b.ts):d("MAWThreadFetchAndEmitTxns").fetchOrSetupThread(a,e,f,b.ts);return f.then(function(f){if(f==null)return d("WAResultOrError").makeError({type:"missing_thread"});var h=f.thread;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.externalId,h.chatId,b.author),d("MAWDbPendingStanzaTxns").maybeGetPendingStanzaByExternalId(a,b.externalId,b.author,h.chatId,d("MAWDbPendingStanza").PENDING_TYPE.REVOKED),d("MAWDbPendingStanzaTxns").maybeGetPendingStanzaByExternalId(a,b.externalId,b.author,h.chatId,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME),d("MAWDbMsgTxns").checkIfMsgIsDeletedForMeOrRevoked(a,b.externalId,h.chatId,b.author),d("MAWDbPendingStanzaTxns").maybeGetDeleteThreadFromPendingStanza(a,e)]).then(function(e){var f=e[0],j=e[1],l=e[2],m=e[3];e=e[4];var o=b;o=e!=null&&p(o,e);if(m||o)return d("WAResultOrError").makeResult(null);e=d("MAWDbMsg").craftMsgId(h.chatId,h.nextInChatMsgId);var q,r;if(f==null){var s=babelHelpers["extends"]({},b,{thread:h.chatId,threadJid:h.jid,msgId:e});if(l!=null&&l.pendingContent.type==="DeleteForMe"){var t={type:d("WAMsgType").MSG_TYPE.DELETE_FOR_ME,ts:s.ts,externalId:s.externalId,msgId:s.msgId,thread:s.thread,threadJid:h.jid,author:s.author,ack:s.ack,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+k),msgContent:(m=d("MAWDbMsg").getMsgContent(b))==null?void 0:m.content};return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{chatId:t.thread,author:t.author,externalId:t.externalId}]),a.unrenderedMessages.add(t),a.pendingStanzas["delete"](l.rowId)]).then(function(a){a[0];a=a[1];d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(t.messageDeleteForMeTs);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},t,{rowId:a}))})}if(j!=null&&j.pendingContent.type==="Revoked"){o={type:"Revoked",ack:b.ack,author:b.author,externalId:j.pendingContent.content.externalId,altIndex:null,revokedExternalId:j.pendingContent.content.revokedExternalId,ts:j.pendingContent.content.ts,originalTs:b.ts,thread:h.chatId,threadJid:h.jid,msgId:e,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+k),msgContent:d("MAWDbMsg").getMsgContent(b)};return d("MAWDexieTable").dexieAll([n(a,o,h),a.pendingStanzas["delete"](j.rowId)]).then(function(b){var e=b[0];if(e.type!==d("WAMsgType").MSG_TYPE.REVOKED){d("WALogger").ERROR(i());throw c("err")("fail to write revoke message in db")}return x(a,null,e,h,!0).then(function(){return d("WAResultOrError").makeResult(e)})})}h.folder===d("MAWFolderTypes").FOLDER_ID.OTHER&&(s.altIndex=s.altIndex===d("MAWDbMsg").FUTUREPROOF_ALT_INDEX?d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX:d("MAWDbMsg").SPAM_ALT_INDEX);r=babelHelpers["extends"]({},s);q=function(b){return n(a,s,h,{isCiphertextUpdateForXMAMessageWithAssociatedMsg:g,quotedReplyAttachmentMeta:b}).then(function(b){r.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&r.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&r.author!==d("WAJids").AUTHOR_ME&&d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:d("MAWBridgeTypes").createBridgeBumpedThreadServer(h.chatId,d("WADualSendMsgUtils").isDualSendJid(h.jid),d("WATimeUtils").castUnixTimeToMillisTime(s.ts),!1)});return d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,s).then(function(){return d("WAResultOrError").makeResult(b)})})}}else if(u(f,b)){r=babelHelpers["extends"]({},b,{thread:f.thread,threadJid:h.jid,msgId:f.msgId,rowId:f.rowId,ts:f.ts,sortOrderMs:f.sortOrderMs,serverTs:f.serverTs});var v=r;q=function(b){return a.messages.put(v).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,v)}).then(function(b){if(b){v.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(f.thread);return a.messages.put(v)}}).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,v)}).then(function(b){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(v,void 0,b)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:h.jid,msgId:v.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);if(v.msgId===h.newestMsg){v.rowId;b=babelHelpers.objectWithoutPropertiesLoose(v,["rowId"]);return d("MAWDexieTable").dexieAll([d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,v,h),d("MAWWriteMsgSideEffectTxns").updateParticipantTimestampsForMsg(a,b)]).then(function(a){a=a[0];var b=a.snippetType,c=a.snippetParams;a=a.snippetSenderContactId;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({threadId:h.chatId,snippetType:b,snippetParams:c,snippetSenderContactId:a,isDualSend:d("WADualSendMsgUtils").isDualSendJid(h.jid)})});return d("WAResultOrError").makeResult(v)})}return d("WAResultOrError").makeResult(v)})}}return q!=null&&r!=null?d("MAWDexieTable").dexieAll([d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,h.chatId,r),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,r),d("MAWLoadReplyMediaTxns").getReplyMediaForMsg(a,r)]).then(function(a){var b=a[0],c=a[1],e=a[2];return q(c).then(function(a){b!=null&&b.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,e)})});return a})}):d("WAResultOrError").makeResult(null)})})}function e(a,b,c,e,f){return q(a,b,e,f).then(function(b){if(!b.success)return b;var e=b.value;if(e==null)return d("WAResultOrError").makeResult({dbMsg:null,dbMedias:null});if(e.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME)return d("MAWHandleUnstoredMediaTxns").handleUnstoredMediaOfDeleteForMeMsg(a,c,e).then(function(a){return d("WAResultOrError").makeResult({dbMsg:e,dbMedias:[a]})});else return d("MAWHandleUnstoredMediaTxns").handleUnstoredDbMedia(a,c,e).then(function(a){return d("WAResultOrError").makeResult({dbMsg:e,dbMedias:[a]})})})}function f(a,b,c,e,f){var g=d("MAWDexieTable").dexieResolve();return d("MAWDbXMATxns").maybeGetAssociatedXMAMsg(a,c.unstoredAssociatedMsg,e).then(function(h){var i=b,j=!1;h!=null&&h.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT&&(i=babelHelpers["extends"]({},b,{ts:h.ts,sortOrderMs:h.sortOrderMs!=null?h.sortOrderMs-1:h.sortOrderMs,serverTs:h.serverTs}),j=!0);var k=c.unstoredDbXMA,l=k.targetExpiringAtSec,m=d("MAWXMAUtils").isXMAExpired(k.isTombstoned,l);m&&(i.isExpiredXmaMsg=!0);return q(a,i,e,f,j).then(function(h){if(!h.success)return h;!m&&l!=null&&d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(l);c.unstoredAssociatedMsg!=null&&(g=q(a,c.unstoredAssociatedMsg,e,f));return g.then(function(g){if(g!=null&&!g.success)return g;var f=g==null?void 0:g.value,i=f==null?void 0:f.msgId,j=h.value;if(j==null||g!=null&&f==null)return d("WAResultOrError").makeResult({dbMsg:null,dbMedias:null,dbAssociatedMsg:null});if(j.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME||g!=null&&(f==null?void 0:f.type)===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult({dbMsg:j,dbMedias:null,dbAssociatedMsg:f});else{g=m?d("MAWXMAUtils").buildUnstoredTombstonedXMA(k):k;return d("MAWXMAManagementTxns").handleUnstoredXMAContent(a,babelHelpers["extends"]({},c,{unstoredDbXMA:g}),j,i,m).then(function(g){var h=g.dbXMA,i=g.favicon,k=g.headerMedia;g=g.previews;var l=[i,k].concat(g).filter(Boolean);if(h!=null&&!d("MAWXMAUtils").isXMAStoryReply(h.targetType)){m||d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(j.thread,g[0],h)});return d("WAResultOrError").makeResult({dbMsg:j,dbMedias:m?[]:l,dbAssociatedMsg:f})}return r(a,b,c,e,g[0],f,m).then(function(){return d("WAResultOrError").makeResult({dbMsg:j,dbMedias:l,dbAssociatedMsg:f})})})}})})})}function r(a,b,e,f,g,h,i){var j;if(h==null)throw c("err")("flow check, associate message is null");if(h.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("err")("flow check, this message type is only in text type");var k=b.author;if(k==="@system")throw c("err")("wrong author of story reply");var l=d("WAJids").interpretAsUserJid(f);if(l==null)throw c("err")("this is a flow check, participant jid can not be null");j=(j=(j=e.unstoredDbXMA.defaultCTA)==null?void 0:j.nativeUrl)!=null?j:(j=e.unstoredDbXMA.defaultCTA)==null?void 0:j.actionUrl;b={type:d("WAMsgType").MSG_TYPE.XMA,ts:b.ts,externalId:e.unstoredDbXMA.externalId,author:k===d("WAJids").AUTHOR_ME?l:d("WAJids").AUTHOR_ME,mediaId:i?void 0:g==null?void 0:g.mediaId,sourceId:j,xmaMessageType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY};e={remoteJid:f,content:b};var m=babelHelpers["extends"]({},h,{quote:e});return a.messages.put(m).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(m)})})}function s(a,b,c,e,f,g,h,i){f=d("MAWGating").isBulkifyHIMEnabled()?d("MAWThreadFetchAndEmitTxns").fetchThreadForIncomingMsgs(a,f,h):d("MAWThreadFetchAndEmitTxns").fetchOrSetupThread(a,f,h);return f.then(function(f){return f==null?d("WAResultOrError").makeError({type:"missing_thread"}):d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(a,b,c,e,f.thread,g,i)})}function t(a,b,c,e,f,g,h){e=d("MAWGating").isBulkifyHIMEnabled()?d("MAWThreadFetchAndEmitTxns").fetchThreadForIncomingMsgs(a,e,g):d("MAWThreadFetchAndEmitTxns").fetchOrSetupThread(a,e,g);return e.then(function(e){return e==null?d("WAResultOrError").makeError({type:"missing_thread"}):d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralScreenshotActionMsg(a,b,e.thread,c,f,h)})}function u(a,b){return a!=null&&a.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT&&b.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT}function v(a){return a.archived===!0&&a.cannotReplyReason!=="viewer_not_subscribed"}function w(a,b,e,f){f=d("MAWGating").isBulkifyHIMEnabled()?d("MAWThreadFetchAndEmitTxns").fetchThreadForIncomingMsgs(a,e,f):d("MAWThreadFetchAndEmitTxns").fetchOrSetupThread(a,e,f);return f.then(function(f){return f==null?d("WAResultOrError").makeError({type:"missing_thread"}):a.messages.where("externalId").equals(b.revokedExternalId).toArray().then(function(g){g=g.filter(function(a){return a.author===b.author});if(g.length===0){var i={type:"Revoked",ack:d("MAWAckLevel").ACK.received,author:b.author,externalId:b.externalId,altIndex:null,revokedExternalId:b.revokedExternalId,ts:b.ts,thread:f.thread.chatId,threadJid:f.thread.jid},j=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+l),m={externalIdWithType:b.revokedExternalId+"_"+d("MAWDbPendingStanza").PENDING_REVOKED,pendingContent:{type:d("MAWDbPendingStanza").PENDING_TYPE.REVOKED,content:i},deleteTs:j};m=a.pendingStanzas.add(m);i=y(a,i.externalId,i.author,f.thread).then(function(b){if(b)return d("MAWThreadSnippetBuildTxns").updateThreadSnippet(a,f.thread)});return d("MAWDexieTable").dexieAll([m,i]).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(j);return d("WAResultOrError").makeResult()})}g.length>1&&d("WALogger").ERROR(h(),b.revokedExternalId,e);m=g[0];i=f.thread;if(m==null)throw c("err")("this should not happen, here just to make flow happy");var n={type:"Revoked",ack:m.ack,author:m.author,externalId:b.externalId,altIndex:null,revokedExternalId:b.revokedExternalId,rowId:m.rowId,ts:b.ts,serverTs:b.serverTs,msgId:m.msgId,thread:m.thread,threadJid:i.jid,originalTs:(g=m.serverTs)!=null?g:m.ts,sortOrderMs:m.sortOrderMs,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+k),mediaId:m.mediaId,msgContent:d("MAWDbMsg").getMsgContent(m),quote:m.quote,xmaMessageType:m.xmaMessageType};return x(a,m,n,i,!1).then(function(){return d("WAResultOrError").makeResult(n)})})})}function x(a,b,c,e,f){var g,h=y(a,c.externalId,c.author,e).then(function(){return d("MAWThreadSnippetBuildTxns").updateThreadSnippet(a,e)}),i=d("MAWDexieTable").dexieResolve();b!=null&&d("MAWXMAUtils").isXMAStoryReply((g=b.quote)==null?void 0:g.content.xmaMessageType)&&(i=A(a,b));return d("MAWDexieTable").dexieAll([h,a.messages.put(c),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{chatId:c.thread,author:c.author,externalId:c.revokedExternalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,c.thread,c.revokedExternalId,c.author,d("WAMsgType").MSG_TYPE.REVOKED),i]).then(function(b){b=b[0];d("MAWUnsendMsgContentCleaner").addNewUnsendMsgContentCleanerTimestamp(c.unsendMsgContentDeleteTs);b=(b==null?void 0:b.msgId)===c.msgId;if(b)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,c,e).then(function(a){var b=a.snippetType,c=a.snippetParams;a=a.snippetSenderContactId;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({threadId:e.chatId,snippetType:b,snippetParams:c,snippetSenderContactId:a,isDualSend:d("WADualSendMsgUtils").isDualSendJid(e.jid)})})})}).then(function(){b!=null&&d("MAWUploadMessagesBackup").sendDeleteEchoMessage(b,b.threadJid);f?d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(c)}):d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(c)});if(b!=null&&d("MAWDbMsg").isMediaMsg(b)){var a=b.mediaId;a!=null&&d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:d("MAWBridgeTypes").createBridgeMediaExpired(b,a)})}d("MAWEphemeralUtil").maybeClearEphemeralMsgCountdown(b)})}function y(a,b,c,e){return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b,e.chatId,c).then(function(b){return b!=null&&b.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT?a.messages["delete"](b.rowId).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(b.thread,[b])});return!0}):!1})}function z(a,b){var c=b.protocolMsgId,e=c.author;b=c.chat;var f=c.externalId;return d("MAWDexieTable").dexieAll([d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b),a.unrenderedMessages.get({externalId:f})]).then(function(b){var g=b[0];b=b[1];if(g==null)return d("WAResultOrError").makeError("missing_thread");return b!=null&&b.thread===g.thread.chatId&&b.author===e?d("WAResultOrError").makeError("duplicate_delete_for_me"):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c).then(function(b){var h;if(b==null){var i={type:d("WAMsgType").MSG_TYPE.DELETE_FOR_ME,externalId:f,thread:g.thread.chatId,threadJid:g.thread.jid,author:e,ack:d("MAWAckLevel").ACK.received},j=d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+l);i={externalIdWithType:f+"_"+d("MAWDbPendingStanza").PENDING_DELETE_FOR_ME,pendingContent:{type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME,content:i},deleteTs:j};return a.pendingStanzas.add(i).then(function(){d("MAWPendingStanzaCleaner").addNewPendingStanzaCleanerTimestamp(j);return d("WAResultOrError").makeResult()})}i=d("MAWDexieTable").dexieResolve();d("MAWXMAUtils").isXMAStoryReply((h=b.quote)==null?void 0:h.content.xmaMessageType)&&(i=A(a,b));var m={type:d("WAMsgType").MSG_TYPE.DELETE_FOR_ME,ts:b.ts,externalId:b.externalId,msgId:b.msgId,thread:b.thread,threadJid:c.chat,author:e,ack:b.ack,messageDeleteForMeTs:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+k),mediaId:b.mediaId,msgContent:(h=d("MAWDbMsg").getMsgContent(b))==null?void 0:h.content,reportingMeta:b.reportingMeta,quote:b.quote,xmaMessageType:b.xmaMessageType};h=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId),i]).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(b.thread,[b])});d("MAWGating").isUploadFlowEnabled()&&d("MAWUploadMessagesBackup").sendDeleteEchoMessage(b,g.thread.jid);if(d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;c!=null&&d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:d("MAWBridgeTypes").createBridgeMediaExpired(b,c)})}return d("MAWThreadSnippetBuildTxns").updateThreadSnippet(a,g.thread)});return d("MAWDexieTable").dexieAll([h,a.unrenderedMessages.add(m),d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,[{chatId:b.thread,author:e,externalId:b.externalId}]),d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,b.thread,b.externalId,b.author,d("WAMsgType").MSG_TYPE.REVOKED)]).then(function(){d("MAWDeleteForMeMsgContentCleaner").addNewDeleteForMeMsgContentCleanerTimestamp(m.messageDeleteForMeTs);return d("WAResultOrError").makeResult()})})})}function A(a,b){return d("MAWDbXMATxns").maybeGetXMAFromAssociatedMsgId(a,b.msgId).then(function(b){return d("MAWDbMsgTxns").maybeGetMsg(a,b==null?void 0:b.msgId).then(function(b){if(b!=null)return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId)})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=k;g.PENDING_STANZA_EXPIRATION_IN_SEC=l;g.writeIncomingE2EEThreadAdminMsg=a;g.writeMsg=n;g.writeUnrenderedMsg=b;g.checkIfMsgIsDeletedViaDeleteThread=p;g.writeIncomingMsg=q;g.writeIncomingMediaMsg=e;g.writeIncomingXMAMsg=f;g.writeIncomingEphemeralSettingMsg=s;g.writeIncomingEphemeralScreenshotActionMsg=t;g.shouldThreadBeUnarchived=v;g.writeIncomingRevokeMsg=w;g.markMsgAsRevoke=x;g.handleDeleteForMe=z;g.deleteXMAStoryReplyMsg=A}),98);
__d("MAWAdminMsgTxnsUtils",["MAWBridge","MAWGlobals","MAWIndexedDb","MAWJids","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.map(function(a){return d("MAWJids").userIdFromJid(a)});a.forEach(function(){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.ADMIN_MESSAGE,key:"missing_user_id"})});d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:b})}function b(a){return a==null||a===""}function h(){return d("MAWGlobals").getConfig().defaultUnknownContactText()}function c(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return b.map(function(a){return a==null||a===""?h():a})}g.afterTransactionFetchContactsNames=a;g.isUnknownName=b;g.getUnknownUserName=h;g.createAdminMsgContent=c}),98);
__d("MAWEphemeralAdminMsgBuildTxns",["MAWAckLevel","MAWAdminMsgTxnsUtils","MAWBridgeMsg","MAWBridgeTypes","MAWDbContactsTxns","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLocalizationType","MAWThreadSnippetBuildTxns","MAWWriteMsgTxns","WAArmadilloApplication.pb","WAJids","WAMsgType","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h=60,i=60*h,j=24*i;function a(a,b,e,f,g,k,l){var m=d("MAWAdminMsgTxnsUtils").getUnknownUserName();return d("MAWDbContactsTxns").maybeGetContactName(a,b).then(function(n){var o=d("MAWAdminMsgTxnsUtils").isUnknownName(n);n=n==null||n===""?m:n;var p,q=[],r=b===d("MAWGlobals").getMyUserJid();if(e<0)throw c("err")("Received unexpected ephemeral time setting");e===0?r?p=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF:o?p=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:(p=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,q.push(n)):e<h?(r?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:o?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS:(p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,q.push(n)),q.push(e.toString())):e<i?(r?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:o?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES:(p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,q.push(n)),q.push((e/h).toString())):e<j?(r?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS:o?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS:(p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,q.push(n)),q.push((e/i).toString())):(r?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS:o?p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS:(p=k?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,q.push(n)),q.push((e/j).toString()));r=l!=null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,l,g.chatId,b):d("MAWDexieTable").dexieResolve();return r.then(function(c){if(c==null){var e,h=d("MAWDbMsg").craftMsgId(g.chatId,g.nextInChatMsgId),i={ack:d("MAWAckLevel").ACK.sent,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:b,externalId:(e=l)!=null?e:d("MAWGlobals").getDependencies().generateExternalId(),msgContent:{adminMsgContent:q,adminType:p},msgId:h,thread:g.chatId,threadJid:g.jid,ts:f,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};return d("MAWWriteMsgTxns").writeMsg(a,i,g).then(function(a){o&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b]);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},i,{rowId:a.rowId}))})}else if(c.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT){var j={ack:d("MAWAckLevel").ACK.sent,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:b,externalId:c.externalId,msgContent:{adminMsgContent:q,adminType:p},msgId:c.msgId,rowId:c.rowId,serverTs:c.serverTs,thread:c.thread,threadJid:c.threadJid,ts:c.ts,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(c.thread,[c])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(j)});if(j.msgId===g.newestMsg)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,j,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:!1,snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId})});return d("WAResultOrError").makeResult(j)});o&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b]);return d("WAResultOrError").makeResult(j)})}else return d("WAResultOrError").makeResult(null)})})}function b(a,b,e,f,g,h){return d("MAWDbContactsTxns").maybeGetContactName(a,b).then(function(i){var j=d("MAWAdminMsgTxnsUtils").getUnknownUserName(),k=d("MAWAdminMsgTxnsUtils").isUnknownName(i);j=i==null||i===""?j:i;var l,m=[],n=b===d("MAWGlobals").getMyUserJid();switch(g){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:n?l=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT:k?l=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT:(l=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,m.push(j));break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:n?l=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN:k?l=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN:(l=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,m.push(j));break;default:throw c("err")("Received unexpected screenshot action type")}return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,h,e.chatId,b).then(function(c){if(c==null){var i=d("MAWDbMsg").craftMsgId(e.chatId,e.nextInChatMsgId),j={ack:d("MAWAckLevel").ACK.received,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:n?d("WAJids").AUTHOR_ME:b,externalId:h,msgContent:{adminMsgContent:m,adminType:l,screenshotActionType:g},msgId:i,thread:e.chatId,threadJid:e.jid,ts:f,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return d("MAWWriteMsgTxns").writeMsg(a,j,e).then(function(a){k&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b]);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},j,{rowId:a.rowId}))})}else if(c.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT){var o={ack:d("MAWAckLevel").ACK.received,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:n?d("WAJids").AUTHOR_ME:b,externalId:c.externalId,msgContent:{adminMsgContent:m,adminType:l,screenshotActionType:g},msgId:c.msgId,rowId:c.rowId,serverTs:c.serverTs,thread:c.thread,threadJid:c.threadJid,ts:c.ts,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return a.messages.put(o).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(c.thread,[c])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(o)});if(o.msgId===e.newestMsg)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,o,e).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:!1,snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:e.chatId})});return d("WAResultOrError").makeResult(o)});k&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b]);return d("WAResultOrError").makeResult(o)})}else return d("WAResultOrError").makeResult(null)})})}g.writeEphemeralSettingAdminMsg=a;g.writeEphemeralScreenshotActionMsg=b}),98);
__d("MAWEphemeralSettingsTxns",["MAWBridgeTypes","MAWDbContactsTxns","MAWDbThreadTxns","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralUtil","MAWGating","MAWGlobals","MAWIndexedDb","MAWJids","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo reset for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo no op for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeResetEphemeralSyncResponseBackoffInfo but missing contact for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received invalid chat jid for incoming ephemeral settings"]);k=function(){return a};return a}function a(a,b,c,e,f,g,h){var i=e.ephemeralExpirationInSec,j=e.ephemeralLastUpdatedOrSetTimestamp,l=d("WAJids").interpretAsUserJid(f);if(l==null){d("WALogger").ERROR(k());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult(null))}var m=d("WAJids").isAuthorMe(b)?d("MAWGlobals").getMyUserJid():b,n=d("MAWJids").toDeviceJid(m,c.id);return d("MAWDbContactsTxns").getContact(a,l).then(function(c){var k,o=c==null?void 0:c.ephemeralSetting,p=o==null||o.ephemeralExpirationInSec===0;if(o!=null&&!d("MAWEphemeralUtil").shouldUpdateContactEphemeralSetting(j,i,o.ephemeralLastUpdatedOrSetTimestamp,o.ephemeralExpirationInSec,n,d("MAWGlobals").getMyDeviceJid()))if(j!==o.ephemeralLastUpdatedOrSetTimestamp)return d("WAResultOrError").makeResult({dbEphemeralSettingMsg:null,outOfSyncEphemeralSetting:{chatJid:f,correctEphemeralExpirationInSec:o.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:o.ephemeralLastUpdatedOrSetTimestamp}});else return d("WAResultOrError").makeResult(null);var q={ephemeralExpirationInSec:i,ephemeralLastUpdatedOrSetTimestamp:j};k=[].concat((k=c==null?void 0:c.devices)!=null?k:[]);m===l&&!k.includes(n)&&k.push(n);c=c==null?{contactJid:l,devices:k,dhash:void 0,ephemeralSetting:q}:babelHelpers["extends"]({},c,{devices:k,ephemeralSetting:q,ephemeralSyncResponseBackoffInfo:void 0});d("MAWIndexedDb").afterTransaction({tag:"EphemeralSettingsUpdatedForUI",value:d("MAWBridgeTypes").createBridgeEphemeralSettingsUpdatedForUI(f,e)});return a.contacts.put(c).then(function(){if(o==null||o.ephemeralExpirationInSec!==i)return d("MAWWriteMsgTxns").writeIncomingEphemeralSettingMsg(a,b,i,g,f,p,null,h).then(function(a){return a.success?d("WAResultOrError").makeResult({dbEphemeralSettingMsg:a.value}):a});else return d("WAResultOrError").makeResult(null)})})}function b(a,b,e,f){var g=e;if(g<0)throw c("err")("Ephemeral duration should be 0 or more");var h=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){return!b.success?{success:!1}:d("MAWDbContactsTxns").getContact(a,h).then(function(c){if(!d("MAWEphemeralUtil").shouldUpdateForOutgoingUserEphemeralSettingChange(c,g,f))return{success:!1};var e,i=!0;if(c==null)e={contactJid:h,devices:[],dhash:void 0,ephemeralSetting:{ephemeralExpirationInSec:g,ephemeralLastUpdatedOrSetTimestamp:f}};else{var j=c.ephemeralSetting;i=j==null||j.ephemeralExpirationInSec===0;e=babelHelpers["extends"]({},c,{ephemeralSetting:{ephemeralExpirationInSec:g,ephemeralLastUpdatedOrSetTimestamp:f}})}return d("MAWDexieTable").dexieAll([a.contacts.put(e),d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(a,d("MAWGlobals").getMyUserJid(),g,f,b.value,i)]).then(function(){return{success:!0}})})})}function e(a,b,e){if(!d("MAWGating").isEphemeralMessagesEnabled())return d("MAWDexieTable").dexieResolve();b=d("MAWEphemeralUtil").getUserJidForEphemeralSetting(b);return d("MAWDbContactsTxns").getContact(a,b).then(function(b){if(b==null||b.ephemeralSetting==null)throw c("err")("Contact and ephemeral setting should not be null when receiving the server ack for outgoing ephemeral setting change");b=babelHelpers["extends"]({},b,{ephemeralSetting:{ephemeralExpirationInSec:b.ephemeralSetting.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:e}});return a.contacts.put(b).then(function(){})})}function f(a,b){var e=d("WAJids").interpretAsUserJid(b);if(e==null)throw c("err")("Unexpected chatJid input to isEphemeralMessagesEnabledForContact");return d("MAWDbContactsTxns").getContact(a,e).then(function(a){if(a==null)return d("WAResultOrError").makeError("no_ephemeral_setting");a=a.ephemeralSetting;return a!=null&&a.ephemeralExpirationInSec>0?d("WAResultOrError").makeResult({outOfSyncEphemeralSetting:{chatJid:b,correctEphemeralExpirationInSec:a.ephemeralExpirationInSec,correctEphemeralLastUpdatedOrSetTimestamp:a.ephemeralLastUpdatedOrSetTimestamp}}):d("WAResultOrError").makeError("no_ephemeral_setting")})}function l(a,b){return d("MAWDbContactsTxns").getContact(a,b).then(function(c){if(c==null){d("WALogger").LOG(j(),b);return d("WAResultOrError").makeError("missing_contact")}if(c.ephemeralSyncResponseBackoffInfo==null){d("WALogger").LOG(i(),b);return d("WAResultOrError").makeResult()}c.ephemeralSyncResponseBackoffInfo=void 0;d("WALogger").LOG(h(),b);return a.contacts.put(c).then(function(){return d("WAResultOrError").makeResult()})})}g.handleAndWriteIncomingEphemeralSetting=a;g.handleAndWriteOutgoingUserEphemeralSettingChange=b;g.updateContactWhenEphemeralSettingChangeMarkedSent=e;g.getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg=f;g.maybeResetEphemeralSyncResponseBackoffInfo=l}),98);
__d("MAWGetContactAndIdentitiesApi",["MAWDbContactsTxns","MAWDbIdentityTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getContactAndIdentitiesForUser",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbContactsTxns").getContact(a,b),d("MAWDbIdentityTxns").getIdentitiesForUser(a,b)]).then(function(a){var b=a[0];a=a[1];if(b==null)return d("WAResultOrError").makeError("missing_contact");else{var c=a.map(function(a){return a.deviceJid});c={contact:{devices:c,dhash:b.dhash,icdcInfo:b.icdcInfo},identities:a.map(function(a){return{deviceJid:a.deviceJid,identity:a.identity}})};return d("WAResultOrError").makeResult(c)}})});g.getContactAndIdentitiesForUser=a}),98);
__d("MAWConvertXMATargetTypeToExtendedContentTargetType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaTargetType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_IMAGE_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_MULTIPOST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SINGLE_VIDEO_POST_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_CLIPS_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_IGTV_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_SHOP_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_PROFILE_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_PHOTO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_VIDEO_HIGHLIGHT_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.IG_STORY_REACTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_STORY_MENTION:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_FEED_VIDEO_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_GAMING_CUSTOM_UPDATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE;case d("EchoMessageXMAFieldUtils").XMAContentType.FB_PRODUCER_STORY_REPLY:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY;case d("EchoMessageXMAFieldUtils").XMAContentType.MSG_EXTERNAL_LINK_SHARE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_MISSED_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_AUDIO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL;case d("EchoMessageXMAFieldUtils").XMAContentType.RTC_GROUP_VIDEO_CALL:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE}}g.convertXMATargetTypeToExtendedContentTargetType=a}),98);
__d("WAConsumerApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={SMALL:1,MEDIUM:2,LARGE:3};b={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5};c={NONE:0,VIDEO:1};e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null),n=babelHelpers["extends"]({},null),o=babelHelpers["extends"]({},null),p=babelHelpers["extends"]({},null),q=babelHelpers["extends"]({},null),r=babelHelpers["extends"]({},null),s=babelHelpers["extends"]({},null),t=babelHelpers["extends"]({},null),u=babelHelpers["extends"]({},null),v=babelHelpers["extends"]({},null),w=babelHelpers["extends"]({},null),x=babelHelpers["extends"]({},null),y=babelHelpers["extends"]({},null),z=babelHelpers["extends"]({},null),A=babelHelpers["extends"]({},null),B=babelHelpers["extends"]({},null),C=babelHelpers["extends"]({},null),D=babelHelpers["extends"]({},null),E=babelHelpers["extends"]({},null),F=babelHelpers["extends"]({},null),G=babelHelpers["extends"]({},null),H=babelHelpers["extends"]({},null),I=babelHelpers["extends"]({},null),J=babelHelpers["extends"]({},null),K=babelHelpers["extends"]({},null);e.internalSpec={payload:[1,d("WAProtoConst").TYPES.MESSAGE,f],metadata:[2,d("WAProtoConst").TYPES.MESSAGE,i]};f.internalSpec={content:[1,d("WAProtoConst").TYPES.MESSAGE,l],applicationData:[2,d("WAProtoConst").TYPES.MESSAGE,k],signal:[3,d("WAProtoConst").TYPES.MESSAGE,j],subProtocol:[4,d("WAProtoConst").TYPES.MESSAGE,h],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};h.internalSpec={futureProof:[1,d("WAProtoConst").TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};i.internalSpec={specialTextSize:[1,d("WAProtoConst").TYPES.ENUM,a]};j.internalSpec={};k.internalSpec={revoke:[1,d("WAProtoConst").TYPES.MESSAGE,t],__oneofs__:{applicationContent:["revoke"]}};l.internalSpec={messageText:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],imageMessage:[2,d("WAProtoConst").TYPES.MESSAGE,G],contactMessage:[3,d("WAProtoConst").TYPES.MESSAGE,y],locationMessage:[4,d("WAProtoConst").TYPES.MESSAGE,B],extendedTextMessage:[5,d("WAProtoConst").TYPES.MESSAGE,A],statusTextMessage:[6,d("WAProtoConst").TYPES.MESSAGE,z],documentMessage:[7,d("WAProtoConst").TYPES.MESSAGE,D],audioMessage:[8,d("WAProtoConst").TYPES.MESSAGE,F],videoMessage:[9,d("WAProtoConst").TYPES.MESSAGE,E],contactsArrayMessage:[10,d("WAProtoConst").TYPES.MESSAGE,x],liveLocationMessage:[11,d("WAProtoConst").TYPES.MESSAGE,w],stickerMessage:[12,d("WAProtoConst").TYPES.MESSAGE,C],groupInviteMessage:[13,d("WAProtoConst").TYPES.MESSAGE,v],viewOnceMessage:[14,d("WAProtoConst").TYPES.MESSAGE,u],reactionMessage:[16,d("WAProtoConst").TYPES.MESSAGE,s],pollCreationMessage:[17,d("WAProtoConst").TYPES.MESSAGE,q],pollUpdateMessage:[18,d("WAProtoConst").TYPES.MESSAGE,p],__oneofs__:{content:["messageText","imageMessage","contactMessage","locationMessage","extendedTextMessage","statusTextMessage","documentMessage","audioMessage","videoMessage","contactsArrayMessage","liveLocationMessage","stickerMessage","groupInviteMessage","viewOnceMessage","reactionMessage","pollCreationMessage","pollUpdateMessage"]}};m.internalSpec={pollOption:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,r]};n.internalSpec={selectedOptions:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.BYTES],senderTimestampMs:[2,d("WAProtoConst").TYPES.INT64]};o.internalSpec={encPayload:[1,d("WAProtoConst").TYPES.BYTES],encIv:[2,d("WAProtoConst").TYPES.BYTES]};p.internalSpec={pollCreationMessageKey:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec],vote:[2,d("WAProtoConst").TYPES.MESSAGE,o],addOption:[3,d("WAProtoConst").TYPES.MESSAGE,o]};q.internalSpec={encKey:[1,d("WAProtoConst").TYPES.BYTES],name:[2,d("WAProtoConst").TYPES.STRING],options:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,r],selectableOptionsCount:[4,d("WAProtoConst").TYPES.UINT32]};r.internalSpec={optionName:[1,d("WAProtoConst").TYPES.STRING]};s.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec],text:[2,d("WAProtoConst").TYPES.STRING],groupingKey:[3,d("WAProtoConst").TYPES.STRING],senderTimestampMs:[4,d("WAProtoConst").TYPES.INT64]};t.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageKeySpec]};u.internalSpec={imageMessage:[1,d("WAProtoConst").TYPES.MESSAGE,G],videoMessage:[2,d("WAProtoConst").TYPES.MESSAGE,E],__oneofs__:{viewOnceContent:["imageMessage","videoMessage"]}};v.internalSpec={groupJid:[1,d("WAProtoConst").TYPES.STRING],inviteCode:[2,d("WAProtoConst").TYPES.STRING],inviteExpiration:[3,d("WAProtoConst").TYPES.INT64],groupName:[4,d("WAProtoConst").TYPES.STRING],jpegThumbnail:[5,d("WAProtoConst").TYPES.BYTES],caption:[6,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec]};w.internalSpec={location:[1,d("WAProtoConst").TYPES.MESSAGE,J],accuracyInMeters:[2,d("WAProtoConst").TYPES.UINT32],speedInMps:[3,d("WAProtoConst").TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[4,d("WAProtoConst").TYPES.UINT32],caption:[5,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],sequenceNumber:[6,d("WAProtoConst").TYPES.INT64],timeOffset:[7,d("WAProtoConst").TYPES.UINT32]};x.internalSpec={displayName:[1,d("WAProtoConst").TYPES.STRING],contacts:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,y]};y.internalSpec={contact:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec]};z.internalSpec={text:[1,d("WAProtoConst").TYPES.MESSAGE,A],textArgb:[6,d("WAProtoConst").TYPES.FIXED32],backgroundArgb:[7,d("WAProtoConst").TYPES.FIXED32],font:[8,d("WAProtoConst").TYPES.ENUM,b]};A.internalSpec={text:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],matchedText:[2,d("WAProtoConst").TYPES.STRING],canonicalUrl:[3,d("WAProtoConst").TYPES.STRING],description:[4,d("WAProtoConst").TYPES.STRING],title:[5,d("WAProtoConst").TYPES.STRING],thumbnail:[6,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],previewType:[7,d("WAProtoConst").TYPES.ENUM,c]};B.internalSpec={location:[1,d("WAProtoConst").TYPES.MESSAGE,J],address:[2,d("WAProtoConst").TYPES.STRING]};C.internalSpec={sticker:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec]};D.internalSpec={document:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec]};E.internalSpec={video:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],caption:[2,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec]};F.internalSpec={audio:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],ptt:[2,d("WAProtoConst").TYPES.BOOL]};G.internalSpec={image:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],caption:[2,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec]};H.internalSpec={polygonVertices:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,I],location:[2,d("WAProtoConst").TYPES.MESSAGE,J],__oneofs__:{action:["location"]}};I.internalSpec={x:[1,d("WAProtoConst").TYPES.DOUBLE],y:[2,d("WAProtoConst").TYPES.DOUBLE]};J.internalSpec={degreesLatitude:[1,d("WAProtoConst").TYPES.DOUBLE],degreesLongitude:[2,d("WAProtoConst").TYPES.DOUBLE],name:[3,d("WAProtoConst").TYPES.STRING]};K.internalSpec={protocol:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec]};g.CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE=a;g.CONSUMER_APPLICATION_STATUS_TEXT_MESAGE_FONT_TYPE=b;g.CONSUMER_APPLICATION_EXTENDED_TEXT_MESSAGE_PREVIEW_TYPE=c;g.ConsumerApplicationSpec=e;g.ConsumerApplication$PayloadSpec=f;g.ConsumerApplication$SubProtocolPayloadSpec=h;g.ConsumerApplication$MetadataSpec=i;g.ConsumerApplication$SignalSpec=j;g.ConsumerApplication$ApplicationDataSpec=k;g.ConsumerApplication$ContentSpec=l;g.ConsumerApplication$PollAddOptionMessageSpec=m;g.ConsumerApplication$PollVoteMessageSpec=n;g.ConsumerApplication$PollEncValueSpec=o;g.ConsumerApplication$PollUpdateMessageSpec=p;g.ConsumerApplication$PollCreationMessageSpec=q;g.ConsumerApplication$OptionSpec=r;g.ConsumerApplication$ReactionMessageSpec=s;g.ConsumerApplication$RevokeMessageSpec=t;g.ConsumerApplication$ViewOnceMessageSpec=u;g.ConsumerApplication$GroupInviteMessageSpec=v;g.ConsumerApplication$LiveLocationMessageSpec=w;g.ConsumerApplication$ContactsArrayMessageSpec=x;g.ConsumerApplication$ContactMessageSpec=y;g.ConsumerApplication$StatusTextMesageSpec=z;g.ConsumerApplication$ExtendedTextMessageSpec=A;g.ConsumerApplication$LocationMessageSpec=B;g.ConsumerApplication$StickerMessageSpec=C;g.ConsumerApplication$DocumentMessageSpec=D;g.ConsumerApplication$VideoMessageSpec=E;g.ConsumerApplication$AudioMessageSpec=F;g.ConsumerApplication$ImageMessageSpec=G;g.ConsumerApplication$InteractiveAnnotationSpec=H;g.ConsumerApplication$PointSpec=I;g.ConsumerApplication$LocationSpec=J;g.ConsumerApplication$MediaPayloadSpec=K}),98);
__d("WAMediaTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={NONE:0,GIPHY:1,TENOR:2};b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null),n=babelHelpers["extends"]({},null),o=babelHelpers["extends"]({},null),p=babelHelpers["extends"]({},null),q=babelHelpers["extends"]({},null),r=babelHelpers["extends"]({},null),s=babelHelpers["extends"]({},null),t=babelHelpers["extends"]({},null),u=babelHelpers["extends"]({},null),v=babelHelpers["extends"]({},null),w=babelHelpers["extends"]({},null),x=babelHelpers["extends"]({},null),y=babelHelpers["extends"]({},null),z=babelHelpers["extends"]({},null);b.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,h],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,c]};c.internalSpec={fileLength:[1,d("WAProtoConst").TYPES.UINT64],mimetype:[2,d("WAProtoConst").TYPES.STRING],thumbnail:[3,d("WAProtoConst").TYPES.MESSAGE,e],objectId:[4,d("WAProtoConst").TYPES.STRING]};e.internalSpec={jpegThumbnail:[1,d("WAProtoConst").TYPES.BYTES],downloadableThumbnail:[2,d("WAProtoConst").TYPES.MESSAGE,f],thumbnailWidth:[3,d("WAProtoConst").TYPES.UINT32],thumbnailHeight:[4,d("WAProtoConst").TYPES.UINT32]};f.internalSpec={fileSha256:[1,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[2,d("WAProtoConst").TYPES.BYTES],directPath:[3,d("WAProtoConst").TYPES.STRING],mediaKey:[4,d("WAProtoConst").TYPES.BYTES],mediaKeyTimestamp:[5,d("WAProtoConst").TYPES.INT64],objectId:[6,d("WAProtoConst").TYPES.STRING]};h.internalSpec={fileSha256:[1,d("WAProtoConst").TYPES.BYTES],mediaKey:[2,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[3,d("WAProtoConst").TYPES.BYTES],directPath:[4,d("WAProtoConst").TYPES.STRING],mediaKeyTimestamp:[5,d("WAProtoConst").TYPES.INT64]};i.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,k],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,j]};j.internalSpec={height:[1,d("WAProtoConst").TYPES.UINT32],width:[2,d("WAProtoConst").TYPES.UINT32],scansSidecar:[3,d("WAProtoConst").TYPES.BYTES],scanLengths:[4,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.UINT32],midQualityFileSha256:[5,d("WAProtoConst").TYPES.BYTES]};k.internalSpec={transport:[1,d("WAProtoConst").TYPES.MESSAGE,b]};l.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,n],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,m]};m.internalSpec={seconds:[1,d("WAProtoConst").TYPES.UINT32],caption:[2,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],gifPlayback:[3,d("WAProtoConst").TYPES.BOOL],height:[4,d("WAProtoConst").TYPES.UINT32],width:[5,d("WAProtoConst").TYPES.UINT32],sidecar:[6,d("WAProtoConst").TYPES.BYTES],gifAttribution:[7,d("WAProtoConst").TYPES.ENUM,a]};n.internalSpec={transport:[1,d("WAProtoConst").TYPES.MESSAGE,b]};o.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,q],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,p]};p.internalSpec={seconds:[1,d("WAProtoConst").TYPES.UINT32]};q.internalSpec={transport:[1,d("WAProtoConst").TYPES.MESSAGE,b]};r.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,t],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,s]};s.internalSpec={pageCount:[1,d("WAProtoConst").TYPES.UINT32]};t.internalSpec={transport:[1,d("WAProtoConst").TYPES.MESSAGE,b]};u.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,w],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,v]};v.internalSpec={pageCount:[1,d("WAProtoConst").TYPES.UINT32],height:[2,d("WAProtoConst").TYPES.UINT32],width:[3,d("WAProtoConst").TYPES.UINT32],firstFrameLength:[4,d("WAProtoConst").TYPES.UINT32],firstFrameSidecar:[5,d("WAProtoConst").TYPES.BYTES]};w.internalSpec={transport:[1,d("WAProtoConst").TYPES.MESSAGE,b],isAnimated:[2,d("WAProtoConst").TYPES.BOOL]};x.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,z],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,y]};y.internalSpec={displayName:[1,d("WAProtoConst").TYPES.STRING]};z.internalSpec={vcard:[1,d("WAProtoConst").TYPES.STRING],downloadableVcard:[2,d("WAProtoConst").TYPES.MESSAGE,b],__oneofs__:{contact:["vcard","downloadableVcard"]}};g.VIDEO_TRANSPORT_ANCILLARY_ATTRIBUTION=a;g.WAMediaTransportSpec=b;g.WAMediaTransport$AncillarySpec=c;g.WAMediaTransport$Ancillary$ThumbnailSpec=e;g.WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnailSpec=f;g.WAMediaTransport$IntegralSpec=h;g.ImageTransportSpec=i;g.ImageTransport$AncillarySpec=j;g.ImageTransport$IntegralSpec=k;g.VideoTransportSpec=l;g.VideoTransport$AncillarySpec=m;g.VideoTransport$IntegralSpec=n;g.AudioTransportSpec=o;g.AudioTransport$AncillarySpec=p;g.AudioTransport$IntegralSpec=q;g.DocumentTransportSpec=r;g.DocumentTransport$AncillarySpec=s;g.DocumentTransport$IntegralSpec=t;g.StickerTransportSpec=u;g.StickerTransport$AncillarySpec=v;g.StickerTransport$IntegralSpec=w;g.ContactTransportSpec=x;g.ContactTransport$AncillarySpec=y;g.ContactTransport$IntegralSpec=z}),98);
__d("MAWAsConsumerApplication",["I64","LSMessageContentType.re","MAWDbMedia","MAWGating","MAWGlobals","MAWVault","WAAssertUnreachable","WAConsumerApplication.pb","WAJids","WALogger","WAMediaTransport.pb","WAMediaUtils","WAMsgType","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encodeValidatedMediaToImageTransport - jpegThumbnailDisabled: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encodeValidatedMediaToImageTransport - jpegThumbnailDisabled: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing jpegThumbnail from Transport"]);j=function(){return a};return a}var k="image/jpeg",l="video/mp4",m="audio/wav",n="image/gif",o="image/webp",p=new ArrayBuffer(0);function a(a,b,e){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return r(a);case d("WAMsgType").MSG_TYPE.IMAGE:return t(a,b);case d("WAMsgType").MSG_TYPE.VIDEO:return B(a,b);case d("WAMsgType").MSG_TYPE.PTT:return E(a,b);case d("WAMsgType").MSG_TYPE.REVOKED:return H(a);case d("WAMsgType").MSG_TYPE.GIF:return B(a,b);case d("WAMsgType").MSG_TYPE.STICKER:return y(a,b);case d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION:return null;case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:throw c("err")("Implemented ephemeral setting message in MAWAsConsumerApplication");case d("WAMsgType").MSG_TYPE.XMA:throw c("err")("XMA content message is not consumer application. It should be addressed as ArmadilloApplication");case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:throw c("err")("We do not support converting to protoMsg with "+a.type+" type","messenger_e2ee_web");case d("WAMsgType").MSG_TYPE.GROUP_INVITE:return I(a,e);default:return c("WAAssertUnreachable")(a.type)}}function b(a,b){if(b==null)return q(a);else switch(b.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return u(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return C(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.PTT:return F(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.GIF:return C(a.msgId,b);case d("MAWDbMedia").MEDIA_TYPE.STICKER:return z(a.msgId,b);default:return null}}function q(a){var b=null;if(a.type===d("WAMsgType").MSG_TYPE.REVOKED&&a.msgContent!=null&&a.msgContent.content!=null)b=a.msgContent.content;else if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME&&a.msgContent!=null)b=a.msgContent;else return null;return{payload:{content:{messageText:{mentionedJid:[],text:d("MAWVault").unvault(b)}}}}}function r(a){var b={payload:{content:{messageText:{mentionedJid:[],text:d("MAWVault").unvault(a.msgContent.content)}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function s(a,b){if(b==null)throw c("err")("DbMedia is null in validateMediaAndComposeEntryForProtoMsg");if(!b.msgIds.includes(a))throw c("err")("the media ("+b.mediaId+") is not linked to the msg ("+a+")");a=b.mediaEntries.get(a);if(a==null)throw c("err")("media entry not found in validateMediaAndComposeEntryForProtoMsg");var e=b.plaintextHash,f=d("WAMediaUtils").mediaEntryDataToRawData(e,a);e=["fileSha256","mediaKey","fileEncSha256","directPath","mediaKeyTimestamp"];a=e.filter(function(a){return f[a]==null});if(a.length>0)throw c("err")("missing fields in mediaEntryData: "+a.toString());return[b,f]}function t(a,b){return u(a.msgId,b)}function u(a,b){a=s(a,b);b=a[0];a=a[1];return x(b,a)}function v(a){var b;if(((b=a.integral)==null?void 0:(b=b.transport)==null?void 0:(b=b.ancillary)==null?void 0:(b=b.thumbnail)==null?void 0:b.jpegThumbnail)!=null){d("WALogger").LOG(j());return babelHelpers["extends"]({},a,{integral:babelHelpers["extends"]({},a.integral,{transport:babelHelpers["extends"]({},a.integral.transport,{ancillary:babelHelpers["extends"]({},a.integral.transport.ancillary,{thumbnail:babelHelpers["extends"]({},a.integral.transport.ancillary.thumbnail,{jpegThumbnail:void 0})})})})})}return a}function w(a,b){var c,e;c=((c=a.validatedImageInfo)==null?void 0:c.jpegThumbnail)!=null||b.downloadableThumbnail!=null;var f=b.downloadableThumbnail!=null?{directPath:b.downloadableThumbnail.directPath,fileEncSha256:b.downloadableThumbnail.fileEncSha256,fileSha256:b.downloadableThumbnail.fileSha256,mediaKey:b.downloadableThumbnail.mediaKey,mediaKeyTimestamp:b.downloadableThumbnail.mediaKeyTimestamp}:null;e={ancillary:{height:(e=a.validatedImageInfo)==null?void 0:e.height,scanLengths:[],width:(e=a.validatedImageInfo)==null?void 0:e.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:k,objectId:b.objectId,thumbnail:c?{downloadableThumbnail:f,jpegThumbnail:(e=a.validatedImageInfo)==null?void 0:e.jpegThumbnail,thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(f=a.validatedImageInfo)==null?void 0:f.jpegThumbnailWidth}:{}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};c=d("MAWGating").isJpegThumbnailOverChatdDisabled();d("WALogger").LOG(i(),c);c&&(e=v(e));return d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,e).readBuffer()}function x(a,b){a=w(a,b);return{payload:{content:{imageMessage:{caption:{mentionedJid:[]},image:{payload:a,version:1}}}}}}function y(a,b){return z(a.msgId,b)}function z(a,b){a=s(a,b);b=a[0];a=a[1];return A(b,a)}function A(a,b){var c;a={ancillary:{height:(c=a.validatedImageInfo)==null?void 0:c.height,width:(c=a.validatedImageInfo)==null?void 0:c.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:o,objectId:b.objectId,thumbnail:{thumbnailHeight:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailHeight,thumbnailWidth:(c=a.validatedImageInfo)==null?void 0:c.jpegThumbnailWidth}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};c=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,a);return{payload:{content:{stickerMessage:{sticker:{payload:c.readBuffer(),version:1}}}}}}function B(a,b){return C(a.msgId,b)}function C(a,b){a=s(a,b);b=a[0];a=a[1];return D(b,a)}function D(a,b){var c,e=a.mediaType===d("MAWDbMedia").MEDIA_TYPE.GIF,f=e?a.validatedImageInfo:a.validatedVideoInfo,g=(f==null?void 0:f.jpegThumbnail)!=null||b.downloadableThumbnail!=null,i=b.downloadableThumbnail!=null?{directPath:b.downloadableThumbnail.directPath,fileEncSha256:b.downloadableThumbnail.fileEncSha256,fileSha256:b.downloadableThumbnail.fileSha256,mediaKey:b.downloadableThumbnail.mediaKey,mediaKeyTimestamp:b.downloadableThumbnail.mediaKeyTimestamp}:null;c={ancillary:{gifPlayback:e,height:f==null?void 0:f.height,seconds:e?void 0:(c=a.validatedVideoInfo)==null?void 0:c.duration,sidecar:b.sidecar,width:f==null?void 0:f.width},integral:{transport:{ancillary:{fileLength:a.size,mimetype:e?n:l,objectId:b.objectId,thumbnail:e?{thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}:g?{downloadableThumbnail:i,jpegThumbnail:f==null?void 0:f.jpegThumbnail,thumbnailHeight:f==null?void 0:f.jpegThumbnailHeight,thumbnailWidth:f==null?void 0:f.jpegThumbnailWidth}:{}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("MAWGating").isJpegThumbnailOverChatdDisabled();d("WALogger").LOG(h(),a);a&&(c=v(c));e=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,c);return{payload:{content:{videoMessage:{caption:{mentionedJid:[]},video:{payload:e.readBuffer(),version:1}}}}}}function E(a,b){return F(a.msgId,b)}function F(a,b){a=s(a,b);b=a[0];a=a[1];return G(b,a)}function G(a,b){var c;c={ancillary:{seconds:(c=a.validatedAudioInfo)==null?void 0:c.duration},integral:{transport:{ancillary:{fileLength:a.size,mimetype:m,objectId:b.objectId,thumbnail:{jpegThumbnail:p}},integral:{directPath:b.directPath,fileEncSha256:b.fileEncSha256,fileSha256:b.fileSha256,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp}}}};a=d("encodeProtobuf").encodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,c);return{payload:{content:{audioMessage:{audio:{payload:a.readBuffer(),version:1},ptt:!0}}}}}function H(a){return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:a.revokedExternalId}}}}}}function e(a){var b=d("WAJids").isAuthorMe(a.reactToAuthor)||d("MAWGlobals").getMyUserJid()===a.reactToAuthor,c=d("WAJids").interpretAsGroupJid(a.threadJid)!=null;c={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:{fromMe:b,id:a.reactToExternalId,participant:c&&!b?a.reactToAuthor:void 0,remoteJid:a.threadJid},senderTimestampMs:a.ts,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:c}}}}function I(a,b){if(a.threadJid==null)throw c("err")("msg threadJid is null in encodeGroupInviteMessage");if(b==null)throw c("err")("DbGroupInvite is null in encodeGroupInviteMessage");var e=d("WAJids").interpretAsGroupJid(a.threadJid);if(e==null)throw c("err")("groupJid is null in encodeGroupInviteMessage");return{payload:{content:{groupInviteMessage:{groupJid:e,groupName:a.groupName,inviteCode:b.inviteCode,inviteExpiration:b.inviteExpirationTs}}}}}function f(a){return d("I64").equal(a.displayedContentTypes,c("LSMessageContentType.re").text)||d("I64").equal(a.displayedContentTypes,c("LSMessageContentType.re").tombstone)||a.textHasLinks||a.isUnsent?J(a):null}function J(a){return{payload:{content:{messageText:{mentionedJid:[],text:a.text}}}}}g.IMAGE_MIME_TYPE=k;g.VIDEO_MIME_TYPE=l;g.AUDIO_MIME_TYPE=m;g.GIF_MIME_TYPE=n;g.STICKER_MIME_TYPE=o;g.emptyAudioFileArrayBuffer=p;g.asConsumerApplication=a;g.deletedMsgAsConsumerApplicationForSpamReporting=b;g.encodeMessageText=r;g.validateMediaAndComposeEntryForProtoMsg=s;g.encodeImageMessage=t;g.encodeValidatedMediaToImageTransport=w;g.encodeStickerMessage=y;g.encodeVideoMessage=B;g.encodeAudioMessage=E;g.encodeReactionMessage=e;g.encodeGroupInviteMessage=I;g.asConsumerApplicationLSDb=f}),98);
__d("MAWDownloadManager",[],(function(a,b,c,d,e,f){"use strict";var g=1e4;a=function(){function a(){this.$1=[],this.$2=new Map()}var b=a.prototype;b.setToDownloadManager=function(a,b){this.$3(),this.$2.set(a,b),this.$1.push(a)};b.getFromDownloadManager=function(a){return this.$2.get(a)};b.removeFromMediaDownloadManager=function(a){this.$2["delete"](a);var b=this.$1.filter(function(b){return b!==a});this.setDownloadManagerQueue(b)};b.setDownloadManagerQueue=function(a){this.$1=a};b.$3=function(){if(this.$1.length>=g){var a=this.$1.shift();this.$2["delete"](a)}};return a}();f.DownloadManager=a}),66);
__d("MAWMediaDownloadManager",["MAWDownloadManager"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("MAWDownloadManager").DownloadManager)();function a(a,b){h.setToDownloadManager(a,b)}function b(a){return h.getFromDownloadManager(a)}function c(a){h.removeFromMediaDownloadManager(a)}g.setToMediaDownloadManager=a;g.getFromMediaDownloadManager=b;g.removeFromMediaDownloadManager=c}),98);
__d("MAWHandleMediaDownloadApi",["MAWBridgeTypes","MAWDbChunkTxns","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaDownloadManager","MAWMediaUtils","MAWTransactionMode","Promise","WAArmadilloXMA.pb","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("handleMediaDownload",!1)))(function(a,e,f,g,h){var i=d("MAWMediaUtils").genHMACPlaintextHash(e);return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,h),a.media.where("hashedPlaintextHash").equals(i).first(),d("MAWDbChunkTxns").getOrCreateMediaChunk(a,e,i,g,f)]).then(function(a){var e=a[0],h=a[1];a[2];if(h==null)throw c("err")("media is null when storing downloaded blob");a=d("MAWMediaDownloadManager").getFromMediaDownloadManager(h.mediaId);a!=null&&(a(b("Promise").resolve(new Blob([g],{type:f}))),d("MAWMediaDownloadManager").removeFromMediaDownloadManager(h.mediaId));if(e&&(e.type===d("WAMsgType").MSG_TYPE.XMA||((a=e.quote)==null?void 0:a.content.xmaMessageType)===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY)&&d("MAWGating").isXMAFeedPostShareEnabled())return;e=h.msgIds.map(d("MAWDbMsg").getThreadIdFromMsgId);e.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(a,h,!0)})})})});g.handleMediaDownload=a}),98);
__d("MAWMediaPreviewDownloadManager",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=[],j=new Map();function a(a){k();var b=new(d("WAResolvable").Resolvable)();j.set(a,b);i.push(a)}function b(a){return j.get(a)}function c(a){j["delete"](a)}function k(){if(i.length>=h){var a=i.shift();j["delete"](a)}}function e(){i=[],j.clear()}g.markMediaPreviewAsDownloading=a;g.getMediaPreviewDownloadingResolvable=b;g.removeMediaPreviewDownloadingResolvable=c;g.clear=e}),98);
__d("MAWHandleMediaPreviewBeforeDownloadApi",["MAWMediaPreviewDownloadManager","MAWMediaUtils","Promise"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){a=d("MAWMediaUtils").genHMACPlaintextHash(a);d("MAWMediaPreviewDownloadManager").markMediaPreviewAsDownloading(a);return b("Promise").resolve()};g.handleMediaPreviewBeforeDownload=a}),98);
__d("MAWHandleMediaPreviewDownloadApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaPreviewDownloadManager","MAWMediaUtils","MAWTransactionMode","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: preview - media is null"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("handleMediaPreviewDownload",!1)))(function(a,b,e,f){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.media.get({hashedPlaintextHash:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());throw c("err")("media: preview - media is null")}var g=d("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(b.hashedPlaintextHash);g!=null&&(g.resolve(new Blob([e],{type:"image/jpeg"})),d("MAWMediaPreviewDownloadManager").removeMediaPreviewDownloadingResolvable(b.hashedPlaintextHash));switch(f){case"image":a.media.update(b.mediaId,babelHelpers["extends"]({},b,{validatedImageInfo:babelHelpers["extends"]({},b.validatedImageInfo,{jpegThumbnail:e})}));break;case"video":a.media.update(b.mediaId,babelHelpers["extends"]({},b,{validatedVideoInfo:babelHelpers["extends"]({},b.validatedVideoInfo,{jpegThumbnail:e})}));break;default:f;break}})});g.handleMediaPreviewDownload=a}),98);
__d("MAWCastToServerMediaType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"image":case"xma-image":case"video":case"ptt":case"gif":case"sticker":return a;default:return null}}f.castToServerMediaType=a}),66);
__d("MAWUpdateMediaEntryForMsgApi",["FBLogger","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWCastToServerMediaType","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWMediaBackupTxns","MAWMediaUtils","MAWTransactionMode","WALogger","WAMediaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required arguments for media backup"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Nothing to update if updatedMediaEntry is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," msgId does not exist within media entries"]);j=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateMediaEntryForMsg",!1)))(function(a,b,e,f,g,k){var l=d("MAWCastToServerMediaType").castToServerMediaType(k);if(!l){var m;c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Media type unsupported: "+((m=k)!=null?m:""))}m=d("MAWMediaUtils").genHMACPlaintextHash(b);return d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").maybeGetMediaFromHash(a,m),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e)]).then(function(b){var m=b[0],n=b[1];if(!n)throw c("err")("Message does not exist for the given protocolMsgId");if(!m)throw c("err")("Media does not exist for the given hashedPlaintextHash");if(!m.msgIds.includes(n.msgId)){d("WALogger").LOG(j(),n.msgId);return}b=m.mediaEntries;var o=b.get(n.msgId);o=f(o);if(o==null){d("WALogger").LOG(i());return}b=babelHelpers["extends"]({},m,{mediaEntries:b.set(n.msgId,o)});g!=null&&(b=babelHelpers["extends"]({},b,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(g)}));return a.media.put(b).then(function(b){return g!=null?d("MAWMediaBackupTxns").linkMediaBackup(a,m.mediaId,n.msgId,d("WAMediaUtils").stringToDeliveryObjectId(g)):d("MAWDexieTable").dexieResolve()}).then(function(){if(d("MAWGating").isAttachmentBackupEnabled()){var a=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(k);g!=null&&a!=null?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(g,l,e.externalId,d("MAWGlobals").getConfig().productTypeForEBAttachments,d("MAWJidUtils").threadIdForChatJid(e.chat))}):d("WALogger").WARN(h())}})})});g.updateMediaEntryForMsg=a}),98);
__d("WADecimalStringMod",["WAErr","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string']);i=function(){return a};return a}function a(a,b){if(!/^\d+$/.test(a)){d("WALogger").ERROR(i(),a);throw c("WAErr")("decimalStringMod is given an invalid decimal string")}var e=a.length;if(e<16||e===16&&a<="9007199254740991")return Number(a)%b;if(e>20||e===20&&a>"18446744073709551615"){d("WALogger").ERROR(h(),a);throw c("WAErr")("decimalStringMod is given value over 64 bits")}e=0;for(var f=0;f<a.length;f++){var g=Number(a[f]);e=(e*10+g)%b}return e}g.decimalStringMod=a}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]);h=function(){return a};return a}function a(a,b){return function(){return b==null?null:d("WAArrayBufferUtils").arrayBufferMod(a,b)+100}}function b(a,b){return function(){if(b==null)return null;var c=a.split("/");c=c[c.length-1];c=c.split("_")[1];if(c==null){d("WALogger").ERROR(h());return null}else return d("WADecimalStringMod").decimalStringMod(c,b)+100}}g.createGetVcaEnabledBucket=a;g.msgrCreateGetVcaEnabledBucket=b}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(a,b,c,d,e,f,g){function a(a){if(a==null)return null;a=h(a);if(a.has("_nc_hot")){a=parseInt(a.get("_nc_hot"),10);return Number.isInteger(a)?d("WATimeUtils").castToUnixTime(a):null}else return null}function h(a){a=a.split("?");return new URLSearchParams(a.length===2?a[1]:"")}g.extractNcHotTimestamp=a}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAErr","WAHasProperty","WAXmlParsingFailure"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("WAErr")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WAWapDict",[],(function(a,b,c,d,e,f){a=2;b=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];c=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];d=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];e=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];var g=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"],h=[c,d,e,g];f.DICT_VERSION=a;f.SINGLE_BYTE_TOKEN=b;f.DICTIONARY_0_TOKEN=c;f.DICTIONARY_1_TOKEN=d;f.DICTIONARY_2_TOKEN=e;f.DICTIONARY_3_TOKEN=g;f.DICTIONARIES=h}),66);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(a,b,c,d,e,f,g){var h={JID:0,JID_U:1,JID_AD:1,JID_FB:3},i=b("$InternalEnum")({WHATSAPP:0,LID:1});a=function(){function a(a){this.$1=a}a.createAD=function(b,c,d){return new a({type:h.JID_AD,user:b,device:d==null?0:d,agent:c==null?0:c,domainType:i.WHATSAPP})};a.createJidU=function(b,c,d){return new a({type:h.JID_U,user:b,device:d==null?0:d,domainType:c==null?i.WHATSAPP:c})};a.createFbJid=function(b,c){c=c==null?0:c;return new a({type:h.JID_FB,user:b,device:c})};a.create=function(b,c){return new a({type:h.JID,user:b,server:c})};var b=a.prototype;b.toString=function(){if(this.$1.type===h.JID_AD||this.$1.type===h.JID_U){var a=this.$1,b=a.user,c=a.device;a=a.domainType;a=a===i.WHATSAPP?d("WAJids").WA_USER_JID_SUFFIX:d("WAJids").LID_SUFFIX;return c===0?b+"@"+a:b+":"+c+"@"+a}else if(this.$1.type===h.JID_FB){b=this.$1;c=b.user;a=b.device;b=d("WAJids").MSGR_USER_JID_SUFFIX;return c+":"+a+"@"+b}else{this.$1.type;c=this.$1;a=c.user;b=c.server;return a!=null?a+"@"+b:b}};b.getInnerJid=function(){return this.$1};return a}();g.WAP_JID_SUBTYPE=h;g.DomainType=i;g.WapJid=a}),98);
__d("WAXmlFormatter",[],(function(a,b,c,d,e,f){function a(a){a=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~");var b=a.length,c=!1,d=0,e="",f=0,g=["\n"];for(f=0;f<100;f++)g.push(g[f]+"    ");var h=function(b,a){var c=/^<[\w:\-.,]+/.exec(b[a-1]);b=/^<\/[\w:\-.,]+/.exec(b[a]);return c!=null&&b!=null&&c[0]===b[0]};for(f=0;f<b;f++)a[f].search(/<!/)>-1?(e+=g[d]+a[f],c=!0,(a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1||a[f].search(/!DOCTYPE/)>-1)&&(c=!1)):a[f].search(/-->/)>-1||a[f].search(/\]>/)>-1?(e+=a[f],c=!1):h(a,f)?(e+=a[f],c||d--):a[f].search(/<\w/)>-1&&a[f].search(/<\//)===-1&&a[f].search(/\/>/)===-1?e=c?e+=a[f]:e+=g[d++]+a[f]:a[f].search(/<\w/)>-1&&a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=g[d]+a[f]:a[f].search(/<\//)>-1?e=c?e+=a[f]:e+=g[d===0?d:--d]+a[f]:a[f].search(/\/>/)>-1?e=c?e+=a[f]:e+=g[d]+a[f]:a[f].search(/<\?/)>-1?e+=g[d]+a[f]:a[f].search(/xmlns:/)>-1||a[f].search(/xmlns=/)>-1?e+=g[d]+a[f]:e+=a[f];return e[0]==="\n"?e.slice(1):e}f["default"]=a}),66);
__d("WAXmlNode",["WAHex"],(function(a,b,c,d,e,f,g){var h={};a=function(){function a(a,b,c){b===void 0&&(b=h),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=i(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b instanceof Uint8Array?a+=">"+j(b)+"</"+this.tag+">":b!=null?a+=">"+String(b)+"</"+this.tag+">":a+=" />";return a};return a}();function i(a){var b=Object.keys(a),c="";for(var d=0;d<b.length;d++){var e=b[d];c+=" "+e+'="'+a[e].toString()+'"'}return c}function j(a){var b;a.length===0?b="<!-- empty binary -->":a.length<50?b=d("WAHex").bytesToDebugString(a):b="<!-- "+a.length+" bytes -->";return b}g.XmlNode=a;g.attrsToString=i;g.uint8ArrayToDebugString=j}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WAErr","WAJids","WALogger","WALongInt","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeNullableString got invalid value: ",", string expected"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeString got invalid value: ",", string expected"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]);j=function(){return a};return a}var k=d("WAJids").MSGR_USER_DOMAIN.replace("@",""),l=d("WAJids").WA_USER_DOMAIN.replace("@",""),m=d("WAJids").LID_DOMAIN.replace("@",""),aa=2,ba=128,n=0,o=236,p=237,q=238,r=239,ca=[o,p,q,r],s=246,t=247,u=248,v=249,w=250,x=251,y=252,z=253,A=254,B=255,da=["0","1","2","3","4","5","6","7","8","9","-",".","\ufffd","\ufffd","\ufffd","\ufffd"],ea=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],C="",fa=1,D={sentinel:"DROP_ATTR"},E=d("WAWapJid").WapJid.create(null,"g.us"),F=d("WAWapJid").WapJid.create(null,d("WAJids").WA_SERVER_JID_SUFFIX);p=d("WAWapJid").WapJid.create("status","broadcast");var G=d("WAWapJid").WapJid.create(null,"newsletter"),H={},I=!1;function a(){I=!0}var J=function(){function a(a,b,c){b===void 0&&(b=H),c===void 0&&(c=null),this.tag=a,this.attrs=b,this.content=c}var b=a.prototype;b.toString=function(){var a="<"+this.tag;a+=d("WAXmlNode").attrsToString(this.attrs);var b=this.content;Array.isArray(b)?a+=">"+b.map(String).join("")+"</"+this.tag+">":b?a+=">"+d("WAXmlNode").uint8ArrayToDebugString(b)+"</"+this.tag+">":a+=" />";I&&(a=c("WAXmlFormatter")(a));return a};return a}();function b(a,b,e){var f=null;if(b&&b.children!=null)throw c("WAErr")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(e))f=e.filter(Boolean);else if(typeof e==="string")f=d("WABinary").Binary.build(e).readByteArray();else if(e instanceof ArrayBuffer)f=new Uint8Array(e);else if(e instanceof Uint8Array)f=e;else{var g=[];for(var h=2;h<arguments.length;h++){var i=arguments[h];i&&g.push(i)}f=g}Array.isArray(f)&&f.length===0&&(f=null);var j={};if(b){var k=b;Object.keys(k).forEach(function(b){var d=k[b];if(d==null)throw c("WAErr")("Attr "+b+" in <"+a+"> is null");if(d===D)return;j[b]=d})}return new J(a,j,f)}q=b;function e(a){return a instanceof d("WAWapJid").WapJid?a.toString():a}function K(a){var b=a.content;Array.isArray(b)?b=b.map(K):typeof b==="string"&&(b=d("WABinary").Binary.build(b).readByteArray());return new J(a.tag,a.attrs||H,b)}function f(a){a=a instanceof J?a:K(a);var b=new(d("WABinary").Binary)();L(a,b);a=0;b=b.readByteArray();var c=new Uint8Array(1+b.length);c[0]=a;c.set(b,1);return c}function L(a,b){if(a==null)b.writeUint8(n);else if(a instanceof J)M(a,b);else if(a instanceof d("WAWapJid").WapJid)ga(a,b);else if(typeof a==="string")Q(a,b);else if(a instanceof Uint8Array)ha(a,b);else{a;b=typeof a;throw c("WAErr")("Invalid payload type "+b)}}function ga(a,b){a=a.getInnerJid();if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_U){var c=a.user,e=a.device,f=a.domainType;b.writeUint8(t);b.writeUint8(f);b.writeUint8(e);L(c,b)}else if(a.type===d("WAWapJid").WAP_JID_SUBTYPE.JID_FB){f=a.user;e=a.device;b.writeUint8(s);L(f,b);b.writeUint16(e);L(l,b)}else{c=a.user;f=a.server;b.writeUint8(w);c!=null?L(c,b):b.writeUint8(n);L(f,b)}}function M(a,b){if(a.tag===void 0){b.writeUint8(u);b.writeUint8(n);return}var c=1;a.attrs&&(c+=Object.keys(a.attrs).length*2);a.content&&c++;c<256?(b.writeUint8(u),b.writeUint8(c)):c<65536&&(b.writeUint8(v),b.writeUint16(c));L(a.tag,b);a.attrs&&Object.keys(a.attrs).forEach(function(c){Q(c,b),L(a.attrs[c],b)});c=a.content;if(Array.isArray(c)){c.length<256?(b.writeUint8(u),b.writeUint8(c.length)):c.length<65536&&(b.writeUint8(v),b.writeUint16(c.length));for(var d=0;d<c.length;d++)M(c[d],b)}else c&&L(c,b)}var N,O;function P(a){var b=new Map();for(var c=0;c<a.length;c++)b.set(a[c],c);return b}function Q(a,b){if(a===""){b.writeUint8(y);b.writeUint8(0);return}N==null&&(N=P(d("WAWapDict").SINGLE_BYTE_TOKEN));var c=N.get(a);if(c!=null){b.writeUint8(c+1);return}if(O==null){O=[];for(c=0;c<d("WAWapDict").DICTIONARIES.length;++c)O.push(P(d("WAWapDict").DICTIONARIES[c]))}for(c=0;c<O.length;++c){var e=O[c].get(a);if(e!=null){b.writeUint8(ca[c]);b.writeUint8(e);return}}e=d("WABinary").numUtf8Bytes(a);if(e<128){c=/[^0-9.-]+?/;var f=/[^0-9A-F]+?/;if(!c.exec(a)){R(a,B,b);return}else if(!f.exec(a)){R(a,x,b);return}}S(e,b);b.writeString(a)}function R(a,b,d){var e=a.length%2===1;d.writeUint8(b);var f=Math.ceil(a.length/2);e&&(f|=ba);d.writeUint8(f);e=0;for(f=0;f<a.length;f++){var g=a.charCodeAt(f),h=null;48<=g&&g<=57?h=g-48:b===B?g===45?h=10:g===46&&(h=11):b===x&&(65<=g&&g<=70&&(h=g-55));if(h==null)throw c("WAErr")("Cannot nibble encode "+g);else f%2===0?(e=h<<4,f===a.length-1&&(e|=15,d.writeUint8(e))):(e|=h,d.writeUint8(e))}}function ha(a,b){S(a.length,b),b.writeByteArray(a)}function S(a,b){if(a<256)b.writeUint8(y),b.writeUint8(a);else if(a<1048576)b.writeUint8(z),b.writeUint8(a>>>16&255),b.writeUint8(a>>>8&255),b.writeUint8(a&255);else if(a<4294967296)b.writeUint8(A),b.writeUint32(a);else throw c("WAErr")("Binary with length "+a+" is too big for WAP protocol")}function ia(a,b){a=new(d("WABinary").Binary)(a);var c=a.readUint8();c=c&aa;if(c){d("WALogger").LOG(j());return b(a.readByteArray()).then(function(a){return V(new(d("WABinary").Binary)(a))})}return Promise.resolve(V(a))}function T(a,b){var e=a.readUint8();if(e===n)return null;if(e===u)return U(a,a.readUint8());if(e===v)return U(a,a.readUint16());if(e===y){var f=a.readUint8();return X(a,f,b)}if(e===z){f=a.readUint8();var g=a.readUint8(),h=a.readUint8();f=((f&15)<<16)+(g<<8)+h;return X(a,f,b)}if(e===A){g=a.readUint32();return X(a,g,b)}if(e===w)return ka(a);if(e===s)return la(a);if(e===t)return ma(a);if(e===B){h=a.readUint8();f=h>>>7;g=h&127;return Y(a,da,f,g)}if(e===x){b=a.readUint8();h=b>>>7;f=b&127;return Y(a,ea,h,f)}if(e<=0||e>=240)throw c("WAErr")("Unable to decode WAP buffer");if(e>=o&&e<=r){g=e-o;b=d("WAWapDict").DICTIONARIES[g];if(b===void 0)throw c("WAErr")("Missing WAP dictionary "+g);h=a.readUint8();f=b[h];if(f===void 0)throw c("WAErr")("Invalid value index "+h+" in dict "+g);return f}a=d("WAWapDict").SINGLE_BYTE_TOKEN[e-1];if(a===void 0)throw c("WAErr")("Undefined token with index "+e);return a}function U(a,b){var c=[];for(var d=0;d<b;d++)c.push(V(a));return c}function V(a){var b=a.readUint8(),e;if(b===u)e=a.readUint8();else if(b===v)e=a.readUint16();else throw c("WAErr")("Failed to decode node since type byte "+String(b)+" is invalid");b=void 0;var f=null;if(e===0)throw c("WAErr")("Failed to decode node, list cannot be empty");var g=W(a);e-=1;while(e>1){b||(b={});var h=W(a),i=T(a,!0);b[h]=i;e-=2}e===1&&(f=T(a,!1),f instanceof d("WAWapJid").WapJid&&(f=String(f)));return new J(g,b,f)}function W(a){a=T(a,!0);if(typeof a!=="string"){d("WALogger").DEV(i(),String(a));throw c("WAErr")("WAWap:decodeString got invalid value, string expected")}return a}function ja(a){a=T(a,!0);if(a!=null&&typeof a!=="string"){d("WALogger").DEV(h(),String(a));throw c("WAErr")("WAWap:decodeNullableString got invalid value, string expected")}return a}function ka(a){var b=ja(a);a=W(a);return d("WAWapJid").WapJid.create(b,a)}function la(a){var b=W(a),c=a.readUint16();W(a);return d("WAWapJid").WapJid.createFbJid(b,c)}function ma(a){var b=null,e=a.readUint8();if(e===0)b=d("WAWapJid").DomainType.WHATSAPP;else if(e===1)b=d("WAWapJid").DomainType.LID;else throw c("WAErr")("decodeJidU - Invalid domain type encoding "+e);e=a.readUint8();a=W(a);return d("WAWapJid").WapJid.createJidU(a,b,e)}function X(a,b,c){c===void 0&&(c=!1);if(c)return a.readString(b);else return a.readByteArray(b)}function Y(a,b,c,d){d=new Array(d*2-c);for(var e=0;e<d.length-1;e+=2){var f=a.readUint8();d[e]=b[f>>>4];d[e+1]=b[f&15]}if(c){f=a.readUint8();d[d.length-1]=b[f>>>4]}return d.join("")}function na(){if(!C){var a=new Uint16Array(2);self.crypto.getRandomValues(a);C=String(a[0])+"."+String(a[1])+"-"}return""+C+fa++}function Z(a){switch(a.type){case"group":return a.groupJid;case"status":return d("WAJids").STATUS_JID;case"device":return a.deviceJid;case"newsletter":return a.newsletterJid;default:a.type;return a.broadcastJid}}function oa(a){switch(a.type){case"group":return a.author;case"status":return a.author;case"broadcast":return a.author;default:a.type;return null}}function pa(a){return a.type==="status"||a.type==="group"||a.type==="broadcast"?$(a.author):D}function qa(a){return $(Z(a))}function $(a){var b=d("WAJids").validateDomainJid(a);if(b!=null)return ra(b);b=a.split("@");a=b[0];b=b[1];var c=null;if((b===l||b===k||b===m)&&a.indexOf(":")!==-1){var e=a.split(":");a=e[0];e=e[1];c=parseInt(e,10)}if(b===k)return d("WAWapJid").WapJid.createFbJid(a,c);e=b===m?d("WAWapJid").DomainType.LID:d("WAWapJid").DomainType.WHATSAPP;return c!=null&&c!==0?d("WAWapJid").WapJid.createJidU(a,e,c):d("WAWapJid").WapJid.create(a,b)}function ra(a){if(a==="s.whatsapp.net")return F;else if(a==="g.us")return E;else if(a==="newsletter")return G;else return c("WAAssertUnreachable")(a)}function sa(a){return $(a)}function ta(a){return $(a)}function ua(a){return $(a)}function va(a){return $(a)}function wa(a){return $(a)}function xa(a){return $(a)}function ya(a){if(a.jidType==="phoneDevice")return $(a.deviceJid);else if(a.jidType==="msgrDevice")return $(a.deviceJid);else if(a.jidType==="lidDevice")return $(a.deviceJid);else if(a.jidType==="phoneUser")return $(a.userJid);else if(a.jidType==="msgrUser")return $(a.userJid);else if(a.jidType==="lidUser")return $(a.userJid);else if(a.jidType==="group")return $(a.groupJid);else if(a.jidType==="status")return $(a.statusJid);else if(a.jidType==="call")return $(a.callJid);else if(a.jidType==="newsletter")return $(a.newsletterJid);else{a.jidType;return $(a.broadcastJid)}}function za(a){return a}function Aa(a){return a}function Ba(a){return a==null?D:a}function Ca(a){return a.toString()}function Da(a){return d("WALongInt").longIntToDecimalString(a)}function Ea(a,b){b===void 0&&(b=4);a=a;var c=new Uint8Array(b);for(b=b-1;b>=0;b--)c[b]=a&255,a>>>=8;return c}g.DROP_ATTR=D;g.G_US=E;g.S_WHATSAPP_NET=F;g.STATUS_BROADCAST=p;g.NEWSLETTER=G;g.enableXMLFormat=a;g.WapNode=J;g.makeWapNode=b;g.wap=q;g.decodeAsString=e;g.makeStanza=K;g.encodeStanza=f;g.decodeStanza=ia;g.generateId=na;g.extractToJid=Z;g.extractParticipantJid=oa;g.PARTICIPANT_JID=pa;g.TO_JID=qa;g.JID=$;g.DOMAIN_JID=ra;g.USER_JID=sa;g.DEVICE_JID=ta;g.GROUP_JID=ua;g.BROADCAST_JID=va;g.CALL_JID=wa;g.NEWSLETTER_JID=xa;g.TO_WAP_JID=ya;g.STANZA_ID=za;g.CUSTOM_STRING=Aa;g.MAYBE_CUSTOM_STRING=Ba;g.INT=Ca;g.LONG_INT=Da;g.BIG_ENDIAN_CONTENT=Ea}),98);
__d("WAParsableWapNode",["WABinary","WAErr","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""]);i=function(){return a};return a}var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"XmppParsingFailure: "+a+": "+c)||this;d.name="XmppParsingFailure";d.parser=a;d.reason=c;return d}var c=a.prototype;c.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason};return a}(babelHelpers.wrapNativeSuper(Error));a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){return a.call(this,b,c)||this}var e=b.prototype;e.assertFromServer=function(){var a=this.attrString("from");a!==d("WAJids").WA_SERVER_JID_SUFFIX&&this["throw"]('to have "from"="s.whatsapp.net", but instead has "'+a+'"')};e.attrUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.userJid==null?this["throw"]('to have "'+a+'"={UserJid}, but instead has "'+b+'"'):c.userJid};e.attrPhoneUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="phoneUser"?c.userJid:this["throw"]('to have "'+a+'"={PhoneUserJid}, but instead has "'+b+'"')};e.attrLidUserJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="lidUser"?c.userJid:this["throw"]('to have "'+a+'"={LidUserJid}, but instead has "'+b+'"')};e.maybeAttrUserJid=function(a){return this.hasAttr(a)?this.attrUserJid(a):null};e.maybeAttrPhoneUserJid=function(a){return this.hasAttr(a)?this.attrPhoneUserJid(a):null};e.maybeAttrLidUserJid=function(a){return this.hasAttr(a)?this.attrLidUserJid(a):null};e.attrGroupJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.groupJid==null?this["throw"]('to have "'+a+'"={GroupJid}, but instead has "'+b+'"'):c.groupJid};e.maybeAttrGroupJid=function(a){return this.hasAttr(a)?this.attrGroupJid(a):null};e.attrChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.userJid!=null)return c.userJid;return c.groupJid!=null?c.groupJid:this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrPhoneChatJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneUser")return c.userJid;else if(c.jidType==="group")return c.groupJid;else return this["throw"]('to have "'+a+'"={ChatJid}, but instead has "'+b+'"')};e.attrDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.deviceJid!=null)return c.deviceJid;return c.userJid!=null?d("WAJids").defaultDeviceJidForUser(c.userJid):this["throw"]('to have "'+a+'"={DeviceJid}, but instead has "'+b+'"')};e.attrPhoneDeviceJid=function(a){var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);if(c.jidType==="phoneDevice")return c.deviceJid;return c.jidType==="phoneUser"?d("WAJids").defaultPhoneDeviceJidForUser(c.userJid):this["throw"]('to have "'+a+'"={DeviceJid}, but instead has "'+b+'"')};e.attrDeviceId=function(a){a=this.attrInt(a);return d("WAJids").interpretAsDeviceId(a)};e.attrFromJidChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"msgrUser":var b=a.userJid,e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneUser":b=a.userJid;e=d("WAJids").defaultDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"lidUser":b=a.userJid;e=d("WAJids").defaultLidDeviceJidForLidUserJid(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"msgrDevice":e=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(e),deviceJid:e,author:e};case"lidDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractUserJid(b),deviceJid:b,author:b};case"group":e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:e};case"broadcast":b=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractUserJid(b),author:b};case"call":d("WALogger").ERROR(i(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromJidPhoneChat=function(){var a=this.attrJidWithType();switch(a.jidType){case"phoneUser":var b=a.userJid,e=d("WAJids").defaultPhoneDeviceJidForUser(b);return{type:"device",chat:b,deviceJid:e,author:e};case"phoneDevice":b=a.deviceJid;return{type:"device",chat:d("WAJids").extractPhoneUserJid(b),deviceJid:b,author:b};case"group":e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e==null?this["throw"]("expected to have participant JID for group"):{type:"group",chat:a.groupJid,groupJid:a.groupJid,author:e};case"broadcast":b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("expected to have participant JID for group"):{type:"broadcast",broadcastJid:a.broadcastJid,chat:d("WAJids").extractPhoneUserJid(b),author:b};case"call":d("WALogger").ERROR(h(),a.callJid);throw c("WAErr")("ParsableWapNode: attrFromJid() does not support CallJid");default:a.jidType;return this["throw"]("attrFromJidChat should not be used with jid of type "+a.jidType)}};e.attrFromPhoneJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){a=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return a==null?this["throw"]("to have participant for status msg"):{type:"status",author:a}}else return this.attrFromJidPhoneChat()};e.attrFromJid=function(){var a=this.attrJidWithType();if(a.jidType==="status"){var b=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return b==null?this["throw"]("to have participant for status msg"):{type:"status",author:b}}return a.jidType==="newsletter"?{type:"newsletter",newsletterJid:a.newsletterJid}:this.attrFromJidChat()};e.attrJidWithType=function(a){a===void 0&&(a="from");var b=this.attrString(a),c=d("WAJids").interpretAndValidateJid(b);return c.jidType==="unknown"?this["throw"]('to have "'+a+'"={Jid}, but instead has "'+b+'"'):c};e.attrWapJid=function(a){a===void 0&&(a="from");a=this.attrString(a);var b=d("WAJids").interpretAndValidateJid(a);return b.jidType==="unknown"?d("WAWapJid").WapJid.create(null,a):d("WAWap").JID(d("WAJids").extractFromJid(b))};e.attrLongInt=function(a){a=this.attrString(a);return d("WALongInt").decimalStringToLongInt(a)};e.attrTime=function(a){return d("WATimeUtils").castToUnixTime(this.attrInt(a))};e.attrFutureTime=function(a){a=this.attrInt(a);return d("WATimeUtils").futureUnixTime(a)};e.contentString=function(){if(this.hasChildren())return this["throw"]("to have string content, but has children instead");else if(this.hasContent()){var a=new(d("WABinary").Binary)(this.contentBytes());return a.readString(a.size())}else return this["throw"]("to have content")};e.decodeAsString=function(a){return d("WAWap").decodeAsString(a)};e.contentSerializedPubKey=function(){if(this.hasContent())return d("WASignalKeys").serializeIdentity(this.contentBytes());else return this["throw"]("to have content")};e.createParseError=function(a){return new j(this.name(),"expected <"+this.tag()+"> "+a)};e["throw"]=function(a){throw this.createParseError(a)};return b}(d("WAParsableXmlNode").ParsableXmlNode);g.XmppParsingFailure=j;g.ParsableWapNode=a}),98);
__d("WAWapParser",["WAErr","WAParsableWapNode"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.parse=function(a){a=new(d("WAParsableWapNode").ParsableWapNode)(this.$1,a);try{return{success:this.$2(a)}}catch(a){if(a instanceof d("WAParsableWapNode").XmppParsingFailure)return{error:a};else throw a}};b.parseOrThrow=function(a){a=this.parse(a);if(a.error)throw c("WAErr")(String(a.error));return a.success};return a}();g.WapParser=a}),98);
__d("WAAckParser",["WAJids","WAWapParser"],(function(a,b,c,d,e,f,g){b=new(d("WAWapParser").WapParser)("ack",function(a){a.assertTag("ack");return{id:a.attrString("id"),ts:a.maybeAttrString("t"),"class":a.attrString("class"),type:a.maybeAttrString("type"),from:a.attrJidWithType(),participant:a.hasAttr("participant")?a.attrDeviceJid("participant"):null}});function a(a,b){return a.id===b.id&&(b["class"]===void 0||a["class"]===b["class"])&&(b.type===void 0||a.type===b.type)&&(b.from===void 0||h(a.from,b.from))&&(b.participant===void 0||a.participant===b.participant)&&(b.ts===void 0||a.ts===b.ts)}function h(a,b){if(d("WAJids").extractFromJid(a)===b)return!0;if(a.userJid!=null)return d("WAJids").defaultDeviceJidForUser(a.userJid)===b;if(a.deviceJid!=null){a=a.deviceJid;return d("WAJids").extractDeviceId(a)===0&&d("WAJids").extractUserJid(a)===b}return!1}g.AckParser=b;g.ackMatchesTemplate=a;g.fromJidsAreEqual=h}),98);
__d("WAArrayUtils",[],(function(a,b,c,d,e,f){function a(a,b){var c=a.pop();b<a.length&&(a[b]=c)}f.removeIndexWithoutPreservingOrder=a}),66);
__d("WAErrors",["WACustomError"],(function(a,b,c,d,e,f,g){a=d("WACustomError").customError("BufferTooLarge",!1);b=d("WACustomError").customError("Disconnected",!1);c=d("WACustomError").customError("Offline",!1,b);g.BufferTooLargeError=a;g.Disconnected=b;g.Offline=c}),98);
__d("WANotifyConnectionChangeFactory",[],(function(a,b,c,d,e,f){var g=15e3;function a(a,b,c){c===void 0&&(c=g);var d={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},e=function(){var a=d.optimismLevel,e=d.connectionStatus;a==="optimist"?d.timeoutID=setTimeout(function(){d.optimismLevel="realist",b(e)},c):b(e)};return function(c){d.connectionStatus=c,c==="disconnected"?e():c==="in_handshake"?e():(c,d.timeoutID!=null&&(clearTimeout(d.timeoutID),d.timeoutID=null),b(c)),a(c)}}f.notifyConnectionChangeFactory=a}),66);
__d("WAParseIqResponse",["WAWap"],(function(a,b,c,d,e,f,g){function a(a,b,c){var e=a.content;if(e&&Array.isArray(e)&&e[0]){e=e[0];if(e.tag==="error"){var f=e.attrs||{},g;c&&(typeof c==="function"?g=c(a):g=c.parseOrThrow(e));c=g;return{success:!1,errorCode:parseInt(f.code,10),errorText:d("WAWap").decodeAsString(f.text)||"",errorType:d("WAWap").decodeAsString(f.type)||"",errorBackoff:parseInt(f.backoff,10),toString:h,customError:c}}}if(typeof b==="function")return{success:!0,result:b(a)};else return{success:!0,result:b.parseOrThrow(a)}}function h(){return"IqError "+this.errorCode+": "+this.errorText}g.parseIqResponse=a}),98);
__d("WASmaxInPingsEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={validators:[d("WAJids").validateDomainJid,d("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};g.DOMAINJID_USERJID=a}),98);
__d("WADeepEquals",[],(function(a,b,c,d,e,f){function g(a,b){if(a===b)return!0;if(!a||!b||typeof a!=="object"&&typeof b!=="object")return!1;var c=Array.isArray(a),d=Array.isArray(b);if(c!==d)return!1;d=!0;if(c){c=a.length;if(c!==b.length)return!1;for(var e=0;d&&e<c;e++)d=g(a[e],b[e]);return d}c=Object.keys(a);for(e=0;d&&e<c.length;e++){var f=c[e];d=b.propertyIsEnumerable(f)&&g(a[f],b[f])}return d&&Object.keys(b).length===c.length}f.deepEqual=g}),66);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid"],(function(a,b,c,d,e,f,g){var h=d("WAResultOrError").makeResult();function a(a,b){return a.tag!==b?H(a,"to be <"+b+">"):h}function i(a,b){return!I(a,b)?H(a,'to have attribute "'+b+'"'):J(a,a.attrs[b])}function j(a,b,c,e){var f=i(a,b);if(!f.success)return f;c=c(f.value);return c!=null?d("WAResultOrError").makeResult(c):H(a,'to have "'+b+'"={'+e+'}, but instead has "'+f.value+'"')}function k(a,b,c){var e=B(a);if(!e.success)return e;b=b(e.value);return b!=null?d("WAResultOrError").makeResult(b):H(a,"to have "+c+' content, but instead has "'+e.value+'"')}function b(a,b,c){var d=i(a,b);if(!d.success)return d;else if(d.value!==c)return H(a,'to have "'+b+'"="'+c+'", but instead has "'+d.value+'"');return h}function e(a,b){return j(a,b,d("WAStanzaUtils").toStanzaId,"stanzaID")}function l(a,b){return j(a,b,K,"integer")}function f(a,b,c,e){var f=l(a,b);if(!f.success)return f;f=f.value;if(c!==void 0&&f<c)return H(a,'to have "'+b+'"={at least '+c+"} but has value "+f);else if(e!==void 0&&f>e)return H(a,'to have "'+b+'"={at most '+e+"} but has value "+f);return d("WAResultOrError").makeResult(f)}function m(a){var b=a.content;return b instanceof Uint8Array?H(a,"to have children"):d("WAResultOrError").makeResult(b)}function n(a,b){var c=m(a);if(!c.success)return c;c=c.value;if(c==null)return h;var e=null;for(var f=0;f<c.length;f++){var g=c[f];if(g.tag===b){if(e!=null)return H(a,"to have 1 child <"+b+">, but found more than 1");e=g}}return d("WAResultOrError").makeResult(e)}function o(a,b,c){a=n(a,b);if(!a.success)return a;return a.value==null?h:c(a.value)}function p(a,b,c){c=o(a,b,c);if(!c.success)return c;c=c.value;return c==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c)}function q(a,b){var c=n(a,b);if(!c.success)return c;return c.value==null?H(a,"to have 1 child <"+b+">, but found 0"):d("WAResultOrError").makeResult(c.value)}function r(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=[];for(c=0;c<a.value.length;c++){e=f(a.value[c]);if(!e.success)return e;b.push(e.value)}return d("WAResultOrError").makeResult(b)}function s(a,b,c,e,f){a=L(a,b,c,e);if(!a.success)return a;b=a.value.length;for(c=0;c<b;c++){e=f(a.value[c]);if(!e.success)return e}return d("WAResultOrError").makeResult(b)}function t(a,b,c){b=r(a,b,0,Infinity,c);if(!b.success)return b;for(c=0;c<b.value.length;c++)if(!d("WADeepEquals").deepEqual(b.value[0],b.value[c]))return H(a,"to have homogeneous children, but found two children that are not equal");return b}function u(a,b,c){a=t(a,b,c);return!a.success?a:d("WAResultOrError").makeResult(a.value.length)}function v(a,b,c,d,e){return I(b,c)?a(b,c,d,e):h}function w(a,b,c,e){if(e==null)return h;a=v(a,b,c);if(!a.success)return a;if(a.value===e)return d("WAResultOrError").makeResult(e);return a.value==null?h:H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function x(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?d("WAResultOrError").makeResult(e):H(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function y(a,b,c){a=a(b);if(!a.success)return a;return a.value===c?d("WAResultOrError").makeResult(c):H(b,'to have content "'+c+'", but instead has "'+a.value+'"')}function z(a,b,c){var e=i(a,b);if(!e.success)return e;var f=c[e.value];if(f!=null)return d("WAResultOrError").makeResult(f);f=Object.values(c).join("|");return H(a,'to have "'+b+'"={'+f+'}, but instead has "'+e.value+'"')}function A(a,b){var c=B(a);if(!c.success)return c;var e=b[c.value];if(e!=null)return d("WAResultOrError").makeResult(e);e=Object.values(b).join("|");return H(a,'to have content "'+e+'", but instead has "'+c.value+'"')}function B(a){var b=C(a);if(!b.success)return b;else try{b=new(d("WABinary").Binary)(b.value);b=b.readString(b.size());return d("WAResultOrError").makeResult(b)}catch(b){return H(a,"to have string content, but run into decoding error: "+b.message)}}function C(a){var b=a.content;if(b==null)return H(a,"to have content");else if(Array.isArray(b))return H(a,"to have content, but has children instead");else return d("WAResultOrError").makeResult(b)}function D(a,b){var c=C(a);if(!c.success)return c;return d("WACryptoUtils").uint8ArraysEqual(c.value,b)?d("WAResultOrError").makeResult(b):H(a,'to have content ":binary:'+d("WABase64").encodeB64(b)+'", but instead has ":binary:'+d("WABase64").encodeB64(c.value)+'"')}function E(a,b,c){var e=C(a);if(!e.success)return e;var f=e.value.length;if(b!==void 0&&f<b)return H(a,"to have binary content at least "+b+" bytes but has "+f+" bytes");else if(c!==void 0&&f>c)return H(a,"to have binary content at most "+c+" bytes but has "+f+" bytes");return d("WAResultOrError").makeResult(e.value)}function F(a){return k(a,K,"integer")}function G(a){return a}function H(a,b){return d("WAResultOrError").makeError("expected <"+a.tag+">: "+b)}function I(a,b){return c("WAHasProperty")(a.attrs,b)}function J(a,b){if(b instanceof d("WAWapJid").WapJid)return d("WAResultOrError").makeResult(b.toString());return typeof b==="string"?d("WAResultOrError").makeResult(b):H(a,"decodeAsString: attribute is "+typeof b+" not a string: "+String(b))}function K(a){a=parseInt(a,10);return Number.isNaN(a)?null:a}function L(a,b,c,e){var f=m(a);if(!f.success)return f;f=f.value;if(f==null)if(c!==0)return H(a,"to have at least "+c+" <"+b+"> children, but found 0");else return d("WAResultOrError").makeResult([]);var g=[];for(var h=0;h<f.length;h++){var i=f[h];i.tag===b&&g.push(i)}i=g.length;if(i<c)return H(a,"to have at least "+c+" <"+b+"> children, but found "+i);else if(i>e)return H(a,"to have at most "+e+" <"+b+"> children, but found "+i);return d("WAResultOrError").makeResult(g)}var M={};function N(a,b,c){var d=b.map(function(a,b){return a+": "+c[b].error});return H(a,["to match any of following mixins: "+b.join(", ")+", but all mixins failed."].concat(d).join(" "))}g.voidSuccess=h;g.assertTag=a;g.attrString=i;g.attrValidate=j;g.contentValidate=k;g.assertAttr=b;g.attrStanzaId=e;g.attrInt=l;g.attrIntRange=f;g.maybeChildren=m;g.optionalChild=n;g.optionalChildWithTag=o;g.childWithTag=p;g.flattenedChildWithTag=q;g.mapChildrenWithTag=r;g.countChildrenWithTag=s;g.mapHomogeneousChildrenWithTag=t;g.countHomogeneousChildrenWithTag=u;g.optional=v;g.optionalLiteral=w;g.literal=x;g.literalContent=y;g.attrStringEnum=z;g.contentStringEnum=A;g.contentString=B;g.contentBytes=C;g.contentLiteralBytes=D;g.contentBytesRange=E;g.contentInt=F;g.identity=G;g.errorMessage=H;g.emptyObject=M;g.errorMixinDisjunction=N}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateUserJid,"UserJid")}function b(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDeviceJid,"DeviceJid")}function c(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateGroupJid,"GroupJid")}function e(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateCallJid,"CallJid")}function f(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateDomainJid,"DomainJid")}function h(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateBroadcastJid,"BroadcastJid")}function i(a,b){return d("WASmaxParseUtils").attrValidate(a,b,d("WAJids").validateStatusJid,"StatusJid")}function j(a,b,c){var e=d("WASmaxParseUtils").attrString(a,b);if(!e.success)return e;var f=c.validators;c=c.typeName;for(var g=0;g<f.length;g++){var h=f[g](e.value);if(h!=null)return d("WAResultOrError").makeResult(h)}return d("WASmaxParseUtils").errorMessage(a,'to have "'+b+'"={'+c+'}, but instead has "'+e.value+'"')}function k(a,b,c,e){a=a(b,c);if(!a.success)return a;return a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}function l(a,b,c,e){a=d("WASmaxParseUtils").optional(a,b,c);if(!a.success)return a;return a.value==null||a.value===e?a:d("WASmaxParseUtils").errorMessage(b,'to have "'+c+'"={'+e+'}, but instead has "'+a.value+'"')}g.attrUserJid=a;g.attrDeviceJid=b;g.attrGroupJid=c;g.attrCallJid=e;g.attrDomainJid=f;g.attrBroadcastJid=h;g.attrStatusJid=i;g.attrJidEnum=j;g.literalJid=k;g.optionalLiteralJid=l}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a,b,c,d,e){b=j(b,c);if(!b.success)return l(b);a=a(b.value,c[c.length-1],d,e);return!a.success?l(a):a}function a(a,b,c,e,f){return k(b,c)?h(a,b,c,e,f):d("WASmaxParseUtils").voidSuccess}function i(a,b){return h(d("WASmaxParseUtils").attrString,a,b)}function b(a,b){return k(a,b)?i(a,b):d("WASmaxParseUtils").voidSuccess}function e(a,b){a=j(a,b);if(!a.success)return l(a);b=d("WASmaxParseUtils").contentString(a.value);return!b.success?l(b):b}function j(a,b){var c=b.length;a=a;for(var e=0;e<c-1;e++){var f=b[e];f=d("WASmaxParseUtils").flattenedChildWithTag(a,f);if(!f.success)return f;a=f.value}return d("WAResultOrError").makeResult(a)}function k(a,b){a=j(a,b);return a.success&&c("WAHasProperty")(a.value.attrs,b[b.length-1])}function l(a){return d("WAResultOrError").makeError("in the reference, "+a.error)}g.attrFromReference=h;g.optionalAttrFromReference=a;g.attrStringFromReference=i;g.optionalAttrStringFromReference=b;g.contentStringFromReference=e}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseJid").attrJidEnum(a,"from",d("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"t");return!b.success?b:d("WAResultOrError").makeResult({from:c.value,type:e.value,t:b.value})}g.parseClientResponseServerResponse=a}),98);
__d("WASmaxJsx",["WAWap"],(function(a,b,c,d,e,f,g){g.smax=d("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(a,b,c,d,e,f,g){var h="smax$any";function i(a,b){j(a,b);k(a,b);b.content instanceof Uint8Array?m(a,b.content):b.content!=null&&n(a,b.content);return a}function a(a,b,c,d){return c!=null?a(b,c,d):b}function j(a,b){a=a.tag;b=b.tag;if(b===h)return;if(a!==b)throw new Error("tag mismatch: "+a+" != "+b)}function k(a,b){var c=a.attrs,d=b.attrs;Object.keys(d).forEach(function(a){var b=d[a],e=c[a];if(b!=null&&e!=null){if(l(b,e))return;throw new Error("conflict for key: "+a)}c[a]=b})}function l(a,b){if(typeof a==="string"&&typeof b==="string")return a===b;return a instanceof d("WAWapJid").WapJid&&b instanceof d("WAWapJid").WapJid?a.toString()===b.toString():!1}function m(a,b){var c=a.content;if(c instanceof Uint8Array){if(!d("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(c,b))throw new Error("elementValue mismatch: bytes dose not equal");return}if(c!=null)throw new Error("elementValue mismatch: destination has children");a.content=b}function n(a,b){var c=a.content;if(c instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(c==null||c.length===0){a.content=b;return}if(!o(c,b))throw new Error("children mismatch: child counts are not compatible");var d=[],e=Array.from(c);b.forEach(function(a){var b=e.findIndex(function(b){return b.tag===a.tag});if(b===-1)d.push(a);else{b=e.splice(b,1);b=i(b[0],a);d.push(b)}});e.forEach(function(a){return d.push(a)});a.content=d}function o(a,b){b=p(b);a=p(a);var c=Object.keys(b);for(var d=0;d<c.length;d++){var e=c[d],f=b[e];e=a[e];if(f!=null&&e!=null&&f!==e)return!1}return!0}function p(a){return a.reduce(function(a,b){b=b.tag;var c=a[b];a[b]=c==null?1:c+1;return a},{})}g.mergeStanzas=i;g.optionalMerge=a}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientWellFormedToMixin=a}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get",xmlns:"w:p"}));return a}g.makeClientRequest=a}),98);
__d("WAComms",["Promise","WAAckParser","WAArrayUtils","WAErr","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAParseIqResponse","WAPromiseRetryLoop","WAResolvable","WAResultOrError","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["closeSocket called"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["socketLoopIteration failed ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["socketLoopIteration socket closed while in noise handshake"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["socketLoopIteration socket disconnected while in noise handshake"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," closed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opened"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," opening"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["closeSocketAndPreventRetry called"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is NO_ACK"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: job response is CLOSE_SOCKET"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receiving ---\n",""],["--- Receiving ---\\n",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Sending ---\n",""],["--- Sending ---\\n",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\n",""],["Error in onBeforeCastStanza, we consumed and continue with normal stanza sending to the server:\\n",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. (This is not expected in a non-E2E build!)"]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["--- Receive (via SMAX+E2E) ---\n",""],["--- Receive (via SMAX+E2E) ---\\n",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched:\n",". We return mock response directly."],["Dropping stanza since onBeforeCastStanza matched:\\n",". We return mock response directly."]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["No stanzaId in ping request stanza"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPing ping still pending"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPing when socket dead"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: Socket "," expired"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: testing socket"]);K=function(){return a};return a}function L(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]);L=function(){return a};return a}function M(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""]);M=function(){return a};return a}var N=null,O=null,P=1,Q=function(){function a(a,c,e){var f=this;this.nextSocketId=1;this.pendingIqs=new Map();this.ackHandlers=[];this.pendingSmaxStanzas=new Map();this.$2=new(d("WAResolvable").Resolvable)();this.activePing=null;this.$3=new Set();this.socketId=0;this.socket=null;this.softCloseSocket=null;this.handleStanza=function(a,b,c){var e=d("WASmaxParseUtils").attrString(a,"id");if(e.success){e=e.value;var g=f.pendingSmaxStanzas.get(e);if(g){f.pendingSmaxStanzas["delete"](e);g.resolve(a);f.maybeScheduleHealthCheck();return"NO_ACK"}}e=$(a);if(e!=null){g=f.pendingIqs.get(e);g?(f.pendingIqs["delete"](e),g.resolve(a),f.maybeScheduleHealthCheck()):(d("WALogger").WARN(M(),e),d("WALogger").ERROR(L()))}else if(a.tag==="ack")f.handleAck(a);else return a.tag==="failure"&&f.config.shouldBlockReceivingUntilSuccess?f.$1(a,b,c):f.$2.promise.then(function(){return f.$1(a,b,c)});return"NO_ACK"};this.healthCheckTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WALogger").DEV(K());if(!f.socketId)return;f.sendPing()});this.deadSocketTimer=new(d("WAShiftTimer").ShiftTimer)(function(a){d("WALogger").LOG(J(),a);if(a!==f.socketId)return;f.softCloseSocket&&f.softCloseSocket()});this.sendPing=function(){var a,c,e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:a=Z("sendPing");if(a.socketId){k.next=4;break}d("WALogger").LOG(I());return k.abrupt("return",b("Promise").resolve());case 4:if(!(a.activePing&&a.activePing.socketId===a.socketId)){k.next=7;break}d("WALogger").LOG(H());return k.abrupt("return",b("Promise").resolve());case 7:a.activePing&&a.activePing.handler.resolve();c=d("WASmaxOutPingsClientRequest").makeClientRequest();e=c.attrs.id;if(!(typeof e!=="string")){k.next=13;break}d("WALogger").ERROR(G());return k.abrupt("return",b("Promise").resolve());case 13:f=new(d("WAResolvable").Resolvable)();a.activePing={socketId:a.socketId,stanzaId:e,handler:f};a.callStanza(c);k.next=18;return b("regeneratorRuntime").awrap(f.promise);case 18:g=k.sent,g&&(h=d("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(g,c),h.success&&(i=d("WATimeUtils").castToUnixTime(h.value.t),j=Math.round(Date.now()/1e3-i),a.config.handlers.onClockSkewUpdate==null?void 0:a.config.handlers.onClockSkewUpdate(j)));case 20:case"end":return k.stop()}},null,this)};this.$1=a;this.onConnectionChange=d("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((a=c.handlers.onConnectionChange)!=null?a:function(){},(a=c.handlers.onOptimisticConnectionChange)!=null?a:function(){});this.gzipInflate=e;this.config=c;this.socketLoop=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"MainSocketLoop",code:V,timer:{jitter:.1,max:c.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}var e=a.prototype;e.filterPending=function(a){var b=[];function c(c){a(c)&&b.push(c)}this.pendingIqs.forEach(c);this.ackHandlers.forEach(c);this.pendingSmaxStanzas.forEach(c);return b};e.sendPendingStanza=function(a){var b=a.timeoutId;b!=null&&(clearTimeout(b),a.timeoutId=void 0);this.callStanza(a.stanza)};e.maybeSendPendingStanza=function(a){if(this.socket){this.sendPendingStanza(a);return}else d("WALogger").LOG(F())};e.callStanzaAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.callStanza(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};e.callStanza=function(a){a=this.castStanza(a);this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId);this.healthCheckTimer.cancel();return a};e.castStanzaAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.castStanza(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};e.castStanza=function(a){var c=this;try{var e=this.config.handlers.onBeforeCastStanzaForE2E==null?void 0:this.config.handlers.onBeforeCastStanzaForE2E(a);if(e!=null){this.handleStanza(e,this.socketId,0);d("WALogger").DEV_XMPP(E(),a);d("WALogger").DEV_XMPP(D(),e);d("WALogger").ERROR(C());return b("Promise").resolve()}}catch(a){d("WALogger").DEV_XMPP(B(),a)}e=this.socketOrThrow("castStanza");try{d("WALogger").DEV_XMPP(A(),a);return e.sendFrame(d("WAWap").encodeStanza(a)).then(function(){c.config.handlers.onCastStanza==null?void 0:c.config.handlers.onCastStanza(a)})["catch"](function(a){d("WALogger").ERROR(z(),a).devConsole(a);if(a instanceof d("WAErrors").BufferTooLargeError)return b("Promise").reject(a)})}catch(a){d("WALogger").ERROR(y(),a).devConsole(a)}return b("Promise").resolve()};e.socketOrThrow=function(a){var b=this.socket;if(b)return b;throw c("WAErr")("Comms."+a+" called while no socket")};e.startHandlingRequests=function(){d("WALogger").LOG(x());this.$2.resolve();return this.$2.promise.then(function(){})};e.parseAndHandleStanza=function(a,b){var c=this;a===this.socketId&&(this.deadSocketTimer.cancel(),O&&(O.resolve(),O=null));var e=d("WAWap").decodeStanza(b,this.gzipInflate)["catch"](function(a){d("WALogger").ERROR(w()).devConsole(b);throw a}).then(function(e){d("WALogger").DEV_XMPP(v(),e);c.config.handlers.onHandleStanza==null?void 0:c.config.handlers.onHandleStanza(e,a,b.byteLength);var f=c.activePing;if(f&&f.socketId===a&&f.stanzaId===$(e)){c.activePing=null;f.handler.resolve(e);c.maybeScheduleHealthCheck();return"NO_ACK"}return c.handleStanza(e,a,b.byteLength)}).then(function(b){if(a!==c.socketId)return;if(b==="CLOSE_SOCKET"){d("WALogger").LOG(u());var e=c.socket;e&&e.close()}else b==="NO_ACK"?d("WALogger").DEV(t()):c.castStanza(b);return"NO_ACK"});this.$3.add(e);e["finally"](function(){return void c.$3["delete"](e)})};e.handleAck=function(a){var b=this.ackHandlers,c=-1,e=null;while(!e&&++c<b.length)e=b[c].parseAndTest(a);if(e){var f=b[c];d("WAArrayUtils").removeIndexWithoutPreservingOrder(b,c);this.config.handlers.onHandleAck==null?void 0:this.config.handlers.onHandleAck(a);f.resolve(e);this.maybeScheduleHealthCheck()}else d("WALogger").WARN(s(),a)};e.removeHandler=function(a){if(a.type==="iq"||a.type==="smax"){var c=a.stanza.attrs.id;if(!c||typeof c!=="string")return;if(a.type==="iq"&&!this.pendingIqs["delete"](c)||a.type==="smax"&&!this.pendingSmaxStanzas["delete"](c))return}else{a.type;c=this.ackHandlers.indexOf(a);if(c===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,c)}a.resolve(b("Promise").reject(new(d("WAErrors").Disconnected)()))};e.maybeScheduleHealthCheck=function(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)return;var a=this.config.healthCheckInterval;a=Math.ceil(a*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(a)};return a}();function a(){return N}function e(a,b,c){if(N)return;N=new Q(a,b,c);setTimeout(S,0)}function f(){var a=Z("stopComms");a.socketLoop.endWithValue();a.socket&&a.socket.close();N=null}function R(){var a=Z("closeSocketAndPreventRetry");a.socketLoop.endWithValue();a.socket&&(d("WALogger").LOG(r()),a.socket.close())}function S(){Z("openSocketLoop").socketLoop.start()}function T(){U()||Z("maybeResetSocketLoop").socketLoop.reset()}function aa(){Z("forceResetSocketLoop").socketLoop.reset()}function U(){var a;return!!((a=N)==null?void 0:a.socket)}function V(){var a=Z("socketLoopIteration"),b=a.nextSocketId++;d("WALogger").LOG(q(),b);var c=function(){a.onConnectionChange("in_handshake")};a.config.handlers.onSocketLoopIteration==null?void 0:a.config.handlers.onSocketLoopIteration();return a.config.openChatSocket(c).then(d("WAResultOrError").onResult(function(c){a.config.handlers.onSocketOpen==null?void 0:a.config.handlers.onSocketOpen();var e=new(d("WAResolvable").Resolvable)();d("WALogger").LOG(p(),b);a.socketId=b;a.socket=c;a.softCloseSocket=function(){a.softCloseSocket=null,a.socket&&a.config.shouldCloseStaleSocket&&(a.socket.close(),a.socket=null),e.resolve()};a.socketLoop.resetTimeoutAfter(1e4);a.deadSocketTimer.cancel();a.maybeScheduleHealthCheck();c.setOnFrame(function(c){return a.parseAndHandleStanza(b,c)});c.setOnClose(function(){d("WALogger").LOG(o(),b);a.activePing&&b===a.activePing.socketId&&(a.activePing.handler.resolve(),a.activePing=null);a.filterPending(function(a){return a.attachedToSocketId===b}).forEach(function(b){return void a.removeHandler(b)});if(b!==a.socketId)return;a.socketId=0;a.socket=null;a.onConnectionChange("disconnected");a.config.handlers.onDisconnect==null?void 0:a.config.handlers.onDisconnect();e.resolve()});a.onConnectionChange("connected");a.config.handlers.onConnect==null?void 0:a.config.handlers.onConnect();a.filterPending(function(a){return!a.attachedToSocketId}).sort(function(a,b){return a.orderedId-b.orderedId}).forEach(function(b){switch(b.type){case"smax":case"iq":a.sendPendingStanza(b);break;case"ack":a.callStanza(b.stanza);break;default:b.type;break}});return e.promise})).then(d("WAResultOrError").catchError(function(a){switch(a){case"max-hunters":d("WALogger").WARN(n());break;case"disconnected":d("WALogger").WARN(m());break;default:a;return}}))["catch"](function(a){a instanceof d("WAErrors").Disconnected?d("WALogger").LOG(l()):d("WALogger").ERROR(k(),a).devConsole(a)})}function ba(){var a=Z("closeSocket").socket;a&&(d("WALogger").LOG(j()),a.close())}function ca(){Z("onStreamErrorReceived").socketLoop.cancelReset()}function da(){Z("waitForConnection").sendPing();O||(O=new(d("WAResolvable").Resolvable)());return O.promise}function ea(a,b){return W(a,b).then(function(){})}function W(a,c){return new(b("Promise"))(function(e){var f=Z("deprecatedSendStanzaAndWaitForAck"),g=function(a){var b=d("WAAckParser").AckParser.parse(a);return!b.error&&d("WAAckParser").ackMatchesTemplate(b.success,c)?a:null},h={type:"ack",parseAndTest:g,resolve:e,stanza:a,attachedToSocketId:0,orderedId:P++};f.ackHandlers.push(h);if(!f.socket){d("WALogger").LOG(i());return}f.callStanza(a)["catch"](function(a){var c=f.ackHandlers.indexOf(h);if(c===-1)return;d("WAArrayUtils").removeIndexWithoutPreservingOrder(f.ackHandlers,c);h.resolve(b("Promise").reject(a))})})}function X(a){var b=Z("castStanza");b.socket?b.castStanza(a):d("WALogger").LOG(h())}function fa(a){var b=Z("castStanza");return b.socketId===a}function ga(a){X(a)}function Y(a,e,f,g){f===void 0&&(f=0);g===void 0&&(g="iq");return new(b("Promise"))(function(h){var i=Z("sendIq"),j=a.attrs.id;if(!j||typeof j!=="string")throw c("WAErr")("Comms:sendIq given iq without id: "+String(a));var k=i.socketId;if(e&&!k){h(b("Promise").reject(new(d("WAErrors").Offline)()));return}var l;f>0&&(l=setTimeout(function(){var a=g==="iq"?i.pendingIqs.get(j):i.pendingSmaxStanzas.get(j);if(!a){h(b("Promise").reject(c("WAErr")("Comms:_sendIq unexisting stanza to be cancelled: "+j)));return}i.removeHandler(a)},f*1e3));k={resolve:h,stanza:a,attachedToSocketId:e?k:0,orderedId:P++,timeoutId:l};if(g==="iq"){var m=babelHelpers["extends"]({type:g},k);i.pendingIqs.set(j,m);i.config.handlers.onSendIq==null?void 0:i.config.handlers.onSendIq(a);i.maybeSendPendingStanza(m)}else{g;m=babelHelpers["extends"]({type:g},k);i.pendingSmaxStanzas.set(j,m);i.maybeSendPendingStanza(m)}})}function ha(a,b){return Y(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function ia(a,b,c){return Y(a,!1).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b,c)})}function ja(a,b){var c;c=(c=b==null?void 0:b.withoutRetry)!=null?c:!1;b=(b=b==null?void 0:b.timeoutSeconds)!=null?b:0;return Y(a,c,b,"smax")}function ka(a,b,c){return Y(a,!1,c).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function la(a,b){return Y(a,!0).then(function(a){return d("WAParseIqResponse").parseIqResponse(a,b)})}function ma(){var a=Z("sendPing");return a.sendPing()}function na(){return Z("startHandlingRequests").startHandlingRequests()}function oa(){N&&N.deadSocketTimer.cancel()}function Z(a){if(N)return N;throw c("WAErr")("Comms::"+a+" called before startComms")}function $(a){if(a.tag==="iq"){var b=a.attrs.type;if(b==="result"||b==="error")return d("WAWap").decodeAsString(a.attrs.id)||null}return null}function pa(){N=null,O=new(d("WAResolvable").Resolvable)(),P=1}g.getComms=a;g.startComms=e;g.stopComms=f;g.closeSocketAndPreventRetry=R;g.openSocketLoop=S;g.maybeResetSocketLoop=T;g.forceResetSocketLoop=aa;g.isSocketConnected=U;g.socketLoopIteration=V;g.closeSocket=ba;g.onStreamErrorReceived=ca;g.waitForConnection=da;g.deprecatedSendStanzaAndWaitForAck=ea;g.deprecatedSendStanzaAndReturnAck=W;g.castSmaxStanza=X;g.isActiveSocket=fa;g.deprecatedCastStanza=ga;g.deprecatedSendIq=ha;g.deprecatedSendIqErrorParser=ia;g.sendSmaxStanza=ja;g.deprecatedSendIqIfConnectedWithin=ka;g.deprecatedSendIqWithoutRetry=la;g.sendPing=ma;g.startHandlingRequests=na;g.cancelDeadSocketTimer=oa;g.singletonOrThrowIfUninitialized=Z;g.resetStateForTests=pa}),98);
__d("WAMediaConnParser",["WAServerMediaType","WAWapParser"],(function(a,b,c,d,e,f,g){a=new(d("WAWapParser").WapParser)("mediaConnParser",function(a){a=a.child("media_conn");var b=j(a);return{hosts:b,authToken:a.attrString("auth"),authTTL:a.hasAttr("auth_ttl")?a.attrFutureTime("auth_ttl"):null,authExpires:a.attrFutureTime("ttl"),maxBuckets:a.hasAttr("max_buckets")?a.attrInt("max_buckets"):null,maxManualRetry:(b=a.maybeAttrInt("max_manual_retry",0,4))!=null?b:3,maxAutoDownloadRetry:(b=a.maybeAttrInt("max_auto_download_retry",0,4))!=null?b:3}});function h(a){var b;return!a.hasAttr("fallback_hostname")?void 0:{domain:a.attrString("fallback_hostname"),"class":a.maybeAttrString("fallback_class"),ip4:(b=a.maybeAttrString("fallback_ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("fallback_ip6"))!=null?b:void 0}}function i(a){var b;return{domain:a.attrString("hostname"),fallback:h(a),uploadable:k(a,"upload"),downloadable:k(a,"download"),isFallback:a.maybeAttrString("type")==="fallback",downloadBuckets:(b=(b=a.maybeChild("download_buckets"))==null?void 0:b.mapChildren(function(a){return parseInt(a.tag(),10)}))!=null?b:[],"class":a.maybeAttrString("class"),ip4:(b=a.maybeAttrString("ip4"))!=null?b:void 0,ip6:(b=a.maybeAttrString("ip6"))!=null?b:void 0}}function j(a){return a.mapChildrenWithTag("host",i)}function k(a,b){if(a.hasChild(b))return a.child(b).mapChildren(function(a){a=a.tag();return d("WAServerMediaType").castToServerMediaType(a)}).filter(Boolean);else return d("WAServerMediaType").SERVER_MEDIA}g.mediaConnParser=a}),98);
__d("WAGatherMediaInfo",["WAComms","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""]);l=function(){return a};return a}var m=507;b=d("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},a);function a(){var a=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:o});a.start();return a.promise()}var n=60;function o(a){var b=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:d("WAWap").generateId()},d("WAWap").wap("media_conn",null));return d("WAComms").deprecatedSendIqIfConnectedWithin(b,d("WAMediaConnParser").mediaConnParser,n).then(function(b){if(!b.success){d("WALogger").LOG(l(),b);if(b.errorCode===m){var c=b.errorBackoff;d("WALogger").LOG(k(),c);a(d("WAResultOrError").makeError({type:"backoff",backoffMs:c*1e3}))}else b.errorCode<500&&(d("WALogger").LOG(j(),b.errorCode),a(d("WAResultOrError").makeError({type:"client-error",code:b.errorCode,text:b.errorText})))}else d("WALogger").LOG(i(),b.result.hosts.length),a(d("WAResultOrError").makeResult(b.result))})["catch"](function(b){b instanceof d("WAErrors").Disconnected?a(d("WAResultOrError").makeError("disconnected")):d("WALogger").ERROR(h(),b)})}g.gatherMediaInfo=b}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=null,c=null,e=null,f=a.hosts,g=a.operation,h=a.mediaType;if(a.operation==="download"){var i=a.catHotTimespan,j=a.ncHot;a=a.getVcaEnabledBucket;var k=new Map();f.forEach(function(a){a.downloadBuckets.forEach(function(b){k.set(b,a)})});var l=k.get(0);i>0&&(h==="sticker"||j!=null&&d("WATimeUtils").happenedWithin(d("WATimeUtils").castToUnixTime(j),i))?b=1:a&&(b=a());j=null;b!=null&&(j=k.get(b));((i=j)==null?void 0:i.downloadable.includes(h))?c=j:(l==null?void 0:l.downloadable.includes(h))&&(c=l)}for(a=0;a<f.length;a++){i=f[a];i.isFallback&&e==null&&(e=i);g==="upload"?c==null&&i.uploadable.includes(h)&&(c=i):c==null&&i.downloadable.includes(h)&&(c=i);if(c!=null&&e!=null)break}return{selectedHost:c,fallbackHost:e,bucket:b}}g.mediaRouteSelection=a}),98);
__d("WAGetMediaRoute",["WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WALogger","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetMediaRoute Error: can not get mediaAccess"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetMediaRoute: mediaAccess has gone, gather a new one"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetMediaRoute: mediaAccess has gone, but we are still locked by backoff"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetMediaRoute Error: no media host"]);k=function(){return a};return a}var l=!0,m=86400;function c(a){var c,e,f,g,h,i,j,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:o.next=2;return b("regeneratorRuntime").awrap(p());case 2:c=o.sent;if(c.success){o.next=5;break}return o.abrupt("return",c);case 5:e=c.value,f=e.authToken,g=e.hosts,h=e.maxBuckets;i=a.operation==="upload"?d("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:a.serverMediaType,hosts:g}):d("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:a.serverMediaType,hosts:g,catHotTimespan:m,ncHot:d("WAExtractNcHotTimestamp").extractNcHotTimestamp(a.directPath),getVcaEnabledBucket:l?d("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(a.directPath,h):void 0}),j=i.selectedHost,n=i.fallbackHost;if(!(j==null)){o.next=10;break}d("WALogger").ERROR(k());return o.abrupt("return",d("WAResultOrError").makeError("no-host"));case 10:return o.abrupt("return",d("WAResultOrError").makeResult({authToken:f,selectedHost:j,fallbackHost:n}));case 11:case"end":return o.stop()}},null,this)}var n=null,o=!1,p=d("WAPromiseManagement").cacheWhilePending(function(){return"all"},function(){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(n!=null&&d("WATimeUtils").secondsUntil(n.authExpires)>0)){e.next=4;break}return e.abrupt("return",d("WAResultOrError").makeResult(n));case 4:if(!o){e.next=7;break}d("WALogger").LOG(j());return e.abrupt("return",d("WAResultOrError").makeError("backoff"));case 7:d("WALogger").LOG(i());e.next=10;return b("regeneratorRuntime").awrap(d("WAGatherMediaInfo").gatherMediaInfo());case 10:c=e.sent;if(!c.success){e.next=16;break}n=c.value;return e.abrupt("return",c);case 16:d("WALogger").ERROR(h());if(!(c.error==="disconnected"||c.error.type==="client-error")){e.next=21;break}return e.abrupt("return",d("WAResultOrError").makeError("disconnected"));case 21:c.error.type;o=!0;a.setTimeout(function(){o=!1,p()},c.error.backoffMs);return e.abrupt("return",d("WAResultOrError").makeError("backoff"));case 25:case"end":return e.stop()}},null,this)});function e(){n=null,o=!1}g.getMediaRoute=c;g.clearCachedMediaAccessForTest=e}),98);
__d("WAGetResignedCdnUrl",["WAComms","WALogger","WAPromiseRetryLoop","WAResultOrError","WAWap","WAWapParser"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestCdnResignedUrl failure ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Direct path signature expired. objectId: ",", fbid: ","."]);i=function(){return a};return a}var j=507;function a(a){var b=a.objectId;a=a.fbid;b=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"requestCdnResignedUrl",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:k({objectId:b,fbid:a})});b.start();return b.promise()}function k(a){var b=a.objectId,c=a.fbid;return function(a){d("WALogger").LOG(i(),b,c);var e=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"w:m",type:"get",id:d("WAWap").generateId()},d("WAWap").wap("cdn_url_resign",{object_id:d("WAWap").CUSTOM_STRING(b),fbid:d("WAWap").CUSTOM_STRING(c),use_case_hint:"fb_encrypted_backup",sign_duration:d("WAWap").INT(259200)}));return d("WAComms").deprecatedSendIq(e,m).then(function(b){if(b.success)a(d("WAResultOrError").makeResult(b.result));else{d("WALogger").LOG(h(),b);if(b.errorCode===j)return a(d("WAResultOrError").makeError({code:b.errorCode,text:b.errorText,backoff:b.errorBackoff}));if(l(b.errorCode))return;return a(d("WAResultOrError").makeError({code:b.errorCode,text:b.errorText}))}})}}var l=function(a){return Math.floor(a/100)===5},m=new(d("WAWapParser").WapParser)("cdn_url_resign",function(a){a.assertTag("iq");a.assertFromServer();a.assertAttr("type","result");a=a.child("cdn_url_resign");return{directPath:a.attrString("direct_path")}});g.getCdnResignedUrl=a}),98);
__d("WAHttpDownloadMedia",["WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: can not resume from offset"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to initiate fetch: ",""]);l=function(){return a};return a}var m="URL signature expired";function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"GET",mode:"cors",cache:"no-store"}));case 3:c=g.sent;g.next=10;break;case 6:g.prev=6;g.t0=g["catch"](0);d("WALogger").ERROR(l(),g.t0);throw g.t0;case 10:e=c,f=e.status;d("WALogger").LOG(k(),f);g.t1=f;g.next=g.t1===200?15:g.t1===206?15:g.t1===401?16:g.t1===403?17:g.t1===404?18:g.t1===410?18:g.t1===408?19:g.t1===416?20:g.t1===429?22:g.t1===507?22:23;break;case 15:return g.abrupt("return",c.arrayBuffer().then(function(a){return d("WAResultOrError").makeResult(a)})["catch"](function(a){d("WALogger").ERROR(j(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return g.abrupt("return",d("WAResultOrError").makeError("access-expired"));case 17:return g.abrupt("return",c.text().then(function(a){return a===m?d("WAResultOrError").makeError("signature-expired"):d("WAResultOrError").makeError("access-expired")})["catch"](function(a){d("WALogger").ERROR(i(),a);return d("WAResultOrError").makeError("access-expired")}));case 18:return g.abrupt("return",d("WAResultOrError").makeError("media-not-found"));case 19:return g.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 20:d("WALogger").ERROR(h());return g.abrupt("return",d("WAResultOrError").makeError("request-error"));case 22:return g.abrupt("return",d("WAResultOrError").makeError("download-throttled"));case 23:if(!(f>=400&&f<500)){g.next=25;break}return g.abrupt("return",d("WAResultOrError").makeError("request-error"));case 25:return g.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 26:case"end":return g.stop()}},null,this,[[0,6]])}g.httpDownloadMedia=a}),98);
__d("WATypedArraysConcat",[],(function(a,b,c,d,e,f){function a(a,b,c){c===void 0&&(c=0);c=b.reduce(function(a,b){return a+b.length},c);var d=new a(c),e=0;b.forEach(function(a){d.set(a,e),e+=a.length});return d}f.concatTypedArrays=a}),66);
__d("WACryptoAesCbc",["Promise","WABinary","WAErr","WATypedArraysCast","WATypedArraysConcat","regeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=16,i=1024,j=16,k=1024*1024,l=h*k;k=function(){function a(a,b,c,d){this.$4=null;this.$6=!1;this.$1=a;this.$2=b;this.$3=c;var e={name:"AES-CBC",iv:d};this.$5=self.crypto.subtle.importKey("raw",c,"AES-CBC",!1,[b]).then(function(a){return{algo:e,key:a}})}var b=a.prototype;b.append=function(a){var b=this;this.$7("append");var c=this.$4;if(c){c.writeByteArray(a);if(c.size()>i){var e=c.size()%h;e=c.readByteArray(c.size()-e);c.size()||(this.$4=null)}else e=null}else if(a.length>i){c=a.length%h;!c?e=a:(this.$4=new(d("WABinary").Binary)(a),e=this.$4.readByteArray(a.length-c))}else this.$4=new(d("WABinary").Binary)(a),e=null;var f=e;f&&(this.$5=this.$5.then(function(a){var c=a.key;a=a.algo;if(b.$2==="encrypt")return self.crypto.subtle.encrypt(a,c,f).then(function(a){b.$1.writeByteArray(new Uint8Array(a,0,a.byteLength-h));return new Uint8Array(a,a.byteLength-2*h,h)});else{var d=f.slice(-h);return self.crypto.subtle.decrypt(a,c,f).then(function(a){b.$1.writeBuffer(a);return d})}}).then(function(a){var c={name:"AES-CBC",iv:a};return self.crypto.subtle.importKey("raw",b.$3,"AES-CBC",!1,[b.$2]).then(function(a){return{algo:c,key:a}})}));return this.$5.then(function(){})};b.finalize=function(a){var b=this;this.$7("finalize");var c;if(this.$4){var d=this.$4;a&&d.writeByteArray(a);c=d.readByteArray();this.$4=null}else a&&(c=a);if(c){var e=c;return this.$5.then(function(a){var c=a.algo;a=a.key;if(b.$2==="encrypt")return self.crypto.subtle.encrypt(c,a,e);else return self.crypto.subtle.decrypt(c,a,e)}).then(function(a){b.$1.writeBuffer(a)})}else return this.$5.then(function(){})};b.$7=function(a){if(this.$6)throw c("WAErr")("AesCbcStream."+a+" called after finalize")};return a}();function m(a){return{name:"AES-CBC",iv:d("WATypedArraysCast").castTypedArrays(Uint8Array,a)}}function n(a){return self.crypto.subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["encrypt"])}function o(a){if(a)return d("WATypedArraysCast").castTypedArrays(Uint8Array,a);a=new Uint8Array(j);self.crypto.getRandomValues(a);return a}function p(a){a=a.byteLength;var b=h-a%h;return Number.isNaN(b)?a:a+b}function q(a,c,e){var f=m(c);return b("Promise").resolve(self.crypto.subtle.importKey("raw",d("WATypedArraysCast").castTypedArrays(Uint8Array,a),"AES-CBC",!1,["decrypt"])).then(function(a){return self.crypto.subtle.decrypt(f,a,e)})}function a(a,c){return b("Promise").resolve().then(function(){var b=c.slice(0,j),d=c.slice(j);return q(a,b,d)})}function e(a,c,e){return b("Promise").resolve().then(function(){var f=o(e),g=m(f);return b("Promise").resolve(n(a)).then(function(a){return self.crypto.subtle.encrypt(g,a,c)}).then(function(a){return d("WATypedArraysConcat").concatTypedArrays(Uint8Array,[f,new Uint8Array(a)]).buffer})})}function f(a,d,e,f){var g,i,j,k,m,q,s,t,u,v,w,x,y;return b("regeneratorRuntime").async(function(z){while(1)switch(z.prev=z.next){case 0:f===void 0&&(f=l);if(!(f%h!==0)){z.next=3;break}throw c("WAErr")("chunkSize must be a multiple of "+h+", "+f+" received");case 3:z.next=5;return b("regeneratorRuntime").awrap(n(a));case 5:g=z.sent,i=new Uint8Array(d),j=Math.ceil(i.byteLength/f),k=o(e),m=new Uint8Array(p(i)+k.byteLength),m.set(k),(q=0,s=k);case 12:if(!(q<j)){z.next=26;break}u=q===j-1;v=q*f;t=i.subarray(v,v+f);z.next=18;return b("regeneratorRuntime").awrap(r(u,t,s,g));case 18:w=z.sent,x=w.encryptedChunk,y=w.nextIv,m.set(x,k.byteLength+q*f),s=y;case 23:q++;z.next=12;break;case 26:return z.abrupt("return",m.buffer);case 27:case"end":return z.stop()}},null,this)}function r(a,c,d,e){var f,g;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(self.crypto.subtle.encrypt(m(d),e,c).then(function(b){return a?new Uint8Array(b):new Uint8Array(b).subarray(0,-h)}));case 2:f=i.sent;g=f.slice(-h);return i.abrupt("return",{encryptedChunk:f,nextIv:g});case 5:case"end":return i.stop()}},null,this)}g.AES_CBC_BLOCK_SIZE=h;g.AesCbcStream=k;g.importRawKey=n;g.getIv=o;g.aesCbcDecrypt=q;g.aesCbcDecryptSplit=a;g.aesCbcEncrypt=e;g.aesCbcEncryptWithChunking=f;g.aesCbcEncryptChunk=r}),98);
__d("WAMediaHkdfInfo",["WAErr"],(function(a,b,c,d,e,f,g){function a(a){switch(a){case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";default:throw c("WAErr")("getMediaHkdfInfo: unexpected media type "+a)}}function b(){return"Messenger Preview Keys"}g.getMediaHkdfInfo=a;g.getPreviewMediaHkdfInfo=b}),98);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({DECRYPT_MESSAGE_FINAL:"decrypt_message_final",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ICDC_ERROR:"icdc_error",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RETRY_RECEIPTS_SENT:"retry_receipts_sent",SAVE_SESSION_RETRIES:"save_session_retries",SAVE_SIGNAL_SESSION_RETRIES:"save_signal_session_retries",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",APP_STATE_SYNC_DAILY:"app_state_sync_daily",SYNCD:"syncd",SEND_MESSAGE:"send_message",RECEIVE_MESSAGE:"receive_message",TEST_RECEIVE_MESSAGE:"test_receive_message",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_FAILURE_STANZA:"wa_failure_stanza",REMOVE_PARTICIPANTS:"remove_participants",CREATE_GROUP:"create_group",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_DISCONNECT:"wa_disconnect",TEST_MAW_ENCRYPT_MESSAGE:"test_maw_encrypt_message",TEST_MAW_WA_SEND_MESSAGE:"test_maw_wa_send_message",WA_JOB_MANAGER:"wa_job_manager",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] "," ends with an error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] "," ends successfully"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] add point "," to ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] resume ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] start ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]);n=function(){return a};return a}var o=0;function a(){var b=[];function c(a){b.push(a)}function e(){d("WALogger").WARN(n()),b.length=0}function a(a){b.length===0&&d("WALogger").ERROR(m()),b.forEach(function(b){b(a)})}return{subscribe:c,notify:a,clear:e}}c=a();var p=c.notify;e=c.clear;f=c.subscribe;function b(a,b,c,e){var f;c==null&&o++;var g=(f=c)!=null?f:o;c==null?(p({name:a,stage:"START",instanceKey:g,annotations:b,nonTrackableAnnotations:e}),d("WALogger").DEV(l(),a)):(p({name:a,stage:"RESUME",instanceKey:g,annotations:b}),d("WALogger").DEV(k(),a));return{addPoint:function(c,b){p({name:a,stage:"POINT",reason:c,instanceKey:g,annotations:b}),d("WALogger").DEV(j(),c,a)},endSuccess:function(b){p({name:a,stage:"SUCCESS",instanceKey:g,annotations:b}),d("WALogger").DEV(i(),a)},endFail:function(c,b){p({name:a,stage:"FAIL",reason:c,instanceKey:g,annotations:b}),d("WALogger").DEV(h(),a,c)}}}g.clear=e;g.subscribe=f;g.startMetric=b}),98);
__d("WAMediaCrypto",["Promise","WABase64","WABinary","WACryptoAesCbc","WACryptoHkdf","WACryptoHmac","WACustomError","WAErr","WALogger","WAMediaCryptoSidecar","WAMediaHkdfInfo","WAMediaUtils","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAMediaCrypto::downloadAndDecrypt"]);h=function(){return a};return a}var i=d("WACustomError").customError("HmacValidationError",!1);function j(a,b){return d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),b,112).then(function(a){return{iv:new Uint8Array(a,0,16),cipherKey:new Uint8Array(a,16,32),hmacKey:new Uint8Array(a,48,32),refKey:new Uint8Array(a,80,32)}})}function a(a,b){b=d("WAMediaHkdfInfo").getMediaHkdfInfo(b);return j(a,b)}function e(a){var b=d("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return j(a,b)}function f(a){switch(a){case"image":case"video":return a;default:throw c("WAErr")("Unsupported PreviewMediaType: "+a)}}var k=16,l=16,m=10,n=64*1024;function o(a,c,e,f,g){var h,i,j,o,p,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:h=new(d("WABinary").Binary)(),h.ensureCapacity(l+f.size+k+m),h.writeByteArray(c),i=new(d("WACryptoAesCbc").AesCbcStream)(h,"encrypt",a,c),j=0,o=j+n;case 6:if(!(o<f.size)){A.next=17;break}p=f.slice(j,o);A.next=10;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(p));case 10:q=A.sent;A.next=13;return b("regeneratorRuntime").awrap(i.append(new Uint8Array(q)));case 13:j=o;o+=n;A.next=6;break;case 17:A.next=19;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(f.slice(j)));case 19:r=A.sent;A.next=22;return b("regeneratorRuntime").awrap(i.finalize(new Uint8Array(r)));case 22:s=h.peek(function(a){return a.readByteArray()});A.next=25;return b("regeneratorRuntime").awrap(d("WACryptoHmac").encodeKeySha256(e));case 25:t=A.sent;A.next=28;return b("regeneratorRuntime").awrap(d("WACryptoHmac").sign(t,s));case 28:u=A.sent;h.writeByteArray(new Uint8Array(u,0,m));v=h.readByteArray();w=v.subarray(l);A.next=34;return b("regeneratorRuntime").awrap(b("Promise").all([self.crypto.subtle.digest("SHA-256",w),d("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(g)?d("WAMediaCryptoSidecar").calculateStreamingSidecar(t,v):void 0]));case 34:x=A.sent;y=x[0];z=x[1];return A.abrupt("return",{ciphertext:w,ciphertextHash:y,sidecar:z});case 38:case"end":return A.stop()}},null,this)}function p(a,c,e,f,g){var h,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:if(10<=g.length&&g.length<=32){n.next=2;break}throw new i("Bad hmac size "+g.length);case 2:h=d("WABinary").Binary.build(c,e).readByteArray();n.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(f,h).then(function(a){return new Uint8Array(a)}));case 5:j=n.sent;k=j.slice(0,g.length);if(q(k,g)){n.next=9;break}throw new i("hmacAndDecrypt hmac mismatch");case 9:n.next=11;return b("regeneratorRuntime").awrap(d("WACryptoAesCbc").aesCbcDecrypt(a,c,e));case 11:l=n.sent;n.next=14;return b("regeneratorRuntime").awrap(self.crypto.subtle.digest("SHA-256",l));case 14:m=n.sent;return n.abrupt("return",{plaintextHash:d("WABase64").encodeB64UrlSafe(new Uint8Array(m)),plaintext:l});case 16:case"end":return n.stop()}},null,this)}function q(a,b){if(a.length!==b.length)return!1;var c=1,d=a.length;for(var e=0;e<d;e++)c&=a[e]===b[e]?1:0;return c!==0}function r(a,e,f,g,i,j,k){var l,m,n,o,q,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:d("WALogger").DEV(h());l=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT);x.prev=2;l.addPoint("download_start");x.next=6;return b("regeneratorRuntime").awrap(fetch(a));case 6:m=x.sent;l.addPoint("download_end");x.next=15;break;case 10:x.prev=10;x.t0=x["catch"](2);l.addPoint("download_end");l.endFail("download_error");throw c("WAErr")("download_error");case 15:if(!(m.status!==200)){x.next=18;break}l.endFail("http_status_"+m.status);throw c("WAErr")("http_status="+m.status);case 18:l.endSuccess();x.next=21;return b("regeneratorRuntime").awrap(m.arrayBuffer());case 21:n=x.sent;if(!(n.byteLength<i+j)){x.next=25;break}l.endFail("bad_ciphertext_size");throw c("WAErr")("bad_ciphertext_size");case 25:o=n.byteLength-j;q=new Uint8Array(n,o);r=q.slice(0,j);s=new Uint8Array(n,0,o);x.next=31;return b("regeneratorRuntime").awrap(p(f,e,s,g,q));case 31:t=x.sent;u=t.plaintext;v=t.plaintextHash;k(new Uint8Array(u));w=new Uint8Array(d("WABase64").decodeB64UrlSafe(v));return x.abrupt("return",b("Promise").resolve({tail:r,plaintextHash:w,hmac:q}));case 37:case"end":return x.stop()}},null,this,[[2,10]])}g.HmacValidationError=i;g.computeMediaKeys=a;g.computeMediaKeysForPreview=e;g.convertServerMediaTypeToPreviewMediaType=f;g.HMAC_LENGTH=m;g.encryptAndHmac=o;g.hmacAndDecrypt=p;g.downloadAndDecrypt=r}),98);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:download wait for internet, attempt = ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running retrier"]);i=function(){return a};return a}var j=4,k={algo:{type:"constant",delay:1e3},jitter:0};a=function(){function a(a,b,c){this.$1=a,this.routesInfo=b,this.$2=d("WAPromiseBackoffs").createPromiseTimer(k),this.$3=0,this.$4=!1,this.$5=c}var c=a.prototype;c.run=function(a,c){var e,f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:if(!(this.$3<j)){l.next=30;break}d("WALogger").DEV(i());l.next=4;return b("regeneratorRuntime").awrap(this.$2());case 4:e=void 0;if(!(this.$3>0)){l.next=13;break}e=this.$3>=j-2&&!this.$4;if(!(this.$1==="download")){l.next=11;break}d("WALogger").LOG(h(),this.$3);l.next=11;return b("regeneratorRuntime").awrap(this.$5==null?void 0:this.$5());case 11:l.next=14;break;case 13:e=!1;case 14:f=this.routesInfo;if(f){l.next=17;break}return l.abrupt("return",null);case 17:g=f.host;e&&f.fallbackHost&&(g=f.fallbackHost);l.next=21;return b("regeneratorRuntime").awrap(a(g,f.authToken,this.$3,c));case 21:k=l.sent;if(!k.success){l.next=26;break}return l.abrupt("return",k.value);case 26:++this.$3,this.$4=k.error.progressMade;case 28:l.next=0;break;case 30:return l.abrupt("return",null);case 31:case"end":return l.stop()}},null,this)};return a}();g.MAX_ATTEMPTS=j;g.BACKOFF_OPTIONS=k;g.MediaOperationsRetrier=a}),98);
__d("WAHttpUtils",["WAErr"],(function(a,b,c,d,e,f,g){function a(a,b,d){if(!/^https:\/\/[-\w.]+\.\w+$/.test(a))throw c("WAErr")('buildUrl given invalid host "'+a+'"');if(!b.startsWith("/"))throw c("WAErr")('buildUrl given invalid path "'+b+'"');var e=d;d=""+a+b;if(!e)return d;a=Object.keys(e).map(function(a){var b=e[a];b instanceof ArrayBuffer&&(b=new Uint8Array(b));b=b instanceof Uint8Array?Array.prototype.slice.call(b).map(function(a){return"%"+a.toString(16)}).join(""):encodeURIComponent(b.toString());return encodeURIComponent(a)+"="+b});if(a.length>0){b=a.join("&");return d.includes("?")?d+"&"+b:d+"?"+b}else return d}g.buildUrl=a}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(a,b,c,d,e,f,g){var h=1;function a(a,b,c,e,f,g){var i=d("WAGlobals").getConfig().mediaUploadRoot();c=d("WABase64").encodeB64UrlSafe(c);b=d("WABase64").encodeB64UrlSafe(b);f={auth:f,token:b};g&&(f.resume=h);return d("WAHttpUtils").buildUrl("https://"+e,i+"/"+a+"/"+c,f)}function b(a,b,c,e){b=d("WABase64").encodeB64UrlSafe(b);return d("WAHttpUtils").buildUrl("https://"+c,a,{hash:b,mode:e})}g.RESUME_PARAM=h;g.buildUploadUrl=a;g.buildDownloadUrl=b}),98);
__d("WADownloadPlaintext",["WAAssertUnreachable","WAGetMediaRoute","WAGetResignedCdnUrl","WAHttpDownloadMedia","WALogger","WAMediaCrypto","WAMediaOperationsRetrier","WAMediaUrl","WAPromiseDelays","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Success"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia given up"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate a new cdn url"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["result to generate a new cdn url was throttled (507)"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate a new cdn url: missing objectId or fbid"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""]);p=function(){return a};return a}function a(a,e,f,g,q,r,s,t){var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;return b("regeneratorRuntime").async(function(M){while(1)switch(M.prev=M.next){case 0:u=(a==null?void 0:a.serverMediaType)!=null?a.serverMediaType:"preview";M.next=3;return b("regeneratorRuntime").awrap(d("WAGetMediaRoute").getMediaRoute({operation:"download",serverMediaType:u,fileEncSha256:e,directPath:f}));case 3:v=M.sent;if(v.success){M.next=6;break}return M.abrupt("return",v);case 6:w=v.value,x=w.selectedHost,y=w.fallbackHost,z=w.authToken;A=new(d("WAMediaOperationsRetrier").MediaOperationsRetrier)("download",{host:{domain:x.domain,"class":x["class"]},fallbackHost:y&&{domain:y.domain,"class":y["class"]},authToken:z,timeElapsed:null});M.next=10;return b("regeneratorRuntime").awrap(A.run(function(a){a=a.domain;a=d("WAMediaUrl").buildDownloadUrl(f,e,a,"manual");return d("WAHttpDownloadMedia").httpDownloadMedia(a).then(function(c){var a,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!c.success){g.next=4;break}return g.abrupt("return",d("WAResultOrError").makeResult(c));case 4:a=c.error;d("WALogger").LOG(p(),a);g.t0=a;g.next=g.t0==="signature-expired"?9:g.t0==="server-timeout"?26:g.t0==="unspecified-http-error"?26:27;break;case 9:if(!(r==null||s==null)){g.next=12;break}d("WALogger").LOG(o());return g.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired-and-resign-failed")));case 12:g.next=14;return b("regeneratorRuntime").awrap(d("WAGetResignedCdnUrl").getCdnResignedUrl({objectId:r,fbid:s}));case 14:e=g.sent;if(e.success){g.next=21;break}if(!(e.error.code===507&&e.error.backoff!=null)){g.next=19;break}d("WALogger").LOG(n());return g.abrupt("return",d("WAPromiseDelays").delayMs(e.error.backoff).then(function(){return d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired"))}));case 19:d("WALogger").LOG(m());return g.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired-and-resign-failed")));case 21:f=e.value.directPath;if(!(t!=null)){g.next=25;break}g.next=25;return b("regeneratorRuntime").awrap(t(f));case 25:return g.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError("signature-expired")));case 26:return g.abrupt("return",d("WAResultOrError").makeError({progressMade:!0}));case 27:return g.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a)));case 28:case"end":return g.stop()}},null,this)})["catch"](function(a){d("WALogger").ERROR(l(),a);return d("WAResultOrError").makeError({progressMade:!1})})}));case 10:B=M.sent;if(!(B==null)){M.next=14;break}d("WALogger").WARN(k());return M.abrupt("return",d("WAResultOrError").makeError("max-attempts-exceeded"));case 14:if(!(B.success===!1)){M.next=29;break}C=B.error;d("WALogger").ERROR(j(),C);M.t0=C;M.next=M.t0==="signature-expired"?20:M.t0==="signature-expired-and-resign-failed"?21:M.t0==="media-not-found"?22:M.t0==="access-expired"?23:M.t0==="download-throttled"?24:M.t0==="body-network-error"?25:M.t0==="request-error"?25:26;break;case 20:return M.abrupt("return",d("WAResultOrError").makeError("signature-expired"));case 21:return M.abrupt("return",d("WAResultOrError").makeError("signature-expired-and-resign-failed"));case 22:return M.abrupt("return",d("WAResultOrError").makeError("media-not-found"));case 23:return M.abrupt("return",d("WAResultOrError").makeError("disconnected"));case 24:return M.abrupt("return",d("WAResultOrError").makeError("download-throttled"));case 25:return M.abrupt("return",d("WAResultOrError").makeError("request-error"));case 26:return M.abrupt("return",c("WAAssertUnreachable")(C));case 27:M.next=44;break;case 29:D=B.value;E=D.byteLength-d("WAMediaCrypto").HMAC_LENGTH;F=new Uint8Array(D,E);G=new Uint8Array(D,0,E);(a==null?void 0:a.previewMediaType)!=null?H=d("WAMediaCrypto").computeMediaKeysForPreview(g):H=d("WAMediaCrypto").computeMediaKeys(g,u);M.next=36;return b("regeneratorRuntime").awrap(H.then(function(a){var b=a.iv,c=a.cipherKey;a=a.hmacKey;return d("WAMediaCrypto").hmacAndDecrypt(c,b,G,a,F)}).then(d("WAResultOrError").makeResult)["catch"](function(a){d("WALogger").ERROR(i(),a);if(a instanceof d("WAMediaCrypto").HmacValidationError)return d("WAResultOrError").makeError("enc-hash-mismatch");else return d("WAResultOrError").makeError("decryption-error")}));case 36:I=M.sent;if(I.success){M.next=39;break}return M.abrupt("return",I);case 39:J=I.value,K=J.plaintext,L=J.plaintextHash;if(!(q!==L)){M.next=42;break}return M.abrupt("return",d("WAResultOrError").makeError("hash-mismatch"));case 42:d("WALogger").LOG(h());return M.abrupt("return",d("WAResultOrError").makeResult(K));case 44:case"end":return M.stop()}},null,this)}g.downloadPlaintext=a}),98);
__d("WAGetDecodedMediaEntry",["WAGlobals","WAMediaUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaKnownEntries(c));case 2:e=g.sent;f=e.get(a);return g.abrupt("return",f==null?null:d("WAMediaUtils").decodeMediaEntryData(f));case 5:case"end":return g.stop()}},null,this)}g.getDecodedMediaEntry=a}),98);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>100*1024*1024)return"invalid_size";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=100*1024)return"size between 1 KB and 100 KB";else if(a<=1*1024*1024)return"size between 100 KB and 1 MB";else if(a<=10*1024*1024)return"size between 1 and 10 MB";else if(a<=50*1024*1024)return"size between 10 and 50 MB";else return"size above 50 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("MAWDownloadMedia",["MAWGlobals","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWJobDefinitions","MAWUpdateMediaEntryForMsgApi","Promise","WADownloadPlaintext","WAGetDecodedMediaEntry","WAJids","WALogger","WAMediaCrypto","WAMediaQplHelper","WAMediaUtils","WAPREList","WAPREMetrics","WAResultOrError","WAServerMediaType","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch. chatType: ",", serverMediaType: ",", previewMediaType: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping media request reupload for preview media"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaPreviewPromise state: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: mediaEntryData is incomplete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is not downloaded"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: finished downloading"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: failed to download media"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: failed to download media. Reason: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - mediaEntryData is incomplete"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - "," is incomplete for media preview"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: downloadableThumbnail exists. Attempting to download."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: No downloadableThumbnail. Skipping..."]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: GK disabled. Skipping..."]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeDownloadMediaPreview: gk_enabled: ",", thumbnail_available: ",""]);v=function(){return a};return a}var w=!1,x=function(a,c,e,f,g,h){var i,j,k,l,m,w,x,y,z,B,C,D;return b("regeneratorRuntime").async(function(E){while(1)switch(E.prev=E.next){case 0:i=h.downloadableThumbnail;j=i==null?void 0:i.directPath;k=j!=null;l=d("MAWGlobals").getConfig().isDownloadablePreviewsEnabled();d("WALogger").LOG(v(),l,k);if(l){E.next=8;break}d("WALogger").LOG(u());return E.abrupt("return");case 8:if(!(i==null||j==null)){E.next=11;break}d("WALogger").LOG(t());return E.abrupt("return");case 11:d("WALogger").LOG(s());m=i.fileEncSha256,w=i.fileSha256,x=i.mediaKey;if(!(j==null||m==null||w==null||x==null)){E.next=17;break}d("WALogger").WARN(r(),h);d("WALogger").ERROR(q());return E.abrupt("return");case 17:y=d("WAJids").switchOnMsgrChatJidType(a.chat,{group:function(a){return"group"},user:function(a){return"user"}});z=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{string:{chat_type:y,downloadEntry:"preview"}},void 0,{string:{jid:a.chat}});B=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(e);E.next=22;return b("regeneratorRuntime").awrap(d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload(c));case 22:E.next=24;return b("regeneratorRuntime").awrap(A(a,c,z,{previewMediaType:B},j,m,w,x,f,g,h));case 24:C=E.sent,C.success===!1?(d("WALogger").WARN(p(),C.error),d("WALogger").ERROR(o()),D=C.error,z.endFail(D)):(d("WALogger").LOG(n()),z.endSuccess());case 26:case"end":return E.stop()}},null,this)};function y(a){var c={};return b("Promise").race([a,c]).then(function(a){return a===c?"pending":"fulfilled"},function(){return"rejected"})}var z=function(a,c,e){var f,g,h,i,j,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:v.next=2;return b("regeneratorRuntime").awrap(d("WAGetDecodedMediaEntry").getDecodedMediaEntry(a,c));case 2:g=v.sent;if(!(g==null)){v.next=5;break}return v.abrupt("return",d("WAResultOrError").makeError("no-media-entry"));case 5:h=g.directPath,i=g.fbid,j=g.fileEncSha256,n=g.fileSha256,o=g.mediaKey,p=g.objectId,q=g.serverMediaType;r=q==null?null:d("WAServerMediaType").castToServerMediaType(q);if(!(h==null||j==null||n==null||o==null||r==null)){v.next=11;break}d("WALogger").WARN(m(),g);d("WALogger").ERROR(l());return v.abrupt("return",d("WAResultOrError").makeError("media-entry-invalid"));case 11:s=x(a,c,r,p,i,g);v.next=14;return b("regeneratorRuntime").awrap(A(a,c,e,{serverMediaType:r},h,j,n,o,p,i,g));case 14:t=v.sent;v.next=17;return b("regeneratorRuntime").awrap(y(s));case 17:u=v.sent;d("WALogger").LOG(k(),u);(g==null?void 0:(f=g.downloadableThumbnail)==null?void 0:f.directPath)!=null&&(e==null?void 0:e.addPoint("media_preview_state",{string:{state:u}}));return v.abrupt("return",t);case 21:case"end":return v.stop()}},null,this)},A=function(a,c,e,f,g,k,l,m,n,o,p){var q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:v.next=2;return b("regeneratorRuntime").awrap(d("WADownloadPlaintext").downloadPlaintext(f,k,g,m,d("WAMediaUtils").toPlaintextHash(l),n,o,function(e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:f=function(){return d("WAMediaUtils").encodeMediaEntryWithUpdatedPath(p,e)};g.next=3;return b("regeneratorRuntime").awrap(d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(c,a,f,n,p.serverMediaType));case 3:case"end":return g.stop()}},null,this)}));case 2:q=v.sent;if(!(q.success===!1)){v.next=25;break}r=q.error;v.t0=r;v.next=v.t0==="signature-expired"?8:v.t0==="signature-expired-and-resign-failed"?9:v.t0==="media-not-found"?9:v.t0==="enc-hash-mismatch"?17:21;break;case 8:return v.abrupt("return",z(a,c));case 9:if(!w){v.next=16;break}if(!(f==null?void 0:f.previewMediaType)){v.next=14;break}d("WALogger").WARN(j());v.next=16;break;case 14:v.next=16;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.requestReuploadMedia(a,c)));case 16:return v.abrupt("return",d("WAResultOrError").makeError(r));case 17:s=d("WAJids").switchOnMsgrChatJidType(a.chat,{group:function(a){return"group"},user:function(a){return"user"}});d("WALogger").WARN(i(),s,f.serverMediaType,f.previewMediaType);d("WALogger").ERROR(h());return v.abrupt("return",d("WAResultOrError").makeError(r));case 21:r;return v.abrupt("return",d("WAResultOrError").makeError(r));case 23:v.next=36;break;case 25:t=q.value;e==null?void 0:e.addPoint("download_media_success",{string:{media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(t.byteLength)}});if(!(f==null?void 0:f.previewMediaType)){v.next=32;break}v.next=30;return b("regeneratorRuntime").awrap(d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload(c,t,f.previewMediaType));case 30:v.next=35;break;case 32:u=d("WAMediaUtils").getMimeTypeFromServerMediaType(f.serverMediaType);v.next=35;return b("regeneratorRuntime").awrap(d("MAWHandleMediaDownloadApi").handleMediaDownload(c,u,t,a));case 35:return v.abrupt("return",d("WAResultOrError").makeResult());case 36:case"end":return v.stop()}},null,this)};g.downloadMedia=z}),98);
__d("MAWHandleEchoMediaMsgsRestore",["LSDataTraceCheckPoint.re","LSDataTraceType.re","MAWAsConsumerApplication","MAWBridgeTypes","MAWDbChunkTxns","MAWDbMediaTxns","MAWDownloadMedia","MAWFrontendMediaUtils","MAWGlobals","MAWIndexedDb","MAWJids","MAWMediaManagementTxns","MAWMediaUtils","MAWTraceUtils","MAWTransactionMode","Promise","WABase64","WAJids","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing from index db. It is required to retry download by resigning cdn url"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Retry download media as signature has expired and should be renewed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download failed with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] blob is missing from chunk table for the downloaded file"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media download complete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] start media download from whatsapp infra"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media for message: "," is already downloaded on the device"]);n=function(){return a};return a}var o="media_restore";function p(a){a=x(a);return a.then(function(a){a=a==null?void 0:a.blobData;return a!=null})}function a(a,e){var f,g,h,i,j,k,l,m,u,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;return b("regeneratorRuntime").async(function(M){while(1)switch(M.prev=M.next){case 0:f=q(a.mediaData.plaintextHash);g=a.mediaData,h=g.directPath,i=g.mediaContentType,j=g.mediaKeyTimestamp,k=g.size;l=d("WAMediaUtils").stringToPlaintextHash(f);m=d("MAWMediaUtils").genHMACPlaintextHash(l);u=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(i);w=u.mediaType;x=u.serverMediaType;y=a.mediaData.width;z=a.mediaData.height;A=a.mediaData.previewContentWidth;B=a.mediaData.previewContentHeight;C=a.mediaData.mediaPlayableDuration;D=d("WAMediaUtils").stringToDeliveryObjectId(a.mediaData.attachmentObjectId);E=a.mediaData.backupEntFbid;F=E!=null?d("WAMediaUtils").stringToBackupEntFbid(E):void 0;G=r({height:z,mediaPlayableDuration:C,mediaType:w,previewContentHeight:B,previewContentWidth:A,width:y});H=s(f,a.mediaData.hashedPlaintextHash,a.mediaData.mediaKey,h,j,x);M.next=19;return b("regeneratorRuntime").awrap(v(m,l,a.msgId,k,H,G,w,D,e,F));case 19:M.next=21;return b("regeneratorRuntime").awrap(p(m));case 21:I=M.sent;if(!I){M.next=27;break}d("WALogger").LOG(n(),a.externalId);return M.abrupt("return",b("Promise").resolve());case 27:J=d("MAWTraceUtils").startNewTrace(c("LSDataTraceType.re").encryptedBackupsMediaRestore,o);d("MAWTraceUtils").recordCheckpointForTrace(J,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreStart,[],!1);K=d("WAJids").extractUserId(d("MAWJids").toUserJid(a.threadJId));L={attachmentFbId:a.mediaData.backupEntFbid,attachmentObjectId:d("WAMediaUtils").stringToDeliveryObjectId(a.mediaData.attachmentObjectId),mediaType:x,messageId:a.externalId,messageTimeStamp:a.messageTimestamp,productType:d("MAWGlobals").getConfig().productTypeForEBAttachments,threadId:K};M.next=33;return b("regeneratorRuntime").awrap(t({author:a.author,externalId:a.externalId,hashedPlaintextHash:m,height:z,mediaPlayableDuration:C,mediaType:w,plaintextHash:l,previewContentHeight:B,previewContentWidth:A,threadJId:a.threadJId,width:y},J,L));case 33:case"end":return M.stop()}},null,this)}function q(a){if(a.endsWith("=")){var b="";for(var c=0;c<a.length;c++){var d=a.charAt(c);if(d==="=")return b;b+=d}}return a}function r(a){var b=a.height,c=a.jpegThumbnail,e=a.mediaType,f=a.width,g=a.previewContentHeight,h=a.previewContentWidth;a=a.mediaPlayableDuration;return{validatedAudioInfo:e==="Ptt"&&a!=null?{duration:a,mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedImageInfo:e==="Image"?{height:b,jpegThumbnail:c,jpegThumbnailHeight:g,jpegThumbnailWidth:h,width:f}:e==="Gif"||e==="Sticker"?{height:b,jpegThumbnailHeight:b,jpegThumbnailWidth:f,width:f}:null,validatedVideoInfo:e==="Video"?{height:b,jpegThumbnail:c,jpegThumbnailHeight:g,jpegThumbnailWidth:h,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:f}:null}}function s(a,b,c,e,f,g){a=d("WABase64").decodeB64UrlSafe(a);b=d("WABase64").decodeB64UrlSafe(b,!0);c=d("WABase64").decodeB64UrlSafe(c,!0);return d("WAMediaUtils").rawDataToMediaEntry(a,b,c,e,d("WATimeUtils").castToUnixTime(f),g)}var t=function(a,e,f){var g,h,n,o,p,q,s,t,v,y,z,A,B,C,D,E,F;return b("regeneratorRuntime").async(function(G){while(1)switch(G.prev=G.next){case 0:d("WALogger").LOG(m());g=a.author,h=a.externalId,n=a.hashedPlaintextHash,o=a.height,p=a.mediaPlayableDuration,q=a.mediaType,s=a.plaintextHash,t=a.previewContentHeight,v=a.previewContentWidth,y=a.threadJId,z=a.width;A=d("WAJids").switchOnMsgrChatJidType(y,{group:function(a){return"group"},user:function(a){return"user"}});B=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{string:{chat_type:A,downloadEntry:"handleEchoMediaMsgsRestore"}});G.next=6;return b("regeneratorRuntime").awrap(d("MAWDownloadMedia").downloadMedia({author:g,chat:y,externalId:h},s,B));case 6:C=G.sent;if(!C.success){G.next=25;break}B.endSuccess();G.next=11;return b("regeneratorRuntime").awrap(x(n));case 11:D=G.sent;E=D==null?void 0:D.blobData;if(!(E!=null)){G.next=21;break}F=r({height:o,jpegThumbnail:E,mediaPlayableDuration:p,mediaType:q,previewContentHeight:t,previewContentWidth:v,width:z});G.next=17;return b("regeneratorRuntime").awrap(w(n,F));case 17:d("WALogger").LOG(l());d("MAWTraceUtils").recordSuccessAndFlushForTraceId(e,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreSuccess,[]);G.next=23;break;case 21:d("WALogger").ERROR(k()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(e,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreFailure,[],"blob is missing from chunk table for the downloaded file");case 23:G.next=34;break;case 25:d("WALogger").ERROR(j(),C.error);B.endFail(C.error);if(!(C.error==="signature-expired-and-resign-failed"&&f)){G.next=33;break}d("WALogger").ERROR(i());G.next=31;return b("regeneratorRuntime").awrap(u(h,f,e));case 31:G.next=34;break;case 33:d("MAWTraceUtils").recordFailureAndFlushForTraceId(e,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreFailure,[],"media download failed with error: "+C.error);case 34:case"end":return G.stop()}},null,this)},u=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(function(a,b,e,f){var g=d("WAMediaUtils").stringToDeliveryObjectId(e.attachmentObjectId);return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,g).then(function(a){a&&e.attachmentFbId!=null?d("MAWIndexedDb").afterTransaction({tag:"ResignAttachmentCDNUrl",value:d("MAWBridgeTypes").createBridgeResignAttachmentCDNUrl(e.attachmentObjectId,e.attachmentFbId,e.messageTimeStamp,b,e.threadId,d("MAWGlobals").getConfig().productTypeForEBAttachments,e.mediaType,f)}):(d("WALogger").ERROR(h()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreFailure,[],"media entry is missing from index db. It is required to retry download by resigning cdn url"))})}),v=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE})(function(a,b,c,e,f,g,h,i,j,k,l){return d("MAWMediaManagementTxns").linkMedia(a,e,c,i,f,g,h,b,j,l,k)}),w=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE})(function(a,b,c){return d("MAWMediaManagementTxns").updateMediaEntryWithValidatedMediaInfo(a,b,c)}),x=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b)});g.downloadMediaAndWriteToMediaStore=a;g.getMediaEntry=s;g.handleDownloadMedia=t}),98);
__d("MAWHandleEchoReceiptsRestore",["EchoMessageReceiptStatusFieldUtils","MAWDbMsg","MAWDbParticipant","MAWDbParticipantTxns","MAWDbReceiptTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAJids","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Completed restore of receipts"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Started restore of receipts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Receipt time is empty for the user"]);j=function(){return a};return a}function k(a,b,c,e){var f=a.get(b)||[d("WATimeUtils").DEFAULT_UNIXTIME,d("WATimeUtils").DEFAULT_UNIXTIME,d("WATimeUtils").DEFAULT_UNIXTIME],g=f[0],h=f[1];f=f[2];e!=null&&f<e&&(f=e,h=c);g<c&&(g=c);a.set(b,[g,h,f])}function l(a,b){function c(c,e){return c.concat(e.restoredMessages.map(function(c){var e;e=(e=a.echoMsgMap.get(c.dbMsg.externalId))==null?void 0:e.receiptStatusList;if(e!=null){var f=new Map();for(var g=0;g<e.length;g++){var h=e[g],i=h.address,l=h.status;h=h.timestampMs;if(h==null){d("WALogger").WARN(j());continue}h=h/1e3;h=d("WATimeUtils").castToUnixTime(h);i=d("WAJids").toMsgrUserJid(i.localKey);var m=f.get(i)||{};l===d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.READ?(f.set(i,babelHelpers["extends"]({},m,{readTs:h})),k(b,d("MAWDbParticipant").craftParticipantId(c.dbMsg.thread,i),d("MAWDbMsg").getCanonicalTsFromMsg(c.dbMsg),h)):l===d("EchoMessageReceiptStatusFieldUtils").MessageReceiptStatus.DELIVERED&&(f.set(i,babelHelpers["extends"]({},m,{deliveredTs:h})),k(b,d("MAWDbParticipant").craftParticipantId(c.dbMsg.thread,i),d("MAWDbMsg").getCanonicalTsFromMsg(c.dbMsg),null))}return{msgId:c.dbMsg.msgId,permittedIdentitiesPerDevice:null,recipientDevices:new Set(),statusTsPerUser:f}}return null}).filter(Boolean))}return c}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE})(function(a,b,c){var e=0;c==null?void 0:c.addPoint("receipts_restore_start");d("WALogger").LOG(i());var f=new Map(),g=d("MAWDexieTable").dexieAll(b.restoredMsgs).then(function(a){return d("MAWDexieTable").dexieAll(a).then(function(a){return a.reduce(l(b,f),[])}).then(function(a){return a})});return g.then(function(b){e=b.length,d("MAWDexieTable").dexieAll([d("MAWDbReceiptTxns").bulkPutReceipt(a,b),d("MAWDbParticipantTxns").bulkUpdateParticipantTimestamps(a,Array.from(f,function(a){var b=a[0];a=a[1];var c=a[0],d=a[1];a=a[2];return{deliveredWatermarkTs:c,isDualSend:!1,lastReadActionTs:a,lastReadWatermarkTs:d,participantId:b}}))])}).then(function(){d("WALogger").LOG(h()),c==null?void 0:c.addPoint("receipts_restore_done",{"int":{receipts:e}})})["catch"](function(a){d("WALogger").ERROR(["[labyrinth-web] restore receipt failed."],[a])})["finally"](function(){d("MAWDexieTable").dexieResolve()})});g.writeReceiptsToReceiptsStore=a}),98);
__d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaGatingType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMAGatingType.INFO:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.INFO;case d("EchoMessageXMAFieldUtils").XMAGatingType.EYE_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.EYE_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.NEWS_OFF:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NEWS_OFF;case d("EchoMessageXMAFieldUtils").XMAGatingType.WARNING:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.WARNING;case d("EchoMessageXMAFieldUtils").XMAGatingType.PRIVATE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE;case d("EchoMessageXMAFieldUtils").XMAGatingType.NONE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE}}g.convertXMAGatingTypeToExtendedContentOverlayIconGlyph=a}),98);
__d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType",["EchoMessageXMAFieldUtils","WAArmadilloXMA.pb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid xmaLayoutType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("EchoMessageXMAFieldUtils").XMALayoutType.SINGLE:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE;case d("EchoMessageXMAFieldUtils").XMALayoutType.PORTRAIT:return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.PORTRAIT;default:d("WALogger").ERROR(h(),a);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE}}g.convertXMALayoutTypeToExtendedContentXMLLayoutType=a}),98);
__d("MAWGetThreadsInfoApi",["MAWDbThreadTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThreadIdByDeduplicationKey ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThreadIdByJid ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getThreadIdByJid",!1)))(function(a,b){d("WALogger").DEV(i(),b);return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(a){return a.success?a.value.chatId:null})});b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getThreadIdByDeduplicationKey",!1)))(function(a,b){d("WALogger").DEV(h(),b);return d("MAWDbThreadTxns").getThreadByDeduplicationKey(a,b).then(function(a){return a.success?{chatId:a.value.chatId,jid:a.value.jid}:null})});g.getThreadIdByJid=a;g.getThreadIdByDeduplicationKey=b}),98);
__d("MAWHandleEchoXMARestore",["EchoMessage","LSDataTraceCheckPoint.re","MAWBridge","MAWBridgeXMA","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMediaTxns","MAWDexieTable","MAWGating","MAWGetThreadsInfoApi","MAWIndexedDb","MAWTraceUtils","MAWTransactionMode","WAArmadilloXMA.pb","WALogger","WAMediaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xma adding to the indexeddb failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media is not found for the provided objectId ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJid field is not present in the restoredMsg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaLayoutType field is not present in the echo doc"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaGatingType field is not present in the echo doc"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaTargetType field is not present in the echo doc"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaDefaultCTA field is not present in the echo doc"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] xmaData is missing in the echo doc"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] dbXMA is null"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaId is null for xma"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaData or attachmentObjectId in mediaData is missing in the echo doc"]);r=function(){return a};return a}a=function(a,b,e){b==null?void 0:b.addPoint("xma_restore_start");if(d("MAWGating").isXMABackupEnabled()){d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebXmaRestoreStarted,[],!1);return s(a,e).then(function(a){b==null?void 0:b.addPoint("xma_restore_end",{"int":{xma:a}});d("MAWTraceUtils").recordCheckpointForTrace(e,c("LSDataTraceCheckPoint.re").labyrinthWebXmaRestoreEnded,[],!1);return d("MAWDexieTable").dexieResolve()})}b==null?void 0:b.addPoint("xma_restore_end",{"int":{xma:0}});return d("MAWDexieTable").dexieResolve()};function s(a,b){var e=a.restoredMsgs,f=0;return d("MAWDexieTable").dexieAll(e.map(function(e){return e.then(function(e){e=e.restoredMessages;return d("MAWDexieTable").dexieAll(e.map(function(e){var g=e.dbMsg.externalId,h=a.echoMsgMap.get(g);if(h!=null&&h.contentType===d("EchoMessage").EchoMessageContentType.XMA){if(h.mediaData==null||h.mediaData.attachmentObjectId==null){d("WALogger").ERROR(r());return null}return v(h.mediaData.attachmentObjectId).then(function(a){if(a==null){d("WALogger").ERROR(q());d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebXmaRestoreMediaidNull,[],!1);return d("MAWDexieTable").dexieResolve()}var g=t(e,h,a);if(g==null){d("WALogger").ERROR(p());d("MAWTraceUtils").recordCheckpointForTrace(b,c("LSDataTraceCheckPoint.re").labyrinthWebXmaRestoreDbxmaNull,[],!1);return d("MAWDexieTable").dexieResolve()}f+=1;return x(g).then(function(b){if(b!=null)return w(a).then(function(a){if(a!=null)return d("MAWGetThreadsInfoApi").getThreadIdByJid(b.threadJid).then(function(c){c!=null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(c,a,b)}]})})})})})}return d("MAWDexieTable").dexieResolve}))})})).then(function(a){return d("MAWDexieTable").dexieResolve(f)})}function t(a,b,c){var e,f;if(b.xmaData==null){d("WALogger").ERROR(o());return null}var g;if(b.xmaData.xmaDefaultCTA!=null){var h;g=u((h=b.xmaData)==null?void 0:h.xmaDefaultCTA)}else d("WALogger").WARN(n());if(((h=b.xmaData)==null?void 0:h.xmaTargetType)!=null)h=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(b.xmaData.xmaTargetType);else{d("WALogger").ERROR(m());return null}var i;((e=b.xmaData)==null?void 0:e.xmaGatingType)!=null?i=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(b.xmaData.xmaGatingType):d("WALogger").WARN(l());var p;((e=b.xmaData)==null?void 0:e.xmaLayoutType)!=null?p=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(b.xmaData.xmaLayoutType):d("WALogger").WARN(k());if(a.dbMsg.threadJid!=null)e=a.dbMsg.threadJid;else{d("WALogger").ERROR(j());return null}return{author:a.dbMsg.author,ctas:[],defaultCTA:g,defaultPreviewMediaId:c,externalId:a.dbMsg.externalId,headerTitle:b==null?void 0:(f=b.xmaData)==null?void 0:f.xmaHeaderTitle,isTombstoned:b==null?void 0:(f=b.xmaData)==null?void 0:f.xmaIsTombstoned,maxSubtitleNumOfLines:b==null?void 0:(f=b.xmaData)==null?void 0:f.xmaMaxSubtitleNumLines,maxTitleNumOfLines:b==null?void 0:(f=b.xmaData)==null?void 0:f.xmaMaxTitleNumLines,msgId:a.dbMsg.msgId,overlayIconGlyph:i,overlayTitle:b==null?void 0:(f=b.xmaData)==null?void 0:f.xmaHeaderSubtitle,previewMediaIds:[c],subtitleText:b==null?void 0:(a=b.xmaData)==null?void 0:a.xmaSubtitleText,targetExpiringAtSec:d("WATimeUtils").castToUnixTime(Number((f=b.xmaData)==null?void 0:f.xmaTargetExpiry)/1e3),targetId:b==null?void 0:(c=b.xmaData)==null?void 0:c.xmaTargetId,targetType:h,targetUsername:b==null?void 0:(a=b.xmaData)==null?void 0:a.xmaTargetUsername,threadJid:e,titleText:(f=b.xmaData)==null?void 0:f.xmaTitleText,xmaLayoutType:p}}function u(a){return{actionUrl:a,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:a}}var v=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,d("WAMediaUtils").stringToDeliveryObjectId(b)).then(function(a){if(a!=null||(a==null?void 0:a.mediaId)!=null)return a.mediaId;else{d("WALogger").ERROR(i(),b);return null}})}),w=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b)}),x=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READWRITE})(function(a,b){return a.xma.add(b).then(function(b){b==null&&d("WALogger").ERROR(h());return a.xma.get(b)})});g.writeXMAToXMAStore=a}),98);
__d("MAWHandlePointRestoredMsg",["MAWEncryptedBackupCacheManager","MAWIndexedDb","MAWTransactionMode","MAWUploadMessagesBackup","Promise","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Completed handling of point restored message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Started handling of point restored message"]);i=function(){return a};return a}function a(a,b){return a.messages.where("quoteExternalId").anyOf(b).toArray()}var j=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(a);function c(a){d("WALogger").LOG(i());a=a.restoredMsgs;var c=[],e=new Map();return b("Promise").all(a.map(function(a){return a.then(function(a){var f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:f=a.restoredMessages;g=[];f.filter(function(a){return d("MAWEncryptedBackupCacheManager").checkForMsgEntryInReuploadCache(a.dbMsg.thread,a.dbMsg.externalId)}).forEach(function(a){c.push(a.dbMsg),g.push(a.dbMsg.externalId)});i.next=5;return b("regeneratorRuntime").awrap(j(g));case 5:h=i.sent,h.forEach(function(a){var b=a.quoteExternalId;b!=null&&e.set(b,a)});case 7:case"end":return i.stop()}},null,this)})})).then(function(a){return c.length>0?d("MAWUploadMessagesBackup").uploadUniqueMessage(c,e).then(function(a){c.forEach(function(a){d("MAWEncryptedBackupCacheManager").removeMsgEntryFromReuploadCache(a.thread,a.externalId)})}):b("Promise").resolve()}).then(function(a){d("WALogger").LOG(h())})}g.uploadPointRestoredMessageIfRequired=c}),98);
__d("MAWRestoreMsgsTxns",["ArmadilloDataTraceType.bs","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypes","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWFolderTypes","MAWGating","MAWIndexedDb","MAWLocalizationType","MAWThreadSnippetBuildTxns","MAWTimeUtils.bs","MAWUpdateQuotedMsgTxns","MAWWriteMsgTxns","WADualSendMsgUtils","WAJids","WALogger","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] snippet data is empty for newest msg during eb restore"]);h=function(){return a};return a}var i=new Set();function j(a){return a!=null&&a.type===d("WAMsgType").MSG_TYPE.ADMIN&&(a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a.msgContent.adminType===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE)}function k(a,b){return a.messages.where(["thread","sortOrderMs"]).equals([b,0]).limit(1).first()}function l(a,b,c){return d("MAWDbMsgTxns").maybeGetMsg(a,c).then(function(c){if(c!=null)return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,c.ts],[b.chatId,b.newestMsgTs],!1,!0).limit(1).first();else return d("MAWDexieTable").dexieResolve()})}function a(a,b,c){return d("MAWDbMsgTxns").maybeGetMsg(a,c).then(function(c){if(c!=null)return a.messages.where(["thread","sortOrderMs"]).between([b.chatId,c.sortOrderMs],[b.chatId,9999999999999],!1,!0).limit(1).first();else return d("MAWDexieTable").dexieResolve()})}function m(a,b,c){return k(a,b).then(function(a){if(a!=null&&j(a)){d("MAWIndexedDb").afterTransaction({tag:"UpdateMinMessage",value:d("MAWBridgeTypes").createBridgeUpdateMinMessage(a.msgId,d("MAWDbMsg").getSortOrderWithFallback(a),b,c)});return d("MAWDexieTable").dexieResolve(a)}return d("MAWDexieTable").dexieResolve()})}function n(a,b,c,e){return l(a,b,c.msgId).then(function(a){a==null?d("MAWIndexedDb").afterTransaction({tag:"DeleteMessageRangesV2",value:d("MAWBridgeTypes").createBridgeDeleteMessageRangesV2(c.msgId,d("MAWDbMsg").getSortOrderWithFallback(c),b.chatId)}):d("MAWIndexedDb").afterTransaction({tag:"UpdateMinMessage",value:d("MAWBridgeTypes").createBridgeUpdateMinMessage(a.msgId,d("MAWDbMsg").getSortOrderWithFallback(a),b.chatId,e)});return d("MAWDexieTable").dexieResolve(a)})}function o(a,b,c){var e;!c&&i.has(b.chatId)?(i["delete"](b.chatId),e=m(a,b.chatId,c)):e=d("MAWDexieTable").dexieResolve();return e.then(function(e){return b.oldestMsg==null?d("MAWDexieTable").dexieResolve({insertedAdminMsg:e,maybeOldestMsg:null}):d("MAWDbMsgTxns").maybeGetMsg(a,b.oldestMsg).then(function(d){if(c&&d!=null&&j(d)&&!i.has(b.chatId)){i.add(b.chatId);return n(a,b,d,c).then(function(a){return{insertedAdminMsg:e,maybeOldestMsg:a}})}return{insertedAdminMsg:e,maybeOldestMsg:d}})})}function p(a,b){return b.oldestMsg==null?d("MAWDexieTable").dexieResolve({maybeOldestAdminMsg:null,maybeOldestMsgNewImpl:null}):d("MAWDbMsgTxns").maybeGetMsg(a,b.oldestMsg).then(function(c){return c!=null&&j(c)?l(a,b,c.msgId).then(function(a){return{maybeOldestAdminMsg:c,maybeOldestMsgNewImpl:a}}):{maybeOldestAdminMsg:null,maybeOldestMsgNewImpl:c}})}function b(a,b,c,e,f,g){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(a,c.newestMsg),o(a,c,f),p(a,c)]).then(function(i){var k=i[0],l=i[1];i=i[2];var m=l.maybeOldestMsg,n=i.maybeOldestAdminMsg;l=i.maybeOldestMsgNewImpl;var o=d("MAWTimeUtils.bs").getMillisTime(c.newestMsgTs)||d("WATimeUtils").castToMillisTime(0),p=c.newestMsg,s=m==null?void 0:m.msgId,t=d("WATimeUtils").castUnixTimeToMillisTime((i=m==null?void 0:m.ts)!=null?i:d("WATimeUtils").castToUnixTime(0));s=l==null?void 0:l.msgId;t=d("WATimeUtils").castUnixTimeToMillisTime((i=l==null?void 0:l.ts)!=null?i:d("WATimeUtils").castToUnixTime(0));var u=c.lastReadMsg,v=d("MAWTimeUtils.bs").getMillisTime(c.lastReadMsgTs),w=!1,x=(l=c.nextInChatMsgId)!=null?l:1;i=b.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,b.externalId,c.chatId,b.author).then(function(f){if(f==null){var g=d("WATimeUtils").castUnixTimeToMillisTime(b.ts);o=g>o?g:o;var h=d("MAWDbMsg").craftMsgId(c.chatId,x);x+=1;(s==null||!e&&g<t)&&(w=!0,s=n!=null&&d("WATimeUtils").castUnixTimeToMillisTime(n.ts)<g?n.msgId:h,t=n!=null&&d("WATimeUtils").castUnixTimeToMillisTime(n.ts)<g?d("WATimeUtils").castUnixTimeToMillisTime(n.ts):g);(o===g||j(k))&&(p=h);b.author===d("WAJids").AUTHOR_ME&&(v==null||g>v)&&(u=h,v=g);var i=babelHelpers["extends"]({},b,{msgId:h,sortOrderMs:d("MAWDbMsg").getSortOrderWithFallback(b)});return a.messages.add(i).then(function(a){a=babelHelpers["extends"]({},i,{rowId:a});a.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&a.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&(d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(a,c.jid,d("ArmadilloDataTraceType.bs").armadilloMessageSend)}),d("WADualSendMsgUtils").isDualSendJid(c.jid)||d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(a)}));return a}).then(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,c.chatId,b).then(function(a){return{dbMsg:b,replies:a,threadJId:c.jid,wasMsgAlreadyInStore:!1}})})}else return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,c.chatId,f).then(function(a){return{dbMsg:f,replies:a,threadJId:c.jid,wasMsgAlreadyInStore:!0}})})});return d("MAWDexieTable").dexieAll(i).then(function(b){var i=b.reduce(function(a,b){b.wasMsgAlreadyInStore||a.push(b);return a},[]);i.forEach(function(a){var b=a.dbMsg.externalId;if(d("MAWEncryptedBackupCacheManager").peekRestoreCache(b)){var c,e=d("MAWEncryptedBackupCacheManager").getRestoredCache(b);(((c=e)==null?void 0:c.contentSubtype)!=null||((c=e)==null?void 0:c.contentType)!=null)&&(e=babelHelpers["extends"]({},e,{dbMsg:a.dbMsg}),d("MAWEncryptedBackupCacheManager").addMsgEntryToRestoredCache(b,e))}});if(e)return q(a,i).then(function(a){return{chatId:c.chatId,restoredMessages:i}});if(d("MAWGating").isDyiEnabled()){var j=b.length,k=a.dyiBatch.count();k.then(function(d){if(d>0){d={isThread:!1,numMessages:j,oldestTs:0,threadId:c.jid};if(b.length>0){var e=b.reduce(function(a,b){if(b.dbMsg.sortOrderMs!=null&&a.dbMsg.sortOrderMs!=null&&b.dbMsg.sortOrderMs<a.dbMsg.sortOrderMs)return b;else return a},b[0]);e.dbMsg.sortOrderMs!=null&&(d.oldestTs=e.dbMsg.sortOrderMs)}a.dyiBatch.add(d)}})["finally"](function(){})}if(i.length===0)return{chatId:c.chatId,restoredMessages:b};var l=i[i.length-1],t=babelHelpers["extends"]({},c,{lastReadMsg:u,lastReadMsgTs:v,newestMsg:p,newestMsgTs:o,nextInChatMsgId:x,oldestMsg:s,threadOrder:d("MAWDbThread").craftThreadOrder(o,c.jid)}),y=d("MAWWriteMsgTxns").shouldThreadBeUnarchived(t);y&&(t=babelHelpers["extends"]({},t,{archived:!1,folder:d("MAWFolderTypes").FOLDER_ID.INBOX}));return d("MAWDexieTable").dexieAll([a.threads.put(t),p==null||l.dbMsg.msgId===p?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,l.dbMsg,c):d("MAWDexieTable").dexieResolve()]).then(function(b){var e=b[0],j=b[1];return a.threads.get({jid:c.jid}).then(function(b){if(p==null||l.dbMsg.msgId===p)if(j!=null){b=j.snippetParams;var k=j.snippetSenderContactId,q=j.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadBumped",value:d("MAWBridgeTypes").createBridgeBumpedThread(e,d("WADualSendMsgUtils").isDualSendJid(c.jid),o,v,q,b,k)})}else d("WALogger").ERROR(h());if(c.oldestMsg==null||w){var s=i.map(function(a){return a.dbMsg}).reverse();if(g!=null){q=d("MAWDbMsg").toMsgId(g);if(q!=null)return a.messages.get({msgId:q}).then(function(b){if(b!=null){b=b.sortOrderMs;b=a.messages.where(["thread","sortOrderMs"]).between([c.chatId,s[0].sortOrderMs],[c.chatId,b],!1,!1).count();return b.then(function(a){a===0&&(r(s,n,c),d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypes").createBridgeMsgsLoadedInfo(e,s,c.oldestMsg===null,f,d("WADualSendMsgUtils").isDualSendJid(c.jid))}));y&&d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({cannotReplyReason:t.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,isDualSend:d("WADualSendMsgUtils").isDualSendJid(t.jid),threadId:t.chatId})});return{chatId:c.chatId,restoredMessages:i}})}return{chatId:c.chatId,restoredMessages:i}})}d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypes").createBridgeMsgsLoadedInfo(e,s,m===null,f,d("WADualSendMsgUtils").isDualSendJid(c.jid))});y&&d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({cannotReplyReason:t.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,isDualSend:d("WADualSendMsgUtils").isDualSendJid(t.jid),threadId:t.chatId})})}return{chatId:c.chatId,restoredMessages:i}})})})})}function q(a,b){var c=[];for(var d=0;d<b.length;d++)c.push(b[d].dbMsg.rowId);return a.messages.bulkDelete(c)}function r(a,b,c){var e=b==null?void 0:b.sortOrderMs,f=a[a.length-1],g=f.sortOrderMs;b!=null&&f!=null&&e!=null&&g!=null&&e<g&&(a.push(b),d("MAWIndexedDb").afterTransaction({tag:"DeleteMessageRangesV2",value:d("MAWBridgeTypes").createBridgeDeleteMessageRangesV2(b.msgId,d("MAWDbMsg").getSortOrderWithFallback(b),c.chatId)}))}g.isE2eeOrCutoverAdminMsg=j;g.getNextMsgBasedOnSortOrderMs=a;g.restoreMsgsForThread=b}),98);
__d("MAWDbReaction",["MAWAckLevel","MAWDbMsg","MAWGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbMsg").craftMsgId(a,b)}function b(a,b,c){var e=d("MAWGlobals").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function c(a){return a}function e(a,b,c,e,f,g,h,i,j,k,l,m){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}g.craftReactionId=a;g.findMatchingReaction=b;g.reactionIdToMsgId=c;g.formatReaction=e}),98);
__d("MAWDbReactionUtils",["MAWBridgeTypes","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.author,e=a.reaction,f=a.reactToMsgId;a=a.ts;if(f==null)return;c=e==null?{tag:"DeleteReaction",value:d("MAWBridgeTypes").createBridgeDeleteReaction({author:c,chatId:b,reactToMsgId:f})}:{tag:"UpsertReaction",value:d("MAWBridgeTypes").createBridgeUpsertReaction({author:c,chatId:b,reaction:e||"",reactToMsgId:f,ts:a})};d("MAWIndexedDb").afterTransaction(c)}g.dispatchReaction=a}),98);
__d("MAWWriteReactionTxns",["MAWAuthor","MAWDbReaction","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDexieTable","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){var e=b.author,f=b.externalId,g=b.groupingKey,h=b.reaction,i=b.reactToAuthor,j=b.reactToExternalId,k=b.ts;return d("MAWDexieTable").dexieAll([a.threads.where("jid").equals(c).first(),a.messages.where("externalId").equals(j).toArray(),a.reactions.where("reactToExternalId").equals(j).toArray()]).then(function(b){var c=b[0],l=b[1];b=b[2];if(!c)return"missing_thread";var m=d("MAWDbReaction").craftReactionId(c.chatId,c.nextInChatMsgId);b=d("MAWDbReaction").findMatchingReaction(b,c.jid,e);var n=d("MAWAuthor").getAuthorUserJid(i);l=l.find(function(a){return a.thread===c.chatId&&n===d("MAWAuthor").getAuthorUserJid(a.author)});var o=d("MAWDbReaction").formatReaction(c.jid,f,m,j,h,g,i,l==null?void 0:l.msgId,k,(m=e)!=null?m:d("WAJids").AUTHOR_ME,b==null?void 0:b.rowId);l=(b==null?void 0:b.reactionId)!=null?a.receipts.where("msgId").equals(b==null?void 0:b.reactionId)["delete"]():d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbReactionsTxns").putReaction(a,c,o),l]).then(function(a){a=a[0];a=babelHelpers["extends"]({},o,{rowId:a});d("MAWDbReactionUtils").dispatchReaction(a,c.chatId);return a})})}function a(a,b,e,f,g){return h(a,b,e).then(function(a){if(typeof a==="string")return d("WAResultOrError").makeError({type:a});var b=a.author;if(d("WAJids").isAuthorSystem(b))throw c("err")("This cannot happen because a reaction cannot have SYSTEM author");return d("WAResultOrError").makeResult({icdcResults:g,plaintextHashs:null,protocolMsgId:{author:b,chat:e,externalId:a.externalId},reactToExternalId:a.reactToExternalId,unknownDevice:f,unknownGroup:!1})})}g.writeReaction=h;g.writeIncomingReactionMsg=a}),98);
__d("MAWHandleEchoMsgsRestoreApi",["$InternalEnum","EchoBackupCompareUtils","EchoMessage","EchoMessageMediaFieldUtils","LSDataTraceCheckPoint.re","MAWAckLevel","MAWAuthor","MAWBridgeEventTransmitter","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMsg","MAWDbThreadTxns","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWGating","MAWGlobals","MAWHandleEchoMediaMsgsRestore","MAWHandleEchoReceiptsRestore","MAWHandleEchoXMARestore","MAWHandlePointRestoredMsg","MAWIndexedDb","MAWJids","MAWQplProxy","MAWRepliesRestoreUtils","MAWRestoreMsgsTxns","MAWTraceUtils","MAWTransactionMode","MAWWriteReactionTxns","Promise","WAJids","WALogger","WAMsgType","WAResultOrError","WAStanzaUtils","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] timestamp field should not be null as it is required for attachment download retry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] from field is missing from media message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Media data is null for the message: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo message is missing from the map: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No messages to be restored for thread: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Ignore duplicate restore request of an existing message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message ID must not be null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode the message"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] threadJidPrimaryId "," missing from index db"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction fields in backup data uneven in length"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions empty author"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot have reactions for system author"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echo document is absent for a restored msg"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reactToAuthor field is null"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction external id missing"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] reaction string is not a single character"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] failed to persist reaction during restore"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Message content is empty for the message: ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Consider enabling XMA Backup QE as the message is of type XMA with externalId: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Consider enabling attachment restore QE as the message is of type Media: ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Author info is missing from msg: ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message type: ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message content type: ",""]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread has unsupported message content type: ",""]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Restore failed. Faced error while restore ",""]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Low level api handleEchoMsgsRestore completed restore of the threads. isPointRestore: ",""]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Low level api handleEchoMsgsRestore initiated restore of "," threads. isPointRestore: "," startSortKey: ",""]);H=function(){return a};return a}var I=b("$InternalEnum")({INITIAL_RESTORE:"initial_restore",POINT_RESTORE:"point_restore",PAGINATED_RESTORE:"paginated_restore"});a=function(a,e,f,g,h){var i;i=a.size>=1?(i=(i=a.values().next().value)==null?void 0:i.length)!=null?i:0:0;var j=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521486220,"827"),{"int":{messages:i},string:{restore_type:e?I.POINT_RESTORE:h!=null?I.PAGINATED_RESTORE:I.INITIAL_RESTORE}});d("MAWTraceUtils").recordCheckpointForTrace(g,c("LSDataTraceCheckPoint.re").labyrinthWebEchoMessageRestoreBegin,[],!1);d("WALogger").LOG(H(),a.size,e,h);var k=a.size===1?a.keys().next().value:null;i=aa(a,e,j,f);return i.then(function(a){return b("Promise").all([X(a,j),Y(a,j),d("MAWHandleEchoReceiptsRestore").writeReceiptsToReceiptsStore(a,j),ea(k,a)]).then(function(f){d("MAWEncryptedBackupCacheManager").setRestoredCacheStatusAsDone(Array.from(a.echoMsgMap.keys()));return b("Promise").all([d("MAWRepliesRestoreUtils").updateQuoteDataForReplyMessages(a,j),d("MAWHandlePointRestoredMsg").uploadPointRestoredMessageIfRequired(a),d("MAWHandleEchoXMARestore").writeXMAToXMAStore(a,j,g)]).then(function(){var f={messageIds:[],pendingRestoreSortKeys:[]};a.quotesToBeRestored.forEach(function(a){f.messageIds.push(a.messageId),f.pendingRestoreSortKeys.push(a.sortOrderMs)});d("WALogger").LOG(G(),e);j.endSuccess();d("MAWTraceUtils").recordCheckpointForTrace(g,c("LSDataTraceCheckPoint.re").labyrinthRestoreMessagesSuccess,[],!1);d("MAWTraceUtils").recordCheckpointForTrace(g,c("LSDataTraceCheckPoint.re").flowEndAndFlush,[],!0);return b("Promise").resolve(d("WAResultOrError").makeResult(f))})})})["catch"](function(a){d("WALogger").ERROR(F(),a);j.endFail("restore_failed");return d("WAResultOrError").makeError(a)})};function J(a){var b=a.contentType;switch(b){case d("EchoMessage").EchoMessageContentType.TEXT:return d("WAMsgType").MSG_TYPE.TEXT;case d("EchoMessage").EchoMessageContentType.MEDIA:if(d("MAWGating").isAttachmentBackupEnabled())return K(a);break;case d("EchoMessage").EchoMessageContentType.PLACEHOLDER:if(a.contentSubtype===d("EchoMessage").EchoMessageContentSubtype.UNSEND)return d("WAMsgType").MSG_TYPE.REVOKED;d("WALogger").ERROR(E(),d("EchoMessage").EchoMessageContentType.getName(b));break;case d("EchoMessage").EchoMessageContentType.XMA:return d("WAMsgType").MSG_TYPE.XMA;default:d("WALogger").ERROR(D(),d("EchoMessage").EchoMessageContentType.getName(b))}return null}function K(a){a=a.mediaData;if(a!=null){switch(a.attachmentType){case d("EchoMessageMediaFieldUtils").AttachmentType.IMAGE:return d("WAMsgType").MSG_TYPE.IMAGE;case d("EchoMessageMediaFieldUtils").AttachmentType.STICKER:return d("WAMsgType").MSG_TYPE.STICKER;case d("EchoMessageMediaFieldUtils").AttachmentType.VIDEO:return d("WAMsgType").MSG_TYPE.VIDEO;case d("EchoMessageMediaFieldUtils").AttachmentType.GIF:return d("WAMsgType").MSG_TYPE.GIF;case d("EchoMessageMediaFieldUtils").AttachmentType.PTT:return d("WAMsgType").MSG_TYPE.PTT;case d("EchoMessageMediaFieldUtils").AttachmentType.XMA:return d("WAMsgType").MSG_TYPE.XMA}d("WALogger").ERROR(C(),d("EchoMessageMediaFieldUtils").AttachmentType.getName(a.attachmentType))}return null}function L(a,b,c,e){var f=a.from;if(f==null){d("WALogger").ERROR(B(),e);return null}var g=J(a);if(g==null)return null;switch(g){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.REVOKED:return Q(a,b,c,f,g,e);case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.STICKER:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.PTT:if(d("MAWGating").isAttachmentBackupEnabled())return M(a,b,c,f,g,e);else d("WALogger").WARN(A(),e);break;case d("WAMsgType").MSG_TYPE.XMA:if(d("MAWGating").isXMABackupEnabled())return O(a,b,c,f,g,e);else d("WALogger").WARN(z(),e);break}return null}function M(a,b,c,d,e,f){a=R(a,b,c,d,e,f);return N(e,a)}function N(a,b){switch(a){case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.GIF});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.PTT})}}function O(a,b,c,e,f,g){b=R(a,b,c,e,f,g);return a.xmaData!=null&&a.xmaData.xmaTargetType!=null?babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(a.xmaData.xmaTargetType)}):null}function P(a){if(a==null)return void 0;else switch(a){case d("EchoMessage").MessageTextSize.SMALL:return 1;case d("EchoMessage").MessageTextSize.MEDIUM:return 2;case d("EchoMessage").MessageTextSize.LARGE:return 3;default:return void 0}}function Q(a,b,c,e,f,g){var h=a.text;if(a.isTombstoned!=null&&a.isTombstoned)return null;else if(h==null){d("WALogger").ERROR(y(),g);return null}b=R(a,b,c,e,f,g);if(f===d("WAMsgType").MSG_TYPE.REVOKED){h!=null&&(b.msgContent={content:h});a.revokeSentTimestampMs!=null&&(b.originalTs=d("WATimeUtils").castToUnixTime(a.revokeSentTimestampMs));return babelHelpers["extends"]({},b,{revokedExternalId:d("WAStanzaUtils").toStanzaId("0"),type:d("WAMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:a.revokeUnsentTimestampMS!=null?d("WATimeUtils").castToUnixTime(a.revokeUnsentTimestampMS):b.ts})}else return babelHelpers["extends"]({},b,{msgContent:{content:h},specialTextSize:P(a.textSize),type:d("WAMsgType").MSG_TYPE.TEXT})}function R(a,b,c,e,f,g){e=$(e);e={ack:e===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:e,externalId:g,isForwarded:a.isForwarded,sortOrderMs:a.sortOrderMs,thread:b,threadJid:c,ts:d("WATimeUtils").castToUnixTime(a.displayTimestampMs/1e3),type:f};a.authoritativeTimestampMs!=null&&(e.serverTs=d("WATimeUtils").castToUnixTime(a.authoritativeTimestampMs/1e3));if(a.quoteData!=null){g=d("MAWRepliesRestoreUtils").getQuoteDataFromEchoMessage(a);g!=null&&(e.quote=g,e.quoteExternalId=g.content.externalId)}return e}var S=d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b,c){return d("MAWWriteReactionTxns").writeReaction(a,b,c).then(function(a){a==="missing_thread"&&d("WALogger").ERROR(x())})});function T(a,b,c){if((a==null?void 0:a.length)===0){d("WALogger").ERROR(w());return!1}if(b==null){d("WALogger").ERROR(v());return!1}if(c==null){d("WALogger").ERROR(u());return!1}return!0}function U(a,b){a=a.get(b.dbMsg.externalId);if(a==null){d("WALogger").ERROR(t());return!1}if(d("WAJids").isAuthorSystem(b.dbMsg.author)){d("WALogger").ERROR(s());return!1}if(d("MAWAuthor").getAuthorUserJid(b.dbMsg.author)==null){d("WALogger").ERROR(r());return!1}return!0}function V(a,b,c){return(a||[]).map(function(a,e){if(c==null||b==null||(c==null?void 0:c.length)<=e||(b==null?void 0:b.length)<=e){d("WALogger").WARN(q());return[]}return[a,b[e],c[e]]})}function W(a,b){var c=d("MAWAuthor").getAuthorUserJid(a.dbMsg.author);if(b==null||c==null)return[];var e=b.reactionAuthoritativeTimestampMs;e=e===void 0?[]:e;var f=b.reactionXOfflineThreadingIds;f=f===void 0?[]:f;b=b.reactions;return V(b,f,e).filter(function(b){var c=b[0];b=b[1];return b!=null&&T(c.displayName,b.displayName,d("MAWAuthor").getAuthorUserJid(a.dbMsg.author))}).map(function(b){var e=b[0],f=b[1];b=b[2];var g=e.displayName;e=$(e);return{ack:e===d("WAJids").AUTHOR_ME?d("MAWAckLevel").ACK.sent:d("MAWAckLevel").ACK.received,author:e,externalId:d("WAStanzaUtils").toStanzaId(f.displayName||""),groupingKey:g,reaction:g,reactToAuthor:c,reactToExternalId:a.dbMsg.externalId,reactToMsgId:a.dbMsg.msgId,threadJid:a.threadJId,ts:d("WATimeUtils").castToUnixTime(Number(b.displayName)/1e3)}})}function X(a,c){c==null?void 0:c.addPoint("reactions_restore_start");var d=a.echoMsgMap;a=a.restoredMsgs;var e=0;return b("Promise").all(a.map(function(a){return a.then(function(a){a=a.restoredMessages;a=a.filter(function(a){var b=d.get(a.dbMsg.externalId);return U(d,a)&&b!=null&&da(b)});return b("Promise").all(a.flatMap(function(a){var b=d.get(a.dbMsg.externalId);return W(a,b).filter(Boolean).map(function(b){e+=1;return S(b,a.threadJId)})}))})})).then(function(a){c==null?void 0:c.addPoint("reactions_restore_end",{"int":{reactions:e}})})}var Y=function(a,c){c==null?void 0:c.addPoint("media_restore_start");if(d("MAWGating").isAttachmentBackupEnabled())return ca(a).then(function(a){c==null?void 0:c.addPoint("media_restore_end",{"int":{media:a}});return b("Promise").resolve()});c==null?void 0:c.addPoint("media_restore_end",{"int":{media:0}});return b("Promise").resolve()},aa=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READWRITE,dyiBatch:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE})(function(a,b,c,e,f){e==null?void 0:e.addPoint("message_restore_start");var g=d("MAWDexieTable").dexieAll(Array.from(b.keys(),function(b){return d("MAWDbThreadTxns").getThreadByJidPrimaryId(a,b).then(function(a){return babelHelpers["extends"]({},a,{threadJidPrimaryId:b})})})).then(function(a){var b=new Map();a.forEach(function(a){a.success?b.set(a.threadJidPrimaryId,a.value):d("WALogger").ERROR(p(),a.threadJidPrimaryId)});return b}),h=[],i=new Set(),j=new Map(),k=[],q;g=g.then(function(e){e.forEach(function(e,f){q=e.jid;var g=b.get(f),p=new Map();if(g!=null&&g.length>0){g.forEach(function(a){a=d("EchoMessage").decodeEchoMessage(a);if(a==null){d("WALogger").ERROR(o());return}var b=a.xOfflineThreadingId;if(b==null){d("WALogger").ERROR(n());return}if(i.has(b)){d("WALogger").WARN(m());return}i.add(b);b=d("WAStanzaUtils").toStanzaId(b);var c=L(a,e.chatId,e.jid,b);c!=null&&(d("MAWEncryptedBackupCacheManager").addMsgEntryToRestoredCache(b,d("EchoBackupCompareUtils").buildEchoDocCacheValue(a)),p.set(b,c),j.set(b,a));a=a==null?void 0:a.quoteData;if(a!=null){var f=d("WAStanzaUtils").toStanzaId(a.quoteMessageId);if(f!=null&&!p.has(f))k.push({messageId:a.quoteMessageId,sortOrderMs:a.quoteSortOrderInMs.toString()});else if(c!=null){a=d("MAWRepliesRestoreUtils").addQuoteDataToReplyMessage(c,p.get(f));p.set(b,a)}}});g=Array.from(p.values());g.sort(function(a,b){return((a=a.sortOrderMs)!=null?a:0)-((a=b.sortOrderMs)!=null?a:0)});var r=!0;if(g.length<=2)r=!1;else{var s=g[0];g=g.slice(1,g.length+1);ba(s,k,j)}c&&(r=!0);h.push({dbThread:e,hasMoreBefore:r,messagesToAdd:g})}else d("MAWGating").isDyiEnabled()&&q!=null&&a.dyiBatch.count().then(function(b){b>0&&a.dyiBatch.add({isThread:!1,numMessages:1,oldestTs:0,threadId:q})})["finally"](function(){}),d("WALogger").WARN(l(),f)});return h.map(function(b){var e=b.dbThread,g=b.hasMoreBefore;b=b.messagesToAdd;return d("MAWRestoreMsgsTxns").restoreMsgsForThread(a,b,e,c,g,f)})});return g.then(function(a){a=a.map(function(a){return a});e==null?void 0:e.addPoint("message_restore_end");return{echoMsgMap:j,quotesToBeRestored:k,restoredMsgs:a}})});function ba(a,b,c){var e=a.externalId;d("MAWEncryptedBackupCacheManager").removeFromRestoredCache(e);if(a.quoteExternalId!=null){var f=-1;for(var g=0;g<b.length;g++)if(b[g].messageId===a.quoteExternalId){f=g;break}f!==-1&&b.splice(f,1)}g=c.get(e);a=g==null?void 0:g.quoteData;a!=null&&b.push({messageId:a.quoteMessageId,sortOrderMs:a.quoteSortOrderInMs.toString()});c["delete"](e)}function ca(a){var c=a.restoredMsgs,e=0;return b("Promise").all(c.map(function(c){return c.then(function(c){c=c.restoredMessages;return b("Promise").all(c.map(function(c){var f=c.dbMsg.externalId;f=a.echoMsgMap.get(f);if(f!=null&&(f.contentType===d("EchoMessage").EchoMessageContentType.MEDIA||f.contentType===d("EchoMessage").EchoMessageContentType.XMA)){c=Z(c,a.echoMsgMap);if(c){e+=1;return d("MAWHandleEchoMediaMsgsRestore").downloadMediaAndWriteToMediaStore(c,f.contentType===d("EchoMessage").EchoMessageContentType.XMA)}}return b("Promise").resolve()}))})})).then(function(a){return b("Promise").resolve(e)})}function Z(a,b){var c=a.dbMsg;b=b.get(c.externalId);if(b==null){d("WALogger").ERROR(k(),c.externalId);return}var e=b.mediaData;if(e==null){d("WALogger").ERROR(j(),b.messageId);return}else{var f,g=b.from;if(g==null)d("WALogger").ERROR(i());else{g=d("MAWJids").toUserJid(g.localKey);g===d("MAWGlobals").getMyUserJid()?f=d("WAJids").AUTHOR_ME:f=g;g=c.externalId;c=c.msgId;a=a.threadJId;b=b.sortOrderMs;if(b==null){d("WALogger").ERROR(h());return}return{author:f,externalId:g,mediaData:e,messageTimestamp:b,msgId:c,threadJId:a}}}}function da(a){return a.reactions!=null&&a.reactions.length!==0&&a.reactionXOfflineThreadingIds!=null&&a.reactionXOfflineThreadingIds.length!==0&&a.reactionAuthoritativeTimestampMs!=null&&a.reactionAuthoritativeTimestampMs.length!==0}function $(a){a=d("MAWJids").toUserJid(a.localKey);return a===d("MAWGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:a}function ea(a,c){a!=null&&c.quotesToBeRestored.map(function(b){d("MAWBridgeEventTransmitter").issuePointQuery(b.messageId,a,b.sortOrderMs)});return b("Promise").resolve()}g.MAWRestoreType=I;g.handleEchoMsgsRestore=a;g.getUnstoredDbMessageFromEchoMessage=L;g.getMediaMetadataForDownload=Z;g.resolveAuthorFromEchoAddress=$}),98);
__d("MAWGetMsgQuoteTxn",["MAWDbMsgTxns","MAWDexieTable","WAJids","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a==null||a===d("WAJids").AUTHOR_SYSTEM?null:d("WAJids").authorAsUserJid(a)};function i(a,b,c){var e=b.quote;b=(e==null?void 0:e.content)||{};var f=b.author;b=b.externalId;if(f==null)return d("MAWDexieTable").dexieResolve(null);f=d("WAJids").isAuthorMe(f)?d("WAJids").AUTHOR_ME:h(f);if(e==null||f==null)return d("MAWDexieTable").dexieResolve(null);f={author:f,chat:c,externalId:b};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f).then(function(b){if(b==null||!d("WAMsgType").isQuotedMsgType(b.type))return{quote:e,quoteExternalId:e.content.externalId};var a=b.author,c=b.externalId,f=b.mediaId,g=b.msgContent,h=b.msgId,i=b.specialTextSize,j=b.ts,k=b.type,l=b.xmaMessageType;a={author:a,externalId:c,mediaId:f,msgContent:g,msgId:h,specialTextSize:i,ts:j,type:k,xmaMessageType:l};b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(a=babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL}));return{quote:babelHelpers["extends"]({},e,{content:a}),quoteExternalId:b.externalId}})}function a(a,b,c){return i(a,b,c).then(function(a){return babelHelpers["extends"]({},b,{quote:a==null?void 0:a.quote,quoteExternalId:a==null?void 0:a.quoteExternalId})})}g.getMsgQuoteInfo=i;g.enhanceMsgWithQuoteInfo=a}),98);
__d("MAWRepliesRestoreUtils",["FBLogger","MAWBridgeMsg","MAWDexieTable","MAWGetMsgQuoteTxn","MAWHandleEchoMsgsRestoreApi","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWTransactionMode","MAWUpdateQuotedMsgTxns","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Quote data is missing for message: ",""]);h=function(){return a};return a}function a(a,b){if(b==null||!d("WAMsgType").isQuotedMsgType(b.type))return a;else{b={author:b.author,externalId:b.externalId,ts:b.ts,type:b.type};b={content:b,remoteJid:null};return babelHelpers["extends"]({},a,{quote:b})}}function b(a){if(a.quoteData!=null&&a.quoteData.quoteMessageId!=null&&a.quoteData.quoteMessageSender!=null){var b;b={author:d("MAWHandleEchoMsgsRestoreApi").resolveAuthorFromEchoAddress(a.quoteData.quoteMessageSender),externalId:(b=a.quoteData)==null?void 0:b.quoteMessageId,ts:a.displayTimestampMs,type:d("WAMsgType").MSG_TYPE.TEXT};return{content:b,remoteJid:null}}else d("WALogger").ERROR(h(),a.messageId);return null}e=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b,c){c==null?void 0:c.addPoint("replies_restore_start");b=b.restoredMsgs;return d("MAWDexieTable").dexieAll(b.map(function(b){return b.then(function(b){b=b.restoredMessages;return d("MAWDexieTable").dexieAll(b.flatMap(function(b){return d("MAWUpdateQuotedMsgTxns").associateQuotedMessage(a,b.dbMsg.thread,b.dbMsg).then(function(a){var c=[];b.dbMsg.quoteExternalId!=null&&c.push(b.dbMsg);a!=null&&c.push.apply(c,a);return c})})).then(function(b){b=b.reduce(function(a,b){return b.length>0?a.concat(b):a},[]);return i(a,b)})})})).then(function(a){a=a.reduce(function(a,b){return a+b},0);c==null?void 0:c.addPoint("replies_restore_end",{"int":{replies:a}});return a})});function i(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var e=j(b);if(b.threadJid!=null)return d("MAWGetMsgQuoteTxn").enhanceMsgWithQuoteInfo(a,e,b.threadJid).then(function(a){return babelHelpers["extends"]({},a,{msgId:b.msgId,originalTs:b.originalTs,rowId:b.rowId,thread:b.thread,threadJid:b.threadJid,unsendMsgContentDeleteTs:b.unsendMsgContentDeleteTs})});else c("FBLogger")("labyrinth_web","thread_id_absent").mustfix("Reply restore: threadId cannot be null for a restored msg")})).then(function(a){return a.filter(Boolean).filter(function(a){return a.quote!=null})}).then(function(b){return a.messages.bulkPut(b).then(function(c){return b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a)})})})}).then(function(a){return(a=b==null?void 0:b.length)!=null?a:0})})}function j(a){a.msgId;a.originalTs;a.rowId;a.thread;a.threadJid;a.unsendMsgContentDeleteTs;a=babelHelpers.objectWithoutPropertiesLoose(a,["msgId","originalTs","rowId","thread","threadJid","unsendMsgContentDeleteTs"]);return a}g.addQuoteDataToReplyMessage=a;g.getQuoteDataFromEchoMessage=b;g.updateQuoteDataForReplyMessages=e;g.enhanceAndPersistReplyMessagesWithQuoteData=i}),98);
__d("MAWRotateCAT",["MAWBridge","MAWDbMetaTxns","MAWDeviceRegistrationTypes","MAWGlobals","WAArrayBufferUtils","WALogger","WAPromiseRetryLoop","WARetryUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Rotate CAT finished, ending rotate CAT promise retry loop"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to rotate CAT"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["CAT Finished Rotating"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting rotate CAT Task Bridge event"]);l=function(){return a};return a}function m(){d("WALogger").LOG(l());return d("MAWBridge").getBridge().sendAndReceive("event","rotateCryptoAuthToken",{}).then(function(a){return d("MAWDbMetaTxns").saveCAT(a)}).then(function(a){d("MAWGlobals").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.encrypted_serialized_cat));d("WALogger").LOG(k());return!0})["catch"](function(a){d("WALogger").WARN(j(),a);return!1})}function a(){var a=0,c=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:function(c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a===d("MAWDeviceRegistrationTypes").MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES&&d("WALogger").ERROR(i());f.next=3;return b("regeneratorRuntime").awrap(m());case 3:e=f.sent,e&&(d("WALogger").LOG(h()),c()),a++;case 6:case"end":return f.stop()}},null,this)},name:"rotateCAT",timer:d("WARetryUtils").FIBONACCI_BACKOFF});c.start();return c.promise()}g.rotateCAT=m;g.tryRotateCAT=a}),98);
__d("MAWSetEphemeralSettingsFromFrontendApi",["MAWBridge","MAWBridgeTypes","MAWEphemeralSettingsTxns","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b,c,e){return d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange(a,b,c,e)});a=function(a){var b=a.ephemeralExpirationInSec,c=a.threadId,e=d("WATimeUtils").unixTime();return h(c,b,e).then(function(a){if(a.success){var f={ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:e};d("MAWGlobals").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(c,{ephemeralSetting:f,isForSyncResponse:!1}));d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"EphemeralSettingsUpdatedForUI",value:d("MAWBridgeTypes").createBridgeEphemeralSettingsUpdatedForUI(c,f)}]})}return a})};g.setEphemeralSettingsFromFrontend=a}),98);
__d("MAWMessageRequestUtils",["MAWDbContact","MAWFolderTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING||a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER;return b==null?c:c||(a.folder===null||a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)&&(b.relationship===d("MAWDbContact").REVERSED_ONE_WAY_CONTACT||b.relationship===d("MAWDbContact").NON_CONTACT)}function b(a){return a.relationship===d("MAWDbContact").TWO_WAY_CONTACT}g.isMessageRequestOrSpamThread=a;g.isTwoWayContact=b}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAdminMsgTxnsUtils","MAWDbContactsTxns","MAWDbMsg","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWJids","MAWLocalizationType","MAWLocalizationUtils","MAWMessageRequestUtils","MAWWriteMsgTxns","WAJids","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";b={add:"add",remove:"remove",update:"update"};function h(a,b){switch(a){case"add":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE;case"remove":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE;case"update":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE}}function a(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,e).then(function(e){if(!e.success)throw c("err")("missing thread when device info changes");var g=e.value;if(g.newestMsg==null)return d("MAWDexieTable").dexieResolve();var i=d("WAJids").interpretAsGroupJid(g.jid)!=null;return d("MAWDbContactsTxns").getContact(a,b).then(function(c){if(c!=null&&!d("MAWMessageRequestUtils").isTwoWayContact(c)&&!i)return d("MAWDexieTable").dexieResolve();var e=d("MAWAdminMsgTxnsUtils").isUnknownName(c==null?void 0:c.nameForSearch);c=b===d("MAWGlobals").getMyUserJid();var j=h(f,c);c=c?[]:[d("MAWJids").userIdFromJid(b)];var k=d("MAWDbMsg").craftMsgId(g.chatId,g.nextInChatMsgId);c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:c,adminType:j,version:1},g.chatId,g.jid,k,d("WATimeUtils").castMillisTimeToUnixTime(g.newestMsgTs));return d("MAWWriteMsgTxns").writeMsg(a,c,g).then(function(){e&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b])})})})}g.DeviceChange=b;g.writeUserDeviceAdminMsg=a}),98);
__d("MAWDbDeviceChangeAlerts",[],(function(a,b,c,d,e,f){"use strict";b="add";c="keyChange";d="remove";function a(a){return a}f.ADD=b;f.KEY_CHANGE=c;f.REMOVE=d;f.unsafeCoerceToDeviceChangeAlertsID=a}),66);
__d("MAWSmartSenderKeyRotationTxns",["MAWDbIdentityTxns","MAWDbPersonalSenderKeyStatusTxns","MAWDexieTable","MAWGating"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){if(!d("MAWGating").isSmartSenderKeyRotationEnabled())return d("MAWDbPersonalSenderKeyStatusTxns").setRotateSenderKeyToTrue(a,b);c=c.map(function(a){return a.user});return d("MAWDexieTable").dexieAll([a.personalSenderKeyStatuses.get(b),d("MAWDbIdentityTxns").getIdentitiesForMultipleUsers(a,c)]).then(function(b){var c=b[0];b=b[1];var d=[];b.forEach(function(a,b){a.forEach(function(a){return d.push(a.deviceJid)})});return h(a,c,d)})}function b(a,b,c){return!d("MAWGating").isSmartSenderKeyRotationEnabled()?d("MAWDbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrue(a,b):a.personalSenderKeyStatuses.bulkGet(b).then(function(b){return i(a,b,c)})}function h(a,b,c){return i(a,[b],c).then(function(a){return a[0]})}function i(a,b,c){var e=[],f=[];b.forEach(function(a){if(a==null||a.rotateSenderKey){f.push(a);return}var b=babelHelpers["extends"]({},a);b.rotateSenderKey=b.rotateSenderKey||c.some(function(a){return b.hasSenderKey.has(a)});c.forEach(function(a){b.hasSenderKey["delete"](a)});f.push(b);b.rotateSenderKey&&e.push(b)});return d("MAWDbPersonalSenderKeyStatusTxns").bulkUpdateSenderKeyStatus(a,e).then(function(){return d("MAWDexieTable").dexieResolve(f)})}g.bulkPerformSmartSenderKeyRotationForParticipantRemoval=a;g.bulkSmartSenderKeyRotateForRemovedDevices=b;g.smartRotateSenderKey=h;g.bulkSmartRotateSenderKey=i}),98);
__d("MAWUpdateDevicesForUserApi",["MAWAdminWriteUserDeviceMsgTxn","MAWBridge","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppMeta","MAWDbDeviceChangeAlerts","MAWDbGetAlertsWithDeviceJidTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbIdentityTxns","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWQplProxy","MAWSmartSenderKeyRotationTxns","MAWTransactionMode","WABase64","WACryptoUtils","WAJids","WALogger","WAOdsEnums","WATimeUtils","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got identity mismatch ",", ",""]);h=function(){return a};return a}function i(a,b){return{deviceJid:a.id,firstSeenTs:d("WATimeUtils").unixTime(),identity:a.identity,userJid:b}}function j(a,b){return a.identity.where("userJid").equals(b).toArray().then(function(a){return a.map(function(a){return a.deviceJid})})}function k(a,b,e,f,g,j,k){j===void 0&&(j="no-context");var l=e.map(function(a){return a.id}),m=b===((g=g)!=null?g:d("MAWGlobals").getMyUserJid()),n=c("gkx")("792")&&m&&k!=null;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getAllThreadsForUser(a,b).then(function(a){return a.filter(function(a){return!a.archived})}),a.identity.bulkGet(l),a.existingUsers.get(b),d("MAWDbMsgTypeVersionTxns").getAppMetaValue(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert),d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a)]).then(function(g){var l=g[0],o=g[1],p=g[2],q=g[3];g=g[4];var r=g.allowSecurityAlertForContact,s=g.allowSecurityAlertForSelf,t=new Set(f),u=[],v=[],w=0,x=0,y=0,z=!0;c("gkx")("792")?(m||r===!1)&&(z=!1):d("MAWGating").isAdminMsgOptEnabled()?z=m?s:r:!m&&(q==null?void 0:q.value.allowSecurityAlert)!==!0&&(z=!1);g=d("MAWDexieTable").dexieAll(o.map(function(f,g){g=e[g];var o=g.id,q=g.identity,r=g.model;g=g.platform;var A=i({id:o,identity:q},b);if(f==null){v.push(A);w++;return d("MAWDexieTable").dexieAll([n&&r!=null&&g!=null&&k!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").ADD,deviceJid:o,identity:q,isArchived:!s,model:r,platform:g,ts:k}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(p!=null&&z?l.map(function(c){return d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b,c.chatId,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add)}):[])).then(function(){(n&&r!=null||p!=null&&z)&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:m?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})})}t["delete"](A.deviceJid);if(!d("WACryptoUtils").serializedPubKeysEqual(f.identity,A.identity)){v.push(A);u.push(f.deviceJid);x++;if(d("MAWGlobals").getMyDeviceJid()===A.deviceJid){var B=d("WAJids").extractDeviceId(A.deviceJid);B=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25311782,"728"),{"int":{deviceId:B},string:{context:j}});B.endSuccess()}if(m){B=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25311490,"729"));B.endSuccess()}return d("MAWDexieTable").dexieAll([n&&r!=null&&g!=null&&k!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:o,identity:q,isArchived:!s,model:r,platform:g,ts:k}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(z?l.map(function(e){d("MAWGlobals").getMyDeviceJid()===A.deviceJid&&c("gkx")("8498")&&c("gkx")("3827")&&d("WALogger").ERROR(h(),d("WABase64").encodeB64(f.identity),d("WABase64").encodeB64(A.identity));return d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b,e.chatId,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update)}):[])).then(function(){(n&&r!=null||z)&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:m?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})})}y++})).then(function(){return d("MAWDexieTable").dexieAll(t.forEach(function(c){return d("MAWDexieTable").dexieAll([n&&k!=null?d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,c).then(function(b){d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").REMOVE,deviceJid:c,identity:b.identity,isArchived:!s,loggedOut:!0,model:b.model,platform:b.platform,ts:k})}).then(function(){return d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c)}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(z?l.map(function(c){return d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b,c.chatId,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove)}):[]))})).then(function(){t.size>0&&(n||z)&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:m?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})})});r=l.map(function(a){return d("WAJids").interpretAsGroupJid(a.jid)}).filter(Boolean);return d("MAWDexieTable").dexieAll([a.existingUsers.put({id:b}),g,r.length>0&&t.size>0?d("MAWSmartSenderKeyRotationTxns").bulkSmartSenderKeyRotateForRemovedDevices(a,r,Array.from(t)):d("MAWDexieTable").dexieResolve(),d("MAWDbIdentityTxns").bulkPutIdentities(a,v)]).then(function(){var a=Array.from(t),b=u.concat(a);return{identitiesToDelete:a,newIdentitiesCount:w,sessionsToDelete:b,untouchedIdentitiesCount:y,updatedIdentitiesCount:x}})})}function l(a,b,c){return d("MAWDexieTable").dexieAll([a.identity.bulkDelete(b),a.session.bulkDelete(c)]).then(function(){return{identityRecordsDeletedCount:b.length,sessionRecordsDeletedCount:c.length}})}function m(a,b,c,d,e,f){e===void 0&&(e="no-context");return j(a,b).then(function(g){return k(a,b,c,g,d,e,f).then(function(b){var c=b.identitiesToDelete;b=b.sessionsToDelete;return l(a,c,b).then(function(){})})})}a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY,chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,deviceChangeAlerts:d("MAWTransactionMode").READWRITE,existingUsers:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,session:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},c("qpl")._(25310731,"7104"))(function(a,b,c,d,e){e===void 0&&(e="no-context");return m(a,b,c.map(function(a){return babelHelpers["extends"]({},a)}),d,e)});g.getAllDeviceJidsForUser=j;g.updateDeviceIdentities=k;g.deleteSignalInfoForDevices=l;g.updateDevicesForUserTxn=m;g.updateDevicesForUser=a}),98);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("fflate-0.6.10",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a,b="";try{a={}.Worker}catch(a){}g["default"]=a?function(c,d,e,f,g){var h=!1,i=new a(c+b,{eval:!0}).on("error",function(a){return g(a,null)}).on("message",function(a){return g(null,a)}).on("exit",function(a){a&&!h&&g(new Error("exited with code "+a),null)});i.postMessage(e,f);i.terminate=function(){h=!0;return a.prototype.terminate.call(i)};return i}:function(a,b,c,d,e){setImmediate(function(){return e(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});a=function(){};return{terminate:a,postMessage:a}}}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){var a=k(),b=Uint8Array,c=Uint16Array,d=Uint32Array,e=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),f=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(a,b){var e=new c(31);for(var f=0;f<31;++f)e[f]=b+=1<<a[f-1];a=new d(e[30]);for(var f=1;f<30;++f)for(b=e[f];b<e[f+1];++b)a[b]=b-e[f]<<5|f;return[e,a]},i=h(e,2),j=i[0],m=i[1];j[28]=258,m[258]=28;i=h(f,0);var n=i[0],o=i[1],p=new c(32768);for(h=0;h<32768;++h){i=(h&43690)>>>1|(h&21845)<<1;i=(i&52428)>>>2|(i&13107)<<2;i=(i&61680)>>>4|(i&3855)<<4;p[h]=((i&65280)>>>8|(i&255)<<8)>>>1}var q=function(a,b,d){var e=a.length,f=0,g=new c(b);for(;f<e;++f)++g[a[f]-1];var h=new c(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(d){g=new c(1<<b);d=15-b;for(f=0;f<e;++f)if(a[f]){var i=f<<4|a[f],j=b-a[f],k=h[a[f]-1]++<<j;for(j=k|(1<<j)-1;k<=j;++k)g[p[k]>>>d]=i}}else{g=new c(e);for(f=0;f<e;++f)a[f]&&(g[f]=p[h[a[f]-1]++]>>>15-a[f])}return g},r=new b(288);for(h=0;h<144;++h)r[h]=8;for(h=144;h<256;++h)r[h]=9;for(h=256;h<280;++h)r[h]=7;for(h=280;h<288;++h)r[h]=8;var s=new b(32);for(h=0;h<32;++h)s[h]=5;var t=q(r,9,0),u=q(r,9,1),v=q(s,5,0),w=q(s,5,1),x=function(a){var b=a[0];for(var c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},y=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(b&7)&c},z=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(b&7)},aa=function(a){return(a/8|0)+(a&7&&1)},A=function(a,e,f){(e==null||e<0)&&(e=0);(f==null||f>a.length)&&(f=a.length);var g=new(a instanceof c?c:a instanceof d?d:b)(f-e);g.set(a.subarray(e,f));return g},B=function(a,c,d){var h=a.length;if(!h||d&&!d.l&&h<5)return c||new b(0);var i=!c||d,k=!d||d.i;d||(d={});c||(c=new b(h*3));var l=function(a){var d=c.length;if(a>d){d=new b(Math.max(d*2,a));d.set(c);c=d}},m=d.f||0,o=d.p||0,p=d.b||0,r=d.l,s=d.d,t=d.m,v=d.n,B=h*8;do{if(!r){d.f=m=y(a,o,1);var C=y(a,o+1,3);o+=3;if(!C){var D=aa(o)+4,E=a[D-4]|a[D-3]<<8,F=D+E;if(F>h){if(k)throw"unexpected EOF";break}i&&l(p+E);c.set(a.subarray(D,F),p);d.b=p+=E,d.p=o=F*8;continue}else if(C==1)r=u,s=w,t=9,v=5;else if(C==2){E=y(a,o,31)+257;F=y(a,o+10,15)+4;C=E+y(a,o+5,31)+1;o+=14;var G=new b(C),H=new b(19);for(var I=0;I<F;++I)H[g[I]]=y(a,o+I*3,7);o+=F*3;F=x(H);var J=(1<<F)-1;H=q(H,F,1);for(var I=0;I<C;){F=H[y(a,o,J)];o+=F&15;var D=F>>>4;if(D<16)G[I++]=D;else{F=0;var K=0;D==16?(K=3+y(a,o,3),o+=2,F=G[I-1]):D==17?(K=3+y(a,o,7),o+=3):D==18&&(K=11+y(a,o,127),o+=7);while(K--)G[I++]=F}}D=G.subarray(0,E);K=G.subarray(E);t=x(D);v=x(K);r=q(D,t,1);s=q(K,v,1)}else throw"invalid block type";if(o>B){if(k)throw"unexpected EOF";break}}i&&l(p+131072);J=(1<<t)-1;H=(1<<v)-1;C=o;for(;;C=o){F=r[z(a,o)&J];G=F>>>4;o+=F&15;if(o>B){if(k)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(G<256)c[p++]=G;else if(G==256){C=o,r=null;break}else{E=G-254;if(G>264){var I=G-257;D=e[I];E=y(a,o,(1<<D)-1)+j[I];o+=D}F=s[z(a,o)&H];G=F>>>4;if(!F)throw"invalid distance";o+=F&15;K=n[G];if(G>3){D=f[G];K+=z(a,o)&(1<<D)-1,o+=D}if(o>B){if(k)throw"unexpected EOF";break}i&&l(p+131072);F=p+E;for(;p<F;p+=4)c[p]=c[p-K],c[p+1]=c[p+1-K],c[p+2]=c[p+2-K],c[p+3]=c[p+3-K];p=F}}d.l=r,d.p=C,d.b=p;r&&(m=1,d.m=t,d.d=s,d.n=v)}while(!m);return p==c.length?c:A(c,0,p)},C=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8},D=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8;a[b+2]|=c>>>16},E=function(a,d){var e=[];for(var f=0;f<a.length;++f)a[f]&&e.push({s:f,f:a[f]});a=e.length;var g=e.slice();if(!a)return[L,0];if(a==1){var h=new b(e[0].s+1);h[e[0].s]=1;return[h,1]}e.sort(function(a,b){return a.f-b.f});e.push({s:-1,f:25001});h=e[0];var i=e[1],j=0,k=1,l=2;e[0]={s:-1,f:h.f+i.f,l:h,r:i};while(k!=a-1)h=e[e[j].f<e[l].f?j++:l++],i=e[j!=k&&e[j].f<e[l].f?j++:l++],e[k++]={s:-1,f:h.f+i.f,l:h,r:i};h=g[0].s;for(var f=1;f<a;++f)g[f].s>h&&(h=g[f].s);var m=new c(h+1);i=F(e[k-1],m,0);if(i>d){var f=0;j=0;l=i-d;h=1<<l;g.sort(function(a,b){return m[b.s]-m[a.s]||a.f-b.f});for(;f<a;++f){e=g[f].s;if(m[e]>d)j+=h-(1<<i-m[e]),m[e]=d;else break}j>>>=l;while(j>0){k=g[f].s;m[k]<d?j-=1<<d-m[k]++-1:++f}for(;f>=0&&j;--f){e=g[f].s;m[e]==d&&(--m[e],++j)}i=d}return[new b(m),i]},F=function(a,b,c){return a.s==-1?Math.max(F(a.l,b,c+1),F(a.r,b,c+1)):b[a.s]=c},G=function(a){var b=a.length;while(b&&!a[--b]);var d=new c(++b),e=0,f=a[0],g=1,h=function(a){d[e++]=a};for(var i=1;i<=b;++i)if(a[i]==f&&i!=b)++g;else{if(!f&&g>2){for(;g>138;g-=138)h(32754);g>2&&(h(g>10?g-11<<5|28690:g-3<<5|12305),g=0)}else if(g>3){h(f),--g;for(;g>6;g-=6)h(8304);g>2&&(h(g-3<<5|8208),g=0)}while(g--)h(f);g=1;f=a[i]}return[d.subarray(0,e),b]},H=function(a,b){var c=0;for(var d=0;d<b.length;++d)c+=a[d]*b[d];return c},I=function(a,b,c){var d=c.length;b=aa(b+2);a[b]=d&255;a[b+1]=d>>>8;a[b+2]=a[b]^255;a[b+3]=a[b+1]^255;for(var e=0;e<d;++e)a[b+e+4]=c[e];return(b+4+d)*8},J=function(a,b,d,h,i,j,k,l,m,n,o){C(b,o++,d);++i[256];d=E(i,15);var p=d[0];d=d[1];var u=E(j,15),w=u[0];u=u[1];var x=G(p),y=x[0];x=x[1];var z=G(w),aa=z[0];z=z[1];var A=new c(19);for(var B=0;B<y.length;++B)A[y[B]&31]++;for(var B=0;B<aa.length;++B)A[aa[B]&31]++;var F=E(A,7),J=F[0];F=F[1];var K=19;for(;K>4&&!J[g[K-1]];--K);var L=n+5<<3,M=H(i,r)+H(j,s)+k;i=H(i,p)+H(j,w)+k+14+3*K+H(A,J)+(2*A[16]+3*A[17]+7*A[18]);if(L<=M&&L<=i)return I(b,o,a.subarray(m,m+n));C(b,o,1+(i<M)),o+=2;if(i<M){j=q(p,d,0),k=p,A=q(w,u,0),L=w;a=q(J,F,0);C(b,o,x-257);C(b,o+5,z-1);C(b,o+10,K-4);o+=14;for(var B=0;B<K;++B)C(b,o+3*B,J[g[B]]);o+=3*K;m=[y,aa];for(n=0;n<2;++n){i=m[n];for(var B=0;B<i.length;++B){M=i[B]&31;C(b,o,a[M]),o+=J[M];M>15&&(C(b,o,i[B]>>>5&127),o+=i[B]>>>12)}}}else j=t,k=r,A=v,L=s;for(var B=0;B<l;++B)if(h[B]>255){M=h[B]>>>18&31;D(b,o,j[M+257]),o+=k[M+257];M>7&&(C(b,o,h[B]>>>23&31),o+=e[M]);d=h[B]&31;D(b,o,A[d]),o+=L[d];d>3&&(D(b,o,h[B]>>>5&8191),o+=f[d])}else D(b,o,j[h[B]]),o+=k[h[B]];D(b,o,j[256]);return o+k[256]},K=new d([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),L=new b(0),M=function(a,g,h,i,j,k){var l=a.length,n=new b(i+l+5*(1+Math.ceil(l/7e3))+j),p=n.subarray(i,n.length-j),q=0;if(!g||l<8)for(var r=0;r<=l;r+=65535){var s=r+65535;s<l?q=I(p,q,a.subarray(r,s)):(p[r]=k,q=I(p,q,a.subarray(r,l)))}else{s=K[g-1];g=s>>>13;s=s&8191;var t=(1<<h)-1,u=new c(32768),v=new c(t+1),w=Math.ceil(h/3),x=2*w;h=function(b){return(a[b]^a[b+1]<<w^a[b+2]<<x)&t};var y=new d(25e3),z=new c(288),B=new c(32),C=0,D=0,r=0,E=0,F=0,G=0;for(;r<l;++r){var H=h(r),M=r&32767,N=v[H];u[M]=N;v[H]=M;if(F<=r){var O=l-r;if((C>7e3||E>24576)&&O>423){q=J(a,p,0,y,z,B,D,E,G,r-G,q);E=C=D=0,G=r;for(var P=0;P<286;++P)z[P]=0;for(var P=0;P<30;++P)B[P]=0}var Q=2,R=0,ba=s,S=M-N&32767;if(O>2&&H==h(r-S)){H=Math.min(g,O)-1;var ca=Math.min(32767,r);O=Math.min(258,O);while(S<=ca&&--ba&&M!=N){if(a[r+Q]==a[r+Q-S]){var T=0;for(;T<O&&a[r+T]==a[r+T-S];++T);if(T>Q){Q=T,R=S;if(T>H)break;T=Math.min(S,T-2);var da=0;for(var P=0;P<T;++P){var U=r-S+P+32768&32767,V=u[U];V=U-V+32768&32767;V>da&&(da=V,N=U)}}}M=N,N=u[M];S+=M-N+32768&32767}}if(R){y[E++]=268435456|m[Q]<<18|o[R];V=m[Q]&31;U=o[R]&31;D+=e[V]+f[U];++z[257+V];++B[U];F=r+Q;++C}else y[E++]=a[r],++z[a[r]]}}q=J(a,p,k,y,z,B,D,E,G,r-G,q);!k&&q&7&&(q=I(p,q+1,L))}return A(n,0,i+aa(q)+j)},N=function(){var a=new Int32Array(256);for(var b=0;b<256;++b){var c=b,d=9;while(--d)c=(c&1&&-306674912)^c>>>1;a[b]=c}return a}(),O=function(){var a=-1;return{p:function(b){var c=a;for(var d=0;d<b.length;++d)c=N[c&255^b[d]]^c>>>8;a=c},d:function(){return~a}}},P=function(){var a=1,b=0;return{p:function(c){var d=a,e=b,f=c.length;for(var g=0;g!=f;){var h=Math.min(g+2655,f);for(;g<h;++g)e+=d+=c[g];d=(d&65535)+15*(d>>16),e=(e&65535)+15*(e>>16)}a=d,b=e},d:function(){a%=65521,b%=65521;return(a&255)<<24|a>>>8<<16|(b&255)<<8|b>>>8}}},Q=function(a,b,c,d,e){return M(a,b.level==null?6:b.level,b.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+b.mem,c,d,!e)},R=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},ba=function(b,c,a){var d=b();b=b.toString();b=b.slice(b.indexOf("[")+1,b.lastIndexOf("]")).replace(/ /g,"").split(",");for(var e=0;e<d.length;++e){var f=d[e],g=b[e];if(typeof f=="function"){c+=";"+g+"=";var h=f.toString();if(f.prototype)if(h.indexOf("[native code]")!=-1){var i=h.indexOf(" ",8)+1;c+=h.slice(i,h.indexOf("(",i))}else{c+=h;for(i in f.prototype)c+=";"+g+".prototype."+i+"="+f.prototype[i].toString()}else c+=h}else a[g]=f}return[c,a]},S=[],ca=function(a){var e=[];for(var f in a)(a[f]instanceof b||a[f]instanceof c||a[f]instanceof d)&&e.push((a[f]=new a[f].constructor(a[f])).buffer);return e},T=function(c,d,e,f){var b;if(!S[e]){var g="",h={},i=c.length-1;for(var j=0;j<i;++j)b=ba(c[j],g,h),g=b[0],h=b[1];S[e]=ba(c[i],g,h)}b=R({},S[e][1]);return a["default"](S[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+d.toString()+"}",e,b,ca(b),f)},da=function(){return[b,c,d,e,f,g,j,n,u,w,p,q,x,y,z,aa,A,B,za,ha,ia]},U=function(){return[b,c,d,e,f,g,m,o,t,r,v,s,p,K,L,q,C,D,E,F,G,H,I,J,aa,A,M,Q,wa,ha]},V=function(){return[ma,pa,Z,O,N]},ea=function(){return[na,oa]},fa=function(){return[qa,Z,P]},ga=function(){return[ra]},ha=function(a){return postMessage(a,[a.buffer])},ia=function(a){return a&&a.size&&new b(a.size)},ja=function(a,b,c,d,e,f){var g=T(c,d,e,function(b,a){g.terminate(),f(b,a)});g.postMessage([a,b],b.consume?[a.buffer]:[]);return function(){g.terminate()}},W=function(a){a.ondata=function(a,b){return postMessage([a,b],[a.buffer])};return function(b){return a.push(b.data[0],b.data[1])}},ka=function(a,b,c,d,e){var f,g=T(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c);b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])};b.terminate=function(){g.terminate()}},X=function(a,b){return a[b]|a[b+1]<<8},Y=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},la=function(a,b){return Y(a,b)+Y(a,b+4)*4294967296},Z=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},ma=function(a,b){var c=b.filename;a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:b.level==9?2:0,a[9]=3;b.mtime!=0&&Z(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3));if(c){a[3]=8;for(b=0;b<=c.length;++b)a[b+10]=c.charCodeAt(b)}},na=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var b=a[3],c=10;b&4&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(b&2)},oa=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},pa=function(a){return 10+(a.filename&&a.filename.length+1||0)},qa=function(a,b){b=b.level;b=b==0?0:b<6?1:b==9?3:2;a[0]=120,a[1]=b<<6|(b?32-2*b:1)},ra=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sa(a,b){!b&&typeof a=="function"&&(b=a,a={});this.ondata=b;return a}var ta=function(){function a(a,b){!b&&typeof a=="function"&&(b=a,a={}),this.ondata=b,this.o=a||{}}a.prototype.p=function(a,b){this.ondata(Q(a,this.o,0,0,!b),b)};a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b;this.p(a,b||!1)};return a}();l.Deflate=ta;var ua=function(){function a(a,b){ka([U,function(){return[W,ta]}],this,sa.call(this,a,b),function(a){a=new ta(a.data);onmessage=W(a)},6)}return a}();l.AsyncDeflate=ua;function va(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U],function(a){return ha(wa(a.data[0],a.data[1]))},0,c)}l.deflate=va;function wa(a,b){return Q(a,b||{},0,0)}l.deflateSync=wa;var $=function(){function a(a){this.s={},this.p=new b(0),this.ondata=a}a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var c=this.p.length,d=new b(c+a.length);d.set(this.p),d.set(a,c),this.p=d};a.prototype.c=function(a){this.d=this.s.i=a||!1;a=this.s.b;var b=B(this.p,this.o,this.s);this.ondata(A(b,a,this.s.b),this.d);this.o=A(b,this.s.b-32768),this.s.b=this.o.length;this.p=A(this.p,this.s.p/8|0),this.s.p&=7};a.prototype.push=function(a,b){this.e(a),this.c(b)};return a}();l.Inflate=$;var xa=function(){function a(a){this.ondata=a,ka([da,function(){return[W,$]}],this,0,function(){var a=new $();onmessage=W(a)},7)}return a}();l.AsyncInflate=xa;function ya(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da],function(a){return ha(za(a.data[0],ia(a.data[1])))},1,c)}l.inflate=ya;function za(a,b){return B(a,b)}l.inflateSync=za;var Aa=function(){function a(a,b){this.c=O(),this.l=0,this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);this.l+=a.length;a=Q(a,this.o,this.v&&pa(this.o),b&&8,!b);this.v&&(ma(a,this.o),this.v=0);b&&(Z(a,a.length-8,this.c.d()),Z(a,a.length-4,this.l));this.ondata(a,b)};return a}();l.Gzip=Aa;l.Compress=Aa;i=function(){function a(a,b){ka([U,V,function(){return[W,ta,Aa]}],this,sa.call(this,a,b),function(a){a=new Aa(a.data);onmessage=W(a)},8)}return a}();l.AsyncGzip=i;l.AsyncCompress=i;function Ba(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,V,function(){return[Ca]}],function(a){return ha(Ca(a.data[0],a.data[1]))},2,c)}l.gzip=Ba;l.compress=Ba;function Ca(a,b){b||(b={});var c=O(),d=a.length;c.p(a);a=Q(a,b,pa(b),8);var e=a.length;return ma(a,b),Z(a,e-8,c.d()),Z(a,e-4,d),a}l.gzipSync=Ca;l.compressSync=Ca;var Da=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){a=this.p.length>3?na(this.p):4;if(a>=this.p.length&&!b)return;this.p=this.p.subarray(a),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$.prototype.c.call(this,b)};return a}();l.Gunzip=Da;var Ea=function(){function a(a){this.ondata=a,ka([da,ea,function(){return[W,$,Da]}],this,0,function(){var a=new Da();onmessage=W(a)},9)}return a}();l.AsyncGunzip=Ea;function Fa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ea,function(){return[Ga]}],function(a){return ha(Ga(a.data[0]))},3,c)}l.gunzip=Fa;function Ga(a,c){return B(a.subarray(na(a),-8),c||new b(oa(a)))}l.gunzipSync=Ga;var Ha=function(){function a(a,b){this.c=P(),this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);a=Q(a,this.o,this.v&&2,b&&4,!b);this.v&&(qa(a,this.o),this.v=0);b&&Z(a,a.length-4,this.c.d());this.ondata(a,b)};return a}();l.Zlib=Ha;h=function(){function a(a,b){ka([U,fa,function(){return[W,ta,Ha]}],this,sa.call(this,a,b),function(a){a=new Ha(a.data);onmessage=W(a)},10)}return a}();l.AsyncZlib=h;function Ia(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,fa,function(){return[Ja]}],function(a){return ha(Ja(a.data[0],a.data[1]))},4,c)}l.zlib=Ia;function Ja(a,b){b||(b={});var c=P();c.p(a);a=Q(a,b,2,4);return qa(a,b),Z(a,a.length-4,c.d()),a}l.zlibSync=Ja;var Ka=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$.prototype.c.call(this,b)};return a}();l.Unzlib=Ka;var La=function(){function a(a){this.ondata=a,ka([da,ga,function(){return[W,$,Ka]}],this,0,function(){var a=new Ka();onmessage=W(a)},11)}return a}();l.AsyncUnzlib=La;function Ma(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ga,function(){return[Na]}],function(a){return ha(Na(a.data[0],ia(a.data[1])))},5,c)}l.unzlib=Ma;function Na(a,b){return B((ra(a),a.subarray(2,-4)),b)}l.unzlibSync=Na;var Oa=function(){function a(a){this.G=Da,this.I=$,this.Z=Ka,this.ondata=a}a.prototype.push=function(a,c){if(!this.ondata)throw"no stream handler";if(!this.s){if(this.p&&this.p.length){var d=new b(this.p.length+a.length);d.set(this.p),d.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var e=this;d=function(){e.ondata.apply(e,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(d):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(d):new this.Z(d);this.s.push(this.p,c);this.p=null}}else this.s.push(a,c)};return a}();l.Decompress=Oa;i=function(){function a(a){this.G=Ea,this.I=xa,this.Z=La,this.ondata=a}a.prototype.push=function(a,b){Oa.prototype.push.call(this,a,b)};return a}();l.AsyncDecompress=i;function Pa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Fa(a,b,c):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ya(a,b,c):Ma(a,b,c)}l.decompress=Pa;function Qa(a,b){return a[0]==31&&a[1]==139&&a[2]==8?Ga(a,b):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?za(a,b):Na(a,b)}l.decompressSync=Qa;var Ra=function(a,c,d,e){for(var f in a){var g=a[f],h=c+f;g instanceof b?d[h]=[g,e]:Array.isArray(g)?d[h]=[g[0],R(e,g[1])]:Ra(g,h+"/",d,e)}},Sa=typeof TextEncoder!="undefined"&&new TextEncoder(),Ta=typeof TextDecoder!="undefined"&&new TextDecoder(),Ua=0;try{Ta.decode(L,{stream:!0}),Ua=1}catch(a){}var Va=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,A(a,c-1)];!e?b+=String.fromCharCode(d):e==3?(d=((d&15)<<18|(a[c++]&63)<<12|(a[c++]&63)<<6|a[c++]&63)-65536,b+=String.fromCharCode(55296|d>>10,56320|d&1023)):e&1?b+=String.fromCharCode((d&31)<<6|a[c++]&63):b+=String.fromCharCode((d&15)<<12|(a[c++]&63)<<6|a[c++]&63)}};Ba=function(){function a(a){this.ondata=a,Ua?this.t=new TextDecoder():this.p=L}a.prototype.push=function(a,c){if(!this.ondata)throw"no callback";c=!!c;if(this.t){this.ondata(this.t.decode(a,{stream:!0}),c);if(c){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var d=new b(this.p.length+a.length);d.set(this.p);d.set(a,this.p.length);a=Va(d);d=a[0];a=a[1];if(c){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(d,c)};return a}();l.DecodeUTF8=Ba;h=function(){function a(a){this.ondata=a}a.prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Wa(a),this.d=b||!1)};return a}();l.EncodeUTF8=h;function Wa(a,c){if(c){var d=new b(a.length);for(var e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}if(Sa)return Sa.encode(a);d=a.length;var f=new b(a.length+(a.length>>1)),g=0,h=function(a){f[g++]=a};for(var e=0;e<d;++e){if(g+5>f.length){var i=new b(g+8+(d-e<<1));i.set(f);f=i}i=a.charCodeAt(e);i<128||c?h(i):i<2048?(h(192|i>>6),h(128|i&63)):i>55295&&i<57344?(i=65536+(i&1023<<10)|a.charCodeAt(++e)&1023,h(240|i>>18),h(128|i>>12&63),h(128|i>>6&63),h(128|i&63)):(h(224|i>>12),h(128|i>>6&63),h(128|i&63))}return A(f,0,g)}l.strToU8=Wa;function Xa(a,b){if(b){b="";for(var c=0;c<a.length;c+=16384)b+=String.fromCharCode.apply(null,a.subarray(c,c+16384));return b}else if(Ta)return Ta.decode(a);else{c=Va(a);b=c[0];a=c[1];if(a.length)throw"invalid utf-8 data";return b}}l.strFromU8=Xa;var Ya=function(a){return a==1?3:a<6?2:a==9?1:0},Za=function(a,b){return b+30+X(a,b+26)+X(a,b+28)},$a=function(a,b,c){var d=X(a,b+28),e=Xa(a.subarray(b+46,b+46+d),!(X(a,b+8)&2048));d=b+46+d;var f=Y(a,b+20);c=c&&f==4294967295?ab(a,d):[f,Y(a,b+24),Y(a,b+42)];f=c[0];var g=c[1];c=c[2];return[X(a,b+10),f,g,e,d+X(a,b+30)+X(a,b+32),c]},ab=function(a,b){for(;X(a,b)!=1;b+=4+X(a,b+2));return[la(a,b+12),la(a,b+4),la(a,b+20)]},bb=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},cb=function(b,c,d,e,f,g,h,i){var a=e.length,j=d.extra,k=i&&i.length,l=bb(j);Z(b,c,h!=null?33639248:67324752),c+=4;h!=null&&(b[c++]=20,b[c++]=d.os);b[c]=20,c+=2;b[c++]=d.flag<<1|(g==null&&8),b[c++]=f&&8;b[c++]=d.compression&255,b[c++]=d.compression>>8;f=new Date(d.mtime==null?Date.now():d.mtime);var m=f.getFullYear()-1980;if(m<0||m>119)throw"date not in range 1980-2099";Z(b,c,m<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),c+=4;g!=null&&(Z(b,c,d.crc),Z(b,c+4,g),Z(b,c+8,d.size));Z(b,c+12,a);Z(b,c+14,l),c+=16;h!=null&&(Z(b,c,k),Z(b,c+6,d.attrs),(Z(b,c+10,h),c+=14));b.set(e,c);c+=a;if(l)for(m in j){f=j[m];g=f.length;Z(b,c,+m);Z(b,c+2,g);b.set(f,c+4),c+=4+g}k&&(b.set(i,c),c+=k);return c},db=function(a,b,c,d,e){Z(a,b,101010256),Z(a,b+8,c),Z(a,b+10,c),Z(a,b+12,d),Z(a,b+16,e)},eb=function(){function a(a){this.filename=a,this.c=O(),this.size=0,this.compression=0}a.prototype.process=function(a,b){this.ondata(null,a,b)};a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a);this.size+=a.length;b&&(this.crc=this.c.d());this.process(a,b||!1)};return a}();l.ZipPassThrough=eb;Ia=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ta(b,function(a,b){c.ondata(null,a,b)});this.compression=8;this.flag=Ya(b.level)}a.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.ZipDeflate=Ia;i=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ua(b,function(a,b,d){c.ondata(a,b,d)});this.compression=8;this.flag=Ya(b.level);this.terminate=this.d.terminate}a.prototype.process=function(a,b){this.d.push(a,b)};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.AsyncZipDeflate=i;Pa=function(){function a(a){this.ondata=a,this.u=[],this.d=1}a.prototype.add=function(c){var d=this;if(this.d&2)throw"stream finished";var e=Wa(c.filename),a=e.length,f=c.comment,g=f&&Wa(f);f=a!=c.filename.length||g&&f.length!=g.length;var h=a+bb(c.extra)+30;if(a>65535)throw"filename too long";a=new b(h);cb(a,0,c,e,f);var i=[a],j=function(){for(var a=0,b=i;a<b.length;a++){var c=b[a];d.ondata(null,c,!1)}i=[]},k=this.d;this.d=0;var l=this.u.length,m=R(c,{f:e,u:f,o:g,t:function(){c.terminate&&c.terminate()},r:function(){j();if(k){var a=d.u[l+1];a?a.r():d.d=1}k=1}}),n=0;c.ondata=function(a,e,f){if(a)d.ondata(a,e,f),d.terminate();else{n+=e.length;i.push(e);if(f){a=new b(16);Z(a,0,134695760);Z(a,4,c.crc);Z(a,8,n);Z(a,12,c.size);i.push(a);m.c=n,m.b=h+n+16,m.crc=c.crc,m.size=c.size;k&&m.r();k=1}else k&&j()}};this.u.push(m)};a.prototype.end=function(){var a=this;if(this.d&2){if(this.d&1)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){if(!(a.d&1))return;a.u.splice(-1,1);a.e()},t:function(){}});this.d=3};a.prototype.e=function(){var c=0,d=0,e=0;for(var f=0,a=this.u;f<a.length;f++){var g=a[f];e+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0)}a=new b(e+22);for(var f=0,h=this.u;f<h.length;f++){var g=h[f];cb(a,c,g,g.f,g.u,g.c,d,g.o);c+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0),d+=g.b}db(a,c,this.u.length,e,d);this.ondata(null,a,!0);this.d=2};a.prototype.terminate=function(){for(var b=0,a=this.u;b<a.length;b++){var c=a[b];c.t()}this.d=2};return a}();l.Zip=Pa;function fb(a,c,d){d||(d=c,c={});if(typeof d!="function")throw"no callback";var e={};Ra(a,"",e,c);var f=Object.keys(e),g=f.length,h=0,i=0,j=g,k=new Array(g),l=[],m=function(){for(var a=0;a<l.length;++a)l[a]()},n=function(){var a=new b(i+22),c=h,e=i-h;i=0;for(var f=0;f<j;++f){var g=k[f];try{var l=g.c.length;cb(a,i,g,g.f,g.u,l);var m=30+g.f.length+bb(g.extra),n=i+m;a.set(g.c,n);cb(a,h,g,g.f,g.u,l,i,g.m),h+=16+m+(g.m?g.m.length:0),i=n+l}catch(a){return d(a,null)}}db(a,h,k.length,e,c);d(null,a)};g||n();a=function(b){var c=f[b],a=e[c],j=a[0],o=a[1],p=O(),q=j.length;p.p(j);var r=Wa(c),s=r.length,t=o.comment,u=t&&Wa(t),v=u&&u.length,w=bb(o.extra),x=o.level==0?0:8;a=function(a,e){if(a)m(),d(a,null);else{a=e.length;k[b]=R(o,{size:q,crc:p.d(),c:e,f:r,m:u,u:s!=c.length||u&&t.length!=v,compression:x});h+=30+s+w+a;i+=76+2*(s+w)+(v||0)+a;--g||n()}};s>65535&&a("filename too long",null);if(!x)a(null,j);else if(q<16e4)try{a(null,wa(j,o))}catch(b){a(b,null)}else l.push(va(j,o,a))};for(c=0;c<j;++c)a(c);return m}l.zip=fb;function gb(c,d){d||(d={});var e={},f=[];Ra(c,"",e,d);c=0;d=0;for(var g in e){var a=e[g],h=a[0];a=a[1];var i=a.level==0?0:8,j=Wa(g),k=j.length,l=a.comment,m=l&&Wa(l),n=m&&m.length,o=bb(a.extra);if(k>65535)throw"filename too long";var p=i?wa(h,a):h,q=p.length,r=O();r.p(h);f.push(R(a,{size:h.length,crc:r.d(),c:p,f:j,m:m,u:k!=g.length||m&&l.length!=n,o:c,compression:i}));c+=30+k+o+q;d+=76+2*(k+o)+(n||0)+q}a=new b(d+22);h=c;r=d-c;for(p=0;p<f.length;++p){var j=f[p];cb(a,j.o,j,j.f,j.u,j.c.length);m=30+j.f.length+bb(j.extra);a.set(j.c,j.o+m);cb(a,c,j,j.f,j.u,j.c.length,j.o,j.m),c+=16+m+(j.m?j.m.length:0)}db(a,c,f.length,r,h);return a}l.zipSync=gb;var hb=function(){function a(){}a.prototype.push=function(a,b){this.ondata(null,a,b)};a.compression=0;return a}();l.UnzipPassThrough=hb;Qa=function(){function a(){var a=this;this.i=new $(function(b,c){a.ondata(null,b,c)})}a.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}};a.compression=8;return a}();l.UnzipInflate=Qa;Ba=function(){function a(a,b){var c=this;b<32e4?this.i=new $(function(a,b){c.ondata(null,a,b)}):(this.i=new xa(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}a.prototype.push=function(a,b){this.i.terminate&&(a=A(a,0)),this.i.push(a,b)};a.compression=8;return a}();l.AsyncUnzipInflate=Ba;h=function(){function a(a){this.onfile=a,this.k=[],this.o={0:hb},this.p=L}a.prototype.push=function(a,c){var d=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var e=Math.min(this.c,a.length),f=a.subarray(0,e);this.c-=e;this.d?this.d.push(f,!this.c):this.k[0].push(f);a=a.subarray(e);if(a.length)return this.push(a,c)}else{f=0;var g=0;e=void 0;var h=void 0;!this.p.length?h=a:!a.length?h=this.p:(h=new b(this.p.length+a.length),(h.set(this.p),h.set(a,this.p.length)));var i=h.length,j=this.c;a=j&&this.d;var k=function(){var a=Y(h,g);if(a==67324752){f=1,e=g;l.d=null;l.c=0;var b=X(h,g+6),c=X(h,g+8),k=b&2048;b=b&8;var m=X(h,g+26),n=X(h,g+28);if(i>g+30+m+n){var o=[];l.k.unshift(o);f=2;var p=Y(h,g+18),q=Y(h,g+22),r=Xa(h.subarray(g+30,g+=30+m),!k);p==4294967295?(m=b?[-2]:ab(h,g),p=m[0],q=m[1]):b&&(p=-1);g+=n;l.c=p;var s,t={name:r,compression:c,start:function(){if(!t.ondata)throw"no callback";if(!p)t.ondata(null,L,!0);else{var a=d.o[c];if(!a)throw"unknown compression type "+c;s=p<0?new a(r):new a(r,p,q);s.ondata=function(c,b,a){t.ondata(c,b,a)};for(var a=0,b=o;a<b.length;a++){var e=b[a];s.push(e,!1)}d.k[0]==o&&d.c?d.d=s:s.push(L,!0)}},terminate:function(){s&&s.terminate&&s.terminate()}};p>=0&&(t.size=p,t.originalSize=q);l.onfile(t)}return"break"}else if(j)if(a==134695760){e=g+=12+(j==-2&&8),f=3,l.c=0;return"break"}else if(a==33639248){e=g-=4,f=3,l.c=0;return"break"}},l=this;for(;g<i-4;++g){var m=k();if(m==="break")break}this.p=L;if(j<0){m=f?h.subarray(0,e-12-(j==-2&&8)-(Y(h,e-16)==134695760&&4)):h.subarray(0,g);a?a.push(m,!!f):this.k[+(f==2)].push(m)}if(f&2)return this.push(h.subarray(g),c);this.p=h.subarray(g)}if(c){if(this.c)throw"invalid zip file";this.p=null}};a.prototype.register=function(a){this.o[a.compression]=a};return a}();l.Unzip=h;function ib(a,c){if(typeof c!="function")throw"no callback";var d=[],e=function(){for(var a=0;a<d.length;++a)d[a]()},f={},g=a.length-22;for(;Y(a,g)!=101010256;--g)if(!g||a.length-g>65558){c("invalid zip file",null);return}var h=X(a,g+8);h||c(null,{});var i=h,j=Y(a,g+16),k=j==4294967295;if(k){g=Y(a,g-12);if(Y(a,g)!=101075792){c("invalid zip file",null);return}i=h=Y(a,g+32);j=Y(a,g+48)}g=function(g){g=$a(a,j,k);var i=g[0],l=g[1],m=g[2],n=g[3],o=g[4];g=g[5];g=Za(a,g);j=o;o=function(a,b){a?(e(),c(a,null)):(f[n]=b,--h||c(null,f))};if(!i)o(null,A(a,g,g+l));else if(i==8){g=a.subarray(g,g+l);if(l<32e4)try{o(null,za(g,new b(m)))}catch(a){o(a,null)}else d.push(ya(g,{size:m},o))}else o("unknown compression type "+i,null)};for(var l=0;l<i;++l)g(l);return e}l.unzip=ib;function jb(c){var d={},e=c.length-22;for(;Y(c,e)!=101010256;--e)if(!e||c.length-e>65558)throw"invalid zip file";var f=X(c,e+8);if(!f)return{};var g=Y(c,e+16),h=g==4294967295;if(h){e=Y(c,e-12);if(Y(c,e)!=101075792)throw"invalid zip file";f=Y(c,e+32);g=Y(c,e+48)}for(e=0;e<f;++e){var a=$a(c,g,h),i=a[0],j=a[1],k=a[2],l=a[3],m=a[4];a=a[5];a=Za(c,a);g=m;if(!i)d[l]=A(c,a,a+j);else if(i==8)d[l]=za(c.subarray(a,a+j),new b(k));else throw"unknown compression type "+i}return d}l.unzipSync=jb}var o=!1;function p(){o||(o=!0,n());return m.exports}function a(a){switch(a){case void 0:return p()}}e.exports=a}),null);
__d("fflate",["fflate-0.6.10"],(function(a,b,c,d,e,f){e.exports=b("fflate-0.6.10")()}),null);
__d("WAGzip",["WAErr","fflate"],(function(a,b,c,d,e,f,g){var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.$GzipWrapper2=[];c.ondata=function(a,b){c.$GzipWrapper2.push(a);if(!b)return;var d=0;c.$GzipWrapper2.forEach(function(a){d+=a.length});var e=new Uint8Array(d),f=0;c.$GzipWrapper2.forEach(function(a){e.set(a,f),f+=a.length});c.$GzipWrapper1=e};return c}var e=a.prototype;e.push=function(a,e){if(this.$GzipWrapper1!=null)throw c("WAErr")("Tried to push chunk to compressor after final block");a instanceof Uint8Array?b.prototype.push.call(this,a,e):a instanceof ArrayBuffer?b.prototype.push.call(this,new Uint8Array(a),e):b.prototype.push.call(this,d("fflate").strToU8(a),e)};e.result=function(){if(this.$GzipWrapper1==null)throw c("WAErr")("Tried to access result before adding final block");return this.$GzipWrapper1};return a}(d("fflate").Gzip);function a(a){a===void 0&&(a={});return new h(a)}function b(a){return d("fflate").decompressSync(a)}g.GzipWrapper=h;g.createDeflate=a;g.inflate=b}),98);
__d("WAPreKeysStanzaUtils",["WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap"],(function(a,b,c,d,e,f,g){"use strict";var h=5;function a(a){return d("WAWap").wap("key",null,d("WAWap").wap("id",null,d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)),d("WAWap").wap("value",null,a.keyPair.publicKey))}function b(a){return d("WAWap").wap("skey",null,d("WAWap").wap("id",null,d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)),d("WAWap").wap("value",null,a.keyPair.publicKey),d("WAWap").wap("signature",null,a.signature))}function c(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)};a={anyElementValue:a.keyPair.publicKey};return{keyIDMixinArgs:b,keyDataMixinArgs:a}}function e(a){var b={idElementValue:d("WAWap").BIG_ENDIAN_CONTENT(a.id,3)},c={anyElementValue:a.keyPair.publicKey};a=a.signature;return{keyIDMixinArgs:b,keyDataMixinArgs:c,signatureElementValue:a}}function f(a){var b=a.child("skey"),c=null;if(a.hasChild("key")){var d=a.child("key");c={id:d.child("id").contentUint(3),publicKey:d.child("value").contentSerializedPubKey()}}return{identity:a.child("identity").contentSerializedPubKey(),signedKey:{id:b.child("id").contentUint(3),publicKey:b.child("value").contentSerializedPubKey(),signature:b.child("signature").contentBytes(64)},oneTimeKey:c}}function i(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.skeyIdKeyIDMixin.elementValue,3),pubkey:a.skeyValueKeyDataMixin.elementValue,signature:a.skeySignatureElementValue}}function j(a){return{id:d("WAParsableXmlNode").convertBytesToUint(a.keyIdKeyIDMixin.elementValue,3),publicKey:d("WASignalKeys").serializeIdentity(a.keyValueKeyDataMixin.elementValue)}}function k(a){var b,c=m(a),e=a.elementValue;b=((b=a.keyTypeMixin)==null?void 0:b.typeElementValue)!=null?d("WAParsableXmlNode").convertBytesToUint((b=a.keyTypeMixin)==null?void 0:b.typeElementValue,1):h;var f=i(a),g=a.listId.map(function(a){return d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3)});a=a.hashElementValue;return{regId:c,identity:e,type:b,skey:f,keys:g,hash:a}}function l(a){var b=m(a),c=d("WASignalKeys").serializeIdentity(a.elementValue),e=i(a),f=a.preKeyMixin?j(a.preKeyMixin):null;a=d("WATimeUtils").castToUnixTime(a.t||0);return{keys:{regId:b,identity:c,oneTimeKey:f,signedKey:{id:e.id,signature:e.signature,publicKey:d("WASignalKeys").serializeIdentity(e.pubkey)}},timestamp:a}}function m(a){return d("WAParsableXmlNode").convertBytesToUint(a.registrationElementValue,4)}g.xmppPreKey=a;g.xmppSignedPreKey=b;g.makePreKeyMixin=c;g.makeSignedPreKeyMixin=e;g.readSessionInfo=f;g.convertSignedPreKeyMixin=i;g.convertPreKeyMixin=j;g.convertIdentityDigestBundle=k;g.convertSessionInfoWithTimestamp=l}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","400");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNoValidJIDMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetch=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetch:b.value}))}g.parseFetchKeyBundlesResponseRequestError=a}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","503");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[b,c])}g.parseServerErrors=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchKeyBundlesResponseServerError=a}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",500,599);return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorFallbackMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(b.value,"text");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"code","500");return!b.success?b:d("WAResultOrError").makeResult({errorText:a.value,errorCode:b.value})}g.parseFetchKeyBundlesUserErrorMixin=a}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"device-identity");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytes(a.value);return!a.success?a:d("WAResultOrError").makeResult({deviceIdentityElementValue:a.value})}g.parseDeviceIdentityMixin=a}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"type");if(!a.success)return a;a=d("WASmaxParseUtils").contentLiteralBytes(a.value,new Uint8Array([5]));return!a.success?a:d("WAResultOrError").makeResult({typeElementValue:a.value})}g.parseKeyTypeMixin=a}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,3,3);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseKeyIDMixin=a}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"key");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;a=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:d("WAResultOrError").makeResult({keyIdKeyIDMixin:b.value,keyValueKeyDataMixin:a.value})}g.parsePreKeyMixin=a}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"registration");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,4,4);return!a.success?a:d("WAResultOrError").makeResult({registrationElementValue:a.value})}g.parseRegistrationIDMixin=a}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"skey");if(!a.success)return a;var b=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"value");if(!c.success)return c;a=d("WASmaxParseUtils").flattenedChildWithTag(a.value,"signature");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!a.success)return a;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(b.value);if(!b.success)return b;c=d("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(c.value);return!c.success?c:d("WAResultOrError").makeResult({skeySignatureElementValue:a.value,skeyIdKeyIDMixin:b.value,skeyValueKeyDataMixin:c.value})}g.parseSignedPreKeyMixin=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a),f=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(a),h=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!h.success)return h;a=d("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({t:b.value},c.value,{keyTypeMixin:e.success?e.value:null},f.value,{preKeyMixin:g.success?g.value:null},h.value,{deviceIdentityMixin:a.success?a.value:null}))}g.parseFetchKeyBundlesUserSuccessMixin=a}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:b.value});var c=d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:c.value});var e=d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(a);return e.success?d("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserSuccess","UserError","UserErrorFallback"],[b,c,e])}g.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseJid").attrDeviceJid(a,"jid");if(!b.success)return b;a=d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,1e5,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{listUser:b.value}))}g.parseFetchKeyBundlesResponseSuccessListUser=h;g.parseFetchKeyBundlesResponseSuccess=a}),98);
__d("WASmaxAttrs",["WAWap"],(function(a,b,c,d,e,f,g){function a(a,b){if(b==null)return d("WAWap").DROP_ATTR;else return a(b)}function b(a,b){if(b)return a;else return d("WAWap").DROP_ATTR}g.OPTIONAL=a;g.OPTIONAL_LITERAL=b}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(a,b,c,d,e,f,g){function a(a,b){if(b==null)return null;else return a(b)}function b(a,b){if(b==null)return null;else if(b)return a()}function c(a,b){if(b)for(var c=1;c<b.length;c++)if(!d("WADeepEquals").deepEqual(b[c],b[0]))throw new Error("expected all homogeneous children to be equal, but they were not");c=h(a,b,0,Infinity);return c}function e(a,b){return i(a,b,0,Infinity)}function h(a,b,c,d){if(b==null){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}var e=b.length;if(e<c)throw new Error("expected at least "+c+" children, but found "+e);else if(e>d)throw new Error("expected at most "+d+" children, but found "+e);return b.map(function(b){return a(b)})}function i(a,b,c,d){if(b===0){if(c>0)throw new Error("expected at least "+c+" children, but none provided");return[]}if(b<c)throw new Error("expected at least "+c+" children, but found "+b);else if(b>d)throw new Error("expected at most "+d+" children, but found "+b);c=[];for(d=0;d<b;d++)c.push(a());return c}g.OPTIONAL_CHILD=a;g.HAS_OPTIONAL_CHILD=b;g.HOMOGENEOUS_CHILD=c;g.HOMOGENEOUS_CHILD_COUNT=e;g.REPEATED_CHILD=h;g.REPEATED_CHILD_COUNT=i}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",to:d("WAWap").S_WHATSAPP_NET});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeClientRequestMixin=a}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid;a=a.hasUserReasonIdentity;b=d("WASmaxJsx").smax("user",{jid:d("WAWap").DEVICE_JID(b),reason:d("WASmaxAttrs").OPTIONAL_LITERAL("identity",a)});return b}function a(a){a=a.userArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("key",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,1e5))));return a}g.makeFetchKeyBundlesRequestKeyUser=h;g.makeFetchKeyBundlesRequest=a}),98);
__d("WASmaxParsingFailure",[],(function(a,b,c,d,e,f){a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,"SmaxParsingFailure: "+b)||this;c.name="SmaxParsingFailure";c.reason=b;return c}var c=b.prototype;c.toString=function(){return"SmaxParsingFailure: "+this.reason};return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxParsingFailure=a}),66);
__d("WASmaxRpcUtils",[],(function(a,b,c,d,e,f){function a(a,b){var c=Object.keys(b).map(function(a){return'Tried <response name="'+a+'">, but failed with '+b[a].error+"."}).join(" ");return'Failed to parse the response of <rpc name="'+a+'">. '+c}f.errorMessageRpcParsing=a}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseRequestError",value:h.value});case 10:i=d("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"FetchKeyBundlesResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:g,RequestError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendFetchKeyBundlesRPC=a}),98);
__d("WABulkRequestKeys",["WAPreKeysStanzaUtils","WAResultOrError","WASmaxPreKeysFetchKeyBundlesRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:a.map(function(a){return{userJid:a,hasUserReasonIdentity:!1}})}));case 2:c=f.sent;if(!(c.name!=="FetchKeyBundlesResponseSuccess")){f.next=5;break}return f.abrupt("return",d("WAResultOrError").makeError("errRequestKeysParsingFailed"));case 5:c.name;e=new Map();c.value.listUser.map(function(a){var b=a.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;b.name==="FetchKeyBundlesUserSuccess"&&e.set(a.jid,d("WAPreKeysStanzaUtils").convertSessionInfoWithTimestamp(b.value))});return f.abrupt("return",d("WAResultOrError").makeResult(e));case 9:case"end":return f.stop()}},null,this)}g.bulkRequestKeys=a}),98);
__d("WAInMemorySignalStore",["Promise","WAErr","WAJids","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot perform signal LLA ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["InMemoryCryptoManager doesn't have 'loadSessions' implemented"]);i=function(){return a};return a}function j(a,b){return a+"|"+b}function k(a){a=a.split("|");if(a.length!==2)throw c("WAErr")("Incorrect ComplexSenderKey");return{groupId:d("WAJids").unsafeCoerceToGroupJid(a[0]),deviceId:d("WAJids").unsafeCoerceToDeviceJid(a[1])}}var l=function(){function a(){this.$1=new Map(),this.$2=new Set()}var c=a.prototype;c.load=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!this.$2.has(a)){f.next=2;break}return f.abrupt("return",null);case 2:d=this.$1.get(a);if(!(d!=null)){f.next=5;break}return f.abrupt("return",d.current);case 5:f.next=7;return b("regeneratorRuntime").awrap(c(a));case 7:e=f.sent;this.$1.set(a,{current:e,original:e});return f.abrupt("return",e);case 10:case"end":return f.stop()}},null,this)};c.store=function(a,b){this.$1.set(a,{current:b,original:(b=this.$1.get(a))==null?void 0:b.original})};c.remove=function(a){this.$2.add(a)};c.snapshot=function(){var a=this;return{update:Array.from(this.$1.entries()).filter(function(b){b=b[0];return!a.$2.has(b)}).filter(function(a){a[0];a=a[1];return a.current!==a.original}).map(function(a){var b=a[0];a=a[1];return{id:b,current:a.current,original:a.original}}),remove:Array.from(this.$2.keys()).map(function(a){return{id:a}})}};c.clear=function(){this.$1=new Map(),this.$2=new Set()};return a}();a=function(){function a(a){var c=this;this.$1=new l();this.$2=new l();this.$3=new l();this.$4=new l();this.$5=new l();this.loadSession=function(a){return c.$1.load(a,function(a){return c.$6.loadSession(a)})};this.loadSignedPreKey=function(a){return c.$4.load(a,function(){return c.$6.loadSignedPreKey(a)})};this.loadOneTimePreKey=function(a){return c.$3.load(a,function(){return c.$6.loadOneTimePreKey(a)})};this.loadSenderKeySession=function(a,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(c.$5.load(j(a,e),function(){var d;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(c.$6.loadSenderKeySession(a,e));case 2:d=f.sent;if(!d.success){f.next=5;break}return f.abrupt("return",d.value);case 5:return f.abrupt("return",null);case 6:case"end":return f.stop()}},null,this)}));case 2:f=g.sent;if(!(f==null)){g.next=5;break}return g.abrupt("return",d("WAResultOrError").makeError("errLoadSenderKeySession"));case 5:return g.abrupt("return",d("WAResultOrError").makeResult(f));case 6:case"end":return g.stop()}},null,this)};this.bulkLoadSignalData=function(){return b("Promise").resolve(d("WAResultOrError").makeError("errLoadSignal"))};this.saveSenderKeySessionIfMatches=function(a,b,e,f){return c.saveSenderKeySession(a,b,f).then(function(){return d("WAResultOrError").makeResult()})};this.saveSenderKeySession=function(a,b,d){return c.loadSenderKeySession(a,b).then(function(){return c.storeSenderKeySession(a,b,d)})};this.handleNewSessionIfMatches=function(a,e,f,g,h){c.storeSession(a,f);g!=null&&c.storeIdentity(a,g);h!=null&&c.removeOneTimePreKey(h);return b("Promise").resolve(d("WAResultOrError").makeResult())};this.$6=a}var c=a.prototype;c.storeSession=function(a,b,c){this.$1.store(a,{session:b,hash:c})};c.storeIdentity=function(a,b){if(!b)return;this.$2.store(a,b)};c.removeOneTimePreKey=function(a){this.$3.remove(a)};c.storeSenderKeySession=function(a,b,c,d){this.$5.store(j(a,b),{session:c,hash:d})};c.savePendingToDatabase=function(){var a=this,c=this.generateSnapshot();if(c!=null)return this.$6.bulkSaveSignalData(c).then(function(b){a.clear();return b});else return b("Promise").resolve(d("WAResultOrError").makeResult())};c.loadSessions=function(a){d("WALogger").ERROR(i()).sendLogs("InMemoryCryptoManager-wrong-call");return this.$6.loadSessions(a)};c.clear=function(){this.$1.clear(),this.$2.clear(),this.$3.clear(),this.$4.clear(),this.$5.clear()};c.generateSnapshot=function(){var a=this.$1.snapshot(),b=[];a.update.forEach(function(a){var c=a.id,d=a.current;a=a.original;if(d==null)return;b.push({id:c,updated:d.session,original:a==null?void 0:a.hash})});var c=[];this.$5.snapshot().update.forEach(function(a){var b=k(a.id),d=b.groupId;b=b.deviceId;if(a.current!=null&&d&&b){c.push({groupId:d,author:b,updated:a.current.session,original:(d=a.original)==null?void 0:d.hash})}});a=this.$2.snapshot();var d=[];a.update.forEach(function(a){var b=a.id;a=a.current;if(a==null)return;d.push({id:b,identity:a})});return{sessionUpdate:b,identityUpdate:d,senderKeySessionUpdate:c,preKeyRemove:this.$3.snapshot().remove}};c.preloadCache=function(a,c){return b("Promise").resolve()};c.runInTransaction=function(a){var c=this;return new(b("Promise"))(function(e){try{return e(a({loadSession:c.loadSession,loadSessions:c.$6.loadSessions,updateDevicesForUser:c.$6.updateDevicesForUser,getLastPreKeyGenerationId:c.$6.getLastPreKeyGenerationId,saveOneTimePreKeyIfMatches:c.$6.saveOneTimePreKeyIfMatches,savePreKeysGenerationIfMatches:c.$6.savePreKeysGenerationIfMatches,getPreKeyGenerationsTimestamps:c.$6.getPreKeyGenerationsTimestamps,deletePreKeyGenerations:c.$6.deletePreKeyGenerations,loadPreKeys:c.$6.loadPreKeys,loadSignedPreKey:c.loadSignedPreKey,loadOneTimePreKey:c.loadOneTimePreKey,loadLatestSignedPreKey:c.$6.loadLatestSignedPreKey,loadSenderKeySession:c.loadSenderKeySession,saveSenderKeySession:c.saveSenderKeySession,saveSignedPreKeyIfNew:c.$6.saveSignedPreKeyIfNew,bulkSaveSignalData:c.$6.bulkSaveSignalData,saveSenderKeySessionIfMatches:c.saveSenderKeySessionIfMatches,handleNewSessionIfMatches:c.handleNewSessionIfMatches,saveIdentity:function(a,d){return b("Promise").resolve(c.storeIdentity(a,d))}}))}catch(a){d("WALogger").ERROR(h(),a);return e(d("WAResultOrError").makeError("runtime-exception"))}})};return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WASignalEntityStore",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Set()}var c=a.prototype;c.loadFromMemory=function(a){if(this.$2.has(a))return null;a=this.$1.get(a);return a==null?void 0:a.cachedEntity};c.load=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!this.$2.has(a)){f.next=2;break}return f.abrupt("return",null);case 2:d=this.loadFromMemory(a);if(!(d!=null)){f.next=5;break}return f.abrupt("return",d);case 5:f.next=7;return b("regeneratorRuntime").awrap(c(a));case 7:e=f.sent;this.updateCache(a,e);return f.abrupt("return",e);case 10:case"end":return f.stop()}},null,this)};c.bulkLoad=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:d=[],e=new Map(),f=0;case 3:if(!(f<a.length)){q.next=12;break}g=a[f];if(!this.$2.has(g)){q.next=7;break}return q.abrupt("continue",9);case 7:h=this.loadFromMemory(g),h!=null?e.set(g,h):d.push(g);case 9:f++;q.next=3;break;case 12:q.next=14;return b("regeneratorRuntime").awrap(c(d));case 14:i=q.sent,(j=i.entries(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 16:if(!k){q.next=22;break}if(!(l>=j.length)){q.next=19;break}return q.abrupt("break",33);case 19:m=j[l++];q.next=26;break;case 22:l=j.next();if(!l.done){q.next=25;break}return q.abrupt("break",33);case 25:m=l.value;case 26:n=m,o=n[0],p=n[1],e.set(o,p),this.updateCache(o,p);case 31:q.next=16;break;case 33:return q.abrupt("return",e);case 34:case"end":return q.stop()}},null,this)};c.updateCache=function(a,b){this.$2["delete"](a),this.$1.set(a,{cachedEntity:b,persisted:!0})};c.store=function(a,b){this.$2["delete"](a),this.$1.set(a,{cachedEntity:b,persisted:!1})};c.remove=function(a){this.$2.add(a)};c.snapshot=function(){var a=this;return{update:Array.from(this.$1.entries()).filter(function(b){b=b[0];return!a.$2.has(b)}).filter(function(a){a[0];a=a[1];return a!=null}).filter(function(a){a[0];a=a[1];return!a.persisted}).map(function(a){var b=a[0];a=a[1];return{id:b,cachedEntity:a.cachedEntity}}),remove:Array.from(this.$2.keys()).map(function(a){return{id:a}})}};c.clear=function(){this.$1=new Map(),this.$2=new Set()};return a}();f.SignalEntityStore=a}),66);
__d("WAInMemorySignalStoreV2",["Promise","WACryptoManager","WALogger","WAPromiseQueue","WAResultOrError","WASignalEntityStore","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot perform signal LLA ",""]);h=function(){return a};return a}a=function(){function a(a){var c=this;this.$1=new(d("WASignalEntityStore").SignalEntityStore)();this.$2=new(d("WASignalEntityStore").SignalEntityStore)();this.$3=new(d("WASignalEntityStore").SignalEntityStore)();this.$4=new(d("WASignalEntityStore").SignalEntityStore)();this.$5=new(d("WASignalEntityStore").SignalEntityStore)();this.$7=new(d("WAPromiseQueue").PromiseQueue)();this.loadSession=function(a){return c.$1.load(a,function(a){return c.$6.loadSession(a).then(function(a){return a==null?void 0:a.session})}).then(function(a){return a?{session:a}:null})};this.loadSessions=function(a){return c.$1.bulkLoad(a,function(a){return c.$6.loadSessions(a).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],a[1].session]}))})}).then(function(a){return new Map(Array.from(a.entries()).map(function(a){return[a[0],{session:a[1]}]}))})};this.loadSignedPreKey=function(a){return c.$4.load(a,function(){return c.$6.loadSignedPreKey(a)})};this.loadOneTimePreKey=function(a){return c.$3.load(a,function(){return c.$6.loadOneTimePreKey(a)})};this.saveSenderKeySession=function(a,b,e){return c.$6.saveSenderKeySession(a,b,e).then(function(){c.$5.updateCache(d("WACryptoManager").encodeSenderKey(a,b),e)})};this.saveSenderKeySessionIfMatches=function(a,e,f,g){return b("Promise").resolve(d("WAResultOrError").makeResult(c.storeSenderKeySession(a,e,g)))};this.loadSenderKeySession=function(a,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(c.$5.load(d("WACryptoManager").encodeSenderKey(a,e),function(){var d;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(c.$6.loadSenderKeySession(a,e));case 2:d=f.sent;if(!d.success){f.next=5;break}return f.abrupt("return",d.value.session);case 5:return f.abrupt("return",null);case 6:case"end":return f.stop()}},null,this)}));case 2:f=g.sent;if(!(f==null)){g.next=5;break}return g.abrupt("return",d("WAResultOrError").makeError("errLoadSenderKeySession"));case 5:return g.abrupt("return",d("WAResultOrError").makeResult({session:f}));case 6:case"end":return g.stop()}},null,this)};this.handleNewSessionIfMatches=function(a,e,f,g,h,i){c.storeSession(a,f);g!=null&&c.storeIdentity(a,g);h!=null&&c.removeOneTimePreKey(h);return b("Promise").resolve(d("WAResultOrError").makeResult())};this.$6=a}var c=a.prototype;c.storeSession=function(a,b){this.$1.store(a,b)};c.storeIdentity=function(a,b){if(!b)return;this.$2.store(a,b)};c.removeOneTimePreKey=function(a){this.$3.remove(a)};c.storeSenderKeySession=function(a,b,c){this.$5.store(d("WACryptoManager").encodeSenderKey(a,b),c)};c.savePendingToDatabase=function(){var a=this,c=this.$8();return c==null?b("Promise").resolve(d("WAResultOrError").makeResult()):this.$6.bulkSaveSignalData(c).then(function(b){a.clear();return b})};c.clear=function(){this.$1.clear(),this.$2.clear(),this.$3.clear(),this.$4.clear(),this.$5.clear()};c.$9=function(a){var b=this,c=navigator.locks;return c==null?a():c.request("signalStorage",{ifAvailable:!0},function(d){if(d)return a();else{b.clear();return c.request("signalStorage",a)}})};c.runInTransaction=function(a){var c=this;return this.$9(function(){return c.$7.enqueue(function(){return b("Promise").resolve(a({bulkSaveSignalData:c.$6.bulkSaveSignalData,deletePreKeyGenerations:c.$6.deletePreKeyGenerations,getLastPreKeyGenerationId:c.$6.getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:c.$6.getPreKeyGenerationsTimestamps,handleNewSessionIfMatches:c.handleNewSessionIfMatches,loadLatestSignedPreKey:c.$6.loadLatestSignedPreKey,loadOneTimePreKey:c.loadOneTimePreKey,loadPreKeys:c.$6.loadPreKeys,loadSenderKeySession:c.loadSenderKeySession,loadSession:c.loadSession,loadSessions:c.loadSessions,loadSignedPreKey:c.loadSignedPreKey,saveOneTimePreKeyIfMatches:c.$6.saveOneTimePreKeyIfMatches,savePreKeysGenerationIfMatches:c.$6.savePreKeysGenerationIfMatches,saveSenderKeySession:c.saveSenderKeySession,saveSenderKeySessionIfMatches:c.saveSenderKeySessionIfMatches,saveSignedPreKeyIfNew:c.$6.saveSignedPreKeyIfNew,updateDevicesForUser:c.$6.updateDevicesForUser,saveIdentity:function(a,d){return b("Promise").resolve(c.storeIdentity(a,d))}})).then(function(a){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(a.success===!0)){e.next=11;break}e.next=3;return b("regeneratorRuntime").awrap(c.savePendingToDatabase());case 3:d=e.sent;if(!(d.success===!0)){e.next=8;break}return e.abrupt("return",a);case 8:return e.abrupt("return",d);case 9:e.next=12;break;case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}},null,this)})})})["catch"](function(a){d("WALogger").ERROR(h(),a);return b("Promise").resolve(d("WAResultOrError").makeError("runtime-exception",a))})};c.$8=function(){var a=this.$1.snapshot(),b=[];a.update.forEach(function(a){var c=a.id;a=a.cachedEntity;if(a==null)return;b.push({id:c,updated:a,original:null})});var c=[];this.$5.snapshot().update.forEach(function(a){var b=d("WACryptoManager").decodeSenderKey(a.id),e=b.groupId;b=b.deviceId;a.cachedEntity!=null&&e&&b&&c.push({groupId:e,author:b,updated:a.cachedEntity,original:null})});a=this.$2.snapshot();var e=[];a.update.forEach(function(a){var b=a.id;a=a.cachedEntity;if(a==null)return;e.push({id:b,identity:a})});a=this.$3.snapshot().remove;return b.length===0&&e.length===0&&c.length===0&&a.length===0?null:{sessionUpdate:b,identityUpdate:e,senderKeySessionUpdate:c,preKeyRemove:a}};return a}();g.InMemorySignalStoreImpl=a}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(a,b,c,d,e,f,g){var h={delayMs:50,maxSize:100};function a(a,b){b=b===void 0?h:b;var c=b.delayMs,e=b.maxSize,f=null;function g(b){f&&f.args===b&&(f=null);return a(b)}return function(a){if(f!=null)f.args.push(a);else{var b=[a],h=new(d("WAResolvable").Resolvable)();a=h.promise.then(g);var i=function(){return void h.resolve(b)},j=setTimeout(i,c);f={args:b,batchPromise:a,run:i,timer:j}}a=f;i=a.args;j=a.batchPromise;var k=i.length-1;if(i.length>=e){clearTimeout((a=f)==null?void 0:a.timer);f.run();f=null}return j.then(function(a){return a[k]})}}g.makeSimpleBatcher=a}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WARequestKeysBatcher").makeSimpleBatcher(function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WABulkRequestKeys").bulkRequestKeys(a));case 2:c=e.sent;if(!(c.success===!1)){e.next=5;break}return e.abrupt("return",a.map(function(){return c}));case 5:return e.abrupt("return",a.map(function(a){a=c.value.get(a);return a?d("WAResultOrError").makeResult(a):d("WAResultOrError").makeError("errRequestKeysNoKeys")}));case 6:case"end":return e.stop()}},null,this)});c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},a);g.requestKeys=c}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoManager","WADualSendMsgUtils","WAErr","WAGlobals","WAInMemorySignalStore","WAInMemorySignalStoreV2","WALogger","WAPREList","WAPREMetrics","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt skdm"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg error: ",""]);j=function(){return a};return a}function a(a,c){c=c?new(d("WAInMemorySignalStoreV2").InMemorySignalStoreImpl)(a.db):new(d("WAInMemorySignalStore").InMemorySignalStoreImpl)(a.db);var e={clear:function(){},runInTransaction:function(c){return b("Promise").resolve(c(a.db))},savePendingToDatabase:function(){return b("Promise").resolve(d("WAResultOrError").makeResult())},preloadCache:function(){return b("Promise").resolve()}},f=k();return{inMemoryManager:d("WACryptoManager").initCryptoManager({regInfo:a.regInfo,storage:c,network:f}),manager:d("WACryptoManager").initCryptoManager({regInfo:a.regInfo,storage:e,network:f}),storage:c}}function k(){return{requestKeys:d("WARequestKeys").requestKeys,bulkRequestKeys:d("WABulkRequestKeys").bulkRequestKeys}}function l(a,b,c,e){if(c.success)a==null?void 0:a.endSuccess(),b==null?void 0:b.endSuccess({"int":{attempts:c.value.attempts,retryCount:e}}),d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL,{"int":{retryCount:e}}).endSuccess();else{var f;d("WALogger").WARN(j(),c.error);switch(c.error){case"errDuplicateMsg":a==null?void 0:a.addPoint(c.error);a==null?void 0:a.endSuccess();b==null?void 0:b.endSuccess();return;case"errTooManySessionSaveRetries":case"errCryptoDeserialization":case"errSignalNoSession":case"errSignalInvalidMsg":case"errInvalidMac":case"errSignalInvalidSignedPreKey":case"errSignalSignedPreKeyIdMismatch":case"errSignalSignedPreKeyDeserialization":case"errSignalInvalidOneTimeKey":case"errSignalOneTimeKeyMismatch":case"errSignalOneTimeKeyDeserialization":case"errSignalInvalidKey":case"errSignalDecryptionFailed":case"errSignalDeserializeInvalidProtoFormat":case"errSignalDeserializeRatchetKeyBadFormat":case"errSignalDeserializePkInvalidProtoFormat":case"errSignalDeserializePkKeyBadFormat":case"errSignalTooManyMessagesInFuture":case"errSignalEmptyVersionContentSuffix":case"errSignalContentExceededExpectedLength":case"errSignalGrpInvalidProtoFormat":case"errSignalGrpInvalidKeyFormat":case"errSignalGrpVersionContentEmpty":case"errSignalGrpInvalidVersionContentLength":case"errSignalGrpSenderKeyInvalidProtoFormat":case"errSignalGrpSenderKeyProtoError":case"errSignalGrpTooManyMessagesInFuture":f=c.error;break;default:typeof c.error==="string"?f=c.error:(d("WALogger").ERROR(i(),c),f="fail");break}b==null?void 0:b.endFail(f);a==null?void 0:a.endFail(f)}}function e(a,c,e,f,g){var h=null;return d("WACryptoManager").decryptContent(d("WAGlobals").getInMemoryCryptoManager(),c,{ciphertext:e,type:a},function(a,c){h={plaintext:a,remoteIdentity:c};return b("Promise").resolve()}).then(function(a){l(g,null,a,f);if(a.success)return d("WAResultOrError").makeResult(h);else return a})}function f(a,c,e,f,g){var h=null;return d("WACryptoManager").decryptGroupContent(d("WAGlobals").getInMemoryCryptoManager(),a,c,e,function(a){h={plaintext:a};return b("Promise").resolve()}).then(function(a){l(g,null,a,f);if(a.success)return d("WAResultOrError").makeResult(h);else return a})}function m(a){return d("WACryptoManager").getParticipantInfo(d("WAGlobals").getCryptoManager(),a)}function n(){return d("WAGlobals").getCryptoManager().storage.runInTransaction(function(a){a=a.getPreKeyGenerationsTimestamps;return a().then(function(a){return d("WAResultOrError").makeResult(a)})}).then(function(a){return a.success===!0?a.value:[]})}function o(a){return d("WAGlobals").getCryptoManager().storage.runInTransaction(function(b){b=b.deletePreKeyGenerations;return b(a).then(function(){return d("WAResultOrError").makeResult()})}).then(function(){})}function p(a,b,c,e){e===void 0&&(e=!1);return d("WACryptoManager").saveSenderKeySession(e?d("WAGlobals").getInMemoryCryptoManager():d("WAGlobals").getCryptoManager(),a,b,c)}function q(){return d("WAGlobals").getCryptoManager().regInfo.regId}function r(){var a,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WAGlobals").getCryptoManager().storage.runInTransaction(function(a){a=a.loadLatestSignedPreKey;return a().then(d("WAResultOrError").makeResult)}));case 2:a=j.sent;if(!(a.success===!1)){j.next=5;break}throw c("WAErr")("No signed prekey");case 5:e=d("WASignalSignatures").deserializeSignedPreKey(a.value);if(!(e==null)){j.next=8;break}throw c("WAErr")("Cannot deserialize signed prekey");case 8:j.next=10;return b("regeneratorRuntime").awrap(d("WACryptoManager").generateOneTimePreKey(d("WAGlobals").getCryptoManager()));case 10:f=j.sent;if(!(f==null)){j.next=13;break}throw c("WAErr")("No prekey");case 13:g=d("WAGlobals").getCryptoManager().regInfo,h=g.regId,i=g.staticKeyPair;return j.abrupt("return",b("Promise").resolve({regId:h,keyType:d("WASignalKeys").KEY_TYPE,publicKey:i.publicKey,signedPreKey:e,preKey:f}));case 15:case"end":return j.stop()}},null,this)}function s(a,b){var c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"group"},"int":{isDualSend:d("WADualSendMsgUtils").isDualSendJid(a)?1:0}}),e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.TEST_MAW_ENCRYPT_MESSAGE,{string:{chat:"group"},"int":{isDualSend:d("WADualSendMsgUtils").isDualSendJid(a)?1:0}},void 0,{string:{jid:a}});return d("WACryptoManager").encryptGroupContent(d("WAGlobals").getCryptoManager(),a,d("WAGlobals").getMyDeviceJid(),b).then(function(a){if(a.success)c.endSuccess(),e.endSuccess();else{switch(a.error){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}c.endFail(a.error);e.endFail(a.error)}return a})}function t(a,b,c,e,f){var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION,{string:{chat:"1:1"}},void 0,f!=null?{string:{jid:f}}:void 0),h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.TEST_MAW_ENCRYPT_MESSAGE,{string:{chat:"1:1"}});return d("WACryptoManager").encryptContent(d("WAGlobals").getCryptoManager(),a,b,c||d("WACryptoManager").DEFAULT_SESSION_REQUEST,e).then(function(a){if(a.success)g.endSuccess(),h.endSuccess();else{switch(a.error){case"identity-mismatch":case"errSignalInvalidKey":break;default:break}g.endFail(a.error);h.endFail(a.error)}return a})}function u(a,b){return d("WACryptoManager").bulkEncryptContent(d("WAGlobals").getCryptoManager(),a,b).then(function(a){if(a.success===!1){d("WALogger").ERROR(h());return new Map()}return a.value})}function v(a){return d("WACryptoManager").acquireSessionLocks(d("WAGlobals").getCryptoManager(),a,function(){var c,e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(d("WACryptoManager").ensureSessionsExists(d("WAGlobals").getCryptoManager(),a));case 2:c=m.sent;if(!d("WAGlobals").getConfig().useCryptoManagerV2()){m.next=7;break}return m.abrupt("return",d("WAGlobals").getCryptoManager().storage.runInTransaction(function(a){var e=a.handleNewSessionIfMatches;return b("Promise").all(Array.from(c.entries()).map(function(b){var a=b[0];b=b[1];return e(a,null,b.session,b.session.remote.pubKey)})).then(function(){return d("WAResultOrError").makeResult()})}).then(function(){}));case 7:e={sessionUpdate:[],identityUpdate:[],senderKeySessionUpdate:[],preKeyRemove:[]},(f=c.entries(),g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 9:if(!g){m.next=15;break}if(!(h>=f.length)){m.next=12;break}return m.abrupt("break",25);case 12:i=f[h++];m.next=19;break;case 15:h=f.next();if(!h.done){m.next=18;break}return m.abrupt("break",25);case 18:i=h.value;case 19:j=i,k=j[0],l=j[1],e.sessionUpdate.push({id:k,updated:l.session,original:void 0});case 23:m.next=9;break;case 25:return m.abrupt("return",d("WAGlobals").getCryptoManager().storage.runInTransaction(function(a){a=a.bulkSaveSignalData;return a(e).then(function(){return d("WAResultOrError").makeResult()})}).then(function(){}));case 26:case"end":return m.stop()}},null,this)})}g.createCryptoManager=a;g.decryptMsg=e;g.decryptGroupMsg=f;g.getParticipantInfo=m;g.getPreKeyGenerationsTimestamps=n;g.deletePreKeyGenerations=o;g.saveSenderKeySession=p;g.getRegId=q;g.getSignalInfoForRetry=r;g.encryptGroupContentWithMetrics=s;g.encryptMsgWithMetrics=t;g.bulkEncryptSKDM=u;g.bulkPreEstablishOutgoingSession=v}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("WAGetContactsFromGroupJid",["WAGlobals","WAResultOrError","WAResultOrErrorUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=a.ContactsStore,f=a.ParticipantsStore;i.next=3;return b("regeneratorRuntime").awrap(f.bulkGetInGroup(c));case 3:g=i.sent;if(g.success){i.next=6;break}return i.abrupt("return",d("WAResultOrError").makeError("missing"));case 6:i.next=8;return b("regeneratorRuntime").awrap(e.bulkGet(g.value.map(function(a){return a.user})).then(d("WAResultOrErrorUtils").unpackValues));case 8:h=i.sent;return i.abrupt("return",d("WAResultOrError").makeResult(h));case 10:case"end":return i.stop()}},null,this)}a=function(a){return d("WAGlobals").runInTransaction({ContactsStore:!0,ParticipantsStore:!0},function(b){var c=b.ContactsStore;b=b.ParticipantsStore;return h({ContactsStore:c,ParticipantsStore:b},a)},"getContacts")};g.getContactsFromGroupJid=a}),98);
__d("WAPreEstablishOutgoingSessionForGroup",["Promise","WACryptoManagerUtils","WAGetContactsFromGroupJid","WAGlobals","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PreEstablishOutgoingSession] The thread doesn't exist"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-existed thread: ",""]);i=function(){return a};return a}c=10;var j=new Set();function k(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!j.has(a)){f.next=2;break}return f.abrupt("return",b("Promise").resolve(d("WAResultOrError").makeResult()));case 2:f.next=4;return b("regeneratorRuntime").awrap(d("WAGetContactsFromGroupJid").getContactsFromGroupJid(a));case 4:c=f.sent;if(c.success){f.next=9;break}d("WALogger").WARN(i(),a);d("WALogger").ERROR(h());return f.abrupt("return",d("WAResultOrError").makeError(c.error));case 9:e=c.value.map(function(a){return a.identities.map(function(a){return a.device})}).flat();f.next=12;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").bulkPreEstablishOutgoingSession(e));case 12:j.add(a);return f.abrupt("return",d("WAResultOrError").makeResult());case 14:case"end":return f.stop()}},null,this)}function a(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:if(d("WAGlobals").getConfig().isPreEstablishSessionEnabled()){c.next=2;break}return c.abrupt("return",b("Promise").resolve());case 2:c.next=4;return b("regeneratorRuntime").awrap(k(a));case 4:case"end":return c.stop()}},null,this)}g.PRE_ESTABLISH_GROUP_PARTICIPANT_THRESHOLD=c;g.preEstablishOutgoingSession=k;g.maybePreEstablishOutgoingSession=a}),98);
__d("WAJobRequirement",["Promise","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["JobRequirement[","] blocker errored ",""]);h=function(){return a};return a}c=function(){function a(a){var c=this;this.$1=b("Promise").resolve();this.$2=!0;this.$3=null;this.$4=function(){var a=c.$3;if(a!=null){c.$3=null;return b("Promise").all(a).then(c.$4)}c.$2=!0};this.name=a}var c=a.prototype;c.addBlocker=function(a){var c=this;a=a["catch"](function(a){d("WALogger").ERROR(h(),c.name,a).sendLogs("job-blocker-rejected")});if(this.$2)this.$2=!1,this.$1=b("Promise").all([this.$1,a]).then(this.$4);else{var e=this.$3;e!=null?e.push(a):this.$3=[a]}};c.waitUntilSatisfied=function(){return this.$1};c.isSatisfied=function(){return this.$2};c.isSatisfiable=function(){return!0};return a}();e=function(a){babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;a.prototype.addBlocker.call(babelHelpers.assertThisInitialized(c),new(b("Promise"))(function(){}));return c}var d=c.prototype;d.addBlocker=function(){};d.isSatisfiable=function(){return!1};return c}(c);function a(a,c){var d=a.filter(function(a){return!a.isSatisfiable()});if(d.length>0){var e=d.map(function(a){return a.name});return function(a){c==null?void 0:c("unsatisfiable",e,a);return d[0].waitUntilSatisfied()}}var f=a.map(function(){return b("Promise").resolve()}),g=b("Promise").resolve(),h=null,i=function c(){if(f.every(function(b,c){return b===a[c].waitUntilSatisfied()})){h=null;return}var d=[],e=a.map(function(a){var b=a.waitUntilSatisfied();a.isSatisfied()||(d.push(a.name),b.then(function(){var b=d.indexOf(a.name);d.splice(b,1)}));return b});f=e;h=d;return b("Promise").all(e).then(c)};return function(a){if(h==null){var b=i();b!=null&&(g=g.then(function(){return b}))}c==null?void 0:c(h==null?"satisfied":"unsatisfied",h,a);return g}}g.JobRequirement=c;g.UnsatisfiableJobRequirement=e;g.joinRequirements=a}),98);
__d("WAPersistedJobManager",["Promise","WAJobRequirement","WALogger","WAPromiseBackoffs","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["waitUntilCompletedNonPersisted not implemented in PersistedJobManager"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["fireAndForgetNonPersisted not implemented in PersistedJobManager"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"]);r=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""]);a=function(){return b};return b}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running step"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["No entry for job ",""]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": restarting"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"]);I=function(){return a};return a}var J=1,K=function(){function a(a){this.feature=a}var b=a.prototype;b.toString=function(){return"RequiresPage: "+this.feature};return a}(),L=function(){function a(a){this.backoffOptions=a}var b=a.prototype;b.toString=function(){return"RetryOnBackoff"};return a}(),M=function(a){this.result=a},N="$unstarted",O="$finished";c=function(){function a(a){var c=this,e=a.isRestartAfterCrash,f=a.accessors,g=a.unfinishedJobEntries,h=new Map();g=g.then(function(a){var g=[],i=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?g.push(a):i.push(a)});return b("Promise").all(g.map(function(a){d("WALogger").ERROR(I(),Q(a),a.step).devConsole(P(a)).sendLogs("job-stuck-"+a.type);return f.deletePersistedJob(a.jobId)})).then(function(){i.forEach(function(a){if(h.has(a.jobId))return;d("WALogger").LOG(H(),P(a));h.set(a.jobId,c.$1(a,e))})})});this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=f;this.activeJobs=h;this.initialJobsPromise=g;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs}var c=a.prototype;c.loadAndRunJobFromId=function(a){var b=this.activeJobs.get(a);if(b!=null)return b;b=this.$2(a);this.activeJobs.set(a,b);return b};c.$2=function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=this.initialJobsPromise,e=this.accessors;g.next=3;return b("regeneratorRuntime").awrap(c);case 3:g.next=5;return b("regeneratorRuntime").awrap(e.readPersistedJob(a));case 5:f=g.sent;if(f){g.next=10;break}d("WALogger").DEV(G(),a);d("WALogger").WARN(F());return g.abrupt("return",null);case 10:return g.abrupt("return",this.$1(f,!1));case 11:case"end":return g.stop()}},null,this)};c.$3=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};c.$4=function(a,c){if(c==null||c.length===0)return b("Promise").resolve();var e=this.stepBlockers,f=e.get(c);f==null&&(f=d("WAJobRequirement").joinRequirements(c.map(function(a){return a()}),S),e.set(c,f));return f(a)};c.$5=function(a,b,c,e){var f=this;c===void 0&&(c=!1);var g=a.step,h=b.findIndex(function(a){return a.stepName===g}),i=b[h].info(a.current,a.original,T(a,c)),j=i.requirements,k=i.code;i=this.$4(a,j);e&&(i=i.then(e));return i.then(function(){d("WALogger").LOG(E(),R(a));return k(a.current,a.original,T(a,c))}).then(function(e){if(e instanceof M){d("WALogger").LOG(D(),R(a));return e.result}var g=h+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return f.accessors.updatePersistedJob(a).then(function(){return f.$5(a,b,c)})})};c.$1=function(a,c){var e,f=this,g,h,i,j,k,l,m,D,E,F,G,H,I,M,Q,S;return b("regeneratorRuntime").async(function(U){while(1)switch(U.prev=U.next){case 0:g=this.accessors,h=this.activeJobs,i=this.deprecatedJobs,j=this.listeners,k=j.onJobFinished,l=j.onJobStarted;U.next=3;return b("regeneratorRuntime").awrap(this.$3(a.type));case 3:m=U.sent;D=i[a.type];if(m){U.next=21;break}if(D){U.next=13;break}d("WALogger").ERROR(C(),a.type).sendLogs("missing-job-implementation");U.next=10;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 10:return U.abrupt("return",null);case 13:if(!(D==="NOOP")){U.next=18;break}d("WALogger").WARN(B(),a.type);U.next=17;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 17:return U.abrupt("return",null);case 18:U.next=20;return b("regeneratorRuntime").awrap(D());case 20:m=U.sent;case 21:E=m;D&&d("WALogger").LOG(A(),a.type);F=(e=a.stepFirstStartTime)!=null?e:d("WATimeUtils").unixTime();a.stepFirstStartTime=F;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(!(a.step===O)){U.next=44;break}G=a.waitUntil;H=d("WATimeUtils").secondsUntil(F);if(!(G!=null&&d("WATimeUtils").isInFuture(G)&&H>0)){U.next=38;break}d("WALogger").LOG(z(),P(a));G=d("WATimeUtils").castToUnixTime(G-H);if(!d("WATimeUtils").isInFuture(G)){U.next=38;break}a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(F-H);a.waitUntil=G;U.next=38;return b("regeneratorRuntime").awrap(this.accessors.updatePersistedJob(a));case 38:if(!(G==null||!d("WATimeUtils").isInFuture(G))){U.next=42;break}d("WALogger").LOG(y(),P(a));U.next=42;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 42:h["delete"](a.jobId);return U.abrupt("return",a.current);case 44:I=a.step!==N?m.find(function(b){return b.stepName===a.step}):m[0];if(I){U.next=50;break}d("WALogger").ERROR(x(),a.type,a.step).sendLogs("missing-job-step");U.next=49;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 49:return U.abrupt("return",null);case 50:a.step=I.stepName;M=function e(){var g=a.waitUntil,h=b("Promise").resolve();if(g!=null){var i=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);g>i?(d("WALogger").LOG(w(),R(a),g,i),a.waitUntil=i,h=f.accessors.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(i)})):(d("WALogger").LOG(v(),R(a),g),h=d("WATimeUtils").delayUntil(g))}return h.then(function(){var g=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(F,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return f.accessors.updatePersistedJob(a)};return f.$5(a,E,c,g)["catch"](function(c){if(c instanceof K){d("WALogger").LOG(u(),R(a));a.stepHardStartCountAfterTimeout>0&&(--a.stepHardStartCountAfterTimeout,f.accessors.updatePersistedJob(a));return new(b("Promise"))(function(){})}else if(c instanceof L){d("WALogger").LOG(t(),R(a));var g=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,c.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(g/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return f.accessors.updatePersistedJob(a).then(e)}else if(a.stepUnexpectedErrorCount<J){d("WALogger").WARN(s(),R(a),a.stepUnexpectedErrorCount);a.stepUnexpectedErrorCount++;return f.accessors.updatePersistedJob(a).then(e)}throw c})})};Q=M();S=Q.then(function(c){var e;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:d("WALogger").LOG(r(),R(a));e=null;try{e=k(a.jobId,a.type,a.original,c)}catch(b){d("WALogger").ERROR(q(),a.type,b).sendLogs("onJobFinished-threw")}if(!(e!=null&&e>0)){i.next=12;break}a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(e/1e3));a.step=O;a.current=c;a.stepFirstStartTime=d("WATimeUtils").unixTime();i.next=10;return b("regeneratorRuntime").awrap(f.accessors.updatePersistedJob(a));case 10:i.next=15;break;case 12:i.next=14;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 14:h["delete"](a.jobId);case 15:case"end":return i.stop()}},null,this)},function(e){var f,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:d("WALogger").ERROR(p(),a.type,e).sendLogs("job-threw-exception-"+a.type);f=E.find(function(b){return b.stepName===a.step});if(f){j.next=6;break}d("WALogger").ERROR(o(),a.type,a.step);j.next=10;break;case 6:i=f.info(a.current,a.original,T(a,c));if(!(i.stopRetryIf!=null)){j.next=10;break}j.next=10;return b("regeneratorRuntime").awrap(i.stopRetryIf.onStopRetry(a.current,a.original,T(a,c)));case 10:j.next=12;return b("regeneratorRuntime").awrap(g.deletePersistedJob(a.jobId));case 12:h["delete"](a.jobId);case 13:case"end":return j.stop()}},null,this)});try{l(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(n(),a.type,b).sendLogs("onJobStarted-threw")}return U.abrupt("return",S.then(function(){return Q}));case 56:case"end":return U.stop()}},null,this)};c.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(m(),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(l(),a);c.set(a,b)};c.fireAndForget=function(a){var b=this;this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.waitUntilPersisted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;b.loadAndRunJobFromId(a)})};c.waitUntilCompleted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.fireAndForgetNonPersisted=function(a){d("WALogger").LOG(k())};c.waitUntilCompletedNonPersisted=function(a){return b("Promise").resolve(function(){return d("WALogger").LOG(j())})};return a}();function P(a){return"Job["+a.jobId+"] ("+a.type+")"}function Q(a){return"[Job "+a.type+"] "}function R(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function S(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(i(),R(c),b):a==="unsatisfied"?d("WALogger").LOG(h(),R(c),b):a}function T(a,b){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:U}}function U(a){return new M(a)}g.RequiresPage=K;g.RetryOnBackoff=L;g.InterruptJob=M;g.UNSTARTED_JOB=N;g.FINISHED_JOB=O;g.PersistedJobManager=c}),98);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","400");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","404");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound"],[b,c])}g.parseIQErrorBadRequestOrItemNotFoundMixinGroup=a}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:b.value})}g.parseNonRetryableRemoveDeviceIQErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","500");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","503");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c])}g.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"backoff",0,86400);if(!b.success)return b;a=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({backoff:b.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:a.value})}g.parseRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[b,c])}g.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:b.value}))}g.parseRemoveResponseError=a}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRemoveResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.removeId;a=a.identityKeyMixinArgs;b=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxJsx").smax("remove",{id:d("WAWap").INT(b)}),a)));return b}g.makeRemoveRequest=a}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"RemoveResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"RemoveResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendRemoveRPC=a}),98);
__d("WARemoveDevice",["WAJobs","WALogger","WAPersistedJobManager","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice called for device "," and identity ",""]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("removeDevice",function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.deviceId,d=a.identity;f.next=3;return b("regeneratorRuntime").awrap(j(c,d));case 3:e=f.sent;return f.abrupt("return",e.success===!0);case 5:case"end":return f.stop()}},null,this)}).end();function j(a,c){var e,f,g,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:d("WALogger").DEV(i(),a,c);e=d("WASignalOther").sliceBytes(c,1,32);k.next=4;return b("regeneratorRuntime").awrap(d("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:a,identityKeyMixinArgs:{anyElementValue:e}}));case 4:f=k.sent;d("WALogger").LOG(h(),a,f);if(!(f.name==="RemoveResponseSuccess")){k.next=10;break}return k.abrupt("return",d("WAResultOrError").makeResult());case 10:f.name;g=f.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(!(g.name!=="RetryableIQError")){k.next=14;break}return k.abrupt("return",d("WAResultOrError").makeError());case 14:g.name;j=g.value.backoff;if(!(j!=null)){k.next=20;break}throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:j},jitter:0});case 20:throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1});case 21:case"end":return k.stop()}},null,this)}g.removeDeviceJob=a;g.removeDevice=j}),98);
__d("WASendSenderKeyDistributionMsg",["Promise","WAExternalIdFromRandomHex","WAGlobals","WAHex","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WAMsgType","WAPreEstablishOutgoingSessionForGroup","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();function i(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:if(!h.has(a)){f.next=2;break}return f.abrupt("return",b("Promise").resolve(d("WAResultOrError").makeResult()));case 2:d("WAGlobals").getDbImpls().writeDebugMsg(a,"Sending key distribution msg");f.next=5;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().writeOutgoingMsg(c,a,d("WATimeUtils").unixTime(),{},d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION));case 5:e=f.sent;if(!(e.type==="already_sent")){f.next=10;break}return f.abrupt("return",d("WAResultOrError").makeError("already_sent"));case 10:if(!(e.type==="missing_thread")){f.next=12;break}return f.abrupt("return",d("WAResultOrError").makeError("missing_thread"));case 12:f.next=14;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.sendWrittenMsg(e.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 14:h.add(a);return f.abrupt("return",d("WAResultOrError").makeResult());case 16:case"end":return f.stop()}},null,this)}function a(a,c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(!d("WAGlobals").getConfig().isSenderKeyPredistributionEnabled()||c<d("WAPreEstablishOutgoingSessionForGroup").PRE_ESTABLISH_GROUP_PARTICIPANT_THRESHOLD)){e.next=2;break}return e.abrupt("return",b("Promise").resolve());case 2:e.next=4;return b("regeneratorRuntime").awrap(d("WAPreEstablishOutgoingSessionForGroup").preEstablishOutgoingSession(a));case 4:e.next=6;return b("regeneratorRuntime").awrap(i(a,d("WAExternalIdFromRandomHex").externalIdFromRandomHex(d("WAHex").randomHex(7))));case 6:case"end":return e.stop()}},null,this)}g.sendSenderKeyDistributionMsg=i;g.maybePreEstablishSessionsAndSendSenderKeyDistributionMsg=a}),98);
__d("MAWDebug",["MAWAbProps","MAWBridge","MAWCompareIdentity","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbCollectionVersionsTxns","MAWDbContactsTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbIdentityTxns","MAWDbMediaTxns","MAWDbMetaTxns","MAWDbMissingKeysTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingMutationsTxns","MAWDbPendingReceiptTxns","MAWDbPersonalSenderKeyStatusTxns","MAWDbPrekeyTxns","MAWDbReactionsTxns","MAWDbReceiptTxns","MAWDbSenderKeySessionTxns","MAWDbSessionTxns","MAWDbSignedPrekeyTxns","MAWDbSyncActionsTxns","MAWDbSyncKeysTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugHydrateOfflineQueue","MAWEncryptedBackupCacheManager","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWGetContactAndIdentitiesApi","MAWGlobals","MAWHandleEchoMsgsRestoreApi","MAWIndexedDb","MAWJids","MAWJobDefinitions","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainV2","MAWMediaUtils","MAWRotateCAT","MAWSetEphemeralSettingsFromFrontendApi","MAWTransactionMode","MAWUpdateDevicesForUserApi","Promise","WAArmadilloXMA.pb","WAArrayBufferUtils","WAGlobals","WAGzip","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAPreEstablishOutgoingSessionForGroup","WARemoveDevice","WASendSenderKeyDistributionMsg","WASignalOther","WATimeUtils","err","gkx","regeneratorRuntime","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["CAT was successfully updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New Cat: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Old Cat: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}var l={addCollectionVersion:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({collectionVersions:d("MAWTransactionMode").READWRITE})(d("MAWDbCollectionVersionsTxns").addCollectionVersion)(a))},addDeviceChangeAlerts:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b))},addPendingMutation:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({pendingMutations:d("MAWTransactionMode").READWRITE})(d("MAWDbPendingMutationsTxns").addPendingMutation)(a))},addSyncKey:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncKeys:d("MAWTransactionMode").READWRITE})(d("MAWDbSyncKeysTxns").addSyncKey)(a))},clearICDCInfo:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=void 0;a.icdcFails=void 0;a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())},compareIdentity:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY})(d("MAWCompareIdentity").compareIdentity)())},createGroup:function(a,b,c){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.createGroup(a,b,c))},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,offlineThreadingId:null})},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},decryptEARTweetNaCl:function(a,b){return d("MAWKeychainNaClCrypto").decryptTweetNaCl(a,b)},decryptWithKeyVersion:function(a,b){var e=d("MAWKeychainV2").getEARKeychainForDebugging();e=e.databaseEncryptionKeys.get(a);if(e==null)throw c("err")("Key does not exist in Debug");return d("MAWKeychainNaClCrypto").decrypt(e,b,a)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvite:function(a,b){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvite)(a,b))},deleteGroupInvitesByParticipantId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByInvitedParticipantId)(a))},deleteGroups:function(a){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.deleteGroups(a))},demoteGroupParticipants:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},establishOutgoingSession:function(a){return d("WAPreEstablishOutgoingSessionForGroup").preEstablishOutgoingSession(a)},executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return d("MAWIndexedDb").makeMsgrTransactor(b)(a)()},forwardMsg:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.forwardMsg(a,b))},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},generateAndUploadPreKeys:function(){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}))},generateAndUploadPreKeysMultipleCalls:function(){d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}));d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}));return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}))},generateEncryptionKeys:function(){return d("MAWKeychainV2").setupEARKeychain().then(function(a){return d("MAWKeychainV2").getAllDatabaseEncryptionKeys()})},getAbProp:function(a){return d("MAWAbProps").getAbProp(a)},getAbProps:function(){return d("MAWAbProps").getAbProps()},getAllCollectionVersions:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({collectionVersions:d("MAWTransactionMode").READONLY})(d("MAWDbCollectionVersionsTxns").getAllCollectionVersions)())},getAllMissingKeys:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({missingKeys:d("MAWTransactionMode").READONLY})(d("MAWDbMissingKeysTxns").getAllMissingKeys)())},getAllPendingMutations:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({pendingMutations:d("MAWTransactionMode").READONLY})(d("MAWDbPendingMutationsTxns").getAllPendingMutations)())},getAllSyncKeys:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({syncKeys:d("MAWTransactionMode").READONLY})(d("MAWDbSyncKeysTxns").getAllSyncKeys)())},getAppDatas:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getCollectionVersionByCollection:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({collectionVersions:d("MAWTransactionMode").READONLY})(d("MAWDbCollectionVersionsTxns").getCollectionVersionByCollection)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWGlobals").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getContacts:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY})(d("MAWDbContactsTxns").getContacts)(a))},getCurrentUserDeviceList:function(){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.getCurrentUserDeviceList({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}))},getCurrentUserDeviceListNonPersisted:function(){return d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.getCurrentUserDeviceList({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}))},getDeviceChangeAlerts:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.getDevices(new Set(a),"debug",b,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}))},getEAREncryptKeyVersion:function(a){return d("MAWKeychainCrypto").getKeyVersionFromCipherDataString(a)},getEARKeychain:function(){return d("MAWKeychainV2").getEARKeychainForDebugging()},getEBRestoreCache:function(){return d("MAWEncryptedBackupCacheManager").restoredCache},getGroupInfosByGroupJid:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByParticipantId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByInvitedParticipantId)(a))},getHmacKeyFromGlobals:function(){return d("MAWGlobals").getHMACKey()},getIdentityByDeviceJid:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY})(d("MAWDbIdentityTxns").bulkGetIdentityRows)(a))},getMediaBackupForObjectId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));case 2:c=e.sent;c.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return e.abrupt("return",m(b("Promise").resolve(c)));case 5:case"end":return e.stop()}},null,this)},getMediaByMediaId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMeta:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READONLY})(d("MAWDbMetaTxns").getAllMeta)())},getMsgsByMsgId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getParticipantsByParticipantId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingMutationByCollection:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({pendingMutations:d("MAWTransactionMode").READONLY})(d("MAWDbPendingMutationsTxns").getPendingMutationsByCollection)(a))},getPendingReceipts:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("MAWDbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPrekeyByPrekeyId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({prekey:d("MAWTransactionMode").READONLY})(d("MAWDbPrekeyTxns").getPrekeys)(a))},getPrekeyGenerationByGenerationId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({prekey:d("MAWTransactionMode").READONLY})(d("MAWDbPrekeyTxns").getPrekeyGenerations)(a))},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToMsgId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY})(d("MAWDbReactionsTxns").getReactionsFromMessages)(a))},getReceiptsByMsgId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({receipts:d("MAWTransactionMode").READONLY})(d("MAWDbReceiptTxns").getReceipts)(a))},getSenderKeySessionsBySenderKeySessionId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({senderKeySessions:d("MAWTransactionMode").READWRITE})(d("MAWDbSenderKeySessionTxns").getSenderKeySessionsBySenderKeySessionId)(a))},getSessionsByDeviceJid:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({session:d("MAWTransactionMode").READONLY})(d("MAWDbSessionTxns").bulkGetSessions)(a))},getSignedPrekesByPrekeyId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({signedPrekey:d("MAWTransactionMode").READONLY})(d("MAWDbSignedPrekeyTxns").getSignedPrekeys)(a))},getSyncActionBySyncActionIndex:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncActions:d("MAWTransactionMode").READONLY})(d("MAWDbSyncActionsTxns").getSyncActionBySyncActionIndex)(a))},getSyncActionBySyncActionStates:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncActions:d("MAWTransactionMode").READONLY})(d("MAWDbSyncActionsTxns").getSyncActionsByActionStates)(a))},getSyncActionsByCollections:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncActions:d("MAWTransactionMode").READONLY})(d("MAWDbSyncActionsTxns").getSyncActionsByCollections)(a))},getSyncKeyBySyncKeyId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncKeys:d("MAWTransactionMode").READONLY})(d("MAWDbSyncKeysTxns").getSyncKeyBySyncKeyId)(a))},getThreadsByChatId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},handleEchoMsgsRestore:function(a,b,c){return m(d("MAWHandleEchoMsgsRestoreApi").handleEchoMsgsRestore(a,b,c))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").debugHydrateOfflineQueue,inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},makeError:function(a){throw c("unrecoverableViolation")(a,"messenger_e2ee_web",{error:c("err")(a)})},makeWAError:function(a){d("WALogger").ERROR(k(),a)},markThreadAsRead:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,b,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},notifyDeviceChange:function(a){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.notifyDeviceChange(a))},overrideAbProp:function(a,b){d("MAWAbProps").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},putGroupInvite:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putMissingKey:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({missingKeys:d("MAWTransactionMode").READWRITE})(d("MAWDbMissingKeysTxns").putMissingKey)(a))},putNewPersonalSenderKeyStatus:function(a){return d("MAWIndexedDb").makeMsgrTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("MAWDbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},putSyncAction:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({syncActions:d("MAWTransactionMode").READWRITE})(d("MAWDbSyncActionsTxns").putSyncAction)(a))},queryAllGroups:function(){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.queryGroups())},removeDevice:function(a,b){return d("WARemoveDevice").removeDevice(a,b)},removeGroupParticipants:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,["harassment"],"fake debug context"))},requestAllSyncdMissingKeys:function(){return d("MAWGlobals").getJobManager().fireAndForgetNonPersisted(d("MAWJobDefinitions").jobSerializers.requestAllSyncdMissingKeys())},requestPreKeyDigest:function(){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.requestPreKeyDigest())},resetSyncd:function(){return d("MAWGlobals").getDbImpls().handleSyncdFatal({fromServer:!1})},restoreMessagesFromEncryptedBackups:function(a,b,c,e,f,g,h,i,j){return m(d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,c,e,f,g,h,i,j)))},restoreThreadsFromEncryptedBackups:function(a,b){return m(d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreThreadsFromEncryptedBackups(a,b)))},revokeMsg:function(a){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs([a]))},rotateCryptoAuthToken:function(){var a=d("WAArrayBufferUtils").arrayBufferToString(d("MAWGlobals").getFbCat());d("WALogger").LOG(j(),a);return d("MAWRotateCAT").tryRotateCAT().then(function(){var b=d("WAArrayBufferUtils").arrayBufferToString(d("MAWGlobals").getFbCat());d("WALogger").LOG(i(),b);a!==b&&d("WALogger").LOG(h())})},rotateSignedPreKey:function(){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.rotateSignedPreKey())},sendAppData:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceIds:b}))},sendEphemeralSettingMsg:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a,b))},sendInvisibleMsg:function(a){return d("WASendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId())},sendInvisibleMsgToAllExistingGroups:function(){var a,c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})());case 2:a=j.sent,c=[],(e=a,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 5:if(!f){j.next=11;break}if(!(g>=e.length)){j.next=8;break}return j.abrupt("break",19);case 8:h=e[g++];j.next=15;break;case 11:g=e.next();if(!g.done){j.next=14;break}return j.abrupt("break",19);case 14:h=g.value;case 15:i=h,c.push(d("WASendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(i.groupJid,d("MAWExternalId").generateExternalId()));case 17:j.next=5;break;case 19:return j.abrupt("return",c);case 20:case"end":return j.stop()}},null,this)},sendMessageTooAllExistingGroups:function(){var a,c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})());case 2:a=j.sent,c=[],(e=a,f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 5:if(!f){j.next=11;break}if(!(g>=e.length)){j.next=8;break}return j.abrupt("break",19);case 8:h=e[g++];j.next=15;break;case 11:g=e.next();if(!g.done){j.next=14;break}return j.abrupt("break",19);case 14:h=g.value;case 15:i=h,c.push(l.sendMsg(i.groupJid,{content:"message to "+i.groupJid+" at "+new Date().getTime()}));case 17:j.next=5;break;case 19:return j.abrupt("return",c);case 20:case"end":return j.stop()}},null,this)},sendMsg:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,b))},sendReaction:function(a,b,c,e){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))},sendXMAShareMsg:function(a,b,c,e){var f=new File(["Hello"],"aaa",{type:"image/jpeg"});return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendXMAShareMsg(a,{file:f,height:0,width:0},void 0,void 0,(a=c)!=null?a:"hey",babelHelpers["extends"]({},b,{xmaMessageType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY}),void 0,void 0,e))},setEphemeralSettingsFromFrontend:function(a,b){return m(d("MAWSetEphemeralSettingsFromFrontendApi").setEphemeralSettingsFromFrontend({ephemeralExpirationInSec:b,threadId:a}))},setEphemeralSettingWithoutUpdate:function(a,b,c){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return m(d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c))},setGroupSubject:function(a,b){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setICDCData:function(a,c){var e,f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("MAWGetContactAndIdentitiesApi").getContactAndIdentitiesForUser(a));case 2:e=l.sent;if(e.success){l.next=7;break}return l.abrupt("return","generateICDCInfo failed with error "+e.error);case 7:if(!(e.value==null)){l.next=9;break}return l.abrupt("return","Could not find contact info");case 9:f=e.value.contact;g=f.icdcInfo;if(!(g==null)){l.next=13;break}return l.abrupt("return","Could not find contact ICDC info");case 13:h=g.sequence;c.sequenceInc!=null&&(h=g.sequence+c.sequenceInc);i=d("MAWJids").interpretAsDeviceId(999);j=f.devices.map(d("WAJids").extractDeviceId);if(!(c.additionDevices==="inject")){l.next=26;break}j.push(i);k=d("WASignalOther").makeBytes(33);k[0]=5;e.value.identities.push({deviceJid:d("MAWJids").toDeviceJid(a,i),identity:k});l.next=24;return b("regeneratorRuntime").awrap(d("MAWUpdateDevicesForUserApi").updateDevicesForUser(a,e.value.identities.map(function(a){var b=a.deviceJid;a=a.identity;return{id:b,identity:a}})));case 24:l.next=30;break;case 26:if(!(c.additionDevices==="clear")){l.next=30;break}j=j.filter(function(a){return a!==i});l.next=30;return b("regeneratorRuntime").awrap(d("MAWUpdateDevicesForUserApi").updateDevicesForUser(a,e.value.identities.filter(function(b){return b.deviceJid!==d("MAWJids").toDeviceJid(a,i)}).map(function(a){var b=a.deviceJid;a=a.identity;return{id:b,identity:a}})));case 30:return l.abrupt("return",m(d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.devices=j.map(function(a){return d("MAWJids").toDeviceJid(d("WAGlobals").getMyUserJid(),a)});a.icdcInfo=babelHelpers["extends"]({},g,{sequence:h});c.resetICDCError===!0&&(a.icdcFails=void 0);a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})()));case 31:case"end":return l.stop()}},null,this)},syncAbProps:function(a){a=a!==!0;return d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.syncAbProps(a))},syncdSyncAllCollections:function(){return d("MAWGlobals").getJobManager().fireAndForgetNonPersisted(d("MAWJobDefinitions").jobSerializers.syncdSyncAllCollections())},updateDeviceChangeAlerts:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return m(d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},uploadMedia:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",a)},uploadRetroactiveThreadsAndMessages:function(){return m(d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages()))}};function m(a){return a.then(function(a){return a})}c("gkx")("5168")&&(self.Debug=l);g.MAWDebugFuncs=l}),98);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugSendReaction",["MAWGlobals","MAWJobDefinitions","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADevToolsDebugFns").defineDebugFunction("sendReaction",{desc:"Sends reaction to a message",serializedArgs:[{name:"chatJid",type:"string",placeholder:"ChatJid",desc:"ChatJid of the thread containing the message to react to"},{name:"reactTo",type:"object",placeholder:"ProtocolMsgId",desc:"ProtocolMsgId of the message to react to"},{name:"author",type:"string",placeholder:"FBID",desc:"FBID of the author of the message to react to"},{name:"reaction",type:"string",placeholder:"\ud83d\ude00",desc:"Reaction emoji to use"}],execute:function(a,b,c,e){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,e))}});g.sendReaction=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugSendReaction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{sendReaction:d("MAWDebugSendReaction").sendReaction})}g.getAllDebugFunctions=a}),98);
__d("MAWDbDyiBatch",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.numberToBatchId=a}),66);
__d("MAWDyiBatchRestoreDataSync",["MAWBridgeTypes","MAWDataSyncQueue","MAWDbDyiBatch","MAWDexieTable","MAWGating","MAWIndexedDb","MAWQplProxy","MAWTransactionMode","Promise","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] User is not eligible to use DYI"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No message batch entry corresponding to batch id ",""]);i=function(){return a};return a}var j=100;function k(a,b){a={tag:"RestoreMessageBatch",value:d("MAWBridgeTypes").createBridgeRestoreMessageBatch(j,a,b,0)};d("MAWIndexedDb").afterTransaction(a)}function l(a,b){if(b.length>0){b.forEach(function(a){a=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521478596,"1329"),{string:{threadId:a}});a.addPoint("dyi_backup_restore_success");a.endSuccess()});var e=new Set(b);return a.dyiBatch.filter(function(a){return a.isThread&&e.has(a.threadId)}).toArray().then(function(b){return a.dyiBatch.bulkDelete(b.filter(Boolean).map(function(a){return a.batchId})).then(function(){return a.dyiBatch.count().then(function(a){a===0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateDyiStatus",value:d("MAWBridgeTypes").createBridgeUpdateDyiStatus(!0)})})})})}}var m=d("MAWIndexedDb").makeMsgrTransactor({dyiBatch:d("MAWTransactionMode").READWRITE})(function(a,b){var e=[];b.forEach(function(a){a=a.value.key;if(typeof a==="number"){a=a;e.push(d("MAWDbDyiBatch").numberToBatchId(a))}});return a.dyiBatch.bulkGet(e).then(function(b){var f=new Map(),g=[];e.map(function(a,c){b[c]!=null&&!b[c].isThread?f.set(a,b[c]):b[c]==null&&g.push(a)});if(g.length>0){g.forEach(function(a){d("WALogger").ERROR(i(),a)});d("MAWIndexedDb").afterTransaction({tag:"UpdateDyiStatus",value:d("MAWBridgeTypes").createBridgeUpdateDyiStatus(!1)});a.dyiBatch.each(function(a){a=a.threadId;a=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521478596,"1329"),{string:{threadJid:a}});a.endFail("dyi_backup_restore_error")});return a.dyiBatch.clear()}var h=[],j=[],m=[];f.forEach(function(a,b){h.push(b),a.numMessages<=1?j.push(a.threadId):m.push(a)});m.forEach(function(a){return k(a.threadId,a.oldestTs)});return d("MAWDexieTable").dexieAll([a.dyiBatch.bulkDelete(h),l(a,j)])})}),n=function(a){a=a.filter(function(a){return a.value.tableName==="dyiBatch"&&a.type!=="delete"&&a.type!=="deleteRange"});return a.length>0?m(a).then(function(a){return b("Promise").resolve()}):b("Promise").resolve()};a=function(){if(!d("MAWGating").isDyiEnabled()){d("WALogger").WARN(h());return}d("MAWDataSyncQueue").registerDataSyncCallback(n)};g.restoreMessagesForThread=k;g.initDyiBatchUpload=a}),98);
__d("MAWBridgeSearchMsg",["MAWDbMsg","MAWVault","WAAssertUnreachable","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={chatId:a.thread,msgId:a.msgId,rowId:a.rowId,ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)};switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{content:d("MAWVault").isVaulted(a.msgContent.content)?a.msgContent.content:d("MAWVault").vault(a.msgContent.content)});case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.PTT:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.STICKER:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.XMA:return b;default:return c("WAAssertUnreachable")(a.type)}}g.createBridgeSearchMsg=a}),98);
__d("MAWFTSDataSync",["FBLogger","MAWBridgeParticipants","MAWBridgeSearchMsg","MAWBridgeTypes","MAWDataSyncQueue","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWTransactionMode","MAWVault","Promise","WALogger","WAMsgType","gkx","minisearch","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error fetching participants ",""]);h=function(){return a};return a}var i=1e4,j=new(c("minisearch"))({fields:["content"],searchOptions:{fuzzy:.2,prefix:!0}}),k=new Set(["contacts","groupInfo","messages","participants"]),l=new Map(),m=d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY,ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY});function n(a,b){return a+":"+b}function o(a,b){b.forEach(function(b){b=n(a,b);var c=l.get(b);c&&(j.remove(c),l["delete"](b))})}function p(a){var b=l.get(a.id);b!=null&&(j.remove(b),l["delete"](a.id));l.set(a.id,a);j.add(a)}var q=c("gkx")("4164");function r(a){if(a==null)return;var b=a.name;if(b==null)return;b={content:b,id:n("groupInfo",a.groupJid),raw:a,type:"DbGroupInfo"};p(b)}function s(a,b){var c;if(a==null)return;c=(c=a.nickname)!=null?c:b==null?void 0:b.nameForSearch;if(c==null||a.userJid===d("MAWGlobals").getMyUserJid())return;c={content:c,id:n("participants",a.id),raw:a,type:"DbParticipant"};p(c);u(b)}function t(a){if(a==null)return;switch(a.type){case d("WAMsgType").TEXT:a={content:d("MAWVault").unvault(a.msgContent.content),id:n("messages",a.rowId),raw:a,type:"DbMsg"};p(a);return;default:return}}function u(a){if(a==null||a.nameForSearch==null)return;var b=a.nameForSearch;b={content:b,id:n("contacts",a.contactJid),raw:a,type:"DbContact"};p(b)}var v=function(a,b){return b.filter(function(b){return b.value.tableName===a}).map(function(a){return a.value.key})},w=m(function(a,b){var c=v("contacts",b),e=v("groupInfo",b),f=v("messages",b),g=v("participants",b);return d("MAWDexieTable").dexieAll([q===!0?void 0:a.contacts.bulkGet(c).then(function(a){o("contacts",c),a.forEach(u)}),a.groupInfo.bulkGet(e).then(function(a){o("groupInfo",e),a.forEach(r)}),a.messages.bulkGet(f).then(function(a){o("messages",f),a.forEach(t)}),a.participants.bulkGet(g).then(function(b){var c=b.reduce(function(a,b){return(b==null?void 0:b.userJid)==null?a:a.set(b.userJid,b)},new Map());return a.contacts.bulkGet(Array.from(c.keys())).then(function(a){o("participants",g);var c=a.reduce(function(a,b){b!=null&&a.set(b==null?void 0:b.contactJid,b);return a},new Map());b.forEach(function(a){var b=(a==null?void 0:a.userJid)!=null?c.get(a==null?void 0:a.userJid):void 0;s(a,b)})})})].filter(Boolean))}),x=m(function(a,b){b=b.filter(function(a){return a.value.tableName==="messages"&&(a.type==="put"||a.type==="add")&&a.value.values!=null});b=b.flatMap(function(a){return a.value.values}).map(function(a){if(typeof a!=="object")return;a=a==null?void 0:a.rowId;if(a==null||typeof a!=="number")return;return{rowId:a}}).filter(Boolean);return a.ftsBackloggedMessages.bulkPut(b)}),y=m(function(a,b){b=b.filter(function(a){return a.value.tableName==="messages"&&a.type==="delete"});return a.ftsBackloggedMessages.bulkDelete(b.map(function(a){return typeof a.value.key==="number"?a.value.key:void 0}).filter(Boolean))}),z=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:c=a.filter(function(a){a=a.value;return k.has(a.tableName)});d.next=3;return b("regeneratorRuntime").awrap(w(c));case 3:d.next=5;return b("regeneratorRuntime").awrap(y(c));case 5:d.next=7;return b("regeneratorRuntime").awrap(x(c));case 7:case"end":return d.stop()}},null,this)},A=m(function(a){var b=[a.groupInfo.toCollection().reverse().each(r),a.messages.toCollection().reverse().limit(i).each(t),a.participants.toCollection().each(function(b){if(b==null)return;a.contacts.get(b==null?void 0:b.userJid).then(function(a){return s(b,a)})["catch"](function(a){d("WALogger").ERROR(h(),a)})}),q!==!0&&a.contacts.toCollection().each(u)].filter(Boolean);return d("MAWDexieTable").dexieAll(b).then(function(){})});function a(){if(!d("MAWGating").isSearchEnabled())return b("Promise").resolve();d("MAWDataSyncQueue").registerDataSyncCallback(z);return A()["catch"](function(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("Error paging results from MAWDB for FTS, searching messages will not work this session")})}function e(a){a=a.search;return!d("MAWGating").isSearchEnabled()?[]:j.search(a).map(function(a){a=a.id;a=l.get(a);if(a==null)return;switch(a.type){case"DbGroupInfo":return babelHelpers["extends"]({recordType:"groupInfo"},d("MAWBridgeTypes").createBridgeGroupInfo(a.raw));case"DbMsg":if(!d("MAWGating").isContentSearchEnabled())return;return babelHelpers["extends"]({recordType:"msg"},d("MAWBridgeSearchMsg").createBridgeSearchMsg(a.raw));case"DbContact":return babelHelpers["extends"]({recordType:"contact"},d("MAWBridgeTypes").createBridgeContact(a.raw));case"DbParticipant":return babelHelpers["extends"]({recordType:"participant"},d("MAWBridgeParticipants").createBridgeParticipant(a.raw,!1));default:return}}).filter(Boolean)}function f(){j.removeAll(),l.clear()}g.initFTS=a;g.search=e;g.clearFTS_FOR_TESTING_DO_NOT_USE=f}),98);
__d("MAWRetryUploads",["MAWEBSwitch","MAWGating","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWQplProxy","MAWTransactionMode","MAWUploadRetryStatusUtil","WAJobOrchestratorTypes","WALogger","WAShiftTimer","WATimeUtils","promiseDone","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted backups are not enabled for the upload flow"]);h=function(){return a};return a}function i(){var a,e,f,g,i;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:if(d("MAWGating").isEncryptedBackupsUploadTrackingEnabled()){n.next=2;break}return n.abrupt("return");case 2:if(c("MAWEBSwitch").isEnabled()){n.next=7;break}d("WALogger").LOG(h());o=Math.max(o*2,d("WATimeUtils").FIVE_MINUTES);m.onOrAfter(o);return n.abrupt("return");case 7:if(!(c("MAWEBSwitch").isEnabled()&&d("MAWGating").isRetroactiveBackupsEnabled()&&d("MAWGating").isRetroactiveBackupsRetriesEnabled())){n.next=12;break}n.next=10;return b("regeneratorRuntime").awrap(d("MAWUploadRetryStatusUtil").checkRetroactiveBackupsStateStore());case 10:a=n.sent,a&&d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));case 12:n.next=14;return b("regeneratorRuntime").awrap(j());case 14:e=n.sent;if(!(e.length>0)){n.next=26;break}f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521479578,"1403"),{"int":{messages:e.length}});n.next=19;return b("regeneratorRuntime").awrap(k(e.map(function(a){return a.externalId})));case 19:g=n.sent;i=new Map();e.forEach(function(a){return i.set(a.externalId,a.traceId)});n.next=24;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.uploadMessagesBackup(g,[],[],[],[],i,void 0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 24:f.endSuccess();return n.abrupt("return",l(e.map(function(a){return[a.externalId,a.lastRetryTs]})));case 26:case"end":return n.stop()}},null,this)}var j=d("MAWIndexedDb").makeMsgrTransactor({uploadRetryStatus:d("MAWTransactionMode").READONLY})(function(a){return a.uploadRetryStatus.toArray()}),k=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(function(a,b){return a.messages.where("externalId").anyOf(b).primaryKeys()}),l=d("MAWIndexedDb").makeMsgrTransactor({uploadRetryStatus:d("MAWTransactionMode").READWRITE})(function(a,b){return a.uploadRetryStatus.bulkDelete(b)}),m=new(d("WAShiftTimer").ShiftTimer)(function(){c("promiseDone")(i())}),n=1e3,o=n;function a(){m.onOrAfter(n)}g.retryUploads=i;g.init=a}),98);
__d("WASyncdCryptoUtils",["WACryptoUtils","WAErr","WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){function a(a){if(a.length===0)throw c("WAErr")("buffers length is zero");if(a.length===1)return a[0];var b=a.map(function(a){return a.byteLength});b=b.reduce(function(a,b){return a+b});b=new Uint8Array(b);var d=0,e;for(e=0;e<a.length;e++)b.set(new Uint8Array(a[e]),d),d+=a[e].byteLength;return b.buffer}function b(a,b,d){if(b<0||d<0)throw c("WAErr")("buffers length is zero");var e=new Array(3);a=new Uint8Array(a);e[0]=a.slice(0,b).buffer;e[1]=a.slice(b,b+d).buffer;e[2]=a.slice(b+d).buffer;return e}function e(a){return Uint8Array.from(a.split(" ").map(function(a){return parseInt(a,16)}))}function f(a){return Array.from(new Uint8Array(d("WASyncdKeyTypes").fromSyncKeyId(a))).map(function(a){return a.toString(16)}).toString().replace(/,/g," ")}function h(a){return Array.from(new Uint8Array(a)).map(function(a){return a.toString(16).padStart(2,"0")}).join("")}function i(a){var b=new ArrayBuffer(8);new DataView(b).setUint32(4,a,!1);return b}var j=new TextEncoder();function k(a){return j.encode(a)}function l(a,b){return d("WACryptoUtils").arrayBuffersEqual(d("WASyncdKeyTypes").fromSyncKeyId(a),d("WASyncdKeyTypes").fromSyncKeyId(b))}g.combine=a;g.split=b;g.hexToUint8Array=e;g.syncKeyIdToHex=f;g.arrayBufferToHexPadded=h;g.to64BitNetworkOrder=i;g.toUtf8=k;g.syncKeyIdsEqual=l}),98);
__d("MAWMailboxUploadDataSync",["MAWDataSyncQueue","MAWEBSwitch","MAWGating","MAWGlobals","MAWJobDefinitions","MAWRetryUploads","WACryptoHmac","WAHex","WAJobOrchestratorTypes","WALogger","WASyncdCryptoUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error handling backup batch: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted backups are not enabled for the upload flow"]);i=function(){return a};return a}var j=new Set(["messages","reactions","receipts","xma"]),k=function(a,b){return Array.from(new Set(b.filter(function(b){return b.value.tableName===a}).map(function(a){return a.value.key})))},l=d("WAHex").randomHex(32);function m(a){a=d("WASyncdCryptoUtils").toUtf8(JSON.stringify(a));return d("WACryptoHmac").hmacSha256(l,a).then(function(a){return d("WASyncdCryptoUtils").arrayBufferToHexPadded(a)})}function n(a,e){var f,g,h,j,l,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:if(c("MAWEBSwitch").isEnabled()){q.next=3;break}d("WALogger").LOG(i());return q.abrupt("return");case 3:g=(f=e==null?void 0:e.isUnloading)!=null?f:!1;h=k("messages",a);j=k("receipts",a);l=[];n=k("reactions",a);o=k("xma",a);if(!(h.length+j.length+n.length+o.length===0)){q.next=11;break}return q.abrupt("return");case 11:if(!g){q.next=15;break}q.t0=void 0;q.next=18;break;case 15:q.next=17;return b("regeneratorRuntime").awrap(m({messageIds:h,reactionIds:n,receiptIds:j,threadIds:l,xmaIds:o}));case 17:q.t0=q.sent;case 18:p=q.t0;return q.abrupt("return",d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.uploadMessagesBackup(h,l,n,j,o,void 0,p,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 20:case"end":return q.stop()}},null,this)}var o=function(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.prev=0;e=a.filter(function(a){return j.has(a.value.tableName)});if(!(e.length===0)){f.next=4;break}return f.abrupt("return");case 4:f.next=6;return b("regeneratorRuntime").awrap(n(e,c));case 6:f.next=11;break;case 8:f.prev=8,f.t0=f["catch"](0),d("WALogger").ERROR(h(),f.t0);case 11:case"end":return f.stop()}},null,this,[[0,8]])};a=function(){if(!d("MAWGating").isUploadFlowEnabled())return;d("MAWDataSyncQueue").registerDataSyncCallback(o);d("MAWRetryUploads").init()};g.processUploadQueue=n;g.initMailboxUpload=a}),98);
__d("MAWDbCollectionVersions",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){a.id;a=babelHelpers.objectWithoutPropertiesLoose(a,["id"]);return a}f.unsafeCoerceToCollectionVersionId=a;f.unsafeCoerceFromCollectionVersionId=b;f.convertFromDbCollectionVersion=c}),66);
__d("MAWDbHistorySyncQRCodeData",[],(function(a,b,c,d,e,f){"use strict";a="qrCodeRowId";f.qrCodeRowId=a}),66);
__d("MAWDbIsDualSend",[],(function(a,b,c,d,e,f){"use strict";a=2;f.LATEST_DUAL_SEND_VERSION=a}),66);
__d("MAWDbMissingKeys",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return babelHelpers["extends"]({},a,{keyHex:a.keyHex})}function d(a){return babelHelpers["extends"]({},a,{keyHex:a.keyHex})}f.unsafeCoerceToKeyHex=a;f.unsafeCoerceKeyHexToString=b;f.convertMissingKeyTypeToDbMissingKeys=c;f.convertDbMissingKeysToMissingKeyType=d}),66);
__d("MAWDbPendingMutations",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function b(a){return a}function d(a){if(a.id==null)throw c("err")("expected pending mutation id");return babelHelpers["extends"]({},a,{id:a.id})}function e(a){if(a.id!=null)throw c("err")("expected no pending mutation id");a=babelHelpers["extends"]({},a);a.id;a=babelHelpers.objectWithoutPropertiesLoose(a,["id"]);return a}function f(a){return babelHelpers["extends"]({},a,{id:a.id})}g.unsafeCoerceToPendingMutationId=a;g.unsafeCoercePendingMutationIdToNumber=b;g.convertPendingMutationTypeToDbPendingMutation=d;g.convertPendingMutationTypeToNewDbPendingMutation=e;g.convertDbPendingMutationToPendingMutationType=f}),98);
__d("MAWDbSyncActions",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return babelHelpers["extends"]({},a,{index:a.index})}function d(a){return babelHelpers["extends"]({},a,{index:a.index})}f.unsafeCoerceToSyncActionIndex=a;f.unsafeCoerceSyncActionIndexToString=b;f.convertDbSyncActionsToSyncActionType=c;f.convertSyncActionTypeToDbSyncActions=d}),66);
__d("MAWDbSyncKeys",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){a.id;a=babelHelpers.objectWithoutPropertiesLoose(a,["id"]);return a}f.unsafeCoerceToSyncKeyIndex=a;f.convertDbSyncKeysToSyncKeyData=b}),66);
__d("MAWDbTasks",[],(function(a,b,c,d,e,f){"use strict";a={deleteExpiredKeys:"deleteExpiredKeys",deleteOrphanedReactions:"deleteOrphanedReactions",generatePrekeys:"generatePrekeys",notifyDeviceRegistration:"notifyDeviceRegistration",queryGroups:"queryGroups",requestAllSyncdMissingKeys:"requestAllSyncdMissingKeys",rotateCAT:"rotateCAT",rotateKey:"rotateKey",syncAbProps:"syncAbProps",syncdSyncAllCollections:"syncdSyncAllCollections"};f.Tasks=a}),66);
__d("MAWConvertFutureproofMsgTxns",["MAWBridgeMsg","MAWBridgeTypes","MAWDbMsg","MAWDbThreadTxns","MAWDexieTable","MAWHandleUnstoredMediaTxns","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWThreadEvent","MAWThreadSnippetBuildTxns","WADualSendMsgUtils","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){var h=babelHelpers["extends"]({},b,{msgId:e.msgId,rowId:e.rowId,thread:e.thread,threadJid:g.jid,ts:e.ts});return a.messages.put(h).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,h)}).then(function(b){if(b){h.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(h.thread);return a.messages.put(h)}}).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,h)}).then(function(b){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(h,void 0,b)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:g.jid,msgId:h.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);b=h.msgId===g.newestMsg?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,h,g).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(g.jid),snippetParams:b,snippetSenderContactId:c,snippetType:a,threadId:g.chatId})})}):d("MAWDexieTable").dexieResolve();var e=f!=null?d("MAWHandleUnstoredMediaTxns").handleUnstoredDbMedia(a,f,h).then(function(a){if(d("WAJids").isAuthorSystem(h.author))throw c("err")("This cannot happen");return{plaintextHash:a.plaintextHash,protocolMsgId:{author:h.author,chat:g.jid,externalId:h.externalId}}}):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([b,e]).then(function(a){a[0];a=a[1];return a})})}g.convertFutureproofMsg=a}),98);
__d("MAWAdminAddParticipantMsg",["MAWGlobals","MAWJids","MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e){switch(a){case 1:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER}}function l(a,b){switch(a){case 1:return{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU};case 2:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_ONE_USER}}return{adminMsgContent:[(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER}}function m(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_TWO_USER}}return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_ADDED_MORE_THAN_TWO_USER}}function n(a,b){var c=d("MAWGlobals").getMyUserJid(),e=b[0],f=b[1],g=d("MAWJids").userIdFromJid(e);f=f!=null?d("MAWJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?l(b.length,e===c?f:g):m(b.length,g,f);if(a===c)return j(b.length,g,f);a=d("MAWJids").userIdFromJid(a);return b.includes(c)?i(b.length,a,e===c?f:g):k(b.length,a,g,f)}function a(a,b){return babelHelpers["extends"]({},n(a,b),{version:h})}g.createAddParticipantsAdminMessage=a}),98);
__d("MAWAdminRemoveParticipantMsg",["MAWGlobals","MAWJids","MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c,e){switch(a){case 1:return e?{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LEFT_GROUP}:{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e,f){switch(a){case 1:return f?{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP}:{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER}}function l(a,b){var c=d("MAWGlobals").getMyUserJid(),e=b[0],f=b[1],g=d("MAWJids").userIdFromJid(e);f=f!=null?d("MAWJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_YOU}:{adminMsgContent:[g],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOW_USER_REMOVED_ONE_USER};if(a===c)return j(b.length,g,f,e===c);var h=d("MAWJids").userIdFromJid(a);return b.includes(c)?i(b.length,h,e===c?f:g):k(b.length,h,g,f,e===a)}function a(a,b){return babelHelpers["extends"]({},l(a,b),{version:h})}g.createRemoveParticipantsAdminMessage=a}),98);
__d("MAWDbContactsUtils",["MAWAdminMsgTxnsUtils","MAWDbContactsTxns","MAWDexieTable","MAWGlobals"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=d("MAWGlobals").getMyUserJid(),f=c[0],g=c[1];return d("MAWDexieTable").dexieAll([b!=null&&b!==e?d("MAWDbContactsTxns").maybeGetContactName(a,b):d("MAWDexieTable").dexieResolve(d("MAWAdminMsgTxnsUtils").getUnknownUserName()),f!==e?d("MAWDbContactsTxns").maybeGetContactName(a,f):d("MAWDexieTable").dexieResolve(d("MAWAdminMsgTxnsUtils").getUnknownUserName()),c.length===2&&g!==e?d("MAWDbContactsTxns").maybeGetContactName(a,g):d("MAWDexieTable").dexieResolve(d("MAWAdminMsgTxnsUtils").getUnknownUserName())]).then(function(a){var c=a[0],e=a[1];a=a[2];return(b!=null&&d("MAWAdminMsgTxnsUtils").isUnknownName(c)?[b]:[]).concat(d("MAWAdminMsgTxnsUtils").isUnknownName(e)?f:[]).concat(d("MAWAdminMsgTxnsUtils").isUnknownName(a)?g:[])})}g.getUnknownContactNames=a}),98);
__d("MAWAdminWriteChangeParticipantsAdminMsgTxn",["MAWAdminAddParticipantMsg","MAWAdminMsgTxnsUtils","MAWAdminRemoveParticipantMsg","MAWDbContactsUtils","MAWDbMsg","MAWDbThreadTxns","MAWGlobals","MAWLocalizationUtils","MAWWriteMsgTxns","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b,d("MAWAdminAddParticipantMsg").createAddParticipantsAdminMessage)}function b(a,b){return h(a,b,d("MAWAdminRemoveParticipantMsg").createRemoveParticipantsAdminMessage)}function h(a,b,e){var f=b.admin,g=b.chatId,h=b.participants,i=b.serverTs;if(h.length===0)throw c("err")("invalid number of participants when writing participants change admin msg");return d("MAWDbThreadTxns").getThread(a,g).then(function(b){if(!b.success)throw c("err")("no thread when writing participants change admin msg");var g=b.value;b=d("MAWGlobals").getMyUserJid();var j=f==="@me"?b:f;if(j==null)return;return d("MAWDbContactsUtils").getUnknownContactNames(a,j,h).then(function(b){var c=d("MAWDbMsg").craftMsgId(g.chatId,g.nextInChatMsgId);c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(e(j,h),g.chatId,g.jid,c,i);return d("MAWWriteMsgTxns").writeMsg(a,c,g).then(function(){b.length>0&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames(b)})})})}g.writeAddParticipantAdminMsg=a;g.writeRemoveParticipantAdminMsg=b;g.writeChangeParticipantsAdminMsg=h}),98);
__d("MAWAdminWriteGroupNameChangeTxn",["MAWAdminMsgTxnsUtils","MAWDbContactsTxns","MAWDbMsg","MAWDexieTable","MAWGlobals","MAWJids","MAWLocalizationType","MAWLocalizationUtils","MAWWriteMsgTxns","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e=b.name;return e==null?d("MAWDexieTable").dexieResolve():d("MAWDbContactsTxns").maybeGetContactName(a,b.nameOwner).then(function(f){var g=d("MAWGlobals").getMyUserJid(),h=[];b.nameOwner===g?(g=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP,h.push(e)):b.nameOwner==null?(g=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP,h.push(e)):(g=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP,h.push(d("MAWJids").userIdFromJid(b.nameOwner),e));var i=d("MAWDbMsg").craftMsgId(c.chatId,c.nextInChatMsgId);h=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:h,adminType:g,version:1},c.chatId,c.jid,i,d("WATimeUtils").castMillisTimeToUnixTime(c.lastReadMsgTs));return d("MAWWriteMsgTxns").writeMsg(a,h,c).then(function(){d("MAWAdminMsgTxnsUtils").isUnknownName(f)&&b.creator!=null&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames([b.creator])})})}g.writeGroupNameChangeInfo=a}),98);
__d("MAWParticipantManagementTxns",["MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","WADualSendMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){if(c.length===0&&e.length===0)return{addedJids:[],participants:e,removedJids:[],typeUpdateJids:[]};var f=new Map();e.forEach(function(a){f.set(a.userJid,a)});var g=new Set(c.map(function(a){return a.userJid})),h=[],i=[],j=[],k=[];f.forEach(function(a,b){g.has(b)||(a.type!=="invitedParticipant"?h.push(b):(k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.userJid);b==null?(i.push(a),a.type=="admin"&&k.push({type:a.type,userJid:a.userJid})):(b.type!=a.type&&k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},b,a)))});var l=h.indexOf(d("MAWGlobals").getMyUserJid())>=0,m=function(c){return[d("MAWDbParticipantTxns").bulkAddParticipants(a,b,i,c),d("MAWDbParticipantTxns").bulkUpdateParticipants(a,j,c),d("MAWDbParticipantTxns").bulkDeleteParticipantsInThread(a,b,h),l?d("MAWDbThreadTxns").archiveThreads(a,[b],!0):d("MAWDexieTable").dexieResolve()]};return a.threads.get(b).then(function(a){return d("MAWDexieTable").dexieAll(m(d("WADualSendMsgUtils").isDualSendJid(a==null?void 0:a.jid)))}).then(function(a){var b=a[0];a=a[1];return{addedJids:i.map(function(a){return a.userJid}),participants:[].concat(b,a),removedJids:h,typeUpdateJids:k}})})}g.syncParticipantList=a}),98);
__d("MAWGroupManagementTxns",["MAWAdminWriteChangeParticipantsAdminMsgTxn","MAWAdminWriteGroupNameChangeTxn","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbPersonalSenderKeyStatusTxns","MAWDbSenderKeySessionTxns","MAWDbThreadTxns","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWGlobals","MAWLoadMsgsTxns","MAWParticipantManagementTxns","MAWThreadManagementTxns","WADualSendMsgUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWDbSenderKeySessionTxns").deleteSenderKeysByGroupJid(a,b),d("MAWThreadManagementTxns").deleteAllThreadData(a,c),d("MAWDbGroupInfoTxns").deleteGroupInfo(a,b),d("MAWDbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,[b])]).then(function(){})}b=function(a,b){var c=b.authoritativeThreadKey,e=b.deduplicationKey,f=b.extras,g=b.folder,h=b.groupStatus,i=b.groupToCreate,j=b.serverTs;b=h==="added"?d("WATimeUtils").unixTime():i.creationTs;var k=(f==null?void 0:f.isDualSend)===!0&&i.subject.content!=null?i.subject.content.split(d("WADualSendMsgUtils").SHADOW_GROUP_NAME_POST_FIX)[0]:null;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:c,clientThreadKey:f==null?void 0:f.clientThreadKey,createTs:d("WATimeUtils").castUnixTimeToMillisTime(b),deduplicationKey:e,folder:g==null?d("MAWFolderTypes").FOLDER_ID.INBOX:g,jid:i.jid}).then(function(b){var c=b.created,e=b.thread;b=i.participants.map(function(a){return a.error?a.error.errorCode===403?{addressable:!0,type:"invitedParticipant",userJid:a.error.user}:null:{addressable:a.value.addressable,type:a.value.type,userJid:a.value.user}}).filter(Boolean);var f=c?d("MAWDbParticipantTxns").bulkAddParticipants:d("MAWParticipantManagementTxns").syncParticipantList;f=f(a,e.chatId,b);b=d("MAWGlobals").getMyUserJid();b=h==="added"&&!c&&i.creator!==b?d("MAWAdminWriteChangeParticipantsAdminMsgTxn").writeAddParticipantAdminMsg(a,{admin:i.inviter,chatId:e.chatId,participants:[b],serverTs:j}):d("MAWDexieTable").dexieResolve();i.description;i.participants;var g=babelHelpers.objectWithoutPropertiesLoose(i,["description","participants"]);return d("MAWDexieTable").dexieAll([f,d("MAWDbGroupInfoTxns").putGroupInfo(a,e.chatId,g,k),d("MAWDbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus(a,i.jid),e.newestMsg!=null?d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,e.chatId,e.newestMsg,10,!0):d("MAWDexieTable").dexieResolve(),b]).then(function(b){b[0];b=b[1];return c&&h==="added"?d("MAWAdminWriteGroupNameChangeTxn").writeGroupNameChangeInfo(a,b,e):d("MAWDexieTable").dexieResolve()}).then(function(){return e.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(a,[e.chatId]):d("MAWDbThreadTxns").subscribeToThreads(a,[e.chatId])}).then(function(a){return e.jid})})};g.deleteGroup=a;g.createGroupInternal=b}),98);
__d("MAWEphemeralConsts.re",["MAWEphemeralConsts.bs"],(function(a,b,c,d,e,f){c=(a=b("MAWEphemeralConsts.bs")).fiveSeconds;f.FIVE_SECONDS=c;d=a.tenSeconds;f.TEN_SECONDS=d;e=a.thirtySeconds;f.THIRTY_SECONDS=e;b=a.oneMinuteInSeconds;f.ONE_MINUTE_IN_SECONDS=b;c=a.fiveMinutesInSeconds;f.FIVE_MINUTES_IN_SECONDS=c;d=a.tenMinutesInSeconds;f.TEN_MINUTES_IN_SECONDS=d;e=a.fifteenMinutesInSeconds;f.FIFTEEN_MINUTES_IN_SECONDS=e;b=a.thirtyMinutesInSeconds;f.THIRTY_MINUTES_IN_SECONDS=b;c=a.oneHourInSeconds;f.ONE_HOUR_IN_SECONDS=c;d=a.sixHoursInSeconds;f.SIX_HOURS_IN_SECONDS=d;e=a.twelveHoursInSeconds;f.TWELVE_HOURS_IN_SECONDS=e;b=a.oneDayInSeconds;f.ONE_DAY_IN_SECONDS=b;c=a.ephemeralMaxDelectionWindowForUnseenMessage;f.EPHEMERAL_MAX_DELETION_WINDOW_FOR_UNSEEN_MESSAGE=c;d=a.ephemeralReportingWindowInSeconds;f.EPHEMERAL_REPORTING_WINDOW_IN_SECONDS=d}),null);
__d("WAGetHashFromProtocolMsgId",[],(function(a,b,c,d,e,f){function a(a){return a.externalId+"_"+a.author+"_"+a.chat}f.getHashFromProtocolMsgId=a}),66);
__d("MAWEphemeralMsgTxns",["MAWBridgeMsgCountdown","MAWBridgeTypes","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDbXMATxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralConsts.re","MAWEphemeralMsgUtils","MAWEphemeralSettingsTxns","MAWGating","MAWIndexedDb","MAWLocalizationType","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWXMAUtils","WADualSendMsgUtils","WAGetHashFromProtocolMsgId","WAJids","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is not out of sync"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is out of sync: correct duration ",", correct timestamp ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is ephemeral: duration ",", timestamp ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is not out of sync"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is out of sync: correct duration ",", correct timestamp ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming msg is non-ephemeral"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["incoming ephemeral setting is out of sync: correct duration ",", correct timestamp ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg: Message from ",", chat ",", type ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["trying to update ephemeral timestamp to a later ts then previously set"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["updating ephemeral timestamp msg ",", existing expiration ",", existing deletion ",", updated expiration ",", updated deletion ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkMarkEphemeralMessageAsRead EphemeralCounter: Showing UI counter for ",""]);r=function(){return a};return a}function s(a,b,c,d){d===void 0&&(d=function(){return!0});return a.messages.where("msgId").between(b,c,!1,!0).filter(d).limit(1).toArray().then(function(a){return{needsUpdate:!0,value:(a=a[0])!=null?a:null}})}function t(a,b,c){return c.size===0?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(e){if(!e.success)return;var f=e.value,g=f.oldestMsg,h=f.newestMsg;if(g==null||h==null)return;e=d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c);var i=c.has(g)?s(a,g,h,e):d("MAWDexieTable").dexieResolve({needsUpdate:!1});e=c.has(h)?a.messages.where("msgId").between(g,h,!0,!1).filter(e).reverse().limit(1).toArray().then(function(b){b=b[0];return d("MAWThreadSnippetUtils").isDbMsgDisabledForThreadSnippet(b)?d("MAWThreadSnippetUtils").findMostRecentSnippetMsgFromThread(a,f,c).then(function(a){return{needsUpdate:!0,value:(a=a)!=null?a:null}}):{needsUpdate:!0,value:(b=b)!=null?b:null}}):d("MAWDexieTable").dexieResolve({needsUpdate:!1});return d("MAWDexieTable").dexieAll([i,e]).then(function(c){var e=c[0],i=c[1];if(!e.needsUpdate&&!i.needsUpdate)return;var j=babelHelpers["extends"]({},f,{newestMsg:i.needsUpdate?(c=(c=i.value)==null?void 0:c.msgId)!=null?c:null:h,oldestMsg:e.needsUpdate?(e=(c=e.value)==null?void 0:c.msgId)!=null?e:null:g});return a.threads.put(j).then(function(){if(i.needsUpdate){var c=i.value;if(c==null)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(j.jid),snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:"0",snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET,threadId:b})});else return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,c,j).then(function(a){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(j.jid),snippetParams:c,snippetSenderContactId:e,snippetType:a,threadId:b})})})}})})})}function a(a,b){var c={};b.map(function(a){var b=a.msgId;a=a.ts;b=d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(b);c[b]=a});return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b.map(function(a){return babelHelpers["extends"]({},a.msgId)})).then(function(b){var e=b.msgs,f=b.threadIdToJid;b=e.map(function(a){var b=f.get(a.thread),e=a.author;if(b==null||d("WAJids").isAuthorSystem(e))return null;e=d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId({author:e,chat:b,externalId:a.externalId});b=c[e];e=(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec;if(e==null||e===0)return null;b=d("WATimeUtils").castToUnixTime(b+e);e=d("WATimeUtils").castToUnixTime(b+d("MAWEphemeralConsts.re").EPHEMERAL_REPORTING_WINDOW_IN_SECONDS);return{messageDeleteTs:e,messageExpirationTs:b,msgId:a.msgId}}).filter(Boolean);return u(a,b)}).then(function(a){var b=a[0],c=a[1];a=a[2];a.length>0&&(d("WALogger").LOG(r(),a.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}));b!=null&&c!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,c)})}function u(a,b){var c=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,c).then(function(e){var f=new Map();b.forEach(function(a){f.set(a.msgId,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs});var b=e.get(a.msgId);b!=null&&f.set(b,{messageDeleteTs:a.messageDeleteTs,messageExpirationTs:a.messageExpirationTs})});var g=null,h=null,i=[],j=Array.from(new Set(c.concat(Array.from(e.values()))));return a.messages.where("msgId").anyOf(j).toArray().then(function(b){if(b.length===0)return;b.forEach(function(a){var b=a.messageExpirationTs,c=a.messageDeleteTs,e=f.get(a.msgId),j=e==null?void 0:e.messageExpirationTs;e=e==null?void 0:e.messageDeleteTs;d("WALogger").LOG(q(),a.msgId,b,c,j,e);if(j==null||e==null)return;if(b!=null&&j>b||c!=null&&j>c){d("WALogger").ERROR(p());return}if(a.ephemeralCounterStarted===!0)return;g==null?g=j:j<g&&(g=j);h==null?h=e:e<h&&(h=e);b=babelHelpers["extends"]({},a,{ephemeralCounterStarted:!0,messageDeleteTs:e,messageExpirationTs:j});i.push(b)});return a.messages.bulkPut(i)}).then(function(){return[g,h,i]})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();var c=[];b.forEach(function(b,d){c.push(t(a,d,b))});return d("MAWDexieTable").dexieAll(c).then(function(){})}function c(a,b,c){if(!d("MAWGating").isEphemeralMessagesEnabled()||b==null||b.ephemeralSetting==null||b.ephemeralSetting.ephemeralExpirationInSec===0)return d("MAWDexieTable").dexieResolve();var e=d("WATimeUtils").castToUnixTime(c+d("MAWEphemeralConsts.re").EPHEMERAL_MAX_DELETION_WINDOW_FOR_UNSEEN_MESSAGE);return d("MAWDbXMATxns").getDbXMAMsgFromAssociatedMsgId(a,b.msgId).then(function(c){var f=[babelHelpers["extends"]({},b,{messageDeleteTs:e,messageExpirationTs:e})];c!=null&&d("MAWXMAUtils").isXMAShare(c.xmaMessageType)&&f.push(babelHelpers["extends"]({},c,{messageDeleteTs:e,messageExpirationTs:e}));return a.messages.bulkPut(f).then(function(){})})}function e(a,b,c,e,f,g,p){d("WALogger").LOG(o(),c,e,b.type);if(p!=null){d("WALogger").LOG(n(),p.correctEphemeralExpirationInSec,p.correctEphemeralLastUpdatedOrSetTimestamp);return d("MAWDexieTable").dexieResolve(p)}p=d("MAWDexieTable").dexieResolve();if(d("MAWGating").isEphemeralMessagesEnabled())if(b.ephemeralSetting==null)d("WAJids").switchOnMsgrChatJidType(e,{group:function(){},user:function(){d("MAWDbMsg").isMsgEligibleForTriggeringEphemeralSyncResponse(b)&&(d("WALogger").LOG(m()),p=d("MAWEphemeralSettingsTxns").getOutOfSyncEphemeralSettingForIncomingNonEphemeralMsg(a,e).then(function(a){var b;if((a==null?void 0:a.success)===!0&&(a==null?void 0:(b=a.value)==null?void 0:b.outOfSyncEphemeralSetting)!=null){d("WALogger").LOG(l(),a.value.outOfSyncEphemeralSetting.correctEphemeralExpirationInSec,a.value.outOfSyncEphemeralSetting.correctEphemeralLastUpdatedOrSetTimestamp);return a.value.outOfSyncEphemeralSetting}else{d("WALogger").LOG(k());return null}}))}});else if(b.messageExpirationTs!=null&&b.messageDeleteTs!=null){var q=b.ephemeralSetting,r=b.messageDeleteTs,s=b.messageExpirationTs;d("WALogger").LOG(j(),q.ephemeralExpirationInSec,q.ephemeralLastUpdatedOrSetTimestamp);d("MAWEphemeralCleaner").addNewEphemeralTimestamp(s,r);p=d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,c,f,q,e,g,null).then(function(a){var b;if((a==null?void 0:a.success)===!0&&(a==null?void 0:(b=a.value)==null?void 0:b.outOfSyncEphemeralSetting)!=null){d("WALogger").LOG(i(),a.value.outOfSyncEphemeralSetting.correctEphemeralExpirationInSec,a.value.outOfSyncEphemeralSetting.correctEphemeralLastUpdatedOrSetTimestamp);return a.value.outOfSyncEphemeralSetting}else{d("WALogger").LOG(h());return null}})}return p.then(function(b){b==null&&d("MAWEphemeralSettingsTxns").maybeResetEphemeralSyncResponseBackoffInfo(a,c);return b})}g.bulkMarkEphemeralMessageAsRead=a;g.bulkUpdateEphemeralMessageTimestamps=u;g.updateThreadsOnMessagesExpiredFromUi=b;g.maybeUpdateEphemeralMessageWhenMarkedSent=c;g.maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg=e}),98);
__d("MAWIncomingReceiptUtils",["MAWDbParticipant","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["User "," is in affectedUserJids in receipt-writing results, but they have no corresponding read/delivery receipt entry in the DB"]);h=function(){return a};return a}function a(a){var b=new Map();a.forEach(function(a){if(a.type!=="updated"||a.msgRenderType==="unrendered")return;a.affectedUserJids.forEach(function(c){var e=a.receipt.statusTsPerUser.get(c);if(e==null){d("WALogger").WARN(h(),c);return}c=d("MAWDbParticipant").craftParticipantId(a.threadId,c);var f=b.get(c),g=e.deliveredTs!=null,i=e.readTs!=null;g=g?a.msgTs:0;i=i?a.msgTs:0;e=(e=e.readTs)!=null?e:0;if(f!=null){var j=f.lastDeliveredMsgTs,k=f.lastReadMsgTs;f=f.lastReadActionTs;g=Math.max(g,j);i=Math.max(i,k);e=Math.max(e,f)}b.set(c,{isDualSend:a.isDualSend,lastDeliveredMsgTs:d("WATimeUtils").castToUnixTime(g),lastReadActionTs:d("WATimeUtils").castToUnixTime(e),lastReadMsgTs:d("WATimeUtils").castToUnixTime(i)})})});return b}g.getMaxTimestampsPerParticipant=a}),98);
__d("MAWAckAndTimestampUpdatesForReceiptsTxns",["MAWBridgeMsgCountdown","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralMsgTxns","MAWIncomingReceiptUtils","MAWIndexedDb","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating timestamps for "," participants"]);i=function(){return a};return a}function a(a,b,c,e){b=d("MAWIncomingReceiptUtils").getMaxTimestampsPerParticipant(b);d("WALogger").LOG(i(),b.size);var f=[];b.forEach(function(a,b){f.push({deliveredWatermarkTs:a.lastDeliveredMsgTs,isDualSend:a.isDualSend,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadMsgTs,participantId:b})});b=c.regular.length>0?d("MAWDbMsgTxns").bulkUpdateSystemAck(a,c.regular):d("MAWDexieTable").dexieResolve();c=c.unrendered.length>0?d("MAWDbUnrenderedMsgTxns").bulkUpdateSystemAckForUnrenderedMsgs(a,c.unrendered):d("MAWDexieTable").dexieResolve();b=d("MAWDexieTable").dexieAll([b,c]);return d("MAWDexieTable").dexieAll([b,f.length>0?d("MAWDbParticipantTxns").bulkUpdateParticipantTimestamps(a,f):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWEphemeralMsgTxns").bulkUpdateEphemeralMessageTimestamps(a,e):d("MAWDexieTable").dexieResolve([])]).then(function(a){a=a[2];var b=a[0],c=a[1];a=a[2];b!=null&&c!=null&&a.length>0&&(d("MAWEphemeralCleaner").addNewEphemeralTimestamp(b,c),d("WALogger").LOG(h(),a.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a)}))})}g.handleAckAndTimestampUpdatesForReceipts=a}),98);
__d("MAWIncomingReceiptDataFormatTxns",["MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to map the threadId of a message to its threadJid during receipt-writing"]);h=function(){return a};return a}function i(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function a(a,b){var c=new Map(),e=new Set();b.forEach(function(a){a=a.msgs;a.forEach(function(a){return e.add(babelHelpers["extends"]({},a))})});a=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,Array.from(e)),d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByProtocolMsgId(a,Array.from(e))]).then(function(a){var b=a[0];a=a[1];var c=[];b.msgs.forEach(function(a){return c.push({msg:a,renderType:"regular"})});a.msgs.forEach(function(a){return c.push({msg:a,renderType:"unrendered"})});b=Array.from(b.threadIdToJid.entries()).concat(Array.from(a.threadIdToJid.entries()));a=new Map(b);return{msgs:c,threadIdToJid:a}});return a.then(function(a){var e=a.msgs,f=a.threadIdToJid;b.forEach(function(a){var b=a.msgs,d=a.receivers,e=a.type;b.forEach(function(a){var b=i(a),f=c.get(b)||{deliveryReceipts:[],protocolMsgId:a,readReceipts:[],senderReceipts:[]};d.forEach(function(a){e==="read"?f.readReceipts.push(a):e==="delivered"?f.deliveryReceipts.push(a):e==="sender"?f.senderReceipts.push(a):e==="inactive"&&f.deliveryReceipts.push(a)});c.set(b,f)})});var g=new Map(),j=new Map(),k=[];e.forEach(function(a){var b=a.msg,e=b.author,k=b.externalId,l=b.msgId,m=b.thread;b=b.type;m=f.get(m);if(m==null){d("WALogger").ERROR(h());return}if(b!==d("WAMsgType").MSG_TYPE.CIPHERTEXT){b=i({author:e,chat:m,externalId:k});e=c.get(b);if(e!=null){e.protocolMsgId;m=babelHelpers.objectWithoutPropertiesLoose(e,["protocolMsgId"]);k=babelHelpers["extends"]({msgId:l},m);j.set(l,k);c["delete"](b)}}g.set(l,a)});c.forEach(function(a){var b=a.deliveryReceipts,c=a.protocolMsgId;a=a.readReceipts;if(b.length===0&&a.length===0)return;var d=c.author,e=c.chat;c=c.externalId;k.push({author:d,deliveryReceipts:b,externalId:c,readReceipts:a,thread:e})});return{msgIdToDbMsgMap:g,pendingReceiptsToWrite:k,receiptsToWriteMap:j}})}g.prepareDataForReceiptsToWrite=a}),98);
__d("MAWIncomingReceiptDataFormatUtils",["MAWAckLevel","MAWDbMsg","WADualSendMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=[];a.forEach(function(a){if(a.type!=="updated")return;var f=null,g=a.receipt.msgId,h=a.receipt.statusTsPerUser,i=b.get(g);if(i==null)return;var j=i.msg;i=i.renderType;a.affectedUserJids.forEach(function(a){var b,c=null;((b=h.get(a))==null?void 0:b.readTs)!=null?c=d("MAWAckLevel").ACK.read:((b=h.get(a))==null?void 0:b.deliveredTs)!=null&&(c=d("MAWAckLevel").ACK.received);f=f==null||c!=null&&c>f?c:f});f!=null&&f>j.ack&&(i==="regular"?c.push({ack:f,msgId:g,reportingMeta:null}):(i,e.push({ack:f,msgId:g})))});return{regular:c,unrendered:e}}function b(a,b,c){return a.map(function(a){var e=b.get(a.receipt.msgId);if(e==null)return null;var f=e.msg,g=c.get(f.msgId);return g==null||g.deliveryReceipts.length===0&&g.readReceipts.length===0?null:babelHelpers["extends"]({},a,{externalId:f.externalId,isDualSend:d("WADualSendMsgUtils").isDualSendJid(f.threadJid),msgRenderType:e.renderType,msgTs:d("MAWDbMsg").getCanonicalTsFromMsg(f),threadId:f.thread})}).filter(Boolean)}g.createUpdateSystemAckParams=a;g.formatWriteReceiptResultsWithExtras=b}),98);
__d("MAWReceiptTrace",["ArmadilloDataTraceType.bs","MAWBridgeTrace","MAWBridgeTraceEvent.bs","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==="delivered"){a=b.reduce(function(a,b){return b.type==="updated"&&b.externalId!=null?[].concat(a,[b.externalId]):a},[]);a.length>0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData(a,d("MAWBridgeTraceEvent.bs").receivedReceipt,d("ArmadilloDataTraceType.bs").armadilloMessageSend)})}}g.flushTrace=a}),98);
__d("MAWIncomingReceiptTxns",["MAWAckAndTimestampUpdatesForReceiptsTxns","MAWDbPendingReceiptTxns","MAWDbReceiptTxns","MAWDexieTable","MAWEphemeralConsts.re","MAWGlobals","MAWIncomingReceiptDataFormatTxns","MAWIncomingReceiptDataFormatUtils","MAWReceiptTrace","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return b.length===0?d("MAWDexieTable").dexieResolve():d("MAWIncomingReceiptDataFormatTxns").prepareDataForReceiptsToWrite(a,b).then(function(b){var c=b.msgIdToDbMsgMap,e=b.pendingReceiptsToWrite,f=b.receiptsToWriteMap,g=[];f.forEach(function(a){g.push(a)});return d("MAWDexieTable").dexieAll([d("MAWDbReceiptTxns").bulkWriteReceiptsForDevices(a,g),d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e)]).then(function(b){b=b[0];var e=d("MAWIncomingReceiptDataFormatUtils").createUpdateSystemAckParams(b,c),g=h(b,c);b=d("MAWIncomingReceiptDataFormatUtils").formatWriteReceiptResultsWithExtras(b,c,f);var i=b.filter(function(a){a=((a=f.get(a.receipt.msgId))==null?void 0:a.deliveryReceipts)||[];return a.length>0});i.length>0&&d("MAWReceiptTrace").flushTrace("delivered",i);return d("MAWAckAndTimestampUpdatesForReceiptsTxns").handleAckAndTimestampUpdatesForReceipts(a,b,e,g)})})}function h(a,b){var c=[];a.forEach(function(a){if(a.type!=="updated")return;var e=a.receipt.msgId,f=a.receipt.statusTsPerUser,g=b.get(e);if(g==null)return;if(g.renderType==="unrendered")return;g=g.msg;var h=g.author;g=g.ephemeralSetting;var i=g==null?void 0:g.ephemeralExpirationInSec;if(i==null||i===0)return;if(h!==d("WAJids").AUTHOR_ME)return;a.affectedUserJids.forEach(function(a){if(a!==d("MAWGlobals").getMyUserJid()){a=(a=f.get(a))==null?void 0:a.readTs;if(a!=null){a=d("WATimeUtils").castToUnixTime(a+i);var b=d("WATimeUtils").castToUnixTime(a+d("MAWEphemeralConsts.re").EPHEMERAL_REPORTING_WINDOW_IN_SECONDS);c.push({messageDeleteTs:b,messageExpirationTs:a,msgId:e})}}})});return c}g.bulkHandleIncomingReceipts=a;g.createUpdateEphemeralTimestampsParams=h}),98);
__d("MAWLinkReactionsToMsgsTxns",["MAWDbMsgTxns","MAWDbReactionUtils","MAWJidUtils","WAMsgMap","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.reduce(function(a,b){var c=d("MAWJidUtils").maybeToProtocolMsgId(b.reactToAuthor,b.threadJid,b.reactToExternalId);if(c==null)return a;var e=a.get(c);e=[].concat((e==null?void 0:e.reactions)||[],[b]);a.set(c,{protocolMsgId:c,reactions:e});return a},new(d("WAMsgMap").MsgMap)())}function i(a){return new Map(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return[a,b]}))}a=function(a,b){return a.reactions.where("reactToExternalId").anyOf(b).toArray().then(function(b){b=b.filter(function(a){return a.reactToMsgId==null});b=h(b);var e=new(d("WAMsgMap").MsgMap)(b.entries().map(function(a){var b=a[0];a=a[1].reactions;return[b,a]}));b=b.values().map(function(a){a=a.protocolMsgId;return a}).filter(Boolean);return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b).then(function(b){var f=b.msgs,g=b.threadIdToJid,h=f.flatMap(function(a){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,g.get(a.thread),a.externalId);if(b==null)return[];b=e.get(b)||[];return b.map(function(b){return babelHelpers["extends"]({},b,{reactToMsgId:a.msgId})})});return a.reactions.bulkPut(h).then(function(){var a=i(g);h.forEach(function(b){var e=a.get(b.threadJid);if(e==null)throw c("err")("Cannot send bridge update for reaction msg id");d("MAWDbReactionUtils").dispatchReaction(b,e)})})})}).then(function(){})};g.linkReactionsToMsgs=a}),98);
__d("MAWMarkThreadAsReadTxns",["MAWBridgeThread","MAWIndexedDb","MAWMessageRequestUtils","MAWTimeUtils.bs","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h(a,[{threadId:b,upToMsgId:c}]).then(function(a){a=a.get(b);return a==null?{shouldSendReadReceipts:!1,type:"missing"}:a})}function h(a,b){var e=[],f=new Map();b.map(function(a){e.push(a.threadId),f.set(a.threadId,a.upToMsgId)});var g=new Map(),h=new Map();return a.threads.bulkGet(e).then(function(b){var i=[];b.forEach(function(a){a!=null&&d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return null},user:function(a){return i.push(a)}})});return a.contacts.bulkGet(i).then(function(i){var j=[];i.forEach(function(a){a!=null&&g.set(a.contactJid,a)});b.forEach(function(a,b){if(a==null){h.set(e[b],{shouldSendReadReceipts:!1,type:"missing"});return}var i=g.get(a.jid),k=i!=null&&i.isBlocked!=null&&i.isBlocked,l=i!=null&&i.isRestricted!=null&&i.isRestricted;i=!(d("MAWMessageRequestUtils").isMessageRequestOrSpamThread(a,i)||k||l);k=a.oldestMsg;if(k==null){h.set(e[b],{shouldSendReadReceipts:i,type:"success"});return}l=f.get(a.chatId);if(l==null)throw c("err")("This is for flow error check");if(a.lastReadMsg!=null&&a.lastReadMsg>=l){h.set(e[b],{shouldSendReadReceipts:i,type:"success"});return}j.push({shouldSendReadReceipts:i,thread:a})});var k=[],l=[];j.map(function(a){var b=a.thread,c=f.get(b.chatId);a=a.shouldSendReadReceipts;var e=d("MAWTimeUtils.bs").getMillisTime(b.newestMsgTs);b=babelHelpers["extends"]({},b,{lastReadMsg:c,lastReadMsgTs:e});k.push(b);l.push(a)});return a.threads.bulkPut(k).then(function(){k.forEach(function(a,b){var c=d("MAWTimeUtils.bs").getMillisTime(a.lastReadMsgTs);c!=null&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(a.chatId,c,c)});h.set(a.chatId,{shouldSendReadReceipts:l[b],type:"success"})});return h})})})}g.markThreadAsReadUpToMsgId=a;g.bulkMarkThreadAsReadUpToMsgId=h}),98);
__d("MAWRecipientDevicesTxns",["MAWDbContactsTxns","MAWDbIdentityTxns","MAWDbParticipantTxns","MAWGlobals","WAIdentityUtils","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(b){if(b.length===0)return d("WAResultOrError").makeError("missing_participants");b=b.map(function(a){return a.userJid});return h(a,b).then(d("WAResultOrError").makeResult)})}function h(a,b){return d("MAWDbIdentityTxns").getIdentitiesForMultipleUsers(a,b,d("MAWGlobals").getMyDeviceJid()).then(function(a){var b=[];a.forEach(function(a,c){a.forEach(function(a){return b.push(a.deviceJid)})});return b})}function b(a,b){return a.receipts.get(b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing_receipt");b=b.statusTsPerUser;b=Array.from(b.keys());return d("MAWDbIdentityTxns").getIdentitiesForMultipleUsers(a,b,d("MAWGlobals").getMyDeviceJid()).then(function(a){var b=[];a.forEach(function(a,c){a.forEach(function(a){return b.push(a.deviceJid)})});return d("WAResultOrError").makeResult(b)})})}function c(a,b){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(b){if(b.length===0)return d("WAResultOrError").makeError("missing_participants");var c=b.map(function(a){return a.userJid});return d("MAWDbContactsTxns").getContacts(a,c).then(function(b){var e=[];b.forEach(function(a){a.lastSyncTs!=null&&e.push({lastSyncTs:a.lastSyncTs,user:a.contactJid})});return d("MAWDbIdentityTxns").getIdentitiesForMultipleUsers(a,c).then(function(a){var c=[],f=new Map();a.forEach(function(a,b){a.forEach(function(a){return f.set(a.deviceJid,{pubKey:a.identity})})});var g=new Map();f.forEach(function(a,b){g.set(d("WAIdentityUtils").removeKeyTypeIfNeeded(a.pubKey).toString(),b)});b.forEach(function(a){var b=a.icdcInfo;if(b==null)return;var e=b.devices,f=b.signingDeviceIndex;if(f>=e.length)return;e=e.map(function(a){var b=g.get(a.toString());if(b==null)return;return{id:d("WAJids").extractDeviceId(b),identity:a}}).filter(Boolean);c.push({devices:e,sequence:b.sequence,signingDeviceIndex:f,timestamp:b.timestamp,user:a.contactJid})});return d("WAResultOrError").makeResult({contactsSyncInfo:e,icdcInfoList:c})})})})}g.getRecipientDevicesByThread=a;g.getRecipientDevicesByUserJids=h;g.getRecipientDevicesByMsgId=b;g.getICDCInfoForUsersInThread=c}),98);
__d("MAWMsgReceiptPreparationTxns",["MAWDbIdentityTxns","MAWDbParticipantTxns","MAWDexieTable","MAWRecipientDevicesTxns","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgReceiptPreparationTxns -- permittedIdentitiesPerDevice is null, "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgReceiptPreparationTxns -- deviceJids is empty"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgReceiptPreparationTxns -- There is only "," participants in chat"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgReceiptPreparationTxns -- prepareReceiptForMsg -- there is no thread in db"]);k=function(){return a};return a}function a(a,b,c,e,f){e===void 0&&(e=!0);f===void 0&&(f=!1);return a.receipts.get(b).then(function(g){return g!=null&&!f?g:a.threads.get({jid:c}).then(function(c){if(c==null){d("WALogger").ERROR(k());return}return d("MAWDbParticipantTxns").getParticipantsInThread(a,c.chatId).then(function(c){(c.length===0||c.length===1)&&d("WALogger").ERROR(j(),c.length);var g=c.map(function(a){return a.userJid});c=f?d("MAWRecipientDevicesTxns").getRecipientDevicesByMsgId(a,b):d("MAWRecipientDevicesTxns").getRecipientDevicesByUserJids(a,g).then(d("WAResultOrError").makeResult);return c.then(function(a){return a.success?a.value:[]}).then(function(c){c.length===0&&d("WALogger").ERROR(i());var f=new Set(c);c=e?d("MAWDbIdentityTxns").getIdentitiesForDevices(a,c):d("MAWDexieTable").dexieResolve();return c.then(function(c){e&&c==null&&d("WALogger").ERROR(h());var i=new Map();g.forEach(function(a){return i.set(a,{})});var j={msgId:b,permittedIdentitiesPerDevice:c,recipientDevices:f,statusTsPerUser:i};return a.receipts.put(j).then(function(){return j})})})})})})}g.prepareReceiptForMsg=a}),98);
__d("MAWMsgRecipientsTxns",["MAWDbIdentityTxns","MAWGlobals","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgRecipientsTxns -- devicesInfoPerUser is empty"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgRecipientsTxns -- permittedIds is empty"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgRecipientsTxns -- permittedIdentitiesPerDevice is different with recipientDevices"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgRecipientsTxns -- permittedIdentitiesPerDevice is null in receipt"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWMsgRecipientsTxns -- there is no receipt for message"]);l=function(){return a};return a}function a(a,b){return a.receipts.get(b).then(function(a){if(a==null||a.permittedIdentitiesPerDevice==null){a==null&&d("WALogger").ERROR(l());(a==null?void 0:a.permittedIdentitiesPerDevice)==null&&d("WALogger").ERROR(k());return{isDeviceMismatch:!1,recipients:[]}}var b=a.permittedIdentitiesPerDevice,c=Array.from(b.keys());a=a.recipientDevices;a=m(a,c);a&&d("WALogger").ERROR(j());var e=new Map();b.size===0&&d("WALogger").ERROR(i());b.forEach(function(a,b){a=a.pubKey;var c=d("WAJids").extractUserJid(b);a={identity:a,jid:b};b=e.get(c)||[];b.push(a);e.set(c,b)});var f=[];e.size===0&&d("WALogger").ERROR(h());e.forEach(function(a,b){f.push({devicesInfo:a,user:b})});return{isDeviceMismatch:a,recipients:f}})}function b(a,b){return a.receipts.get(b).then(function(b){if(b==null)return{isDeviceMismatch:!1,recipients:[]};var c=[];b.statusTsPerUser.forEach(function(a,b){return c.push(b)});return d("MAWDbIdentityTxns").getIdentitiesForMultipleUsers(a,c,d("MAWGlobals").getMyDeviceJid()).then(function(a){var b=[];a.forEach(function(a,c){a=a.map(function(a){return{identity:a.identity,jid:a.deviceJid}});b.push({devicesInfo:a,user:c})});return{isDeviceMismatch:!1,recipients:b}})})}function m(a,b){if(a.size!==b.length)return!0;for(var c=0;c<b.length;c++){var d=b[c];if(!a.has(d))return!0}return!1}g.getMsgRecipients=a;g.getRevokedMsgRecipients=b}),98);
__d("MAWPendingReceiptProcessingTxns",["MAWBridgeMsgCountdown","MAWDbParticipant","MAWDbParticipantTxns","MAWDbPendingReceipt","MAWDbReceiptTxns","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralMsgTxns","MAWIncomingReceiptTxns","MAWIndexedDb","MAWMarkThreadAsReadTxns","WADualSendMsgUtils","WAJids","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing pending receipts for "," from ",""]);h=function(){return a};return a}function a(a,b,c){var e=d("MAWDbPendingReceipt").craftPendingReceiptId(b,c.externalId,c.author);return a.pendingReceipts.get(e).then(function(b){if(b==null)return;d("WALogger").LOG(h(),c.externalId,c.author);if(b.author===d("WAJids").AUTHOR_ME){var f=d("MAWDexieTable").dexieResolve();b.deliveryReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(a,c.msgId,"delivered",b.deliveryReceipts)}));b.readReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(a,c.msgId,"read",b.readReceipts)}));return f.then(function(b){var f=[],g=d("MAWDexieTable").dexieResolve();b!=null&&b.type!=="missing"&&(b.receipt.statusTsPerUser.forEach(function(b,e){var g=b.deliveredTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0),h=b.readTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0);b=(b=b.readTs)!=null?b:d("WATimeUtils").castToUnixTime(0);f.push(d("MAWDbParticipantTxns").updateParticipantTimestamps(a,d("MAWDbParticipant").craftParticipantId(c.thread,e),g,h,b,d("WADualSendMsgUtils").isDualSendJid(c.threadJid)))}),g=d("MAWEphemeralMsgTxns").bulkUpdateEphemeralMessageTimestamps(a,d("MAWIncomingReceiptTxns").createUpdateEphemeralTimestampsParams([b],new Map([[c.msgId,{msg:c,renderType:"regular"}]]))));return d("MAWDexieTable").dexieAll([g].concat(f)).then(function(b){b=b[0];if(b!=null){var c=b[0],f=b[1];b=b[2];c!=null&&f!=null&&d("MAWEphemeralCleaner").addNewEphemeralTimestamp(c,f);d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(b)})}a.pendingReceipts["delete"](e)})})}else{f=i(b);f=f!=null?d("MAWEphemeralMsgTxns").bulkMarkEphemeralMessageAsRead(a,[f]):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgId(a,c.thread,c.msgId),f]).then(function(){return a.pendingReceipts["delete"](e)})}})}function i(a){var b=a.author,c=a.externalId,e=a.readReceipts;a=a.thread;if(!d("WAJids").isAuthorMe(b)&&!d("WAJids").isAuthorSystem(b)){b={author:b,chat:a,externalId:c};a=e.length>0?e.reduce(function(a,b){return b.ts<a?b.ts:a},e[0].ts):null;if(a!=null)return{msgId:b,ts:a}}return null}g.processPendingReceipts=a}),98);
__d("MAWWriteBulkWriteIncomingAdminMsgTxns",["MAWAdminMsgBuildTxns","MAWDbThreadTxns","MAWDexieTable","MAWGating","MAWWriteMsgTxns","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OfflineBulkWriteAdminmsg - Missing thread when write e2ee thread description"]);h=function(){return a};return a}function a(a,b){return!d("MAWGating").isOccamadillo()?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThreadsByJids(a,b).then(function(b){var c=[],e=[];b.forEach(function(a){a==null&&d("WALogger").ERROR(h());var b=d("MAWAdminMsgBuildTxns").buildE2EEThreadDescriptionMsg(a);d("MAWWriteMsgTxns").writeIncomingE2EEThreadAdminMsg(b,a,c,e)});return d("MAWDexieTable").dexieAll([a.messages.bulkAdd(c),a.threads.bulkPut(e)]).then(function(){})})}g.writeE2EEAdminMsgsForIncomingCreatedThreads=a}),98);
__d("MAWLowLevelApiTypes",[],(function(a,b,c,d,e,f){"use strict";a={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"};b={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"};f.WRITE_GROUP_INVITE_ERROR=a;f.GET_GROUP_INVITE_ERROR=b}),66);
__d("WAGroupInviteUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.toInviteCode=a}),66);
__d("MAWWriteGroupInviteTxns",["MAWBridgeTypes","MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWJids","MAWLowLevelApiTypes","MAWThreadFetchAndEmitTxns","WAGroupInviteUtils","WAJids","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbThreadTxns").getThreadByJid(a,c).then(function(c){return!c.success?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP:d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,b.inviterJid,b.invitedParticipantId).then(function(c){return c&&!d("WATimeUtils").isInFuture(c.inviteExpirationTs)?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE:d("MAWDbGroupInviteTxns").putGroupInvite(a,b)})})}function b(a,b,c,e,f,g,h,i){if(b.groupJid==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));var j=d("MAWJids").toGroupJid(b.groupJid);if(b.inviteExpiration==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));var k=d("WATimeUtils").castLongIntToUnixTime(b.inviteExpiration);if(b.inviteCode==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));var l=d("WAGroupInviteUtils").toInviteCode(b.inviteCode),m=d("WAJids").interpretAsUserJid(c);return m==null?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"})):d("MAWThreadFetchAndEmitTxns").fetchOrSetupThread(a,j,g).then(function(b){return b==null?d("WAResultOrError").makeError({groupJid:j,inviteCode:l,inviteExpireTs:k,inviterJid:m,type:"group_invite"}):d("MAWDbParticipantTxns").getParticipant(a,b.thread.chatId,m)}).then(function(c){var e;if(!c.success)return d("WAResultOrError").makeError({groupJid:j,inviteCode:l,inviteExpireTs:k,inviterJid:m,type:"group_invite"});c=d("MAWDbParticipant").craftParticipantId(c.value.threadId,d("MAWGlobals").getMyUserJid());return d("MAWDbGroupInviteTxns").putGroupInvite(a,{caption:(e=b.caption)==null?void 0:e.text,inviteCode:l,invitedParticipantId:c,inviteExpirationTs:k,inviterJid:m}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypes").createBridgeGroupInvite(a)});return a})}).then(function(a){var b;return Object.prototype.hasOwnProperty.call(a,"error")&&((b=a.error)==null?void 0:b.type)==="group_invite"?d("WAResultOrError").makeError(babelHelpers["extends"]({},a.error)):d("WAResultOrError").makeResult({icdcResults:i,plaintextHashs:null,protocolMsgId:{author:e,chat:c,externalId:f},unknownDevice:h,unknownGroup:!1})})}g.writeGroupInvite=a;g.writeIncomingGroupInviteMsg=b}),98);
__d("MAWWriteMetaSyncsTxns",["MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbThreadTxns","MAWDexieTable","MAWThreadManagementTxns","MAWWriteMsgTxns","WAAssertUnreachable","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received action: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatRead: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No message found for deletion through handle meta sync action."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatDelete: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatArchive: ",""]);l=function(){return a};return a}var m=30*d("WATimeUtils").DAY_SECONDS;function n(a,b){d("WALogger").LOG(l(),b);return d("MAWDexieTable").dexieResolve()}function o(a,b){d("WALogger").LOG(k(),b);var c=b.messageRange;c=c!=null?d("MAWDbPendingStanzaTxns").putPendingStanza(a,{content:{metaSyncMessageRange:c},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD},m,b.chatJid,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThreadByJid(a,b.chatJid),c]).then(function(c){c=c[0];if(c.success)return d("MAWThreadManagementTxns").metaSyncChatDeleteThread(a,c.value,b.messageRange);else d("WALogger").ERROR(j())})}function p(a,b){d("WALogger").LOG(i(),b);return d("MAWDexieTable").dexieResolve()}function a(a,b){if(b.chatAction)return q(a,b.chatAction);else if(b.messageAction)return r(a,b.messageAction);return d("MAWDexieTable").dexieResolve()}function q(a,b){d("WALogger").LOG(h(),b);switch(b.type){case"chat_archive":return n(a,b);case"chat_delete":return o(a,b);default:b.type;return p(a,b)}}function r(a,b){switch(b.type){case"delete_for_me":return d("MAWWriteMsgTxns").handleDeleteForMe(a,b).then(function(){});default:return c("WAAssertUnreachable")(b.type)}}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=m;g.handleChatArchive=n;g.handleChatDelete=o;g.handleChatRead=p;g.handleMetaSyncAction=a}),98);
__d("MAWXMAExpirationTxns",["MAWAuthor","MAWDbMsgTxns","MAWDexieTable","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbMsgTxns").getMsgsByMsgIds(a,b).then(function(b){var c=b.map(function(a){if(a.quote!=null&&d("MAWXMAUtils").isXMAStoryReply(a.quote.content.xmaMessageType)){var b=babelHelpers["extends"]({},a.quote.content,{mediaId:void 0});b={content:b,remoteJid:a.quote.remoteJid};return babelHelpers["extends"]({},a,{quote:b})}}).filter(Boolean);return a.messages.bulkPut(c).then(function(){return c})})}function b(a,b){b=b.map(function(b){return h(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.flat()})}function h(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.messages.where("quoteExternalId").equals(b.externalId).toArray().then(function(a){return a.length===0?[]:a.filter(function(a){var e=a.quote;a=a.threadJid;return d("MAWAuthor").getAuthorUserJid(e==null?void 0:e.content.author)===c&&a===b.chat})})}g.updateExpiredStoryReplyMsg=a;g.getXMAShareReplyMsgsToUpdate=b}),98);
__d("MessagingArmadilloThreadCutoverNonTALClientDomain",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS:"MessengerCutoverDasmNativeOperations"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER:"CompleteCutover",ARMADILLO_CUTOVER_CLIENT_EVENT_THREAD_FETCH:"ThreadFetch"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEventDetails",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_SUCCESS:"Success",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES:"AppendAdminMessages",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_GENERIC_ERROR:"GenericError",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD:"MissingActThread",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED:"ThreadAlreadyMigrated"});f["default"]=a}),66);
__d("MAWAdminWriteCutoverThreadMsgTxn",["MAWAdminMsgBuildTxns","MAWBridge","MAWBridgeMsg","MAWBridgeTypes","MAWDbMsg","MAWDbThreadTxns","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWThreadSnippetBuildTxns","MAWWriteMsgTxns","MessagingArmadilloThreadCutoverNonTALClientDomain","MessagingArmadilloThreadCutoverNonTALClientEvent","MessagingArmadilloThreadCutoverNonTALClientEventDetails","WADualSendMsgUtils","WAJids","WALogger","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cutoverThreadAdminMessage failed to get the thread"]);h=function(){return a};return a}function i(a,b,e,f,g){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}});d("MAWBridge").getBridge().fireAndForget("event","logCutoverEvent",{armadilloThreadId:a,domain:c("MessagingArmadilloThreadCutoverNonTALClientDomain").ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS,event:c("MessagingArmadilloThreadCutoverNonTALClientEvent").ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER,eventDetails:f,openThreadId:b,success:g,traceId:e})}function a(a,b,e,f){return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(g){var j=function(a,c){i(b,e,f,a,c)};if(!g.success){d("WALogger").WARN(h());j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD,!1);return{needsMarkThreadAsMigrated:!1}}var k=g.value;if(k.isMigratedLocally===!0){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED,!0);return{needsMarkThreadAsMigrated:!1}}g=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(k.chatId);var l=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(k.chatId);return a.messages.where("altIndex").equals(g).first().then(function(b){if(!b){var e=d("MAWDbMsg").craftMsgId(k.chatId,k.nextInChatMsgId);e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,version:1},k.chatId,k.jid,e,d("WATimeUtils").castToUnixTime(0),l);return d("MAWWriteMsgTxns").writeMsg(a,e,k,{sortOrderMs:0}).then(function(){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})}var f=babelHelpers["extends"]({},b,{altIndex:l,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE},type:d("WAMsgType").MSG_TYPE.ADMIN});return a.messages.put(f).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f)});return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,f,k).then(function(a){var b=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(k.jid),snippetParams:b,snippetSenderContactId:e,snippetType:a,threadId:k.chatId})});j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})})})})}function b(a,b){var c=d("MAWDbMsg").craftMsgId(b.chatId,b.nextInChatMsgId);c=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE},b.chatId,b.jid,c);return d("MAWWriteMsgTxns").writeMsg(a,c,b).then(function(){})}function e(a,b){var c=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(b.chatId),e=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(b.chatId);return a.messages.where("altIndex").equals(e).first().then(function(f){if(f!=null)return;return a.messages.where("altIndex").equals(c).first().then(function(c){if(!c){var f=d("MAWAdminMsgBuildTxns").buildE2EEThreadDescriptionMsg(b);return d("MAWWriteMsgTxns").writeMsg(a,f,b,{sortOrderMs:0}).then(function(){return})}var g=babelHelpers["extends"]({},c,{altIndex:e,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION},type:d("WAMsgType").MSG_TYPE.ADMIN});return a.messages.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,g,b).then(function(a){var c=a.snippetParams,e=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(b.jid),snippetParams:c,snippetSenderContactId:e,snippetType:a,threadId:b.chatId})});return})})})})}g.writeCutoverThreadAdminMsg=a;g.writeRollbackCutoverAdminMsg=b;g.revertCutoverThreadAdminMsg=e}),98);
__d("MAWAdminWriteUsersConnectedMsgTxn",["MAWDbMsg","MAWDbThreadTxns","MAWLocalizationType","MAWLocalizationUtils","MAWWriteMsgTxns","WALogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg found an empty thread, which we'll not append to."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg failed to create or get 1:1 thread"]);i=function(){return a};return a}function a(a,b){return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){if(!b.success){d("WALogger").WARN(i());return}else if(b.value.newestMsg==null){d("WALogger").WARN(h());return}b=b.value;var e=d("MAWDbMsg").craftMsgId(b.chatId,b.nextInChatMsgId);e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED,version:1},b.chatId,b.jid,e,d("WATimeUtils").castMillisTimeToUnixTime(b.lastReadMsgTs));return d("MAWWriteMsgTxns").writeMsg(a,e,b).then(c("emptyFunction"))})}g.writeUsersConnectedAdminMsg=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWBulkPutReactionsWithThreadUpdateTxn",["MAWBridgeTypes","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWThreadSnippetBuildTxns","WAArrayGroupBy","WADualSendMsgUtils","WAMsgMap","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){if(b.length===0)return d("MAWDexieTable").dexieResolve();var f=Array.from(e.values()).map(function(a){return a.chatId});return a.groupInfo.where("threadId").anyOf(f).toArray().then(function(f){var g=new Set(f.map(function(a){return a.groupJid}));f=d("WAArrayGroupBy").groupBy(b,function(a){a=a.threadJid;return a});var h=[],i=[],j=b.reduce(function(a,b){var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.reactToExternalId);if(c==null)return a;a.set(c,d("MAWDbReactionsTxns").coerceToReaction(b));return a},new(d("WAMsgMap").MsgMap)());j.entries().forEach(function(a){var b=a[0];a=a[1];b=b.chat;b=e.get(b);if(b==null)throw c("err")("Should not have got here - expect thread to exist for flow");i.push(a);d("MAWDbReactionUtils").dispatchReaction(a,b.chatId)});f.forEach(function(a){var b=a[0];a=a[1];b=e.get(b);if(b==null||a.length===0)return;var c=babelHelpers["extends"]({},b,{nextInChatMsgId:b.nextInChatMsgId+a.length});h.push(c);c=a.filter(function(a){return d("MAWDbReactionsTxns").isIncomingReaction(a)});a=c[c.length-1];if(a!=null){c=d("MAWThreadSnippetBuildTxns").getReactionSnippetParams(a.author,a.reaction,g.has(b.jid));a=c.snippetParams;var f=c.snippetSenderContactId;c=c.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:d("WADualSendMsgUtils").isDualSendJid(b.jid),snippetParams:a,snippetSenderContactId:f,snippetType:c,threadId:b.chatId})})}});return d("MAWDexieTable").dexieAll([a.threads.bulkPut(h),a.reactions.bulkPut(i)]).then(function(){})})}g.bulkPutReactionsWithThreadUpdates=a}),98);
__d("MAWBulkWriteReactionsTxns",["MAWAuthor","MAWBulkPutReactionsWithThreadUpdateTxn","MAWDbReaction","MAWDexieTable","WAArrayGroupBy","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=[];b.forEach(function(a){var b=a.chatJid;a=a.unstoredReaction;a=a.reactToExternalId;e.push(b);f.push(a)});return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.messages.where("externalId").anyOf(f).toArray(),a.reactions.where("reactToExternalId").anyOf(f).toArray()]).then(function(e){var f=e[0],g=e[1];e=e[2];var h=new Map(f.map(function(a){return[a.jid,a]})),i=new Map(d("WAArrayGroupBy").groupBy(g,function(a){return a.externalId})),j=new Map(d("WAArrayGroupBy").groupBy(e,function(a){return a.reactToExternalId})),k=new Set(),l=[],m=f.reduce(function(a,b){return a.set(b.jid,b.nextInChatMsgId)},new Map());b.forEach(function(a){var b=a.chatJid;a=a.unstoredReaction;var e=a.author,f=a.externalId,g=a.groupingKey,n=a.reaction,o=a.reactToAuthor,p=a.reactToExternalId,q=a.ts,r=h.get(b);if(r==null)return"missing_thread";b=m.get(r.jid);if(b==null)throw c("err")("nextInChatMsgId should not be null");m.set(r.jid,b+1);b=d("MAWDbReaction").craftReactionId(r.chatId,b);var s=j.get(a.reactToExternalId)||[];s=d("MAWDbReaction").findMatchingReaction(s,r.jid,e);var t=d("MAWAuthor").getAuthorUserJid(o);a=i.get(a.reactToExternalId);a=a==null?void 0:a.find(function(a){return a.thread===r.chatId&&t===d("MAWAuthor").getAuthorUserJid(a.author)});b=d("MAWDbReaction").formatReaction(r.jid,f,b,p,n,g,o,a==null?void 0:a.msgId,q,(f=e)!=null?f:d("WAJids").AUTHOR_ME,s==null?void 0:s.rowId);(s==null?void 0:s.reactionId)!=null&&k.add(s==null?void 0:s.reactionId);l.push(b)});g=k.size>0?a.receipts.where("msgId").anyOf(Array.from(k))["delete"]():d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWBulkPutReactionsWithThreadUpdateTxn").bulkPutReactionsWithThreadUpdates(a,l,h),g]).then(function(){})})}g.bulkWriteReactions=a}),98);
__d("MAWUnstoredQuotedMsgUtils",["WAErr","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a==null)return;var b=a.content;a=a.remoteJid;var e;switch(b.type){case d("WAMsgType").MSG_TYPE.TEXT:e=j(b);break;case d("WAMsgType").MSG_TYPE.IMAGE:e=k(b);break;case d("WAMsgType").MSG_TYPE.VIDEO:e=l(b);break;case d("WAMsgType").MSG_TYPE.PTT:e=m(b);break;case d("WAMsgType").MSG_TYPE.GIF:e=n(b);break;case d("WAMsgType").MSG_TYPE.STICKER:e=o(b);break;case d("WAMsgType").MSG_TYPE.UNAVAILABLE:e=p(b);break;case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:e=q(b);break;default:b.type;throw c("WAErr")("For flow")}return{content:e,remoteJid:a}}function i(a){if(d("WAJids").isAuthorSystem(a.author))throw c("WAErr")("A system message cannot be quoted");return{author:a.author,externalId:a.externalId,ts:a.ts}}function j(a){return babelHelpers["extends"]({},i(a),{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT})}function k(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.IMAGE})}function l(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.VIDEO})}function m(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.PTT})}function n(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.GIF})}function o(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.STICKER})}function p(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.UNAVAILABLE})}function q(a){return babelHelpers["extends"]({},i(a),{type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL})}function a(a){return{quote:h(a.quote)}}g.getWithQuoteMsg=a}),98);
__d("MAWUnstoredTypedMsgUtils",["MAWDbMsg","MAWUnstoredQuotedMsgUtils","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{ack:a.ack,author:a.id.author,externalId:a.id.externalId,reportingMeta:a.reportingMeta,serverTs:a.serverTs,ts:a.ts}}function i(a){return{forwardingScore:0,isForwarded:a.isForwarded}}function j(a){return{ephemeralSetting:k(a.ephemeralSetting),messageDeleteTs:a.deleteTs,messageExpirationTs:a.expirationTs}}function k(a){if(a==null)return;return{ephemeralExpirationInSec:a.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.updatedTs}}function a(a,b){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:b.targetType})}function b(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,msgContent:a.msgContent,specialTextSize:a.specialTextSize,type:d("WAMsgType").MSG_TYPE.TEXT})}function c(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.IMAGE})}function e(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.VIDEO})}function f(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.PTT})}function l(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType}}function m(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_SYSTEM,msgContent:l(a.msgContent),type:d("WAMsgType").MSG_TYPE.ADMIN})}function n(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.GIF})}function o(a){return babelHelpers["extends"]({},h(a),i(a),d("MAWUnstoredQuotedMsgUtils").getWithQuoteMsg(a),j(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,type:d("WAMsgType").MSG_TYPE.STICKER})}function p(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").FUTUREPROOF_ALT_INDEX,msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.FUTUREPROOF})}function q(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,revokedExternalId:a.revokedExternalId,type:d("WAMsgType").MSG_TYPE.REVOKED})}function r(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType}}function s(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,msgContent:r(a.msgContent),type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN})}function t(a){return{adminMsgContent:a.adminMsgContent,adminType:a.adminType,screenshotActionType:a.screenshotActionType}}function u(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,msgContent:t(a.msgContent),type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION})}function v(a){return{adminType:a.adminType,authorName:a.authorName}}function w(a){return babelHelpers["extends"]({},h(a),{altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,msgContent:v(a.msgContent),type:d("WAMsgType").MSG_TYPE.ICDC_ALERT})}g.getXMAMsg=a;g.getTextMsg=b;g.getImageMsg=c;g.getVideoMsg=e;g.getPttMsg=f;g.getAdminMsg=m;g.getGifMsg=n;g.getStickerMsg=o;g.getFutureproofMsg=p;g.getRevokedMsg=q;g.getEphemeralSettingAdminMsg=s;g.getEphemeralScreenshotActionMsg=u;g.getICDCAlertMsg=w}),98);
__d("MAWUnstoredMsgUtils",["MAWUnstoredTypedMsgUtils","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.unstoredMsg;a=a.unstoredXMA;if(b==null)return null;switch(b.type){case d("WAMsgType").MSG_TYPE.TEXT:return d("MAWUnstoredTypedMsgUtils").getTextMsg(b);case d("WAMsgType").MSG_TYPE.IMAGE:return d("MAWUnstoredTypedMsgUtils").getImageMsg(b);case d("WAMsgType").MSG_TYPE.VIDEO:return d("MAWUnstoredTypedMsgUtils").getVideoMsg(b);case d("WAMsgType").MSG_TYPE.PTT:return d("MAWUnstoredTypedMsgUtils").getPttMsg(b);case d("WAMsgType").MSG_TYPE.ADMIN:return d("MAWUnstoredTypedMsgUtils").getAdminMsg(b);case d("WAMsgType").MSG_TYPE.FUTUREPROOF:return d("MAWUnstoredTypedMsgUtils").getFutureproofMsg(b);case d("WAMsgType").MSG_TYPE.REVOKED:return d("MAWUnstoredTypedMsgUtils").getRevokedMsg(b);case d("WAMsgType").MSG_TYPE.GIF:return d("MAWUnstoredTypedMsgUtils").getGifMsg(b);case d("WAMsgType").MSG_TYPE.STICKER:return d("MAWUnstoredTypedMsgUtils").getStickerMsg(b);case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("MAWUnstoredTypedMsgUtils").getEphemeralSettingAdminMsg(b);case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("MAWUnstoredTypedMsgUtils").getEphemeralScreenshotActionMsg(b);case d("WAMsgType").MSG_TYPE.ICDC_ALERT:return d("MAWUnstoredTypedMsgUtils").getICDCAlertMsg(b);case d("WAMsgType").MSG_TYPE.XMA:if((a==null?void 0:a.xma)==null)throw c("err")("XMA content cannot be parsed without XMA payload");return d("MAWUnstoredTypedMsgUtils").getXMAMsg(b,a==null?void 0:a.xma);case d("WAMsgType").MSG_TYPE.REACTION:return null;default:b.type;return null}}function b(a){return a==null?null:d("MAWUnstoredTypedMsgUtils").getTextMsg(a)}function e(a){a=a.unstoredMsg;if(!a||a.type!==d("WAMsgType").MSG_TYPE.REACTION)return null;a=a;return{ack:a.ack,author:a.id.author,externalId:a.id.externalId,groupingKey:a.groupingKey,reaction:a.reaction,reactToAuthor:a.reactToAuthor,reactToExternalId:a.reactToExternalId,threadJid:a.id.chat,ts:a.ts}}function f(a){a=a.unstoredIncomingGroupInvite;return!a?null:babelHelpers["extends"]({},a)}g.getUnstoredMsg=a;g.getUnstoredAssociatedMsg=b;g.getUnstoredReaction=e;g.getGroupInvite=f}),98);
__d("MAWUnstoredMediaUtils",["MAWUnstoredMsgUtils","WASortedLists"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null?null:{mediaEntry:a.mediaEntry,mediaType:a.mediaType,msgIds:d("WASortedLists").emptySet(),plaintextHash:a.plaintextHash,size:a.size,ts:a.ts,validatedAudioInfo:a.validatedAudioInfo,validatedImageInfo:a.validatedImageInfo,validatedVideoInfo:a.validatedVideoInfo}}function a(a){a=a.unstoredXMA;if(a==null)return;var b=a.unstoredAssociatedMsg,c=a.unstoredFavicon,e=a.unstoredHeaderMedia,f=a.unstoredPreviews;a=a.xma;return{unstoredAssociatedMsg:(b=d("MAWUnstoredMsgUtils").getUnstoredAssociatedMsg(b))!=null?b:void 0,unstoredDbXMA:{author:a.author,ctas:a.ctas,defaultCTA:a.defaultCTA,externalId:a.externalId,headerTitle:a.headerTitle,isTombstoned:a.isTombstoned,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines,maxTitleNumOfLines:a.maxTitleNumOfLines,overlayDescription:a.overlayDescription,overlayIconGlyph:a.overlayIconGlyph,overlayTitle:a.overlayTitle,subtitleText:a.subtitleText,targetExpiringAtSec:a.targetExpiringAtSec,targetId:a.targetId,targetType:a.targetType,targetUsername:a.targetUsername,threadJid:a.threadJid,titleText:a.titleText,xmaLayoutType:a.xmaLayoutType},unstoredFavicon:(b=h(c))!=null?b:void 0,unstoredHeaderMedia:(a=h(e))!=null?a:void 0,unstoredPreviews:f?f.map(function(a){return h(a)}).filter(Boolean):void 0}}g.getUnstoredMedia=h;g.getUnstoredXMA=a}),98);
__d("MAWUnstoredContentToUnstoredDbContentUtils",["MAWUnstoredMediaUtils","MAWUnstoredMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MAWUnstoredMsgUtils").getUnstoredMsg(a),c=d("MAWUnstoredMediaUtils").getUnstoredMedia(a.unstoredMedia),e=d("MAWUnstoredMsgUtils").getUnstoredReaction(a),f=d("MAWUnstoredMediaUtils").getUnstoredXMA(a);a=d("MAWUnstoredMsgUtils").getGroupInvite(a);if(a==null)return{unstoredDbMedia:c,unstoredDbMsg:b,unstoredDbReaction:e,unstoredXMA:f};else return{unstoredDbMedia:c,unstoredDbMsg:b,unstoredDbReaction:e,unstoredIncomingDbGroupInvite:a,unstoredXMA:f}}g.unstoredContentToUnstoredDbContent=a}),98);
__d("WAProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a=babelHelpers["extends"]({},null);a.internalSpec={remoteJid:[1,d("WAProtoConst").TYPES.STRING],fromMe:[2,d("WAProtoConst").TYPES.BOOL],id:[3,d("WAProtoConst").TYPES.STRING],participant:[4,d("WAProtoConst").TYPES.STRING]};g.MessageKeySpec=a}),98);
__d("WAE2E.pb",["WAProtoConst","WAProtocol.pb"],(function(a,b,c,d,e,f,g){"use strict";a={UNKNOWN:0,SINGLE_SELECT:1};b={UNKNOWN:0,SINGLE_SELECT:1};c={CATALOG:1};e={INQUIRY:1};f={GREGORIAN:1,SOLAR_HIJRI:2};var aa={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7},ba={INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4},ca={REVOKE:0,EPHEMERAL_SETTING:3,EPHEMERAL_SYNC_RESPONSE:4,HISTORY_SYNC_NOTIFICATION:5,APP_STATE_SYNC_KEY_SHARE:6,APP_STATE_SYNC_KEY_REQUEST:7,MSG_FANOUT_BACKFILL_REQUEST:8,INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:9},da={NONE:0,GIPHY:1,TENOR:2},ea={NONE:0,VIDEO:1},fa={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5},ga={IMAGE:0,PDF:1},ha={NONE:0,IMAGE:1,VIDEO:2},ia={NONE:0,IMAGE:1,VIDEO:2},h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={},N={},O={},P={},Q={},R={},ja={},ka={},la={},ma={},S={},na={},oa={},pa={},qa={},ra={},T={},sa={},U={},ta={},V={},W={},ua={},X={},Y={},Z={},va={},wa={},xa={},ya={},$={},za={},Aa={},Ba={},Ca={},Da={},Ea={},Fa={},Ga={},Ha={},Ia={};h.internalSpec={conversation:[1,d("WAProtoConst").TYPES.STRING],senderKeyDistributionMessage:[2,d("WAProtoConst").TYPES.MESSAGE,Y],imageMessage:[3,d("WAProtoConst").TYPES.MESSAGE,X],contactMessage:[4,d("WAProtoConst").TYPES.MESSAGE,W],locationMessage:[5,d("WAProtoConst").TYPES.MESSAGE,V],extendedTextMessage:[6,d("WAProtoConst").TYPES.MESSAGE,ta],documentMessage:[7,d("WAProtoConst").TYPES.MESSAGE,U],audioMessage:[8,d("WAProtoConst").TYPES.MESSAGE,sa],videoMessage:[9,d("WAProtoConst").TYPES.MESSAGE,T],call:[10,d("WAProtoConst").TYPES.MESSAGE,ra],chat:[11,d("WAProtoConst").TYPES.MESSAGE,qa],protocolMessage:[12,d("WAProtoConst").TYPES.MESSAGE,pa],contactsArrayMessage:[13,d("WAProtoConst").TYPES.MESSAGE,Q],highlyStructuredMessage:[14,d("WAProtoConst").TYPES.MESSAGE,K],fastRatchetKeySenderKeyDistributionMessage:[15,d("WAProtoConst").TYPES.MESSAGE,Y],sendPaymentMessage:[16,d("WAProtoConst").TYPES.MESSAGE,J],liveLocationMessage:[18,d("WAProtoConst").TYPES.MESSAGE,E],requestPaymentMessage:[22,d("WAProtoConst").TYPES.MESSAGE,I],declinePaymentRequestMessage:[23,d("WAProtoConst").TYPES.MESSAGE,G],cancelPaymentRequestMessage:[24,d("WAProtoConst").TYPES.MESSAGE,F],templateMessage:[25,d("WAProtoConst").TYPES.MESSAGE,A],stickerMessage:[26,d("WAProtoConst").TYPES.MESSAGE,D],groupInviteMessage:[28,d("WAProtoConst").TYPES.MESSAGE,p],templateButtonReplyMessage:[29,d("WAProtoConst").TYPES.MESSAGE,z],productMessage:[30,d("WAProtoConst").TYPES.MESSAGE,w],deviceSentMessage:[31,d("WAProtoConst").TYPES.MESSAGE,n],messageContextInfo:[35,d("WAProtoConst").TYPES.MESSAGE,xa],listMessage:[36,d("WAProtoConst").TYPES.MESSAGE,s],viewOnceMessage:[37,d("WAProtoConst").TYPES.MESSAGE,m],orderMessage:[38,d("WAProtoConst").TYPES.MESSAGE,v],listResponseMessage:[39,d("WAProtoConst").TYPES.MESSAGE,q],ephemeralMessage:[40,d("WAProtoConst").TYPES.MESSAGE,m],invoiceMessage:[41,d("WAProtoConst").TYPES.MESSAGE,ua],buttonsMessage:[42,d("WAProtoConst").TYPES.MESSAGE,j],buttonsResponseMessage:[43,d("WAProtoConst").TYPES.MESSAGE,i]};i.internalSpec={selectedButtonId:[1,d("WAProtoConst").TYPES.STRING],selectedDisplayText:[2,d("WAProtoConst").TYPES.STRING],contextInfo:[3,d("WAProtoConst").TYPES.MESSAGE,Z]};j.internalSpec={titleText:[1,d("WAProtoConst").TYPES.STRING],documentMessage:[2,d("WAProtoConst").TYPES.MESSAGE,U],imageMessage:[3,d("WAProtoConst").TYPES.MESSAGE,X],videoMessage:[4,d("WAProtoConst").TYPES.MESSAGE,T],locationMessage:[5,d("WAProtoConst").TYPES.MESSAGE,V],contentText:[6,d("WAProtoConst").TYPES.STRING],footerText:[7,d("WAProtoConst").TYPES.STRING],contextInfo:[8,d("WAProtoConst").TYPES.MESSAGE,Z],buttons:[9,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,k],__oneofs__:{title:["titleText","documentMessage","imageMessage","videoMessage","locationMessage"]}};k.internalSpec={buttonId:[1,d("WAProtoConst").TYPES.STRING],buttonText:[2,d("WAProtoConst").TYPES.MESSAGE,l]};l.internalSpec={displayText:[1,d("WAProtoConst").TYPES.STRING]};m.internalSpec={message:[1,d("WAProtoConst").TYPES.MESSAGE,h]};n.internalSpec={destinationJid:[1,d("WAProtoConst").TYPES.STRING],message:[2,d("WAProtoConst").TYPES.MESSAGE,h],phash:[3,d("WAProtoConst").TYPES.STRING],broadcastEphemeralSettings:[4,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,o]};o.internalSpec={chatJid:[1,d("WAProtoConst").TYPES.STRING],ephemeralExpiration:[2,d("WAProtoConst").TYPES.UINT32],ephemeralSettingTimestamp:[3,d("WAProtoConst").TYPES.INT64]};p.internalSpec={groupJid:[1,d("WAProtoConst").TYPES.STRING],inviteCode:[2,d("WAProtoConst").TYPES.STRING],inviteExpiration:[3,d("WAProtoConst").TYPES.INT64],groupName:[4,d("WAProtoConst").TYPES.STRING],jpegThumbnail:[5,d("WAProtoConst").TYPES.BYTES],caption:[6,d("WAProtoConst").TYPES.STRING],contextInfo:[7,d("WAProtoConst").TYPES.MESSAGE,Z]};q.internalSpec={title:[1,d("WAProtoConst").TYPES.STRING],listType:[2,d("WAProtoConst").TYPES.ENUM,a],singleSelectReply:[3,d("WAProtoConst").TYPES.MESSAGE,r],contextInfo:[4,d("WAProtoConst").TYPES.MESSAGE,Z],description:[5,d("WAProtoConst").TYPES.STRING]};r.internalSpec={selectedRowId:[1,d("WAProtoConst").TYPES.STRING]};s.internalSpec={title:[1,d("WAProtoConst").TYPES.STRING],description:[2,d("WAProtoConst").TYPES.STRING],buttonText:[3,d("WAProtoConst").TYPES.STRING],listType:[4,d("WAProtoConst").TYPES.ENUM,b],sections:[5,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,t]};t.internalSpec={title:[1,d("WAProtoConst").TYPES.STRING],rows:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,u]};u.internalSpec={title:[1,d("WAProtoConst").TYPES.STRING],description:[2,d("WAProtoConst").TYPES.STRING],rowId:[3,d("WAProtoConst").TYPES.STRING]};v.internalSpec={orderId:[1,d("WAProtoConst").TYPES.STRING],thumbnail:[2,d("WAProtoConst").TYPES.BYTES],itemCount:[3,d("WAProtoConst").TYPES.INT32],status:[4,d("WAProtoConst").TYPES.ENUM,e],surface:[5,d("WAProtoConst").TYPES.ENUM,c],message:[6,d("WAProtoConst").TYPES.STRING],orderTitle:[7,d("WAProtoConst").TYPES.STRING],sellerJid:[8,d("WAProtoConst").TYPES.STRING],token:[9,d("WAProtoConst").TYPES.STRING],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};w.internalSpec={product:[1,d("WAProtoConst").TYPES.MESSAGE,x],businessOwnerJid:[2,d("WAProtoConst").TYPES.STRING],catalog:[4,d("WAProtoConst").TYPES.MESSAGE,y],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};x.internalSpec={productImage:[1,d("WAProtoConst").TYPES.MESSAGE,X],productId:[2,d("WAProtoConst").TYPES.STRING],title:[3,d("WAProtoConst").TYPES.STRING],description:[4,d("WAProtoConst").TYPES.STRING],currencyCode:[5,d("WAProtoConst").TYPES.STRING],priceAmount1000:[6,d("WAProtoConst").TYPES.INT64],retailerId:[7,d("WAProtoConst").TYPES.STRING],url:[8,d("WAProtoConst").TYPES.STRING],productImageCount:[9,d("WAProtoConst").TYPES.UINT32],firstImageId:[11,d("WAProtoConst").TYPES.STRING]};y.internalSpec={catalogImage:[1,d("WAProtoConst").TYPES.MESSAGE,X],title:[2,d("WAProtoConst").TYPES.STRING],description:[3,d("WAProtoConst").TYPES.STRING]};z.internalSpec={selectedId:[1,d("WAProtoConst").TYPES.STRING],selectedDisplayText:[2,d("WAProtoConst").TYPES.STRING],contextInfo:[3,d("WAProtoConst").TYPES.MESSAGE,Z],selectedIndex:[4,d("WAProtoConst").TYPES.UINT32]};A.internalSpec={fourRowTemplate:[1,d("WAProtoConst").TYPES.MESSAGE,C],hydratedFourRowTemplate:[2,d("WAProtoConst").TYPES.MESSAGE,B],contextInfo:[3,d("WAProtoConst").TYPES.MESSAGE,Z],hydratedTemplate:[4,d("WAProtoConst").TYPES.MESSAGE,B],__oneofs__:{format:["fourRowTemplate","hydratedFourRowTemplate"]}};B.internalSpec={documentMessage:[1,d("WAProtoConst").TYPES.MESSAGE,U],hydratedTitleText:[2,d("WAProtoConst").TYPES.STRING],imageMessage:[3,d("WAProtoConst").TYPES.MESSAGE,X],videoMessage:[4,d("WAProtoConst").TYPES.MESSAGE,T],locationMessage:[5,d("WAProtoConst").TYPES.MESSAGE,V],hydratedContentText:[6,d("WAProtoConst").TYPES.STRING],hydratedFooterText:[7,d("WAProtoConst").TYPES.STRING],hydratedButtons:[8,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,Fa],templateId:[9,d("WAProtoConst").TYPES.STRING],__oneofs__:{title:["documentMessage","hydratedTitleText","imageMessage","videoMessage","locationMessage"]}};C.internalSpec={documentMessage:[1,d("WAProtoConst").TYPES.MESSAGE,U],highlyStructuredMessage:[2,d("WAProtoConst").TYPES.MESSAGE,K],imageMessage:[3,d("WAProtoConst").TYPES.MESSAGE,X],videoMessage:[4,d("WAProtoConst").TYPES.MESSAGE,T],locationMessage:[5,d("WAProtoConst").TYPES.MESSAGE,V],content:[6,d("WAProtoConst").TYPES.MESSAGE,K],footer:[7,d("WAProtoConst").TYPES.MESSAGE,K],buttons:[8,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,Ba],__oneofs__:{title:["documentMessage","highlyStructuredMessage","imageMessage","videoMessage","locationMessage"]}};D.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],fileSha256:[2,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[3,d("WAProtoConst").TYPES.BYTES],mediaKey:[4,d("WAProtoConst").TYPES.BYTES],mimetype:[5,d("WAProtoConst").TYPES.STRING],height:[6,d("WAProtoConst").TYPES.UINT32],width:[7,d("WAProtoConst").TYPES.UINT32],directPath:[8,d("WAProtoConst").TYPES.STRING],fileLength:[9,d("WAProtoConst").TYPES.UINT64],mediaKeyTimestamp:[10,d("WAProtoConst").TYPES.INT64],firstFrameLength:[11,d("WAProtoConst").TYPES.UINT32],firstFrameSidecar:[12,d("WAProtoConst").TYPES.BYTES],isAnimated:[13,d("WAProtoConst").TYPES.BOOL],pngThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};E.internalSpec={degreesLatitude:[1,d("WAProtoConst").TYPES.DOUBLE],degreesLongitude:[2,d("WAProtoConst").TYPES.DOUBLE],accuracyInMeters:[3,d("WAProtoConst").TYPES.UINT32],speedInMps:[4,d("WAProtoConst").TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[5,d("WAProtoConst").TYPES.UINT32],caption:[6,d("WAProtoConst").TYPES.STRING],sequenceNumber:[7,d("WAProtoConst").TYPES.INT64],timeOffset:[8,d("WAProtoConst").TYPES.UINT32],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};F.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec]};G.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec]};H.internalSpec={value:[1,d("WAProtoConst").TYPES.INT64],offset:[2,d("WAProtoConst").TYPES.UINT32],currencyCode:[3,d("WAProtoConst").TYPES.STRING]};I.internalSpec={noteMessage:[4,d("WAProtoConst").TYPES.MESSAGE,h],currencyCodeIso4217:[1,d("WAProtoConst").TYPES.STRING],amount1000:[2,d("WAProtoConst").TYPES.UINT64],requestFrom:[3,d("WAProtoConst").TYPES.STRING],expiryTimestamp:[5,d("WAProtoConst").TYPES.INT64],amount:[6,d("WAProtoConst").TYPES.MESSAGE,H]};J.internalSpec={noteMessage:[2,d("WAProtoConst").TYPES.MESSAGE,h],requestMessageKey:[3,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec]};K.internalSpec={namespace:[1,d("WAProtoConst").TYPES.STRING],elementName:[2,d("WAProtoConst").TYPES.STRING],params:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.STRING],fallbackLg:[4,d("WAProtoConst").TYPES.STRING],fallbackLc:[5,d("WAProtoConst").TYPES.STRING],localizableParams:[6,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,L],deterministicLg:[7,d("WAProtoConst").TYPES.STRING],deterministicLc:[8,d("WAProtoConst").TYPES.STRING],hydratedHsm:[9,d("WAProtoConst").TYPES.MESSAGE,A]};L.internalSpec={"default":[1,d("WAProtoConst").TYPES.STRING],currency:[2,d("WAProtoConst").TYPES.MESSAGE,P],dateTime:[3,d("WAProtoConst").TYPES.MESSAGE,M],__oneofs__:{paramOneof:["currency","dateTime"]}};M.internalSpec={component:[1,d("WAProtoConst").TYPES.MESSAGE,O],unixEpoch:[2,d("WAProtoConst").TYPES.MESSAGE,N],__oneofs__:{datetimeOneof:["component","unixEpoch"]}};N.internalSpec={timestamp:[1,d("WAProtoConst").TYPES.INT64]};O.internalSpec={dayOfWeek:[1,d("WAProtoConst").TYPES.ENUM,aa],year:[2,d("WAProtoConst").TYPES.UINT32],month:[3,d("WAProtoConst").TYPES.UINT32],dayOfMonth:[4,d("WAProtoConst").TYPES.UINT32],hour:[5,d("WAProtoConst").TYPES.UINT32],minute:[6,d("WAProtoConst").TYPES.UINT32],calendar:[7,d("WAProtoConst").TYPES.ENUM,f]};P.internalSpec={currencyCode:[1,d("WAProtoConst").TYPES.STRING],amount1000:[2,d("WAProtoConst").TYPES.INT64]};Q.internalSpec={displayName:[1,d("WAProtoConst").TYPES.STRING],contacts:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,W],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};R.internalSpec={securityNotificationEnabled:[1,d("WAProtoConst").TYPES.BOOL]};ja.internalSpec={keyIds:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,S]};ka.internalSpec={keys:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,na]};la.internalSpec={keyData:[1,d("WAProtoConst").TYPES.BYTES],fingerprint:[2,d("WAProtoConst").TYPES.MESSAGE,ma],timestamp:[3,d("WAProtoConst").TYPES.INT64]};ma.internalSpec={rawId:[1,d("WAProtoConst").TYPES.UINT32],currentIndex:[2,d("WAProtoConst").TYPES.UINT32],deviceIndexes:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").FLAGS.PACKED|d("WAProtoConst").TYPES.UINT32]};S.internalSpec={keyId:[1,d("WAProtoConst").TYPES.BYTES]};na.internalSpec={keyId:[1,d("WAProtoConst").TYPES.MESSAGE,S],keyData:[2,d("WAProtoConst").TYPES.MESSAGE,la]};oa.internalSpec={fileSha256:[1,d("WAProtoConst").TYPES.BYTES],fileLength:[2,d("WAProtoConst").TYPES.UINT64],mediaKey:[3,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[4,d("WAProtoConst").TYPES.BYTES],directPath:[5,d("WAProtoConst").TYPES.STRING],syncType:[6,d("WAProtoConst").TYPES.ENUM,ba],chunkOrder:[7,d("WAProtoConst").TYPES.UINT32],originalMessageId:[8,d("WAProtoConst").TYPES.STRING]};pa.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec],type:[2,d("WAProtoConst").TYPES.ENUM,ca],ephemeralExpiration:[4,d("WAProtoConst").TYPES.UINT32],ephemeralSettingTimestamp:[5,d("WAProtoConst").TYPES.INT64],historySyncNotification:[6,d("WAProtoConst").TYPES.MESSAGE,oa],appStateSyncKeyShare:[7,d("WAProtoConst").TYPES.MESSAGE,ka],appStateSyncKeyRequest:[8,d("WAProtoConst").TYPES.MESSAGE,ja],initialSecurityNotificationSettingSync:[9,d("WAProtoConst").TYPES.MESSAGE,R]};qa.internalSpec={displayName:[1,d("WAProtoConst").TYPES.STRING],id:[2,d("WAProtoConst").TYPES.STRING]};ra.internalSpec={callKey:[1,d("WAProtoConst").TYPES.BYTES]};T.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],mimetype:[2,d("WAProtoConst").TYPES.STRING],fileSha256:[3,d("WAProtoConst").TYPES.BYTES],fileLength:[4,d("WAProtoConst").TYPES.UINT64],seconds:[5,d("WAProtoConst").TYPES.UINT32],mediaKey:[6,d("WAProtoConst").TYPES.BYTES],caption:[7,d("WAProtoConst").TYPES.STRING],gifPlayback:[8,d("WAProtoConst").TYPES.BOOL],height:[9,d("WAProtoConst").TYPES.UINT32],width:[10,d("WAProtoConst").TYPES.UINT32],fileEncSha256:[11,d("WAProtoConst").TYPES.BYTES],interactiveAnnotations:[12,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,$],directPath:[13,d("WAProtoConst").TYPES.STRING],mediaKeyTimestamp:[14,d("WAProtoConst").TYPES.INT64],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z],streamingSidecar:[18,d("WAProtoConst").TYPES.BYTES],gifAttribution:[19,d("WAProtoConst").TYPES.ENUM,da],viewOnce:[20,d("WAProtoConst").TYPES.BOOL]};sa.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],mimetype:[2,d("WAProtoConst").TYPES.STRING],fileSha256:[3,d("WAProtoConst").TYPES.BYTES],fileLength:[4,d("WAProtoConst").TYPES.UINT64],seconds:[5,d("WAProtoConst").TYPES.UINT32],ptt:[6,d("WAProtoConst").TYPES.BOOL],mediaKey:[7,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[8,d("WAProtoConst").TYPES.BYTES],directPath:[9,d("WAProtoConst").TYPES.STRING],mediaKeyTimestamp:[10,d("WAProtoConst").TYPES.INT64],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z],streamingSidecar:[18,d("WAProtoConst").TYPES.BYTES]};U.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],mimetype:[2,d("WAProtoConst").TYPES.STRING],title:[3,d("WAProtoConst").TYPES.STRING],fileSha256:[4,d("WAProtoConst").TYPES.BYTES],fileLength:[5,d("WAProtoConst").TYPES.UINT64],pageCount:[6,d("WAProtoConst").TYPES.UINT32],mediaKey:[7,d("WAProtoConst").TYPES.BYTES],fileName:[8,d("WAProtoConst").TYPES.STRING],fileEncSha256:[9,d("WAProtoConst").TYPES.BYTES],directPath:[10,d("WAProtoConst").TYPES.STRING],mediaKeyTimestamp:[11,d("WAProtoConst").TYPES.INT64],contactVcard:[12,d("WAProtoConst").TYPES.BOOL],thumbnailDirectPath:[13,d("WAProtoConst").TYPES.STRING],thumbnailSha256:[14,d("WAProtoConst").TYPES.BYTES],thumbnailEncSha256:[15,d("WAProtoConst").TYPES.BYTES],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z],thumbnailHeight:[18,d("WAProtoConst").TYPES.UINT32],thumbnailWidth:[19,d("WAProtoConst").TYPES.UINT32]};ta.internalSpec={text:[1,d("WAProtoConst").TYPES.STRING],matchedText:[2,d("WAProtoConst").TYPES.STRING],canonicalUrl:[4,d("WAProtoConst").TYPES.STRING],description:[5,d("WAProtoConst").TYPES.STRING],title:[6,d("WAProtoConst").TYPES.STRING],textArgb:[7,d("WAProtoConst").TYPES.FIXED32],backgroundArgb:[8,d("WAProtoConst").TYPES.FIXED32],font:[9,d("WAProtoConst").TYPES.ENUM,fa],previewType:[10,d("WAProtoConst").TYPES.ENUM,ea],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z],doNotPlayInline:[18,d("WAProtoConst").TYPES.BOOL]};V.internalSpec={degreesLatitude:[1,d("WAProtoConst").TYPES.DOUBLE],degreesLongitude:[2,d("WAProtoConst").TYPES.DOUBLE],name:[3,d("WAProtoConst").TYPES.STRING],address:[4,d("WAProtoConst").TYPES.STRING],url:[5,d("WAProtoConst").TYPES.STRING],isLive:[6,d("WAProtoConst").TYPES.BOOL],accuracyInMeters:[7,d("WAProtoConst").TYPES.UINT32],speedInMps:[8,d("WAProtoConst").TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[9,d("WAProtoConst").TYPES.UINT32],comment:[11,d("WAProtoConst").TYPES.STRING],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};W.internalSpec={displayName:[1,d("WAProtoConst").TYPES.STRING],vcard:[16,d("WAProtoConst").TYPES.STRING],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z]};ua.internalSpec={note:[1,d("WAProtoConst").TYPES.STRING],token:[2,d("WAProtoConst").TYPES.STRING],attachmentType:[3,d("WAProtoConst").TYPES.ENUM,ga],attachmentMimetype:[4,d("WAProtoConst").TYPES.STRING],attachmentMediaKey:[5,d("WAProtoConst").TYPES.BYTES],attachmentMediaKeyTimestamp:[6,d("WAProtoConst").TYPES.INT64],attachmentFileSha256:[7,d("WAProtoConst").TYPES.BYTES],attachmentFileEncSha256:[8,d("WAProtoConst").TYPES.BYTES],attachmentDirectPath:[9,d("WAProtoConst").TYPES.STRING],attachmentJpegThumbnail:[10,d("WAProtoConst").TYPES.BYTES]};X.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],mimetype:[2,d("WAProtoConst").TYPES.STRING],caption:[3,d("WAProtoConst").TYPES.STRING],fileSha256:[4,d("WAProtoConst").TYPES.BYTES],fileLength:[5,d("WAProtoConst").TYPES.UINT64],height:[6,d("WAProtoConst").TYPES.UINT32],width:[7,d("WAProtoConst").TYPES.UINT32],mediaKey:[8,d("WAProtoConst").TYPES.BYTES],fileEncSha256:[9,d("WAProtoConst").TYPES.BYTES],interactiveAnnotations:[10,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,$],directPath:[11,d("WAProtoConst").TYPES.STRING],mediaKeyTimestamp:[12,d("WAProtoConst").TYPES.INT64],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],contextInfo:[17,d("WAProtoConst").TYPES.MESSAGE,Z],firstScanSidecar:[18,d("WAProtoConst").TYPES.BYTES],firstScanLength:[19,d("WAProtoConst").TYPES.UINT32],experimentGroupId:[20,d("WAProtoConst").TYPES.UINT32],scansSidecar:[21,d("WAProtoConst").TYPES.BYTES],scanLengths:[22,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.UINT32],midQualityFileSha256:[23,d("WAProtoConst").TYPES.BYTES],midQualityFileEncSha256:[24,d("WAProtoConst").TYPES.BYTES],viewOnce:[25,d("WAProtoConst").TYPES.BOOL]};Y.internalSpec={groupId:[1,d("WAProtoConst").TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,d("WAProtoConst").TYPES.BYTES]};Z.internalSpec={stanzaId:[1,d("WAProtoConst").TYPES.STRING],participant:[2,d("WAProtoConst").TYPES.STRING],quotedMessage:[3,d("WAProtoConst").TYPES.MESSAGE,h],remoteJid:[4,d("WAProtoConst").TYPES.STRING],mentionedJid:[15,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.STRING],conversionSource:[18,d("WAProtoConst").TYPES.STRING],conversionData:[19,d("WAProtoConst").TYPES.BYTES],conversionDelaySeconds:[20,d("WAProtoConst").TYPES.UINT32],forwardingScore:[21,d("WAProtoConst").TYPES.UINT32],isForwarded:[22,d("WAProtoConst").TYPES.BOOL],quotedAd:[23,d("WAProtoConst").TYPES.MESSAGE,wa],placeholderKey:[24,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec],expiration:[25,d("WAProtoConst").TYPES.UINT32],ephemeralSettingTimestamp:[26,d("WAProtoConst").TYPES.INT64],ephemeralSharedSecret:[27,d("WAProtoConst").TYPES.BYTES],externalAdReply:[28,d("WAProtoConst").TYPES.MESSAGE,va]};va.internalSpec={title:[1,d("WAProtoConst").TYPES.STRING],body:[2,d("WAProtoConst").TYPES.STRING],mediaType:[3,d("WAProtoConst").TYPES.ENUM,ha],thumbnailUrl:[4,d("WAProtoConst").TYPES.STRING],mediaUrl:[5,d("WAProtoConst").TYPES.STRING],thumbnail:[6,d("WAProtoConst").TYPES.BYTES],sourceType:[7,d("WAProtoConst").TYPES.STRING],sourceId:[8,d("WAProtoConst").TYPES.STRING],sourceUrl:[9,d("WAProtoConst").TYPES.STRING]};wa.internalSpec={advertiserName:[1,d("WAProtoConst").TYPES.STRING],mediaType:[2,d("WAProtoConst").TYPES.ENUM,ia],jpegThumbnail:[16,d("WAProtoConst").TYPES.BYTES],caption:[17,d("WAProtoConst").TYPES.STRING]};xa.internalSpec={deviceListMetadata:[1,d("WAProtoConst").TYPES.MESSAGE,ya]};ya.internalSpec={senderKeyHash:[1,d("WAProtoConst").TYPES.BYTES],senderTimestamp:[2,d("WAProtoConst").TYPES.UINT64],recipientKeyHash:[8,d("WAProtoConst").TYPES.BYTES],recipientTimestamp:[9,d("WAProtoConst").TYPES.UINT64]};$.internalSpec={polygonVertices:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,za],location:[2,d("WAProtoConst").TYPES.MESSAGE,Aa],__oneofs__:{action:["location"]}};za.internalSpec={xDeprecated:[1,d("WAProtoConst").TYPES.INT32],yDeprecated:[2,d("WAProtoConst").TYPES.INT32],x:[3,d("WAProtoConst").TYPES.DOUBLE],y:[4,d("WAProtoConst").TYPES.DOUBLE]};Aa.internalSpec={degreesLatitude:[1,d("WAProtoConst").TYPES.DOUBLE],degreesLongitude:[2,d("WAProtoConst").TYPES.DOUBLE],name:[3,d("WAProtoConst").TYPES.STRING]};Ba.internalSpec={quickReplyButton:[1,d("WAProtoConst").TYPES.MESSAGE,Ea],urlButton:[2,d("WAProtoConst").TYPES.MESSAGE,Da],callButton:[3,d("WAProtoConst").TYPES.MESSAGE,Ca],index:[4,d("WAProtoConst").TYPES.UINT32],__oneofs__:{button:["quickReplyButton","urlButton","callButton"]}};Ca.internalSpec={displayText:[1,d("WAProtoConst").TYPES.MESSAGE,K],phoneNumber:[2,d("WAProtoConst").TYPES.MESSAGE,K]};Da.internalSpec={displayText:[1,d("WAProtoConst").TYPES.MESSAGE,K],url:[2,d("WAProtoConst").TYPES.MESSAGE,K]};Ea.internalSpec={displayText:[1,d("WAProtoConst").TYPES.MESSAGE,K],id:[2,d("WAProtoConst").TYPES.STRING]};Fa.internalSpec={quickReplyButton:[1,d("WAProtoConst").TYPES.MESSAGE,Ia],urlButton:[2,d("WAProtoConst").TYPES.MESSAGE,Ha],callButton:[3,d("WAProtoConst").TYPES.MESSAGE,Ga],index:[4,d("WAProtoConst").TYPES.UINT32],__oneofs__:{hydratedButton:["quickReplyButton","urlButton","callButton"]}};Ga.internalSpec={displayText:[1,d("WAProtoConst").TYPES.STRING],phoneNumber:[2,d("WAProtoConst").TYPES.STRING]};Ha.internalSpec={displayText:[1,d("WAProtoConst").TYPES.STRING],url:[2,d("WAProtoConst").TYPES.STRING]};Ia.internalSpec={displayText:[1,d("WAProtoConst").TYPES.STRING],id:[2,d("WAProtoConst").TYPES.STRING]};g.LIST_RESPONSE_MESSAGE_LISTTYPE=a;g.LIST_MESSAGE_LISTTYPE=b;g.ORDER_MESSAGE_ORDERSURFACE=c;g.ORDER_MESSAGE_ORDERSTATUS=e;g.HSM_DATE_TIME_COMPONENT_CALENDARTYPE=f;g.HSM_DATE_TIME_COMPONENT_DAYOFWEEKTYPE=aa;g.HISTORY_SYNC_NOTIFICATION_HISTORYSYNCTYPE=ba;g.PROTOCOL_MESSAGE_TYPE=ca;g.VIDEO_MESSAGE_ATTRIBUTION=da;g.EXTENDED_TEXT_MESSAGE_PREVIEWTYPE=ea;g.EXTENDED_TEXT_MESSAGE_FONTTYPE=fa;g.INVOICE_MESSAGE_ATTACHMENTTYPE=ga;g.EXTERNAL_AD_REPLY_INFO_MEDIATYPE=ha;g.AD_REPLY_INFO_MEDIATYPE=ia;g.MessageSpec=h;g.ButtonsResponseMessageSpec=i;g.ButtonsMessageSpec=j;g.ButtonSpec=k;g.ButtonTextSpec=l;g.FutureProofMessageSpec=m;g.DeviceSentMessageSpec=n;g.EphemeralSettingSpec=o;g.GroupInviteMessageSpec=p;g.ListResponseMessageSpec=q;g.SingleSelectReplySpec=r;g.ListMessageSpec=s;g.SectionSpec=t;g.RowSpec=u;g.OrderMessageSpec=v;g.ProductMessageSpec=w;g.ProductSnapshotSpec=x;g.CatalogSnapshotSpec=y;g.TemplateButtonReplyMessageSpec=z;g.TemplateMessageSpec=A;g.HydratedFourRowTemplateSpec=B;g.FourRowTemplateSpec=C;g.StickerMessageSpec=D;g.LiveLocationMessageSpec=E;g.CancelPaymentRequestMessageSpec=F;g.DeclinePaymentRequestMessageSpec=G;g.PaymentMoneySpec=H;g.RequestPaymentMessageSpec=I;g.SendPaymentMessageSpec=J;g.HighlyStructuredMessageSpec=K;g.HSMLocalizableParameterSpec=L;g.HSMDateTimeSpec=M;g.HSMDateTimeUnixEpochSpec=N;g.HSMDateTimeComponentSpec=O;g.HSMCurrencySpec=P;g.ContactsArrayMessageSpec=Q;g.InitialSecurityNotificationSettingSyncSpec=R;g.AppStateSyncKeyRequestSpec=ja;g.AppStateSyncKeyShareSpec=ka;g.AppStateSyncKeyDataSpec=la;g.AppStateSyncKeyFingerprintSpec=ma;g.AppStateSyncKeyIdSpec=S;g.AppStateSyncKeySpec=na;g.HistorySyncNotificationSpec=oa;g.ProtocolMessageSpec=pa;g.ChatSpec=qa;g.CallSpec=ra;g.VideoMessageSpec=T;g.AudioMessageSpec=sa;g.DocumentMessageSpec=U;g.ExtendedTextMessageSpec=ta;g.LocationMessageSpec=V;g.ContactMessageSpec=W;g.InvoiceMessageSpec=ua;g.ImageMessageSpec=X;g.SenderKeyDistributionMessageSpec=Y;g.ContextInfoSpec=Z;g.ExternalAdReplyInfoSpec=va;g.AdReplyInfoSpec=wa;g.MessageContextInfoSpec=xa;g.DeviceListMetadataSpec=ya;g.InteractiveAnnotationSpec=$;g.PointSpec=za;g.LocationSpec=Aa;g.TemplateButtonSpec=Ba;g.CallButtonSpec=Ca;g.URLButtonSpec=Da;g.QuickReplyButtonSpec=Ea;g.HydratedTemplateButtonSpec=Fa;g.HydratedCallButtonSpec=Ga;g.HydratedURLButtonSpec=Ha;g.HydratedQuickReplyButtonSpec=Ia}),98);
__d("WAAckLevel",[],(function(a,b,c,d,e,f){"use strict";a={SENDER_BACKFILL_SENT:-7,INACTIVE_RECEIVED:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4};f.ACK=a}),66);
__d("WAMedia",[],(function(a,b,c,d,e,f){"use strict";a="Image";b="Video";c="Ptt";d="Gif";e="Sticker";var g={IMAGE:a,VIDEO:b,PTT:c,GIF:d,STICKER:e};f.IMAGE=a;f.VIDEO=b;f.PTT=c;f.GIF=d;f.STICKER=e;f.MEDIA_TYPE=g}),66);
__d("WAParseProtocol",["WAAckLevel","WAAssertUnreachable","WAErr","WAHex","WALogger","WALongInt","WAMedia","WAMediaUtils","WAMsgMap","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with too large size ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with bad size ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["We dont support this message type yet"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["interpretProto msg came with tags "," and ",""]);m=function(){return a};return a}var n={};function a(a){var b=p(a.proto);if(!b)return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null};var e={id:{externalId:a.externalId,author:a.author,chat:a.jid},ts:a.ts,ack:d("WAAckLevel").ACK.RECEIVED,serverTs:a.ts,forwardingScore:0};switch(b.type){case"conversation":var f=babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:b.value}},e);return{unstoredMsg:f,unstoredMedia:null,unstoredXMA:null};case"imageMessage":f=b.value;f=q(f,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,mediaId:f==null?void 0:f.plaintextHash},e),unstoredMedia:f,unstoredXMA:null};case"videoMessage":f=b.value;f=r(f,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO,mediaId:f==null?void 0:f.plaintextHash},e),unstoredMedia:f,unstoredXMA:null};case"audioMessage":f=b.value;f=s(f,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,mediaId:f==null?void 0:f.plaintextHash},e),unstoredMedia:f,unstoredXMA:null};case"futureproof":f={type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(a.bytes),subtype:n[b.type]||null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta};return{unstoredMsg:f,unstoredMedia:null,unstoredXMA:null};case"reactionMessage":throw c("WAErr")("Reaction not support yet");default:return c("WAAssertUnreachable")(b.type)}}var o=["conversation","imageMessage","videoMessage","audioMessage"];function p(a){var b=null;for(var e=0;e<o.length;e++)if(a[o[e]]!=null){if(b){d("WALogger").ERROR(m(),b,o[e]);return null}b=o[e]}if(b==null){d("WALogger").ERROR(l());return{type:"futureproof"}}switch(b){case"audioMessage":return a.audioMessage!=null?{type:"audioMessage",value:a.audioMessage}:null;case"videoMessage":return a.videoMessage!=null?{type:"videoMessage",value:a.videoMessage}:null;case"imageMessage":return a.imageMessage!=null?{type:"imageMessage",value:a.imageMessage}:null;case"conversation":return a.conversation!=null?{type:"conversation",value:a.conversation}:null;default:c("WAAssertUnreachable")(b)}}function q(a,b){var c=u(a,"image");if(!c)return null;c=t(c,b);b=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:a.width,height:a.height,jpegThumbnail:a.jpegThumbnail},validatedAudioInfo:null});return b}function r(a,b){var c=u(a,"video");if(!c)return null;c=t(c,b);b=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").VIDEO,validatedVideoInfo:{duration:a.seconds!=null&&a.seconds>1?a.seconds:1,width:a.width,height:a.height,mimetype:a.mimetype,jpegThumbnail:a.jpegThumbnail},validatedImageInfo:null,validatedAudioInfo:null});return b}function s(a,b){var c=u(a,"ptt");if(!c)return null;c=t(c,b);b=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:{duration:a.seconds!=null&&a.seconds>1?a.seconds:1,mimetype:a.mimetype,played:!1}});return b}function t(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}function u(a,b){var c=a.fileSha256;if(!c){d("WALogger").ERROR(k());return null}var e=a.fileLength;if(e==null||e===0){d("WALogger").ERROR(j(),e);return null}try{e=d("WALongInt").numberOrThrowIfTooLarge(e)}catch(a){d("WALogger").ERROR(i(),e);return null}if(a.fileSha256==null||a.fileEncSha256==null||a.mediaKey==null||a.directPath==null||a.mediaKeyTimestamp==null){d("WALogger").ERROR(h());return null}a=d("WAMediaUtils").rawDataToMediaEntry(a.fileSha256,a.fileEncSha256,a.mediaKey,a.directPath,d("WATimeUtils").castLongIntToUnixTime(a.mediaKeyTimestamp),b);return{size:e,plaintextHash:d("WAMediaUtils").toPlaintextHash(new Uint8Array(c)),mediaEntry:a}}g.FUTUREPROOF_TYPES=n;g.parseProtocol=a}),98);
__d("WAMsgApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={DEFAULT:0,VANISH_MODE:1};b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null);b.internalSpec={payload:[1,d("WAProtoConst").TYPES.MESSAGE,h],metadata:[2,d("WAProtoConst").TYPES.MESSAGE,c]};c.internalSpec={chatEphemeralSetting:[1,d("WAProtoConst").TYPES.MESSAGE,m],ephemeralSettingList:[2,d("WAProtoConst").TYPES.MESSAGE,f],ephemeralSharedSecret:[3,d("WAProtoConst").TYPES.BYTES],forwardingScore:[5,d("WAProtoConst").TYPES.UINT32],isForwarded:[6,d("WAProtoConst").TYPES.BOOL],businessMetadata:[7,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],frankingKey:[8,d("WAProtoConst").TYPES.BYTES],frankingVersion:[9,d("WAProtoConst").TYPES.INT32],quotedMessage:[10,d("WAProtoConst").TYPES.MESSAGE,e],threadType:[11,d("WAProtoConst").TYPES.ENUM,a],__oneofs__:{ephemeral:["chatEphemeralSetting","ephemeralSettingList","ephemeralSharedSecret"]}};e.internalSpec={stanzaId:[1,d("WAProtoConst").TYPES.STRING],remoteJid:[2,d("WAProtoConst").TYPES.STRING],participant:[3,d("WAProtoConst").TYPES.STRING],payload:[4,d("WAProtoConst").TYPES.MESSAGE,h]};f.internalSpec={chatJid:[1,d("WAProtoConst").TYPES.STRING],ephemeralSetting:[2,d("WAProtoConst").TYPES.MESSAGE,m]};h.internalSpec={coreContent:[1,d("WAProtoConst").TYPES.MESSAGE,l],signal:[2,d("WAProtoConst").TYPES.MESSAGE,k],applicationData:[3,d("WAProtoConst").TYPES.MESSAGE,j],subProtocol:[4,d("WAProtoConst").TYPES.MESSAGE,i],__oneofs__:{content:["coreContent","signal","applicationData","subProtocol"]}};i.internalSpec={futureProof:[1,d("WAProtoConst").TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR],consumerMessage:[2,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],businessMessage:[3,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],paymentMessage:[4,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],multiDevice:[5,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],voip:[6,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],armadillo:[7,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],__oneofs__:{subProtocol:["consumerMessage","businessMessage","paymentMessage","multiDevice","voip","armadillo"]}};j.internalSpec={};k.internalSpec={};l.internalSpec={};m.internalSpec={ephemeralExpiration:[2,d("WAProtoConst").TYPES.UINT32],ephemeralSettingTimestamp:[3,d("WAProtoConst").TYPES.INT64]};g.MESSAGE_APPLICATION_METADATA_THREAD_TYPE=a;g.MessageApplicationSpec=b;g.MessageApplication$MetadataSpec=c;g.MessageApplication$Metadata$QuotedMessageSpec=e;g.MessageApplication$Metadata$EphemeralSettingMapSpec=f;g.MessageApplication$PayloadSpec=h;g.MessageApplication$SubProtocolPayloadSpec=i;g.MessageApplication$ApplicationDataSpec=j;g.MessageApplication$SignalSpec=k;g.MessageApplication$ContentSpec=l;g.MessageApplication$EphemeralSettingSpec=m}),98);
__d("WAMessageKey",["WAErr","WAGlobals","WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===d("WAJids").AUTHOR_ME||a==d("WAGlobals").getMyUserJid()}function a(a,b,e){if(e==null)throw c("WAErr")("messageKey is null");var f=e.id,g=e.remoteJid;if(f==null)throw c("WAErr")("messageKey.id is null");else if(g==null)throw c("WAErr")("messageKey.remoteJid is null");g=d("WAJids").interpretAndValidateJid(g);if(g.jidType==="unknown")throw c("WAErr")("messageKey.remoteJid is invalid");var i,j=d("WAJids").AUTHOR_ME;if(g.jidType==="group"){i=g.groupJid;if(h(b)&&e.fromMe===!0)j=d("WAJids").AUTHOR_ME;else if(e.fromMe==!0)j=b;else{var k=e.participant;if(k==null)throw c("WAErr")("key.participant is null");k=d("WAJids").interpretAndValidateJid(k);if(k.jidType==="msgrUser")j=k.userJid;else throw c("WAErr")("key.participant is invalid")}}else if(g.jidType==="msgrUser"||g.jidType==="msgrDevice"){k=d("WAJids").interpretAndValidateJid(a);if(k.jidType!=="msgrUser")throw c("WAErr")("expected user type jid.");i=k.userJid;h(b)?e.fromMe===!0?j=d("WAJids").AUTHOR_ME:j=k.userJid:e.fromMe===!0&&(j=k.userJid)}else throw c("WAErr")("Unsupported jidtype type");return{chat:i,author:h(j)?d("WAJids").AUTHOR_ME:j,externalId:d("WAStanzaUtils").toStanzaId(f)}}g.extractProtocolMessageId=a}),98);
__d("WAParseProtocolUtils",["WAGlobals","WAHex","WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""]);h=function(){return a};return a}function a(a,b){b=i(b,a.serverTs);a=b==null?void 0:b.expirationTs;var c=b==null?void 0:b.deleteTs;b=b==null?void 0:b.ephemeralSetting;return{expirationTs:a,deleteTs:c,ephemeralSetting:b}}function b(a,b,c){b=j(b,c);b!=null&&(a.reportingMeta=b);return b}function i(a,b){var c;c=a==null?void 0:(c=a.chatEphemeralSetting)==null?void 0:c.ephemeralExpiration;a=a==null?void 0:(a=a.chatEphemeralSetting)==null?void 0:a.ephemeralSettingTimestamp;if(c==null||a==null||c===0||!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return null;b=d("WATimeUtils").castToUnixTime(b+d("WAGlobals").getConfig().ephemeralMaxDeletionWindowForUnseenMessage());var e=b,f=null;try{a=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3;f=d("WATimeUtils").castToUnixTime(a)}catch(a){return null}return{expirationTs:b,deleteTs:e,ephemeralSetting:{expirationTs:c,updatedTs:f}}}function j(a,b){b=b==null?void 0:b.frankingVersion;if(b!=null&&b!==0){d("WALogger").ERROR(h(),b);return{frankingTag:void 0,frankingVersion:b,reportingContent:void 0,reportingTag:void 0}}return{frankingTag:void 0,frankingVersion:b,reportingContent:d("WAHex").bytesToBuffer(a),reportingTag:void 0}}g.parseEphemerality=a;g.enhanceReportingMeta=b}),98);
__d("WAParseConsumerMessageProtocol",["WAConsumerApplication.pb","WAErr","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAStanzaUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""]);h=function(){return a};return a}b=1;e=0;f=1;f=d("WAGlobals").getConfig().armadilloWebProcessFutureproof()?f+1:f;function a(a,b,e,f,g){var i,q;b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);i=(i=b.payload)==null?void 0:(i=i.applicationData)==null?void 0:(i=i.revoke)==null?void 0:(i=i.key)==null?void 0:i.id;if(i!=null)return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.REVOKED,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta,revokedExternalId:d("WAStanzaUtils").toStanzaId(i),unsendMsgContentDeleteTs:null,msgContent:null},unstoredMedia:null,unstoredXMA:null};i=(g==null?void 0:g.isForwarded)||!1;var r=d("WAParseProtocolUtils").parseEphemerality(e,g),s=r.expirationTs,t=r.deleteTs;r=r.ephemeralSetting;if(r!=null&&(r.expirationTs<0||r.expirationTs>86400)){var u=d("WAJids").interpretAndValidateJid(a);u=u.jidType;r.expirationTs===4294967295&&(r.expirationTs=0);d("WALogger").ERROR(h(),r.expirationTs,u)}u=d("WAParseProtocolUtils").enhanceReportingMeta(e,f,g);g=(g=k(g))!=null?g:void 0;q=(q=b.payload)==null?void 0:q.content;if(!q)return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null};b=(b=b.metadata)==null?void 0:b.specialTextSize;var v=o(q);try{switch(v){case"messageText":var w=q[v];if(w==null||w.text==null)throw c("WAErr")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:w.text,mentionedJids:w.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i},e,{specialTextSize:b}),unstoredMedia:null,unstoredXMA:null};case"reactionMessage":return{unstoredMsg:j(a,e,q[v]),unstoredMedia:null,unstoredXMA:null};case"imageMessage":w=l(q,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i,mediaId:w.plaintextHash},e),unstoredMedia:w,unstoredXMA:null};case"videoMessage":b=q[v];if(b==null)throw c("WAErr")("consumerMessage has no videoMessage");w=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,b==null?void 0:(a=b.video)==null?void 0:a.payload);v=w==null?void 0:(v=w.integral)==null?void 0:(b=v.transport)==null?void 0:(a=b.ancillary)==null?void 0:a.mimetype;a=(w==null?void 0:(b=w.ancillary)==null?void 0:b.gifPlayback)===!0&&v==="image/gif";if(a&&!d("WAGlobals").getConfig().isGifEnabled())return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta},unstoredMedia:null,unstoredXMA:null};b=d("WAParseMediaTransportProtocol").parseVideoMsg(w,e.ts,a);if(b==null)throw c("WAErr")("consumerMessage has no video media info");return{unstoredMsg:a?babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.GIF},e,{quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i,reportingMeta:u,mediaId:b.plaintextHash}):babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO},e,{quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i,mediaId:b.plaintextHash}),unstoredMedia:b,unstoredXMA:null};case"audioMessage":v=m(q,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i,mediaId:v.plaintextHash},e),unstoredMedia:v,unstoredXMA:null};case"stickerMessage":if(d("WAGlobals").getConfig().isStickerEnabled()){w=n(q,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.STICKER,quote:g,expirationTs:s,deleteTs:t,ephemeralSetting:r,isForwarded:i,reportingMeta:u,mediaId:w.plaintextHash},e),unstoredMedia:w,unstoredXMA:null}}return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:u},unstoredMedia:null,unstoredXMA:null};case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null,unstoredIncomingGroupInvite:p(e,q)};case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"documentMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:u},unstoredMedia:null,unstoredXMA:null}}}catch(a){return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null}}}function i(a){if(d("WAJids").isAuthorSystem(a))throw c("WAErr")("Got system author");return a}function j(a,b,e){if(e==null)throw c("WAErr")("consumerMessage has no reactionMessage");var f=i(b.id.author);a=d("WAMessageKey").extractProtocolMessageId(a,f,e.key);f=e.text;e=e.groupingKey;return{type:d("WAMsgType").MSG_TYPE.REACTION,ack:b.ack,id:b.id,reactToExternalId:a.externalId,reactToAuthor:a.author,reaction:f,groupingKey:e,ts:b.ts}}function k(a){var b,e;b=a==null?void 0:(b=a.quotedMessage)==null?void 0:b.stanzaId;e=a==null?void 0:(e=a.quotedMessage)==null?void 0:e.participant;a=a==null?void 0:(a=a.quotedMessage)==null?void 0:a.remoteJid;e=e!=null?d("WAJids").interpretAndValidateJid(e):null;var f;(e==null?void 0:e.jidType)==="msgrUser"&&e.userJid===d("WAGlobals").getMyUserJid()?f=d("WAJids").AUTHOR_ME:(e==null?void 0:e.jidType)==="msgrUser"?f=e.userJid:f=d("WAJids").AUTHOR_ME;if(b==null)return null;e={type:d("WAMsgType").MSG_TYPE.UNAVAILABLE,author:f,externalId:d("WAStanzaUtils").toStanzaId(b),ts:null};if(a!=null){f=d("WAJids").interpretAndValidateJid(a);if(f.jidType==="group")return{remoteJid:f.groupJid,content:e};else throw c("WAErr")("not supported")}else return{remoteJid:null,content:e}}function l(a,b){a=a.imageMessage;if(a==null)throw c("WAErr")("consumerMessage has no imageMessage");return d("WAParseMediaTransportProtocol").decodeImageTransport(a==null?void 0:(a=a.image)==null?void 0:a.payload,b)}function m(a,b){var e;a=a.audioMessage;if(a==null)throw c("WAErr")("consumerMessage has no audioMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").AudioTransportSpec,a==null?void 0:(e=a.audio)==null?void 0:e.payload);e=d("WAParseMediaTransportProtocol").parseAudioMsg(e,(a==null?void 0:a.ptt)||!1,b);if(e==null)throw c("WAErr")("consumerMessage has no audio media info");return e}function n(a,b){a=a.stickerMessage;if(a==null)throw c("WAErr")("consumerMessage has no stickerMessage");a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").StickerTransportSpec,a==null?void 0:(a=a.sticker)==null?void 0:a.payload);a=d("WAParseMediaTransportProtocol").parseStickerMsg(a,b);if(a==null)throw c("WAErr")("consumerMessage has no sticker media info");return a}function o(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("WAErr")(JSON.stringify(a)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(b));return b[0]}function p(a,b){b=b.groupInviteMessage;if(b==null)throw c("WAErr")("consumerMessage has no GroupInvite Data");return babelHelpers["extends"]({ack:a.ack,author:a.id.author,externalId:a.id.externalId,ts:a.ts},b)}g.MINIMAL_MEDIA_DURATION=b;g.DEFAULT_FILE_SIZE=e;g.SUPPORTED_TYPES_VERSION=f;g.parseConsumerMessageProtocol=a}),98);
__d("WAParseMediaTransportProtocol",["WAErr","WALogger","WALongInt","WAMedia","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with too large size ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with bad size ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"]);l=function(){return a};return a}function m(a,b){var c,e,f;if(d("decodeProtobuf").getUnknownFields(a.integral)!=null){d("WALogger").ERROR(l());return null}c=(c=a.integral)==null?void 0:c.fileSha256;if(!c){d("WALogger").ERROR(k());return null}e=(e=a.ancillary)==null?void 0:e.fileLength;e==null&&(d("WALogger").ERROR(j(),e),e=d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE);try{e=d("WALongInt").numberOrThrowIfTooLarge(e)}catch(a){d("WALogger").ERROR(i(),e);return null}if(((f=a.integral)==null?void 0:f.fileSha256)==null||((f=a.integral)==null?void 0:f.fileEncSha256)==null||((f=a.integral)==null?void 0:f.mediaKey)==null||((f=a.integral)==null?void 0:f.directPath)==null||((f=a.integral)==null?void 0:f.mediaKeyTimestamp)==null||((f=a.ancillary)==null?void 0:f.objectId)==null){d("WALogger").ERROR(h());return null}f=(f=a.ancillary.thumbnail)==null?void 0:f.downloadableThumbnail;a=d("WAMediaUtils").rawDataToMediaEntry(a.integral.fileSha256,a.integral.fileEncSha256,a.integral.mediaKey,a.integral.directPath,d("WATimeUtils").castLongIntToUnixTime(a.integral.mediaKeyTimestamp),b,(b=a.ancillary)==null?void 0:b.objectId,void 0,{directPath:f==null?void 0:f.directPath,fileEncSha256:f==null?void 0:f.fileEncSha256,fileSha256:f==null?void 0:f.fileSha256,mediaKey:f==null?void 0:f.mediaKey,mediaKeyTimestamp:(f==null?void 0:f.mediaKeyTimestamp)==null?null:d("WATimeUtils").castLongIntToUnixTime(f==null?void 0:f.mediaKeyTimestamp)});return{size:e,plaintextHash:d("WAMediaUtils").toPlaintextHash(new Uint8Array(c)),mediaEntry:a}}function n(a,b){var c,e;if(!((c=a.integral)==null?void 0:c.transport))return null;c=m((c=a.integral)==null?void 0:c.transport,"image");if(!c)return null;c=o(c,b);b=(b=a.ancillary)==null?void 0:b.width;e=(e=a.ancillary)==null?void 0:e.height;a.ancillary!=null&&(a.ancillary.width!=null&&a.ancillary.width===4294967295&&(b=void 0),a.ancillary.height!=null&&a.ancillary.height===4294967295&&(e=void 0));e=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:b,height:e,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(e=b.ancillary)==null?void 0:(c=e.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(c=e.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(c=e.transport)==null?void 0:(b=c.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth},validatedAudioInfo:null});return e}function a(a,b){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a);a=n(a,b);if(a==null)throw c("WAErr")("consumerMessage has no image media info");return a}function b(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=m((e=a.integral)==null?void 0:e.transport,c?"gif":"video");if(!e)return null;e=o(e,b);e=babelHelpers["extends"]({},e,{mediaType:c?d("WAMedia").MEDIA_TYPE.GIF:d("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:c?null:{duration:(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)!=null&&(a==null?void 0:(e=a.ancillary)==null?void 0:e.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:a==null?void 0:(e=a.ancillary)==null?void 0:e.width,height:a==null?void 0:(b=a.ancillary)==null?void 0:b.height,mimetype:a==null?void 0:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:e.mimetype,jpegThumbnail:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailWidth},validatedImageInfo:c?{width:(b=a.ancillary)==null?void 0:b.width,height:(e=a.ancillary)==null?void 0:e.height,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(e=b.ancillary)==null?void 0:(c=e.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(c=e.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(c=e.transport)==null?void 0:(b=c.ancillary)==null?void 0:(a=b.thumbnail)==null?void 0:a.thumbnailWidth}:null,validatedAudioInfo:null});return e}function e(a,b,c){if(!((b=a.integral)==null?void 0:b.transport))return null;b=m((b=a.integral)==null?void 0:b.transport,"ptt");if(!b)return null;b=o(b,c);b=babelHelpers["extends"]({},b,{mediaType:d("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:{duration:(a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds)!=null&&(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:a==null?void 0:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:a.mimetype,played:!1}});return b}function f(a,b){var c;if(!((c=a.integral)==null?void 0:c.transport))return null;c=m((c=a.integral)==null?void 0:c.transport,"sticker");if(!c)return null;c=o(c,b);c=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(b=a.ancillary)==null?void 0:b.width,height:(c=a.ancillary)==null?void 0:c.height,jpegThumbnail:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(b=c.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:(b=a.thumbnail)==null?void 0:b.thumbnailWidth},validatedAudioInfo:null});return c}function o(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}g.getMediaMeta=m;g.parseImageMsg=n;g.decodeImageTransport=a;g.parseVideoMsg=b;g.parseAudioMsg=e;g.parseStickerMsg=f}),98);
__d("WAParseMessageApplication",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.payload;if(e==null)return{version:"v3",type:"error",error:"The messageApplication has no payload"};if(d("decodeProtobuf").getUnknownFields(a.payload)!=null)return{version:"v3",type:"error",error:"There are unknown fields in the message application payload"};e=e.subProtocol;if(e==null)return{version:"v3",type:"error",error:"The messageApplication payload has no subProtocol"};if(d("decodeProtobuf").getUnknownFields(e)!=null)return{version:"v3",type:"error",error:"messageApplication subProtocol has unknown fields",futureProof:e.futureProof};e=[];b=(b=a.payload)==null?void 0:(b=b.subProtocol)==null?void 0:b.consumerMessage;c=(c=a.payload)==null?void 0:(c=c.subProtocol)==null?void 0:c.armadillo;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.multiDevice;if(b!=null){if(b.payload==null)return{version:"v3",type:"error",error:"subprotocol of type consumerMessage has no payload"};e.push({payload:new Uint8Array(b.payload),type:"success",subprotocolType:"consumerMessage"})}if(c!=null){if(c.payload==null)return{version:"v3",type:"error",error:"subprotocol of type armadillo has no payload"};e.push({payload:new Uint8Array(c.payload),type:"success",subprotocolType:"armadillo"})}if(a!=null){if(a.payload==null)return{version:"v3",type:"error",error:"subprotocol of type multiDevice has no payload"};e.push({payload:new Uint8Array(a.payload),type:"success",subprotocolType:"multiDevice"})}return e.length!==1?{version:"v3",type:"error",error:"Wrong number of subprotocols: "+e.length}:e[0]}g.parseMessageApplication=a}),98);
__d("WAParseXMAProtocol",["WAArmadilloXMA.pb","WAErr","WAGlobals","WALogger","WAMsgApplication.pb","WAMsgType","WAParseConsumerMessageProtocol","WAParseMediaTransportProtocol","WAParseMessageApplication","WAParseProtocolUtils","WAStanzaUtils","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[XMA] received associated message with incorrect version ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[XMA] received subprotocol with incorrect version ",""]);i=function(){return a};return a}b=new Set([d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL]);e=new Set([d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION]);var j=2,k=1;function l(a,b){if(a==null||a.payload==null)return void 0;a.version!==k&&d("WALogger").ERROR(i(),a.version);return d("WAParseMediaTransportProtocol").decodeImageTransport(a.payload,b)}function m(a,b,e,f,g){if(b==null||b.payload==null)return null;b.version!==j&&d("WALogger").ERROR(h(),b.version);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,b.payload);b=d("WAParseMessageApplication").parseMessageApplication(b);if(b.type==="error")throw c("WAErr")("XMA contains unparseable message application.");b=b;if(b.subprotocolType!=="consumerMessage")throw c("WAErr")("XMA contains incorrect message application type: "+b.subprotocolType);return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(a,b.payload,e,f,g)}function a(a,b,e,f,g){var h=b.targetType;if(!d("WAGlobals").getConfig().isXMAFeedPostShareEnabled()||h==null||!d("WAGlobals").getConfig().supportedXMATargetTypes().has(h))return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null};var i=d("WAParseProtocolUtils").parseEphemerality(e,g),j=i.expirationTs,k=i.deleteTs;i=i.ephemeralSetting;var n=d("WAParseProtocolUtils").enhanceReportingMeta(e,f,g),o=b.targetUsername,p=b.targetId,q=b.xmaLayoutType,r=b.ctas,s=b.titleText,t=b.subtitleText,u=b.maxTitleNumOfLines,v=b.maxSubtitleNumOfLines,w=b.headerTitle,x=b.overlayIconGlyph,y=b.overlayTitle,z=b.overlayDescription,A=b.previews,B=b.favicon,C=b.headerImage,D=b.sentWithMessageId,E=b.associatedMessage;b=b.targetExpiringAtSec!=null?d("WATimeUtils").castLongIntToUnixTime(b.targetExpiringAtSec):void 0;var F=E!=null&&D!=null?[d("WAStanzaUtils").toStanzaId(D),e.id.externalId]:[e.id.externalId,void 0],G=F[0];F=F[1];var H=[];if(A!=null)for(var I=0;I<A.length;I++){var J=l(A[I],e.ts);J!=null&&H.push(J)}J=l(C,e.ts);I=l(B,e.ts);A=babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.XMA},e,{id:babelHelpers["extends"]({},e.id,{externalId:G}),expirationTs:j,deleteTs:k,ephemeralSetting:i,reportingMeta:n});C=r.slice(1);h===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE&&r.length===1&&(C=r);k={externalId:G,author:e.id.author,threadJid:a,targetType:h,targetUsername:o,targetId:p,targetExpiringAtSec:b,xmaLayoutType:q,defaultCTA:r[0],ctas:C,titleText:s,subtitleText:t,maxTitleNumOfLines:u,maxSubtitleNumOfLines:v,headerTitle:w,overlayIconGlyph:x,overlayTitle:y,overlayDescription:z,isTombstoned:b!=null?d("WATimeUtils").unixTime()>b:!1,previewMediaIds:H.length>0?H.map(function(a){return a.plaintextHash}):void 0,headerMediaId:(B=J==null?void 0:J.plaintextHash)!=null?B:void 0,faviconMediaId:(j=I==null?void 0:I.plaintextHash)!=null?j:void 0};var K;if(E!=null&&D==null)throw c("WAErr")("XMA associatedMessage cannot be received without sentWithMessageId field");E!=null&&F!=null&&(K=m(a,E,e,f,g));if(((i=K)==null?void 0:i.unstoredMedia)!=null)throw c("WAErr")("XMA associated msg cannot have additioinal dbMedia");if(((n=K)==null?void 0:n.unstoredXMA)!=null)throw c("WAErr")("XMA associated msg cannot have XMA content");o=(h=(G=K)==null?void 0:G.unstoredMsg)!=null?h:null;if(o!=null&&o.type!=="Text")throw c("WAErr")('XMA associated msg cannot have type different from "Text". Received type: '+o.type);return{unstoredMsg:A,unstoredMedia:null,unstoredXMA:{xma:k,unstoredPreviews:H.length>0?H:void 0,unstoredHeaderMedia:J,unstoredFavicon:I,unstoredAssociatedMsg:o!=null?o:void 0}}}g.FB_SUPPORTED_TARGET_TYPES=b;g.IGD_SUPPORTED_TARGET_TYPES=e;g.parseXMAProtocol=a}),98);
__d("WAParseArmadilloProtocol",["WAAckLevel","WAArmadilloApplication.pb","WAErr","WAGlobals","WAJids","WALogger","WAMsgType","WAParseXMAProtocol","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseArmadilloProtocol - Dropping message. contentType: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseArmadilloProtocol - Dropping message. contentType: ",", reason: ",""]);i=function(){return a};return a}function a(a,b,e,f,g){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,b);b=(b=b.payload)==null?void 0:b.content;if(!b)return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null};var l=j(b);try{switch(l){case"screenshotAction":var m=b[l];if(m==null)throw c("WAErr")("screenshotAction has no content");m=m.screenshotType;if(m==null)throw c("WAErr")("Missing screenshot type in payload");return k(e.serverTs,m,e.id.chat);case"extendedContentMessage":if(!d("WAGlobals").getConfig().isXMAFeedPostShareEnabled())return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null};m=b[l];if(m==null)throw c("WAErr")("extendedContentMessage has no content");return d("WAParseXMAProtocol").parseXMAProtocol(a,m,e,f,g);default:return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null}}}catch(a){d("WALogger").WARN(i(),l,a);d("WALogger").ERROR(h(),l);return{unstoredMsg:null,unstoredMedia:null,unstoredXMA:null}}}function j(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("WAErr")(JSON.stringify(a)+" armadillo payload content should only have one field");a=b[0];return a}function k(a,b,e){var f;switch(b){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE;break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING;break;default:throw c("WAErr")("Received unexpected screenshot action type")}b={type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION,ts:a,id:{externalId:d("WAGlobals").getDependencies().generateExternalId(),author:d("WAJids").AUTHOR_SYSTEM,chat:e},ack:d("WAAckLevel").ACK.SENT,msgContent:{adminMsgContent:[],adminType:"youEphemeralTakeScreenshot",screenshotActionType:f}};return{unstoredMsg:b,unstoredMedia:null,unstoredXMA:null}}g.parseArmadilloProtocol=a;g.parseEphemeralScreenshotActionProtocol=k}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAErr","WAGlobals","WAHex","WAMsgType","WAParseArmadilloProtocol","WAParseConsumerMessageProtocol"],(function(a,b,c,d,e,f,g){function a(a,b,e,f,g){g={id:{chat:b,author:f,externalId:e},ts:g,serverTs:g,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:a.type!=="futureProof"?(e=a==null?void 0:(f=a.metadata)==null?void 0:f.forwardingScore)!=null?e:0:0};f=a.type!=="futureProof"&&((f=a.metadata)==null?void 0:(e=f.chatEphemeralSetting)==null?void 0:e.ephemeralExpiration)!=null&&((f=a.metadata)==null?void 0:(e=f.chatEphemeralSetting)==null?void 0:e.ephemeralExpiration)>0;if(a.type==="futureProof"||f&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(a.protobuf)},id:g.id,ts:g.ts,sentTs:g.sentTs,serverTs:g.serverTs,ack:g.ack,reportingMeta:g.reportingMeta},unstoredMedia:null,unstoredXMA:null};else if(a.type==="subprotocol")switch(a.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(b,a.subprotocol,g,a.protobuf,a.metadata);case"armadillo":return d("WAParseArmadilloProtocol").parseArmadilloProtocol(b,a.subprotocol,g,a.protobuf,a.metadata);case"businessMessage":throw c("WAErr")("unsupported subprotocolType: "+a.subprotocolType);case"paymentMessage":throw c("WAErr")("unsupported subprotocolType: "+a.subprotocolType);case"multiDevice":throw c("WAErr")("unsupported subprotocolType: "+a.subprotocolType);case"voip":throw c("WAErr")("unsupported subprotocolType: "+a.subprotocolType);default:return c("WAAssertUnreachable")(a.subprotocolType)}else return c("WAAssertUnreachable")(a.type)}g.parseV3Protocol=a}),98);
__d("MAWIncomingMsgUtils",["MAWEphemeralUtil","MAWUnstoredContentToUnstoredDbContentUtils","WAE2E.pb","WAParseProtocol","WAParseV3Protocol","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.chat,e=a.externalId,f=a.msg,g=a.reportingMeta;a=a.serverTs;if(f.version==="v3"&&f.type==="ephemeral"){var h=d("MAWEphemeralUtil").buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder(a);g!=null&&h.unstoredDbMsg!=null&&(h.unstoredDbMsg.reportingMeta=g);return h}if(f.version==="v3")h=d("WAParseV3Protocol").parseV3Protocol(f,c,e,b,a);else{var i=d("decodeProtobuf").decodeProtobuf(d("WAE2E.pb").MessageSpec,f.encoded);b={author:b,bytes:f.encoded,externalId:e,jid:c,proto:i,ts:a};h=d("WAParseProtocol").parseProtocol(b)}g!=null&&h.unstoredMsg!=null&&(h.unstoredMsg.reportingMeta=g);return d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(h)}g.getDbMsg=a}),98);
__d("MAWProcessOfflineMsgsTxns",["MAWIncomingMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[];a.forEach(function(a){switch(a.type){case"IncomingMsg":var c=a.folder,e=a.id,f=a.msg,g=a.reportingMeta;a=a.ts;var h=e.author,i=e.chat;e=e.externalId;f=d("MAWIncomingMsgUtils").getDbMsg({author:h,chat:i,externalId:e,folder:c,msg:f,reportingMeta:g,serverTs:a});f=f.unstoredDbReaction;if(f!=null){h={author:h,chat:i,externalId:e,folder:c,reportingMeta:g,serverTs:a,unstoredDbReaction:f};b.push(h)}break;case"InvisibleMsg":case"IncomingCiphertextMsg":default:break}});return{reactionMsgs:b}}g.classifyOfflineMsgs=a}),98);
__d("MAWThreadTypes",["MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a={chunk:d("MAWTransactionMode").READWRITE,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE};g.ThreadRelatedTablesPermissions=a}),98);
__d("MAWDbDualSendTxns",["MAWDbIsDualSend","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n          'More than 1 dual send entry in database',\n          'messenger_web_product',\n        "]);h=function(){return a};return a}function i(a){return a.isDualSend.toArray().then(function(a){if(a.length>=1){a.length>1&&d("WALogger").ERROR(h());return a[0]}else return null})}function a(a,b){return i(a).then(function(c){return c!=null?a.isDualSend.put(babelHelpers["extends"]({},c,{isEnabled:b})):a.isDualSend.add({isEnabled:b,version:d("MAWDbIsDualSend").LATEST_DUAL_SEND_VERSION})})}function b(a,b){return a.dualSendMedia.get({id:b})}function c(a,b,c){return a.dualSendMedia.add({file:b,id:c})}function e(a){return a.dualSendMedia.clear()}g.getIsDualSendInstallation=i;g.markAsDualSend=a;g.getDualSendMediaRowByFileType=b;g.addFileToDualSendMediaTable=c;g.deleteDualSendMediaTable=e}),98);
__d("MAWOfflineThreadTxns",["MAWBridgeThread","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThread","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLoadMessageRequestCapabilitiesTxns","WADualSendMsgUtils","WAJids","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=new Set(b);return d("MAWDbThreadTxns").getThreadsByJids(a,b).then(function(b){b.forEach(function(a){a=a.jid;c.has(a)&&c["delete"](a)});var e=[],f=[];c.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return f.push(a)},user:function(a){return e.push(a)}})});return d("MAWDbGroupInfoTxns").bulkGetGroupInfo(a,f).then(function(b){var c=[];e.forEach(function(a){c.push({jid:a})});b=Array.from(b.values()).map(function(a){return a.success?a.value:null}).filter(Boolean);b.forEach(function(a){c.push({createTs:d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs),jid:a.groupJid})});var f=b.reduce(function(a,b){return a.set(b.groupJid,b)},new Map());return k(a,c).then(function(){var b=c.map(function(a){return a.jid});return d("MAWDbThreadTxns").getThreadsByJids(a,b).then(function(b){j(b);return d("MAWDexieTable").dexieAll([i(a,f,b),h(a,b,e)]).then(function(){return c.map(function(a){return a.jid})})})})})})}function h(a,b,e){var f=b.reduce(function(a,b){return a.set(b.jid,b.chatId)},new Map()),g=new Set(e);b=b.filter(function(a){return g.has(a.jid)});var h=[];e.forEach(function(a){var b=f.get(a);if(b==null)throw c("err")("addParticipantsToOneToOneThreads - chatId is null - unexpected - for flow");h.push({threadId:b,type:"participant",userJid:d("WADualSendMsgUtils").isDualSendJid(a)?d("WADualSendMsgUtils").removeDualSendPrefixForUser(a):a});var e=d("MAWGlobals").getMyUserJid();e!==a&&h.push({threadId:b,type:"participant",userJid:e})});return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").bulkAddParticipantsInThreads(a,h),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(a,b)]).then(function(){})}function i(a,b,e){var f=e.reduce(function(a,b){return a.set(b.jid,b.chatId)},new Map()),g=[];b.forEach(function(a,b){b=f.get(b);if(b==null)throw c("err")("newThreadId is null - unexpected - for flow");a=babelHelpers["extends"]({},a,{threadId:b});g.push(a)});return d("MAWDbGroupInfoTxns").bulkUpdateGroupInfo(a,g).then(function(){})}function j(a){a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,a.optimisticThreadKey,void 0)})})}function k(a,b){b=b.map(function(a){return l(a)});return a.threads.bulkAdd(b).then(function(){})}function l(a){a=a.jid;return{folder:null,jid:a,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:null,newestMsg:null,newestMsgTs:null,nextInChatMsgId:1,oldestMsg:null,optimisticThreadKey:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(d("WATimeUtils").millisTime(),a)}}g.createAllThreadsForOfflineMsgs=a}),98);
__d("MAWAsArmadilloApplication",["MAWXMAEncodeUtils","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a.type){case d("WAMsgType").MSG_TYPE.XMA:if((b==null?void 0:b.xma)==null)throw c("err")("XMA content should have XMA payload");return d("MAWXMAEncodeUtils").encodeXMA(a,b);default:throw c("err")(a.type+" should not be handled as ArmadilloApplication")}}g.asArmadilloApplication=a}),98);
__d("WAFranking",["WACryptoHmac","WACryptoUtils","WAGlobals","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=0;function a(){var a=new Uint8Array(h);self.crypto.getRandomValues(a);return a}function c(a){return(a=a)!=null?a:i}function e(a,b){return d("WACryptoHmac").hmacSha256(a,b).then(function(a){return new Uint8Array(a)})}function j(a,c,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.t0=f;h.next=h.t0===void 0?3:h.t0===0?3:7;break;case 3:h.next=5;return b("regeneratorRuntime").awrap(d("WACryptoHmac").hmacSha256(c,a));case 5:g=h.sent;return h.abrupt("return",d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(g),e));case 7:return h.abrupt("return",!0);case 8:case"end":return h.stop()}},null,this)}function f(a){return a}function k(a){return a}function l(a,c){var e,f,g,h,i,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:if(!(d("WAGlobals").getConfig().isFrankingEnabled()&&(c==null?void 0:c.frankingTag)!=null&&a.version==="v3"&&a.type==="subprotocol"&&((e=a.metadata)==null?void 0:e.frankingKey)!=null&&a.frankingContent!=null)){n.next=15;break}f=c.frankingTag;g=a.frankingContent,h=a.metadata,i=h.frankingKey,l=h.frankingVersion;m=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.FRANKING_VALIDATION);if(!(i==null)){n.next=8;break}m.endFail("tagButNoKey");n.next=15;break;case 8:n.next=10;return b("regeneratorRuntime").awrap(j(new Uint8Array(g),k(new Uint8Array(i)),f,l));case 10:if(n.sent){n.next=14;break}m.endFail("tagMismatch");n.next=15;break;case 14:m.endSuccess();case 15:case"end":return n.stop()}},null,this)}g.createFrankingKey=a;g.getFrankingVersion=c;g.genFrankingTag=e;g.validateFrankingTag=j;g.castToFrankingTag=f;g.castToFrankingKey=k;g.handleFrankingFromIncomingMsg=l}),98);
__d("MAWAsMessageApplication",["I64","LSMessageReplySourceTypeV2.re","MAWAsArmadilloApplication","MAWAsConsumerApplication","MAWGlobals","MAWJids","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAFranking","WAJids","WAMsgType","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){var f,g;switch(a.type){case d("WAMsgType").MSG_TYPE.XMA:f=d("MAWAsArmadilloApplication").asArmadilloApplication(a,e);break;default:g=d("MAWAsConsumerApplication").asConsumerApplication(a,b,c)}var h,i;e=a.forwardingScore!=null?a.forwardingScore:0;b=a.isForwarded!=null?a.isForwarded:!1;if(a.quote!=null){c=a.quote;h={participant:c.content.author===d("WAJids").AUTHOR_ME?d("MAWGlobals").getMyDeviceJid():c.content.author,stanzaId:c.content.externalId}}if(a.ephemeralSetting){c=a.ephemeralSetting;a.type===d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?i={ephemeralExpiration:c.ephemeralExpirationInSec}:i={ephemeralExpiration:c.ephemeralExpirationInSec,ephemeralSettingTimestamp:c.ephemeralLastUpdatedOrSetTimestamp*1e3}}a={metadata:{chatEphemeralSetting:i,forwardingScore:e,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:b,quotedMessage:h}};if(g!=null){c=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,g);a.payload={subProtocol:{consumerMessage:{payload:c.readBuffer(),version:1}}}}else if(f!=null){e=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,f);a.payload={subProtocol:{armadillo:{payload:e.readBuffer(),version:1}}}}return a}function b(a){var b=d("MAWAsConsumerApplication").asConsumerApplicationLSDb(a),e,f,g=a.isForwarded!=null?a.isForwarded:!1,h=g?1:0;a.replySourceTypeV2&&!d("I64").equal(a.replySourceTypeV2,c("LSMessageReplySourceTypeV2.re").none)&&a.replyToUserId&&(e={participant:a.replyToUserId===d("WAJids").AUTHOR_ME?d("MAWGlobals").getMyDeviceJid():d("MAWJids").toUserJid(d("I64").to_string(a.replyToUserId)),stanzaId:a.messageId});a={metadata:{chatEphemeralSetting:f,forwardingScore:h,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:g,quotedMessage:e}};if(b!=null){h=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);a.payload={subProtocol:{consumerMessage:{payload:h.readBuffer(),version:1}}}}return a}function e(a){a=d("MAWAsConsumerApplication").encodeReactionMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function f(a,b){var c;b=d("MAWAsConsumerApplication").deletedMsgAsConsumerApplicationForSpamReporting(a,b);if(b==null)return null;b=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:((c=a.reportingMeta)==null?void 0:c.frankingVersion)!=null?(c=a.reportingMeta)==null?void 0:c.frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:b.readBuffer(),version:1}}}}}g.asMessageApplication=a;g.asMessageApplicationLSDb=b;g.asReactionMessageApplication=e;g.deletedMsgAsMessageApplicationForSpamReporting=f}),98);
__d("MAWXMAEncodeUtils",["MAWAsConsumerApplication","MAWAsMessageApplication","WALogger","WAMsgApplication.pb","WAMsgType","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-text associated message for the XMA content is not supported"]);h=function(){return a};return a}var i=2;function j(a,b){a=d("MAWAsConsumerApplication").validateMediaAndComposeEntryForProtoMsg(a,b);b=a[0];a=a[1];return{payload:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(b,a),version:1}}function a(a,b){var c,e=b.associatedMessage,f=b.favicon,g=b.header,k=b.previews;b=b.xma;var l=null;if(e!=null)if(e.type!==d("WAMsgType").MSG_TYPE.TEXT)d("WALogger").ERROR(h());else{e=d("MAWAsMessageApplication").asMessageApplication(e);e=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,e);l={payload:e.readBuffer(),version:i}}e=g!=null?j(a.msgId,g):null;g=f!=null?j(a.msgId,f):null;f=k!=null?k.map(function(b){return j(a.msgId,b)}):null;k=b.defaultCTA==null?void 0:[b.defaultCTA].concat(b.ctas).filter(Boolean);return{payload:{content:{extendedContentMessage:{associatedMessage:(c=l)!=null?c:void 0,ctas:k,favicon:(c=g)!=null?c:void 0,headerImage:(k=e)!=null?k:void 0,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,previews:(g=f)!=null?g:[],sentWithMessageId:l?a.externalId:void 0,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetType:b.targetType,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}}}}}g.encodeXMAMediaEntry=j;g.encodeXMA=a}),98);
__d("MAWDeviceRegistrationUtilWorker",["MAWConstants","MAWDeviceRegistrationDomainUtil","MAWDeviceRegistrationTypes","MAWGating","MAWWorkerCurrentUser","MessengerWebInitData","URI","WABase64","WALogger","WAPreRegistrationCrypto","err","regeneratorRuntime","uuid"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Registration fetch failed url:",". error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC failed to fetch url:",". error: ",""]);i=function(){return a};return a}function j(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function k(a,b,c,e,f,g,h,i,k){f=d("WABase64").encodeB64(j(f,4));g=d("WABase64").encodeB64(j(g,1));h=d("WABase64").encodeB64(h);var l=d("WABase64").encodeB64(j(i.id,3)),m=d("WABase64").encodeB64(i.keyPair.publicKey);i=d("WABase64").encodeB64(i.signature);a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",l).set("e_skey_val",m).set("e_skey_sig",i);if(k){b=d("WABase64").encodeB64(k.signedICDCIdentityList);c=d("WABase64").encodeB64(k.ihash);a.set("icdc_list",b).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",c)}return a}function l(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}function m(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.prev=0;f.next=3;return b("regeneratorRuntime").awrap(globalThis.fetch(c,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));case 3:e=f.sent;f.next=6;return b("regeneratorRuntime").awrap(e.json());case 6:return f.abrupt("return",f.sent);case 9:f.prev=9;f.t0=f["catch"](0);d("WALogger").ERROR(i(),c,f.t0);throw f.t0;case 13:case"end":return f.stop()}},null,this,[[0,9]])}function n(a,c){var d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(globalThis.fetch(c,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));case 2:d=e.sent;return e.abrupt("return",d.json());case 4:case"end":return e.stop()}},null,this)}function o(){var a=new(c("URI"))(q()+d("MAWDeviceRegistrationTypes").ICDC_ENDPOINT);return a.toString()}function p(a){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=o();g.next=3;return b("regeneratorRuntime").awrap(m(a,e));case 3:f=g.sent;if(!(f==null)){g.next=6;break}throw c("err")(d("MAWDeviceRegistrationTypes").NULL_RESPONSE_FROM_SERVER);case 6:if(!(f.status!==200)){g.next=8;break}throw c("err")("WA Server returned status code "+f.status+" while attempting device registration");case 8:return g.abrupt("return",f);case 9:case"end":return g.stop()}},null,this)}function q(){var a=Number(d("MAWWorkerCurrentUser").getAppID()),b=d("MAWDeviceRegistrationTypes").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:b=d("MAWDeviceRegistrationTypes").REG_IGD_DOMAIN;break;case 772021112871879:d("MAWWorkerCurrentUser").isEmployee()?b=d("MAWDeviceRegistrationTypes").REG_WA_DOMAIN:b=d("MAWDeviceRegistrationTypes").REG_MSGR_DOMAIN;break;default:b=d("MAWDeviceRegistrationTypes").REG_FB_DOMAIN}return b}function r(){var a=new(c("URI"))(q()+d("MAWDeviceRegistrationTypes").REGISTRATION_ENDPOINT);return a.toString()}function s(a){var e,f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:f=r();k.prev=1;k.next=4;return b("regeneratorRuntime").awrap(n(a,f));case 4:g=k.sent;k.next=11;break;case 7:k.prev=7;k.t0=k["catch"](1);d("WALogger").ERROR(h(),f,k.t0);throw c("err")("Post request failed: "+(k.t0==null?void 0:k.t0.message));case 11:if(!(g==null)){k.next=13;break}throw c("err")(d("MAWDeviceRegistrationTypes").NULL_RESPONSE_FROM_SERVER);case 13:if(!(g.wa_device_id==null||g.status!==200)){k.next=17;break}i=g.message!=null?': "'+g.message+'"':"";j="WA Server returned status code "+g.status+i+" while attempting device registration";throw c("err")(j);case 17:if(!(typeof g.wa_device_id!=="number")){k.next=19;break}throw c("err")("Device ID from WA Server was not a number");case 19:return k.abrupt("return",{deviceId:g.wa_device_id,icdcSuccess:(e=g.icdc_success)!=null?e:!1});case 20:case"end":return k.stop()}},null,this,[[1,7]])}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=l(a);return p(b)}function e(a,b,c,d,e,f,g,h,i){a=k(a,b,c,d,e,f,g,h,i);b=l(a);return s(b)}function f(){var a,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:a=!1;e=c("MessengerWebInitData").sessionId!=null&&!a?d("MAWDeviceRegistrationDomainUtil").generateDeviceUUID(c("MessengerWebInitData").sessionId):c("uuid")();g.next=5;return b("regeneratorRuntime").awrap(d("WAPreRegistrationCrypto").makeRegistrationData());case 5:f=g.sent;return g.abrupt("return",{deviceUUID:e,lastSignedPrekeyId:f.signedPreKey.keyId,registrationVersion:d("MAWGating").isDeviceRegistrationDomainUniquenessEnabled()?d("MAWConstants").CURRENT_REGISTRATION_VERSION:void 0,signalRegInfo:f});case 7:case"end":return g.stop()}},null,this)}g.getRegistrationEndpoint=r;g.fetchICDC=a;g.register=e;g.createNewRegistrationMeta=f}),98);
__d("MAWDeviceReregistrationUtilWorker",["MAWBridge","MAWGating","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=d("MAWGating").isMultiDomainReRegRecoveryEnabled()&&a.registrationVersion==null&&a.identityCompareResult!==!0,e=!1;a=b!=null&&!a.deviceUUID.startsWith(b+"-")&&a.deviceUUID!==b;b=d("MAWGating").isReregistrationOnSessionChangeEnabled()&&!e&&a;d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REREG_CHECK,key:"total"});a&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REREG_CHECK,key:"session_changed"});return c||b}g.shouldReregisterArmadilloDevice=a}),98);
__d("MAWDeviceRegistrationWorker",["MAWBridge","MAWClearSignalAndTempStores","MAWCryptoAuthTokenWrapper","MAWDbMetaTxns","MAWDeviceRegistrationActions","MAWDeviceRegistrationTypes","MAWDeviceRegistrationUtilWorker","MAWDeviceReregistrationUtilWorker","MAWGating","MAWIndexedDb","MAWJids","MAWLocationHost","MAWQplProxy","MAWTransactionMode","MAWWorkerCurrentUser","MessengerWebInitData","WAICDCUtils","WAIdentityUtils","WALogger","WAOdsEnums","WAPreRegistrationCrypto","WASignalKeys","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device registration failure - ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping device registration"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crypto Auth Token was null or incomplete"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot process ICDC payload during registration: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Beginning device registration"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);p=function(){return a};return a}var q=!1,r;function s(a){var b=d("MAWLocationHost").getLocationHost();q||(r=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25302457,"311"),{bool:{identityCompareResult:a.identityCompareResult,isDeviceRegistrationDomainUniquenessEnabled:d("MAWGating").isDeviceRegistrationDomainUniquenessEnabled(),isDeviceReRegistration:a.shouldRereg},"int":{registrationVersion:a.registrationVersion},string:{hostname:b}}),q=!0)}function t(){if(q){var a;(a=r)==null?void 0:a.endFail("failure_during_device_registration");r=null}}function a(){if(q){var a;(a=r)==null?void 0:a.endSuccess();r=null}}function u(a){d("WALogger").WARN(p(),a);return{message:a,registrationState:d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.failed}}var v=function(a){return d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READWRITE,signedPrekey:d("MAWTransactionMode").READWRITE})(a)},w=function(a){return d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READWRITE})(a)};function x(a){var c,e,f,g,h,i,j,k,p,q,r,s,t,x,y,z,A,B,C,D;return b("regeneratorRuntime").async(function(E){while(1)switch(E.prev=E.next){case 0:d("WALogger").LOG(o());E.next=3;return b("regeneratorRuntime").awrap(d("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta());case 3:e=E.sent;E.next=6;return b("regeneratorRuntime").awrap(v(d("MAWDeviceRegistrationActions").saveUnsentRegistrationMeta)(e));case 6:f=d("MAWWorkerCurrentUser").getUserID();g=e.signalRegInfo;h=e.deviceUUID;i=d("WAPreRegistrationCrypto").serializeRegistrationData(g);j=null;k=!1;p=(c=k?1019394685547802:d("MAWWorkerCurrentUser").getAppID())==null?void 0:c.toString();d("WALogger").WARN(n(),p,k);if(!(p==null)){E.next=17;break}return E.abrupt("return",u("appId is null, cannot register to WhatsApp"));case 17:q=null;r=null;if(!d("MAWGating").isICDCHTTPRegEnabled()){E.next=35;break}E.prev=20;E.next=23;return b("regeneratorRuntime").awrap(d("MAWDeviceRegistrationUtilWorker").fetchICDC(f,a,p,h));case 23:s=E.sent;t=[].concat(d("WAICDCUtils").base64DeviceIdentitiesToSerializedPubKeys(s.device_identities));s.curr_identity_idx!=null?(x=s.curr_identity_idx,t[x]=d("WASignalKeys").serializeIdentity(i.identityPubKey)):t.push(d("WASignalKeys").serializeIdentity(i.identityPubKey));q=d("WAICDCUtils").computeICDCInfoForUpload(e.signalRegInfo.identityKeyPair,s.icdc_seq,t);E.next=29;return b("regeneratorRuntime").awrap(d("WAIdentityUtils").computeIdentitiesHash(t));case 29:r=E.sent;E.next=35;break;case 32:E.prev=32,E.t0=E["catch"](20),d("WALogger").ERROR(m(),E.t0);case 35:y=!1;E.prev=36;E.next=39;return b("regeneratorRuntime").awrap(d("MAWDeviceRegistrationUtilWorker").register(f,a,p,h,i.regId,i.identityPubKeyType,i.identityPubKey,i.signedPreKey,q&&r?{ihash:r,seq:q.icdcInfo.seq,signedICDCIdentityList:q.encodedSignedICDC,ts:q.icdcInfo.timestamp}:null));case 39:A=E.sent;j=A==null?void 0:A.deviceId;y=(z=A==null?void 0:A.icdcSuccess)!=null?z:!1;E.next=48;break;case 44:E.prev=44;E.t1=E["catch"](36);d("WALogger").WARN(l(),E.t1);return E.abrupt("return",u(E.t1));case 48:if(!(j==null)){E.next=50;break}return E.abrupt("return",u(d("MAWDeviceRegistrationTypes").NULL_RESPONSE_FROM_SERVER));case 50:B=d("MAWJids").toUserJid(f);if(!(d("MAWGating").isICDCHTTPRegEnabled()&&q!=null&&y)){E.next=56;break}C=q.icdcInfo;D=function(a){return d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READWRITE})(a)};E.next=56;return b("regeneratorRuntime").awrap(D(d("MAWDeviceRegistrationActions").saveICDC)(B,{devices:C.devices,dirty:!0,sequence:C.seq,signingDeviceIndex:C.signingDeviceIndex,timestamp:C.timestamp}));case 56:E.next=58;return b("regeneratorRuntime").awrap(w(d("MAWDeviceRegistrationActions").saveDeviceId)(j));case 58:return E.abrupt("return",{message:d("MAWDeviceRegistrationTypes").DEVICE_SUCCESSFULLY_REGISTERED,registrationState:d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.finished});case 59:case"end":return E.stop()}},null,this,[[20,32],[36,44]])}var y=function(a){return d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY,signedPrekey:d("MAWTransactionMode").READONLY})(a)()};function e(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=d("MAWCryptoAuthTokenWrapper").getCryptoAuthToken();if(!(e==null)){h.next=4;break}d("WALogger").ERROR(k());return h.abrupt("return",{message:"Crypto Auth Token was null or incomplete",registrationState:d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.failed});case 4:h.next=6;return b("regeneratorRuntime").awrap(y(d("MAWDeviceRegistrationActions").getRegistrationMeta));case 6:f=h.sent;g=f==null?!1:d("MAWDeviceReregistrationUtilWorker").shouldReregisterArmadilloDevice(f,c("MessengerWebInitData").sessionId);a!=null&&d("MAWQplProxy").addQplPoint(a,"device_registration_check",{bool:{identityCompareResult:f==null?void 0:f.identityCompareResult,isDeviceRegistrationDomainUniquenessEnabled:d("MAWGating").isDeviceRegistrationDomainUniquenessEnabled(),shouldRereg:g},"int":{registrationVersion:f==null?void 0:f.registrationVersion}});if(!(e==null||f==null||f.deviceId==null||g)){h.next=16;break}h.next=12;return b("regeneratorRuntime").awrap(d("MAWClearSignalAndTempStores").clearSignalAndTempStores());case 12:h.next=14;return b("regeneratorRuntime").awrap(d("MAWDbMetaTxns").saveCAT(e));case 14:s({identityCompareResult:f==null?void 0:f.identityCompareResult,registrationVersion:f==null?void 0:f.registrationVersion,shouldRereg:g});return h.abrupt("return",x(e.encrypted_serialized_cat));case 16:d("WALogger").LOG(j());return h.abrupt("return",{message:d("MAWDeviceRegistrationTypes").DEVICE_ALREADY_REGISTERED,registrationState:d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.finished});case 18:case"end":return h.stop()}},null,this)}function f(a){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION,key:"fail"}),d("MAWWorkerCurrentUser").isEmployee()||d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION_NON_EMPLOYEE,key:"fail"}),d("WALogger").ERROR(i(),d("MAWDeviceRegistrationTypes").FAILED_REGISTRATION_RETRIES),a.forEach(function(a){d("WALogger").ERROR(h(),a)}),t()}g.endRegistrationTimerFailure=t;g.endRegistrationTimerSuccess=a;g.handleRegistrationError=u;g.setupDeviceRegistration=e;g.logDeviceRegistrationRetryFailure=f}),98);
__d("MAWDeviceRegistrationInitWorker",["MAWBridge","MAWDeviceRegistrationTypes","MAWDeviceRegistrationWorker","MAWQplProxy","MAWWorkerCurrentUser","WALogger","WAOdsEnums","WAPromiseRetryLoop","WARetryUtils","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Registration finished, ending device registration promise retry loop"]);i=function(){return a};return a}function a(){var a=1,e=new Set(),f=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:function(f){var g,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:if(!(a===d("MAWDeviceRegistrationTypes").MAX_DEVICE_REGISTRATION_RETRIES)){m.next=5;break}d("MAWDeviceRegistrationWorker").logDeviceRegistrationRetryFailure(e);g=d("MAWDeviceRegistrationWorker").handleRegistrationError(d("MAWDeviceRegistrationTypes").FAILED_REGISTRATION_RETRIES);f(g);return m.abrupt("return");case 5:m.prev=5;j=a===1?c("qpl")._(25310776,"6155"):null;m.next=9;return b("regeneratorRuntime").awrap(d("MAWDeviceRegistrationWorker").setupDeviceRegistration(j));case 9:k=m.sent;k.registrationState===d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.finished&&(k.message===d("MAWDeviceRegistrationTypes").DEVICE_SUCCESSFULLY_REGISTERED&&(d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION,key:"success"}),d("MAWWorkerCurrentUser").isEmployee()||d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION_NON_EMPLOYEE,key:"success"}),d("MAWDeviceRegistrationWorker").endRegistrationTimerSuccess()),d("WALogger").LOG(i()),f(k));e.add(k.message);m.next=19;break;case 14:m.prev=14,m.t0=m["catch"](5),l="Uncaught device registration error - "+m.t0,d("WALogger").WARN(h(),l),e.add(""+l);case 19:a++;case 20:case"end":return m.stop()}},null,this,[[5,14]])},name:"deviceRegistration",timer:d("WARetryUtils").FIBONACCI_BACKOFF});d("MAWQplProxy").addQplPoint(c("qpl")._(25310776,"6155"),"device_registration_start");f.start();return f.promise()}g.initDeviceRegistration=a}),98);
__d("MAWDeleteGroupsApi",["MAWDbThreadTxns","MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWThreadTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[d("MAWThreadTypes").ThreadRelatedTablesPermissions].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("deleteGroups",!1)))(function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.group;return d("MAWDbThreadTxns").getThreadByJid(a,c).then(function(b){return!b.success?d("WAResultOrError").makeError("Missing group thread id"):d("MAWGroupManagementTxns").deleteGroup(a,c,b.value)})})).then(function(){})});g.deleteGroups=a}),98);
__d("MAWDualSendApi",["MAWDbDualSendTxns","MAWDexieTable","MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode","WADualSendMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a){return a.threads.toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWThreadManagementTxns").deleteAllThreadData(a,b)}))}).then(function(){})});b=d("MAWIndexedDb").makeMsgrTransactor({isDualSend:d("MAWTransactionMode").READWRITE})(function(a){return a.isDualSend.clear()});c=d("MAWIndexedDb").makeMsgrTransactor({isDualSend:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDbDualSendTxns").getIsDualSendInstallation(a).then(function(a){return a==null?void 0:a.version})});e=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READWRITE})(function(a){return a.groupInfo.where("groupJid").startsWith(d("WADualSendMsgUtils").DUAL_SEND_PREFIX).toArray().then(function(a){return a.map(function(a){return a.groupJid})})});f=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a){var b=a.threads.where("jid").startsWith(d("WADualSendMsgUtils").DUAL_SEND_PREFIX).toArray().then(function(b){return a.threads.bulkDelete(b.map(function(a){return a.chatId}))}),c=a.messages.where("threadJid").startsWith(d("WADualSendMsgUtils").DUAL_SEND_PREFIX).toArray().then(function(b){return a.messages.bulkDelete(b.map(function(a){return a.rowId}))});return d("MAWDexieTable").dexieAll([b,c]).then(function(){})});g.deleteAllThreadsBecauseUserWasInDualSend=a;g.deleteDualSendEntries=b;g.getDualSendVersion=c;g.getShadowGroupJids=e;g.deleteLocalDualSendData=f}),98);
__d("WASmaxInGroupsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInGroupsIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInGroupsFallbackClientMixin",["WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(b.value);return!a.success?a:a}g.parseFallbackClientMixin=a}),98);
__d("WASmaxInGroupsIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","404");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInGroupsGroupDoesNotExistMixin",["WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(b.value);return!a.success?a:a}g.parseGroupDoesNotExistMixin=a}),98);
__d("WASmaxInGroupsIQErrorLockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","locked");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","423");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorLockedMixin=a}),98);
__d("WASmaxInGroupsGroupIsSuspendedMixin",["WASmaxInGroupsIQErrorLockedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(b.value);return!a.success?a:a}g.parseGroupIsSuspendedMixin=a}),98);
__d("WASmaxInGroupsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","400");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInGroupsInvalidParticipantJIDMixin",["WASmaxInGroupsIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(b.value);return!a.success?a:a}g.parseInvalidParticipantJIDMixin=a}),98);
__d("WASmaxInGroupsMalformedStanzaMixin",["WASmaxInGroupsIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(b.value);return!a.success?a:a}g.parseMalformedStanzaMixin=a}),98);
__d("WASmaxInGroupsIQErrorRateOverlimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","rate-overlimit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","429");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorRateOverlimitMixin=a}),98);
__d("WASmaxInGroupsRateLimitedMixin",["WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(b.value);return!a.success?a:a}g.parseRateLimitedMixin=a}),98);
__d("WASmaxInGroupsUnsupportedOperationMixin",["WASmaxInGroupsIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(b.value);return!a.success?a:a}g.parseUnsupportedOperationMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-authorized");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","401");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin",["WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(b.value);return!a.success?a:a}g.parseUserDoesNotHaveAdminPermissionMixin=a}),98);
__d("WASmaxInGroupsIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","403");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInGroupsUserIsNotAParticipantMixin",["WASmaxInGroupsIQErrorForbiddenMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(b.value);return!a.success?a:a}g.parseUserIsNotAParticipantMixin=a}),98);
__d("WASmaxInGroupsLeaveClientErrors",["WAResultOrError","WASmaxInGroupsFallbackClientMixin","WASmaxInGroupsGroupDoesNotExistMixin","WASmaxInGroupsGroupIsSuspendedMixin","WASmaxInGroupsInvalidParticipantJIDMixin","WASmaxInGroupsMalformedStanzaMixin","WASmaxInGroupsRateLimitedMixin","WASmaxInGroupsUnsupportedOperationMixin","WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin","WASmaxInGroupsUserIsNotAParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsRateLimitedMixin").parseRateLimitedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RateLimited",value:b.value});var c=d("WASmaxInGroupsUnsupportedOperationMixin").parseUnsupportedOperationMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"UnsupportedOperation",value:c.value});var e=d("WASmaxInGroupsInvalidParticipantJIDMixin").parseInvalidParticipantJIDMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"InvalidParticipantJID",value:e.value});var f=d("WASmaxInGroupsMalformedStanzaMixin").parseMalformedStanzaMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"MalformedStanza",value:f.value});var g=d("WASmaxInGroupsGroupDoesNotExistMixin").parseGroupDoesNotExistMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"GroupDoesNotExist",value:g.value});var h=d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin").parseUserDoesNotHaveAdminPermissionMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"UserDoesNotHaveAdminPermission",value:h.value});var i=d("WASmaxInGroupsUserIsNotAParticipantMixin").parseUserIsNotAParticipantMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"UserIsNotAParticipant",value:i.value});var j=d("WASmaxInGroupsGroupIsSuspendedMixin").parseGroupIsSuspendedMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"GroupIsSuspended",value:j.value});var k=d("WASmaxInGroupsFallbackClientMixin").parseFallbackClientMixin(a);return k.success?d("WAResultOrError").makeResult({name:"FallbackClient",value:k.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RateLimited","UnsupportedOperation","InvalidParticipantJID","MalformedStanza","GroupDoesNotExist","UserDoesNotHaveAdminPermission","UserIsNotAParticipant","GroupIsSuspended","FallbackClient"],[b,c,e,f,g,h,i,j,k])}g.parseLeaveClientErrors=a}),98);
__d("WASmaxInGroupsLeaveResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsLeaveClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!c.success)return c;b=d("WASmaxInGroupsLeaveClientErrors").parseLeaveClientErrors(a);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{leaveClientErrors:b.value}))}g.parseLeaveResponseClientError=a}),98);
__d("WASmaxInGroupsIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInGroupsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","500");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorPartialServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","partial-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","530");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPartialServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","503");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInGroupsServerErrors",["WAResultOrError","WASmaxInGroupsIQErrorFallbackServerMixin","WASmaxInGroupsIQErrorInternalServerErrorMixin","WASmaxInGroupsIQErrorPartialServerErrorMixin","WASmaxInGroupsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInGroupsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value});var e=d("WASmaxInGroupsIQErrorPartialServerErrorMixin").parseIQErrorPartialServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorPartialServerError",value:e.value});var f=d("WASmaxInGroupsIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable","IQErrorPartialServerError","IQErrorFallbackServer"],[b,c,e,f])}g.parseServerErrors=a}),98);
__d("WASmaxInGroupsBaseServerErrorMixin",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseBaseServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseLeaveResponseServerError=a}),98);
__d("WASmaxInGroupsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveGroupNotAllowedMixin","WASmaxInGroupsLeaveGroupServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveGroupNotAllowedMixin").parseLeaveGroupNotAllowedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveGroupNotAllowed",value:b.value});var c=d("WASmaxInGroupsLeaveGroupServerErrorMixin").parseLeaveGroupServerErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"LeaveGroupServerError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveGroupNotAllowed","LeaveGroupServerError"],[b,c])}g.parseLeaveGroupNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","400");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsBadRequestMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin","WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin","WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin").parseLeaveLinkedGroupsBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsBadRequest",value:b.value});var c=d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin").parseLeaveLinkedGroupsNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsNotAllowed",value:c.value});var e=d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin").parseLeaveLinkedGroupsServerErrorMixin(a);return e.success?d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsServerError",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveLinkedGroupsBadRequest","LeaveLinkedGroupsNotAllowed","LeaveLinkedGroupsServerError"],[b,c,e])}g.parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsParentGroupMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrGroupJid(a,"parent_group_jid");return!a.success?a:d("WAResultOrError").makeResult({parentGroupJid:a.value})}g.parseParentGroupMixin=a}),98);
__d("WASmaxInGroupsLeaveResponseSuccess",["WAResultOrError","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsParentGroupMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"id");if(!b.success)return b;a=d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup").parseLeaveGroupNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({id:b.value,leaveGroupNotAllowedOrServerErrorMixinGroup:a.success?a.value:null})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxInGroupsParentGroupMixin").parseParentGroupMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup").parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{leaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup:a.success?a.value:null}))}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"leave");if(!c.success)return c;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"group",0,1024,h);if(!b.success)return b;c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"linked_groups",0,1024,i);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{leaveGroup:b.value,leaveLinkedGroups:c.value}))}g.parseLeaveResponseSuccessLeaveGroup=h;g.parseLeaveResponseSuccessLeaveLinkedGroups=i;g.parseLeaveResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutGroupsBaseSetServerMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").G_US,xmlns:"w:g2"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetServerMixin=a}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(a,b,c,d,e,f){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="SmaxMixinGroupExhaustiveError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));f.SmaxMixinGroupExhaustiveError=a}),66);
__d("WASmaxOutGroupsParentGroupMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyParentGroupJid;a=d("WASmaxJsx").smax("smax$any",{parent_group_jid:d("WAWap").GROUP_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeParentGroupMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,0,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveGroupsRequestGroup=h;g.makeLeaveLeaveGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,0,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,1,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveLinkedGroupsRequestGroup=h;g.makeLeaveLeaveLinkedGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveLinkedGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsLeaveLeaveGroupsRequestMixin","WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.leaveLeaveLinkedGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin").mergeLeaveLeaveLinkedGroupsRequestMixin(a,b.leaveLeaveLinkedGroupsRequest);if(b.leaveLeaveGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin").mergeLeaveLeaveGroupsRequestMixin(a,b.leaveLeaveGroupsRequest);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup=a}),98);
__d("WASmaxOutGroupsLeaveRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetServerMixin","WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup"],(function(a,b,c,d,e,f,g){function a(a){a=a.leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs;a=d("WASmaxOutGroupsBaseSetServerMixin").mergeBaseSetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup").mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup(d("WASmaxJsx").smax("leave",null),a)));return a}g.makeLeaveRequest=a}),98);
__d("WASmaxGroupsLeaveRPC",["WAComms","WASmaxInGroupsLeaveResponseClientError","WASmaxInGroupsLeaveResponseServerError","WASmaxInGroupsLeaveResponseSuccess","WASmaxOutGroupsLeaveRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsLeaveRequest").makeLeaveRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsLeaveResponseSuccess").parseLeaveResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"LeaveResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsLeaveResponseServerError").parseLeaveResponseServerError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"LeaveResponseServerError",value:h.value});case 10:i=d("WASmaxInGroupsLeaveResponseClientError").parseLeaveResponseClientError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"LeaveResponseClientError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Leave",{Success:g,ServerError:h,ClientError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendLeaveRPC=a}),98);
__d("WALeaveGroups",["WABridge","WADualSendMsgUtils","WAErr","WAGlobals","WAJobs","WAOdsEnums","WASmaxGroupsLeaveRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=a.groups;if(!(e.length===0)){h.next=3;break}return h.abrupt("return");case 3:h.next=5;return b("regeneratorRuntime").awrap(d("WASmaxGroupsLeaveRPC").sendLeaveRPC({leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs:{leaveLeaveGroupsRequest:{groupArgs:e.map(function(a){return{groupId:d("WADualSendMsgUtils").isDualSendJid(a)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a):a}})}}}));case 5:f=h.sent;if(!(f.name!=="LeaveResponseSuccess")){h.next=9;break}d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"fail"});throw c("WAErr")("Failed to parse leaveGroups response");case 9:d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"success"});g=f.value;h.next=13;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().leaveGroups({groupJids:g.leaveGroup.map(function(a){return a.id})}));case 13:case"end":return h.stop()}},null,this)}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("leaveGroups",function(a){a=a.groups;return h({groups:a})}).end();g.leaveGroupsStep=h;g.leaveGroups=a}),98);
__d("MAWDualSendCleanup",["MAWDeleteGroupsApi","MAWDualSendApi","Promise","WAJids","WALeaveGroups","WALogger","WAPromiseDelays","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to clean up shadow data after leaving shadow groups"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to successfully leave all shadow groups"]);i=function(){return a};return a}var j=400;function k(a){var e=c("justknobx")._("600");return e?a.reduce(function(a,b){return a.then(function(){return d("WALeaveGroups").leaveGroupsStep({groups:[b]}).then(function(){return d("MAWDeleteGroupsApi").deleteGroups([{deleter:d("WAJids").AUTHOR_ME,group:b}])}).then(function(){return d("WAPromiseDelays").delayMs(j)})})},b("Promise").resolve()):d("MAWDeleteGroupsApi").deleteGroups(a.map(function(a){return{deleter:d("WAJids").AUTHOR_ME,group:a}}))}function a(){return d("MAWDualSendApi").getShadowGroupJids().then(function(a){return k(a)})["catch"](function(a){d("WALogger").ERROR(i());throw a}).then(function(){return d("MAWDualSendApi").deleteLocalDualSendData()})["catch"](function(a){d("WALogger").ERROR(h());throw a}).then(d("MAWDualSendApi").deleteDualSendEntries)}g.MIN_DUAL_SEND_GROUP_DELAY_MS=j;g.cleanDualSendMessagingData=a}),98);
__d("WAScheduleAfterOfflineResume",["Promise","WAGlobals","WAOfflineUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){return b("Promise").resolve()}var i=new Map();function a(a){var c=a.code,e=a.id;a=a.combine;var f=d("WAGlobals").getServerRPC().offlineQueueManager();if(!f){c();return}if(f.getMode()===d("WAOfflineUtils").ServerRPCMode.ONLINE){c();return}f=c;if(a===!0&&i.has(e)){var g=i.get(e)||h;f=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(g());case 2:a.next=4;return b("regeneratorRuntime").awrap(c());case 4:case"end":return a.stop()}},null,this)}}i.set(e,f)}function c(){var a=i.entries();i=new Map();for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;d[0];d=d[1];d()}}g.noopAction=h;g.scheduleAfterOfflineResume=a;g.flushPostponedActions=c}),98);
__d("WAStanzaQueueConsumerApi",["WAGlobals","WALogger","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WAScheduleAfterOfflineResume","WAStanzaQueueState","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handler is called"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Execute handler with "," entries"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Passed at least "," tries to process stanzas in Consumer"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Consumer wasn't able to process "," "," times at max"]);l=function(){return a};return a}var m=10,n=2,o=20,p=d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaQueueHandler"]),q=function(a){return d("WAGlobals").runInTransaction({StanzaQueueStore:!0},function(c){var d,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:d=c.StanzaQueueStore;e=[];f={message:0,receipt:0,retry:0,notification:0};g=0;h.next=6;return b("regeneratorRuntime").awrap(d.modify(function(b){if(a.has(b.stanzaQueueId))return;e.push(b);b.consumerRetries>g&&(g=b.consumerRetries);if(b.consumerRetries>=m)switch(b.type){case"message":f.message++;break;case"notification":f.notification++;break;case"receipt":f.receipt++;break;case"retryReceipt":f.retry++;break;default:b}else b.consumerRetries!=null&&!isNaN(b.consumerRetries)?b.consumerRetries++:b.consumerRetries=1}));case 6:g>=n&&p.WARN(l(),f,g);(g===m||g%o===0&&g>m)&&p.ERROR(k(),m);return h.abrupt("return",e);case 9:case"end":return h.stop()}},null,this)})};function a(a){return d("WAGlobals").runInTransaction({StanzaQueueStore:!0},function(b){b=b.StanzaQueueStore;return b.remove(a)})}function r(){var a=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:function(a){var c,e,f,g,k,l,m,n,o,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:c=d("WAStanzaQueueState").getStanzaQueueManager();v.next=3;return b("regeneratorRuntime").awrap(q(c.pendingIds));case 3:e=v.sent;if(!(e.length===0)){v.next=7;break}a();return v.abrupt("return");case 7:f=e,g=Array.isArray(f),k=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 8:if(!g){v.next=14;break}if(!(k>=f.length)){v.next=11;break}return v.abrupt("break",22);case 11:l=f[k++];v.next=18;break;case 14:k=f.next();if(!k.done){v.next=17;break}return v.abrupt("break",22);case 17:l=k.value;case 18:m=l,c.pendingIds.add(m.stanzaQueueId);case 20:v.next=8;break;case 22:p.LOG(j(),e.length);v.prev=23;v.next=26;return b("regeneratorRuntime").awrap(d("WAStanzaQueueState").getStanzaQueueManager().handler(e,d("WAStanzaQueueState").ackStanzas));case 26:n=v.sent;p.LOG(i());v.next=34;break;case 30:v.prev=30,v.t0=v["catch"](23),p.ERROR(h(),v.t0),n=d("WAResultOrError").makeError();case 34:if(!(n.success===!1)){v.next=51;break}o=e,r=Array.isArray(o),s=0,o=r?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 36:if(!r){v.next=42;break}if(!(s>=o.length)){v.next=39;break}return v.abrupt("break",50);case 39:t=o[s++];v.next=46;break;case 42:s=o.next();if(!s.done){v.next=45;break}return v.abrupt("break",50);case 45:t=s.value;case 46:u=t,c.pendingIds["delete"](u.stanzaQueueId);case 48:v.next=36;break;case 50:return v.abrupt("return");case 51:a();case 52:case"end":return v.stop()}},null,this,[[23,30]])},name:"StanzaQueueConsumer",timer:d("WARetryUtils").FIBONACCI_BACKOFF});a.start();return a.promise()}function c(){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){return r()},id:"StanzaQueueStore"})}g.readStanzasAndIncreaseRetryCount=q;g.removeStanzaQueueEntries=a;g.invokeStanzaQueueSubscriber=c}),98);
__d("WAStanzaQueueState",["WAErr","WAGlobals","WALogger","WAStanzaQueueConsumerApi"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot remove acked stanzas ",""]);h=function(){return a};return a}var i=null;function a(a){if(i!=null)throw c("WAErr")("Stanza queue handler was already set");i={handler:a,pendingIds:new Set()};d("WAGlobals").getConfig().enableRawStanzaQueueStore()===!0&&d("WAStanzaQueueConsumerApi").invokeStanzaQueueSubscriber()}function b(a){return d("WAStanzaQueueConsumerApi").removeStanzaQueueEntries(a).then(function(){var b=j();for(var c=0;c<a.length;c++){var d=a[c];b.pendingIds["delete"](d)}})["catch"](function(a){d("WALogger").TAGS(["ServerRPC","StanzaQueue","ackStanzas"]).ERROR(h(),a)})}function j(){if(i==null)throw c("WAErr")("Stanza queue handler has not been set");return i}g.initStanzaQueue=a;g.ackStanzas=b;g.getStanzaQueueManager=j}),98);
__d("WAStanzaQueuePersistApi",["WAGlobals","WAJids","WALogger","WAResultOrError","WAStanzaQueueConsumerApi"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);h=function(){return a};return a}a=function(a){return d("WAGlobals").runInTransaction({StanzaQueueStore:!0},function(b){b=b.StanzaQueueStore;return b.bulkPut(a.map(function(a){return{jid:a.decrypted.id.chat,message:{details:a.details,decrypted:a.decrypted},stanzaId:a.decrypted.id.externalId,type:"message",consumerRetries:0}})).then(function(){return a.map(function(a){return babelHelpers["extends"]({},a,{db:d("WAResultOrError").makeResult({icdcResults:null,plaintextHashs:null,protocolMsgId:a.decrypted.id,unknownDevice:!1,unknownGroup:!1})})})})}).then(function(a){d("WAStanzaQueueConsumerApi").invokeStanzaQueueSubscriber();return a})};b=function(a){return d("WAGlobals").runInTransaction({StanzaQueueStore:!0},function(b){b=b.StanzaQueueStore;return b.bulkPut(a.map(function(a){switch(a.receiptType){case"user":case"group-server-agg":case"group":return{jid:a.chat,receipt:a,stanzaId:a.stanzaId,type:"receipt",consumerRetries:0};default:a.receiptType;return{jid:d("WAJids").extractUserJid(a.from),receipt:a,stanzaId:a.stanzaId,type:"receipt",consumerRetries:0}}}))}).then(function(a){d("WAStanzaQueueConsumerApi").invokeStanzaQueueSubscriber();return a})};c=function(a){return d("WAGlobals").runInTransaction({StanzaQueueStore:!0},function(b){b=b.StanzaQueueStore;return b.bulkPut(a.map(function(a){switch(a.type){case"devices":return{jid:a.notification.jid,notification:a,stanzaId:a.stanzaId,type:"notification",consumerRetries:0};case"group":return{jid:a.notification.groupJid,notification:a,stanzaId:a.stanzaId,type:"notification",consumerRetries:0};case"mediaretry":return{jid:a.notification.from.chat,notification:a,stanzaId:a.stanzaId,type:"notification",consumerRetries:0};case"thread":return{jid:a.notification.chatJid,notification:a,stanzaId:a.stanzaId,type:"notification",consumerRetries:0};default:d("WALogger").TAGS(["StanzaQueue"]).ERROR(h(),a.type);return null}}).filter(Boolean))}).then(function(a){d("WAStanzaQueueConsumerApi").invokeStanzaQueueSubscriber();return a})};g.persistMsgsTransaction=a;g.persistReceiptsTransaction=b;g.persistNotificationTransaction=c}),98);
__d("MAWHandleThreadNotification",["MAWFolderTypes","MAWGlobals","Promise","WALogger","WAStanzaQueuePersistApi","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification with id: ",", jid: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function a(a){var c=a.stanzaId,e=a.notification,f=e.actions,g=e.chatJid;function l(){return b("Promise").resolve([d("WAWap").wap("ack",{"class":"notification",id:d("WAWap").CUSTOM_STRING(c),to:d("WAWap").S_WHATSAPP_NET,type:d("WAWap").CUSTOM_STRING("fbid:thread")})])}function m(){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!d("MAWGlobals").getConfig().enableRawStanzaQueueStore()){e.next=4;break}d("WAStanzaQueuePersistApi").persistNotificationTransaction([a]);e.next=6;break;case 4:e.next=6;return b("regeneratorRuntime").awrap(b("Promise").all(f.map(function(a){switch(a.type){case"folder":var e;e=(e=a.folderId)!=null?e:d("MAWFolderTypes").FOLDER_ID.INBOX;d("WALogger").LOG(k(),c,e,g);return d("MAWGlobals").getDbImpls().updateThreadFolder(g,e);case"connected":d("WALogger").LOG(j(),c,g);return d("MAWGlobals").getDbImpls().handleConnectedAdminMsg(g);default:a.type;d("WALogger").ERROR(i(),c,g);return b("Promise").resolve()}})));case 6:return e.abrupt("return",{followUp:l});case 7:case"end":return e.stop()}},null,this)}function n(){d("WALogger").LOG(h(),c,g);return b("Promise").resolve({persist:m})}return{process:n}}g.handleThreadNotification=a}),98);
__d("WASetContactsApi",["WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WAGlobals").runInTransaction({ContactsStore:!0},function(b){b=b.ContactsStore;return b.bulkPut(a)},"setContacts")};g.setContacts=a}),98);
__d("WADeviceUpdateUtils",["Promise","WAGlobals","WAICDCUtils","WAJids","WAJobDefinitions","WAJobs","WAResultOrError","WASetContactsApi","WASignalKeys","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("WAGlobals").getCryptoManager().storage.runInTransaction(function(c){c=c.updateDevicesForUser;return c(a,b).then(function(){return d("WAResultOrError").makeResult()})}).then(function(){})}function a(a,b,c,e){e===void 0&&(e=null);var f=[],g=null;if(b){f=b.device.map(function(a){var b;return{id:d("WAJids").interpretAsDeviceId(a.id),identity:d("WASignalKeys").serializeIdentity(a.elementValue),platform:(b=a.deviceModelInfoMixin)==null?void 0:(b=b.platform)==null?void 0:b.elementValue,model:(b=a.deviceModelInfoMixin)==null?void 0:(a=b.model)==null?void 0:a.elementValue}});g=(b=b.dhashMixin)==null?void 0:b.dhash}b=null;if(c){var h;h=((h=c.iCDCDirtyMixin)==null?void 0:h.dirty)==="true";var i=d("WATimeUtils").castToUnixTime(c.ts),j=c.seq;c=d("WAICDCUtils").decodeICDCInfo(c.elementValue);b=d("WAICDCUtils").validateAndPrepareICDCFromNotification(j,h,i,c)}return{jid:a,devices:f,lastSyncTs:d("WATimeUtils").unixTime(),dhash:g,icdcInfo:b,notificationTs:e}}function c(a){var c,e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:if(!(a.length===0)){j.next=2;break}return j.abrupt("return");case 2:c=[];e=[];a.forEach(function(a){var b=a.jid,f=a.devices,g=a.dhash,i=a.lastSyncTs;a=a.icdcInfo;var j=f.map(function(a){var c=a.id,e=a.identity,f=a.model;a=a.platform;return{device:d("WAJids").toDeviceJid(b,c),identity:e,model:f,platform:a}});c.push({contactJid:b,dhash:g,lastSyncTs:i,icdcInfo:(g=a)!=null?g:void 0,identities:j});e.push(h(b,f.map(function(a){var c=a.id;a=a.identity;return{id:d("WAJids").toDeviceJid(b,c),identity:a}})))});j.next=7;return b("regeneratorRuntime").awrap(b("Promise").all(e));case 7:j.next=9;return b("regeneratorRuntime").awrap(d("WASetContactsApi").setContacts(c));case 9:if(!d("WAGlobals").getConfig().isICDCEnabled()){j.next=17;break}f=d("WAGlobals").getMyUserJid();g=a.find(function(a){return a.jid===f});if(!(g!=null)){j.next=17;break}i=g.icdcInfo;if(!(i==null||d("WAICDCUtils").isICDCIndexInvalid(i)||(i==null?void 0:i.dirty))){j.next=17;break}j.next=17;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.computeAndUploadICDCInfo(i==null?void 0:i.sequence)));case 17:case"end":return j.stop()}},null,this)}g.updateDevicesForUser=h;g.parseUserResponseMixin=a;g.updateUsersDevicesSignalAndDB=c}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"model",i);return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,model:a.value})}g.parseDeviceModelInfoPlatform=h;g.parseDeviceModelInfoModel=i;g.parseDeviceModelInfoMixin=a}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"dhash");return!a.success?a:d("WAResultOrError").makeResult({dhash:a.value})}g.parseDhashMixin=a}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!a.success?a:d("WAResultOrError").makeResult({elementValue:a.value})}g.parseKeyDataMixin=a}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!a.success)return a;a=d("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(a.value);return!a.success?a:a}g.parseIdentityKeyMixin=a}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!b.success)return b;var c=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;a=d("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({id:b.value},c.value,{deviceModelInfoMixin:a.success?a.value:null}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDhashMixin").parseDhashMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(a,"device",0,25,h);return!a.success?a:d("WAResultOrError").makeResult({dhashMixin:b.success?b.value:null,device:a.value})}g.parseDeviceListDevice=h;g.parseDeviceListMixin=a}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"dirty","true");return!b.success?b:d("WAResultOrError").makeResult({dirty:b.value})}g.parseICDCDirtyMixin=a}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrIntRange(a,"seq",0,2147483647);return!a.success?a:d("WAResultOrError").makeResult({seq:a.value})}g.parseICDCSeqMixin=a}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"ts",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").contentBytesRange(a,1,40072);if(!c.success)return c;a=d("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({ts:b.value,elementValue:c.value},a.value))}g.parseICDCSignedListMixin=a}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(a);if(!b.success)return b;a=d("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{iCDCDirtyMixin:a.success?a.value:null}))}g.parseICDCFromServerMixin=a}),98);
__d("WASmaxInDevicesServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInDevicesChangeNotificationRequest",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxInDevicesServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"devices",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"icdc",i);if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","fbid:devices");if(!e.success)return e;var f=d("WASmaxParseJid").attrUserJid(a,"from");if(!f.success)return f;a=d("WASmaxInDevicesServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:e.value,from:f.value},a.value,{devices:b.value,icdc:c.value}))}g.parseChangeNotificationRequestDevices=h;g.parseChangeNotificationRequestIcdc=i;g.parseChangeNotificationRequest=a}),98);
__d("WASmaxOutDevicesNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").USER_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutDevicesChangeNotificationResponseAck",["WASmaxJsx","WASmaxOutDevicesNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutDevicesNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeChangeNotificationResponseAck=a}),98);
__d("WASmaxDevicesChangeNotificationRPC",["WASmaxInDevicesChangeNotificationRequest","WASmaxOutDevicesChangeNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesChangeNotificationRequest").parseChangeNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ChangeNotification",{Request:b}));return{parsedRequest:b.value,makeChangeNotificationResponseAck:function(){return d("WASmaxOutDevicesChangeNotificationResponseAck").makeChangeNotificationResponseAck(a)}}}g.receiveChangeNotificationRPC=a}),98);
__d("WAHandleDeviceChangeNotification",["WADeviceUpdateUtils","WAGlobals","WAICDCUtils","WAJids","WAJobDefinitions","WAJobs","WALogger","WAResultOrError","WASmaxDevicesChangeNotificationRPC","WAStanzaQueuePersistApi","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to notify "," contacts of device change"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Notified "," contacts of device change"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDeviceChangeNotification from user with jid: ",""]);k=function(){return a};return a}function a(a){a=d("WASmaxDevicesChangeNotificationRPC").receiveChangeNotificationRPC(a);var b=a.parsedRequest,c=b.from,e=b.devices,f=b.icdc;b=b.t;return{notification:d("WADeviceUpdateUtils").parseUserResponseMixin(c,e,f,d("WATimeUtils").castToUnixTime(b)),ack:a.makeChangeNotificationResponseAck}}function c(a){var c=function(){var c,f,g,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:c=a.notification;f=c.jid;d("WALogger").LOG(k(),f);g=d("WAGlobals").getMyUserJid();if(!(f===g)){m.next=10;break}m.next=7;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().loadRecentParticipants(d("WAGlobals").getConfig().maxUsersForNotifyDeviceChange(),g));case 7:l=m.sent;m.next=10;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.notifyDeviceChange(l)).then(function(){d("WALogger").LOG(j(),l.size)})["catch"](function(a){d("WALogger").LOG(i(),l.size),d("WALogger").ERROR(h(),a)}));case 10:return m.abrupt("return",{persist:function(){return e(a)}});case 11:case"end":return m.stop()}},null,this)};function e(a){if(d("WAGlobals").getConfig().enableRawStanzaQueueStore()){a.ack;var b=babelHelpers.objectWithoutPropertiesLoose(a,["ack"]);return d("WAStanzaQueuePersistApi").persistNotificationTransaction([b]).then(function(){return{followUp:function(){return f(a)}}})}return d("WAGlobals").getDbImpls().updateUserDevices([a.notification]).then(function(){return{followUp:function(){return f(a)}}})}function f(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.notification,e=c.jid,f=c.devices;j.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getInMemorySignal().runInTransaction(function(a){var b=a.saveIdentity;f.forEach(function(a){var c=a.id;a=a.identity;b(d("WAJids").toDeviceJid(e,c),a)});return d("WAResultOrError").makeResult()}));case 3:j.next=5;return b("regeneratorRuntime").awrap(d("WAGlobals").getInMemorySignal().savePendingToDatabase());case 5:if(!d("WAGlobals").getConfig().isICDCEnabled()){j.next=13;break}g=d("WAGlobals").getMyUserJid();h=a.notification.jid===g?a.notification:null;if(!(h!=null)){j.next=13;break}i=h.icdcInfo;if(!(i==null||d("WAICDCUtils").isICDCIndexInvalid(i)||(i==null?void 0:i.dirty))){j.next=13;break}j.next=13;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.computeAndUploadICDCInfo()));case 13:return j.abrupt("return",[a.ack()]);case 14:case"end":return j.stop()}},null,this)}return{process:c}}g.parseDeviceChangeNotification=a;g.handleDeviceChangeNotification=c}),98);
__d("WASmaxDecisionTreeUtils",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").maybeChildren(a);if(!b.success)return b;b=b.value;return b==null||b.length===0?d("WASmaxParseUtils").errorMessage(a,"to have at least 1 child, but found 0"):d("WAResultOrError").makeResult(b[0])}g.firstChild=a}),98);
__d("WASmaxInPreKeysNotificationContactIDChangedIdentityBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"identity");if(!b.success)return b;b=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!b.success)return b;a=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,a.value))}g.parseNotificationContactIDChangedIdentityBundleMixin=a}),98);
__d("WASmaxInPreKeysDisplayNameMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"display_name");return!a.success?a:d("WAResultOrError").makeResult({displayName:a.value})}g.parseDisplayNameMixin=a}),98);
__d("WASmaxInPreKeysNotificationContactIDChangedLIDAttrMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseJid").attrDeviceJid(a,"lid");return!b.success?b:d("WAResultOrError").makeResult({lid:b.value})}g.parseNotificationContactIDChangedLIDAttrMixin=a}),98);
__d("WASmaxInPreKeysNotificationContactIDChangedLIDAttrOrDisplayNameMixinGroup",["WAResultOrError","WASmaxInPreKeysDisplayNameMixin","WASmaxInPreKeysNotificationContactIDChangedLIDAttrMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysNotificationContactIDChangedLIDAttrMixin").parseNotificationContactIDChangedLIDAttrMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NotificationContactIDChangedLIDAttr",value:b.value});var c=d("WASmaxInPreKeysDisplayNameMixin").parseDisplayNameMixin(a);return c.success?d("WAResultOrError").makeResult({name:"DisplayName",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LIDAttr","DisplayName"],[b,c])}g.parseNotificationContactIDChangedLIDAttrOrDisplayNameMixinGroup=a}),98);
__d("WASmaxInPreKeysServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInPreKeysNotificationContactIDChangedRequest",["WAResultOrError","WASmaxInPreKeysNotificationContactIDChangedIdentityBundleMixin","WASmaxInPreKeysNotificationContactIDChangedLIDAttrOrDisplayNameMixinGroup","WASmaxInPreKeysServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"identity");if(!b.success)return b;var c=d("WASmaxParseJid").attrDeviceJid(a,"from");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","encrypt");if(!e.success)return e;b=d("WASmaxInPreKeysNotificationContactIDChangedIdentityBundleMixin").parseNotificationContactIDChangedIdentityBundleMixin(b.value);var f=d("WASmaxInPreKeysServerNotificationMixin").parseServerNotificationMixin(a);if(!f.success)return f;a=d("WASmaxInPreKeysNotificationContactIDChangedLIDAttrOrDisplayNameMixinGroup").parseNotificationContactIDChangedLIDAttrOrDisplayNameMixinGroup(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value,identityNotificationContactIDChangedIdentityBundleMixin:b.success?b.value:null},f.value,{notificationContactIDChangedLIDAttrOrDisplayNameMixinGroup:a.success?a.value:null}))}g.parseNotificationContactIDChangedRequest=a}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={validators:[d("WAJids").validateDeviceJid,d("WAJids").validateDomainJid],typeName:"DeviceJid|DomainJid"};g.DEVICEJID_DOMAINJID=a}),98);
__d("WASmaxOutPreKeysNotificationClientAckMixin",["WASmaxInPreKeysEnums","WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrJidEnum,a,["from"],d("WASmaxInPreKeysEnums").DEVICEJID_DOMAINJID);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutPreKeysNotificationContactIDChangedResponseAck",["WASmaxJsx","WASmaxOutPreKeysNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeNotificationContactIDChangedResponseAck=a}),98);
__d("WASmaxPreKeysNotificationContactIDChangedRPC",["WASmaxInPreKeysNotificationContactIDChangedRequest","WASmaxOutPreKeysNotificationContactIDChangedResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysNotificationContactIDChangedRequest").parseNotificationContactIDChangedRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("NotificationContactIDChanged",{Request:b}));return{parsedRequest:b.value,makeNotificationContactIDChangedResponseAck:function(){return d("WASmaxOutPreKeysNotificationContactIDChangedResponseAck").makeNotificationContactIDChangedResponseAck(a)}}}g.receiveNotificationContactIDChangedRPC=a}),98);
__d("WASmaxInPreKeysNotificationDigestRequest",["WAResultOrError","WASmaxInPreKeysServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!b.success)return b;b=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","encrypt");if(!c.success)return c;a=d("WASmaxInPreKeysServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:b.value,type:c.value},a.value))}g.parseNotificationDigestRequest=a}),98);
__d("WASmaxOutPreKeysNotificationDigestResponseAck",["WASmaxJsx","WASmaxOutPreKeysNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeNotificationDigestResponseAck=a}),98);
__d("WASmaxPreKeysNotificationDigestRPC",["WASmaxInPreKeysNotificationDigestRequest","WASmaxOutPreKeysNotificationDigestResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysNotificationDigestRequest").parseNotificationDigestRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("NotificationDigest",{Request:b}));return{parsedRequest:b.value,makeNotificationDigestResponseAck:function(){return d("WASmaxOutPreKeysNotificationDigestResponseAck").makeNotificationDigestResponseAck(a)}}}g.receiveNotificationDigestRPC=a}),98);
__d("WASmaxInPreKeysDeprecatedPNIdentityTypeMixin",["WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WASmaxParseUtils").voidSuccess}g.parseDeprecatedPNIdentityTypeMixin=a}),98);
__d("WASmaxInPreKeysFBIDIdentityTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"identity_type","fbid");return!a.success?a:d("WAResultOrError").makeResult({identityType:a.value})}g.parseFBIDIdentityTypeMixin=a}),98);
__d("WASmaxInPreKeysLIDIdentityTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"identity_type","lid");return!a.success?a:d("WAResultOrError").makeResult({identityType:a.value})}g.parseLIDIdentityTypeMixin=a}),98);
__d("WASmaxInPreKeysPNIdentityTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"identity_type","pn");return!a.success?a:d("WAResultOrError").makeResult({identityType:a.value})}g.parsePNIdentityTypeMixin=a}),98);
__d("WASmaxInPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup",["WAResultOrError","WASmaxInPreKeysDeprecatedPNIdentityTypeMixin","WASmaxInPreKeysFBIDIdentityTypeMixin","WASmaxInPreKeysLIDIdentityTypeMixin","WASmaxInPreKeysPNIdentityTypeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysLIDIdentityTypeMixin").parseLIDIdentityTypeMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LIDIdentityType",value:b.value});var c=d("WASmaxInPreKeysPNIdentityTypeMixin").parsePNIdentityTypeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"PNIdentityType",value:c.value});var e=d("WASmaxInPreKeysFBIDIdentityTypeMixin").parseFBIDIdentityTypeMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"FBIDIdentityType",value:e.value});var f=d("WASmaxInPreKeysDeprecatedPNIdentityTypeMixin").parseDeprecatedPNIdentityTypeMixin(a);return f.success?d("WAResultOrError").makeResult({name:"DeprecatedPNIdentityType",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LIDIdentityType","PNIdentityType","FBIDIdentityType","DeprecatedPNIdentityType"],[b,c,e,f])}g.parseLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup=a}),98);
__d("WASmaxInPreKeysNotificationLowCountRequest",["WAResultOrError","WASmaxInPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup","WASmaxInPreKeysServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"count");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","encrypt");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(b.value,"value",0,100);if(!f.success)return f;a=d("WASmaxInPreKeysServerNotificationMixin").parseServerNotificationMixin(a);if(!a.success)return a;b=d("WASmaxInPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup").parseLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value,countValue:f.value},a.value,{countLIDIdentityOrPNIdentityOrFBIDIdentityOrDeprecatedPNIdentityTypeMixinGroup:b.value}))}g.parseNotificationLowCountRequest=a}),98);
__d("WASmaxOutPreKeysNotificationLowCountResponseAck",["WASmaxJsx","WASmaxOutPreKeysNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutPreKeysNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeNotificationLowCountResponseAck=a}),98);
__d("WASmaxPreKeysNotificationLowCountRPC",["WASmaxInPreKeysNotificationLowCountRequest","WASmaxOutPreKeysNotificationLowCountResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysNotificationLowCountRequest").parseNotificationLowCountRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("NotificationLowCount",{Request:b}));return{parsedRequest:b.value,makeNotificationLowCountResponseAck:function(){return d("WASmaxOutPreKeysNotificationLowCountResponseAck").makeNotificationLowCountResponseAck(a)}}}g.receiveNotificationLowCountRPC=a}),98);
__d("WAHandleEncryptNotification",["Promise","WAErr","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WASmaxDecisionTreeUtils","WASmaxPreKeysNotificationContactIDChangedRPC","WASmaxPreKeysNotificationDigestRPC","WASmaxPreKeysNotificationLowCountRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleEncryptNotification type=",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseEncryptNotification notification without children"]);i=function(){return a};return a}function a(a){var b=d("WASmaxDecisionTreeUtils").firstChild(a);if(b.success===!1){d("WALogger").ERROR(i());throw c("WAErr")("parseEncryptNotification notification without children")}b=b.value.tag;var e;switch(b){case"count":e=d("WASmaxPreKeysNotificationLowCountRPC").receiveNotificationLowCountRPC(a).makeNotificationLowCountResponseAck;break;case"digest":e=d("WASmaxPreKeysNotificationDigestRPC").receiveNotificationDigestRPC(a).makeNotificationDigestResponseAck;break;case"identity":e=d("WASmaxPreKeysNotificationContactIDChangedRPC").receiveNotificationContactIDChangedRPC(a).makeNotificationContactIDChangedResponseAck;break;default:throw c("WAErr")("parseEncryptNotification unknown tag: "+b)}return{notification:{encryptType:b},ack:e}}function e(a){var c=a.ack,e=a.notification.encryptType;d("WALogger").LOG(h(),e);function f(){return b("Promise").resolve([c()])}function g(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.t0=e;a.next=a.t0==="count"?3:a.t0==="digest"?6:9;break;case 3:a.next=5;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})));case 5:return a.abrupt("break",9);case 6:a.next=8;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().fireAndForgetNonPersisted(d("WAJobDefinitions").jobSerializers.requestPreKeyDigest({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})));case 8:return a.abrupt("break",9);case 9:return a.abrupt("return",{persist:function(){return b("Promise").resolve({followUp:function(){return f()}})}});case 10:case"end":return a.stop()}},null,this)}return{process:g}}g.parseEncryptNotification=a;g.handleEncryptNotification=e}),98);
__d("WAMsgUtils",["WAJids","WAResultOrErrorUtils"],(function(a,b,c,d,e,f,g){var h="Facebook User";function a(a){return a==null||a===""}function b(a){return a==null||a===""?h:a}function c(a){return a!=null?d("WAJids").userIdFromJid(a):h}function i(a){return a.success?a.value.nameForSearch:void 0}function e(a,b,c){c===void 0&&(c=2);var e=b.slice(0,c);return a.bulkGet(e).then(function(a){return[d("WAResultOrErrorUtils").unpackValues(a).map(function(a){return a.nameForSearch}),e.reduce(function(b,c,d){return i(a[d])==null?[].concat(b,[c]):b},[])]})}g.UNKNOWN_USER=h;g.isUnknownName=a;g.maybeUnknownParticipantName=b;g.createAdminMsgContactId=c;g.getMaybeContactName=i;g.getParticipantsAndUnknownNameJids=e}),98);
__d("WACreateParticipantAdminMsg",["WAGlobals","WAMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("WAMsgUtils").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("WAMsgUtils").createAdminMsgContactId(a):d("WAMsgUtils").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("WAMsgUtils").maybeUnknownParticipantName(c),d("WAMsgUtils").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("WARemoveParticipantAdminMsg",["WAGlobals","WAMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("WAMsgUtils").createAdminMsgContactId):e;var f=e[0];e=e[1];var g=c==null?d("WAMsgUtils").createAdminMsgContactId(a):d("WAMsgUtils").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("WAMsgUtils").maybeUnknownParticipantName(c),d("WAMsgUtils").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,g,d("WAMsgUtils").maybeUnknownParticipantName(f),d("WAMsgUtils").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("WAAdminMsgHelpers",["WAAckLevel","WACreateParticipantAdminMsg","WAGlobals","WAJids","WARemoveParticipantAdminMsg","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a,b,c){return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:d("WACreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function b(a,b,c){return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:d("WARemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function c(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:e,id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function e(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e=b===f?{adminType:"currentUserSelfDemoted",adminMsgContent:[]}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var g=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[g],adminType:"participantDemotedYou"}:{adminMsgContent:[g,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:e,id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}function f(a,b,c){var e=[],f=b.subject.content;if(f==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",e.push(f)):c==null?(b="unkonwnUserNamedGroup",e.push(f)):(b="participantNamedGroup",e.push(c,f));return{type:"Admin",ack:d("WAAckLevel").ACK.SENT,msgContent:{adminType:b,adminMsgContent:e},id:{chat:a,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("WAGlobals").getDependencies().generateExternalId()},ts:d("WATimeUtils").unixTime()}}g.UNKNOWN_USER=h;g.createParticipantAddAdminMessage=a;g.createParticipantRemoveAdminMsg=b;g.createParticipantPromoteAdminMsg=c;g.createParticipantDemoteAdminMsg=e;g.createGroupNameChangeAdminMsg=f}),98);
__d("WAAddGroupParticipantsApi",["WAAdminMsgHelpers","WAGlobals","WAMsgUtils","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("WAGlobals").runInTransaction({ContactsStore:!0,MessagesStore:!0,ParticipantsStore:!0,GroupInfoStore:!0,PersonalSenderKeySessionsMetadataStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(a,c,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:j=a.ContactsStore,k=a.MessagesStore,l=a.ParticipantsStore,m=a.GroupInfoStore;v.next=3;return b("regeneratorRuntime").awrap(m.get(e));case 3:n=v.sent;if(n.success){v.next=6;break}return v.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 6:i=n.value;if(!(c!=null&&c.previous!=null&&i.participantVersion!==c.previous)){v.next=9;break}return v.abrupt("return",d("WAResultOrError").makeError("mismatch"));case 9:o=g.map(function(a){return{chatJid:e,type:a.type,user:a.user,addressable:a.addressable}});v.next=12;return b("regeneratorRuntime").awrap(l.bulkPut(o));case 12:if(!(c!=null)){v.next=28;break}v.next=15;return b("regeneratorRuntime").awrap(d("WAMsgUtils").getParticipantsAndUnknownNameJids(j,o.map(function(a){return a.user})));case 15:p=v.sent;q=p[1];r=f==="@me"?d("WAGlobals").getMyUserJid():f;v.next=20;return b("regeneratorRuntime").awrap(j.get(r));case 20:s=v.sent;t=s.success?s.value.nameForSearch:null;u=d("WAAdminMsgHelpers").createParticipantAddAdminMessage(e,o.map(function(a){return a.user}),f);d("WAMsgUtils").isUnknownName(t)&&q.push(r);v.next=26;return b("regeneratorRuntime").awrap(k.create(u,{unknownNameJids:q}));case 26:v.next=28;return b("regeneratorRuntime").awrap(m.update(e,function(a){return babelHelpers["extends"]({},a,{participantVersion:c.current})},{updateParticipantMedatadata:h}));case 28:return v.abrupt("return",d("WAResultOrError").makeResult());case 29:case"end":return v.stop()}},null,this)};g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("WAChangeGroupParticipantAdminStatusApi",["WAAdminMsgHelpers","WAGlobals","WAMsgUtils","WAResultOrError","WAResultOrErrorUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("WAGlobals").runInTransaction({ContactsStore:!0,MessagesStore:!0,ParticipantsStore:!0,GroupInfoStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(a,c,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:i=a.ContactsStore,j=a.MessagesStore,k=a.ParticipantsStore,l=a.GroupInfoStore;x.next=3;return b("regeneratorRuntime").awrap(l.get(e));case 3:m=x.sent;if(m.success){x.next=6;break}return x.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 6:n=m.value;if(!(c!=null&&c.previous!=null&&n.participantVersion!==c.previous)){x.next=9;break}return x.abrupt("return",d("WAResultOrError").makeError("mismatch"));case 9:o=g.map(function(a){return{addressable:a.addressable,type:h,chatJid:e,user:a.user}});x.next=12;return b("regeneratorRuntime").awrap(k.bulkPut(o));case 12:if(!(c!=null)){x.next=40;break}x.next=15;return b("regeneratorRuntime").awrap(l.update(e,function(a){return babelHelpers["extends"]({},a,{participantVersion:c.current})}));case 15:x.next=17;return b("regeneratorRuntime").awrap(i.bulkGet(o.map(function(a){return a.user})).then(d("WAResultOrErrorUtils").unpackValues));case 17:p=x.sent;q=f==="@me"?d("WAGlobals").getMyUserJid():f;if(!(q!=null)){x.next=25;break}x.next=22;return b("regeneratorRuntime").awrap(i.get(q));case 22:x.t0=x.sent;x.next=26;break;case 25:x.t0=null;case 26:r=x.t0,s=r&&r.success===!0?r.value.nameForSearch:null,u=0;case 29:if(!(u<o.length)){x.next=40;break}v=p[u]!=null?p[u].nameForSearch:null;h==="admin"?t=d("WAAdminMsgHelpers").createParticipantPromoteAdminMsg(e,o[u].user,f):t=d("WAAdminMsgHelpers").createParticipantDemoteAdminMsg(e,o[u].user,f);w=[];d("WAMsgUtils").isUnknownName(s)&&w.push(q);d("WAMsgUtils").isUnknownName(v)&&w.push(o[u].user);x.next=37;return b("regeneratorRuntime").awrap(j.create(t,{unknownNameJids:w}));case 37:u++;x.next=29;break;case 40:return x.abrupt("return",d("WAResultOrError").makeResult());case 41:case"end":return x.stop()}},null,this)};g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("WAGroupParserUtils",["WADualSendMsgUtils","WAErr","WAGroupInviteUtils","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["received unknown participant error code: ",""]);h=function(){return a};return a}var i={superadmin:"superadmin",admin:"admin",participant:"participant",nonparticipant:"nonparticipant"};function j(a){if(!a.hasAttr("error"))throw c("WAErr")("Expected participant node to have error attr");var b=a.attrInt("error"),e=a.attrUserJid("jid");switch(b){case 401:return{errorCode:b,text:"not-authorized",user:e};case 403:a=a.child("add_request");return{errorCode:b,text:"request-code",code:d("WAGroupInviteUtils").toInviteCode(a.attrString("code")),expiration:a.attrTime("expiration"),user:e};case 404:return{errorCode:b,text:"not-found",user:e};case 406:return{errorCode:b,text:"enterprise-not-allowed",user:e};case 408:return{errorCode:b,text:"temporarily-blocked",user:e};case 409:return{errorCode:b,text:"conflict",user:e};case 500:return{errorCode:b,text:"resource-constraint",user:e};default:d("WALogger").ERROR(h(),b);return{errorCode:-1,text:"unknown",user:e}}}function k(a,b){a.assertTag("participant");var c="participant";switch(b){case"add":case"demote":c="participant";break;case"promote":c="admin";break;case"remove":c="nonparticipant";break}b=a.attrUserJid("jid");if(a.hasAttr("error")){var e=j(a);return d("WAResultOrError").makeError(e)}else{e=a.attrEnumOrDefault("type",i,c);c=a.maybeAttrString("addressable")!=="false";return d("WAResultOrError").makeResult({user:b,type:e,addressable:c})}}function a(a){a.assertTag("group");var b,c=a.attrString("id");if(c.includes("@"))b=a.attrGroupJid("id");else{c=a.maybeChild("shadow")?d("WADualSendMsgUtils").prependDualSendPrefix(c):c;b=d("WAJids").toGroupJid(c)}return{jid:b,creator:a.maybeAttrUserJid("creator")||void 0,creationTs:a.attrTime("creation"),subject:{content:a.maybeAttrString("subject")||void 0,user:a.maybeAttrUserJid("s_o")||void 0,ts:a.hasAttr("s_t")?a.attrTime("s_t"):void 0},description:l(a)||void 0,participantVersion:a.maybeAttrString("p_v_id")||void 0,participants:a.mapChildrenWithTag("participant",function(a){return k(a)})}}function l(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent())return{id:a.attrString("id"),ts:a.attrTime("t"),content:b.contentString(),user:b.maybeAttrUserJid("participant")||void 0}}}return null}g.PARTICIPANT_TYPES=i;g.parseProtocolGroupParticipantNode=k;g.parseGroupNode=a}),98);
__d("WAQueryGroup",["WAComms","WAGroupParserUtils","WAPREList","WAPREMetrics","WAResultOrError","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAWapParser").WapParser)("queryAllGroupsResponse",function(a){a.assertTag("iq");return{groups:a.child("groups").mapChildren(d("WAGroupParserUtils").parseGroupNode)}});function a(){var a,c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUPS);c=d("WAWap").wap("iq",{to:d("WAWap").G_US,type:"get",xmlns:"w:g2",id:d("WAWap").generateId()},d("WAWap").wap("participating",null,d("WAWap").wap("participants",null),d("WAWap").wap("description",null)));f.next=4;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(c,h));case 4:e=f.sent;if(e.success){f.next=8;break}a.endFail("query_groups_fail");return f.abrupt("return",d("WAResultOrError").makeError(e));case 8:a.endSuccess();return f.abrupt("return",d("WAResultOrError").makeResult(e.result));case 10:case"end":return f.stop()}},null,this)}var i=new(d("WAWapParser").WapParser)("queryAllGroupsResponse",function(a){a.assertTag("iq");return{group:d("WAGroupParserUtils").parseGroupNode(a.child("group"))}});function c(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP);f=d("WAWap").wap("iq",{to:d("WAWap").GROUP_JID(a),type:"get",xmlns:"w:g2",id:d("WAWap").generateId()},d("WAWap").wap("query",{request:c!=null?d("WAWap").CUSTOM_STRING(c):d("WAWap").DROP_ATTR}));h.next=4;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(f,i));case 4:g=h.sent;if(g.success){h.next=8;break}e.endFail("query_group_fail");return h.abrupt("return",d("WAResultOrError").makeError(g));case 8:e.endSuccess();return h.abrupt("return",d("WAResultOrError").makeResult(g.result.group));case 10:case"end":return h.stop()}},null,this)}g.queryAllGroups=a;g.parseQueryGroupResponse=i;g.queryGroup=c}),98);
__d("WARemoveGroupParticipantsApi",["WAAdminMsgHelpers","WAGlobals","WAMsgUtils","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("WAGlobals").runInTransaction({ContactsStore:!0,MessagesStore:!0,ParticipantsStore:!0,GroupInfoStore:!0,PersonalSenderKeySessionsMetadataStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"removeGroupParticipants")};var h=function(a,c,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:j=a.ContactsStore,k=a.MessagesStore,l=a.ParticipantsStore,m=a.GroupInfoStore,n=a.PersonalSenderKeySessionsMetadataStore;y.next=3;return b("regeneratorRuntime").awrap(m.get(e));case 3:o=y.sent;if(o.success){y.next=6;break}return y.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 6:i=o.value;if(!(c!=null&&c.previous!=null&&i.participantVersion!==c.previous)){y.next=9;break}return y.abrupt("return",d("WAResultOrError").makeError("mismatch"));case 9:p=g.map(function(a){return a.user});q=p.map(function(a){return{groupJid:e,userJid:a}});y.next=13;return b("regeneratorRuntime").awrap(l.bulkDelete(q,{remover:f}));case 13:if(!(c!=null)){y.next=29;break}y.next=16;return b("regeneratorRuntime").awrap(d("WAMsgUtils").getParticipantsAndUnknownNameJids(j,p));case 16:r=y.sent;s=r[1];t=f==="@me"?d("WAGlobals").getMyUserJid():f;y.next=21;return b("regeneratorRuntime").awrap(j.get(t));case 21:u=y.sent;v=u.success?u.value.nameForSearch:null;w=d("WAAdminMsgHelpers").createParticipantRemoveAdminMsg(e,p,f);d("WAMsgUtils").isUnknownName(v)&&s.push(f);y.next=27;return b("regeneratorRuntime").awrap(k.create(w,{unknownNameJids:s}));case 27:y.next=29;return b("regeneratorRuntime").awrap(m.update(e,function(a){return babelHelpers["extends"]({},a,{participantVersion:c.current})},{updateParticipantMedatadata:h}));case 29:y.next=31;return b("regeneratorRuntime").awrap(n.get(e));case 31:x=y.sent;if(!(x==null)){y.next=34;break}return y.abrupt("return",d("WAResultOrError").makeResult());case 34:y.next=36;return b("regeneratorRuntime").awrap(n.bulkPerformSmartSenderKeyRotationForParticipantRemoval(e,g));case 36:return y.abrupt("return",d("WAResultOrError").makeResult());case 37:case"end":return y.stop()}},null,this)};g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("WASyncParticipantsApi",["WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=a.ParticipantsStore;n.next=3;return b("regeneratorRuntime").awrap(f.bulkGetInGroup(c));case 3:g=n.sent;if(!(g.success!==!0)){n.next=6;break}return n.abrupt("return",d("WAResultOrError").makeError("missing_participants"));case 6:if(!(e.length===0&&g.value.length===0)){n.next=8;break}return n.abrupt("return",d("WAResultOrError").makeResult({removedJids:[],addedJids:[],typeUpdateJids:[]}));case 8:h=new Map();g.value.forEach(function(a){h.set(a.user,a)});i=new Set(e.map(function(a){return a.user}));j=[];k=[];l=[];m=[];h.forEach(function(a,b){i.has(b)||(a.type!=="invitedParticipant"?j.push({userJid:b,groupJid:c}):(m.push({type:a.type,userJid:a.user}),l.push(babelHelpers["extends"]({},a))))});e.forEach(function(a){var b=h.get(a.user);b==null?(k.push(a),a.type==="admin"&&m.push({type:a.type,userJid:a.user})):(b.type!==a.type&&m.push({type:a.type,userJid:a.user}),l.push(babelHelpers["extends"]({},b,a)))});n.next=19;return b("regeneratorRuntime").awrap(f.bulkPut(k));case 19:n.next=21;return b("regeneratorRuntime").awrap(f.bulkPut(l));case 21:n.next=23;return b("regeneratorRuntime").awrap(f.bulkDelete(j));case 23:return n.abrupt("return",d("WAResultOrError").makeResult({removedJids:j.map(function(a){a=a.userJid;return a}),addedJids:k.map(function(a){return a.user}),typeUpdateJids:m}));case 24:case"end":return n.stop()}},null,this)};g.syncParticipantsTransactor=a}),98);
__d("WAResetGroupParticipantInfoApi",["Promise","WAAdminMsgHelpers","WAGlobals","WALogger","WAResultOrError","WASyncParticipantsApi","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received an error when sync-ing participants"]);h=function(){return a};return a}a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("WAGlobals").runInTransaction({ParticipantsStore:!0,GroupInfoStore:!0,PersonalSenderKeySessionsMetadataStore:!0,MessagesStore:!0,ContactsStore:!0},function(a){return i.apply(void 0,[a].concat(b))},"resetGroupParticipantInfo")};var i=function(a,c,e,f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:g=a.ParticipantsStore,i=a.GroupInfoStore,j=a.MessagesStore,k=a.PersonalSenderKeySessionsMetadataStore;l=e.map(function(a){return{user:a.user,type:a.type,addressable:a.addressable,chatJid:c}});v.next=4;return b("regeneratorRuntime").awrap(d("WASyncParticipantsApi").syncParticipantsTransactor({ParticipantsStore:g},c,l));case 4:m=v.sent;if(!(f!=null)){v.next=11;break}v.next=8;return b("regeneratorRuntime").awrap(i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:f})}));case 8:n=v.sent;if(n.success){v.next=11;break}return v.abrupt("return",n);case 11:if(!(m.success!==!0)){v.next=14;break}d("WALogger").ERROR(h());return v.abrupt("return",m);case 14:o=m.value;p=[];if(!(o.removedJids.length>0)){v.next=25;break}v.next=19;return b("regeneratorRuntime").awrap(k.get(c));case 19:q=v.sent;if(!(q!=null)){v.next=23;break}v.next=23;return b("regeneratorRuntime").awrap(k.update(babelHelpers["extends"]({},q,{rotateSenderKey:!0})));case 23:r=d("WAAdminMsgHelpers").createParticipantRemoveAdminMsg(c,o.removedJids,null),p.push(j.create(r));case 25:o.addedJids.length>0&&(s=d("WAAdminMsgHelpers").createParticipantAddAdminMessage(c,o.addedJids,null),p.push(j.create(s)));if(o.typeUpdateJids.length>0)for(t=0;t<o.typeUpdateJids.length;t++)u=o.typeUpdateJids[t].type==="admin"?d("WAAdminMsgHelpers").createParticipantPromoteAdminMsg(c,o.typeUpdateJids[t].userJid,null):d("WAAdminMsgHelpers").createParticipantDemoteAdminMsg(c,o.typeUpdateJids[t].userJid,null),p.push(j.create(u));return v.abrupt("return",b("Promise").all(p).then(function(){return d("WAResultOrError").makeResult()}));case 28:case"end":return v.stop()}},null,this)};g.resetGroupParticipantInfo=a;g.resetGroupParticipantInfoTransactor=i}),98);
__d("WASmaxInGroupsServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInGroupsCommonNotificationMixin",["WAResultOrError","WASmaxInGroupsServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","w:gp2");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"notify");if(!e.success)return e;a=d("WASmaxInGroupsServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:b.value,type:c.value,notify:e.value},a.value))}g.parseCommonNotificationMixin=a}),98);
__d("WASmaxInGroupsEnums",[],(function(a,b,c,d,e,f){a={403:"403",404:"404",406:"406",419:"419"};b={404:"404",406:"406"};c={404:"404",419:"419"};d={406:"406",500:"500"};e={accept:"accept",auto_add:"auto_add",default_sub_group_admin_add:"default_sub_group_admin_add",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join"};var g={accept:"accept",default_sub_group_promote:"default_sub_group_promote",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join"},h={admin:"admin",superadmin:"superadmin"},i={delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent"},j={delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent",unlink_group:"unlink_group"},k={e2ee_migration:"e2ee_migration",regular:"regular",rtc:"rtc"},l={image:"image",preview:"preview"},m={invite_link:"invite_link",linked_group_join:"linked_group_join"},n={parent_group:"parent_group",sibling_group:"sibling_group",sub_group:"sub_group"};f.ENUM_403_404_406_419=a;f.ENUM_404_406=b;f.ENUM_404_419=c;f.ENUM_406_500=d;f.ENUM_ACCEPT_AUTOADD_DEFAULTSUBGROUPADMINADD_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN=e;f.ENUM_ACCEPT_DEFAULTSUBGROUPPROMOTE_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN=g;f.ENUM_ADMIN_SUPERADMIN=h;f.ENUM_DELETEPARENT_INTEGRITYDELETEPARENT=i;f.ENUM_DELETEPARENT_INTEGRITYDELETEPARENT_UNLINKGROUP=j;f.ENUM_E2EEMIGRATION_REGULAR_RTC=k;f.ENUM_IMAGE_PREVIEW=l;f.ENUM_INVITELINK_LINKEDGROUPJOIN=m;f.ENUM_PARENTGROUP_SIBLINGGROUP_SUBGROUP=n}),66);
__d("WASmaxInGroupsParticipantWithJidMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");return!b.success?b:d("WAResultOrError").makeResult({jid:b.value})}g.parseParticipantWithJidMixin=a}),98);
__d("WASmaxInGroupsParticipantWithLidMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"lid");return!b.success?b:d("WAResultOrError").makeResult({lid:b.value})}g.parseParticipantWithLidMixin=a}),98);
__d("WASmaxInGroupsParticipantWithJidAndLidMixin",["WAResultOrError","WASmaxInGroupsParticipantWithJidMixin","WASmaxInGroupsParticipantWithLidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantWithJidMixin").parseParticipantWithJidMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsParticipantWithLidMixin").parseParticipantWithLidMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,a.value))}g.parseParticipantWithJidAndLidMixin=a}),98);
__d("WASmaxInGroupsDisplayNameMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"display_name");return!a.success?a:d("WAResultOrError").makeResult({displayName:a.value})}g.parseDisplayNameMixin=a}),98);
__d("WASmaxInGroupsParticipantWithJidContainingLidAndDisplayNameMixin",["WAResultOrError","WASmaxInGroupsDisplayNameMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxInGroupsDisplayNameMixin").parseDisplayNameMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({jid:b.value},a.value))}g.parseParticipantWithJidContainingLidAndDisplayNameMixin=a}),98);
__d("WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin",["WAResultOrError","WASmaxInGroupsDisplayNameMixin","WASmaxInGroupsParticipantWithJidAndLidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantWithJidAndLidMixin").parseParticipantWithJidAndLidMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsDisplayNameMixin").parseDisplayNameMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,a.value))}g.parseParticipantWithJidLidAndDisplayNameMixin=a}),98);
__d("WASmaxInGroupsParticipantMixins",["WAResultOrError","WASmaxInGroupsParticipantWithJidAndLidMixin","WASmaxInGroupsParticipantWithJidContainingLidAndDisplayNameMixin","WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin","WASmaxInGroupsParticipantWithJidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin").parseParticipantWithJidLidAndDisplayNameMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidLidAndDisplayName",value:b.value});var c=d("WASmaxInGroupsParticipantWithJidContainingLidAndDisplayNameMixin").parseParticipantWithJidContainingLidAndDisplayNameMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidContainingLidAndDisplayName",value:c.value});var e=d("WASmaxInGroupsParticipantWithJidAndLidMixin").parseParticipantWithJidAndLidMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidAndLid",value:e.value});var f=d("WASmaxInGroupsParticipantWithJidMixin").parseParticipantWithJidMixin(a);return f.success?d("WAResultOrError").makeResult({name:"ParticipantWithJid",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantWithJidLidAndDisplayName","ParticipantWithJidContainingLidAndDisplayName","ParticipantWithJidAndLid","ParticipantWithJid"],[b,c,e,f])}g.parseParticipantMixins=a}),98);
__d("WASmaxInGroupsParticipantMixin",["WAResultOrError","WASmaxInGroupsParticipantMixins","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantMixins").parseParticipantMixins(a);return!b.success?b:d("WAResultOrError").makeResult({participantMixins:b.value})}g.parseParticipantMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAddressableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"addressable","false");return!b.success?b:d("WAResultOrError").makeResult({addressable:b.value})}g.parseParticipantNotAddressableMixin=a}),98);
__d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"meta");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"shadow","true");return!a.success?a:d("WAResultOrError").makeResult({metaShadow:a.value})}g.parseShadowGroupNotificationIndicatorMixin=a}),98);
__d("WASmaxInGroupsAddNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsEnums","WASmaxInGroupsParticipantMixin","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantMixin").parseParticipantMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{participantNotAddressableMixin:a.success?a.value:null}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"add");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"v_id");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"prev_v_id");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"reason",d("WASmaxInGroupsEnums").ENUM_ACCEPT_DEFAULTSUBGROUPPROMOTE_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN);if(!g.success)return g;var i=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!i.success)return i;a=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"participant",1,1024,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value,addVId:e.value,addPrevVId:f.value,addReason:g.value},i.value,{shadowGroupNotificationIndicatorMixin:a.success?a.value:null,addParticipant:b.value}))}g.parseAddNotificationRequestAddParticipant=h;g.parseAddNotificationRequest=a}),98);
__d("WASmaxOutGroupsNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrGroupJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").GROUP_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutGroupsAddNotificationResponseAck",["WASmaxAttrs","WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b.value)}),a);return b}g.makeAddNotificationResponseAck=a}),98);
__d("WASmaxGroupsAddNotificationRPC",["WASmaxInGroupsAddNotificationRequest","WASmaxOutGroupsAddNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAddNotificationRequest").parseAddNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AddNotification",{Request:b}));return{parsedRequest:b.value,makeAddNotificationResponseAck:function(){return d("WASmaxOutGroupsAddNotificationResponseAck").makeAddNotificationResponseAck(a)}}}g.receiveAddNotificationRPC=a}),98);
__d("WASmaxInGroupsDeleteNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"delete");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!c.success)return c;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"reason",d("WASmaxInGroupsEnums").ENUM_DELETEPARENT_INTEGRITYDELETEPARENT);if(!b.success)return b;a=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value,deleteReason:b.value},a.value))}g.parseDeleteNotificationRequest=a}),98);
__d("WASmaxOutGroupsDeleteNotificationResponseAck",["WASmaxAttrs","WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b.value)}),a);return b}g.makeDeleteNotificationResponseAck=a}),98);
__d("WASmaxGroupsDeleteNotificationRPC",["WASmaxInGroupsDeleteNotificationRequest","WASmaxOutGroupsDeleteNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsDeleteNotificationRequest").parseDeleteNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("DeleteNotification",{Request:b}));return{parsedRequest:b.value,makeDeleteNotificationResponseAck:function(){return d("WASmaxOutGroupsDeleteNotificationResponseAck").makeDeleteNotificationResponseAck(a)}}}g.receiveDeleteNotificationRPC=a}),98);
__d("WASmaxInGroupsParticipantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin","WASmaxInGroupsParticipantWithJidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin").parseParticipantWithJidLidAndDisplayNameMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidLidAndDisplayName",value:b.value});var c=d("WASmaxInGroupsParticipantWithJidMixin").parseParticipantWithJidMixin(a);return c.success?d("WAResultOrError").makeResult({name:"ParticipantWithJid",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantWithJidLidAndDisplayName","ParticipantWithJid"],[b,c])}g.parseParticipantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup=a}),98);
__d("WASmaxInGroupsDemoteNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsParticipantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup").parseParticipantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({participantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"demote");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"participant");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"v_id");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"prev_v_id");if(!f.success)return f;a=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"participant",1,19999,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value,demoteVId:e.value,demotePrevVId:f.value},a.value,{demoteParticipant:b.value}))}g.parseDemoteNotificationRequestDemoteParticipant=h;g.parseDemoteNotificationRequest=a}),98);
__d("WASmaxOutGroupsDemoteNotificationResponseAck",["WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WAWap").USER_JID(b.value)}),a);return b}g.makeDemoteNotificationResponseAck=a}),98);
__d("WASmaxGroupsDemoteNotificationRPC",["WASmaxInGroupsDemoteNotificationRequest","WASmaxOutGroupsDemoteNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsDemoteNotificationRequest").parseDemoteNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("DemoteNotification",{Request:b}));return{parsedRequest:b.value,makeDemoteNotificationResponseAck:function(){return d("WASmaxOutGroupsDemoteNotificationResponseAck").makeDemoteNotificationResponseAck(a)}}}g.receiveDemoteNotificationRPC=a}),98);
__d("WASmaxInGroupsDedupAttrsMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").attrString(a,"key");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"create_ctx",d("WASmaxInGroupsEnums").ENUM_E2EEMIGRATION_REGULAR_RTC);return!a.success?a:d("WAResultOrError").makeResult({key:b.value,createCtx:a.value})}g.parseDedupAttrsMixin=a}),98);
__d("WASmaxInGroupsNamedSubjectMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseNamedSubjectMixin=a}),98);
__d("WASmaxInGroupsUnnamedSubjectMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseUnnamedSubjectMixin=a}),98);
__d("WASmaxInGroupsNamedOrUnnamedSubjectMixinGroup",["WAResultOrError","WASmaxInGroupsNamedSubjectMixin","WASmaxInGroupsUnnamedSubjectMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsNamedSubjectMixin").parseNamedSubjectMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NamedSubject",value:b.value});var c=d("WASmaxInGroupsUnnamedSubjectMixin").parseUnnamedSubjectMixin(a);return c.success?d("WAResultOrError").makeResult({name:"UnnamedSubject",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NamedSubject","UnnamedSubject"],[b,c])}g.parseNamedOrUnnamedSubjectMixinGroup=a}),98);
__d("WASmaxInGroupsGroupInfoAttributesMixin",["WAResultOrError","WASmaxInGroupsNamedOrUnnamedSubjectMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"creator");if(!c.success)return c;var e=d("WASmaxParseUtils").attrIntRange(a,"creation",0,void 0);if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"p_v_id");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"a_v_id");if(!g.success)return g;var h=d("WASmaxParseUtils").attrIntRange(a,"s_t",0,void 0);if(!h.success)return h;var i=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"s_o");if(!i.success)return i;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"open_thread_id");if(!j.success)return j;a=d("WASmaxInGroupsNamedOrUnnamedSubjectMixinGroup").parseNamedOrUnnamedSubjectMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,creator:c.value,creation:e.value,pVId:f.value,aVId:g.value,sT:h.value,sO:i.value,openThreadId:j.value,namedOrUnnamedSubjectMixinGroup:a.value})}g.parseGroupInfoAttributesMixin=a}),98);
__d("WASmaxInGroupsGroupInfoDescriptionMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"description");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"body");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"id");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!e.success)return e;a=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!a.success)return a;b=d("WASmaxParseUtils").contentString(b.value);return!b.success?b:d("WAResultOrError").makeResult({id:c.value,participant:e.value,t:a.value,bodyElementValue:b.value})}g.parseGroupInfoDescriptionMixin=a}),98);
__d("WASmaxInGroupsGroupInfoParticipantAdminMixins",["WAResultOrError","WASmaxInGroupsParticipantWithJidAndLidMixin","WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin","WASmaxInGroupsParticipantWithJidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantWithJidLidAndDisplayNameMixin").parseParticipantWithJidLidAndDisplayNameMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidLidAndDisplayName",value:b.value});var c=d("WASmaxInGroupsParticipantWithJidAndLidMixin").parseParticipantWithJidAndLidMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidAndLid",value:c.value});var e=d("WASmaxInGroupsParticipantWithJidMixin").parseParticipantWithJidMixin(a);return e.success?d("WAResultOrError").makeResult({name:"ParticipantWithJid",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantWithJidLidAndDisplayName","ParticipantWithJidAndLid","ParticipantWithJid"],[b,c,e])}g.parseGroupInfoParticipantAdminMixins=a}),98);
__d("WASmaxInGroupsGroupInfoParticipantAdminMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGroupInfoParticipantAdminMixins","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"type",d("WASmaxInGroupsEnums").ENUM_ADMIN_SUPERADMIN);if(!b.success)return b;a=d("WASmaxInGroupsGroupInfoParticipantAdminMixins").parseGroupInfoParticipantAdminMixins(a);return!a.success?a:d("WAResultOrError").makeResult({type:b.value,groupInfoParticipantAdminMixins:a.value})}g.parseGroupInfoParticipantAdminMixin=a}),98);
__d("WASmaxInGroupsGroupInfoParticipantNonAdminMixin",["WASmaxInGroupsParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantMixin").parseParticipantMixin(a);return!b.success?b:b}g.parseGroupInfoParticipantNonAdminMixin=a}),98);
__d("WASmaxInGroupsGroupInfoParticipantMixins",["WAResultOrError","WASmaxInGroupsGroupInfoParticipantAdminMixin","WASmaxInGroupsGroupInfoParticipantNonAdminMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsGroupInfoParticipantAdminMixin").parseGroupInfoParticipantAdminMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"GroupInfoParticipantAdmin",value:b.value});var c=d("WASmaxInGroupsGroupInfoParticipantNonAdminMixin").parseGroupInfoParticipantNonAdminMixin(a);return c.success?d("WAResultOrError").makeResult({name:"GroupInfoParticipantNonAdmin",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["GroupInfoParticipantAdmin","GroupInfoParticipantNonAdmin"],[b,c])}g.parseGroupInfoParticipantMixins=a}),98);
__d("WASmaxInGroupsGroupInfoParticipantMixin",["WAResultOrError","WASmaxInGroupsGroupInfoParticipantMixins","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsGroupInfoParticipantMixins").parseGroupInfoParticipantMixins(a);return!b.success?b:d("WAResultOrError").makeResult({groupInfoParticipantMixins:b.value})}g.parseGroupInfoParticipantMixin=a}),98);
__d("WASmaxInGroupsAdminAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"admin_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAdminAddModeMixin=a}),98);
__d("WASmaxInGroupsAllMembersAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"all_member_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAllMembersAddModeMixin=a}),98);
__d("WASmaxInGroupsUnknownAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseUnknownAddModeMixin=a}),98);
__d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup",["WAResultOrError","WASmaxInGroupsAdminAddModeMixin","WASmaxInGroupsAllMembersAddModeMixin","WASmaxInGroupsUnknownAddModeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAdminAddModeMixin").parseAdminAddModeMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AdminAddMode",value:b.value});var c=d("WASmaxInGroupsAllMembersAddModeMixin").parseAllMembersAddModeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"AllMembersAddMode",value:c.value});var e=d("WASmaxInGroupsUnknownAddModeMixin").parseUnknownAddModeMixin(a);return e.success?d("WAResultOrError").makeResult({name:"UnknownAddMode",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AdminAddMode","AllMembersAddMode","UnknownAddMode"],[b,c,e])}g.parseAdminOrAllMembersOrUnknownAddModeMixinGroup=a}),98);
__d("WASmaxInGroupsGroupMemberAddModeMixin",["WAResultOrError","WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"member_add_mode");if(!a.success)return a;a=d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup").parseAdminOrAllMembersOrUnknownAddModeMixinGroup(a.value);return!a.success?a:d("WAResultOrError").makeResult({memberAddModeAdminOrAllMembersOrUnknownAddModeMixinGroup:a.value})}g.parseGroupMemberAddModeMixin=a}),98);
__d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group_join");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"state","on");return!b.success?b:d("WAResultOrError").makeResult({state:b.value})}g.parseGroupJoinMembershipApprovalModeEnabledMixin=a}),98);
__d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin",["WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"group_join");if(!b.success)return b;a=d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin").parseGroupJoinMembershipApprovalModeEnabledMixin(b.value);return!a.success?a:a}g.parseMembershipApprovalGroupJoinModeEnabledMixin=a}),98);
__d("WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"default_membership_approval_mode","request_required");return!b.success?b:d("WAResultOrError").makeResult({defaultMembershipApprovalMode:b.value})}g.parseParentGroupDefaultMembershipApprovalModeMixin=a}),98);
__d("WASmaxInGroupsGroupInfoMixin",["WAResultOrError","WASmaxInGroupsGroupInfoAttributesMixin","WASmaxInGroupsGroupInfoDescriptionMixin","WASmaxInGroupsGroupInfoParticipantMixin","WASmaxInGroupsGroupMemberAddModeMixin","WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin","WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsGroupInfoParticipantMixin").parseGroupInfoParticipantMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{participantNotAddressableMixin:a.success?a.value:null}))}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"description");if(!b.success)return b;b=d("WASmaxInGroupsGroupInfoDescriptionMixin").parseGroupInfoDescriptionMixin(a);return d("WAResultOrError").makeResult({groupInfoDescriptionMixin:b.success?b.value:null})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin").parseParentGroupDefaultMembershipApprovalModeMixin(a);return d("WAResultOrError").makeResult({parentGroupDefaultMembershipApprovalModeMixin:b.success?b.value:null})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"ephemeral");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"expiration",0,2147483647);return!b.success?b:d("WAResultOrError").makeResult({expiration:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"growth_locked");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","invite");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"expiration",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({type:b.value,expiration:a.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin").parseMembershipApprovalGroupJoinModeEnabledMixin(a);return d("WAResultOrError").makeResult({membershipApprovalGroupJoinModeEnabledMixin:b.success?b.value:null})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_parent");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"jid");return!b.success?b:d("WAResultOrError").makeResult({jid:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"description",i);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChild(a,"locked");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChild(a,"announcement");if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"parent",j);if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChild(a,"no_frequently_forwarded");if(!g.success)return g;var o=d("WASmaxParseUtils").optionalChild(a,"support");if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"ephemeral",k);if(!p.success)return p;var q=d("WASmaxParseUtils").optionalChild(a,"suspended");if(!q.success)return q;var r=d("WASmaxParseUtils").optionalChildWithTag(a,"growth_locked",l);if(!r.success)return r;var s=d("WASmaxParseUtils").optionalChild(a,"default_sub_group");if(!s.success)return s;var t=d("WASmaxParseUtils").optionalChild(a,"shadow");if(!t.success)return t;var u=d("WASmaxParseUtils").optionalChildWithTag(a,"membership_approval_mode",m);if(!u.success)return u;var v=d("WASmaxParseUtils").optionalChild(a,"incognito");if(!v.success)return v;var w=d("WASmaxParseUtils").optionalChildWithTag(a,"linked_parent",n);if(!w.success)return w;var x=d("WASmaxInGroupsGroupInfoAttributesMixin").parseGroupInfoAttributesMixin(a);if(!x.success)return x;var y=d("WASmaxInGroupsGroupMemberAddModeMixin").parseGroupMemberAddModeMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(a,"participant",0,19999,h);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},x.value,{groupMemberAddModeMixin:y.success?y.value:null,description:b.value,hasLocked:c.value!=null,hasAnnouncement:e.value!=null,parent:f.value,hasNoFrequentlyForwarded:g.value!=null,hasSupport:o.value!=null,ephemeral:p.value,hasSuspended:q.value!=null,growthLocked:r.value,hasDefaultSubGroup:s.value!=null,hasShadow:t.value!=null,membershipApprovalMode:u.value,hasIncognito:v.value!=null,linkedParent:w.value,participant:a.value}))}g.parseGroupInfoParticipant=h;g.parseGroupInfoDescription=i;g.parseGroupInfoParent=j;g.parseGroupInfoEphemeral=k;g.parseGroupInfoGrowthLocked=l;g.parseGroupInfoMembershipApprovalMode=m;g.parseGroupInfoLinkedParent=n;g.parseGroupInfoMixin=a}),98);
__d("WASmaxInGroupsOptionalContextGroupMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrGroupJid,a,"context_group_jid");return!a.success?a:d("WAResultOrError").makeResult({contextGroupJid:a.value})}g.parseOptionalContextGroupMixin=a}),98);
__d("WASmaxInGroupsJoinNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsDedupAttrsMixin","WASmaxInGroupsEnums","WASmaxInGroupsGroupInfoMixin","WASmaxInGroupsOptionalContextGroupMixin","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"create");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"group");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!e.success)return e;var f=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,b.value,"type","new");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"reason",d("WASmaxInGroupsEnums").ENUM_ACCEPT_AUTOADD_DEFAULTSUBGROUPADMINADD_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN);if(!g.success)return g;var h=d("WASmaxParseUtils").attrIntRange(c.value,"size",1,19999);if(!h.success)return h;c=d("WASmaxInGroupsGroupInfoMixin").parseGroupInfoMixin(c.value);if(!c.success)return c;var i=d("WASmaxInGroupsOptionalContextGroupMixin").parseOptionalContextGroupMixin(b.value);if(!i.success)return i;b=d("WASmaxInGroupsDedupAttrsMixin").parseDedupAttrsMixin(b.value);var j=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!j.success)return j;a=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:e.value,createType:f.value,createReason:g.value,createGroupSize:h.value,createGroupGroupInfoMixin:c.value,createOptionalContextGroupMixin:i.value,createDedupAttrsMixin:b.success?b.value:null},j.value,{shadowGroupNotificationIndicatorMixin:a.success?a.value:null}))}g.parseJoinNotificationRequest=a}),98);
__d("WASmaxOutGroupsJoinNotificationResponseAck",["WASmaxAttrs","WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b.value)}),a);return b}g.makeJoinNotificationResponseAck=a}),98);
__d("WASmaxGroupsJoinNotificationRPC",["WASmaxInGroupsJoinNotificationRequest","WASmaxOutGroupsJoinNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsJoinNotificationRequest").parseJoinNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("JoinNotification",{Request:b}));return{parsedRequest:b.value,makeJoinNotificationResponseAck:function(){return d("WASmaxOutGroupsJoinNotificationResponseAck").makeJoinNotificationResponseAck(a)}}}g.receiveJoinNotificationRPC=a}),98);
__d("WASmaxInGroupsParticipantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantWithJidAndLidMixin","WASmaxInGroupsParticipantWithJidMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantWithJidAndLidMixin").parseParticipantWithJidAndLidMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantWithJidAndLid",value:b.value});var c=d("WASmaxInGroupsParticipantWithJidMixin").parseParticipantWithJidMixin(a);return c.success?d("WAResultOrError").makeResult({name:"ParticipantWithJid",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantWithJidAndLid","ParticipantWithJid"],[b,c])}g.parseParticipantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup=a}),98);
__d("WASmaxInGroupsPromoteNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsParticipantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup").parseParticipantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({participantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"promote");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"v_id");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"prev_v_id");if(!f.success)return f;var g=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!g.success)return g;a=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"participant",1,19999,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value,promoteVId:e.value,promotePrevVId:f.value},g.value,{shadowGroupNotificationIndicatorMixin:a.success?a.value:null,promoteParticipant:b.value}))}g.parsePromoteNotificationRequestPromoteParticipant=h;g.parsePromoteNotificationRequest=a}),98);
__d("WASmaxOutGroupsPromoteNotificationResponseAck",["WASmaxAttrs","WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b.value)}),a);return b}g.makePromoteNotificationResponseAck=a}),98);
__d("WASmaxGroupsPromoteNotificationRPC",["WASmaxInGroupsPromoteNotificationRequest","WASmaxOutGroupsPromoteNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsPromoteNotificationRequest").parsePromoteNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PromoteNotification",{Request:b}));return{parsedRequest:b.value,makePromoteNotificationResponseAck:function(){return d("WASmaxOutGroupsPromoteNotificationResponseAck").makePromoteNotificationResponseAck(a)}}}g.receivePromoteNotificationRPC=a}),98);
__d("WASmaxInGroupsRemoveNotificationMemberMixin",["WAResultOrError","WASmaxInGroupsParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsParticipantMixin").parseParticipantMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"remove");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"v_id");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"prev_v_id");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"subject");if(!e.success)return e;var f=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"reason","default_sub_group_demote");if(!f.success)return f;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"participant",1,1024,h);return!a.success?a:d("WAResultOrError").makeResult({vId:b.value,prevVId:c.value,subject:e.value,reason:f.value,participant:a.value})}g.parseRemoveNotificationMemberParticipant=h;g.parseRemoveNotificationMemberMixin=a}),98);
__d("WASmaxInGroupsRemoveNotificationNonMemberMixin",["WAResultOrError","WASmaxInGroupsParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"remove");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"participant");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"subject");if(!a.success)return a;b=d("WASmaxInGroupsParticipantMixin").parseParticipantMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({subject:a.value,participantParticipantMixin:b.value})}g.parseRemoveNotificationNonMemberMixin=a}),98);
__d("WASmaxInGroupsRemoveNotificationOrRemoveNotificationNonMemberMixinGroup",["WAResultOrError","WASmaxInGroupsRemoveNotificationMemberMixin","WASmaxInGroupsRemoveNotificationNonMemberMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsRemoveNotificationMemberMixin").parseRemoveNotificationMemberMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RemoveNotificationMember",value:b.value});var c=d("WASmaxInGroupsRemoveNotificationNonMemberMixin").parseRemoveNotificationNonMemberMixin(a);return c.success?d("WAResultOrError").makeResult({name:"RemoveNotificationNonMember",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Member","NonMember"],[b,c])}g.parseRemoveNotificationOrRemoveNotificationNonMemberMixinGroup=a}),98);
__d("WASmaxInGroupsRemoveNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsRemoveNotificationOrRemoveNotificationNonMemberMixinGroup","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"remove");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant");if(!c.success)return c;var e=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!e.success)return e;a=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);b=d("WASmaxInGroupsRemoveNotificationOrRemoveNotificationNonMemberMixinGroup").parseRemoveNotificationOrRemoveNotificationNonMemberMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value},e.value,{shadowGroupNotificationIndicatorMixin:a.success?a.value:null,removeRemoveNotificationOrRemoveNotificationNonMemberMixinGroup:b.value}))}g.parseRemoveNotificationRequest=a}),98);
__d("WASmaxOutGroupsRemoveNotificationResponseAck",["WASmaxAttrs","WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,b.value)}),a);return b}g.makeRemoveNotificationResponseAck=a}),98);
__d("WASmaxGroupsRemoveNotificationRPC",["WASmaxInGroupsRemoveNotificationRequest","WASmaxOutGroupsRemoveNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsRemoveNotificationRequest").parseRemoveNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RemoveNotification",{Request:b}));return{parsedRequest:b.value,makeRemoveNotificationResponseAck:function(){return d("WASmaxOutGroupsRemoveNotificationResponseAck").makeRemoveNotificationResponseAck(a)}}}g.receiveRemoveNotificationRPC=a}),98);
__d("WASmaxInGroupsSubjectChangeNotificationRequest",["WAResultOrError","WASmaxInGroupsCommonNotificationMixin","WASmaxInGroupsNamedOrUnnamedSubjectMixinGroup","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"subject");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"participant");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,b.value,"s_o");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(b.value,"s_t",0,void 0);if(!f.success)return f;var g=d("WASmaxInGroupsCommonNotificationMixin").parseCommonNotificationMixin(a);if(!g.success)return g;a=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);b=d("WASmaxInGroupsNamedOrUnnamedSubjectMixinGroup").parseNamedOrUnnamedSubjectMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({participant:c.value,subjectSO:e.value,subjectST:f.value},g.value,{shadowGroupNotificationIndicatorMixin:a.success?a.value:null,subjectNamedOrUnnamedSubjectMixinGroup:b.value}))}g.parseSubjectChangeNotificationRequest=a}),98);
__d("WASmaxOutGroupsSubjectChangeNotificationResponseAck",["WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["participant"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",{participant:d("WAWap").USER_JID(b.value)}),a);return b}g.makeSubjectChangeNotificationResponseAck=a}),98);
__d("WASmaxGroupsSubjectChangeNotificationRPC",["WASmaxInGroupsSubjectChangeNotificationRequest","WASmaxOutGroupsSubjectChangeNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsSubjectChangeNotificationRequest").parseSubjectChangeNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SubjectChangeNotification",{Request:b}));return{parsedRequest:b.value,makeSubjectChangeNotificationResponseAck:function(){return d("WASmaxOutGroupsSubjectChangeNotificationResponseAck").makeSubjectChangeNotificationResponseAck(a)}}}g.receiveSubjectChangeNotificationRPC=a}),98);
__d("WASmaxInNotificationFallbackEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={validators:[d("WAJids").validateBroadcastJid,d("WAJids").validateCallJid,d("WAJids").validateDeviceJid,d("WAJids").validateDomainJid,d("WAJids").validateGroupJid,d("WAJids").validateStatusJid,d("WAJids").validateUserJid],typeName:"BroadcastJid|CallJid|DeviceJid|DomainJid|GroupJid|StatusJid|UserJid"};g.BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID=a}),98);
__d("WASmaxInNotificationFallbackGenericNotificationRequest",["WAResultOrError","WASmaxInNotificationFallbackEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrJidEnum,a,"from",d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrJidEnum,a,"participant",d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!e.success)return e;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"type");return!a.success?a:d("WAResultOrError").makeResult({id:b.value,from:c.value,participant:e.value,type:a.value})}g.parseGenericNotificationRequest=a}),98);
__d("WASmaxOutNotificationFallbackGenericNotificationResponseAck",["WASmaxAttrs","WASmaxInNotificationFallbackEnums","WASmaxJsx","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrJidEnum,a,["from"],d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);var e=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrJidEnum,a,["participant"],d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!e.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(e.error);a=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,c.value),participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,e.value),"class":"notification",type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a.value)});return b}g.makeGenericNotificationResponseAck=a}),98);
__d("WASmaxOutNotificationFallbackGenericNotificationResponseUnknownStanza",["WASmaxAttrs","WASmaxInNotificationFallbackEnums","WASmaxJsx","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrJidEnum,a,["from"],d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);var e=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrJidEnum,a,["participant"],d("WASmaxInNotificationFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!e.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(e.error);a=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,c.value),participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,e.value),"class":"notification",type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a.value),error:"487"});return b}g.makeGenericNotificationResponseUnknownStanza=a}),98);
__d("WASmaxNotificationFallbackGenericNotificationRPC",["WASmaxInNotificationFallbackGenericNotificationRequest","WASmaxOutNotificationFallbackGenericNotificationResponseAck","WASmaxOutNotificationFallbackGenericNotificationResponseUnknownStanza","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNotificationFallbackGenericNotificationRequest").parseGenericNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GenericNotification",{Request:b}));return{parsedRequest:b.value,makeGenericNotificationResponseUnknownStanza:function(){return d("WASmaxOutNotificationFallbackGenericNotificationResponseUnknownStanza").makeGenericNotificationResponseUnknownStanza(a)},makeGenericNotificationResponseAck:function(){return d("WASmaxOutNotificationFallbackGenericNotificationResponseAck").makeGenericNotificationResponseAck(a)}}}g.receiveGenericNotificationRPC=a}),98);
__d("WAUpdateGroupSubjectApi",["WAAdminMsgHelpers","WAGlobals","WAJids","WAMsgUtils","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("WAGlobals").runInTransaction({ContactsStore:!0,MessagesStore:!0,ParticipantsStore:!0,GroupInfoStore:!0,PersonalSenderKeySessionsMetadataStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"updateGroupSubject")};var h=function(a,c,e){var f,g,h,i,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:f=a.ContactsStore,g=a.MessagesStore,h=a.GroupInfoStore;r.next=3;return b("regeneratorRuntime").awrap(h.get(c));case 3:i=r.sent;if(i.success){r.next=6;break}return r.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 6:j=i.value;if(!(j.subject.ts!=null&&(e.ts==null||j.subject.ts>e.ts))){r.next=9;break}return r.abrupt("return",d("WAResultOrError").makeResult());case 9:r.next=11;return b("regeneratorRuntime").awrap(h.update(c,function(a){return babelHelpers["extends"]({},a,{subject:e})}));case 11:r.next=13;return b("regeneratorRuntime").awrap(h.get(j.jid));case 13:k=r.sent;if(k.success){r.next=16;break}return r.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 16:l=k.value;m=l.subject.user;if(!(m!=null)){r.next=24;break}r.next=21;return b("regeneratorRuntime").awrap(f.get(m));case 21:r.t0=r.sent;r.next=25;break;case 24:r.t0=null;case 25:n=r.t0;o=n!=null&&n.success?n.value.nameForSearch:null;p=d("WAAdminMsgHelpers").createGroupNameChangeAdminMsg(c,l,m!=null?d("WAJids").userIdFromJid(m):void 0);q=[];d("WAMsgUtils").isUnknownName(o)&&m!=null&&q.push(m);if(!(p!=null)){r.next=33;break}r.next=33;return b("regeneratorRuntime").awrap(g.create(p,{unknownNameJids:q}));case 33:return r.abrupt("return",d("WAResultOrError").makeResult());case 34:case"end":return r.stop()}},null,this)};g.updateGroupSubject=a;g.updateGroupSubjectTransactor=h}),98);
__d("WAHandleGroupNotifications",["Promise","WAAddGroupParticipantsApi","WAChangeGroupParticipantAdminStatusApi","WADualSendMsgUtils","WAErr","WAGlobals","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAQueryGroup","WARemoveGroupParticipantsApi","WAResetGroupParticipantInfoApi","WAResultOrError","WAScheduleAfterOfflineResume","WASendSenderKeyDistributionMsg","WASmaxDecisionTreeUtils","WASmaxGroupsAddNotificationRPC","WASmaxGroupsDeleteNotificationRPC","WASmaxGroupsDemoteNotificationRPC","WASmaxGroupsJoinNotificationRPC","WASmaxGroupsPromoteNotificationRPC","WASmaxGroupsRemoveNotificationRPC","WASmaxGroupsSubjectChangeNotificationRPC","WASmaxInGroupsShadowGroupNotificationIndicatorMixin","WASmaxNotificationFallbackGenericNotificationRPC","WAStanzaQueuePersistApi","WATimeUtils","WAUpdateGroupSubjectApi","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to recover missing group info"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[doGroupRecovery] Cannot get a group, as per ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get group info"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received a participant with an error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ParticipantRecovery] Cannot get a group, as per ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseGroupNotification: Unknown notification ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseGroupNotification: Received group-dual-send notification"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseGroupNotification: Received node with no children"]);o=function(){return a};return a}function a(a){var b=d("WASmaxDecisionTreeUtils").firstChild(a);if(!b.success){d("WALogger").ERROR(o());var c=d("WASmaxNotificationFallbackGenericNotificationRPC").receiveGenericNotificationRPC(a);c=c.makeGenericNotificationResponseUnknownStanza;return{action:{type:"unknown"},makeAck:c}}c=d("WASmaxInGroupsShadowGroupNotificationIndicatorMixin").parseShadowGroupNotificationIndicatorMixin(a);if(c.success){d("WALogger").WARN(n());c=d("WASmaxNotificationFallbackGenericNotificationRPC").receiveGenericNotificationRPC(a);c=c.makeGenericNotificationResponseUnknownStanza;return{action:{type:"unknown"},makeAck:c}}c=b.value.tag;switch(c){case"create":return p(a);case"add":return r(a);case"remove":return s(a);case"delete":b=d("WASmaxGroupsDeleteNotificationRPC").receiveDeleteNotificationRPC(a);var e=b.parsedRequest,f=e.participant;e=e.from;b=b.makeDeleteNotificationResponseAck;return{action:{type:"delete",participant:f,groupJid:e},makeAck:b};case"promote":return t(a);case"demote":return u(a);case"subject":return v(a);default:d("WALogger").ERROR(m(),c)}f=d("WASmaxNotificationFallbackGenericNotificationRPC").receiveGenericNotificationRPC(a);e=f.makeGenericNotificationResponseUnknownStanza;return{action:{type:"unknown"},makeAck:e}}function p(a){a=d("WASmaxGroupsJoinNotificationRPC").receiveJoinNotificationRPC(a);var b=a.parsedRequest,c=b.from,e=b.createGroupGroupInfoMixin,f=e.hasShadow,g=e.id,h=e.creator,i=e.creation,j=e.participant,k=e.namedOrUnnamedSubjectMixinGroup,l=e.sO,m=e.sT,n=e.pVId;e=e.description;var o=b.createDedupAttrsMixin,p=b.createType,q=b.participant;b=b.t;a=a.makeJoinNotificationResponseAck;e=e==null?void 0:e.groupInfoDescriptionMixin;j={jid:d("WAJids").toGroupJid(g),creator:(g=h)!=null?g:void 0,creationTs:d("WATimeUtils").castToUnixTime(i),participants:j.map(function(a){var b=a.groupInfoParticipantMixins;a=a.participantNotAddressableMixin;return d("WAResultOrError").makeResult({addressable:(a==null?void 0:a.addressable)!=="false",type:b.name==="GroupInfoParticipantAdmin"?b.value.type:"participant",user:b.name==="GroupInfoParticipantAdmin"?b.value.groupInfoParticipantAdminMixins.value.jid:b.value.participantMixins.value.jid})}),subject:{content:k.value.subject,user:(h=l)!=null?h:void 0,ts:d("WATimeUtils").castToUnixTime(m)},description:e==null?void 0:{id:e.id,content:e.bodyElementValue,user:e.participant,ts:d("WATimeUtils").castToUnixTime(e.t)},participantVersion:(g=n)!=null?g:void 0,inviter:(i=q)!=null?i:void 0};return{action:{type:"join",isDualSend:f,isNew:p==="new",isE2EEMigration:(o==null?void 0:o.createCtx)==="e2ee_migration",key:o==null?void 0:o.key,group:j,serverTs:d("WATimeUtils").castToUnixTime(b),groupJid:c},makeAck:a}}function q(a){if(a===null)return;return a==="invite"?"invite":"accept"}function r(a){a=d("WASmaxGroupsAddNotificationRPC").receiveAddNotificationRPC(a);var b=a.parsedRequest,c=b.from,e=b.participant,f=b.addVId,g=b.addPrevVId,h=b.addReason;b=b.addParticipant;a=a.makeAddNotificationResponseAck;return{action:{type:"add",versionId:f,previousVersionId:g,reason:q(h),participants:b.map(function(a){return{user:a.participantMixins.value.jid,type:"participant",addressable:((a=a.participantNotAddressableMixin)==null?void 0:a.addressable)!=="false"}}),groupJid:c,participant:e},makeAck:a}}function s(a){a=d("WASmaxGroupsRemoveNotificationRPC").receiveRemoveNotificationRPC(a);var b=a.parsedRequest,c=b.from,e=b.participant;b=b.removeRemoveNotificationOrRemoveNotificationNonMemberMixinGroup;a=a.makeRemoveNotificationResponseAck;var f=b.name==="RemoveNotificationMember"?b.value.participant.map(function(a){return{user:a.participantMixins.value.jid,type:"nonparticipant",addressable:!0}}):[{user:b.value.participantParticipantMixin.participantMixins.value.jid,type:"nonparticipant",addressable:!0}];return{action:{type:"remove",versionId:b.value.vId,previousVersionId:b.value.prevVId,participants:f,groupJid:c,participant:e},makeAck:a}}function t(a){a=d("WASmaxGroupsPromoteNotificationRPC").receivePromoteNotificationRPC(a);var b=a.parsedRequest,c=b.promoteVId,e=b.promotePrevVId,f=b.promoteParticipant,g=b.from;b=b.participant;a=a.makePromoteNotificationResponseAck;return{action:{type:"promote",versionId:c,previousVersionId:e,participants:f.map(function(a){a=a.participantWithJidParticipantWithJidAndLidOrParticipantWithJidMixinGroup.value.jid;return{user:a,type:"admin",addressable:!0}}),groupJid:g,participant:b},makeAck:a}}function u(a){a=d("WASmaxGroupsDemoteNotificationRPC").receiveDemoteNotificationRPC(a);var b=a.parsedRequest,c=b.demoteVId,e=b.demotePrevVId,f=b.demoteParticipant,g=b.from;b=b.participant;a=a.makeDemoteNotificationResponseAck;return{action:{type:"demote",versionId:c,previousVersionId:e,participants:f.map(function(a){a=a.participantWithJidParticipantWithJidLidAndDisplayNameOrParticipantWithJidMixinGroup.value.jid;return{user:a,type:"participant",addressable:!0}}),groupJid:g,participant:b},makeAck:a}}function v(a){a=d("WASmaxGroupsSubjectChangeNotificationRPC").receiveSubjectChangeNotificationRPC(a);var b=a.parsedRequest,c=b.subjectNamedOrUnnamedSubjectMixinGroup,e=b.subjectST,f=b.from;b=b.participant;a=a.makeSubjectChangeNotificationResponseAck;return{action:{type:"subject",subject:c.name==="NamedSubject"?c.value.subject:null,ts:d("WATimeUtils").castToUnixTime(e),groupJid:f,participant:b},makeAck:a}}function w(a){var e=a.notification;switch(e.type){case"join":return A(e).then(function(){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:e.group.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(e.group.jid,e.group.participants.length)}});return d("WAResultOrError").makeResult()});case"add":return B(e);case"remove":return C(e);case"promote":return E(e);case"demote":return D(e);case"delete":a=e.participant;var f=e.groupJid;if(a==null)throw c("WAErr")("Group delete notification without deleter JID: "+f);return d("WAGlobals").getDbImpls().deleteGroups([{group:f,deleter:a}]).then(function(){return d("WAResultOrError").makeResult()});case"subject":return F(e).then(function(){return d("WAResultOrError").makeResult()});default:e.type;return b("Promise").resolve(d("WAResultOrError").makeResult())}}function e(a){var c=a.notification;function e(){a.makeAck;var e=babelHelpers.objectWithoutPropertiesLoose(a,["makeAck"]);return d("WAGlobals").getConfig().enableRawStanzaQueueStore()?d("WAStanzaQueuePersistApi").persistNotificationTransaction([e]).then(function(){return{followUp:function(){return b("Promise").resolve([a.makeAck()])}}}):w(e).then(function(d){return{followUp:function(){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(d.success){e.next=3;break}e.next=3;return b("regeneratorRuntime").awrap(x(d,c));case 3:return e.abrupt("return",b("Promise").resolve([a.makeAck()]));case 4:case"end":return e.stop()}},null,this)}}})}return{process:function(){return b("Promise").resolve({persist:e})}}}function x(a,c){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:if(!(c.type==="add"||c.type==="remove"||c.type==="promote"||c.type==="demote")){d.next=8;break}if(!(a.error==="mismatch")){d.next=6;break}d.next=4;return b("regeneratorRuntime").awrap(y(c.groupJid));case 4:d.next=8;break;case 6:d.next=8;return b("regeneratorRuntime").awrap(z(c.groupJid));case 8:case"end":return d.stop()}},null,this)}function y(a){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.prev=0;i.next=3;return b("regeneratorRuntime").awrap(d("WAQueryGroup").queryGroup(a,"participant_change_recovery"));case 3:e=i.sent;if(!(e.success===!1)){i.next=7;break}d("WALogger").ERROR(l(),e.error);throw c("WAErr")("[ParticipantRecovery] Cannot get a group, as per "+JSON.stringify(e.error));case 7:f=e.value;g=f.participants.map(function(a){if(a.error){d("WALogger").ERROR(k());return null}return a.value}).filter(Boolean);i.next=11;return b("regeneratorRuntime").awrap(d("WAResetGroupParticipantInfoApi").resetGroupParticipantInfo(a,g,f.participantVersion));case 11:h=i.sent;if(!(!h.success&&h.error==="missing")){i.next=15;break}i.next=15;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.queryGroups(a)));case 15:i.next=20;break;case 17:i.prev=17,i.t0=i["catch"](0),d("WALogger").DEV(j()).devConsole(i.t0);case 20:case"end":return i.stop()}},null,this,[[0,17]])}function z(a){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(d("WAQueryGroup").queryGroup(a,"interactive"));case 3:e=g.sent;if(!(e.success===!1)){g.next=7;break}d("WALogger").ERROR(i(),e.error);throw c("WAErr")("[doGroupRecovery] Cannot get a group, as per "+JSON.stringify(e.error));case 7:f=e.value;g.next=10;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().createGroup(f,"queried",d("WATimeUtils").unixTime(),null,null,d("WADualSendMsgUtils").isDualSendJid(f.jid)?{platform:"msgr",isDualSend:!0}:null));case 10:d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:f.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(f.jid,f.participants.length)}});g.next=16;break;case 13:g.prev=13,g.t0=g["catch"](0),d("WALogger").DEV(h()).devConsole(g.t0);case 16:case"end":return g.stop()}},null,this,[[0,13]])}function A(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:if(!a.isE2EEMigration){j.next=2;break}return j.abrupt("return");case 2:c=a.group,e=a.isNew,f=a.serverTs,g=a.key,h=a.isDualSend;j.next=5;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().createGroup(c,e?"new":"added",f,null,g,h===!0||g!=null?{platform:"msgr",isDualSend:h,deduplicationKey:g}:null));case 5:i=a.group.participants.map(function(a){if(a.success)return a.value.user;else return a.error.user});j.next=8;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilCompleted(d("WAJobDefinitions").jobSerializers.getDevices(new Set(i),"added-to-group",!1,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 8:case"end":return j.stop()}},null,this)}function B(a){var b=a.versionId,e=a.previousVersionId,f=a.participants,g=a.reason,h=a.participant;a=a.groupJid;if(h==null)throw c("WAErr")("Group add participant notification without adder JID: "+a);return d("WAAddGroupParticipantsApi").addGroupParticipants({current:b,previous:e},a,h,f,!1,g)}function C(a){var b=a.versionId,e=a.previousVersionId,f=a.participants,g=a.participant;a=a.groupJid;if(g==null)throw c("WAErr")("Group remove participant notification without remover JID: "+a);var h=null;b!=null&&(h={current:b,previous:e});return d("WARemoveGroupParticipantsApi").removeGroupParticipants(h,a,g,f,!1)}function D(a){var b=a.versionId,c=a.previousVersionId,e=a.groupJid,f=a.participant;a=a.participants;return d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:b,previous:c},e,f,a,"participant")}function E(a){var b=a.versionId,c=a.previousVersionId,e=a.groupJid,f=a.participant;a=a.participants;return d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:b,previous:c},e,f,a,"admin")}function F(a){var b=a.groupJid,c=a.subject,e=a.participant;a=a.ts;return d("WAUpdateGroupSubjectApi").updateGroupSubject(b,{content:c,user:e,ts:a}).then(function(a){})}g.parseGroupNotification=a;g.persistGroupNotification=w;g.handleGroupNotification=e;g.groupRecovery=x;g.doParticipantRecovery=y;g.doGroupRecovery=z}),98);
__d("WAMmsRetry.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2,DECRYPTION_ERROR:3};b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);b.internalSpec={stanzaId:[1,d("WAProtoConst").TYPES.STRING],directPath:[2,d("WAProtoConst").TYPES.STRING],result:[3,d("WAProtoConst").TYPES.ENUM,a]};c.internalSpec={stanzaId:[1,d("WAProtoConst").TYPES.STRING]};g.MEDIA_RETRY_NOTIFICATION_RESULT_TYPE=a;g.MediaRetryNotificationSpec=b;g.ServerErrorReceiptSpec=c}),98);
__d("WAMediaRetryCrypto",["WABinary","WACryptoHkdf","WALogger","WAMmsRetry.pb","decodeProtobuf","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encodeMediaRetryNotification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encodeServerErrorReceipt"]);i=function(){return a};return a}function j(a){d("WALogger").DEV(i()).devConsole(a);a=d("encodeProtobuf").encodeProtobuf(d("WAMmsRetry.pb").ServerErrorReceiptSpec,a);return a.readByteArray()}function a(a,b,c){return m(a,b,j({stanzaId:b}),c)}function c(a,b,c,e){return n(a,b,c,e).then(function(a){return d("decodeProtobuf").decodeProtobuf(d("WAMmsRetry.pb").ServerErrorReceiptSpec,a)})}var k={GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2};function l(a){d("WALogger").DEV(h()).devConsole(a);a=d("encodeProtobuf").encodeProtobuf(d("WAMmsRetry.pb").MediaRetryNotificationSpec,a);return a.readByteArray()}function e(a,b,c,d,e){return m(a,b,l({stanzaId:b,directPath:c,result:e}),d)}function f(a,b,c,e){return n(a,b,c,e).then(function(a){return d("decodeProtobuf").decodeProtobuf(d("WAMmsRetry.pb").MediaRetryNotificationSpec,a)})}function m(a,c,d,e){var f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:f=(e==null?void 0:e.slice())||q();k.next=3;return b("regeneratorRuntime").awrap(p(a,c,f));case 3:g=k.sent;h=g.key;i=g.params;k.next=8;return b("regeneratorRuntime").awrap(self.crypto.subtle.encrypt(i,h,d));case 8:j=k.sent;return k.abrupt("return",{ciphertext:j,iv:f});case 10:case"end":return k.stop()}},null,this)}function n(a,c,d,e){var f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(p(a,c,d));case 2:f=i.sent;g=f.key;h=f.params;return i.abrupt("return",self.crypto.subtle.decrypt(h,g,e));case 6:case"end":return i.stop()}},null,this)}var o="WhatsApp Media Retry Notification";function p(a,c,e){var f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),o,32));case 2:f=k.sent;g=new(d("WABinary").Binary)();g.write(c);h=g.readByteArray();i={name:"AES-GCM",iv:e,additionalData:h};k.next=9;return b("regeneratorRuntime").awrap(self.crypto.subtle.importKey("raw",new Uint8Array(f),"AES-GCM",!1,["encrypt","decrypt"]));case 9:j=k.sent;return k.abrupt("return",{key:j,params:i});case 11:case"end":return k.stop()}},null,this)}function q(){var a=new Uint8Array(12);self.crypto.getRandomValues(a);return a}g.encryptServerErrorReceipt=a;g.decryptServerErrorReceipt=c;g.MEDIA_RETRY_NOTIFICATION_RESULT=k;g.encryptMediaRetryNotification=e;g.decryptMediaRetryNotification=f}),98);
__d("WAHandleMediaRetryNotification",["Promise","WAGlobals","WAJids","WAJobDefinitions","WAJobs","WALogger","WAMediaRetryCrypto","WAMediaUtils","WAStanzaQueuePersistApi","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: no directPath in mediaretry notification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: invalid encrypted stanzaId received"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media retry: different stanzaIds: "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: Msg "," mediaEntry is invalid"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: Msg "," "," no longer exists"]);l=function(){return a};return a}function a(a){a.assertTag("notification");a.assertAttr("type","mediaretry");var b=a.attrFromJidChat();a=a.child("encrypt");var c=a.child("enc_p").contentBytes();a=a.child("enc_iv").contentBytes();return{from:b,encProto:c,encIv:a}}function c(a){var c=a.stanzaId,e=a.notification.from,f=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(c),to:d("WAWap").JID(e.author),participant:d("WAWap").DROP_ATTR,"class":"notification",type:"mediaretry"});if(d("WAGlobals").getConfig().enableRawStanzaQueueStore())return{process:function(){return b("Promise").resolve({persist:function(){return d("WAStanzaQueuePersistApi").persistNotificationTransaction([a]).then(function(){return{followUp:function(){return b("Promise").resolve([f])}}})}})}};var g={externalId:c,author:d("WAJids").extractUserJid(e.author),chat:e.chat};function h(){return b("Promise").resolve({persist:function(){return b("Promise").resolve({followUp:function(){return b("Promise").resolve([f])}})}})}function i(){var c,e,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:k=function(){return d("WAGlobals").getDbImpls().updateMediaEntryForMsg(e,g,i).then(function(){return{followUp:j}})};j=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.downloadAndHandleMedia(g,e,"WAHandleMediaRetryNotification")));case 2:return a.abrupt("return",[f]);case 3:case"end":return a.stop()}},null,this)};l.next=4;return b("regeneratorRuntime").awrap(m(a,g));case 4:c=l.sent;if(!(c==null)){l.next=7;break}return l.abrupt("return",h());case 7:e=c.plaintextHash,i=c.updateEntry;return l.abrupt("return",{persist:k});case 9:case"end":return l.stop()}},null,this)}return{process:i}}function m(a,c){var e,f,g,m,n,o,p,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:e=a.stanzaId,f=a.notification,g=f.from,m=f.encProto,n=f.encIv;A.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaMsgForRedownload(g.chat,e,g.author));case 3:o=A.sent;if(o.success){A.next=7;break}d("WALogger").LOG(l(),g.chat,e);return A.abrupt("return",null);case 7:p=o.value,q=p.plaintextHash,r=p.mediaEntryData;s=d("WAMediaUtils").decodeMediaEntryData(r);t=s.fileSha256,u=s.fileEncSha256,v=s.mediaKey,w=s.serverMediaType;if(!(v==null||t==null||u==null||w==null)){A.next=13;break}d("WALogger").LOG(k(),c);return A.abrupt("return",null);case 13:A.next=15;return b("regeneratorRuntime").awrap(d("WAMediaRetryCrypto").decryptMediaRetryNotification(v,e,n,m));case 15:x=A.sent;y=x.stanzaId;z=x.directPath;if(!(y!==e)){A.next=22;break}d("WALogger").WARN(j(),y,e);d("WALogger").ERROR(i());return A.abrupt("return",null);case 22:if(!(z==null)){A.next=25;break}d("WALogger").ERROR(h());return A.abrupt("return",null);case 25:return A.abrupt("return",{plaintextHash:q,updateEntry:function(){return d("WAMediaUtils").encodeMediaEntryForDownload({fileSha256:t,fileEncSha256:u,mediaKey:v,serverMediaType:w,directPath:z})}});case 26:case"end":return A.stop()}},null,this)}g.parseMediaRetryNotification=a;g.handleMediaRetryNotification=c;g.prepareMediaRetry=m}),98);
__d("WASmaxInAbPropsServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInAbPropsRefreshRequest",["WAResultOrError","WASmaxInAbPropsServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"abprops");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","server");if(!c.success)return c;var e=d("WASmaxParseJid").attrDeviceJid(a,"from");if(!e.success)return e;b=d("WASmaxParseUtils").attrIntRange(b.value,"protocol",1,10);if(!b.success)return b;a=d("WASmaxInAbPropsServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:c.value,from:e.value,abpropsProtocol:b.value},a.value))}g.parseRefreshRequest=a}),98);
__d("WASmaxOutAbPropsNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrDeviceJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").DEVICE_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutAbPropsRefreshResponseAck",["WASmaxJsx","WASmaxOutAbPropsNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutAbPropsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeRefreshResponseAck=a}),98);
__d("WASmaxAbPropsRefreshRPC",["WASmaxInAbPropsRefreshRequest","WASmaxOutAbPropsRefreshResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsRefreshRequest").parseRefreshRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Refresh",{Request:b}));return{parsedRequest:b.value,makeRefreshResponseAck:function(){return d("WASmaxOutAbPropsRefreshResponseAck").makeRefreshResponseAck(a)}}}g.receiveRefreshRPC=a}),98);
__d("WAHandleServerNotification",["Promise","WAJobDefinitions","WAJobs","WALogger","WASmaxAbPropsRefreshRPC","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleServerNotification with id=",", ts=",""]);h=function(){return a};return a}function a(a){a=d("WASmaxAbPropsRefreshRPC").receiveRefreshRPC(a);return{ts:d("WATimeUtils").castToUnixTime(a.parsedRequest.t),ack:a.makeRefreshResponseAck}}function c(a){d("WALogger").LOG(h(),a.stanzaId,a.ts);function c(){return b("Promise").resolve([a.ack()])}function e(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilCompleted(d("WAJobDefinitions").jobSerializers.syncAbProps(!1)));case 2:return a.abrupt("return",{persist:function(){return b("Promise").resolve({followUp:c})}});case 3:case"end":return a.stop()}},null,this)}return{process:e}}g.parseServerNotification=a;g.handleServerNotification=c}),98);
__d("WACryptoLtHash",["Promise","WACryptoHkdf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=2,i=128;a=new ArrayBuffer(i);c=function(){function a(a){this.salt=a}var c=a.prototype;c.add=function(a,c){var d=this;return c.reduce(function(a,c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=d;e.next=3;return b("regeneratorRuntime").awrap(a);case 3:e.t1=e.sent;e.t2=c;return e.abrupt("return",e.t0.$1.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}},null,this)},b("Promise").resolve(a))};c.subtract=function(a,c){var d=this;return c.reduce(function(a,c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=d;e.next=3;return b("regeneratorRuntime").awrap(a);case 3:e.t1=e.sent;e.t2=c;return e.abrupt("return",e.t0.$2.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}},null,this)},b("Promise").resolve(a))};c.subtractThenAdd=function(a,c,d){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.t0=this;e.next=3;return b("regeneratorRuntime").awrap(this.subtract(a,d));case 3:e.t1=e.sent;e.t2=c;return e.abrupt("return",e.t0.add.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}},null,this)};c.$1=function(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WACryptoHkdf").extractAndExpand(c,this.salt,i));case 2:e=f.sent;return f.abrupt("return",this.performPointwiseWithOverflow(a,e,function(a,b){return a+b}));case 4:case"end":return f.stop()}},null,this)};c.$2=function(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WACryptoHkdf").extractAndExpand(c,this.salt,i));case 2:e=f.sent;return f.abrupt("return",this.performPointwiseWithOverflow(a,e,function(a,b){return a-b}));case 4:case"end":return f.stop()}},null,this)};c.performPointwiseWithOverflow=function(a,b,c){a=new DataView(a);b=new DataView(b);var d=new ArrayBuffer(a.byteLength),e=new DataView(d);for(var f=0;f<a.byteLength;f+=h)e.setUint16(f,c(a.getUint16(f,!0),b.getUint16(f,!0)),!0);return d};return a}();e=new c("WhatsApp Patch Integrity");g.KEY_LENGTH_BYTES=i;g.EMPTY_LT_HASH=a;g.LtHash16=c;g.LT_HASH_ANTI_TAMPERING=e}),98);
__d("WAGetCollectionVersion",["WABaseGlobals","WACryptoLtHash"],(function(a,b,c,d,e,f,g){function a(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.get(a)})}function h(a,b){a=a.CollectionVersionStore;return a.get(b).then(function(a){return(a=a==null?void 0:a.ltHash)!=null?a:new ArrayBuffer(d("WACryptoLtHash").KEY_LENGTH_BYTES)})}function b(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return h({CollectionVersionStore:b},a)})}function c(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.bulkGet(a)})}function e(){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(a){a=a.CollectionVersionStore;return a.getAll()})}function f(a,b,c){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(d){d=d.CollectionVersionStore;return d.update(a,{version:b,ltHash:c})})}function i(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.bulkUpdate(a)})}function j(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.get(a).then(function(a){return a==null?void 0:a.isCollectionInMacMismatchFatal})})}function k(a){return d("WABaseGlobals").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.update(a,{isCollectionInMacMismatchFatal:!0})})}g.getCollectionVersionInTransaction=a;g.getCollectionVersionLtHash=h;g.getCollectionVersionLtHashInTransaction=b;g.bulkGetCollectionVersionsInTransaction=c;g.getAllCollectionVersionsInTransaction=e;g.updateCollectionVersionAndLtHashInTransaction=f;g.bulkUpdateCollectionVersionInTransaction=i;g.getIsCollectionInMacMismatchFatalInTransaction=j;g.updateIsCollectionInMacMismatchFatalInTransaction=k}),98);
__d("WAGetMissingKey",["WABaseGlobals"],(function(a,b,c,d,e,f,g){function a(){return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(a){a=a.MissingKeyStore;return a.getAll()})}function b(a){return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(b){b=b.MissingKeyStore;return b.bulkGet(a)})}function c(){return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(a){a=a.MissingKeyStore;return a.count()})}function e(a){return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(b){b=b.MissingKeyStore;return b.bulkUpdate(a)})}g.getAllMissingKeysInTransaction=a;g.bulkGetMissingKeysInTransaction=b;g.getMissingKeyCountTransaction=c;g.bulkUpdateMissingKeysInTransaction=e}),98);
__d("WAGetPendingMutation",["WABaseGlobals"],(function(a,b,c,d,e,f,g){function a(a){return d("WABaseGlobals").runInTransaction({PendingMutationStore:!0},function(b){b=b.PendingMutationStore;return b.getByCollection(a)})}function b(){return d("WABaseGlobals").runInTransaction({PendingMutationStore:!0},function(a){a=a.PendingMutationStore;return a.getAll()})}function c(a){return d("WABaseGlobals").runInTransaction({PendingMutationStore:!0},function(b){b=b.PendingMutationStore;return b.bulkCreate(a)})}g.getSyncPendingMutationsByCollectionInTransaction=a;g.getAllSyncPendingMutationsInTransaction=b;g.bulkCreateSyncPendingMutationsInTransaction=c}),98);
__d("WAGetSyncAction",["WABaseGlobals"],(function(a,b,c,d,e,f,g){function a(){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(a){a=a.SyncActionStore;return a.count()})}function b(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.get(a)})}function c(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.getByCollections(a)})}function e(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.getByIndexMacs(a)})}function f(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.getByActionStates(a)})}function h(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.getByModelInfos(a)})}function i(){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(a){a=a.SyncActionStore;return a.getAll()})}function j(a){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0},function(b){b=b.SyncActionStore;return b.bulkUpdate(a)})}g.countSyncActionsInTransaction=a;g.getSyncActionInTransaction=b;g.getSyncActionsByCollectionsInTransaction=c;g.getSyncActionsByIndexMacsInTransaction=e;g.getSyncActionsByActionStatesInTransaction=f;g.getSyncActionsByModelInfosInTransaction=h;g.getAllSyncActions=i;g.bulkUpdateSyncActionsInTransaction=j}),98);
__d("WAGetSyncKey",["WABaseGlobals"],(function(a,b,c,d,e,f,g){function a(a){return d("WABaseGlobals").runInTransaction({SyncKeyStore:!0},function(b){b=b.SyncKeyStore;return b.get(a)})}function b(){return d("WABaseGlobals").runInTransaction({SyncKeyStore:!0},function(a){a=a.SyncKeyStore;return a.getAll()})}function c(a){return d("WABaseGlobals").runInTransaction({SyncKeyStore:!0},function(b){b=b.SyncKeyStore;return b.set(a)})}function e(a){return d("WABaseGlobals").runInTransaction({SyncKeyStore:!0},function(b){b=b.SyncKeyStore;return b.expire(a)})}g.getSyncKeyInTransaction_DO_NOT_USE=a;g.getAllSyncKeysInTransaction=b;g.setSyncKeyInTransaction=c;g.expireSyncKeyInTransaction=e}),98);
__d("WASyncdCollectionsStateMachine",["WAGetCollectionVersion","WALogger","WASyncdConst","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Collection "," is in finite retry state with no failure start time"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: ",": "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: state machine persistToDb. states:"]);j=function(){return a};return a}a=function(){function a(){}a.loadStatesFromDb=function(){var a=this,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getAllCollectionVersionsInTransaction());case 2:c=e.sent,c.forEach(function(b){return a.collectionStates.set(b.collection,{collection:b.collection,state:b.state,finiteFailureStartTime:b.finiteFailureStartTime})});case 4:case"end":return e.stop()}},null,this)};a.persistToDb=function(){var a=[];this.collectionStates.forEach(function(b){return a.push(b)});d("WALogger").LOG(j());a.forEach(function(a){var b=a.finiteFailureStartTime==null?"":"(failure start: "+a.finiteFailureStartTime+")";d("WALogger").LOG(i(),a.collection,a.state,b)});return d("WAGetCollectionVersion").bulkUpdateCollectionVersionInTransaction(a)};a.clean=function(){this.collectionStates=new Map()};a.getCollectionState=function(a){var b=this.collectionStates.get(a);if(b)return b.state;this.moveCollectionsToUpToDate([a]);return d("WASyncdConst").CollectionSyncState.UpToDate};a.getCollectionsInStateDirty=function(){var a=[];this.collectionStates.forEach(function(b){b.state===d("WASyncdConst").CollectionSyncState.Dirty&&a.push(b.collection)});return a};a.getCollectionsInStateRetry=function(){var a=[];this.collectionStates.forEach(function(b){b.state===d("WASyncdConst").CollectionSyncState.FailingFiniteRetry&&a.push(b.collection)});return a};a.getCollectionsInStateFatal=function(){var a=[];this.collectionStates.forEach(function(b){b.state===d("WASyncdConst").CollectionSyncState.Fatal&&a.push(b.collection)});return a};a.getCollectionsInStateBlocked=function(){var a=[];this.collectionStates.forEach(function(b){b.state===d("WASyncdConst").CollectionSyncState.Blocked&&a.push(b.collection)});return a};a.moveCollectionsToUpToDate=function(a){var b=this;a.forEach(function(a){return b.collectionStates.set(a,{collection:a,state:d("WASyncdConst").CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})})};a.moveCollectionsToDirty=function(a){var b=this;a.forEach(function(a){return b.collectionStates.set(a,{collection:a,state:d("WASyncdConst").CollectionSyncState.Dirty,finiteFailureStartTime:(a=b.collectionStates.get(a))==null?void 0:a.finiteFailureStartTime})})};a.moveCollectionsToFiniteRetry=function(a){var b=this;a.forEach(function(a){return b.collectionStates.set(a,{collection:a,state:d("WASyncdConst").CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:(a=(a=b.collectionStates.get(a))==null?void 0:a.finiteFailureStartTime)!=null?a:d("WATimeUtils").unixTimeMs()})})};a.moveCollectionsToFatal=function(a){var b=this;a.forEach(function(a){return b.collectionStates.set(a,{collection:a,state:d("WASyncdConst").CollectionSyncState.Fatal})})};a.moveCollectionsToBlocked=function(a){var b=this;a.forEach(function(a){return b.collectionStates.set(a,{collection:a,state:d("WASyncdConst").CollectionSyncState.Blocked,finiteFailureStartTime:(a=b.collectionStates.get(a))==null?void 0:a.finiteFailureStartTime})})};a.getExpiredCollections=function(){var a=[];this.collectionStates.forEach(function(b){if(b.state===d("WASyncdConst").CollectionSyncState.FailingFiniteRetry){var c;b.finiteFailureStartTime==null?(c=Infinity,d("WALogger").WARN(h(),b.collection)):c=b.finiteFailureStartTime;c=c+d("WASyncdConst").FINITE_FAILURE_EXPIRY_DURATION;c<d("WATimeUtils").unixTimeMs()&&a.push(b.collection)}});return a};a.getCollectionMinFailureTime=function(){var a=Array.from(this.collectionStates.values()).filter(function(a){return a.state===d("WASyncdConst").CollectionSyncState.FailingFiniteRetry}).map(function(a){return a.finiteFailureStartTime}).filter(Boolean);return a.length===0?null:Math.min.apply(Math,a)};return a}();a.collectionStates=new Map();g["default"]=a}),98);
__d("WASyncdDisabled",["WABaseGlobals"],(function(a,b,c,d,e,f,g){function a(){return d("WABaseGlobals").getConfig().syncdDisabled()}g.isSyncdDisabled=a}),98);
__d("WASyncdKeyCache",["WABase64","WAGetSyncKey","WASyncdKeyTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new Map();function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=d("WABase64").encodeB64(d("WASyncdKeyTypes").fromSyncKeyId(a));f=h.get(e);if(!f){g.next=4;break}return g.abrupt("return",f.keyData);case 4:g.next=6;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getSyncKeyInTransaction_DO_NOT_USE(a));case 6:f=g.sent;f&&h.set(e,f);return g.abrupt("return",(c=f)==null?void 0:c.keyData);case 9:case"end":return g.stop()}},null,this)}function c(){h=new Map()}g.getKeyData=a;g.clearSyncKeysCache=c}),98);
__d("WASyncAction.pb",["WAProtoConst","WAProtocol.pb"],(function(a,b,c,d,e,f,g){a=babelHelpers["extends"]({},null);b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null),n=babelHelpers["extends"]({},null),o=babelHelpers["extends"]({},null),p=babelHelpers["extends"]({},null),q=babelHelpers["extends"]({},null),r=babelHelpers["extends"]({},null),s=babelHelpers["extends"]({},null),t=babelHelpers["extends"]({},null),u=babelHelpers["extends"]({},null),v=babelHelpers["extends"]({},null),w=babelHelpers["extends"]({},null),x=babelHelpers["extends"]({},null),y=babelHelpers["extends"]({},null),z=babelHelpers["extends"]({},null),A=babelHelpers["extends"]({},null),B=babelHelpers["extends"]({},null),C=babelHelpers["extends"]({},null),D=babelHelpers["extends"]({},null),E=babelHelpers["extends"]({},null),F=babelHelpers["extends"]({},null),G=babelHelpers["extends"]({},null),H=babelHelpers["extends"]({},null),I=babelHelpers["extends"]({},null),J=babelHelpers["extends"]({},null),K=babelHelpers["extends"]({},null),L=babelHelpers["extends"]({},null);a.internalSpec={emoji:[1,d("WAProtoConst").TYPES.STRING],weight:[2,d("WAProtoConst").TYPES.FLOAT]};b.internalSpec={timestamp:[1,d("WAProtoConst").TYPES.INT64],starAction:[2,d("WAProtoConst").TYPES.MESSAGE,K],contactAction:[3,d("WAProtoConst").TYPES.MESSAGE,J],muteAction:[4,d("WAProtoConst").TYPES.MESSAGE,I],pinAction:[5,d("WAProtoConst").TYPES.MESSAGE,H],securityNotificationSetting:[6,d("WAProtoConst").TYPES.MESSAGE,G],pushNameSetting:[7,d("WAProtoConst").TYPES.MESSAGE,F],quickReplyAction:[8,d("WAProtoConst").TYPES.MESSAGE,D],recentEmojiWeightsAction:[11,d("WAProtoConst").TYPES.MESSAGE,A],labelEditAction:[14,d("WAProtoConst").TYPES.MESSAGE,B],labelAssociationAction:[15,d("WAProtoConst").TYPES.MESSAGE,C],localeSetting:[16,d("WAProtoConst").TYPES.MESSAGE,E],archiveChatAction:[17,d("WAProtoConst").TYPES.MESSAGE,z],deleteMessageForMeAction:[18,d("WAProtoConst").TYPES.MESSAGE,y],keyExpiration:[19,d("WAProtoConst").TYPES.MESSAGE,r],markChatAsReadAction:[20,d("WAProtoConst").TYPES.MESSAGE,x],clearChatAction:[21,d("WAProtoConst").TYPES.MESSAGE,w],deleteChatAction:[22,d("WAProtoConst").TYPES.MESSAGE,v],unarchiveChatsSetting:[23,d("WAProtoConst").TYPES.MESSAGE,u],primaryFeature:[24,d("WAProtoConst").TYPES.MESSAGE,q],androidUnsupportedActions:[26,d("WAProtoConst").TYPES.MESSAGE,p],agentAction:[27,d("WAProtoConst").TYPES.MESSAGE,o],subscriptionAction:[28,d("WAProtoConst").TYPES.MESSAGE,n],userStatusMuteAction:[29,d("WAProtoConst").TYPES.MESSAGE,m],timeFormatAction:[30,d("WAProtoConst").TYPES.MESSAGE,l],nuxAction:[31,d("WAProtoConst").TYPES.MESSAGE,k],primaryVersionAction:[32,d("WAProtoConst").TYPES.MESSAGE,j],stickerAction:[33,d("WAProtoConst").TYPES.MESSAGE,h],removeRecentStickerAction:[34,d("WAProtoConst").TYPES.MESSAGE,i],chatAssignment:[35,d("WAProtoConst").TYPES.MESSAGE,f],chatAssignmentOpenedStatus:[36,d("WAProtoConst").TYPES.MESSAGE,e],pnForLidChatAction:[37,d("WAProtoConst").TYPES.MESSAGE,c]};c.internalSpec={pnJid:[1,d("WAProtoConst").TYPES.STRING]};e.internalSpec={chatOpened:[1,d("WAProtoConst").TYPES.BOOL]};f.internalSpec={deviceAgentID:[1,d("WAProtoConst").TYPES.STRING]};h.internalSpec={url:[1,d("WAProtoConst").TYPES.STRING],fileEncSha256:[2,d("WAProtoConst").TYPES.BYTES],mediaKey:[3,d("WAProtoConst").TYPES.BYTES],mimetype:[4,d("WAProtoConst").TYPES.STRING],height:[5,d("WAProtoConst").TYPES.UINT32],width:[6,d("WAProtoConst").TYPES.UINT32],directPath:[7,d("WAProtoConst").TYPES.STRING],fileLength:[8,d("WAProtoConst").TYPES.UINT64],isFavorite:[9,d("WAProtoConst").TYPES.BOOL],deviceIdHint:[10,d("WAProtoConst").TYPES.UINT32]};i.internalSpec={lastStickerSentTs:[1,d("WAProtoConst").TYPES.INT64]};j.internalSpec={version:[1,d("WAProtoConst").TYPES.STRING]};k.internalSpec={acknowledged:[1,d("WAProtoConst").TYPES.BOOL]};l.internalSpec={isTwentyFourHourFormatEnabled:[1,d("WAProtoConst").TYPES.BOOL]};m.internalSpec={muted:[1,d("WAProtoConst").TYPES.BOOL]};n.internalSpec={isDeactivated:[1,d("WAProtoConst").TYPES.BOOL],isAutoRenewing:[2,d("WAProtoConst").TYPES.BOOL],expirationDate:[3,d("WAProtoConst").TYPES.INT64]};o.internalSpec={name:[1,d("WAProtoConst").TYPES.STRING],deviceID:[2,d("WAProtoConst").TYPES.INT32],isDeleted:[3,d("WAProtoConst").TYPES.BOOL]};p.internalSpec={allowed:[1,d("WAProtoConst").TYPES.BOOL]};q.internalSpec={flags:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.STRING]};r.internalSpec={expiredKeyEpoch:[1,d("WAProtoConst").TYPES.INT32]};s.internalSpec={key:[1,d("WAProtoConst").TYPES.MESSAGE,d("WAProtocol.pb").MessageKeySpec],timestamp:[2,d("WAProtoConst").TYPES.INT64]};t.internalSpec={lastMessageTimestamp:[1,d("WAProtoConst").TYPES.INT64],lastSystemMessageTimestamp:[2,d("WAProtoConst").TYPES.INT64],messages:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,s]};u.internalSpec={unarchiveChats:[1,d("WAProtoConst").TYPES.BOOL]};v.internalSpec={messageRange:[1,d("WAProtoConst").TYPES.MESSAGE,t]};w.internalSpec={messageRange:[1,d("WAProtoConst").TYPES.MESSAGE,t]};x.internalSpec={read:[1,d("WAProtoConst").TYPES.BOOL],messageRange:[2,d("WAProtoConst").TYPES.MESSAGE,t]};y.internalSpec={deleteMedia:[1,d("WAProtoConst").TYPES.BOOL],messageTimestamp:[2,d("WAProtoConst").TYPES.INT64]};z.internalSpec={archived:[1,d("WAProtoConst").TYPES.BOOL],messageRange:[2,d("WAProtoConst").TYPES.MESSAGE,t]};A.internalSpec={weights:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,a]};B.internalSpec={name:[1,d("WAProtoConst").TYPES.STRING],color:[2,d("WAProtoConst").TYPES.INT32],predefinedId:[3,d("WAProtoConst").TYPES.INT32],deleted:[4,d("WAProtoConst").TYPES.BOOL]};C.internalSpec={labeled:[1,d("WAProtoConst").TYPES.BOOL]};D.internalSpec={shortcut:[1,d("WAProtoConst").TYPES.STRING],message:[2,d("WAProtoConst").TYPES.STRING],keywords:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.STRING],count:[4,d("WAProtoConst").TYPES.INT32],deleted:[5,d("WAProtoConst").TYPES.BOOL]};E.internalSpec={locale:[1,d("WAProtoConst").TYPES.STRING]};F.internalSpec={name:[1,d("WAProtoConst").TYPES.STRING]};G.internalSpec={showNotification:[1,d("WAProtoConst").TYPES.BOOL]};H.internalSpec={pinned:[1,d("WAProtoConst").TYPES.BOOL]};I.internalSpec={muted:[1,d("WAProtoConst").TYPES.BOOL],muteEndTimestamp:[2,d("WAProtoConst").TYPES.INT64],autoMuted:[3,d("WAProtoConst").TYPES.BOOL]};J.internalSpec={fullName:[1,d("WAProtoConst").TYPES.STRING],firstName:[2,d("WAProtoConst").TYPES.STRING],lidJid:[3,d("WAProtoConst").TYPES.STRING]};K.internalSpec={starred:[1,d("WAProtoConst").TYPES.BOOL]};L.internalSpec={index:[1,d("WAProtoConst").TYPES.BYTES],value:[2,d("WAProtoConst").TYPES.MESSAGE,b],padding:[3,d("WAProtoConst").TYPES.BYTES],version:[4,d("WAProtoConst").TYPES.INT32]};g.RecentEmojiWeightSpec=a;g.SyncActionValueSpec=b;g.SyncActionValue$PnForLidChatActionSpec=c;g.SyncActionValue$ChatAssignmentOpenedStatusActionSpec=e;g.SyncActionValue$ChatAssignmentActionSpec=f;g.SyncActionValue$StickerActionSpec=h;g.SyncActionValue$RemoveRecentStickerActionSpec=i;g.SyncActionValue$PrimaryVersionActionSpec=j;g.SyncActionValue$NuxActionSpec=k;g.SyncActionValue$TimeFormatActionSpec=l;g.SyncActionValue$UserStatusMuteActionSpec=m;g.SyncActionValue$SubscriptionActionSpec=n;g.SyncActionValue$AgentActionSpec=o;g.SyncActionValue$AndroidUnsupportedActionsSpec=p;g.SyncActionValue$PrimaryFeatureSpec=q;g.SyncActionValue$KeyExpirationSpec=r;g.SyncActionValue$SyncActionMessageSpec=s;g.SyncActionValue$SyncActionMessageRangeSpec=t;g.SyncActionValue$UnarchiveChatsSettingSpec=u;g.SyncActionValue$DeleteChatActionSpec=v;g.SyncActionValue$ClearChatActionSpec=w;g.SyncActionValue$MarkChatAsReadActionSpec=x;g.SyncActionValue$DeleteMessageForMeActionSpec=y;g.SyncActionValue$ArchiveChatActionSpec=z;g.SyncActionValue$RecentEmojiWeightsActionSpec=A;g.SyncActionValue$LabelEditActionSpec=B;g.SyncActionValue$LabelAssociationActionSpec=C;g.SyncActionValue$QuickReplyActionSpec=D;g.SyncActionValue$LocaleSettingSpec=E;g.SyncActionValue$PushNameSettingSpec=F;g.SyncActionValue$SecurityNotificationSettingSpec=G;g.SyncActionValue$PinActionSpec=H;g.SyncActionValue$MuteActionSpec=I;g.SyncActionValue$ContactActionSpec=J;g.SyncActionValue$StarActionSpec=K;g.SyncActionDataSpec=L}),98);
__d("WASyncdMetricCriticalBootstrapStage",["$InternalEnum","WALogger","WAPREList","WAPREMetrics","WASyncAction.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown SyncdDecryptMutationsType for DecryptMutations"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing decryptedMutationMessageRangeCountArray for DecryptMutations"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing totalAdditionalMessagesCount for DecryptMutations"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing count for DecryptMutations"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing type for DecryptMutations"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown bootstrap stage: "," for critical bootstrap stage"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing bootstrap stage for critical bootstrap stage"]);n=function(){return a};return a}var o=b("$InternalEnum").Mirrored(["ABOUT_TO_APPLY_MUTATIONS","APPLIED_MUTATIONS","MUTATIONS_DECRYPTED","REQUEST_BUILT","RESPONSE_RECEIVED","RESPONSE_PARSED_VALID","ENTERED_RETRY_MODE","MISSING_KEYS_RECEIVED"]),p=b("$InternalEnum").Mirrored(["PATCH_MUTATIONS","SNAPSHOT_MUTATIONS"]);function q(a){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE).endSuccess(r({type:a}))}function a(a,b){q(o.MUTATIONS_DECRYPTED),d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_DECRYPT_MUTATIONS).endSuccess(s({type:a,mutations:b}))}function r(a){return{string:{criticalBootstrapStage:a.type}}}function s(a){var b=a.type;a=a.mutations;var c,e=0,f=[];a.forEach(function(a){a=a.binarySyncData;a=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,a);a=a.value;if(a==null)return;a.archiveChatAction?c=a.archiveChatAction.messageRange:a.markChatAsReadAction?c=a.markChatAsReadAction.messageRange:a.clearChatAction?c=a.clearChatAction.messageRange:a.deleteChatAction&&(c=a.deleteChatAction.messageRange);c!=null&&(e+=c.messages.length,f.push(c.messages.length))});return{string:{mutationType:b},"int":{count:a.length,totalAdditionalMessagesCount:e},int_array:{messageRangeLengths:f}}}function c(a){a=a==null?void 0:(a=a.string)==null?void 0:a.criticalBootstrapStage;if(a==null){d("WALogger").ERROR(n());return null}var b=o.cast(a);if(b==null){d("WALogger").ERROR(m(),a);return null}return{type:b}}function e(a){var b,c,e;b=a==null?void 0:(b=a.string)==null?void 0:b.mutationType;c=a==null?void 0:(c=a["int"])==null?void 0:c.count;e=a==null?void 0:(e=a["int"])==null?void 0:e.totalAdditionalMessagesCount;a=a==null?void 0:(a=a.int_array)==null?void 0:a.messageRangeLengths;if(b==null){d("WALogger").ERROR(l());return null}if(c==null){d("WALogger").ERROR(k());return null}if(e==null){d("WALogger").ERROR(j());return null}if(a==null){d("WALogger").ERROR(i());return null}b=p.cast(b);if(b==null){d("WALogger").ERROR(h());return null}return{type:b,count:c,totalAdditionalMessagesCount:e,decryptedMutationMessageRangeCountArray:a}}g.SyncdCriticalBootstrapStageType=o;g.SyncdDecryptMutationsType=p;g.reportSyncdCriticalBootstrapStage=q;g.reportSyncdDecryptedMutations=a;g.convertSyncdCriticalBootstrapStageFromAnnotations=c;g.convertSyncdDecryptMutationsMetricsFromAnnotations=e}),98);
__d("WASyncdMetricFatalError",["$InternalEnum","WALogger","WAPREList","WAPREMetrics","WASyncdConst"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown error code: "," for syncd fatal error"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing error code for syncd fatal error"]);i=function(){return a};return a}var j=b("$InternalEnum").Mirrored(["PATCH_PROTOBUF_SERIALIZATION_FAILED","MUTATIONS_PROTOBUF_SERIALIZATION_FAILED","ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED","ENCRYPTION_FAILED","MISSING_SNAPSHOT_VERSION","MISSING_SNAPSHOT_MAC","MISSING_SNAPSHOT_KEY_ID","MISSING_PATCH_VERSION","PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS","MISSING_PATCH_SNAPSHOT_MAC","MISSING_PATCH_MAC","MISSING_PATCH_KEY_ID","MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY","MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH","MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256","MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256","MISSING_MUTATION_OPERATION","MISSING_MUTATION_RECORD","MISSING_MUTATION_INDEX","MISSING_MUTATION_VALUE","MISSING_MUTATION_KEY_ID","EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED","SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED","PATCH_PROTOBUF_DESERIALIZATION_FAILED","MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED","ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED","MISSING_ACTION_INDEX","MISSING_ACTION_VERSION","SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT","SNAPSHOT_MAC_MISMATCH_IN_PATCH","MAC_MISMATCH_PATCH","DECRYPTION_FAILED","DUPLICATE_PATCH_VERSION_IN_COLLECTION","SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH","SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT","MISSING_ACTION_VALUE","MISSING_ACTION_TIMESTAMP","XMPP_BAD_REQUEST_FOR_COLLECTION","XMPP_NOT_FOUND_FOR_COLLECTION","CYCLIC_MUTATION_DEPENDENCY_IN_PATCH","SERVER_DID_NOT_SEND_ALL_PATCHES","TERMINAL_PATCH_MISSING_DATA","TERMINAL_PATCH_DESERIALIZATION_ERROR","TERMINAL_PATCH_UNKNOWN","INVALID_ACTION_INDEX","XMPP_BAD_REQUEST_GLOBAL_ERROR","XMPP_NOT_FOUND_GLOBAL_ERROR","XMPP_BAD_METHOD_GLOBAL_ERROR","XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR","TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D","TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY","MISSING_KEY_ON_ALL_CLIENTS"]);function a(a,b,c,e,f){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_FATAL_ERROR).endFail("syncd fatal error: "+a,k({type:a,collection:b,patchSnapshotMutationCount:c,patchVersion:e,isFatal:f}))}function k(a){var b=a.type,c=a.collection,d=a.patchSnapshotMutationCount,e=a.patchVersion;a=a.isFatal;return{string:{errorCode:b,collection:c==null?null:c},"int":{patchSnapshotMutationCount:d,patchVersion:e},bool:{isFatal:a}}}function c(a){var b;b=a==null?void 0:(b=a.string)==null?void 0:b.errorCode;if(b==null){d("WALogger").ERROR(i());return null}var c=j.cast(b);if(c==null){d("WALogger").ERROR(h(),b);return null}return{type:c,collection:d("WASyncdConst").CollectionName.cast(a==null?void 0:(b=a.string)==null?void 0:b.collection),patchSnapshotMutationCount:a==null?void 0:(c=a["int"])==null?void 0:c.patchSnapshotMutationCount,patchVersion:a==null?void 0:(b=a["int"])==null?void 0:b.patchVersion,isFatal:a==null?void 0:(c=a.bool)==null?void 0:c.isFatal}}g.SyncdFatalErrorType=j;g.reportSyncdFatalError=a;g.convertSyncdFatalErrorFromAnnotations=c}),98);
__d("WAPromiseEach",["regeneratorRuntime"],(function(a,b,c,d,e,f){a=function(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=[],e=0;case 2:if(!(e<a.length)){f.next=11;break}f.t0=d;f.next=6;return b("regeneratorRuntime").awrap(c(a[e]));case 6:f.t1=f.sent,f.t0.push.call(f.t0,f.t1);case 8:e++;f.next=2;break;case 11:return f.abrupt("return",d);case 12:case"end":return f.stop()}},null,this)};f.promiseEach=a}),66);
__d("WAMemoizeCache",[],(function(a,b,c,d,e,f){var g=[];function a(){g.forEach(function(a){return a.clear()})}function h(){var a=new Map();g.push(a);return a}function b(a,b){var c;return function(){c||(c=h());var d=b.apply(void 0,arguments),e=c.get(d);e==null&&(e=a.apply(void 0,arguments),c.set(d,e));return e}}f.clearAllMemoizeCache=a;f.MemoizeCache=h;f.memoizeWithArgs=b}),66);
__d("WASyncdCryptoConst",[],(function(a,b,c,d,e,f){a="WhatsApp Mutation Keys";b=160;c=32;d=32;e=32;var g=32,h=32,i=c,j=i+d,k=j+e,l=k+g,m=l+h,n="0x01",o="0x02",p=0,q=32,r=8,s=16,t=new ArrayBuffer(q);f.HKDF_INFO=a;f.DERIVED_KEY_LENGTH=b;f.INDEX_KEY_LENGTH=c;f.VALUE_ENCRYPTION_KEY_LENGTH=d;f.VALUE_MAC_KEY_LENGTH=e;f.SNAPSHOT_MAC_KEY_LENGTH=g;f.PATCH_MAC_KEY_LENGTH=h;f.INDEX_KEY_END=i;f.VALUE_ENCRYPTION_KEY_END=j;f.VALUE_MAC_KEY_END=k;f.SNAPSHOT_MAC_KEY_END=l;f.PATCH_MAC_KEY_END=m;f.OPERATION_SET_HEX=n;f.OPERATION_REMOVE_HEX=o;f.MAX_OF_MIN_DATA_LENGTH=p;f.MAC_LENGTH=q;f.OCTET_LENGTH=r;f.IV_LENGTH=s;f.EMPTY_MUTATION_MAC=t}),66);
__d("WASyncdCryptoHelper",["WACryptoHkdf","WASyncdCryptoConst","WASyncdKeyTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(h(a));case 2:c=e.sent;return e.abrupt("return",{indexKey:c.slice(0,d("WASyncdCryptoConst").INDEX_KEY_END),valueEncryptionKey:c.slice(d("WASyncdCryptoConst").INDEX_KEY_END,d("WASyncdCryptoConst").VALUE_ENCRYPTION_KEY_END),valueMacKey:c.slice(d("WASyncdCryptoConst").VALUE_ENCRYPTION_KEY_END,d("WASyncdCryptoConst").VALUE_MAC_KEY_END),snapshotMacKey:c.slice(d("WASyncdCryptoConst").VALUE_MAC_KEY_END,d("WASyncdCryptoConst").SNAPSHOT_MAC_KEY_END),patchMacKey:c.slice(d("WASyncdCryptoConst").SNAPSHOT_MAC_KEY_END,d("WASyncdCryptoConst").PATCH_MAC_KEY_END)});case 4:case"end":return e.stop()}},null,this)}function h(a){return d("WACryptoHkdf").extractAndExpand(d("WASyncdKeyTypes").fromSyncKeyData(a),d("WASyncdCryptoConst").HKDF_INFO,d("WASyncdCryptoConst").DERIVED_KEY_LENGTH)}g.generateEncryptionKeysUnmemoized=a}),98);
__d("WASyncdCrypto",["WABase64","WACryptoAesCbc","WACryptoHmac","WAErr","WAMemoizeCache","WAServerSync.pb","WASyncdCryptoConst","WASyncdCryptoHelper","WASyncdCryptoUtils","WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){var h=d("WAMemoizeCache").memoizeWithArgs(d("WASyncdCryptoHelper").generateEncryptionKeysUnmemoized,function(a){return d("WABase64").encodeB64(d("WASyncdKeyTypes").fromSyncKeyData(a))});function a(a,b){return d("WACryptoHmac").hmacSha256(new Uint8Array(a),new Uint8Array(b))}function b(a,b){b=d("WASyncdKeyTypes").fromSyncKeyId(b);var e;switch(a){case d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET:e=d("WASyncdCryptoConst").OPERATION_SET_HEX;break;case d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE:e=d("WASyncdCryptoConst").OPERATION_REMOVE_HEX;break}if(e){a=new Uint8Array([parseInt(e,16)]).buffer;var f=new Uint8Array(a.byteLength+b.byteLength);f.set(new Uint8Array(a));f.set(new Uint8Array(b),a.byteLength);return f.buffer}else throw c("WAErr")("invalid mutation operation value")}function e(a,b){a=Math.max(0,d("WASyncdCryptoConst").MAX_OF_MIN_DATA_LENGTH-a-b);b=new Uint8Array(a);self.crypto.getRandomValues(b);return b.buffer}function f(a,b,c){return d("WACryptoAesCbc").aesCbcEncrypt(b,c,a)}function i(a,b,c){var e=new Uint8Array(d("WASyncdCryptoConst").OCTET_LENGTH);e.set([a.byteLength],e.byteLength-1);a=d("WASyncdCryptoUtils").combine([a,b,e.buffer]);return d("WACryptoHmac").hmacSha512(c,a,d("WASyncdCryptoConst").MAC_LENGTH)}function j(a,b,c){return d("WACryptoAesCbc").aesCbcDecrypt(b,a,c)}function k(a,b,c,e){return d("WACryptoHmac").hmacSha256(a,d("WASyncdCryptoUtils").combine([b,c,e]))}function l(a,b,c,e,f){return d("WACryptoHmac").hmacSha256(a,d("WASyncdCryptoUtils").combine([b].concat(c,[e,f])))}function m(a){var b=a.byteLength;return new Uint8Array(a).slice(b-d("WASyncdCryptoConst").MAC_LENGTH).buffer}g.generateEncryptionKeys=h;g.generateIndexMac=a;g.generateAssociatedData=b;g.generatePadding=e;g.generateCipherText=f;g.generateMac=i;g.decryptCipherText=j;g.generateSnapshotMac=k;g.generatePatchMac=l;g.valueMacFromIndexAndValueCipherText=m}),98);
__d("WASyncdError",[],(function(a,b,c,d,e,f){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="SyncdMissingKeyError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));b=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this,b)||this;d.name="SyncdRetryableError";d.backoff=c;d.message=b;return d}return b}(babelHelpers.wrapNativeSuper(Error));c=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="SyncdFatalError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.SyncdMissingKeyError=a;f.SyncdRetryableError=b;f.SyncdFatalError=c}),66);
__d("WASyncdMetrics",["$InternalEnum","WALogger","WAPREList","WAPREMetrics","WASyncdConst"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown error code: "," for key rotation event"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing error code for key rotation event"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown error code: "," for critical event"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing error code for critical event"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown collection "," for bootstrap data applied event"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing durationMs for bootstrap data applied event"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing snapshotUsed for bootstrap data applied event"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing collection for bootstrap data applied event"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown collection "," for bootstrap app state download metric"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing isSuccess for bootstrap app state download metric"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing downloadStartTs for bootstrap app state download metric"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing collection for bootstrap app state download metric"]);s=function(){return a};return a}var t=b("$InternalEnum").Mirrored(["MISSING_MUTATION_TO_REMOVE"]),u=b("$InternalEnum").Mirrored(["SNAPSHOT_USED","SNAPSHOT_NOT_USED"]),v=b("$InternalEnum").Mirrored(["APP_STATE_SYNC_KEY_EXPIRY","DEVICE_DEREGISTERATION","NO_KEYS"]);function a(a){var b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD);a.isSuccess!=="success"?b.endFail("syncd error: Error downloading snapshot or patches",w(a)):b.endSuccess(w(a))}function c(a,b,c){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED).endSuccess(x({collection:a,snapshotUsed:b,durationMs:c}))}function e(a,b){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_EVENT).endFail("syncd critical event: "+a,y({type:a,collection:b}))}function f(a){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD_KEY_ROTATION).endSuccess(z({type:a}))}function w(a){var b=a.collection,c=a.downloadSize,d=a.downloadStartTs;a=a.isSuccess;return{string:{collection:b},"int":{downloadSize:c,downloadStartTs:d},bool:{isSuccess:a==="success"}}}function x(a){return{string:{collection:a.collection},bool:{snapshot:a.snapshotUsed===u.SNAPSHOT_USED},"int":{durationMs:a.durationMs}}}function y(a){return{string:{criticalEventCode:a.type,collection:a.collection==null?null:a.collection}}}function z(a){return{string:{keyRotationEventCode:a.type}}}function A(a){var b,c,e;b=a==null?void 0:(b=a.string)==null?void 0:b.collection;c=a==null?void 0:(c=a["int"])==null?void 0:c.downloadSize;e=a==null?void 0:(e=a["int"])==null?void 0:e.downloadStartTs;a=a==null?void 0:(a=a.bool)==null?void 0:a.isSuccess;if(b==null){d("WALogger").ERROR(s());return null}if(e==null){d("WALogger").ERROR(r());return null}if(a==null){d("WALogger").ERROR(q());return null}var f=d("WASyncdConst").CollectionName.cast(b);if(f==null){d("WALogger").ERROR(p(),b);return null}b=a?"success":"failure";return{collection:f,downloadStartTs:e,downloadSize:c,isSuccess:b}}function B(a){var b,c;b=a==null?void 0:(b=a.string)==null?void 0:b.collection;c=a==null?void 0:(c=a.bool)==null?void 0:c.snapshot;a=a==null?void 0:(a=a["int"])==null?void 0:a.durationMs;if(b==null){d("WALogger").ERROR(o());return null}if(c==null){d("WALogger").ERROR(n());return null}if(a==null){d("WALogger").ERROR(m());return null}var e=d("WASyncdConst").CollectionName.cast(b);if(e==null){d("WALogger").ERROR(l(),b);return null}b=c?u.SNAPSHOT_USED:u.SNAPSHOT_NOT_USED;return{collection:e,snapshotUsed:b,durationMs:a}}function C(a){var b;b=a==null?void 0:(b=a.string)==null?void 0:b.criticalEventCode;if(b==null){d("WALogger").ERROR(k());return null}var c=t.cast(b);if(c==null){d("WALogger").ERROR(j(),b);return null}return{type:c,collection:d("WASyncdConst").CollectionName.cast(a==null?void 0:(b=a.string)==null?void 0:b.collection)}}function D(a){a=a==null?void 0:(a=a.string)==null?void 0:a.keyRotationEventCode;if(a==null){d("WALogger").ERROR(i());return null}var b=v.cast(a);if(b==null){d("WALogger").ERROR(h(),a);return null}return{type:b}}function E(a){var b={};Object.keys(a).forEach(function(c){typeof a[c]==="number"?(b["int"]==null&&(b["int"]={}),b["int"][c]=a[c]):typeof a[c]==="string"&&(b.string==null&&(b.string={}),b.string[c]=a[c])});return Object.keys(b).length>0?b:void 0}b=function(){function a(){this.event=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SYNCD)}var b=a.prototype;b.end=function(a){a===void 0&&(a=!1),a?this.event.endFail("syncd failed"):this.event.endSuccess()};b.mark=function(a,b){this.event.addPoint(a,E(b))};return a}();g.SyncdCriticalEventType=t;g.SyncdBootstrapDataAppliedSnapshotUsed=u;g.SyncdKeyRotationEventType=v;g.reportSyncdBootstrapAppStateDownloadMetric=a;g.reportSyncdBootstrapDataApplied=c;g.reportSyncdCriticalEvent=e;g.reportSyncdKeyRotationEvent=f;g.convertSyncdBootstrapAppStateDownloadFromAnnotations=A;g.convertSyncdBootstrapDataAppliedFromAnnotations=B;g.convertSyncdCriticalEventFromAnnotations=C;g.convertSyncdKeyRotationEventFromAnnotations=D;g.constructAnnotationsFromContext=E;g.SyncdEventFlow=b}),98);
__d("WASyncdAntiTampering",["Promise","WABaseGlobals","WACryptoLtHash","WACryptoUtils","WAGetCollectionVersion","WAGetSyncAction","WALogger","WAPromiseEach","WAServerSync.pb","WASyncdConst","WASyncdCrypto","WASyncdCryptoUtils","WASyncdError","WASyncdKeyCache","WASyncdKeyTypes","WASyncdMetricFatalError","WASyncdMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["|",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: current snapshot "," v"," with "," mutations:"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: logMacs: ",": prepare"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: failed LtHash check for ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: computing ltHash for ",":\n  currentLtHash: ","\n  macsToAdd:\n      ","\n  macsToRemove:\n      ","\n  macsToOverwrite (also remove):\n      ","\n  newLtHash: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection "," for platform ",":\n      ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: had to use fallbackQueryForValueMac in collection "," for platform ",": ","\n        }"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: computing snapshot and patch macs for outgoing patch "," v",":\n  encoded version: ","\n  encoded collection: ","\n  snapshotMAC: ","\n  patchMAC: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd:\n      expected patchMAC: ","$\n      computed patchMAC: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unable to validate patch mac."]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: skip fatal after snapshot mac mismatch for collection ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd:\n      expected snapshotMAC: ","\n      computed snapshotMAC: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unable to validate snapshot mac."]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection "," is already in snapshot mac mismatch so not checking again"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: empty local lthash found when processing "," patch v",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," received patch v"," !== latest local version (v",") + 1"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: error on incoming records:\n    \t",""],["syncd: error on incoming records:\n    \\t",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: validating snapshot and patch mac for "," v",":\n  expected snapshotMAC: ","\n  expected patchMAC: ","\n  encoded version: ","\n  encoded collection: ","\n  key ID: ","\n  "]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: validating snapshot mac for "," snapshot v",":\n  ltHash: ","\n  encoded version: ","\n  encoded collection: ","\n  expected snapshotMAC: ","\n  "]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd:\n  "," snapshot macsToAdd:\n      ",""]);A=function(){return a};return a}function B(a,b,c){c===void 0&&(c=!0);a=typeof a==="string"?a:d("WASyncdCryptoUtils").arrayBufferToHexPadded(a);b=typeof b==="string"?b:d("WASyncdCryptoUtils").arrayBufferToHexPadded(b);c=c?-16:0;return a.slice(c)+":"+b.slice(c)}var C=new TextDecoder();function a(a,c){var e,f,g,h,i,j,k,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:e=c.mac,f=c.version,g=c.keyId,h=c.records;p.next=3;return b("regeneratorRuntime").awrap(d("WASyncdKeyCache").getKeyData(g.id));case 3:i=p.sent;if(i){p.next=6;break}throw new(d("WASyncdError").SyncdMissingKeyError)();case 6:j=new Map(h.map(function(a){return[d("WASyncdCryptoUtils").arrayBufferToHexPadded(a.index.blob),d("WASyncdCrypto").valueMacFromIndexAndValueCipherText(a.value.blob)]}));d("WALogger").LOG(A(),a,Array.from(j.entries()).map(function(a){var b=a[0];a=a[1];return B(b,a)}).join("\n\t"));p.next=10;return b("regeneratorRuntime").awrap(d("WACryptoLtHash").LT_HASH_ANTI_TAMPERING.add(d("WACryptoLtHash").EMPTY_LT_HASH,Array.from(j.values())));case 10:k=p.sent;p.next=13;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateEncryptionKeys(i));case 13:l=p.sent;m=l.snapshotMacKey;n=d("WASyncdCryptoUtils").to64BitNetworkOrder(f.version);o=d("WASyncdCryptoUtils").toUtf8(a).buffer;d("WALogger").LOG(z(),a,f.version,d("WASyncdCryptoUtils").arrayBufferToHexPadded(k),d("WASyncdCryptoUtils").arrayBufferToHexPadded(n),d("WASyncdCryptoUtils").arrayBufferToHexPadded(o),d("WASyncdCryptoUtils").arrayBufferToHexPadded(e)).devConsole("\n  --- DEV ONLY ---\n  snapshotMacKey: "+d("WASyncdCryptoUtils").arrayBufferToHexPadded(m));p.next=20;return b("regeneratorRuntime").awrap(E(a,e,m,k,n,o,!0,h.length,c.version.version));case 20:return p.abrupt("return",k);case 21:case"end":return p.stop()}},null,this)}function c(a,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:t=function(){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(J(a,!1));case 2:c=f.sent,e=new Map(c.map(function(a){var b=a.indexMac;a=a.valueMac;return[d("WASyncdCryptoUtils").arrayBufferToHexPadded(b),d("WASyncdCryptoUtils").arrayBufferToHexPadded(a)]})),d("WALogger").LOG(x(),p.map(function(a){var b=a.operation,c=a.indexMac;a=a.valueMac;return(b===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET?"set":"remove")+" | "+B(c,a,!1)+" | "+(e.has(d("WASyncdCryptoUtils").arrayBufferToHexPadded(c))?"found":"did not find")+" indexMAC in the above logged macs"}).join("\n\t"));case 5:case"end":return f.stop()}},null,this)};f=c.version,g=c.mutations,h=c.snapshotMac,i=c.patchMac,j=c.keyId;k=j.id;u.next=5;return b("regeneratorRuntime").awrap(d("WASyncdKeyCache").getKeyData(k));case 5:l=u.sent;if(l){u.next=8;break}throw new(d("WASyncdError").SyncdMissingKeyError)();case 8:u.next=10;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateEncryptionKeys(l));case 10:m=u.sent;n=m.snapshotMacKey;o=m.patchMacKey;p=g.map(function(a){return{operation:a.operation,indexMac:a.record.index.blob,valueMac:d("WASyncdCrypto").valueMacFromIndexAndValueCipherText(a.record.value.blob)}});u.next=16;return b("regeneratorRuntime").awrap(G(a,p,e));case 16:q=u.sent;r=d("WASyncdCryptoUtils").to64BitNetworkOrder(f.version);s=d("WASyncdCryptoUtils").toUtf8(a).buffer;d("WALogger").LOG(y(),a,f.version,d("WASyncdCryptoUtils").arrayBufferToHexPadded(h),d("WASyncdCryptoUtils").arrayBufferToHexPadded(i),d("WASyncdCryptoUtils").arrayBufferToHexPadded(r),d("WASyncdCryptoUtils").arrayBufferToHexPadded(s),d("WASyncdCryptoUtils").arrayBufferToHexPadded(d("WASyncdKeyTypes").fromSyncKeyId(k)));u.prev=20;u.next=23;return b("regeneratorRuntime").awrap(F(a,i,o,h,p.map(function(a){return a.valueMac}),r,s,g.length,f.version));case 23:u.next=25;return b("regeneratorRuntime").awrap(E(a,h,n,q,r,s,!1,g.length,f.version));case 25:u.next=32;break;case 27:u.prev=27;u.t0=u["catch"](20);u.next=31;return b("regeneratorRuntime").awrap(t());case 31:throw u.t0;case 32:return u.abrupt("return",q);case 33:case"end":return u.stop()}},null,this,[[20,27]])}function D(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionInTransaction(a).then(function(a){return(a=a==null?void 0:a.version)!=null?a:0}));case 2:e=h.sent;if(!(e!==c-1)){h.next=7;break}f=e>c-1?"greater-than-expected":"less-than-expected";d("WALogger").WARN(w(),a,c,e).sendLogs("syncd-version-check-error-local-version-"+f);throw new(d("WASyncdError").SyncdRetryableError)("syncd-version-check-error-local-version-"+f);case 7:h.next=9;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionLtHashInTransaction(a));case 9:g=h.sent;if(!(d("WACryptoUtils").arrayBuffersEqual(g,d("WACryptoLtHash").EMPTY_LT_HASH)&&c!==1)){h.next=13;break}d("WALogger").WARN(v(),a,c).sendLogs("syncd-empty-lthash-on-mac-mismatch");throw new(d("WASyncdError").SyncdRetryableError)("empty lthash");case 13:case"end":return h.stop()}},null,this)}function E(a,c,e,f,g,h,i,j,k){var l,m,n,o,p,q;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:m=d("WABaseGlobals").getConfig().syncdShouldNotFatalOnSnapshotMacMismatchInPatches()&&!i;v.next=3;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getIsCollectionInMacMismatchFatalInTransaction(a));case 3:v.t0=l=v.sent;if(!(v.t0!=null)){v.next=8;break}v.t1=l;v.next=9;break;case 8:v.t1=!1;case 9:n=v.t1;if(!(m&&n)){v.next=13;break}d("WALogger").LOG(u(),a);return v.abrupt("return");case 13:v.next=15;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateSnapshotMac(e,f,g,h));case 15:o=v.sent;p=d("WACryptoUtils").arrayBuffersEqual(o,c);if(p){v.next=31;break}d("WALogger").WARN(t()).sendLogs("syncd: unable to validate snapshot mac.");d("WALogger").DEV(s(),d("WASyncdCryptoUtils").arrayBufferToHexPadded(c),d("WASyncdCryptoUtils").arrayBufferToHexPadded(o));if(i){v.next=23;break}v.next=23;return b("regeneratorRuntime").awrap(D(a,k));case 23:q=i?d("WASyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:d("WASyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_PATCH;d("WASyncdMetricFatalError").reportSyncdFatalError(q,a,j,k,!m);if(!m){v.next=30;break}v.next=28;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").updateIsCollectionInMacMismatchFatalInTransaction(a));case 28:d("WALogger").LOG(r(),a);return v.abrupt("return");case 30:throw new(d("WASyncdError").SyncdFatalError)("unable to validate snapshot mac");case 31:case"end":return v.stop()}},null,this)}function F(a,c,e,f,g,h,i,j,k){var l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generatePatchMac(e,f,g,h,i));case 2:l=n.sent;m=d("WACryptoUtils").arrayBuffersEqual(l,c);if(m){n.next=11;break}n.next=7;return b("regeneratorRuntime").awrap(D(a,k));case 7:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MAC_MISMATCH_PATCH,a,j,k);d("WALogger").WARN(q()).sendLogs("syncd: unable to validate patch mac.");d("WALogger").DEV(p(),c,l);throw new(d("WASyncdError").SyncdFatalError)("unable to validate patch mac");case 11:case"end":return n.stop()}},null,this)}function e(a,c,e,f){var g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:p.next=2;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionInTransaction(a).then(function(a){return(a=a==null?void 0:a.version)!=null?a:d("WASyncdConst").DEFAULT_COLLECTION_VERSION}));case 2:p.t0=p.sent;g=p.t0+1;p.next=6;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateEncryptionKeys(f));case 6:h=p.sent;i=h.patchMacKey;j=h.snapshotMacKey;k=d("WASyncdCryptoUtils").to64BitNetworkOrder(g);l=d("WASyncdCryptoUtils").toUtf8(a).buffer;p.next=13;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateSnapshotMac(j,c,k,l));case 13:m=p.sent;p.next=16;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generatePatchMac(i,m,e.map(function(a){return a.valueMac}),k,l));case 16:n=p.sent;d("WALogger").LOG(o(),a,g,d("WASyncdCryptoUtils").arrayBufferToHexPadded(k),d("WASyncdCryptoUtils").arrayBufferToHexPadded(l),d("WASyncdCryptoUtils").arrayBufferToHexPadded(m),d("WASyncdCryptoUtils").arrayBufferToHexPadded(n)).devConsole("\n  --- DEV ONLY ---\n  snapshotMacKey: "+d("WASyncdCryptoUtils").arrayBufferToHexPadded(j)+"\n  patchMacKey: "+d("WASyncdCryptoUtils").arrayBufferToHexPadded(i));return p.abrupt("return",{snapshotMac:m,patchMac:n});case 19:case"end":return p.stop()}},null,this)}function G(a,c,e){var f,g,h,i,j,k,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:o=function(a){return e==null?b("Promise").resolve(null):e(a)};p.next=3;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionLtHashInTransaction(a));case 3:f=p.sent;p.next=6;return b("regeneratorRuntime").awrap(I(c.map(function(a){return a.indexMac})));case 6:g=p.sent;h=new Map();i=new Map();j=new Map();p.next=12;return b("regeneratorRuntime").awrap(d("WAPromiseEach").promiseEach(c,function(c){var e,f,k,l,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:e=c.indexMac,f=c.valueMac,k=c.operation;l=C.decode(e);p=g.get(l);if(!p){t.next=7;break}k===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE?i.set(d("WASyncdCryptoUtils").arrayBufferToHexPadded(e),p):j.set(d("WASyncdCryptoUtils").arrayBufferToHexPadded(e),p);t.next=12;break;case 7:if(!(k===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE)){t.next=12;break}t.next=10;return b("regeneratorRuntime").awrap(o(e));case 10:q=t.sent,q!=null?(i.set(d("WASyncdCryptoUtils").arrayBufferToHexPadded(e),q),d("WALogger").WARN(n(),a,(r=d("WABaseGlobals").getConfig().primaryPlatform())!=null?r:"[empty]",d("WASyncdCryptoUtils").arrayBufferToHexPadded(e).slice(-16)).tags("non-sad").sendLogs("syncd: fallback query")):(d("WASyncdMetrics").reportSyncdCriticalEvent(d("WASyncdMetrics").SyncdCriticalEventType.MISSING_MUTATION_TO_REMOVE,a),d("WALogger").WARN(m(),a,(s=d("WABaseGlobals").getConfig().primaryPlatform())!=null?s:"[empty]",d("WASyncdCryptoUtils").arrayBufferToHexPadded(e).slice(-16)));case 12:k===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET&&h.set(d("WASyncdCryptoUtils").arrayBufferToHexPadded(e),f);case 13:case"end":return t.stop()}},null,this)}));case 12:p.next=14;return b("regeneratorRuntime").awrap(d("WACryptoLtHash").LT_HASH_ANTI_TAMPERING.subtractThenAdd(f,Array.from(h.values()),Array.from(i.values()).concat(Array.from(j.values()))));case 14:k=p.sent;d("WALogger").LOG(l(),a,d("WASyncdCryptoUtils").arrayBufferToHexPadded(f),Array.from(h.entries()).map(function(a){var b=a[0];a=a[1];return B(b,a)}).join("\n\t"),Array.from(i.entries()).map(function(a){var b=a[0];a=a[1];return B(b,a)}).join("\n\t"),Array.from(j.entries()).map(function(a){var b=a[0];a=a[1];return B(b,a)}).join("\n\t"),d("WASyncdCryptoUtils").arrayBufferToHexPadded(k));return p.abrupt("return",k);case 17:case"end":return p.stop()}},null,this)}function f(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,CollectionVersionStore:!0},function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.SyncActionStore,d=a.CollectionVersionStore;f.next=3;return b("regeneratorRuntime").awrap(d.getAll());case 3:e=f.sent;return f.abrupt("return",b("Promise").all(e.map(function(a){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d=a.collection,e=a.ltHash;g.next=3;return b("regeneratorRuntime").awrap(c.getByCollections([d]));case 3:f=g.sent;return g.abrupt("return",{collection:d,ltHash:e,mutations:f});case 5:case"end":return g.stop()}},null,this)})));case 5:case"end":return f.stop()}},null,this)}));case 2:a=c.sent;c.next=5;return b("regeneratorRuntime").awrap(b("Promise").all(a.map(function(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=a.collection,e=a.ltHash,f=a.mutations;h.next=3;return b("regeneratorRuntime").awrap(H(f));case 3:g=h.sent,d("WACryptoUtils").arrayBuffersEqual(e,g)||d("WALogger").ERROR(k(),c).verbose().sendLogs("LtHash check failed");case 5:case"end":return h.stop()}},null,this)})));case 5:case"end":return c.stop()}},null,this)}function H(a){a=new Map(a.map(function(a){return[d("WASyncdCryptoUtils").arrayBufferToHexPadded(a.indexMac),a.valueMac]}));return d("WACryptoLtHash").LT_HASH_ANTI_TAMPERING.add(d("WACryptoLtHash").EMPTY_LT_HASH,Array.from(a.values()))}function I(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByIndexMacsInTransaction(a));case 2:c=e.sent;return e.abrupt("return",new Map(c.map(function(a){return[C.decode(a.indexMac),a.valueMac]})));case 4:case"end":return e.stop()}},null,this)}function J(a,c){var e,f,g,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:c===void 0&&(c=!0);e=c?20:1;d("WALogger").LOG(j(),a);m.next=5;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,CollectionVersionStore:!0},function(c){var d=c.SyncActionStore;c=c.CollectionVersionStore;return b("Promise").all([c.get(a).then(function(a){return a==null?void 0:a.version}),d.getByCollections([a])])}));case 5:f=m.sent;g=f[0];k=f[1];d("WALogger").LOG(i(),a,g,k.length);if(!(c&&k.length>100)){m.next=11;break}return m.abrupt("return",k);case 11:l=k.reduce(function(a,b,d){d%e===0&&a.push("");a[a.length-1]+=B(b.indexMac,b.valueMac,c)+" | ";return a},[]);l.forEach(function(a){return d("WALogger").LOG(h(),a)});return m.abrupt("return",k);case 14:case"end":return m.stop()}},null,this)}g.computeLtHashAndValidateSnapshot=a;g.computeLtHashAndValidatePatch=c;g.computeOutgoingSnapshotAndPatchMacs=e;g.computeLtHash=G;g.checkLtHash=f;g.logMacsInSnapshot=J}),98);
__d("WASyncdCollectionHandlerTypesConverter",["WAServerSync.pb","WASyncAction.pb","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){function h(a){a=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,a);return d("encodeProtobuf").encodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,{value:a}).readBuffer()}function a(a,b){return a.map(function(a){var c=h(a.binarySyncAction);return{index:a.index,action:a.action,binarySyncData:c,actionState:b,version:a.version,keyId:a.keyId,indexMac:a.indexMac,valueMac:a.valueMac,collection:a.collection,timestamp:a.timestamp}})}function b(a,b,c,d,e){return{index:a.index,binarySyncData:a.binarySyncData,version:a.version,keyId:a.keyId,indexMac:a.indexMac,valueMac:a.valueMac,collection:a.collection,timestamp:a.timestamp,action:c,actionState:b,modelId:d,modelType:e!=null?e:void 0}}function c(a){return a.map(function(a){return{collection:a.collection,index:a.index,action:a.action,indexMac:a.indexMac,keyId:a.keyId,operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,binarySyncData:a.binarySyncData,valueMac:a.valueMac,version:a.version}})}g.syncActionToSyncData=h;g.encryptedUploadMutationsToSyncActions=a;g.setMutationToSyncAction=b;g.syncActionsToDecryptedMutation=c}),98);
__d("WASyncdCollectionUtils",["WASyncdConst"],(function(a,b,c,d,e,f,g){function a(a){return a==null}function b(a){switch(a){case d("WASyncdConst").CollectionName.CriticalBlock:return!0;case d("WASyncdConst").CollectionName.CriticalUnblockLow:return!0;case d("WASyncdConst").CollectionName.Regular:return!1;case d("WASyncdConst").CollectionName.RegularHigh:return!1;case d("WASyncdConst").CollectionName.RegularLow:return!1}}g.isBootstrap=a;g.isCriticalCollection=b}),98);
__d("WASyncdDecode",["WAServerSync.pb","WASyncAction.pb","WASyncdError","WASyncdMetricFatalError","decodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a,b){try{return d("decodeProtobuf").decodeProtobuf(d("WAServerSync.pb").ExternalBlobReferenceSpec,b)}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("external blob reference protobuf deserialization failed")}}function b(a,b){try{return d("decodeProtobuf").decodeProtobuf(d("WAServerSync.pb").SyncdSnapshotSpec,b)}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("snapshot protobuf deserialization failed")}}function c(a,b){try{return d("decodeProtobuf").decodeProtobuf(d("WAServerSync.pb").SyncdPatchSpec,b)}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.PATCH_PROTOBUF_DESERIALIZATION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("patch protobuf deserialization failed")}}function e(a,b){try{return d("decodeProtobuf").decodeProtobuf(d("WAServerSync.pb").SyncdMutationsSpec,b)}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("mutations protobuf deserialization failed")}}function f(a,b){try{return d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,b)}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("action data protobuf deserialization failed")}}g.decodeExternalBlobReference=a;g.decodeSyncdSnapshot=b;g.decodeSyncdPatch=c;g.decodeSyncdMutations=e;g.decodeSyncActionData=f}),98);
__d("WASyncdValidateSyncActionProtobuf",["WASyncdError","WASyncdMetricFatalError"],(function(a,b,c,d,e,f,g){a=function(){function a(){}a.validateSyncActionDataProtobuf=function(a,b){var c=b.index,e=b.value,f=b.padding;b=b.version;if(!c){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_INDEX,a);throw new(d("WASyncdError").SyncdFatalError)("missing action index")}if(b==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_VERSION,a);throw new(d("WASyncdError").SyncdFatalError)("missing action version")}return{index:c,value:e,padding:f,version:b}};return a}();g["default"]=a}),98);
__d("WASyncdDecryptMutations",["Promise","WACryptoUtils","WAServerSync.pb","WASyncdCrypto","WASyncdCryptoConst","WASyncdCryptoUtils","WASyncdDecode","WASyncdError","WASyncdKeyCache","WASyncdMetricFatalError","WASyncdValidateSyncActionProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new TextDecoder();function a(a,c){return b("Promise").all(c.records.map(function(b){return i(a,d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,b)}))}function e(a,c){return b("Promise").all(c.mutations.map(function(b){return i(a,b.operation,b.record)}))}function i(a,c,e){var f,g,i,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:f=e.keyId.id;q.next=3;return b("regeneratorRuntime").awrap(d("WASyncdKeyCache").getKeyData(f));case 3:g=q.sent;if(g){q.next=8;break}if(!(c===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE)){q.next=7;break}throw new(d("WASyncdError").SyncdFatalError)("no key data for remove mutations");case 7:throw new(d("WASyncdError").SyncdMissingKeyError)();case 8:q.next=10;return b("regeneratorRuntime").awrap(j(a,f,g,c,e));case 10:i=q.sent;k=i.syncAction;l=i.indexMac;m=i.valueMac;n=i.indexValueBinary;o=k.index,p=k.version;return q.abrupt("return",{index:h.decode(o),action:null,version:p,keyId:f,operation:c,indexMac:l,valueMac:m,collection:a,binarySyncData:n});case 17:case"end":return q.stop()}},null,this)}function j(a,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:i=h.index.blob;j=h.value.blob;k=d("WASyncdCrypto").valueMacFromIndexAndValueCipherText(j);l=d("WASyncdCryptoUtils").split(j,d("WASyncdCryptoConst").IV_LENGTH,j.byteLength-d("WASyncdCryptoConst").MAC_LENGTH-d("WASyncdCryptoConst").IV_LENGTH);m=l[0];n=l[1];o=l[2];A.next=9;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateEncryptionKeys(f));case 9:p=A.sent;q=p.indexKey,r=p.valueEncryptionKey,s=p.valueMacKey;t=d("WASyncdCryptoUtils").combine([m,n]);u=d("WASyncdCrypto").generateAssociatedData(g,e);A.next=15;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateMac(u,t,s));case 15:v=A.sent;if(d("WACryptoUtils").arrayBuffersEqual(o,v)){A.next=19;break}d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.DECRYPTION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("decryption failure: valueMAC mismatch");case 19:A.next=21;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").decryptCipherText(new Uint8Array(m),r,n));case 21:w=A.sent;x=d("WASyncdDecode").decodeSyncActionData(a,w);y=c("WASyncdValidateSyncActionProtobuf").validateSyncActionDataProtobuf(a,x);A.next=26;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateIndexMac(q,y.index));case 26:z=A.sent;if(d("WACryptoUtils").arrayBuffersEqual(i,z)){A.next=30;break}d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.DECRYPTION_FAILED,a);throw new(d("WASyncdError").SyncdFatalError)("decryption failure: indexMAC mismatch");case 30:return A.abrupt("return",{syncAction:y,indexMac:i,valueMac:k,indexValueBinary:w});case 31:case"end":return A.stop()}},null,this)}g.tryDecryptSnapshot=a;g.tryDecryptPatch=e}),98);
__d("WASyncdGetActionHandler",["WABaseGlobals"],(function(a,b,c,d,e,f,g){var h=null,i=null;function a(a){h==null&&(h=new Map(d("WABaseGlobals").getConfig().syncdActionHandlers().map(function(a){return[a.action,a]})));return h.get(a)}function b(){i==null&&(i=Math.max.apply(Math,d("WABaseGlobals").getConfig().syncdActionHandlers().map(function(a){return a.version})));return i}g.getActionHandler=a;g.maxSupportedVersion=b}),98);
__d("WAAsyncSleep",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){function a(a,c,d){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c===void 0&&(c=200);d===void 0&&(d=200);if(!(a>0&&a%c===0)){e.next=5;break}e.next=5;return b("regeneratorRuntime").awrap(g(d));case 5:case"end":return e.stop()}},null,this)}function g(a){return new(b("Promise"))(function(b){return setTimeout(b,a)})}f.asyncSleepAfterGivenLoopIteration=a;f.asyncSleep=g}),66);
__d("WASyncdStoreMissingKeys",["Promise","WAAsyncSleep","WABaseGlobals","WAGetMissingKey","WAGetSyncKey","WALogger","WASyncdCryptoUtils","WASyncdMetricFatalError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: missing key on all clients"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: expired keys: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: actually missing keys: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing keys: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: all keys: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: check if has expired keys"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: timeout while waiting for missing key"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _timeoutWhileWaitingForMissingKey: no expired keys"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _timeoutWhileWaitingForMissingKey"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: earliest missing key: ",", timestamp=",", timeoutMs=",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _setMissingKeyTimeout: missing keys: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys: finish updating missing keys from device ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys: begin updating missing keys from device ","\n      \tmissingKeys: [","]"],["syncd: updateMissingKeys: begin updating missing keys from device ","\n      \\tmissingKeys: [","]"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeys from device ","\n    \tkeys with keyData: ","\n    \tkeys without keyData: ",""],["syncd: updateMissingKeys from device ","\n    \\tkeys with keyData: ","\n    \\tkeys without keyData: ",""]);u=function(){return a};return a}var v;function a(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().getDeviceFingerprint());case 2:a=c.sent.deviceIndexes;return c.abrupt("return",d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=c.MissingKeyStore;f.next=3;return b("regeneratorRuntime").awrap(d.getAll());case 3:e=f.sent;if(!(e.length===0)){f.next=6;break}return f.abrupt("return",b("Promise").resolve());case 6:e.forEach(function(b){var c=b.deviceResponses;c.forEach(function(c,d){a.includes(d)||b.deviceResponses["delete"](d)})});f.next=9;return b("regeneratorRuntime").awrap(d.bulkUpdate(e));case 9:f.next=11;return b("regeneratorRuntime").awrap(A({MissingKeyStore:d}));case 11:case"end":return f.stop()}},null,this)}));case 4:case"end":return c.stop()}},null,this)}function c(a,c){var e=[],f=[];a.forEach(function(a){var b=a.keyData;a=d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId);b?e.push(a):f.push(a)});d("WALogger").LOG(u(),c,e,f);return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(a){var g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:g=a.MissingKeyStore;if(!(e.length>0)){i.next=6;break}i.next=4;return b("regeneratorRuntime").awrap(g.bulkRemove(e));case 4:i.next=6;return b("regeneratorRuntime").awrap(x({MissingKeyStore:g}));case 6:if(!(f.length>0)){i.next=18;break}i.next=9;return b("regeneratorRuntime").awrap(g.bulkGet(f));case 9:i.t0=Boolean;h=i.sent.filter(i.t0);h.forEach(function(a){return a.deviceResponses.set(c,!1)});d("WALogger").LOG(t(),c,f);i.next=15;return b("regeneratorRuntime").awrap(g.bulkUpdate(h));case 15:d("WALogger").LOG(s(),c);i.next=18;return b("regeneratorRuntime").awrap(A({MissingKeyStore:g}));case 18:case"end":return i.stop()}},null,this)})}function w(){return d("WABaseGlobals").runInTransaction({MissingKeyStore:!0},function(a){a=a.MissingKeyStore;return x({MissingKeyStore:a})})}function x(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=a.MissingKeyStore;clearTimeout(v);v=null;h.next=5;return b("regeneratorRuntime").awrap(c.getAll());case 5:e=h.sent;if(!(e.length===0)){h.next=8;break}return h.abrupt("return");case 8:d("WALogger").LOG(r(),e.map(function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)})),f=e.reduce(function(a,b){return a.timestamp<b.timestamp?a:b}),g=d("WABaseGlobals").getConfig().syncdWaitForKeyTimeoutDays()*d("WATimeUtils").DAY_MILLISECONDS-(-f.timestamp+d("WATimeUtils").unixTimeMs()),d("WALogger").LOG(q(),d("WASyncdCryptoUtils").syncKeyIdToHex(f.keyId),f.timestamp,g),v=setTimeout(y,g);case 13:case"end":return h.stop()}},null,this)}function y(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:d("WALogger").LOG(p());a.next=3;return b("regeneratorRuntime").awrap(z());case 3:if(a.sent){a.next=6;break}d("WALogger").LOG(o());return a.abrupt("return");case 6:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY),d("WALogger").ERROR(n()).sendLogs("syncd fatal error: timeout while waiting for missing key"),d("WABaseGlobals").getDbImpls().handleSyncdFatal();case 9:case"end":return a.stop()}},null,this)}function z(){var a,c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").LOG(m());g.next=3;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getAllSyncKeysInTransaction());case 3:g.t0=function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)};a=g.sent.map(g.t0);d("WALogger").LOG(l(),a);g.next=8;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").getAllMissingKeysInTransaction());case 8:c=g.sent;d("WALogger").LOG(k(),c.map(function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)}));e=c.filter(function(b){return!a.includes(b.keyHex)});d("WALogger").LOG(j(),c.map(function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)}));f=e.filter(function(a){return d("WABaseGlobals").getConfig().syncdWaitForKeyTimeoutDays()*d("WATimeUtils").DAY_MILLISECONDS<d("WATimeUtils").unixTimeMs()-a.timestamp});d("WALogger").LOG(i(),f.map(function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)}));return g.abrupt("return",f.length>0);case 15:case"end":return g.stop()}},null,this)}function A(a){var c,e,f,g,i,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:c=a.MissingKeyStore;r.next=3;return b("regeneratorRuntime").awrap(c.getAll());case 3:e=r.sent,(f=e,g=Array.isArray(f),i=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 5:if(!g){r.next=11;break}if(!(i>=f.length)){r.next=8;break}return r.abrupt("break",43);case 8:j=f[i++];r.next=15;break;case 11:i=f.next();if(!i.done){r.next=14;break}return r.abrupt("break",43);case 14:j=i.value;case 15:k=j,l=!0,(m=k.deviceResponses.values(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 18:if(!n){r.next=24;break}if(!(o>=m.length)){r.next=21;break}return r.abrupt("break",34);case 21:p=m[o++];r.next=28;break;case 24:o=m.next();if(!o.done){r.next=27;break}return r.abrupt("break",34);case 27:p=o.value;case 28:q=p;if(!(q==null)){r.next=32;break}l=!1;return r.abrupt("break",34);case 32:r.next=18;break;case 34:if(!l){r.next=41;break}d("WALogger").ERROR(h()).sendLogs("syncd: fatal error: missing key on all clients");d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_KEY_ON_ALL_CLIENTS);r.next=39;return b("regeneratorRuntime").awrap(d("WAAsyncSleep").asyncSleep(5e3));case 39:d("WABaseGlobals").getDbImpls().handleSyncdFatal();return r.abrupt("return");case 41:r.next=5;break;case 43:case"end":return r.stop()}},null,this)}function e(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=function(){var a=new Map();c.forEach(function(b){return a.set(b,null)});return a};f=a.map(function(a){return{keyHex:d("WASyncdCryptoUtils").syncKeyIdToHex(a),keyId:a,timestamp:d("WATimeUtils").unixTimeMs(),deviceResponses:e()}});g.next=4;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").bulkUpdateMissingKeysInTransaction(f));case 4:g.next=6;return b("regeneratorRuntime").awrap(w());case 6:case"end":return g.stop()}},null,this)}g.updateMissingKeyDevices=a;g.updateMissingKeys=c;g.setMissingKeyTimeoutInTransaction=w;g.hasExpiredKeys=z;g.addMissingKeys=e}),98);
__d("WASyncdHandleMissingKeys",["Promise","WABaseGlobals","WAGetMissingKey","WAGetSyncKey","WALogger","WASyncdCryptoUtils","WASyncdError","WASyncdKeyTypes","WASyncdStoreMissingKeys","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: requestAllMissingKeys: missing keys: [","]"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _handleMissingKeys: missing keys after filter: [","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _handleMissingKeys: missing keys [","]"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _handleMissingKeys: skipping due to resume from restart in progress"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection ","'s patches has missing keys ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: handleMissingKeysInPatches: missing key: keyId: ",", patch version: ",", patch device id: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection ","'s snapshot has missing keys ",""]);n=function(){return a};return a}var o=d("WASyncdKeyTypes").toSyncKeyId(new ArrayBuffer(0));function a(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=new Set();g.next=3;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getAllSyncKeysInTransaction());case 3:g.t0=function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)};f=g.sent.map(g.t0);c.records.forEach(function(a){a=a.keyId.id;if(d("WASyncdCryptoUtils").syncKeyIdsEqual(a,o))throw new(d("WASyncdError").SyncdFatalError)("snapshot has empty key");a=d("WASyncdCryptoUtils").syncKeyIdToHex(a);f.includes(a)||e.add(a)});d("WALogger").LOG(n(),a,Array.from(e));g.next=9;return b("regeneratorRuntime").awrap(p(e));case 9:case"end":return g.stop()}},null,this)}function c(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:e=new Set();g.next=3;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getAllSyncKeysInTransaction());case 3:g.t0=function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)};f=g.sent.map(g.t0);c.forEach(function(a){var b=a.keyId.id;if(d("WASyncdCryptoUtils").syncKeyIdsEqual(b,o))throw new(d("WASyncdError").SyncdFatalError)("syncd: patch has empty key. patch device id: ${p.deviceIndex}");b=d("WASyncdCryptoUtils").syncKeyIdToHex(b);f.includes(b)||(d("WALogger").LOG(m(),b,a.version.version,a.deviceIndex),e.add(b))});d("WALogger").LOG(l(),a,Array.from(e));g.next=9;return b("regeneratorRuntime").awrap(p(e));case 9:case"end":return g.stop()}},null,this)}function p(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:if(!(d("WABaseGlobals").getConfig().offlineProcessingState()!=="idle")){l.next=3;break}d("WALogger").LOG(k());return l.abrupt("return");case 3:c=Array.from(a);d("WALogger").LOG(j(),c);l.t0=Set;l.next=8;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").bulkGetMissingKeysInTransaction(c));case 8:l.t1=Boolean;l.t2=function(a){return a.keyHex};l.t3=l.sent.filter(l.t1).map(l.t2);e=new l.t0(l.t3);f=c.filter(function(a){return!e.has(a)});d("WALogger").LOG(i(),f);if(!(f.length===0)){l.next=16;break}return l.abrupt("return",b("Promise").resolve());case 16:g=f.map(function(a){return d("WASyncdKeyTypes").toSyncKeyId(d("WASyncdCryptoUtils").hexToUint8Array(a).buffer)});l.next=19;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().sendSyncdKeyRequest(g));case 19:h=l.sent;l.next=22;return b("regeneratorRuntime").awrap(d("WASyncdStoreMissingKeys").addMissingKeys(g,h));case 22:case"end":return l.stop()}},null,this)}function e(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").getAllMissingKeysInTransaction());case 2:a=c.sent;d("WALogger").LOG(h(),a.map(function(a){return a.keyHex}));if(!(a.length===0)){c.next=6;break}return c.abrupt("return");case 6:c.next=8;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().sendSyncdKeyRequest(a.map(function(a){return a.keyId})));case 8:case"end":return c.stop()}},null,this)}g.handleMissingKeysInSnapshot=a;g.handleMissingKeysInPatches=c;g.requestAllMissingKeys=e}),98);
__d("WASyncdValidateServerSyncProtobuf",["WALongInt","WASyncdError","WASyncdKeyTypes","WASyncdMetricFatalError"],(function(a,b,c,d,e,f,g){a=function(){function a(){}a.validateSnapshotProtobuf=function(b,c){var e=c.version,f=c.records,g=c.mac;c=c.keyId;var h=e==null?void 0:e.version;if(!e||h==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_VERSION,b);throw new(d("WASyncdError").SyncdFatalError)("missing snapshot version")}e=f.map(function(c){return a.validateRecordProtobuf(b,c)});if(!g){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_MAC,b);throw new(d("WASyncdError").SyncdFatalError)("missing snapshot mac")}f=a.validateKeyIdProtobuf(b,c,d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_SNAPSHOT_KEY_ID);return{version:{version:d("WALongInt").numberOrThrowIfTooLarge(h)},records:e,mac:g,keyId:f}};a.validatePatchProtobuf=function(b,c){var e=c.version,f=c.mutations,g=c.externalMutations,h=c.snapshotMac,i=c.patchMac,j=c.keyId,k=c.exitCode;c=c.deviceIndex;var l=e==null?void 0:e.version;if(!e||l==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_VERSION,b);throw new(d("WASyncdError").SyncdFatalError)("missing patch version")}if(f&&f.length>0&&g){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,b);throw new(d("WASyncdError").SyncdFatalError)("patch with both inline and external mutations")}if(!h){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_SNAPSHOT_MAC,b);throw new(d("WASyncdError").SyncdFatalError)("missing patch snapshot mac")}if(!i){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_MAC,b);throw new(d("WASyncdError").SyncdFatalError)("missing patch mac")}e=a.validateKeyIdProtobuf(b,j,d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_PATCH_KEY_ID);if(g){j=a.validateExternalBlobReference(b,g);return{version:{version:d("WALongInt").numberOrThrowIfTooLarge(l)},mutations:void 0,externalMutations:j,snapshotMac:h,patchMac:i,keyId:e,deviceIndex:c}}g=f.map(function(c){return a.validateMutationProtobuf(b,c)});return{version:{version:d("WALongInt").numberOrThrowIfTooLarge(l)},mutations:g,externalMutations:void 0,exitCode:k,snapshotMac:h,patchMac:i,keyId:e,deviceIndex:c}};a.validateExternalBlobReference=function(a,b){var c=b.mediaKey,e=b.directPath,f=b.handle,g=b.fileSizeBytes,h=b.fileSha256;b=b.fileEncSha256;if(!c){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,a);throw new(d("WASyncdError").SyncdFatalError)("missing external blob reference media key")}if(e==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,a);throw new(d("WASyncdError").SyncdFatalError)("missing external blob reference direct path")}if(!h){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,a);throw new(d("WASyncdError").SyncdFatalError)("missing external blob reference file SHA256")}if(!b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,a);throw new(d("WASyncdError").SyncdFatalError)("missing external blob reference file enc SHA256")}return{mediaKey:c,directPath:e,handle:f,fileSizeBytes:g,fileSha256:h,fileEncSha256:b}};a.validateMutationProtobuf=function(b,c){var e=c.operation;c=c.record;if(e==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_OPERATION,b);throw new(d("WASyncdError").SyncdFatalError)("missing mutation operation")}if(!c){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_RECORD,b);throw new(d("WASyncdError").SyncdFatalError)("missing mutation record")}b=a.validateRecordProtobuf(b,c);return{operation:e,record:b}};a.validateRecordProtobuf=function(b,c){var e=c.index,f=c.value;c=c.keyId;var g=e==null?void 0:e.blob,h=f==null?void 0:f.blob;if(!e||!g){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_INDEX,b);throw new(d("WASyncdError").SyncdFatalError)("missing mutation index")}if(!f||!h){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_VALUE,b);throw new(d("WASyncdError").SyncdFatalError)("missing mutation value")}e=a.validateKeyIdProtobuf(b,c,d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_MUTATION_KEY_ID);return{index:{blob:g},value:{blob:h},keyId:e}};a.validateKeyIdProtobuf=function(a,b,c){var e=b==null?void 0:b.id;if(!b||!e){d("WASyncdMetricFatalError").reportSyncdFatalError(c,a);throw new(d("WASyncdError").SyncdFatalError)("missing mutation key id")}return{id:d("WASyncdKeyTypes").toSyncKeyId(e)}};return a}();g["default"]=a}),98);
__d("WASyncdMMSDownload",["WABaseGlobals","WASyncdDecode","WASyncdValidateServerSyncProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().downloadSyncBlob(e,"snapshot",a));case 2:f=h.sent;g=d("WASyncdDecode").decodeSyncdSnapshot(a,f);return h.abrupt("return",c("WASyncdValidateServerSyncProtobuf").validateSnapshotProtobuf(a,g));case 5:case"end":return h.stop()}},null,this)}function e(a,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().downloadSyncBlob(e,"patch",a));case 2:f=h.sent;g=d("WASyncdDecode").decodeSyncdMutations(a,f).mutations;return h.abrupt("return",g.map(function(b){return c("WASyncdValidateServerSyncProtobuf").validateMutationProtobuf(a,b)}));case 5:case"end":return h.stop()}},null,this)}g.downloadSnapshot=a;g.downloadExternalPatch=e}),98);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("toposort-1.0.3",[],(function(a,b,c,d,e,f){"use strict";a={};var g={exports:a};function h(){g.exports=a=function(a){return b(c(a),a)};a.array=b;function b(a,b){var c=a.length,d=new Array(c),e={},f=c;while(f--)e[f]||g(a[f],f,[]);return d;function g(h,f,i){if(i.indexOf(h)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(h));if(!~a.indexOf(h))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(h));if(e[f])return;e[f]=!0;var j=b.filter(function(a){return a[0]===h});if(f=j.length){i=i.concat(h);do{var k=j[--f][1];g(k,a.indexOf(k),i)}while(f)}d[--c]=h}}function c(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];b.indexOf(e[0])<0&&b.push(e[0]);b.indexOf(e[1])<0&&b.push(e[1])}return b}}var i=!1;function j(){i||(i=!0,h());return g.exports}function b(a){switch(a){case void 0:return j()}}e.exports=b}),null);
__d("toposort",["toposort-1.0.3"],(function(a,b,c,d,e,f){e.exports=b("toposort-1.0.3")()}),null);
__d("WASyncdToposortCrossIndex",["WASyncdError","WASyncdMetricFatalError","toposort"],(function(a,b,c,d,e,f,g){var h=new Map();function a(a){i();var b=[],e=[];try{a.forEach(function(c){b.push(c);var d=h.get(c.actionName);if(d==null)return;a.forEach(function(a){a!==c&&d.includes(a.actionName)&&j(a,c)&&(a.timestamp<c.timestamp?e.push([a,c]):e.push([c,a]))})});return c("toposort").array(b,e)}catch(a){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH);throw new(d("WASyncdError").SyncdFatalError)("cyclic mutation dependency in patch")}}function i(){}function b(a,b){h.set(a,b)}function j(a,b){a=a.actionHandler.getChatJidAndMessageKey(a);b=b.actionHandler.getChatJidAndMessageKey(b);return a&&b?a.chatJid===b.chatJid&&(a.messageKey==null||b.messageKey==null||a.messageKey===b.messageKey):!1}g.sort=a;g._setDependency=b}),98);
__d("WASyncdResolveConflict",["Promise","WAGetPendingMutation","WASyncdConst","WASyncdToposortCrossIndex","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(b("Promise").all(a.map(function(a){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=c.get(a.index);if(!d){f.next=8;break}e=a.actionHandler;f.t0=a.index;f.next=6;return b("regeneratorRuntime").awrap(e.resolveConflicts(d,a));case 6:f.t1=f.sent;return f.abrupt("return",{remoteMutationIndex:f.t0,conflictResolutionState:f.t1});case 8:case"end":return f.stop()}},null,this)})));case 2:d=f.sent;e=new Map();d.forEach(function(a){a&&e.set(a.remoteMutationIndex,a.conflictResolutionState)});return f.abrupt("return",e);case 6:case"end":return f.stop()}},null,this)}function a(a,c){var e,f,g,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:e=[];f=[];q.next=4;return b("regeneratorRuntime").awrap(d("WAGetPendingMutation").getSyncPendingMutationsByCollectionInTransaction(a));case 4:g=q.sent;i=new Map(g.map(function(a){return[a.index,a]}));q.next=8;return b("regeneratorRuntime").awrap(h(c,i));case 8:j=q.sent,c.forEach(function(a){var b=j.get(a.index);if(b)switch(b){case d("WASyncdConst").ConflictResolutionState.SkipRemote:break;case d("WASyncdConst").ConflictResolutionState.ApplyRemoteAndDropLocal:e.push(a);f=f.concat(g.filter(function(b){return b.index===a.index}));break;case d("WASyncdConst").ConflictResolutionState.SkipRemoteAndDropLocal:f=f.concat(g.filter(function(b){return b.index===a.index}));break}else e.push(a)}),k=d("WASyncdToposortCrossIndex").sort(e),l=[],m=0;case 13:if(!(m<k.length)){q.next=22;break}n=k[m].actionHandler;q.next=17;return b("regeneratorRuntime").awrap(n.dropMutationDueToCrossIndexConflict(k[m],i));case 17:o=q.sent,o||l.push(k[m]);case 19:m++;q.next=13;break;case 22:p=f.map(function(a){return a.id}).filter(Boolean);return q.abrupt("return",{remoteMutationsToApply:l,pendingMutationsToDrop:p});case 24:case"end":return q.stop()}},null,this)}g.resolveConflict=a}),98);
__d("WASyncdValidateMutations",["WALogger","WALongInt","WAServerSync.pb","WASyncAction.pb","WASyncdConst","WASyncdError","WASyncdMetricFatalError","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["validation not required for local mutations"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: duplicate REMOVE mutation: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: duplicate SET mutation: ",""]);j=function(){return a};return a}function a(a,b){var c=new Set();b.forEach(function(b){b=b.version.version;if(c.has(b)){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.DUPLICATE_PATCH_VERSION_IN_COLLECTION,a);throw new(d("WASyncdError").SyncdFatalError)("duplicate patch version in collection")}c.add(b)})}function b(a,b,c){var e=new Set(),f=new Set();b.forEach(function(b){var g=!1;b.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET&&(e.has(b.index)?(d("WALogger").DEV(j(),b.index),g=!0):e.add(b.index));b.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE&&(f.has(b.index)?(d("WALogger").DEV(i(),b.index),g=!0):f.add(b.index));if(g)switch(c){case d("WASyncdConst").SyncDataType.Patch:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,a);throw new(d("WASyncdError").SyncdFatalError)("same index for multiple mutations in patch");case d("WASyncdConst").SyncDataType.Snapshot:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,a);throw new(d("WASyncdError").SyncdFatalError)("same index for multiple mutations in snapshot");case d("WASyncdConst").SyncDataType.Local:d("WALogger").WARN(h())}})}function c(a,b){return b.map(function(b){var c=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,b.binarySyncData);c=c.value;if(!c){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_VALUE,a);throw new(d("WASyncdError").SyncdFatalError)("missing action value")}c=d("WALongInt").maybeNumberOrThrowIfTooLarge(c.timestamp);if(c==null){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MISSING_ACTION_TIMESTAMP,a);throw new(d("WASyncdError").SyncdFatalError)("missing action timestamp")}return{index:b.index,version:b.version,keyId:b.keyId,indexMac:b.indexMac,valueMac:b.valueMac,collection:b.collection,binarySyncData:b.binarySyncData,timestamp:c}})}g.validateNoDuplicatePatchVersionInCollection=a;g.validateNoSameIndexForMultipleMutations=b;g.validateAndTypeSetMutations=c}),98);
__d("WASyncdWamAppState",["WAPREList","WAPREMetrics","WAShiftTimer"],(function(a,b,c,d,e,f,g){var h=k(),i=new(d("WAShiftTimer").ShiftTimer)(c),j=1e3*60*5;function a(){i.isScheduled()&&i.forceRunNow()}function k(){return{mutationCount:0,invalidActionCount:0,unsupportedActionCount:0,keyRotationRemoveCount:0,storedMutationCount:0,uploadConflictCount:0,unsetActionCount:0,missingKeyCount:0}}function l(){h=k()}function m(a){return{"int":babelHelpers["extends"]({},a)}}function b(a){var b;return{mutationCount:(a==null?void 0:(b=a["int"])==null?void 0:b.mutationCount)||0,invalidActionCount:(a==null?void 0:(b=a["int"])==null?void 0:b.invalidActionCount)||0,unsupportedActionCount:(a==null?void 0:(b=a["int"])==null?void 0:b.unsupportedActionCount)||0,keyRotationRemoveCount:(a==null?void 0:(b=a["int"])==null?void 0:b.keyRotationRemoveCount)||0,storedMutationCount:(a==null?void 0:(b=a["int"])==null?void 0:b.storedMutationCount)||0,uploadConflictCount:(a==null?void 0:(b=a["int"])==null?void 0:b.uploadConflictCount)||0,unsetActionCount:(a==null?void 0:(b=a["int"])==null?void 0:b.unsetActionCount)||0,missingKeyCount:(a==null?void 0:(b=a["int"])==null?void 0:b.missingKeyCount)||0}}function c(){var a=m(h);l();d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.APP_STATE_SYNC_DAILY).endSuccess(a)}function n(){i.onOrBefore(j)}function e(a){if(a===0)return;h.mutationCount+=a;n()}function f(a){h.invalidActionCount=a,n()}function o(a){h.unsupportedActionCount=a,n()}function p(a){if(a===0)return;h.keyRotationRemoveCount+=a;n()}function q(a){h.storedMutationCount=a,n()}function r(){h.uploadConflictCount++,n()}function s(a){if(a===0)return;h.unsetActionCount+=a;n()}function t(a){h.missingKeyCount=a,n()}g.forceCommitAppState=a;g.clear=l;g.convertAppStateSyncDailyFromAnnotations=b;g.addMutationCount=e;g.setInvalidActionCount=f;g.setUnsupportedActionCount=o;g.addKeyRotationRemoveCount=p;g.setStoredMutationCount=q;g.incConflict=r;g.addUnsetActionCount=s;g.setMissingKeyCount=t}),98);
__d("WASyncdCollectionHandler",["Promise","WABaseGlobals","WACryptoUtils","WAErr","WAGetCollectionVersion","WAGetMissingKey","WAGetSyncAction","WALogger","WALongInt","WANullthrows","WAServerSync.pb","WASyncAction.pb","WASyncdAntiTampering","WASyncdCollectionHandlerTypesConverter","WASyncdCollectionUtils","WASyncdConst","WASyncdDecryptMutations","WASyncdError","WASyncdGetActionHandler","WASyncdHandleMissingKeys","WASyncdMMSDownload","WASyncdMetricCriticalBootstrapStage","WASyncdMetricFatalError","WASyncdMetrics","WASyncdResolveConflict","WASyncdValidateMutations","WASyncdValidateServerSyncProtobuf","WASyncdWamAppState","WATimeUtils","decodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: no handler for action ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: invalid action ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: no handler for action ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: invalid action ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: after apply remove mutations for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: before apply remove mutations for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed apply set mutations for ","  ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: after apply mutation batch for ","  ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: actionStates after apply ",": ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["synd: catching error during _applySetMutations: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: before apply mutation batch for ",". mutations count: ","  ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: applying mutations "," ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed final transaction in _applyPatch for "," v",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: processed "," mutations in patch version "," of collection ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed _applyRemoveMutations for "," v",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed computeLtHashAndValidatePatch for "," v",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: ",": empty patch found"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: applying patch "," v"," from device ","\n    SET count: ","\n    REMOVE count: ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: no patches for collection ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: UI is unblocked, waited for ","ms"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: patches have "," mutations, wait for UI unblock"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed applying snapshot for ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection ","'s snapshot v"," applied"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: processed "," mutations in snapshot of collection "," v",""]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection ","'s snapshot decrypted"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection ","'s snapshot validated"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start validate ","'s snapshot"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: ","'s external patch downloaded"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: download patch for ",""]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: download snapshot for ",""]);K=function(){return a};return a}function L(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end _uploadSuccessful for ",""]);L=function(){return a};return a}function M(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _uploadSuccessful: write to db for ",""]);M=function(){return a};return a}function N(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: _uploadSuccessful: unexpected server version (",") after patch upload, expected ",""]);N=function(){return a};return a}function O(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: retryable error: "," throws ",""]);O=function(){return a};return a}function P(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: "," throws ",""]);P=function(){return a};return a}function Q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: key error: "," missing keys"]);Q=function(){return a};return a}function R(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: applyAppStateSyncResponse: finished applying "," in ","ms"]);R=function(){return a};return a}function S(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: sync "," but there are no updates"]);S=function(){return a};return a}function T(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," v"," uploaded successfully"]);T=function(){return a};return a}function U(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," patches applied successfully"]);U=function(){return a};return a}function V(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: has missing patches"]);V=function(){return a};return a}function W(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: has missing patches. collection: ",", localVersion: ",",\n           minPatch: ",""]);W=function(){return a};return a}function X(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing keys: [","]"]);X=function(){return a};return a}function Y(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," snapshot and patches applied successfully"]);Y=function(){return a};return a}function aa(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start applying collection ",""]);aa=function(){return a};return a}function ba(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end applyIndividualMutations"]);ba=function(){return a};return a}function ca(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end update db after apply individual mutations for collection ",""]);ca=function(){return a};return a}function da(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end apply individual mutations for collection ",""]);da=function(){return a};return a}function ea(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: apply individual mutations for collection ",""]);ea=function(){return a};return a}function fa(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start applyIndividualMutations"]);fa=function(){return a};return a}var ga=0,ha=new ArrayBuffer(128);function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!(a.length===0)){h.next=2;break}return h.abrupt("return",b("Promise").resolve());case 2:c=a.sort(function(a,b){return a.timestamp-b.timestamp});d("WALogger").LOG(fa());e=d("WASyncdCollectionHandlerTypesConverter").syncActionsToDecryptedMutation(c);f=e.reduce(function(a,b){var c;c=(c=a.get(b.collection))!=null?c:[];c.push(b);a.set(b.collection,c);return a},new Map());g=Array.from(f.keys()).map(function(a){var c,e,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:d("WALogger").LOG(ea(),a);c=f.get(a);if(!(c===void 0)){j.next=4;break}return j.abrupt("return");case 4:j.next=6;return b("regeneratorRuntime").awrap(Z(a,c,d("WASyncdConst").SyncDataType.Local,null));case 6:e=j.sent;g=e.setMutationsToPersist;h=e.pendingMutationsToDrop;i=g.map(function(a){return{action:a.action,actionState:a.actionState,binarySyncData:a.binarySyncData,collection:a.collection,index:a.index,keyId:a.keyId,modelId:a.modelId,modelType:a.modelType,timestamp:a.timestamp,version:a.version}});d("WALogger").LOG(da(),a);j.next=13;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,PendingMutationStore:!0},function(a){var c,d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.SyncActionStore,d=a.PendingMutationStore;e.next=3;return b("regeneratorRuntime").awrap(c.bulkUpdate(i));case 3:e.next=5;return b("regeneratorRuntime").awrap(d.bulkRemove(h));case 5:case"end":return e.stop()}},null,this)}));case 13:d("WALogger").LOG(ca(),a);case 14:case"end":return j.stop()}},null,this)});h.next=9;return b("regeneratorRuntime").awrap(b("Promise").all(g));case 9:d("WALogger").LOG(ba());case 10:case"end":return h.stop()}},null,this)}function e(a,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:f=a.name,g=a.version,h=a.patches,i=a.snapshot,j=a.syncedPendingMutationsId,k=a.syncedEncryptedMutations;d("WALogger").LOG(aa(),f);y.prev=2;e==null?void 0:e.mark("external_mutations_download_start",{patchCount:(l=a.patches)==null?void 0:l.length,snapshotSizeBytes:(m=a.snapshot)==null?void 0:m.fileSizeBytes});y.next=6;return b("regeneratorRuntime").awrap(ja(f,h,i,c));case 6:n=y.sent;o=n[0];p=n[1];e==null?void 0:e.mark("external_mutations_download_end",{patchesWithMutationsCount:p==null?void 0:p.length,snapshotRecordsCount:o==null?void 0:o.records.length});q=performance.now();if(!(o!=null)){y.next=17;break}y.next=14;return b("regeneratorRuntime").awrap(ma(f,o,p,e));case 14:d("WALogger").LOG(Y(),f);y.next=45;break;case 17:if(!(p!=null)){y.next=35;break}r=Math.min.apply(Math,p.map(function(a){return a.version.version}));s=c!=null&&r>c+1&&p.length>0;if(!s){y.next=30;break}y.next=23;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").getAllMissingKeysInTransaction());case 23:t=y.sent;d("WALogger").LOG(X(),t.map(function(a){return a.keyHex+":"+a.timestamp}));d("WALogger").LOG(W(),f,c,r);d("WALogger").ERROR(V()).sendLogs("syncd: has missing patches");if(!d("WABaseGlobals").getConfig().syncdShouldFatalOnMissingPatch()){y.next=30;break}d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.SERVER_DID_NOT_SEND_ALL_PATCHES,f,void 0,(u=c)!=null?u:0);throw new(d("WASyncdError").SyncdFatalError)("syncd: has missing patches");case 30:y.next=32;return b("regeneratorRuntime").awrap(oa(f,p,e));case 32:d("WALogger").LOG(U(),f);y.next=45;break;case 35:if(!(g!=null)){y.next=41;break}y.next=38;return b("regeneratorRuntime").awrap(ia(f,g,j,k));case 38:d("WALogger").LOG(T(),f,g);y.next=45;break;case 41:if(!d("WASyncdCollectionUtils").isBootstrap(c)){y.next=44;break}y.next=44;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").updateCollectionVersionAndLtHashInTransaction(f,ga,ha));case 44:d("WALogger").LOG(S(),f);case 45:v=Math.floor(performance.now()-q);d("WALogger").LOG(R(),f,v);(p||o)&&(d("WASyncdCollectionUtils").isBootstrap(c)&&!d("WASyncdCollectionUtils").isCriticalCollection(f)&&(w=o!=null,d("WASyncdMetrics").reportSyncdBootstrapDataApplied(f,w?d("WASyncdMetrics").SyncdBootstrapDataAppliedSnapshotUsed.SNAPSHOT_USED:d("WASyncdMetrics").SyncdBootstrapDataAppliedSnapshotUsed.SNAPSHOT_NOT_USED,v)));y.next=50;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").logMacsInSnapshot(a.name));case 50:return y.abrupt("return",a);case 53:y.prev=53;y.t0=y["catch"](2);x=y.t0.message;if(!(y.t0 instanceof d("WASyncdError").SyncdMissingKeyError)){y.next=59;break}d("WALogger").WARN(Q(),f);return y.abrupt("return",{name:f,state:d("WASyncdConst").CollectionState.Blocked});case 59:if(!(y.t0 instanceof d("WASyncdError").SyncdFatalError)){y.next=62;break}d("WALogger").ERROR(P(),f,x).sendLogs("syncd: fatal error: "+String(f)+" throws "+x);return y.abrupt("return",{name:f,state:d("WASyncdConst").CollectionState.ErrorFatal});case 62:d("WALogger").WARN(O(),f,x).sendLogs("syncd: retryable error: "+String(f)+" throws "+x);return y.abrupt("return",{name:f,state:d("WASyncdConst").CollectionState.ErrorRetry});case 64:case"end":return y.stop()}},null,this,[[2,53]])}function ia(a,c,e,f){var g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").logMacsInSnapshot(a));case 2:h=f.map(function(a){return{indexMac:a.indexMac,valueMac:a.valueMac,operation:a.operation}});l.next=5;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").computeLtHash(a,h));case 5:i=l.sent;j=d("WASyncdCollectionHandlerTypesConverter").encryptedUploadMutationsToSyncActions(f.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET}),d("WASyncdConst").SyncActionState.Success);l.next=9;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionInTransaction(a).then(function(a){return a==null?void 0:a.version}));case 9:l.t0=g=l.sent;if(!(l.t0!=null)){l.next=14;break}l.t1=g;l.next=15;break;case 14:l.t1=0;case 15:k=l.t1;c!==k+1&&d("WALogger").ERROR(N(),c,k+1).sendLogs("syncd: unexpected server version after patch upload");d("WALogger").LOG(M(),a);l.next=20;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,PendingMutationStore:!0,CollectionVersionStore:!0},function(d){var f,g,h;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:f=d.SyncActionStore,g=d.PendingMutationStore,h=d.CollectionVersionStore;k.next=3;return b("regeneratorRuntime").awrap(f.bulkSet(j));case 3:k.next=5;return b("regeneratorRuntime").awrap(g.bulkRemove(e));case 5:k.next=7;return b("regeneratorRuntime").awrap(h.update(a,{version:c,ltHash:i}));case 7:case"end":return k.stop()}},null,this)}));case 20:d("WALogger").LOG(L(),a);case 21:case"end":return l.stop()}},null,this)}function ja(a,e,f,g){var h,i,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:h=b("Promise").resolve();i=0;j=d("WATimeUtils").unixTimeMs();f!=null&&(l=c("WASyncdValidateServerSyncProtobuf").validateExternalBlobReference(a,f),i+=d("WALongInt").numberOrThrowIfTooLarge((k=l.fileSizeBytes)!=null?k:0),d("WALogger").LOG(K(),a),h=d("WASyncdMMSDownload").downloadSnapshot(a,l));m=b("Promise").resolve();e!=null&&e.length>0&&(n=e.map(function(b){return c("WASyncdValidateServerSyncProtobuf").validatePatchProtobuf(a,b)}),m=b("Promise").all(n.map(function(c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=c.mutations||[];f=c.externalMutations;if(!f){h.next=9;break}d("WALogger").LOG(J(),a);h.next=6;return b("regeneratorRuntime").awrap(d("WASyncdMMSDownload").downloadExternalPatch(a,f));case 6:e=h.sent,d("WALogger").LOG(I(),a),i+=d("WALongInt").numberOrThrowIfTooLarge((g=f.fileSizeBytes)!=null?g:0);case 9:return h.abrupt("return",{mutations:e,version:c.version,snapshotMac:c.snapshotMac,patchMac:c.patchMac,keyId:c.keyId,exitCode:c.exitCode,deviceIndex:c.deviceIndex});case 10:case"end":return h.stop()}},null,this)})));r.prev=6;r.next=9;return b("regeneratorRuntime").awrap(b("Promise").all([h,m]));case 9:q=r.sent;o=q[0];p=q[1];d("WASyncdCollectionUtils").isBootstrap(g)&&d("WASyncdMetrics").reportSyncdBootstrapAppStateDownloadMetric({collection:a,downloadStartTs:j,downloadSize:i,isSuccess:"success"});r.next=19;break;case 15:r.prev=15;r.t0=r["catch"](6);d("WASyncdCollectionUtils").isBootstrap(g)&&d("WASyncdMetrics").reportSyncdBootstrapAppStateDownloadMetric({collection:a,downloadStartTs:j,downloadSize:i,isSuccess:"failure"});throw r.t0;case 19:return r.abrupt("return",[o,p]);case 20:case"end":return r.stop()}},null,this,[[6,15]])}function ka(a){var c=function(c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:a==null?void 0:a.mark("anti_tampering_start",{source:d("WASyncdConst").SyncDataType.Snapshot});g.next=3;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").computeLtHashAndValidateSnapshot(c,e));case 3:f=g.sent;a==null?void 0:a.mark("anti_tampering_end",{source:d("WASyncdConst").SyncDataType.Snapshot});return g.abrupt("return",f);case 6:case"end":return g.stop()}},null,this)},e=function(c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:a==null?void 0:a.mark("decryption_start",{source:d("WASyncdConst").SyncDataType.Snapshot});g.next=3;return b("regeneratorRuntime").awrap(d("WASyncdDecryptMutations").tryDecryptSnapshot(c,e));case 3:f=g.sent;a==null?void 0:a.mark("decryption_end",{source:d("WASyncdConst").SyncDataType.Snapshot});return g.abrupt("return",f);case 6:case"end":return g.stop()}},null,this)};return{measuredComputeLtHashAndValidateSnapshot:c,measuredTryDecryptSnapshot:e}}function la(a){var c=function(c,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:a==null?void 0:a.mark("anti_tampering_start",{source:d("WASyncdConst").SyncDataType.Patch});h.next=3;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").computeLtHashAndValidatePatch(c,e,f));case 3:g=h.sent;a==null?void 0:a.mark("anti_tampering_end",{source:d("WASyncdConst").SyncDataType.Patch});return h.abrupt("return",g);case 6:case"end":return h.stop()}},null,this)},e=function(c,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:a==null?void 0:a.mark("decryption_start",{source:d("WASyncdConst").SyncDataType.Patch});g.next=3;return b("regeneratorRuntime").awrap(d("WASyncdDecryptMutations").tryDecryptPatch(c,e));case 3:f=g.sent;a==null?void 0:a.mark("decryption_end",{source:d("WASyncdConst").SyncDataType.Patch});return g.abrupt("return",f);case 6:case"end":return g.stop()}},null,this)};return{measuredComputeLtHashAndValidatePatch:c,measuredTryDecryptPatch:e}}function ma(a,c,e,f){var g,h,i,j,k,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:p.next=2;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").logMacsInSnapshot(a));case 2:p.prev=2;g=ka(f),h=g.measuredComputeLtHashAndValidateSnapshot,i=g.measuredTryDecryptSnapshot;f==null?void 0:f.mark("apply_start",{source:d("WASyncdConst").SyncDataType.Snapshot,snapshotRecordsCount:c.records.length});d("WALogger").LOG(H(),a);p.next=8;return b("regeneratorRuntime").awrap(h(a,c));case 8:j=p.sent;d("WALogger").LOG(G(),a);p.next=12;return b("regeneratorRuntime").awrap(i(a,c));case 12:k=p.sent;d("WALogger").LOG(F(),a);d("WASyncdWamAppState").addMutationCount(c.records.length);d("WASyncdMetricCriticalBootstrapStage").reportSyncdDecryptedMutations(d("WASyncdMetricCriticalBootstrapStage").SyncdDecryptMutationsType.SNAPSHOT_MUTATIONS,k);d("WASyncdValidateMutations").validateNoSameIndexForMultipleMutations(a,k,d("WASyncdConst").SyncDataType.Snapshot);l=c.version.version;p.next=20;return b("regeneratorRuntime").awrap(Z(a,k,d("WASyncdConst").SyncDataType.Snapshot,f));case 20:m=p.sent;n=m.setMutationsToPersist;o=m.pendingMutationsToDrop;d("WALogger").LOG(E(),k.length,a,l);d("WALogger").LOG(D(),a,l);f==null?void 0:f.mark("update_DB_start",{source:d("WASyncdConst").SyncDataType.Snapshot,setMutationsToPersistCount:n.length,pendingMutationsToDropCount:o.length});p.next=28;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,PendingMutationStore:!0,CollectionVersionStore:!0},function(c){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d=c.SyncActionStore,e=c.PendingMutationStore,f=c.CollectionVersionStore;g.next=3;return b("regeneratorRuntime").awrap(d.bulkSet(n));case 3:g.next=5;return b("regeneratorRuntime").awrap(e.bulkRemove(o));case 5:g.next=7;return b("regeneratorRuntime").awrap(f.update(a,{version:l,ltHash:j}));case 7:case"end":return g.stop()}},null,this)}));case 28:f==null?void 0:f.mark("update_DB_end",{source:d("WASyncdConst").SyncDataType.Snapshot});d("WALogger").LOG(C(),a);f==null?void 0:f.mark("apply_end",{source:d("WASyncdConst").SyncDataType.Snapshot,decryptedMutationsCount:k.length});p.next=39;break;case 33:p.prev=33;p.t0=p["catch"](2);if(!(p.t0 instanceof d("WASyncdError").SyncdMissingKeyError)){p.next=38;break}p.next=38;return b("regeneratorRuntime").awrap(d("WASyncdHandleMissingKeys").handleMissingKeysInSnapshot(a,c));case 38:throw p.t0;case 39:if(!e){p.next=44;break}f==null?void 0:f.mark("apply_start",{source:d("WASyncdConst").SyncDataType.Patch,patchCount:e.length});p.next=43;return b("regeneratorRuntime").awrap(oa(a,e,f));case 43:f==null?void 0:f.mark("apply_end",{source:d("WASyncdConst").SyncDataType.Patch,patchCount:e.length});case 44:case"end":return p.stop()}},null,this,[[2,33]])}function na(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=d("WABaseGlobals").getConfig().syncdMaxMutationsToProcessDuringResume();if(!(a>c)){f.next=7;break}e=Date.now();d("WALogger").LOG(B(),a);f.next=6;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().handleSyncDelayApplyingPatchUntilUIUnblocks());case 6:d("WALogger").LOG(A(),Date.now()-e);case 7:case"end":return f.stop()}},null,this)}function oa(a,c,e){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!(c.length===0)){h.next=3;break}d("WALogger").LOG(z(),a);return h.abrupt("return",b("Promise").resolve());case 3:d("WASyncdValidateMutations").validateNoDuplicatePatchVersionInCollection(a,c);c.sort(function(a,b){return a.version.version>b.version.version?1:-1});h.prev=5;f=c.reduce(function(a,b){return a+b.mutations.length},0);h.next=9;return b("regeneratorRuntime").awrap(na(f));case 9:g=0;case 10:if(!(g<c.length)){h.next=16;break}h.next=13;return b("regeneratorRuntime").awrap(pa(a,c[g],e));case 13:g++;h.next=10;break;case 16:h.next=24;break;case 18:h.prev=18;h.t0=h["catch"](5);if(!(h.t0 instanceof d("WASyncdError").SyncdMissingKeyError)){h.next=23;break}h.next=23;return b("regeneratorRuntime").awrap(d("WASyncdHandleMissingKeys").handleMissingKeysInPatches(a,c));case 23:throw h.t0;case 24:case"end":return h.stop()}},null,this,[[5,18]])}function pa(a,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,z,A,B;return b("regeneratorRuntime").async(function(C){while(1)switch(C.prev=C.next){case 0:B=function(c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByCollectionsInTransaction([a]));case 2:f.t0=function(a){return d("WACryptoUtils").arrayBuffersEqual(c,a.indexMac)};f.t1=e=f.sent.filter(f.t0).pop();if(!(f.t1==null)){f.next=8;break}f.t2=void 0;f.next=9;break;case 8:f.t2=e.valueMac;case 9:return f.abrupt("return",f.t2);case 10:case"end":return f.stop()}},null,this)};C.next=3;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").logMacsInSnapshot(a));case 3:if(!c.exitCode){C.next=14;break}g=c.exitCode.code;C.t0=g;C.next=C.t0===100?8:C.t0===101?10:12;break;case 8:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_MISSING_DATA,a);return C.abrupt("break",13);case 10:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_DESERIALIZATION_ERROR,a);return C.abrupt("break",13);case 12:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.TERMINAL_PATCH_UNKNOWN,a);case 13:throw new(d("WASyncdError").SyncdFatalError)("received terminal patch with exit code:  "+String(g)+" text: "+String((f=c.exitCode)==null?void 0:f.text)+"  ");case 14:C.next=16;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().handleSyncBeforeApplyPatch(c));case 16:h=c.mutations.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET}).length;i=c.mutations.length-h;d("WALogger").LOG(y(),a,c.version.version,c.deviceIndex,h,i);h===0&&i===0&&d("WALogger").WARN(x(),a).sendLogs("syncd: "+a+": empty patch found");j=la(e),k=j.measuredComputeLtHashAndValidatePatch,l=j.measuredTryDecryptPatch;C.next=23;return b("regeneratorRuntime").awrap(k(a,c,B));case 23:m=C.sent;d("WALogger").LOG(w(),a,c.version.version);C.next=27;return b("regeneratorRuntime").awrap(l(a,c));case 27:n=C.sent;d("WASyncdMetricCriticalBootstrapStage").reportSyncdDecryptedMutations(d("WASyncdMetricCriticalBootstrapStage").SyncdDecryptMutationsType.PATCH_MUTATIONS,n);d("WASyncdWamAppState").addMutationCount(n.length);d("WASyncdValidateMutations").validateNoSameIndexForMultipleMutations(a,n,d("WASyncdConst").SyncDataType.Patch);o=sa(n);p=o.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE});C.next=35;return b("regeneratorRuntime").awrap(qa(a,p));case 35:d("WALogger").LOG(v(),a,c.version.version);q=o.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET});C.next=39;return b("regeneratorRuntime").awrap(Z(a,q,d("WASyncdConst").SyncDataType.Patch,e));case 39:r=C.sent;s=r.setMutationsToPersist;z=r.pendingMutationsToDrop;d("WALogger").LOG(u(),n.length,c.version.version,a);e==null?void 0:e.mark("update_DB_start",{source:d("WASyncdConst").SyncDataType.Patch,setMutationsToPersistCount:s.length,pendingMutationsToDropCount:z.length});A=c.version.version;C.next=47;return b("regeneratorRuntime").awrap(d("WABaseGlobals").runInTransaction({SyncActionStore:!0,PendingMutationStore:!0,CollectionVersionStore:!0},function(c){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d=c.SyncActionStore,e=c.PendingMutationStore,f=c.CollectionVersionStore;g.next=3;return b("regeneratorRuntime").awrap(d.bulkRemove(p.map(function(a){return a.index})));case 3:g.next=5;return b("regeneratorRuntime").awrap(d.bulkSet(s));case 5:g.next=7;return b("regeneratorRuntime").awrap(e.bulkRemove(z));case 7:g.next=9;return b("regeneratorRuntime").awrap(f.update(a,{version:A,ltHash:m}));case 9:case"end":return g.stop()}},null,this)}));case 47:e==null?void 0:e.mark("update_DB_end",{source:d("WASyncdConst").SyncDataType.Patch}),d("WALogger").LOG(t(),a,c.version.version);case 49:case"end":return C.stop()}},null,this)}function Z(a,e,f,g){var h,i,j,k,l,m,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return b("regeneratorRuntime").async(function(I){while(1)switch(I.prev=I.next){case 0:d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.ABOUT_TO_APPLY_MUTATIONS);h=f===d("WASyncdConst").SyncDataType.Local?" (individual mutations)":"";i=[];j=d("WASyncdValidateMutations").validateAndTypeSetMutations(a,e);k=ta(a,j),l=k.supportedMutations,m=k.unsupportedMutations;m.forEach(function(a){return i.push(d("WASyncdCollectionHandlerTypesConverter").setMutationToSyncAction(a,d("WASyncdConst").SyncActionState.Unsupported))});g==null?void 0:g.mark("conflict_resolution_start",{source:f,collectionName:a,count:l.length});I.next=9;return b("regeneratorRuntime").awrap(d("WASyncdResolveConflict").resolveConflict(a,l));case 9:t=I.sent,u=t.remoteMutationsToApply,v=t.pendingMutationsToDrop,w=l.filter(function(a){return!u.includes(a)}),g==null?void 0:g.mark("conflict_resolution_end",{source:f,collectionName:a,apply:u.length,drop:w.length}),w.forEach(function(a){return i.push(d("WASyncdCollectionHandlerTypesConverter").setMutationToSyncAction(a,d("WASyncdConst").SyncActionState.Skipped,a.actionName))}),g==null?void 0:g.mark("apply_set_mutations_start",{source:f,collectionName:a,count:u.length}),x=ua(u),y=0;case 18:if(!(y<x.length)){I.next=43;break}z=x[y][0].actionHandler;A=x[y].map(function(a){var b;a.binarySyncData?b=c("WANullthrows")(d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,a.binarySyncData).value):b=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,a.binarySyncAction);return{operation:"set",indexParts:a.indexArr,value:b,timestamp:a.timestamp}});B=[];C=!1;I.prev=23;d("WALogger").DEV(s(),JSON.stringify(A,null,2),h);d("WALogger").LOG(r(),a,A.length,h);I.next=28;return b("regeneratorRuntime").awrap(z.applyMutations(A,{setMutationsPendingToPersist:i,allSupportedSetMutations:u}));case 28:B=I.sent;I.next=37;break;case 31:I.prev=31;I.t0=I["catch"](23);if(!(I.t0 instanceof d("WASyncdError").SyncdFatalError||a===d("WASyncdConst").CollectionName.CriticalBlock)){I.next=35;break}throw I.t0;case 35:C=!0,d("WALogger").WARN(q(),I.t0);case 37:d("WALogger").DEV(p(),h,B.slice(0,100).map(function(a){return a.actionState}));d("WALogger").LOG(o(),a,h);for(D=0;D<x[y].length;D++)G=C?d("WASyncdConst").SyncActionState.Failed:B[D].actionState,i.push(d("WASyncdCollectionHandlerTypesConverter").setMutationToSyncAction(x[y][D],G,x[y][D].actionName,C?void 0:(E=B[D].orphanModel)==null?void 0:E.modelId,C?void 0:(F=B[D].orphanModel)==null?void 0:F.modelType));case 40:y++;I.next=18;break;case 43:H=i.reduce(function(a,b){b=b.actionState;a[b]==null&&(a[b]=0);a[b]++;return a},{});g==null?void 0:g.mark("apply_set_mutations_end",babelHelpers["extends"]({source:f,collectionName:a,count:u.length},H));d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.APPLIED_MUTATIONS);d("WALogger").LOG(n(),a,h);return I.abrupt("return",{setMutationsToPersist:i,pendingMutationsToDrop:v});case 48:case"end":return I.stop()}},null,this,[[23,31]])}function qa(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:(e=ra(c),f=e.supportedMutations),g=ua(f),d("WALogger").LOG(m(),a),h=0;case 4:if(!(h<g.length)){j.next=11;break}i=g[h][0].actionHandler;j.next=8;return b("regeneratorRuntime").awrap(i.applyMutations(g[h].map(function(b){return{operation:"remove",indexParts:$(a,b.index)}}),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]}));case 8:h++;j.next=4;break;case 11:d("WALogger").LOG(l(),a);case 12:case"end":return j.stop()}},null,this)}function ra(a){a=a.map(function(a){if(a.version>d("WASyncdGetActionHandler").maxSupportedVersion())return{unsupported:a};var b=$(a.collection,a.index),c=d("WASyncdConst").Actions.cast(b[0]);if(!c){d("WALogger").WARN(k(),b[0]);return{unsupported:a}}var e=d("WASyncdGetActionHandler").getActionHandler(c);if(!e){d("WALogger").WARN(j(),c);return{unsupported:a}}a={collection:a.collection,index:a.index,indexMac:a.indexMac,keyId:a.keyId,binarySyncData:a.binarySyncData,valueMac:a.valueMac,version:a.version,indexArr:b,actionName:c,actionHandler:e};return{supported:a}});var b=[],c=[];a.map(function(a){var d=a.supported;a=a.unsupported;d!=null?b.push(d):a!=null&&c.push(a)});return{supportedMutations:b,unsupportedMutations:c}}function sa(a){var b=a.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET}),c=new Set(b.map(function(a){return a.index}));a=a.filter(function(a){return a.operation===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE});a.forEach(function(a){c.has(a.index)||b.push(a)});return b}function ta(a,b){b=b.map(function(b){if(b.version>d("WASyncdGetActionHandler").maxSupportedVersion())return{unsupported:b};var c=$(a,b.index),e=d("WASyncdConst").Actions.cast(c[0]);if(!e){d("WALogger").WARN(i(),c[0]);return{unsupported:b}}var f=d("WASyncdGetActionHandler").getActionHandler(e);if(!f){d("WALogger").WARN(h(),e);return{unsupported:b}}return{supported:{collection:b.collection,index:b.index,indexMac:b.indexMac,keyId:b.keyId,timestamp:b.timestamp,binarySyncData:b.binarySyncData,valueMac:b.valueMac,version:b.version,indexArr:c,actionName:e,actionHandler:f}}});var c=[],e=[];b.map(function(a){var b=a.supported;a=a.unsupported;b!=null?c.push(b):a!=null&&e.push(a)});return{supportedMutations:c,unsupportedMutations:e}}function ua(a){return a.reduce(function(a,b){a.length!==0&&b.actionName===a[a.length-1][0].actionName?a[a.length-1].push(b):a.push([b]);return a},[])}function $(a,b){try{b=JSON.parse(b);if(b.length<1)throw c("WAErr")();return b}catch(b){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.INVALID_ACTION_INDEX,a);throw new(d("WASyncdError").SyncdFatalError)("invalid action index")}}g.applyIndividualMutations=a;g.applyAppStateSyncResponse=e}),98);
__d("WASyncdOrphan",["Promise","WAGetSyncAction","WALogger","WASyncdCollectionHandler","WASyncdConst","WASyncdDisabled","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end applyAllOrphansAndUnsupported"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start applyAllOrphansAndUnsupported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: finished applying orphans of type "," with ids=",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: applying orphans of type "," with ids=",""]);k=function(){return a};return a}function a(a,c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!d("WASyncdDisabled").isSyncdDisabled()){e.next=2;break}return e.abrupt("return",b("Promise").resolve());case 2:e.next=4;return b("regeneratorRuntime").awrap(b("Promise").all([l(a),m(c)]));case 4:case"end":return e.stop()}},null,this)}function l(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(n(a,d("WASyncdConst").SyncModelType.Msg));case 2:case"end":return c.stop()}},null,this)}function m(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(n(a,d("WASyncdConst").SyncModelType.Chat));case 2:case"end":return c.stop()}},null,this)}function n(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d("WALogger").DEV(k(),c,a);if(!d("WASyncdDisabled").isSyncdDisabled()){f.next=3;break}return f.abrupt("return",b("Promise").resolve());case 3:f.next=5;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByModelInfosInTransaction(a.map(function(a){return[a,c,d("WASyncdConst").SyncActionState.Orphan]})));case 5:e=f.sent;f.next=8;return b("regeneratorRuntime").awrap(d("WASyncdCollectionHandler").applyIndividualMutations(e));case 8:d("WALogger").DEV(j(),c,a);case 9:case"end":return f.stop()}},null,this)}function c(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:if(!d("WASyncdDisabled").isSyncdDisabled()){c.next=2;break}return c.abrupt("return",b("Promise").resolve());case 2:d("WALogger").LOG(i());c.next=5;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByActionStatesInTransaction([d("WASyncdConst").SyncActionState.Orphan,d("WASyncdConst").SyncActionState.Unsupported]));case 5:a=c.sent;c.next=8;return b("regeneratorRuntime").awrap(d("WASyncdCollectionHandler").applyIndividualMutations(a));case 8:d("WALogger").LOG(h());case 9:case"end":return c.stop()}},null,this)}function e(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(n(a,d("WASyncdConst").SyncModelType.Agent));case 2:case"end":return c.stop()}},null,this)}function f(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(n(a,d("WASyncdConst").SyncModelType.ChatAssignment));case 2:case"end":return c.stop()}},null,this)}function o(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(n(a,d("WASyncdConst").SyncModelType.UserStatusMute));case 2:case"end":return c.stop()}},null,this)}g.checkOrphanMutations=a;g.checkOrphanMessages=l;g.checkOrphanChats=m;g.applyAllOrphansAndUnsupported=c;g.checkOrphanAgents=e;g.checkOrphanChatAssignments=f;g.checkOrphanUserStatusMutes=o}),98);
__d("WACryptoSha256",["Promise","WABase64"],(function(a,b,c,d,e,f,g){function h(a){return b("Promise").resolve(self.crypto.subtle.digest({name:"SHA-256"},a))}function a(a){return b("Promise").resolve(h(a).then(d("WABase64").encodeB64))}g.sha256=h;g.sha256Base64=a}),98);
__d("WAMediaCalculateFilehash",["WACryptoSha256"],(function(a,b,c,d,e,f,g){function a(a){return d("WACryptoSha256").sha256Base64(a)}function b(){var a=self.crypto.getRandomValues(new Uint8Array(20));a=a.buffer;return d("WACryptoSha256").sha256Base64(a)}g.calculateFilehash=a;g.getRandomFilehash=b}),98);
__d("WASyncdRequestEncode",["WAServerSync.pb","WASyncAction.pb","WASyncdError","WASyncdMetricFatalError","encodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a){try{return d("encodeProtobuf").encodeProtobuf(d("WAServerSync.pb").SyncdPatchSpec,a).readBuffer()}catch(a){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.PATCH_PROTOBUF_SERIALIZATION_FAILED);throw new(d("WASyncdError").SyncdFatalError)("patch protobuf serialization failed")}}function b(a){try{return d("encodeProtobuf").encodeProtobuf(d("WAServerSync.pb").SyncdMutationsSpec,a).readBuffer()}catch(a){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED);throw new(d("WASyncdError").SyncdFatalError)("mutations protobuf serialization failed")}}function c(a){try{return d("encodeProtobuf").encodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,a).readBuffer()}catch(a){d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED);throw new(d("WASyncdError").SyncdFatalError)("action data protobuf serialization failed")}}g.encodeSyncdPatch=a;g.encodeSyncdMutations=b;g.encodeSyncActionData=c}),98);
__d("WASyncdEncryptMutations",["WAArrayBufferUtils","WAGetSyncAction","WAServerSync.pb","WASyncAction.pb","WASyncdCrypto","WASyncdCryptoConst","WASyncdCryptoUtils","WASyncdError","WASyncdKeyCache","WASyncdMetricFatalError","WASyncdRequestEncode","decodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:e=a.index,f=a.operation;g=c.keyId;i=c.keyData;q.t0=f;q.next=q.t0===d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET?6:q.t0===d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE?7:20;break;case 6:return q.abrupt("break",20);case 7:q.next=9;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionInTransaction(e));case 9:j=q.sent;if(j){q.next=12;break}throw new(d("WASyncdError").SyncdFatalError)("no corresponding set mutation");case 12:k=j.keyId;q.next=15;return b("regeneratorRuntime").awrap(d("WASyncdKeyCache").getKeyData(k));case 15:l=q.sent;if(!(l==null)){q.next=18;break}throw new(d("WASyncdError").SyncdFatalError)("no key data for corresponding mutation");case 18:g=k,i=l;case 20:q.next=22;return b("regeneratorRuntime").awrap(h(a,g,i));case 22:m=q.sent;n=m.indexMac;o=m.indexAndValueCipherText;p=d("WASyncdCrypto").valueMacFromIndexAndValueCipherText(o);return q.abrupt("return",babelHelpers["extends"]({},a,{keyId:g,keyData:i,indexMac:n,indexAndValueCipherText:o,valueMac:p}));case 27:case"end":return q.stop()}},null,this)}function h(a,c,e){var f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return b("regeneratorRuntime").async(function(x){while(1)switch(x.prev=x.next){case 0:x.prev=0;f=a.index,g=a.binarySyncAction,h=a.operation,j=a.version;k=d("WAArrayBufferUtils").stringToArrayBuffer(f);x.next=5;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateEncryptionKeys(e));case 5:l=x.sent;m=l.indexKey,n=l.valueEncryptionKey,o=l.valueMacKey;x.next=9;return b("regeneratorRuntime").awrap(self.crypto.getRandomValues(new Uint8Array(d("WASyncdCryptoConst").IV_LENGTH)));case 9:p=x.sent;q=d("WASyncdCrypto").generatePadding(k.byteLength,g.byteLength);r=i(k,g,q,j);x.next=14;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateCipherText(p,n,r));case 14:s=x.sent;t=d("WASyncdCrypto").generateAssociatedData(h,c);x.next=18;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateMac(t,s,o));case 18:u=x.sent;v=d("WASyncdCryptoUtils").combine([s,u]);x.next=22;return b("regeneratorRuntime").awrap(d("WASyncdCrypto").generateIndexMac(m,k));case 22:w=x.sent;return x.abrupt("return",{indexMac:w,indexAndValueCipherText:v});case 26:x.prev=26;x.t0=x["catch"](0);d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.ENCRYPTION_FAILED);throw new(d("WASyncdError").SyncdFatalError)("encryption failure");case 30:case"end":return x.stop()}},null,this,[[0,26]])}function i(a,b,c,e){return d("WASyncdRequestEncode").encodeSyncActionData({index:a,value:d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,b),padding:c,version:e})}g.encryptMutation=a}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(a,b,c,d,e,f,g){function a(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint16(0)}function h(a){return new DataView(d("WASyncdKeyTypes").fromSyncKeyId(a)).getUint32(2)}function b(a){return h(a)+1}g.getKeyDeviceId=a;g.getKeyEpoch=h;g.generateNewKeyEpoch=b}),98);
__d("WAArrayBuffersConcat",[],(function(a,b,c,d,e,f){function a(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=b.reduce(function(a,b){return a+b.byteLength},0),e=new Uint8Array(d),f=0;b.forEach(function(a){e.set(new Uint8Array(a),f),f+=a.byteLength});return e.buffer}f.concatArrayBuffers=a}),66);
__d("WASyncdRotateKey",["WAArrayBuffersConcat","WABaseGlobals","WAByteArray","WAJids","WASyncdKeyManagementUtils","WASyncdKeyTypes","WATimeUtils","equalsSet"],(function(a,b,c,d,e,f,g){var h=1,i=90;function a(a){a=a.timestamp;var b=Math.min(i,Math.max(h,d("WABaseGlobals").getConfig().syncdKeyMaxUseDays()));b=b*d("WATimeUtils").DAY_MILLISECONDS;a=d("WATimeUtils").unixTimeMs()-a;return a>b}function b(a,b){a=a.fingerprint;var d=b.rawId,e=b.currentIndex;b=b.deviceIndexes;var f=new Set(a.deviceIndexes);for(var g=a.currentIndex+1;g<=e;g++)f.add(g);return a.rawId!==d||!c("equalsSet")(f,new Set(b))}function e(a,b){b=j(b);var c=b.keyId;b=b.keyEpoch;var e=k(),f=d("WATimeUtils").unixTimeMs();return{keyId:c,keyEpoch:b,keyData:e,fingerprint:a,timestamp:f}}function j(a){if(a==null){var b=new Uint8Array(16);self.crypto.getRandomValues(b);b=d("WASyncdKeyManagementUtils").generateNewKeyEpoch(d("WASyncdKeyTypes").toSyncKeyId(b.buffer))}else b=d("WASyncdKeyManagementUtils").generateNewKeyEpoch(a.keyId);a=d("WAJids").interpretAsNumber(d("WAJids").extractDeviceId(d("WABaseGlobals").getMyDeviceJid()));return{keyId:d("WASyncdKeyTypes").toSyncKeyId(new Uint8Array(d("WAArrayBuffersConcat").concatArrayBuffers(d("WAByteArray").intToBytes(2,a).buffer,d("WAByteArray").intToBytes(4,b).buffer)).buffer),keyEpoch:b}}function k(){return d("WASyncdKeyTypes").toSyncKeyData(self.crypto.getRandomValues(new Uint8Array(32)).buffer)}g.hasKeyExpired=a;g.hasADeviceBeenRemoved=b;g.rotateKey=e}),98);
__d("WASyncdKeyManagement",["WABaseGlobals","WAErr","WAGetSyncKey","WALogger","WAPromiseQueue","WASyncdCryptoUtils","WASyncdKeyManagementUtils","WASyncdMetrics","WASyncdRotateKey","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: key rotation due to no key present"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: key rotation due to device removal"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: key rotation due to key expiry"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: stored key rotation key id ",""]);k=function(){return a};return a}var l=new(d("WAPromiseQueue").PromiseQueue)();function a(a){a===void 0&&(a=!0);return l.enqueue(function(){return m(a)})}function m(a){var e,f,g,l,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:a===void 0&&(a=!0);p.next=3;return b("regeneratorRuntime").awrap(n());case 3:e=p.sent;p.next=6;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().getDeviceFingerprint());case 6:f=p.sent;g=!1;l=!1;if(!(e!=null)){p.next=16;break}g=d("WASyncdRotateKey").hasKeyExpired(e);l=d("WASyncdRotateKey").hasADeviceBeenRemoved(e,f);if(!(!a||!g&&!l)){p.next=14;break}return p.abrupt("return",{keyId:e.keyId,keyData:e.keyData});case 14:p.next=18;break;case 16:if(!(!a||d("WABaseGlobals").getConfig().isCompanion())){p.next=18;break}throw c("WAErr")("syncd: No sync key available");case 18:o=d("WASyncdRotateKey").rotateKey(f,e);d("WALogger").LOG(k(),d("WASyncdCryptoUtils").syncKeyIdToHex(o.keyId));p.next=22;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").setSyncKeyInTransaction(o));case 22:p.next=24;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().sendSyncdKeyRotation([o]));case 24:g&&(d("WALogger").LOG(j()),d("WASyncdMetrics").reportSyncdKeyRotationEvent(d("WASyncdMetrics").SyncdKeyRotationEventType.APP_STATE_SYNC_KEY_EXPIRY));l&&(d("WALogger").LOG(i()),d("WASyncdMetrics").reportSyncdKeyRotationEvent(d("WASyncdMetrics").SyncdKeyRotationEventType.DEVICE_DEREGISTERATION));e==null&&(d("WALogger").LOG(h()),d("WASyncdMetrics").reportSyncdKeyRotationEvent(d("WASyncdMetrics").SyncdKeyRotationEventType.NO_KEYS));return p.abrupt("return",m(a));case 28:case"end":return p.stop()}},null,this)}function n(){var a,c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getAllSyncKeysInTransaction());case 2:a=j.sent;if(!(a.length===0)){j.next=5;break}return j.abrupt("return",null);case 5:c=a.map(function(a){return d("WASyncdKeyManagementUtils").getKeyEpoch(a.keyId)});e=Math.max.apply(Math,c);f=a.filter(function(a){return d("WASyncdKeyManagementUtils").getKeyEpoch(a.keyId)===e});g=f.map(function(a){return d("WASyncdKeyManagementUtils").getKeyDeviceId(a.keyId)});h=Math.min.apply(Math,g);i=g.indexOf(h);return j.abrupt("return",f[i]);case 12:case"end":return j.stop()}},null,this)}g.getActiveKey=a;g.getNewestKeyPair=n}),98);
__d("WASyncdMMSUpload",["WABaseGlobals"],(function(a,b,c,d,e,f,g){var h=100,i=2e3,j=10,k=100;function a(a){var b=Math.min(i,Math.max(d("WABaseGlobals").getConfig().syncdInlineMutationsMaxCount(),h));return a.length>b}function b(a){var b=Math.min(k,Math.max(d("WABaseGlobals").getConfig().syncdPatchProtobufMaxSize(),j))*1e3;return a.byteLength>b}g.exceedInlineMutationCount=a;g.exceedPatchProtobufSize=b}),98);
__d("WASyncdRequestBuilderTypesConverter",["WASyncAction.pb","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a,b){return a.map(function(a){var c=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,a.binarySyncData).value;c=d("encodeProtobuf").encodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,c).readBuffer();return{collection:a.collection,index:a.index,binarySyncAction:c,operation:b,version:a.version,timestamp:a.timestamp,action:a.action}})}g.syncActionsToPendingMutations=a}),98);
__d("WASyncdRequestBuilderBuild",["Promise","WABase64","WABaseGlobals","WAGetCollectionVersion","WAGetSyncAction","WAJids","WALogger","WAMediaCalculateFilehash","WAServerSync.pb","WASyncdAntiTampering","WASyncdConst","WASyncdCryptoUtils","WASyncdEncryptMutations","WASyncdKeyManagement","WASyncdKeyManagementUtils","WASyncdKeyTypes","WASyncdMMSUpload","WASyncdRequestBuilderTypesConverter","WASyncdRequestEncode","WASyncdWamAppState","WAWap","regeneratorRuntime","sortBy"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end _buildCollectionNodes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: skipping "," in sync iq patch because initial full sync\n        is incomplete"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start _buildCollectionNodes"]);j=function(){return a};return a}var k=5;function a(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(m(a));case 2:c=j.sent;e=c.collectionNodes;f=c.collectionWithEncryptedMutations;g=c.localCollectionVersions;h=c.collectionsToSkip;i=l(d("WAWap").wap("sync",null,e));return j.abrupt("return",{syncIqNode:i,collectionWithEncryptedMutations:f,localCollectionVersions:g,collectionsToSkip:h});case 9:case"end":return j.stop()}},null,this)}function e(){return l(d("WAWap").wap("delete_all_data",null))}function l(a){return d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:d("WAWap").generateId()},a)}function m(a){var c,e,f,g,k,l,m;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:d("WALogger").LOG(j());c=[];e=function(a,e){var f,g,h,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").getCollectionVersionInTransaction(a).then(function(a){return a==null?void 0:a.version}));case 2:f=m.sent;if(!(e!=null&&e.length>0)){m.next=16;break}if(!(f==null)){m.next=9;break}d("WALogger").LOG(i(),a);c.push(a);m.next=16;break;case 9:m.next=11;return b("regeneratorRuntime").awrap(n(a,e));case 11:j=m.sent,k=j.patchNode,l=j.encryptedMutations,g=k,h=l;case 16:return m.abrupt("return",{collection:a,version:f,patchNode:g,encryptedMutations:h});case 17:case"end":return m.stop()}},null,this)};f=new Map();g=new Map();k=[];a.forEach(function(a,b){return k.push(e(b,a))});o.next=9;return b("regeneratorRuntime").awrap(b("Promise").all(k));case 9:l=o.sent;m=l.map(function(a){var b=a.collection,c=a.version,e=a.patchNode;a=a.encryptedMutations;a&&g.set(b,a);f.set(b,c);return d("WAWap").wap("collection",{name:d("WAWap").CUSTOM_STRING(b),version:d("WAWap").INT((a=c)!=null?a:d("WASyncdConst").DEFAULT_COLLECTION_VERSION),return_snapshot:c===void 0?"true":"false"},e)});d("WALogger").LOG(h());return o.abrupt("return",{collectionNodes:m,collectionWithEncryptedMutations:g,localCollectionVersions:f,collectionsToSkip:c});case 13:case"end":return o.stop()}},null,this)}function n(a,c){var e,f,g,h,i,j,k,l,m,n,v,w,x,y;return b("regeneratorRuntime").async(function(z){while(1)switch(z.prev=z.next){case 0:z.next=2;return b("regeneratorRuntime").awrap(d("WASyncdKeyManagement").getActiveKey(!o(c)));case 2:e=z.sent;z.next=5;return b("regeneratorRuntime").awrap(u(a,c,e));case 5:f=z.sent;g=f.map(function(a){return d("WASyncdEncryptMutations").encryptMutation(a,e)});z.next=9;return b("regeneratorRuntime").awrap(b("Promise").all(g));case 9:h=z.sent;i=h.map(function(a){return{indexMac:a.indexMac,valueMac:a.valueMac,operation:a.operation}});z.next=13;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").computeLtHash(a,i));case 13:j=z.sent;z.next=16;return b("regeneratorRuntime").awrap(d("WASyncdAntiTampering").computeOutgoingSnapshotAndPatchMacs(a,j,h,e.keyData));case 16:k=z.sent;l=k.snapshotMac;m=k.patchMac;n=h.map(function(a){return t(a.keyId,a.operation,a.indexMac,a.indexAndValueCipherText)});v=s(n);w=function(){var a,c;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().uploadSyncExternalPatch(v));case 2:a=f.sent;f.next=5;return b("regeneratorRuntime").awrap(p(a,v));case 5:c=f.sent;return f.abrupt("return",q(c,e.keyId,l,m));case 7:case"end":return f.stop()}},null,this)};if(!d("WASyncdMMSUpload").exceedInlineMutationCount(n)){z.next=28;break}z.next=25;return b("regeneratorRuntime").awrap(w());case 25:x=z.sent;z.next=33;break;case 28:x=r(n,e.keyId,l,m);if(!d("WASyncdMMSUpload").exceedPatchProtobufSize(x)){z.next=33;break}z.next=32;return b("regeneratorRuntime").awrap(w());case 32:x=z.sent;case 33:y=d("WAWap").wap("patch",null,x);return z.abrupt("return",{patchNode:y,encryptedMutations:h});case 35:case"end":return z.stop()}},null,this)}function o(a){return d("WABaseGlobals").getConfig().logoutInProgress()&&a.some(function(a){return JSON.parse(a.index)[0]===d("WASyncdConst").Actions.Sentinel})}function p(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=a.mediaKey,f=a.directPath,g=a.encFilehash,h=a.handle;j.next=3;return b("regeneratorRuntime").awrap(d("WAMediaCalculateFilehash").calculateFilehash(c));case 3:i=j.sent;return j.abrupt("return",{mediaKey:e,directPath:f,handle:h,fileSizeBytes:c.byteLength,fileSha256:d("WABase64").decodeB64(i),fileEncSha256:g});case 5:case"end":return j.stop()}},null,this)}function q(a,b,c,e){var f=d("WABaseGlobals").getConfig().syncdPatchDeviceIndexIncluded()?d("WAJids").extractDeviceId(d("WABaseGlobals").getMyDeviceJid()):void 0;return d("WASyncdRequestEncode").encodeSyncdPatch({keyId:{id:d("WASyncdKeyTypes").fromSyncKeyId(b)},externalMutations:a,snapshotMac:c,patchMac:e,deviceIndex:f})}function r(a,b,c,e){var f=d("WABaseGlobals").getConfig().syncdPatchDeviceIndexIncluded()?d("WAJids").extractDeviceId(d("WABaseGlobals").getMyDeviceJid()):void 0;return d("WASyncdRequestEncode").encodeSyncdPatch({keyId:{id:d("WASyncdKeyTypes").fromSyncKeyId(b)},mutations:a,snapshotMac:c,patchMac:e,deviceIndex:f})}function s(a){return d("WASyncdRequestEncode").encodeSyncdMutations({mutations:a})}function t(a,b,c,e){return{operation:b,record:{keyId:{id:d("WASyncdKeyTypes").fromSyncKeyId(a)},index:{blob:c},value:{blob:e}}}}function u(a,c,e){var f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByCollectionsInTransaction([a]));case 2:f=j.sent;g=c;h=v(f,c,e.keyId);g=g.concat(h);i=w(f,g,e.keyId);d("WASyncdWamAppState").addKeyRotationRemoveCount(i.length);g=g.concat(i);return j.abrupt("return",g);case 10:case"end":return j.stop()}},null,this)}function v(a,b,e){a=a.filter(function(a){return!b.map(function(a){return a.index}).includes(a.index)&&!d("WASyncdCryptoUtils").syncKeyIdsEqual(a.keyId,e)});a=c("sortBy")(a,function(a){return d("WASyncdKeyManagementUtils").getKeyEpoch(a.keyId)});var f=Math.min(k,d("WABaseGlobals").getConfig().syncdAdditionalMutations());a=a.slice(0,f);return d("WASyncdRequestBuilderTypesConverter").syncActionsToPendingMutations(a,d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET)}function w(a,b,c){var e=b.map(function(a){return a.index});b=a.filter(function(a){return e.includes(a.index)});a=b.filter(function(a){return!d("WASyncdCryptoUtils").syncKeyIdsEqual(a.keyId,c)});return d("WASyncdRequestBuilderTypesConverter").syncActionsToPendingMutations(a,d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE)}g.buildSyncIqNode=a;g.buildDeleteAllIqNode=e;g._generateMutationsToUpload=u}),98);
__d("WASyncdRequestBuilderUtils",[],(function(a,b,c,d,e,f){function a(a){return g(a.reverse(),function(a){return a.index}).reverse()}function g(a,b){var c=new Set();return a.filter(function(a){a=b(a);if(c.has(a))return!1;c.add(a);return!0})}f.compactPatch=a}),66);
__d("WASyncdRequestBuilder",["Promise","WAGetPendingMutation","WASyncdRequestBuilderBuild","WASyncdRequestBuilderUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=new Map();e=new Map();g.next=4;return b("regeneratorRuntime").awrap(b("Promise").all(a.map(function(a){var f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(d("WAGetPendingMutation").getSyncPendingMutationsByCollectionInTransaction(a));case 2:f=i.sent,g=f.map(function(a){return a.id}).filter(Boolean),e.set(a,g),h=d("WASyncdRequestBuilderUtils").compactPatch(f),c.set(a,h);case 7:case"end":return i.stop()}},null,this)})));case 4:g.next=6;return b("regeneratorRuntime").awrap(d("WASyncdRequestBuilderBuild").buildSyncIqNode(c));case 6:f=g.sent;return g.abrupt("return",{syncIqNode:f.syncIqNode,collectionWithPendingMutationsIds:e,collectionWithEncryptedMutations:f.collectionWithEncryptedMutations,localCollectionVersions:f.localCollectionVersions,collectionsToSkip:f.collectionsToSkip});case 8:case"end":return g.stop()}},null,this)}g["default"]=a}),98);
__d("WASyncdResponseParser",["WALogger","WASyncdConst","WASyncdDecode","WASyncdError","WASyncdMetricFatalError","WAWapParser"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection "," did not get server error"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection "," got server code has_more_patches"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: retryable error: collection "," throws ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error 404: collection "," throws ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: collection "," throws ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection "," got server error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: successfully parsed collection ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: collection "," has no version, patches or snapshot"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start parsing syncd collections"]);p=function(){return a};return a}a=new(d("WAWapParser").WapParser)("syncResponseParser",function(a){d("WALogger").LOG(p());var b=[];a=a.child("sync");a.mapChildrenWithTag("collection",function(a){var c=babelHelpers["extends"]({},null),e=d("WASyncdConst").CollectionName.cast(a.attrString("name"));if(!e)throw new(d("WASyncdError").SyncdFatalError)("invalid collection name");c.name=e;c.state=q(a,c.name);a.hasAttr("version")&&(c.version=parseInt(a.attrString("version"),10));a.hasChild("patches")&&(c.patches=a.child("patches").mapChildrenWithTag("patch",function(a){return d("WASyncdDecode").decodeSyncdPatch(e,a.contentBytes())}));a.hasChild("snapshot")&&(c.snapshot=d("WASyncdDecode").decodeExternalBlobReference(e,a.child("snapshot").contentBytes()));b.push(c);c.version==null&&c.patches==null&&c.snapshot==null&&d("WALogger").LOG(o(),e);d("WALogger").LOG(n(),e)});return b});function q(a,b){if(a.hasAttr("type")&&a.attrString("type")==="error"){var c=a.child("error"),e=c.attrString("code");c=c.attrString("text");d("WALogger").LOG(m(),b,e);switch(e){case"409":return a.hasAttr("has_more_patches")?d("WASyncdConst").CollectionState.ConflictHasMore:d("WASyncdConst").CollectionState.Conflict;case"400":d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_REQUEST_FOR_COLLECTION);d("WALogger").ERROR(l(),String(b),c).sendLogs("syncd: fatal error 400: collection "+String(b));return d("WASyncdConst").CollectionState.ErrorFatal;case"404":d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_FOUND_FOR_COLLECTION);d("WALogger").ERROR(k(),String(b),c).sendLogs("syncd: fatal error: collection "+String(b));return d("WASyncdConst").CollectionState.ErrorFatal;default:d("WALogger").WARN(j(),String(b),c).sendLogs("syncd: retryable error: collection "+String(b));return d("WASyncdConst").CollectionState.ErrorRetry}}else if(a.hasAttr("has_more_patches")){d("WALogger").LOG(i(),b);return d("WASyncdConst").CollectionState.SuccessHasMore}else{d("WALogger").LOG(h(),b);return d("WASyncdConst").CollectionState.Success}}g.syncResponseParser=a}),98);
__d("WASyncdServerSync",["Promise","WAComms","WAGetPendingMutation","WALogger","WASyncdCollectionHandler","WASyncdConst","WASyncdError","WASyncdMetricCriticalBootstrapStage","WASyncdMetricFatalError","WASyncdMetrics","WASyncdRequestBuilder","WASyncdResponseParser","WASyncdWamAppState","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: received sync response for collections: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: completed network operation for collections: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: sending sync request for collections: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: retryable error: syncd global throws ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: syncd global throws ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end apply collections: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start apply collections: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n\t"," v",""],["\\n\\t"," v",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: local collection versions:"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: deferred local mutation upload for ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: reached max iterations for collections: ",""]);r=function(){return a};return a}var s=5,t=500;function a(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=[],e=[].concat(a),f=0;case 3:if(!(f<s||e.length>0&&f<t)){j.next=16;break}if(!(e.length===0)){j.next=6;break}return j.abrupt("break",16);case 6:j.next=8;return b("regeneratorRuntime").awrap(u(e));case 8:g=j.sent;h=g.doneCollections;i=g.refetchCollections;e=i;c=c.concat(h);f++;j.next=3;break;case 16:e.length>0&&(d("WALogger").ERROR(r(),e).tags("syncd").sendLogs("syncd: max iteration"),c=c.concat(e.map(function(a){return{state:d("WASyncdConst").CollectionState.ErrorRetry,name:a}})));return j.abrupt("return",c);case 18:case"end":return j.stop()}},null,this)}function u(a){var c,e,f,g,h,i,j,r,s,t,u;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:if(!(a.length===0)){w.next=2;break}return w.abrupt("return",{doneCollections:[],refetchCollections:[]});case 2:w.prev=2;w.next=5;return b("regeneratorRuntime").awrap(v(a));case 5:c=w.sent;e=c.collectionDetails;f=c.localCollectionVersions;g=c.collectionsToUpload;g.length>0&&d("WALogger").LOG(q(),g);d("WALogger").LOG(p());f.forEach(function(a,b){d("WALogger").LOG(o(),b,(b=a)!=null?b:"(undefined)}")});h=[];i=[];e.forEach(function(a){switch(a.state){case d("WASyncdConst").CollectionState.ErrorRetry:case d("WASyncdConst").CollectionState.ErrorFatal:case d("WASyncdConst").CollectionState.Blocked:i.push(a);return;default:h.push(a)}(a.state===d("WASyncdConst").CollectionState.Conflict||a.state===d("WASyncdConst").CollectionState.ConflictHasMore)&&d("WASyncdWamAppState").incConflict()});d("WALogger").LOG(n(),h.map(function(a){return a.name}));j=new(d("WASyncdMetrics").SyncdEventFlow)();w.next=19;return b("regeneratorRuntime").awrap(b("Promise").all(h.map(function(a){return d("WASyncdCollectionHandler").applyAppStateSyncResponse(a,f.get(a.name),j)})));case 19:r=w.sent;j.end();d("WALogger").LOG(m(),h.map(function(a){return a.name}));s=[];w.next=25;return b("regeneratorRuntime").awrap(b("Promise").all(r.map(function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(a.state===d("WASyncdConst").CollectionState.Conflict)){e.next=8;break}e.next=3;return b("regeneratorRuntime").awrap(d("WAGetPendingMutation").getSyncPendingMutationsByCollectionInTransaction(a.name));case 3:e.t0=e.sent.length;c=e.t0>0;c?s.push(a.name):(a.state=d("WASyncdConst").CollectionState.Success,i.push(a));e.next=9;break;case 8:a.state===d("WASyncdConst").CollectionState.ConflictHasMore||a.state===d("WASyncdConst").CollectionState.SuccessHasMore||a.state===d("WASyncdConst").CollectionState.Success&&g.some(function(b){return b===a.name})?s.push(a.name):i.push(a);case 9:case"end":return e.stop()}},null,this)})));case 25:return w.abrupt("return",{doneCollections:i,refetchCollections:s});case 28:w.prev=28;w.t0=w["catch"](2);if(!(w.t0 instanceof d("WASyncdError").SyncdFatalError)){w.next=34;break}d("WALogger").ERROR(l(),w.t0.message).sendLogs("syncd: fatal error: syncd global throws "+w.t0.message);t=a.map(function(a){return{state:d("WASyncdConst").CollectionState.ErrorFatal,name:a}});return w.abrupt("return",{doneCollections:t,refetchCollections:[]});case 34:d("WALogger").WARN(k(),w.t0.message).sendLogs("syncd: retryable error: syncd global throws "+w.t0.message);u=a.map(function(a){return{state:d("WASyncdConst").CollectionState.ErrorRetry,name:a,serverBackoff:w.t0.errorBackoff}});return w.abrupt("return",{doneCollections:u,refetchCollections:[]});case 37:case"end":return w.stop()}},null,this,[[2,28]])}function v(a){var e,f,g,k,l,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:s.next=2;return b("regeneratorRuntime").awrap(c("WASyncdRequestBuilder")(a));case 2:e=s.sent;f=e.syncIqNode;g=e.collectionWithPendingMutationsIds;k=e.collectionWithEncryptedMutations;l=e.localCollectionVersions;m=e.collectionsToSkip;d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.REQUEST_BUILT);d("WALogger").LOG(j(),a.map(function(a){var b;return"\n\t"+a+" v"+((b=l.get(a))!=null?b:"(undefined)")+" "+(((b=(b=g.get(a))==null?void 0:b.length)!=null?b:0)>0&&l.get(a)!=null?" with local changes":"")}));s.next=12;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(f,d("WASyncdResponseParser").syncResponseParser));case 12:n=s.sent;d("WALogger").LOG(i(),a);d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.RESPONSE_RECEIVED);if(!n.success){s.next=21;break}d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.RESPONSE_PARSED_VALID);o=n.result;d("WALogger").LOG(h(),o.map(function(a){var b="\n"+a.name;a.version!=null&&(b+="\n\tupdated to version "+a.version);a.snapshot!=null&&(b+="\n\tcontains snapshot");a.patches!=null&&(b+="\n\tcontains "+a.patches.length+" patches");return b}));o.forEach(function(a){var b=g.get(a.name);b&&(a.syncedPendingMutationsId=b);b=k.get(a.name);b&&(a.syncedEncryptedMutations=b)});return s.abrupt("return",{collectionDetails:o,localCollectionVersions:l,collectionsToUpload:m});case 21:p=n.errorCode,q=n.errorText,r=n.errorBackoff;throw w(p,q,r);case 23:case"end":return s.stop()}},null,this)}function w(a,b,c){switch(a){case 400:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_REQUEST_GLOBAL_ERROR);return new(d("WASyncdError").SyncdFatalError)(b);case 404:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_FOUND_GLOBAL_ERROR);return new(d("WASyncdError").SyncdFatalError)(b);case 405:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_BAD_METHOD_GLOBAL_ERROR);return new(d("WASyncdError").SyncdFatalError)(b);case 406:d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR);return new(d("WASyncdError").SyncdFatalError)(b);default:return new(d("WASyncdError").SyncdRetryableError)(b,c)}}g.serverSync=a}),98);
__d("WASyncd",["Promise","WABaseGlobals","WAGetCollectionVersion","WAGetMissingKey","WAGetPendingMutation","WAGetSyncAction","WAGetSyncKey","WALogger","WASyncdCollectionsStateMachine","WASyncdConst","WASyncdCryptoUtils","WASyncdDisabled","WASyncdKeyCache","WASyncdMetricCriticalBootstrapStage","WASyncdMetricFatalError","WASyncdOrphan","WASyncdServerSync","WASyncdWamAppState","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncing pending mutations and blocked collections due to app resume"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncPendingMutationsAndBlockedCollections: [","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncPendingMutationsAndBlockedCollections"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: retry is in flight"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: state machine tick"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal error: expired collections"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: cleanup after handleRetry()"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: exception during handleRetry(): ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: server sync retry successful"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: initiate server sync retry"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: cleanup after sync()"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: exception during sync(): ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: server sync successful"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: initiate server sync"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: no collections to sync"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: dirty collections: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncBlockedCollections:\n    \tmoving blocked collections to dirty: [","]\n    \tadding inflight collections to pending: [","]"],["syncd: syncBlockedCollections:\n    \\tmoving blocked collections to dirty: [","]\n    \\tadding inflight collections to pending: [","]"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: sync blocked collections: ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd:\n        key id: ","\n        key timestamp: ","\n        key device indexes: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," unsupported mutations"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd:\n        "," successful "," mutations\n        "," orphan "," mutations,\n        "," failed "," mutations"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: local version (",")for "," >= server version (","); will not mark for sync."]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: local version (",") for "," less than server version (","); will mark for sync."]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: server version for "," missing; will mark for sync."]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: local version for "," missing; will mark for sync."]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start filter collections: ",""]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: "," state before sync: ",""]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: marking for sync: ",""]);I=function(){return a};return a}var J=1e3,K=1e3*60*60,L=2,M=new Set(),N=new Set(),O,P=!1,Q=0,R=0;function S(a,e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!(e!=null)){g.next=6;break}g.next=3;return b("regeneratorRuntime").awrap(T(a,e));case 3:g.t0=g.sent;g.next=7;break;case 6:g.t0=a;case 7:f=g.t0;d("WALogger").LOG(I(),f);f.forEach(function(a){var b=c("WASyncdCollectionsStateMachine").getCollectionState(a);d("WALogger").LOG(H(),a,b);b===d("WASyncdConst").CollectionSyncState.UpToDate?c("WASyncdCollectionsStateMachine").moveCollectionsToDirty([a]):b===d("WASyncdConst").CollectionSyncState.Dirty&&(N=new Set([].concat(Array.from(N),[a])))});g.next=12;return b("regeneratorRuntime").awrap(c("WASyncdCollectionsStateMachine").persistToDb());case 12:return g.abrupt("return",U());case 13:case"end":return g.stop()}},null,this)}function T(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").LOG(G(),a);g.next=3;return b("regeneratorRuntime").awrap(d("WAGetCollectionVersion").bulkGetCollectionVersionsInTransaction(a));case 3:e=g.sent;f=new Map(a.map(function(a,b){return[a,(a=e[b])==null?void 0:a.version]}));return g.abrupt("return",a.filter(function(a){var b=f.get(a);if(b==null){d("WALogger").LOG(F(),a);return!0}var e=c.get(a);if(e==null){d("WALogger").LOG(E(),a);return!0}if(b<e){d("WALogger").LOG(D(),b,a,e);return!0}d("WALogger").LOG(C(),b,a,e);return!1}));case 6:case"end":return g.stop()}},null,this)}function a(){var a,c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").countSyncActionsInTransaction());case 2:a=g.sent;d("WASyncdWamAppState").setStoredMutationCount(a);g.next=6;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByActionStatesInTransaction([d("WASyncdConst").SyncActionState.Malformed]));case 6:c=g.sent;d("WASyncdWamAppState").setInvalidActionCount(c.length);g.next=10;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getSyncActionsByActionStatesInTransaction([d("WASyncdConst").SyncActionState.Unsupported]));case 10:e=g.sent;d("WASyncdWamAppState").setUnsupportedActionCount(e.length);g.next=14;return b("regeneratorRuntime").awrap(d("WAGetMissingKey").getMissingKeyCountTransaction());case 14:f=g.sent,d("WASyncdWamAppState").setMissingKeyCount(f);case 16:case"end":return g.stop()}},null,this)}function e(){var a,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=7;break;e.next=3;return b("regeneratorRuntime").awrap(d("WAGetSyncAction").getAllSyncActions());case 3:a=e.sent,Array.from(d("WASyncdConst").Actions.members()).forEach(function(b){var c=a.filter(function(a){return a.action!=null&&a.action===b});if(c.length>0){var e=c.filter(function(a){return a.actionState===d("WASyncdConst").SyncActionState.Success||a.actionState===d("WASyncdConst").SyncActionState.Skipped}),f=c.filter(function(a){return a.actionState===d("WASyncdConst").SyncActionState.Orphan});c=c.filter(function(a){return a.actionState===d("WASyncdConst").SyncActionState.Malformed||a.actionState===d("WASyncdConst").SyncActionState.Failed});d("WALogger").DEV(B(),e.length,b,f.length,b,c.length,b)}}),c=a.filter(function(a){return a.actionState===d("WASyncdConst").SyncActionState.Unsupported}),d("WALogger").DEV(A(),c.length);case 7:case"end":return e.stop()}},null,this)}function f(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=5;break;c.next=3;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getAllSyncKeysInTransaction());case 3:a=c.sent,a.forEach(function(a){d("WALogger").DEV(z(),d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId),a.timestamp,a.fingerprint.deviceIndexes)});case 5:case"end":return c.stop()}},null,this)}function e(){var a=c("WASyncdCollectionsStateMachine").getCollectionsInStateBlocked();d("WALogger").LOG(y(),a);c("WASyncdCollectionsStateMachine").moveCollectionsToDirty(a);N=new Set([].concat(Array.from(N),Array.from(M)));d("WALogger").LOG(x(),a,Array.from(M));return U()}function U(){var a,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!d("WASyncdDisabled").isSyncdDisabled()){h.next=2;break}return h.abrupt("return",b("Promise").resolve());case 2:a=c("WASyncdCollectionsStateMachine").getCollectionsInStateDirty();d("WALogger").LOG(w(),a);e=new Set(a.filter(function(a){return!M.has(a)}));if(!(e.size===0)){h.next=8;break}d("WALogger").LOG(v());return h.abrupt("return",b("Promise").resolve());case 8:f=[];h.prev=9;M=new Set([].concat(Array.from(M),Array.from(e)));d("WALogger").LOG(u());h.next=14;return b("regeneratorRuntime").awrap(d("WASyncdServerSync").serverSync(Array.from(e)));case 14:f=h.sent;d("WALogger").LOG(t());g=f.filter(function(a){return a.state===d("WASyncdConst").CollectionState.ErrorRetry});g.length>0&&(R=g[0].serverBackoff||0,Q=0);Z(f);h.next=26;break;case 22:h.prev=22,h.t0=h["catch"](9),d("WALogger").LOG(s(),h.t0),c("WASyncdCollectionsStateMachine").moveCollectionsToFiniteRetry(Array.from(e));case 26:h.prev=26;d("WALogger").LOG(r());c("WASyncdCollectionsStateMachine").persistToDb();M=new Set(Array.from(M).filter(function(a){return!e.has(a)}));Y();h.next=33;return b("regeneratorRuntime").awrap(d("WABaseGlobals").getDbImpls().handleSyncCompleted(f));case 33:return h.finish(26);case 34:case"end":return h.stop()}},null,this,[[9,22,26,34]])}function V(){if(d("WASyncdDisabled").isSyncdDisabled())return;var a=new Set(c("WASyncdCollectionsStateMachine").getCollectionsInStateRetry());if(a.size===0)return;O=setTimeout(function(){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.prev=0;P=!0;Q+=1;d("WALogger").LOG(q());f.next=6;return b("regeneratorRuntime").awrap(d("WASyncdServerSync").serverSync(Array.from(a)));case 6:e=f.sent;d("WALogger").LOG(p());Z(e);f.next=15;break;case 11:f.prev=11,f.t0=f["catch"](0),d("WALogger").LOG(o(),f.t0),c("WASyncdCollectionsStateMachine").moveCollectionsToFiniteRetry(Array.from(a));case 15:f.prev=15;d("WALogger").LOG(n());X();c("WASyncdCollectionsStateMachine").persistToDb();P=!1;Y();return f.finish(15);case 22:case"end":return f.stop()}},null,this,[[0,11,15,22]])},W(Q,R))}function W(a,b){a=Math.pow(L,a)*J;return Math.min(Math.max(a,b),K)}function X(){var a=c("WASyncdCollectionsStateMachine").getExpiredCollections();a.length>0&&(c("WASyncdCollectionsStateMachine").moveCollectionsToFatal(a),d("WALogger").ERROR(m()).sendLogs("syncd: fatal error: expired collections"),d("WASyncdMetricFatalError").reportSyncdFatalError(d("WASyncdMetricFatalError").SyncdFatalErrorType.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D))}function Y(){d("WALogger").LOG(l());c("WASyncdCollectionsStateMachine").getCollectionsInStateDirty().length>0&&(N=new Set(Array.from(N).filter(function(a){return M.has(a)})),U());var a=c("WASyncdCollectionsStateMachine").getCollectionsInStateRetry();if(a.length>0){if(P){d("WALogger").LOG(k());return}O!=null&&clearTimeout(O);N=new Set(Array.from(N).filter(function(b){return!a.includes(b)}));V()}c("WASyncdCollectionsStateMachine").getCollectionsInStateFatal().length>0&&d("WABaseGlobals").getDbImpls().handleSyncdFatal({collections:c("WASyncdCollectionsStateMachine").getCollectionsInStateFatal()})}function Z(a){return a.forEach(function(a){if(a.state===d("WASyncdConst").CollectionState.Success&&!N.has(a.name))return c("WASyncdCollectionsStateMachine").moveCollectionsToUpToDate([a.name]);if(a.state===d("WASyncdConst").CollectionState.ErrorRetry){d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.ENTERED_RETRY_MODE);return c("WASyncdCollectionsStateMachine").moveCollectionsToFiniteRetry([a.name])}if(a.state===d("WASyncdConst").CollectionState.ErrorFatal)return c("WASyncdCollectionsStateMachine").moveCollectionsToFatal([a.name]);if(a.state===d("WASyncdConst").CollectionState.Blocked&&!N.has(a.name))return c("WASyncdCollectionsStateMachine").moveCollectionsToBlocked([a.name])})}function $(){var a,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").LOG(j());g.next=3;return b("regeneratorRuntime").awrap(d("WAGetPendingMutation").getAllSyncPendingMutationsInTransaction());case 3:a=g.sent,e=c("WASyncdCollectionsStateMachine").getCollectionsInStateBlocked(),c("WASyncdCollectionsStateMachine").moveCollectionsToDirty(e),f=a.map(function(a){return a.collection}).concat(e),f.length>0&&(d("WALogger").LOG(i(),f),S(f));case 8:case"end":return g.stop()}},null,this)}function aa(){return c("WASyncdCollectionsStateMachine").loadStatesFromDb().then(function(){return Y()})}function ba(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d("WASyncdOrphan").applyAllOrphansAndUnsupported());case 2:d("WALogger").LOG(h());a.next=5;return b("regeneratorRuntime").awrap($());case 5:case"end":return a.stop()}},null,this)}function ca(){return d("WABaseGlobals").runInTransaction({SyncActionStore:!0,CollectionVersionStore:!0,PendingMutationStore:!0,MissingKeyStore:!0,SyncKeyStore:!0},function(a){var e=a.SyncActionStore,f=a.CollectionVersionStore,g=a.PendingMutationStore,h=a.MissingKeyStore;a=a.SyncKeyStore;return b("Promise").all([e.clear(),f.clear(),g.clear(),h.clear(),a.clear()]).then(function(){c("WASyncdCollectionsStateMachine").clean(),d("WASyncdKeyCache").clearSyncKeysCache()})})}g.markCollectionsForSync=S;g.reportWam=a;g.logKeysInfoInIntern=f;g.syncBlockedCollections=e;g.initializeStateMachine=aa;g.processOnAppResume=ba;g.clearSyncdData=ca}),98);
__d("WAHandleSyncdNotification",["Promise","WAGlobals","WALogger","WASyncd","WASyncdConst","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSyncdNotification with id: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incorrect collection notification"]);i=function(){return a};return a}function a(a){a.assertTag("notification");a.assertAttr("type","server_sync");var b=a.attrTime("t"),c=new Map(),e;a.hasChild("delete_all_data")?e=!0:(e=!1,a.forEachChild(function(a){a.assertTag("collection");var b=d("WASyncdConst").CollectionName.cast(a.maybeAttrString("name"));a=a.attrInt("version",0);b==null||a==null?d("WALogger").ERROR(i()):c.set(b,a)}));return{ts:b,collections:c,deleted:e}}function c(a){var c=a.stanzaId;a=a.notification;var e=a.collections,f=a.deleted;d("WALogger").LOG(h(),c);function g(){return b("Promise").resolve([d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(c),"class":"notification",to:d("WAWap").S_WHATSAPP_NET,type:"server_sync"})])}function i(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!f){a.next=5;break}a.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().handleSyncdFatal({fromServer:!0}));case 3:a.next=7;break;case 5:a.next=7;return b("regeneratorRuntime").awrap(d("WASyncd").markCollectionsForSync(Array.from(e.keys()),e));case 7:return a.abrupt("return",{persist:function(){return b("Promise").resolve({followUp:g})}});case 8:case"end":return a.stop()}},null,this)}return{process:i}}g.parseSyncdNotification=a;g.handleSyncdNotification=c}),98);
__d("WAHandleThreadNotification",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("notification");a.assertAttr("type","fbid:thread");var b=a.attrTime("t");a=a.child("thread_actions");var c,e=a.attrString("thread_id");e.endsWith("@g.us")?c=d("WAJids").toGroupJid(e):c=d("WAGlobals").getJidUtilsApi().toUserJid(e);e=a.mapChildren(function(a){var b=a.tag();if(b==="folder")return{type:"folder",folderId:a.maybeAttrInt("folder_id")};else if(b==="connected")return{type:"connected"};else return{type:"unknown"}});return{chatJid:c,actions:e,ts:b}}g.parseThreadNotification=a}),98);
__d("WAHandleUnknownNotification",["Promise","WALogger","WASmaxNotificationFallbackGenericNotificationRPC"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown notification type ",""]);h=function(){return a};return a}function a(a){a=d("WASmaxNotificationFallbackGenericNotificationRPC").receiveGenericNotificationRPC(a);var b=a.parsedRequest.type;a=a.makeGenericNotificationResponseUnknownStanza;return{type:b,makeUnknownNotificationAck:a}}function c(a){var c=a.type,e=a.makeUnknownNotificationAck;d("WALogger").LOG(h(),c);var f=function(){return b("Promise").resolve([e()])},g=function(){return b("Promise").resolve({followUp:f})};return{process:function(){return b("Promise").resolve({persist:g})}}}g.parseUnknownNotification=a;g.handleUnknownNotification=c}),98);
__d("WAServerHandler",["Promise","WAGlobals","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([""," error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," completed with an error"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose([""," "," parsing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error parsing: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": starting"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unwrapStepHandler] the length of result is not equal to 1"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose([""," ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([""," cannot parse ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose([""," error ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose([""," completed with an error"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": success"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": starting"]);u=function(){return a};return a}var v=1;function a(a,c,e){var f=1;return function(g,h){var i="BulkServerJob."+v+++" "+a+"."+f++,j="[ServerRPC]["+a+"]";d("WALogger").LOG(u(),i);var k=[];for(var l=0;l<g.length;l++){var m=g[l],n=c.parse(m);n.error?(d("WALogger").WARN(q(),i,m),d("WALogger").ERROR(p(),j,n.error)):k.push(n.success)}if(k.length===0)return b("Promise").reject(j+": Cannot parse incoming stanzas");m=b("Promise").resolve().then(function(){return e(k,h)}).then(function(a){d("WAGlobals").getInMemorySignal().clear();d("WALogger").LOG(t(),i);d("WAGlobals").getServerRPC().castStanzas(a,h);return a});m["catch"](function(a){d("WALogger").WARN(s(),i),d("WALogger").ERROR(r(),j,a),d("WAGlobals").getInMemorySignal().clear()});return m}}function c(a){return function(b){return a(b).process().then(function(a){a=a.persist;return a()}).then(function(a){a=a.followUp;return a()}).then(function(a){if(a.length!==1){d("WALogger").WARN(o(),a);d("WALogger").ERROR(n());return"NO_ACK"}return a[0]})}}function e(a,c,e){var f=1;return function(g){var n="ServerRPC."+v+++" "+a+"."+f++,o="[ServerRPC]["+a+"]";d("WALogger").LOG(m(),n);var p=c.parse(g);if(p.error){d("WALogger").WARN(l(),g);d("WALogger").ERROR(k(),o,p.error);return b("Promise").reject(p.error)}g=b("Promise").resolve().then(function(){return e(p.success)}).then(function(a){d("WALogger").LOG(j(),n);return a});g["catch"](function(a){d("WALogger").WARN(i(),n),d("WALogger").ERROR(h(),o,a)});return g}}g.bulkServerHandler=a;g.unwrapStepHandler=c;g.serverHandler=e}),98);
__d("WAHandleNotification",["Promise","WAHandleDeviceChangeNotification","WAHandleEncryptNotification","WAHandleGroupNotifications","WAHandleMediaRetryNotification","WAHandleServerNotification","WAHandleSyncdNotification","WAHandleThreadNotification","WAHandleUnknownNotification","WALogger","WAServerHandler","WAStanzaUtils","WASyncdDisabled","WAWapParser"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received a thread notification but there is no handler for it"]);h=function(){return a};return a}function a(a){a.assertTag("notification");var b=a.maybeAttrString("type"),c=d("WAStanzaUtils").toStanzaId(a.attrString("id"));if(b==="fbid:devices"){var e=d("WAHandleDeviceChangeNotification").parseDeviceChangeNotification(a.getNode()),f=e.notification;e=e.ack;return{type:"devices",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:f,ack:e}}else if(b==="encrypt"){f=d("WAHandleEncryptNotification").parseEncryptNotification(a.getNode());e=f.ack;f=f.notification;return{type:"encrypt",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:f,ack:e}}else if(b==="w:gp2"){f=d("WAHandleGroupNotifications").parseGroupNotification(a.getNode());e=f.action;if(e.type!=="unknown")return{type:"group",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:e,makeAck:f.makeAck}}else if(b==="mediaretry")return{type:"mediaretry",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:d("WAHandleMediaRetryNotification").parseMediaRetryNotification(a)};else if(b==="server"){e=d("WAHandleServerNotification").parseServerNotification(a.getNode());f=e.ts;e=e.ack;return{type:"server",stanzaId:c,offline:a.maybeAttrInt("offline"),ts:f,ack:e}}else if(b==="fbid:thread")return{type:"thread",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:d("WAHandleThreadNotification").parseThreadNotification(a)};else if(!d("WASyncdDisabled").isSyncdDisabled()&&b==="server_sync")return{type:"syncd",stanzaId:c,offline:a.maybeAttrInt("offline"),notification:d("WAHandleSyncdNotification").parseSyncdNotification(a)};return{type:"unknown",offline:a.maybeAttrInt("offline"),notification:d("WAHandleUnknownNotification").parseUnknownNotification(a.getNode())}}var i=new(d("WAWapParser").WapParser)("notificationParser",a);function j(){return{process:function(){return b("Promise").resolve({persist:function(){return b("Promise").resolve({followUp:function(){return b("Promise").resolve(["NO_ACK"])}})}})}}}function k(a){return function(b){switch(b.type){case"devices":return d("WAHandleDeviceChangeNotification").handleDeviceChangeNotification(b);case"encrypt":return d("WAHandleEncryptNotification").handleEncryptNotification(b);case"group":return d("WAHandleGroupNotifications").handleGroupNotification(b);case"mediaretry":return d("WAHandleMediaRetryNotification").handleMediaRetryNotification(b);case"server":return d("WAHandleServerNotification").handleServerNotification(b);case"thread":if(a)return a(b);else{d("WALogger").ERROR(h());return j()}case"syncd":return d("WAHandleSyncdNotification").handleSyncdNotification(b);default:b.type;return d("WAHandleUnknownNotification").handleUnknownNotification(b.notification)}}}c=function(a){a=a.handleThreadNotification;return d("WAServerHandler").serverHandler("handleNotification",i,d("WAServerHandler").unwrapStepHandler(k(a)))};g.parseNotification=a;g.notificationParser=i;g.makeNotificationHandler=k;g.createHandleNotification=c}),98);
__d("MAWHandleNotification",["MAWHandleThreadNotification","WAHandleNotification"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAHandleNotification").createHandleNotification({handleThreadNotification:d("MAWHandleThreadNotification").handleThreadNotification});b=d("WAHandleNotification").makeNotificationHandler(d("MAWHandleThreadNotification").handleThreadNotification);g.handleNotification=a;g.makeNotificationStepHandler=b}),98);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a=babelHelpers["extends"]({},null);b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null);a.internalSpec={payload:[1,d("WAProtoConst").TYPES.MESSAGE,b],protocol:[2,d("WAProtoConst").TYPES.MESSAGE,c]};b.internalSpec={applicationPayload:[1,d("WAProtoConst").TYPES.MESSAGE,d("WACommon.pb").SubProtocolSpec],futureProof:[3,d("WAProtoConst").TYPES.ENUM,d("WACommon.pb").FUTURE_PROOF_BEHAVIOR]};c.internalSpec={integral:[1,d("WAProtoConst").TYPES.MESSAGE,j],ancillary:[2,d("WAProtoConst").TYPES.MESSAGE,e]};e.internalSpec={skdm:[2,d("WAProtoConst").TYPES.MESSAGE,i],deviceListMetadata:[3,d("WAProtoConst").TYPES.MESSAGE,l],icdc:[4,d("WAProtoConst").TYPES.MESSAGE,f]};f.internalSpec={senderIdentity:[1,d("WAProtoConst").TYPES.MESSAGE,h],recipientIdentities:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,h],recipientUserJids:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.STRING]};h.internalSpec={seq:[1,d("WAProtoConst").TYPES.INT32],signingDevice:[2,d("WAProtoConst").TYPES.BYTES],unknownDevices:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.BYTES],unknownDeviceIds:[4,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.INT32]};i.internalSpec={groupId:[1,d("WAProtoConst").TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,d("WAProtoConst").TYPES.BYTES]};j.internalSpec={padding:[1,d("WAProtoConst").TYPES.BYTES],dsm:[2,d("WAProtoConst").TYPES.MESSAGE,k]};k.internalSpec={destinationJid:[1,d("WAProtoConst").TYPES.STRING],phash:[2,d("WAProtoConst").TYPES.STRING]};l.internalSpec={senderKeyHash:[1,d("WAProtoConst").TYPES.BYTES],senderTimestamp:[2,d("WAProtoConst").TYPES.UINT64],recipientKeyHash:[8,d("WAProtoConst").TYPES.BYTES],recipientTimestamp:[9,d("WAProtoConst").TYPES.UINT64]};g.MessageTransportSpec=a;g.MessageTransport$PayloadSpec=b;g.MessageTransport$ProtocolSpec=c;g.MessageTransport$Protocol$AncillarySpec=e;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=f;g.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=h;g.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=i;g.MessageTransport$Protocol$IntegralSpec=j;g.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=k;g.DeviceListMetadataSpec=l}),98);
__d("WAParseMessageTransport",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{version:"v3",type:"error",error:a}}function i(a,b){return a!=null&&(b.dsm==null||b.dsm.destinationJid==null||b.dsm.destinationJid!==a)}function a(a,b){var c=a.payload;a=a.protocol;if(c==null&&a==null)return h("There is no payload and protocol in the message transport");else if(a==null)return h("There is no protocol part in the message transport");var e=a.integral;if(e==null)return h("There is no integral part in the message transport");else if(e.padding==null)return h("There is no padding in the message transport");else if(i(b,e))return h("The recipient does not match the device sent message recipient");else if(d("decodeProtobuf").getUnknownFields(e)!=null)return babelHelpers["extends"]({},h("There are unknown fields in the integral"),{futureProof:c==null?void 0:c.futureProof});if(c!=null){b=c.applicationPayload;return b==null?h("There is no applicationPayload payload in the message transport"):{type:"applicationPayload",applicationPayload:b,skdm:j(a.ancillary),icdc:k(a.ancillary)}}e=j(a.ancillary);return e!=null?{type:"skdm",skdm:e,icdc:k(a.ancillary)}:{type:"unknown"}}function j(a){return a==null?null:a.skdm}function k(a){return a==null?null:a.icdc}g.parseMessageTransport=a}),98);
__d("WADecodeIncomingMsg",["WALogger","WALongInt","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg called with unexpected encoding version: ",""]);h=function(){return a};return a}function i(a,b){return a.futureProof?{version:"v3",type:"futureProof",futureProof:a.futureProof,protobuf:b,subtype:null}:{version:"v3",type:"error",error:a.error}}function a(a,b,c){if(b==="v2")return{version:"v2",encoded:a};else if(b==="v3"){var e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,a);e=d("WAParseMessageTransport").parseMessageTransport(e,c);if(e.type==="error")return i(e,a);if(e.type==="skdm")return j(e.skdm,e.icdc);else if(e.type==="applicationPayload"){c=k(e.applicationPayload,a,e.icdc);if(e.skdm!=null){a=j(e.skdm,e.icdc);return{version:"v3",type:"msgWithSKDM",msg:c,skdm:a}}return c}else{e.type;return{version:"v3",type:"error",error:"unhandled proto"}}}else{d("WALogger").DEV(h(),b);return{type:"error",version:"v3",error:"decodeIncomingMsg called with unexpected encoding version: "+b}}}function j(a,b){var c=a.axolotlSenderKeyDistributionMessage;a=a.groupId;if(c==null)return{type:"error",version:"v3",error:"parseSKDM called with null axolotlSenderKeyDistributionMessage"};else if(a==null)return{type:"error",version:"v3",error:"parseSKDM called with null groupId"};return{version:"v3",type:"skdm",msg:{senderKey:c,groupId:a},icdc:b}}function k(a,b,c){var e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);if(e.payload==null)return l(e.metadata);var f=d("WAParseMessageApplication").parseMessageApplication(e);return f.type==="error"?i(f,b):{version:"v3",type:"subprotocol",metadata:(e=e.metadata)!=null?e:null,subprotocolType:f.subprotocolType,subprotocol:f.payload,protobuf:b,frankingContent:a.payload,icdc:c}}function l(a){a=a==null?void 0:a.chatEphemeralSetting;if(a!=null){var b=a.ephemeralExpiration;a=a.ephemeralSettingTimestamp;if(b==null)return{version:"v3",type:"error",error:"Ephemeral setting without expiration"};try{a=a!=null?d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(a)/1e3):d("WATimeUtils").DEFAULT_UNIXTIME;return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:a}}catch(a){return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").DEFAULT_UNIXTIME}}}else return{version:"v3",type:"error",error:"MessageApplication has no payload and is not ephemeral"}}g.decodeIncomingMsg=a}),98);
__d("WAMessageAuthor",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.chat,e=d("WAJids").extractUserJid(a.author),f=d("WAJids").extractDeviceId(a.author);d("WAGlobals").isPeerDevice(a.author)&&(e="@me",b!=null&&(c=b));return{chat:c,author:e,deviceId:f}}g.extractChatAuthor=a}),98);
__d("WAPromiseReduce",["regeneratorRuntime"],(function(a,b,c,d,e,f){a=function(a,c,d){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:e=d,f=a.length,g=0;case 3:if(!(g<f)){h.next=10;break}h.next=6;return b("regeneratorRuntime").awrap(c(e,a[g],g));case 6:e=h.sent;case 7:g++;h.next=3;break;case 10:return h.abrupt("return",e);case 11:case"end":return h.stop()}},null,this)};f.promiseReduce=a}),66);
__d("WADecryptIncomingMsg",["WACryptoManagerUtils","WADecodeIncomingMsg","WAFranking","WAGlobals","WAJids","WALogger","WAMessageAuthor","WAPREList","WAPREMetrics","WAPromiseReduce","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received skdm from non-group"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fail to save senderKeySession ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["groupJID does not match SKDM groupJID"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg failed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received encType from non group"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] handleMsg unavailable message ",""]);m=function(){return a};return a}function n(a){return a.encs.length===0}function a(a,c){var e,f,g,h,i,j,k,l,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:g=a.details,h=g.externalId,i=g.from,j=g.ts,k=g.recipient,l=g.hideDecryptionFailure;p=a.encs;q=d("WAMessageAuthor").extractChatAuthor(i,k);r={chat:q.chat,author:q.author,externalId:h};if(!n(a)){u.next=7;break}d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).DEV(m(),c,a.details.externalId);return u.abrupt("return",babelHelpers["extends"]({},a,{decrypted:{type:"UnavailableMsg",id:{chat:q.chat,externalId:h,author:q.author},ts:j},decryptionError:null}));case 7:u.next=9;return b("regeneratorRuntime").awrap(d("WAPromiseReduce").promiseReduce(p,function(b,d){b.hidePlaceholder=d.hideDecryptionFailure&&b.hidePlaceholder;return o(q,a.details,d,c).then(function(a){a.success&&a.value!=null&&a.value.msg!=null&&(b.msg=a.value.msg);b.type=a.success?a.value.type:void 0;b.success=a.success;b.decryptionError=a.success===!1?a:null;return b})},{msg:null,type:null,hidePlaceholder:!1,success:!0,decryptionError:null}));case 9:s=u.sent;if(!(s.success&&s.msg!=null)){u.next=12;break}return u.abrupt("return",babelHelpers["extends"]({},a,{decrypted:s.msg,decryptionError:null}));case 12:if(!(p.length===1&&s.type==="skdm")){u.next=14;break}return u.abrupt("return",babelHelpers["extends"]({},a,{decrypted:{type:"InvisibleMsg",id:r,ts:a.details.ts},decryptionError:s.decryptionError}));case 14:(e=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:(f=e.getStats())==null?void 0:f.track({decryptErrors:1});t=s.msg==null&&s.success;return u.abrupt("return",babelHelpers["extends"]({},a,{decrypted:{type:"IncomingCiphertextMsg",id:r,ts:a.details.ts,createPlaceholder:a.details.type!=="reaction"&&!t&&!l&&!s.hidePlaceholder},decryptionError:s.decryptionError}));case 17:case"end":return u.stop()}},null,this)}function o(a,c,e,f){var g,h,i,j,k,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:g=c.from;i=e.e2eType;j=d("WAJids").interpretAsGroupJid(a.chat);if(!(i==="msg"||i==="pkmsg")){n.next=10;break}k=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION,{string:{type:i,queue:f,userHash:d("WAGlobals").getConfig().isEmployee()&&d("WAGlobals").getConfig().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null},bool:{isGroup:j!=null,isCryptoManagerV2:d("WAGlobals").getConfig().useCryptoManagerV2(),isMultiDomainReg:d("WAGlobals").getConfig().isDeviceRegistrationDomainUniquenessEnabled()},"int":{retryCount:e.retryCount,offlineCount:c.offline}},void 0,{string:{jid:a.chat}});n.next=7;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").decryptMsg(i,g.author,e.ciphertext,e.retryCount,k));case 7:h=n.sent;n.next=20;break;case 10:i;if(!(j==null)){n.next=16;break}d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).ERROR(l());return n.abrupt("return",d("WAResultOrError").makeError("skmsg_from_non_group"));case 16:m=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION,{string:{type:i,queue:f,userHash:d("WAGlobals").getConfig().isEmployee()&&d("WAGlobals").getConfig().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null},bool:{isGroup:!0,isCryptoManagerV2:d("WAGlobals").getConfig().useCryptoManagerV2()},"int":{retryCount:e.retryCount,offlineCount:c.offline}},void 0,{string:{jid:a.chat}});n.next=19;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").decryptGroupMsg(j,g.author,e.ciphertext,e.retryCount,m));case 19:h=n.sent;case 20:if(h.success){n.next=23;break}d("WAGlobals").getDbImpls().writeDebugMsg(a.chat,"Message "+c.externalId+" has decryption error: "+h.error+" from user "+g.author);return n.abrupt("return",h);case 23:if(h.value){n.next=25;break}return n.abrupt("return",d("WAResultOrError").makeError("empty_content"));case 25:return n.abrupt("return",p(a,c,e,h.value.plaintext,h.value.remoteIdentity!==null?h.value.remoteIdentity:null));case 26:case"end":return n.stop()}},null,this)}function p(a,c,e,f,g){var h,i,j,l,m,n,o,p,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:h=c.externalId,i=c.ts,j=c.recipient,l=c.reportingMeta;m=d("WADecodeIncomingMsg").decodeIncomingMsg(f,e.version,j);n=m.version==="v3"&&m.type==="msgWithSKDM"?m.msg:m;o={chat:a.chat,author:a.author,externalId:h};p={id:a.deviceId,identity:g};if(!(n.version==="v3"&&n.type==="error")){t.next=8;break}d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).DEV(k()).devConsole(n.error);return t.abrupt("return",d("WAResultOrError").makeResult({type:m.type}));case 8:if(!(n.version==="v3"&&n.type==="skdm")){t.next=13;break}t.next=11;return b("regeneratorRuntime").awrap(q(c.from,n));case 11:t.next=21;break;case 13:if(!(m.version==="v3"&&m.type==="msgWithSKDM")){t.next=17;break}if(!(m.skdm.type!=="error")){t.next=17;break}t.next=17;return b("regeneratorRuntime").awrap(q(c.from,m.skdm));case 17:t.next=19;return b("regeneratorRuntime").awrap(d("WAFranking").handleFrankingFromIncomingMsg(n,l));case 19:s=r(n,i);return t.abrupt("return",d("WAResultOrError").makeResult({type:m.type,msg:{device:p,folder:c.folder,id:o,msg:s,recipientsCount:c.count,ts:i,type:"IncomingMsg",reportingMeta:c.reportingMeta}}));case 21:return t.abrupt("return",d("WAResultOrError").makeResult({type:m.type}));case 22:case"end":return t.stop()}},null,this)}function q(a,c){var e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!(a.type==="group")){g.next=11;break}e=a.chat;if(!(e!==d("WAJids").toGroupJid(c.msg.groupId))){g.next=5;break}d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).ERROR(j());return g.abrupt("return");case 5:g.next=7;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").saveSenderKeySession(e,a.author,new Uint8Array(c.msg.senderKey),!0));case 7:f=g.sent;f.success||d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).ERROR(i(),f.error);g.next=12;break;case 11:d("WALogger").TAGS(["ServerRPC","HandleMsg","Decrypt"]).ERROR(h());case 12:case"end":return g.stop()}},null,this)}function r(a,b){b;var c=a;a.version==="v3"&&a.type==="ephemeral"&&(b=a.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME?b:a.ephemeralLastUpdatedOrSetTimestamp,c=babelHelpers["extends"]({},a,{ephemeralLastUpdatedOrSetTimestamp:b}));return c}g.decryptIncomingMsg=a}),98);
__d("WAIncomingMsg",["WADualSendMsgUtils","WAGlobals","WAJids","WALogger","WAMessageHandlingFollowUps","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping redundant retries"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found "," redundant retries"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Receive Message Flow: Skipping duplicate retry for ",""]);j=function(){return a};return a}function a(a,b,c){b={string:{queueType:b,msgType:a.type,threadType:a.from.type,userHash:d("WAGlobals").getConfig().isEmployee()&&d("WAGlobals").getConfig().isUseridAnnotationEnabled()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null},string_array:{encTypes:a.encs.map(function(a){return a.e2eType})},"int":{messagesInBatch:c,isDualSend:d("WADualSendMsgUtils").isDualSendJid(a.from.chat)?1:0,retryCount:Math.max.apply(Math,a.encs.map(function(a){return a.retryCount}))},bool:{isCryptoManagerV2:d("WAGlobals").getConfig().useCryptoManagerV2()}};c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,b,void 0,{string:{jid:a.from.chat}});b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.TEST_RECEIVE_MESSAGE,b);var e=a.encs;a=babelHelpers.objectWithoutPropertiesLoose(a,["encs"]);return{encs:e,details:a,metrics:{receive:c,receiveEU:b,encDecryption:[]}}}function b(a){var b={receipt:[],queryGroup:[],queryGroupInvite:[]};for(var c=0;c<a.length;c++){var d=a[c];d.action.type==="receipt"||d.action.type==="retry"?b.receipt.push(d):d.action.type==="queryGroup"?b.queryGroup.push(d):b.queryGroupInvite.push(d)}return b}function k(a){var b=a.externalId,c=a.from,d=c.author;c=c.chat;a=a.recipient;return[b.toString(),d.toString(),c.toString(),(b=a==null?void 0:a.toString())!=null?b:""].join(",")}function c(a){var b=new Map(),c=[],e=new Set(),f=new Set(),g=[],l={groupJids:new Set(),msgs:[]},m=0;a.forEach(function(a){var h=a.action;a=babelHelpers.objectWithoutPropertiesLoose(a,["action"]);a.details.from=d("WADualSendMsgUtils").removeDualSendPrefixForFromJidChat(a.details.from);if(h.type==="retry"){var i=k(a.details),n=b.get(i);n!=null&&(m++,d("WALogger").LOG(j(),a.details.externalId),c.push({msg:a,ack:d("WAMessageHandlingFollowUps").retryAck(n.details)}));b.set(i,a)}else h.type,c.push({msg:a,ack:d("WAMessageHandlingFollowUps").deliveryReceipt(a.details)});n=h.getDevices;n!=null&&(g.push(a),f.add(n.reason),n.users.forEach(function(a){e.add(a)}));h.queryGroup!=null&&(l.groupJids.add(h.queryGroup.groupJid),l.msgs.push(a))});m>0&&(d("WALogger").WARN(i(),m),d("WALogger").ERROR(h()));return{retries:Array.from(b.values()),acks:c,getDevices:{users:e,reason:Array.from(f).join("|"),msgs:g},queryGroup:l}}g.makeIncomingMsg=a;g.splitActionsByType=b;g.sortReceiptByType=c}),98);
__d("WAIncomingMsgUtils",["Promise","WAGlobals","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAMessageAuthor","WAMessageHandlingFollowUps","WAResultOrErrorUtils","WAStanzaQueuePersistApi"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: detected out-of-sync ephemeral setting for ",", sending EPHEMERAL_SYNC_RESPONSE"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Some messages failed to be written to DB: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["The amount of results is not the same as the amount of processed messages"]);j=function(){return a};return a}function a(a,b){return d("WAGlobals").getConfig().enableRawStanzaQueueStore()?d("WAStanzaQueuePersistApi").persistMsgsTransaction(a):d("WAGlobals").getDbImpls().bulkHandleIncomingMsgs(a.map(function(a){return a.decrypted})).then(function(c){return k(a,c,b)})}function c(a){if(a.users.size>0){for(var c=a.msgs,e=Array.isArray(c),f=0,c=e?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=c.length)break;g=c[f++]}else{f=c.next();if(f.done)break;g=f.value}g=g;g.metrics.receive.addPoint("schedule_fetch_devices");g.metrics.receiveEU.addPoint("schedule_fetch_devices")}return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(a.users,a.reason,!1,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}))}return b("Promise").resolve()}function k(a,b,c){b.length!==a.length&&d("WALogger").TAGS([c]).ERROR(j());var e=d("WAResultOrErrorUtils").unpackErrors(b);e.length>0&&d("WALogger").TAGS([c]).WARN(i(),e.map(function(a){return a.type}).join(", "));return a.map(function(a,c){b[c].success===!1&&a.metrics.receive.addPoint(b[c].error.type);return babelHelpers["extends"]({},a,{db:b[c]})})}function e(a){var c=a.retries,e=a.acks;(a=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:(a=a.getStats())==null?void 0:a.track({retries:c.length});return b("Promise").all(c.map(function(a){return d("WAMessageHandlingFollowUps").sendMsgRetryReceipt(a)})).then(function(){return e})}function f(a){return a.map(function(a){var b=a.msg.decryptionError;if(b!=null&&b.error!=="errDuplicateMsg"){var c;a.msg.metrics.receive.endFail(b.error,{string:{payload:b==null?void 0:(c=b.payload)==null?void 0:c.toString==null?void 0:c.toString()}});a.msg.metrics.receiveEU.endFail(b.error)}else a.msg.metrics.receive.endSuccess(),a.msg.metrics.receiveEU.endSuccess();return a.ack})}function l(a){var b=a.decrypted;if(b.type==="IncomingCiphertextMsg"){a.metrics.receive.addPoint("need_retry");a.metrics.receiveEU.addPoint("need_retry");return babelHelpers["extends"]({},a,{action:{type:"retry"}})}else return babelHelpers["extends"]({},a,{action:{type:"receipt"}})}function m(a,b){b===void 0&&(b=!0);a.metrics.receive.addPoint("process_db_result");a.metrics.receiveEU.addPoint("process_db_result");var c=a.details,e=a.decrypted,f=a.db,g=c.from;c=c.recipient;g=d("WAMessageAuthor").extractChatAuthor(g,c);if((((c=f.error)==null?void 0:c.type)==="missing_thread"||((c=f.error)==null?void 0:c.type)==="group_invite")&&(e.type==="IncomingMsg"||e.type==="IncomingCiphertextMsg"))if(b){if(f.error.type==="group_invite"&&(e==null?void 0:(c=e.msg)==null?void 0:c.type)!=="ephemeral")return babelHelpers["extends"]({},a,{action:{type:"queryGroupForInvitee",groupJid:f.error.groupJid,groupInvite:{inviteCode:f.error.inviteCode,inviteExpireTs:f.error.inviteExpireTs,inviterJid:f.error.inviterJid}}});else{b=d("WAJids").interpretAsGroupJid(g.chat);if(b!=null&&(e==null?void 0:(c=e.msg)==null?void 0:c.type)!=="ephemeral")return babelHelpers["extends"]({},a,{action:{type:"queryGroup",groupJid:b}})}}else return babelHelpers["extends"]({},a,{action:{type:"retry"}});if(((c=f.error)==null?void 0:c.type)==="identity_missing"){b=d("WAJids").isAuthorMe(g.author)?d("WAGlobals").getMyUserJid():g.author;return babelHelpers["extends"]({},a,{action:{type:"retry",getDevices:{users:[b],reason:"missing-identity"}}})}if(f.success){var i=[],j=new Set();c=null;if(f.value!=null){b=f.value;f=b.unknownDevice;var k=b.unknownGroup,l=b.protocolMsgId,m=b.plaintextHashs,o=b.outOfSyncEphemeralSetting;b=b.icdcResults;d("WAGlobals").getConfig().isICDCEnabled()&&b!=null&&b.length>0&&b.forEach(function(a){var b=a.icdcResult;b.action==="error"&&b.sync&&(j.add("icdc-error-sync"),i.push(a.jid))});if(f){b=g.author==="@me"?d("WAGlobals").getMyUserJid():g.author;i.push(b);j.add("unknown-device")}if(k){f=d("WAJids").interpretAsGroupJid(g.chat);c=f}o!=null&&(d("WALogger").LOG(h(),l==null?void 0:l.externalId),d("WAMessageHandlingFollowUps").maybeSendEphemeralSyncResponse(o));m==null?void 0:m.forEach(function(a){n(l,a)})}if(e.type==="IncomingCiphertextMsg")return babelHelpers["extends"]({},a,{action:{type:"retry",getDevices:{users:i,reason:Array.from(j).join("|")},queryGroup:c!=null?{groupJid:c}:null}});else return babelHelpers["extends"]({},a,{action:{type:"receipt",getDevices:{users:i,reason:Array.from(j).join("|")},queryGroup:c!=null?{groupJid:c}:null}})}return babelHelpers["extends"]({},a,{action:{type:"retry"}})}function n(a,b){a!=null&&b!=null&&d("WAJobs").getJobManager().fireAndForget(d("WAJobDefinitions").jobSerializers.downloadAndHandleMedia(a,b,"WAIncomingMsg"))}g.bulkSaveIncomingMsgs=a;g.scheduleGetDeviceRequests=c;g.combineDbResultsAndMsg=k;g.sendRetryRequests=e;g.mapAcks=f;g.subtractRetries=l;g.processSingleDBResult=m}),98);
__d("WAQueryGroupInvite",["WAComms","WAErr","WAPREList","WAPREMetrics","WAQueryGroup","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e,f,g){var h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP);i=d("WAWap").wap("iq",{to:d("WAWap").GROUP_JID(a),type:"get",xmlns:"w:g2",id:d("WAWap").generateId()},d("WAWap").wap("query",null,d("WAWap").wap("add_request",{code:d("WAWap").CUSTOM_STRING(e),expiration:d("WAWap").CUSTOM_STRING(f.toString(10)),admin:d("WAWap").USER_JID(g)})));k.next=4;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(i,d("WAQueryGroup").parseQueryGroupResponse));case 4:j=k.sent;if(j.success){k.next=8;break}h.endFail("query_group_for_invitee_fail");throw c("WAErr")("Failed to parse queryGroup response for group invitee");case 8:h.endSuccess();return k.abrupt("return",j.result.group);case 10:case"end":return k.stop()}},null,this)}g.queryGroupInvite=a}),98);
__d("WAReceiptUtils",["WAComms","WACryptoManagerUtils","WAGlobals","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAPREList","WAPREMetrics","WAPreKeysStanzaUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRetryReceipt is sending a retry with count "," which will inevitably be ignored"]);h=function(){return a};return a}function a(a){var c,e,f,g,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:c=a.externalId,e=a.retryCount,f=a.from,g=a.participant;j=e+1;k=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RETRY_RECEIPTS_SENT,{"int":{retries:j}});j>=d("WAGlobals").getConfig().messageRetryCountLimit()&&(d("WALogger").LOG(h(),j),d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL,{"int":{retryCount:j}}).endFail("MAXIMUM_RETRIES_EXCEEDED"));if(!(j>=3)){o.next=7;break}o.next=7;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilCompletedNonPersisted(d("WAJobDefinitions").jobSerializers.requestPreKeyDigest({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 7:l=null;if(!(j>=2)){o.next=12;break}o.next=11;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").getSignalInfoForRetry());case 11:l=o.sent;case 12:m=d("WACryptoManagerUtils").getRegId();f.type==="group"?n=f.groupJid:(f.type,n=f.deviceJid);o.next=16;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendStanzaAndWaitForAck(i(a,j,m,l),{id:c,"class":"receipt",from:n,participant:g}));case 16:k.endSuccess();case 17:case"end":return o.stop()}},null,this)}function i(a,b,c,e){var f=null;if(e!=null){var g=e.keyType,h=e.signedPreKey,i=e.preKey;e=e.publicKey;var j=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;f=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,d("WAWap").BIG_ENDIAN_CONTENT(g,1)),d("WAWap").wap("identity",null,e),d("WAPreKeysStanzaUtils").xmppPreKey(i),d("WAPreKeysStanzaUtils").xmppSignedPreKey(h),j)}a.from.type==="group"?g=a.from.groupJid:(a.from.type,g=a.from.deviceJid);return d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(a.externalId),to:d("WAWap").JID(g),participant:a.participant?d("WAWap").DEVICE_JID(a.participant):d("WAWap").DROP_ATTR,recipient:a.recipient?d("WAWap").USER_JID(a.recipient):d("WAWap").DROP_ATTR,type:"retry",category:a.category!=null?d("WAWap").CUSTOM_STRING(a.category):d("WAWap").DROP_ATTR},d("WAWap").wap("retry",{v:"1",count:d("WAWap").INT(b),id:d("WAWap").CUSTOM_STRING(a.externalId),t:d("WAWap").INT(a.ts)}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(c)),f)}g.sendRetryReceipt=a}),98);
__d("WAMessageHandlingFollowUps",["Promise","WADualSendMsgUtils","WAGlobals","WAIncomingMsg","WAIncomingMsgUtils","WAJids","WAJobDefinitions","WAJobs","WALogger","WAPromiseQueue","WAQueryGroup","WAQueryGroupInvite","WAReceiptUtils","WAScheduleAfterOfflineResume","WASendSenderKeyDistributionMsg","WATimeUtils","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg > handleRetry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][HandleIncomingMsg] Getting queryGroup for the second time, which should not be happen"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][HandleIncomingMsg] Received "," queryGroup result for the second time"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot request a group for a message: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][HandleIncomingMsg] Getting queryGroupForInvitee for the second time, which should not be happen"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][HandleIncomingMsg] Received "," queryGroup and "," queryGroupInvite result for the second time"]);m=function(){return a};return a}function a(a,c){var e,f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:e=new Map();a.queryGroup.forEach(function(a){a.metrics.receive.addPoint("query_group_start");a.metrics.receiveEU.addPoint("query_group_start");var b=d("WADualSendMsgUtils").isDualSendJid(a.action.groupJid)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a.action.groupJid):a.action.groupJid;a.details.from=d("WADualSendMsgUtils").removeDualSendPrefixForFromJidChat(a.details.from);var c=e.get(b);c==null?(c=[a],e.set(b,c)):c.push(a)});if(!(e.size>0)){o.next=21;break}(f=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:(g=f.getStats())==null?void 0:g.track({queryGroup:e.size});h=e.keys();i=h,j=Array.isArray(i),k=0,i=j?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 6:if(!j){o.next=12;break}if(!(k>=i.length)){o.next=9;break}return o.abrupt("break",21);case 9:l=i[k++];o.next=16;break;case 12:k=i.next();if(!k.done){o.next=15;break}return o.abrupt("break",21);case 15:l=k.value;case 16:m=l;o.next=19;return b("regeneratorRuntime").awrap(n(e,m,a,c));case 19:o.next=6;break;case 21:return o.abrupt("return",{receipt:a.receipt,queryGroupInvite:a.queryGroupInvite});case 22:case"end":return o.stop()}},null,this)}function c(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=new Map();a.queryGroupInvite.forEach(function(a){a.metrics.receive.addPoint("query_group_invite_start");a.metrics.receiveEU.addPoint("query_group_invite_start");var b=e.get(a.action.groupJid);b==null?(b=[a],e.set(a.action.groupJid,b)):b.push(a)});if(!(e.size>0)){i.next=7;break}(f=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:(g=f.getStats())==null?void 0:g.track({queryGroupInvite:e.size});h=Array.from(e.keys());i.next=7;return b("regeneratorRuntime").awrap(b("Promise").all(h.map(function(f){var g,h,i,j,k,n,o,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:g=e.get(f);if(!(g!=null)){s.next=28;break}s.next=4;return b("regeneratorRuntime").awrap(p(f,g));case 4:s.next=6;return b("regeneratorRuntime").awrap(d("WAIncomingMsgUtils").bulkSaveIncomingMsgs(g.map(function(a){return{details:a.details,decrypted:a.decrypted,metrics:a.metrics,decryptionError:a.decryptionError}}),c));case 6:h=s.sent,i=[],(j=h,k=Array.isArray(j),n=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 9:if(!k){s.next=15;break}if(!(n>=j.length)){s.next=12;break}return s.abrupt("break",25);case 12:o=j[n++];s.next=19;break;case 15:n=j.next();if(!n.done){s.next=18;break}return s.abrupt("break",25);case 18:o=n.value;case 19:q=o,i.push(d("WAIncomingMsgUtils").processSingleDBResult(q,!1)),q.metrics.receive.addPoint("query_group_invite_completed"),q.metrics.receiveEU.addPoint("query_group_invite_completed");case 23:s.next=9;break;case 25:r=d("WAIncomingMsg").splitActionsByType(i),(r.queryGroup.length>0||r.queryGroupInvite.length>0)&&(d("WALogger").WARN(m(),r.queryGroup.length,r.queryGroupInvite.length),d("WALogger").ERROR(l()).sendLogs("handleMsg"),r.queryGroup.forEach(function(a){a.metrics.receive.endFail("query-group-invite-error-twice-a-time"),a.metrics.receiveEU.endFail("query-group-invite-error-twice-a-time")})),a.receipt=a.receipt.concat(r.receipt);case 28:case"end":return s.stop()}},null,this)})));case 7:return i.abrupt("return",a.receipt);case 8:case"end":return i.stop()}},null,this)}function e(a){var b=new(d("WAPromiseQueue").PromiseQueue)();a.forEach(function(a){b.enqueue(function(){return d("WAQueryGroup").queryGroup(a,"interactive").then(function(a){if(a.success===!1)return;return o(a.value)})})});return b.wait()}function n(a,c,e,f){var g,h,l,m,n,p,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").async(function(A){while(1)switch(A.prev=A.next){case 0:g=a.get(c);if(!(g==null)){A.next=3;break}return A.abrupt("return");case 3:A.next=5;return b("regeneratorRuntime").awrap(d("WAQueryGroup").queryGroup(c,"interactive"));case 5:h=A.sent;if(!(h.success===!1)){A.next=25;break}d("WALogger").WARN(k(),h.error);l=g,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 9:if(!m){A.next=15;break}if(!(n>=l.length)){A.next=12;break}return A.abrupt("break",24);case 12:p=l[n++];A.next=19;break;case 15:n=l.next();if(!n.done){A.next=18;break}return A.abrupt("break",24);case 18:p=n.value;case 19:q=p,(q.action,r=babelHelpers.objectWithoutPropertiesLoose(q,["action"])),e.receipt.push(babelHelpers["extends"]({action:{type:"receipt"}},r));case 22:A.next=9;break;case 24:return A.abrupt("return");case 25:A.next=27;return b("regeneratorRuntime").awrap(o(h.value));case 27:A.next=29;return b("regeneratorRuntime").awrap(d("WAIncomingMsgUtils").bulkSaveIncomingMsgs(g.map(function(a){return{details:a.details,decrypted:a.decrypted,metrics:a.metrics,decryptionError:a.decryptionError}}),f));case 29:s=A.sent,t=[],(u=s,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 32:if(!v){A.next=38;break}if(!(w>=u.length)){A.next=35;break}return A.abrupt("break",48);case 35:x=u[w++];A.next=42;break;case 38:w=u.next();if(!w.done){A.next=41;break}return A.abrupt("break",48);case 41:x=w.value;case 42:y=x,t.push(d("WAIncomingMsgUtils").processSingleDBResult(y,!1)),y.metrics.receive.addPoint("query_group_completed"),y.metrics.receiveEU.addPoint("query_group_completed");case 46:A.next=32;break;case 48:z=d("WAIncomingMsg").splitActionsByType(t),z.queryGroup.length>0&&(d("WALogger").WARN(j(),z.queryGroup.length),d("WALogger").ERROR(i()).sendLogs("handleMsg"),z.queryGroup.forEach(function(a){a.metrics.receive.endFail("query-group-error-twice-a-time"),a.metrics.receiveEU.endFail("query-group-error-twice-a-time")})),e.receipt=e.receipt.concat(z.receipt),e.queryGroupInvite=e.queryGroupInvite.concat(z.queryGroupInvite);case 52:case"end":return A.stop()}},null,this)}function o(a){return d("WAGlobals").getDbImpls().createGroup(a,"added",d("WATimeUtils").unixTime(),null,null,d("WADualSendMsgUtils").isDualSendJid(a.jid)?{platform:"msgr",isDualSend:!0}:null).then(function(b){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:a.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(a.jid,a.participants.length)}});return b})}function p(a,b){return d("WAQueryGroupInvite").queryGroupInvite(a,b[0].action.groupInvite.inviteCode,b[0].action.groupInvite.inviteExpireTs,b[0].action.groupInvite.inviterJid).then(function(a){return d("WAGlobals").getDbImpls().createGroup(a,"added",d("WATimeUtils").unixTime(),b[0].details.folder).then(function(b){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:a.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(a.jid,a.participants.length)}});return b})})}function f(a){d("WALogger").DEV(h());a.metrics.receive.addPoint("process_retries");a.metrics.receiveEU.addPoint("process_retries");var b=a.details,c=b.externalId,e=b.ts,f=b.retryCount;b=b.recipient;var g=null,i=null;a.details.from.type==="group"?(g={type:"group",groupJid:a.details.from.chat},i=a.details.from.author):g={type:"device",deviceJid:a.details.from.author};return d("WAReceiptUtils").sendRetryReceipt({externalId:c,ts:e,retryCount:f,from:g,participant:i,recipient:b,category:null,deviceIdentity:null}).then(function(){a.metrics.receive.addPoint("retry_success"),a.metrics.receiveEU.addPoint("retry_success")})["finally"](function(){var b;a.metrics.receive.endFail((b=(b=a.decryptionError)==null?void 0:b.error)!=null?b:"retry_on_error_unknown",{string:{payload:(b=a.decryptionError)==null?void 0:(b=b.payload)==null?void 0:b.toString==null?void 0:b.toString()}});a.metrics.receiveEU.addPoint((b=(b=a.decryptionError)==null?void 0:b.error)!=null?b:"retry_on_error_unknown",{string:{payload:(b=a.decryptionError)==null?void 0:(b=b.payload)==null?void 0:b.toString==null?void 0:b.toString()}})})}function q(a){var b=a.externalId;a=a.from;return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(b),to:d("WAWap").TO_JID(a),participant:d("WAWap").PARTICIPANT_JID(a),"class":"receipt",type:"retry"})}function r(a){var b=a.externalId,c=a.from,e=a.recipient;a=a.type;var f;e!=null?f="sender":a==="reaction"?f="inactive":f=d("WAWap").DROP_ATTR;a=!1;e==null&&f===d("WAWap").DROP_ATTR&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())&&d("WAWap").PARTICIPANT_JID(c)===d("WAWap").DROP_ATTR&&(a=!0);var g=d("WAWap").DROP_ATTR;e!=null?g=d("WAWap").USER_JID(e):a&&(g=d("WAWap").USER_JID(d("WAJids").extractUserJid(c.author)));a&&f===d("WAWap").DROP_ATTR&&(f="sender");return d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(b),to:d("WAWap").TO_JID(c),participant:d("WAWap").PARTICIPANT_JID(c),recipient:g,type:f})}function s(a){var b=a.externalId;a=a.from;return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(b),"class":"message",from:d("WAWap").DEVICE_JID(d("WAGlobals").getMyDeviceJid()),to:d("WAWap").TO_JID(a),participant:d("WAWap").PARTICIPANT_JID(a)})}function t(a){return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a.chatJid,{isForSyncResponse:!0,ephemeralSetting:{ephemeralLastUpdatedOrSetTimestamp:a.correctEphemeralLastUpdatedOrSetTimestamp,ephemeralExpirationInSec:a.correctEphemeralExpirationInSec}}))}g.processQueryGroupActions=a;g.processQueryGroupInviteActions=c;g.processQueryGroups=e;g.sendMsgRetryReceipt=f;g.retryAck=q;g.deliveryReceipt=r;g.makeAck=s;g.maybeSendEphemeralSyncResponse=t}),98);
__d("WAParseEnc",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h={pkmsg:"pkmsg",msg:"msg",skmsg:"skmsg"};function a(a){var b=a.attrInt("v");if(b!==2&&b!==3)throw c("WAErr")("Incoming msg has unexpected proto version: "+b);return{e2eType:a.attrEnum("type",h),ciphertext:a.contentBytes(),version:b===2?"v2":"v3",retryCount:a.hasAttr("count")?a.attrInt("count"):0,hideDecryptionFailure:a.maybeAttrString("decrypt-fail")==="hide"}}g.parseEncNode=a}),98);
__d("WAParseFranking",["WAFranking"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;if(a==null)return null;b=(b=a.maybeChild("franking_tag"))==null?void 0:b.contentBytes();return{frankingTag:b!=null?d("WAFranking").castToFrankingTag(b):null,reportingTag:(b=a.maybeChild("reporting_tag"))==null?void 0:b.contentBytes(),frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null}}g.parseFrankingNode=a}),98);
__d("WAIncomingMsgWapParser",["WADualSendMsgUtils","WAGlobals","WAJids","WALogger","WAParseEnc","WAParseFranking","WAStanzaUtils","WAWapParser"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Retry count mismatch between two enc nodes in the same message"]);h=function(){return a};return a}var i={text:"text",media:"media",reaction:"reaction"};function a(a){a.assertTag("message");var b=a.mapChildrenWithTag("enc",d("WAParseEnc").parseEncNode),c=d("WAParseFranking").parseFrankingNode(a.maybeChild("franking")),e=a.mapChildrenWithTag("meta",function(a){return a.hasAttr("folder_id")?a.attrInt("folder_id"):null}).filter(function(a){return a!==null}),f=a.attrFromJidChat(),g=d("WADualSendMsgUtils").parseMessageForDualSend(a);if(g){g=d("WADualSendMsgUtils").prependDualSendPrefix(f.chat);f.type==="group"?(f.chat=d("WAJids").unsafeCoerceToGroupJid(g),f.groupJid=d("WAJids").unsafeCoerceToGroupJid(g)):f.chat=d("WAJids").unsafeCoerceToUserJid(g)}g=f.type==="group"?a.maybeAttrInt("count"):null;var j=0;b.length>0&&(j=b[0].retryCount,b.length>1&&b.forEach(function(a){a.retryCount!==j&&d("WALogger").ERROR(h())}));return{externalId:d("WAStanzaUtils").toStanzaId(a.attrString("id")),from:f,recipient:a.maybeAttrUserJid("recipient"),count:g,ts:a.attrTime("t"),encs:b,retryCount:j,folder:d("WAGlobals").getConfig().wellBeingFeaturesEnabled()&&e.length!==0?e[0]:null,category:a.maybeAttrString("category"),type:a.attrEnumOrDefault("type",i,"text"),reportingMeta:c,hideDecryptionFailure:((f=a.maybeChild("meta"))==null?void 0:f.maybeAttrString("decrypt-fail"))==="hide",offline:a.maybeAttrInt("offline")}}b=new(d("WAWapParser").WapParser)("incomingMsgParser",a);g.parseIncomingMsg=a;g.incomingMsgParser=b}),98);
__d("WAHandleIncomingMsg",["Promise","WAComms","WACryptoLibrary","WADecryptIncomingMsg","WAErr","WAGlobals","WAIncomingMsg","WAIncomingMsgUtils","WAIncomingMsgWapParser","WALogger","WAMessageAuthor","WAMessageHandlingFollowUps","WAPREList","WAPREMetrics","WAPromiseQueue","WAResultOrError","WAServerHandler","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleBulkQueuedMsgs failed when saving bulked signal data with error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDevices is not currently supported by stanzaQueue population"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unavailable for reaction message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are no longer supported!"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][HandleIncomingMsg][","][","] ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] handleBulkQueuedMsgs. List size: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeUpdateSignalStore called without encs to decrypt. Should never happen"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] There were more than "," attempts to write session and all of them were failed."]);o=function(){return a};return a}var p=new(d("WAPromiseQueue").PromiseQueueMap)(),q=new(d("WAPromiseQueue").PromiseQueue)();a=d("WAServerHandler").serverHandler("handleMsg",d("WAIncomingMsgWapParser").incomingMsgParser,function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.from,e=a.recipient;f=d("WAMessageAuthor").extractChatAuthor(c,e);g.next=4;return b("regeneratorRuntime").awrap(q.wait());case 4:return g.abrupt("return",p.enqueue(f.chat,function(){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(v([a],"online"));case 2:c=d.sent;if(!(c.length>0)){d.next=5;break}return d.abrupt("return",c[0]);case 5:return d.abrupt("return","NO_ACK");case 6:case"end":return d.stop()}},null,this)}));case 5:case"end":return g.stop()}},null,this)});function r(a,b,c,e){return d("WAGlobals").getInMemorySignal().savePendingToDatabase().then(function(f){if(f.success){b.endSuccess({"int":{attempts:c}});return a}if(c>d("WACryptoLibrary").MAX_SAVE_SIGNAL_KEYS_RETRIES){d("WALogger").ERROR(o(),e,d("WACryptoLibrary").MAX_SAVE_SIGNAL_KEYS_RETRIES);b.endFail("errTooManySessionSaveRetries");return a}d("WAGlobals").getInMemorySignal().clear();return s(a.map(function(a){var b;return{encs:(b=a.encs)!=null?b:(d("WALogger").ERROR(n()),[]),details:a.details,metrics:a.metrics}}),e).then(function(){return r(a,b,c+1,e)})})}function s(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=new Array(a.length),f=0;case 2:if(!(f<a.length)){i.next=11;break}g=a[f];i.next=6;return b("regeneratorRuntime").awrap(d("WADecryptIncomingMsg").decryptIncomingMsg(g,c));case 6:h=i.sent,e[f]=h;case 8:f++;i.next=2;break;case 11:return i.abrupt("return",e);case 12:case"end":return i.stop()}},null,this)}var t="Aborting bulk stanza processing due to socket closure";function u(a,e){var f,g=[];d("WALogger").DEV(m(),e,a.length);var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SAVE_SIGNAL_SESSION_RETRIES),n=(f=d("WAComms").getComms())==null?void 0:f.socketId;if(n==null)throw c("WAErr")("Trying to process messages without an open socket.");var o=a.map(function(b){return d("WAIncomingMsg").makeIncomingMsg(b,e,a.length)}),p=function(){var a;a=(a=d("WAComms").getComms())==null?void 0:a.socketId;if(a!==n)throw c("WAErr")(t)};function q(a,b){var c;(c=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:(c=c.getStats())==null?void 0:c.track({errors:1});d("WAGlobals").getInMemorySignal().clear();c=(a==null?void 0:a.message)===t;for(var f=0;f<o.length;f++){var g=o[f];g.metrics.receive.endFail(c?"socket_closed":"unexpected_error");g.metrics.receiveEU.endFail(c?"socket_closed":"unexpected_error")}c||d("WALogger").ERROR(l(),e,b,a)}function u(){return b("Promise").resolve(o).then(function(a){return a.filter(function(a){if(a.details.category==="peer"){a.metrics.receive.endFail("peer");a.metrics.receiveEU.endFail("peer");d("WALogger").ERROR(k());return!1}return!0})}).then(function(a){for(var b=a,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(d>=b.length)break;f=b[d++]}else{d=b.next();if(d.done)break;f=d.value}f=f;f.metrics.receive.addPoint("attempt_to_decrypt_msgs");f.metrics.receiveEU.addPoint("attempt_to_decrypt_msgs")}return s(a,e)}).then(function(a){for(var b=a,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e,f;if(c){if(d>=b.length)break;f=b[d++]}else{d=b.next();if(d.done)break;f=d.value}f=f;e={string:{decryptResult:(e=(e=f.decryptionError)==null?void 0:e.error)!=null?e:"SUCCESS",decrypteAdMsgType:f.decrypted.type,payload:(e=f.decryptionError)==null?void 0:(e=e.payload)==null?void 0:e.toString==null?void 0:e.toString()}};f.metrics.receive.addPoint("msg_decrypted",e);f.metrics.receiveEU.addPoint("msg_decrypted",e)}return a}).then(function(a){return a.filter(function(a){if(a.details.type==="reaction"&&a.decrypted.type==="UnavailableMsg"){g.push(d("WAMessageHandlingFollowUps").makeAck(a.details));a.metrics.receive.endFail("drop_unavailable_reaction_msg");a.metrics.receiveEU.endFail("drop_unavailable_reaction_msg");d("WALogger").ERROR(j());return!1}return!0})})["catch"](function(a){q(a,"process");return[]}).then(function(a){return{persist:function(){return v(a)}}})}function v(a){return d("WAIncomingMsgUtils").bulkSaveIncomingMsgs(a,e).then(function(a){return{followUp:function(){if(d("WAGlobals").getConfig().enableRawStanzaQueueStore())return w(a);else return x(a)}}})["catch"](function(a){q(a,"persist");return{followUp:function(){return b("Promise").resolve([])}}})}function w(a){for(var b=0;b<a.length;b++){var c=a[b];c.metrics.receive.addPoint("save_session");c.metrics.receiveEU.addPoint("save_session")}return r(a,h,1,e).then(function(a){a=a.map(d("WAIncomingMsgUtils").subtractRetries);a=d("WAIncomingMsg").sortReceiptByType(a);var b=a.acks,c=a.retries;a=a.getDevices;a.users.size>0&&d("WALogger").TAGS(["StanzaQueue"]).ERROR(i());p();return d("WAIncomingMsgUtils").sendRetryRequests({retries:c,acks:b})}).then(function(a){return d("WAIncomingMsgUtils").mapAcks(a).concat(g)})["catch"](function(a){q(a,"followUp");return[]})}function x(a){for(var b=0;b<a.length;b++){var c=a[b];c.metrics.receive.addPoint("save_session");c.metrics.receiveEU.addPoint("save_session")}return r(a,h,1,e).then(function(a){a=a.map(function(a){return d("WAIncomingMsgUtils").processSingleDBResult(a)});p();return d("WAIncomingMsg").splitActionsByType(a)}).then(function(a){return d("WAMessageHandlingFollowUps").processQueryGroupActions(a,e)}).then(function(a){return d("WAMessageHandlingFollowUps").processQueryGroupInviteActions(a,e)}).then(d("WAIncomingMsg").sortReceiptByType).then(function(a){var b=a.retries,c=a.acks,e=a.getDevices;a=a.queryGroup;p();return d("WAMessageHandlingFollowUps").processQueryGroups(Array.from(a.groupJids)).then(function(){return{retries:b,acks:c,getDevices:e}})}).then(function(a){var b=a.retries,c=a.acks;a=a.getDevices;p();return d("WAIncomingMsgUtils").scheduleGetDeviceRequests(a).then(function(){return{acks:c,retries:b}})}).then(d("WAIncomingMsgUtils").sendRetryRequests).then(function(a){return d("WAIncomingMsgUtils").mapAcks(a).concat(g)})["catch"](function(a){q(a,"followUp");return[]})}return{process:u}}function v(a,b){return u(a,b).process().then(function(a){a=a.persist;return a()}).then(function(a){a=a.followUp;return a()}).then(d("WAResultOrError").makeResult).then(function(a){if(a.success)return a.value;else{d("WALogger").ERROR(h(),a.error);return[]}})}g.handleMsg=a;g.makeBulkMsgsHandler=u}),98);
__d("WAHandleReceipt",["Promise","WAErr","WAGlobals","WAJids","WAJobDefinitions","WAJobs","WALogger","WAServerHandler","WAStanzaQueuePersistApi","WAStanzaUtils","WAWap","WAWapParser"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received deprecated format of self-thread message. Message type: ",". "," parsing ",". User device: ",". Message from: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Group chat with participant. Message type: ",". ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Canot parse: ",""]);j=function(){return a};return a}var k={sender:"sender",read:"read","server-error":"server-error",inactive:"inactive"},l={sender:"sender",read:"read",inactive:"inactive"};function m(a){var b=a.attrEnumOrDefault("type",l,"delivered"),e=a.maybeAttrString("category"),f=d("WAStanzaUtils").toStanzaId(a.attrString("id"));if(b==="delivered"&&e==="peer_appdata"){e=a.attrDeviceJid("from");var g=[d("WAStanzaUtils").toStanzaId(f)];a.hasChild("list")&&a.child("list").forEachChildWithTag("item",function(a){g.push(d("WAStanzaUtils").toStanzaId(a.attrString("id")))});return{offline:a.maybeAttrInt("offline"),stanzaId:f,from:e,type:b,externalIds:g,receiptType:"appdata"}}e=a.attrJidWithType("from");if(e.jidType==="group")if(a.hasChild("participants")){var k=[];a.child("participants").forEachChildWithTag("user",function(a){k.push({device:a.attrDeviceJid("jid"),ts:a.attrTime("t")})});return{receiptType:"group-server-agg",type:b,offline:a.maybeAttrInt("offline"),chat:a.attrGroupJid("from"),messageAuthor:"@me",stanzaId:f,externalId:d("WAStanzaUtils").toStanzaId(f),receivers:k}}else{var m="@me";if(a.hasAttr("participant")){var n=d("WAJids").extractUserJid(a.attrDeviceJid("participant"));if(d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())===n&&a.hasAttr("recipient"))try{m=a.attrUserJid("recipient")}catch(c){d("WALogger").WARN(j(),a);d("WALogger").ERROR(i(),b,c);throw c}}var o=[d("WAStanzaUtils").toStanzaId(f)];a.hasChild("list")&&a.child("list").forEachChildWithTag("item",function(a){o.push(d("WAStanzaUtils").toStanzaId(a.attrString("id")))});return{receiptType:"group",type:b,offline:a.maybeAttrInt("offline"),chat:a.attrGroupJid("from"),messageAuthor:m,stanzaId:f,from:a.attrFromJidChat(),externalIds:o,ts:a.attrTime("t")}}else if(e.jidType==="msgrDevice"){n="@me";m=d("WAJids").extractUserJid(e.deviceJid);if(d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())===m&&b!=="inactive"){try{m=a.attrUserJid("recipient")}catch(c){d("WALogger").WARN(h(),b,c,a,d("WAGlobals").getMyDeviceJid(),e.deviceJid)}b!=="sender"&&(n=m)}var p=[d("WAStanzaUtils").toStanzaId(f)];a.hasChild("list")&&a.child("list").forEachChildWithTag("item",function(a){p.push(d("WAStanzaUtils").toStanzaId(a.attrString("id")))});return{receiptType:"user",type:b,offline:a.maybeAttrInt("offline"),chat:m,messageAuthor:n,from:a.attrFromJidChat(),stanzaId:f,externalIds:p,ts:a.attrTime("t")}}else throw c("WAErr")('Received receipt from the jid with type "'+e.jidType+'"')}function a(a){a.assertTag("receipt");var b=a.attrEnumOrDefault("type",k,"delivered");if(b==="server-error"){var c=a.child("encrypt"),e=c.child("enc_p").contentBytes();c=c.child("enc_iv").contentBytes();var f=d("WAStanzaUtils").toStanzaId(a.attrString("id"));return{stanzaId:f,offline:a.maybeAttrInt("offline"),from:a.attrFromJidChat(),type:b,encProto:e,encIv:c}}else return m(a)}e=new(d("WAWapParser").WapParser)("receipt",a);function n(a){function c(){var c=[],f=[];for(var g=0;g<a.length;g++){var h=a[g];h.type==="server-error"?f.push(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.reuploadMedia(h.stanzaId,h.from.author,h.from.chat,h.encProto,h.encIv))):c.push(h)}return b("Promise").all(f).then(function(){return{persist:function(){return e(c)}}})}function e(a){return d("WAGlobals").getConfig().enableRawStanzaQueueStore()?d("WAStanzaQueuePersistApi").persistReceiptsTransaction(a).then(function(){return{followUp:f}}):d("WAGlobals").getDbImpls().bulkWriteReceipts(a.map(o)).then(function(){return{followUp:f}})}function f(){return b("Promise").resolve(a.map(function(a){return q(a)}))}return{process:c}}function o(a){if(a.receiptType==="appdata")return{type:"appdata",params:{externalIds:a.externalIds,receivers:[a.from]}};var b,c,d=a.chat;switch(a.receiptType){case"user":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;case"group":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;default:a.receiptType;c=[a.externalId];b=a.receivers;break}var e=a.messageAuthor;a=a.type;if(e==="@me"||a==="sender")return{type:"msg-receipt",params:{msgs:c.map(function(a){return{chat:d,author:"@me",externalId:a}}),type:a,receivers:b}};else return{type:"not-from-me",params:{msgs:c.map(function(a){return{chat:d,author:e,externalId:a}}),type:a,receivers:b}}}function p(a){return n(a).process().then(function(a){a=a.persist;return a()}).then(function(a){a=a.followUp;return a()})}f=d("WAServerHandler").serverHandler("handleReceipt",e,function(a){return p([a]).then(function(a){a=a[0];return a})});function q(a){var b=a.stanzaId,c=a.type,e;a.type==="server-error"?e=d("WAWap").TO_JID(a.from):a.receiptType==="appdata"?e=d("WAWap").DEVICE_JID(a.from):a.receiptType==="user"?e=d("WAWap").TO_JID(a.from):a.receiptType==="group"?e=d("WAWap").TO_JID(a.from):(a.receiptType,e=d("WAWap").GROUP_JID(a.chat));var f=d("WAWap").DROP_ATTR;a.receiptType==="group"&&(f=d("WAWap").PARTICIPANT_JID(a.from));return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(b),"class":"receipt",to:e,type:c!=="delivered"?c:d("WAWap").DROP_ATTR,participant:f})}g.parseReceipt=a;g.receiptParser=e;g.makeReceiptsHandler=n;g.receiptMapper=o;g.handleBulkParsedReceipts=p;g.handleReceipt=f;g.buildAckResponse=q}),98);
__d("WAIncomingStanza",[],(function(a,b,c,d,e,f){"use strict";a="notification";b="receipt";c="message";d="chatstate";e="retryReceipt";var g="appdata",h="failure",i="stream:error",j="ib",k="error",l="success",m="xmlstreamend",n="unknown",o={NOTIFICATION:a,RECEIPT:b,MESSAGE:c,CHATSTATE:d,RETRY_RECEIPT:e,APPDATA:g,FAILURE:h,STREAM_ERROR:i,IB:j,ERROR:k,UNKNOWN:n,SUCCESS:l,XML_STREAM_ERROR:m};f.NOTIFICATION=a;f.RECEIPT=b;f.MESSAGE=c;f.CHATSTATE=d;f.RETRY_RECEIPT=e;f.APPDATA=g;f.FAILURE=h;f.STREAM_ERROR=i;f.IB=j;f.ERROR=k;f.SUCCESS=l;f.XML_STREAM_ERROR=m;f.UNKNOWN=n;f.INCOMING_STANZA=o}),66);
__d("WAParseIncomingStanza",["WAIncomingStanza","WALogger","WAParsableWapNode","WAWapParser"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got stanza which cannot be parsed in offline queue ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Retry receipt stanza is in incorrect queue"]);i=function(){return a};return a}function a(a){return new(d("WAWapParser").WapParser)("parseBulkedStanza",function(b){switch(b.tag()){case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:var c=a.notification(b);return{type:d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION,stanza:c};case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:if(b.maybeAttrString("type")==="retry"){d("WALogger").ERROR(i());throw new(d("WAParsableWapNode").XmppParsingFailure)("parseBulkedStanza","received retry-receipt stanza")}c=a.receipt(b);return{type:d("WAIncomingStanza").INCOMING_STANZA.RECEIPT,stanza:c};case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:c=a.message(b);return{type:d("WAIncomingStanza").INCOMING_STANZA.MESSAGE,stanza:c};default:d("WALogger").ERROR(h(),b.tag());throw new(d("WAParsableWapNode").XmppParsingFailure)("parseBulkedStanza","expected one of: receipt, message, notification stanzas")}})}g.makeBulkedStanzaParser=a}),98);
__d("MAWBulkServerHandler",["MAWGlobals","MAWHandleNotification","Promise","WAHandleIncomingMsg","WAHandleNotification","WAHandleReceipt","WAIncomingMsgWapParser","WAIncomingStanza","WALogger","WAOfflineUtils","WAParseIncomingStanza","WAPromiseQueue","WAServerHandler","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Error during batch processing ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Cannot perform persist step ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Cannot process flush with ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Error during process step for receipts: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Error during process step for messages: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC][BulkServerHandler] Error during process step for notifications: ",""]);m=function(){return a};return a}function n(a){var b=[],c=null;for(var d=0;d<a.length;d++){var e=a[d];if(c==null){c={items:[e],type:e.type};continue}var f=c;f.type!==e.type?(b.push(f),c={items:[e],type:e.type}):f.items.push(e)}c!=null&&b.push(c);return b}function o(a){var b;a=a.filter(function(a){a=a.type;return a!=="message"}).reduce(function(a,b){var c=b.items;b=b.type;a[b]+=c.length;return a},{notification:0,receipt:0});(b=d("MAWGlobals").getServerRPC().offlineQueueManager())==null?void 0:(b=b.getStats())==null?void 0:b.track({processedStanzas:a})}function p(a){var b=new(d("WAPromiseQueue").PromiseQueue)(),c=[],e=function(){var e=a[f];switch(e.type){case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:var g=e.items;g=g.map(function(a){a=a.stanza;return d("MAWHandleNotification").makeNotificationStepHandler(a)});var h=function(){if(n){if(o>=i.length)return"break";p=i[o++]}else{o=i.next();if(o.done)return"break";p=o.value}var a=p;b.enqueue(function(){return a.process().then(function(a){c.push(a)})})["catch"](function(a){d("WALogger").ERROR(m(),a)})};for(var i=g,n=Array.isArray(i),o=0,i=n?i:i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;g=h();if(g==="break")break}break;case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:b.enqueue(function(){var a;return d("WAHandleIncomingMsg").makeBulkMsgsHandler(e.items.map(function(a){return a.stanza}),((a=d("MAWGlobals").getServerRPC().offlineQueueManager())==null?void 0:a.getStatus())===d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME?"offline":"online").process().then(function(a){c.push(a)})})["catch"](function(a){d("WALogger").ERROR(l(),a)});break;case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:b.enqueue(function(){return d("WAHandleReceipt").makeReceiptsHandler(e.items.map(function(a){return a.stanza})).process().then(function(a){return c.push(a)})})["catch"](function(a){d("WALogger").ERROR(k(),a)});break;default:d("WALogger").ERROR(j(),e.type)}};for(var f=0;f<a.length;f++)e();return b.wait().then(function(){return c})}function a(a,c){var e=n(a);return p(e).then(function(a){return d("MAWGlobals").getDbImpls().runInBulkTransaction(function(){return b("Promise").allSettled(a.map(function(a){a=a.persist;return a()}))})}).then(function(a){var b=[];for(var c=0;c<a.length;c++){var e=a[c];e.status==="rejected"?d("WALogger").ERROR(i(),e.reason):b.push(e.value)}return b}).then(function(a){var c,d,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=[],d=0;case 2:if(!(d<a.length)){h.next=12;break}e=a[d];f=e.followUp;h.next=7;return b("regeneratorRuntime").awrap(f());case 7:g=h.sent,c.push(g);case 9:d++;h.next=2;break;case 12:return h.abrupt("return",c);case 13:case"end":return h.stop()}},null,this)}).then(function(a){o(e);return a.flat()})["catch"](function(a){d("WALogger").ERROR(h(),a);return[]})}c=d("WAServerHandler").bulkServerHandler("bulkServerHandler",d("WAParseIncomingStanza").makeBulkedStanzaParser({message:d("WAIncomingMsgWapParser").parseIncomingMsg,notification:d("WAHandleNotification").parseNotification,receipt:d("WAHandleReceipt").parseReceipt}),a);g.handleBulkStanzas=c}),98);
__d("MAWDualSendMediaUtils",["Promise","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="generic_file";function i(a){if(a==="png")return"image/png";else if(a==="m4a")return"audio/m4a";else return"video/mov"}function a(a){switch(a){case"audio":return"audio";case"image":return"image";case"video":return"video";default:return null}}function d(a){switch(a){case"audio":return k();case"image":return j();case"video":return l()}}function j(){var a=c("bx").getURL(c("bx")("5359"));return m(a,"png")}function k(){var a=c("bx").getURL(c("bx")("5360"));return m(a,"m4a")}function l(){var a=c("bx").getURL(c("bx")("5361"));return m(a,"mov")}function m(a,c){var d=new XMLHttpRequest();return new(b("Promise"))(function(b,e){d.open("GET",a,!0),d.responseType="blob",d.onload=function(){var a=this.response;a=new File([a],h+"."+c,{type:i(c)});b(a)},d.onerror=function(a){return e("Failed to download dual send media")},d.send()})}g.convertStringToDualSendMediaType=a;g.downloadImageByFileType=d;g.downloadImageFile=j;g.downloadAudioFile=k;g.downloadVideoFile=l}),98);
__d("MAWCommonWorkerActions",["MAWDbDualSendTxns","MAWDbMsgTypeVersionTxns","MAWDexieTable","MAWDualSendApi","MAWDualSendCleanup","MAWDualSendMediaUtils","MAWDualSendSimplePermissionsManager.bs","MAWIndexedDb","MAWJids","MAWTransactionMode","Promise","SignalDbTypes","WALogger","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"]);i=function(){return a};return a}function j(a){return a.meta.bulkGet([d("SignalDbTypes").MetaKeysEnum.fbid,d("SignalDbTypes").MetaKeysEnum.deviceId,d("SignalDbTypes").MetaKeysEnum.cat,d("SignalDbTypes").MetaKeysEnum.regId,d("SignalDbTypes").MetaKeysEnum.identityKeyPair,d("SignalDbTypes").MetaKeysEnum.authKeyPair]).then(function(a){var b=a[0],e=a[1],f=a[2],g=a[3],h=a[4];a=a[5];d("WALogger").LOG(i());b=b==null?void 0:b.value.fbid;e=e==null?void 0:e.value.deviceId;f=f==null?void 0:f.value.cat;g=g==null?void 0:g.value.regId;h=h==null?void 0:h.value.identityKeyPair;a=a==null?void 0:a.value.authKeyPair;if(b==null)throw c("unrecoverableViolation")("fbid not set","messenger_e2ee_web");if(e==null)throw c("unrecoverableViolation")("deviceId not set","messenger_e2ee_web");if(f==null)throw c("unrecoverableViolation")("fbCat not set","messenger_e2ee_web");if(g==null||h==null)throw c("unrecoverableViolation")("regInfo not set","messenger_e2ee_web");return{deviceJid:d("MAWJids").toDeviceJid(d("MAWJids").toUserJid(b),e),fbCat:f.encrypted_serialized_cat,regInfo:{authKeyPair:a,regId:g,staticKeyPair:h},userJid:d("MAWJids").toUserJid(b)}})}function a(){return d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READONLY})(j)()}function e(){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY})(function(a){return d("MAWDbMsgTypeVersionTxns").getHMACKey(a).then(function(a){if(a==null){var b="HMACKey not set";d("WALogger").ERROR(h(),b);throw b}return a})})()}function f(){if(d("MAWDualSendSimplePermissionsManager.bs").isDualSendUser())return d("MAWIndexedDb").makeMsgrTransactor({isDualSend:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDbDualSendTxns").markAsDualSend(a,!0).then(function(a){})})();else return d("MAWDualSendApi").getDualSendVersion().then(function(a){if(a==null)return b("Promise").resolve();if(a===1)return d("MAWDualSendApi").deleteAllThreadsBecauseUserWasInDualSend().then(d("MAWDualSendApi").deleteDualSendEntries);else return d("MAWDualSendCleanup").cleanDualSendMessagingData()})}function k(){var a=["audio","image","video"],c=function(b){return a.map(function(a){return d("MAWDbDualSendTxns").getDualSendMediaRowByFileType(b,a).then(function(b){return{fileExists:!!b,fileType:a}})})},e=function(a){return b("Promise").all(a.filter(function(a){a=a.fileExists;return!a}).map(function(a){var b=a.fileType;return d("MAWDualSendMediaUtils").downloadImageByFileType(b).then(function(a){return{file:a,fileType:b}})}))};if(d("MAWDualSendSimplePermissionsManager.bs").isDualSendMediaUser())return d("MAWIndexedDb").makeMsgrTransactor({dualSendMedia:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDexieTable").dexieAll(c(a))["catch"](function(a){throw a}).then(function(b){e(b).then(function(b){b.map(function(b){var c=b.file;b=b.fileType;return d("MAWDbDualSendTxns").addFileToDualSendMediaTable(a,c,b)})})["catch"](function(a){throw a})["finally"](function(a){})})})();else return d("MAWIndexedDb").makeMsgrTransactor({dualSendMedia:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDbDualSendTxns").deleteDualSendMediaTable(a)})()}g.loadAllRegistrationMetaInTransaction=a;g.loadHMACKeyInTransaction=e;g.deleteThreadsIfWasPreviouslyInDualSend=f;g.downloadAndAddAllMissingDualSendMedia=k}),98);
__d("MAWDeviceInfo",["UserAgentData"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var b=a.prototype;b.get=function(){var a;return{osVersion:(a=c("UserAgentData").platformVersion)!=null?a:"",osBuild:(a=c("UserAgentData").platformVersion)!=null?a:"",hardware:c("UserAgentData").platformName,manufacturer:c("UserAgentData").platformName,device:[c("UserAgentData").browserName].join(" "),lg:"en",lc:"en",mcc:"000",mnc:"000",sim_mnc:"000",sim_mcc:"000"}};return a}();b=new a();g.deviceInfo=b}),98);
__d("WAWa5.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({DEFAULT:0,DEVX:1,INBOX:2});e=a({WHATSAPP:0,MESSENGER:1});f=a({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});b=a({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});var h=a({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5}),i=a({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2}),j=a({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4}),k=a({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});a=a({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28,WEAROS:29,ARDEVICE:30,VRDEVICE:31});var l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null),n=babelHelpers["extends"]({},null),o=babelHelpers["extends"]({},null),p=babelHelpers["extends"]({},null),q=babelHelpers["extends"]({},null),r=babelHelpers["extends"]({},null),s=babelHelpers["extends"]({},null),t=babelHelpers["extends"]({},null),u=babelHelpers["extends"]({},null),v=babelHelpers["extends"]({},null);l.internalSpec={clientHello:[2,d("WAProtoConst").TYPES.MESSAGE,o],serverHello:[3,d("WAProtoConst").TYPES.MESSAGE,n],clientFinish:[4,d("WAProtoConst").TYPES.MESSAGE,m]};m.internalSpec={"static":[1,d("WAProtoConst").TYPES.BYTES],payload:[2,d("WAProtoConst").TYPES.BYTES]};n.internalSpec={ephemeral:[1,d("WAProtoConst").TYPES.BYTES],"static":[2,d("WAProtoConst").TYPES.BYTES],payload:[3,d("WAProtoConst").TYPES.BYTES]};o.internalSpec={ephemeral:[1,d("WAProtoConst").TYPES.BYTES],"static":[2,d("WAProtoConst").TYPES.BYTES],payload:[3,d("WAProtoConst").TYPES.BYTES]};p.internalSpec={username:[1,d("WAProtoConst").TYPES.UINT64],passive:[3,d("WAProtoConst").TYPES.BOOL],userAgent:[5,d("WAProtoConst").TYPES.MESSAGE,u],webInfo:[6,d("WAProtoConst").TYPES.MESSAGE,s],pushName:[7,d("WAProtoConst").TYPES.STRING],sessionId:[9,d("WAProtoConst").TYPES.SFIXED32],shortConnect:[10,d("WAProtoConst").TYPES.BOOL],connectType:[12,d("WAProtoConst").TYPES.ENUM,b],connectReason:[13,d("WAProtoConst").TYPES.ENUM,h],shards:[14,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.INT32],dnsSource:[15,d("WAProtoConst").TYPES.MESSAGE,r],connectAttemptCount:[16,d("WAProtoConst").TYPES.UINT32],device:[18,d("WAProtoConst").TYPES.UINT32],devicePairingData:[19,d("WAProtoConst").TYPES.MESSAGE,q],product:[20,d("WAProtoConst").TYPES.ENUM,e],fbCat:[21,d("WAProtoConst").TYPES.BYTES],fbUserAgent:[22,d("WAProtoConst").TYPES.BYTES],oc:[23,d("WAProtoConst").TYPES.BOOL],lc:[24,d("WAProtoConst").TYPES.INT32],iosAppExtension:[30,d("WAProtoConst").TYPES.ENUM,i],fbAppId:[31,d("WAProtoConst").TYPES.UINT64],fbDeviceId:[32,d("WAProtoConst").TYPES.BYTES],pull:[33,d("WAProtoConst").TYPES.BOOL],paddingBytes:[34,d("WAProtoConst").TYPES.BYTES],bizMarketSegment:[35,d("WAProtoConst").TYPES.ENUM,c],yearClass:[36,d("WAProtoConst").TYPES.INT32],memClass:[37,d("WAProtoConst").TYPES.INT32]};q.internalSpec={eRegid:[1,d("WAProtoConst").TYPES.BYTES],eKeytype:[2,d("WAProtoConst").TYPES.BYTES],eIdent:[3,d("WAProtoConst").TYPES.BYTES],eSkeyId:[4,d("WAProtoConst").TYPES.BYTES],eSkeyVal:[5,d("WAProtoConst").TYPES.BYTES],eSkeySig:[6,d("WAProtoConst").TYPES.BYTES],buildHash:[7,d("WAProtoConst").TYPES.BYTES],deviceProps:[8,d("WAProtoConst").TYPES.BYTES]};r.internalSpec={dnsMethod:[15,d("WAProtoConst").TYPES.ENUM,f],appCached:[16,d("WAProtoConst").TYPES.BOOL]};s.internalSpec={refToken:[1,d("WAProtoConst").TYPES.STRING],version:[2,d("WAProtoConst").TYPES.STRING],webdPayload:[3,d("WAProtoConst").TYPES.MESSAGE,t],webSubPlatform:[4,d("WAProtoConst").TYPES.ENUM,j]};t.internalSpec={usesParticipantInKey:[1,d("WAProtoConst").TYPES.BOOL],supportsStarredMessages:[2,d("WAProtoConst").TYPES.BOOL],supportsDocumentMessages:[3,d("WAProtoConst").TYPES.BOOL],supportsUrlMessages:[4,d("WAProtoConst").TYPES.BOOL],supportsMediaRetry:[5,d("WAProtoConst").TYPES.BOOL],supportsE2EImage:[6,d("WAProtoConst").TYPES.BOOL],supportsE2EVideo:[7,d("WAProtoConst").TYPES.BOOL],supportsE2EAudio:[8,d("WAProtoConst").TYPES.BOOL],supportsE2EDocument:[9,d("WAProtoConst").TYPES.BOOL],documentTypes:[10,d("WAProtoConst").TYPES.STRING],features:[11,d("WAProtoConst").TYPES.BYTES]};u.internalSpec={platform:[1,d("WAProtoConst").TYPES.ENUM,a],appVersion:[2,d("WAProtoConst").TYPES.MESSAGE,v],mcc:[3,d("WAProtoConst").TYPES.STRING],mnc:[4,d("WAProtoConst").TYPES.STRING],osVersion:[5,d("WAProtoConst").TYPES.STRING],manufacturer:[6,d("WAProtoConst").TYPES.STRING],device:[7,d("WAProtoConst").TYPES.STRING],osBuildNumber:[8,d("WAProtoConst").TYPES.STRING],phoneId:[9,d("WAProtoConst").TYPES.STRING],releaseChannel:[10,d("WAProtoConst").TYPES.ENUM,k],localeLanguageIso6391:[11,d("WAProtoConst").TYPES.STRING],localeCountryIso31661Alpha2:[12,d("WAProtoConst").TYPES.STRING],deviceBoard:[13,d("WAProtoConst").TYPES.STRING]};v.internalSpec={primary:[1,d("WAProtoConst").TYPES.UINT32],secondary:[2,d("WAProtoConst").TYPES.UINT32],tertiary:[3,d("WAProtoConst").TYPES.UINT32],quaternary:[4,d("WAProtoConst").TYPES.UINT32],quinary:[5,d("WAProtoConst").TYPES.UINT32]};g.ClientPayload$BizMarketSegment=c;g.ClientPayload$Product=e;g.ClientPayload$DNSSource$DNSResolutionMethod=f;g.ClientPayload$ConnectType=b;g.ClientPayload$ConnectReason=h;g.ClientPayload$IOSAppExtension=i;g.ClientPayload$WebInfo$WebSubPlatform=j;g.ClientPayload$UserAgent$ReleaseChannel=k;g.ClientPayload$UserAgent$Platform=a;g.HandshakeMessageSpec=l;g.HandshakeMessage$ClientFinishSpec=m;g.HandshakeMessage$ServerHelloSpec=n;g.HandshakeMessage$ClientHelloSpec=o;g.ClientPayloadSpec=p;g.ClientPayload$DevicePairingRegistrationDataSpec=q;g.ClientPayload$DNSSourceSpec=r;g.ClientPayload$WebInfoSpec=s;g.ClientPayload$WebInfo$WebdPayloadSpec=t;g.ClientPayload$UserAgentSpec=u;g.ClientPayload$UserAgent$AppVersionSpec=v}),98);
__d("MAWClientPayload",["MAWAppVersion","MAWDeviceInfo","MAWGating","MAWGlobals","WAArrayBufferUtils","WAJids","WALongInt","WAWa5.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWGlobals").getMyDeviceJid();a=d("WAJids").extractDeviceIDParts(a);var b=a.deviceID;a=a.userId;b=babelHelpers["extends"]({},h(),{device:b,fbCat:d("MAWGlobals").getFbCat(),fbUserAgent:d("WAArrayBufferUtils").stringToArrayBuffer(navigator.userAgent),product:d("WAWa5.pb").ClientPayload$Product.MESSENGER,username:d("WALongInt").decimalStringToLongInt(a)});return d("encodeProtobuf").encodeProtobuf(d("WAWa5.pb").ClientPayloadSpec,b).readByteArray()}function h(){return{connectReason:d("WAWa5.pb").ClientPayload$ConnectReason.USER_ACTIVATED,connectType:d("WAWa5.pb").ClientPayload$ConnectType.WIFI_UNKNOWN,passive:!1,pull:d("MAWGating").isPullModeEnabled(),userAgent:i()}}function i(){var a=d("MAWDeviceInfo").deviceInfo.get(),b=d("MAWAppVersion").getAppVersionParts();return{appVersion:b,device:a.device,localeCountryIso31661Alpha2:a.lc,localeLanguageIso6391:a.lg,manufacturer:a.manufacturer,mcc:a.mcc,mnc:a.mnc,osBuildNumber:a.osBuild,osVersion:a.osVersion,platform:d("WAWa5.pb").ClientPayload$UserAgent$Platform.WEB,releaseChannel:d("WAWa5.pb").ClientPayload$UserAgent$ReleaseChannel.DEBUG}}g.getClientPayload=a}),98);
__d("WACert.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a=babelHelpers["extends"]({},null);b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);a.internalSpec={details:[1,d("WAProtoConst").TYPES.BYTES],signature:[2,d("WAProtoConst").TYPES.BYTES]};b.internalSpec={serial:[1,d("WAProtoConst").TYPES.UINT32],issuer:[2,d("WAProtoConst").TYPES.STRING],expires:[3,d("WAProtoConst").TYPES.UINT64],subject:[4,d("WAProtoConst").TYPES.STRING],key:[5,d("WAProtoConst").TYPES.BYTES]};c.internalSpec={leaf:[1,d("WAProtoConst").TYPES.MESSAGE,e],intermediate:[2,d("WAProtoConst").TYPES.MESSAGE,e]};e.internalSpec={details:[1,d("WAProtoConst").TYPES.BYTES],signature:[2,d("WAProtoConst").TYPES.BYTES]};f.internalSpec={serial:[1,d("WAProtoConst").TYPES.UINT32],issuerSerial:[2,d("WAProtoConst").TYPES.UINT32],key:[3,d("WAProtoConst").TYPES.BYTES],notBefore:[4,d("WAProtoConst").TYPES.UINT64],notAfter:[5,d("WAProtoConst").TYPES.UINT64]};g.NoiseCertificateSpec=a;g.NoiseCertificate$DetailsSpec=b;g.CertChainSpec=c;g.CertChain$NoiseCertificateSpec=e;g.CertChain$NoiseCertificate$DetailsSpec=f}),98);
__d("WACryptoCurve25519",["Promise","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Curve25519.generateSharedSecret pubkey:",""]);h=function(){return a};return a}a=function(){function a(a,c){this.signalDependencies=a,this.keyPair=c?b("Promise").resolve(c):this.signalDependencies.generateIdentityKeyPair()}var c=a.prototype;c.generatePublicKey=function(){return this.keyPair.then(function(a){return a.publicKey})};c.generateSharedSecret=function(a){var b=this;return this.keyPair.then(function(c){c=c.privateKey;d("WALogger").LOG(h(),a).devConsole(c);return b.signalDependencies.calculateAgreement(new Uint8Array(a),c)})};return a}();g.Curve25519=a}),98);
__d("WAGetRoutingInfoApi",["WAGlobals","regeneratorRuntime"],(function(a,b,c,d,e,f,g){a=function(){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.MetaInfoStore;f.next=3;return b("regeneratorRuntime").awrap(c.get());case 3:d=f.sent;e=d.edgeInfo;return f.abrupt("return",{edgeInfo:e==null?null:e});case 6:case"end":return f.stop()}},null,this)},"getRoutingInfo")};g.getRoutingInfo=a}),98);
__d("WASignalCertificateSignatures",["Promise","WACert.pb","WACryptoUtils","WAErr","WALongInt","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h={ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:"142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b"};function i(a,c,e){a=d("WASignalSignatures").convertPublicKeyToSerializedPubKey(a);e=d("WASignalOther").toBytes(e,64);return b("Promise").resolve(d("WASignalSignatures").verifyMsgSignalVariant(a,c,e))}function a(a){var b=a.cert;a=a.serverStatic;var e=d("decodeProtobuf").decodeProtobuf(d("WACert.pb").NoiseCertificate$DetailsSpec,b.details);if(e.issuer!==h.ISSUER)throw c("WAErr")('verifyCertificate unrecognized issuer "'+String(e.issuer)+'"');var f=d("WALongInt").maybeNumberOrThrowIfTooLarge(e.expires);if(f!=null&&f<=d("WATimeUtils").unixTime())throw c("WAErr")("verifyCertificate cert has expired");if(!e.key)throw c("WAErr")("verifyCertificate cert has no key detail");if(!d("WACryptoUtils").arrayBuffersEqual(e.key,a))throw c("WAErr")("verifySignature cert key does not match issuer");return i(d("WASignalSignatures").convertPublicKeyHexToUint8Array(h.PUBLIC_KEY),new Uint8Array(b.details),b.signature).then(function(a){if(!a)throw c("WAErr")("verifyCertificate cert poorly signed!")})}g.verifyCertificateSignature=i;g.verifyCertificate=a}),98);
__d("WATreasureHunt",["Promise","WAResultOrError"],(function(a,b,c,d,e,f,g){var h=new(b("Promise"))(function(){});function a(a,c,e,f){var g=0,i=0,j=!1,k=null,l=null;function m(a){if(!j){j=!0;k!=null&&(clearTimeout(k),k=null);return d("WAResultOrError").makeResult(a)}else{f==null?void 0:f(a);return h}}function n(){if(j)return h;i++;if(i===c)return b("Promise").resolve(d("WAResultOrError").makeError("max-hunters"));var a=l;a!=null&&i===g&&(k!=null&&(clearTimeout(k),k=null),a());return h}function o(){var d=g++;d=a(d).then(m,n);if(g<c){var f=new(b("Promise"))(function(a){k=setTimeout(a,e),l=a}).then(o);return b("Promise").race([d,f])}else return d}return o()}g.treasureHunt=a}),98);
__d("WAConnectivityReports",["WALogger","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Connectivity]: ",". Reason: ",", clean: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Connectivity]: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Connectivity]: ",""]);j=function(){return a};return a}function a(a,b){d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_DISCONNECT).endSuccess({string:{key:"code"+b.code}});a=a!=null?"WebSocket "+a+" closed. code: "+b.code:"WebSocket closed connection during initialization. Code: "+b.code;switch(b.code){case 1e3:case 1001:case 1006:d("WALogger").LOG(j(),a);break;case 1002:case 1003:case 1007:case 1008:case 1009:case 1010:case 1011:case 1015:d("WALogger").ERROR(i(),a);break;default:d("WALogger").ERROR(h(),a,b.reason,b.wasClean);break}}g.onWebSocketCloseEvent=a}),98);
__d("WAWebSocketTransport",["Promise","WABinary","WAConnectivityReports","WAErr","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WebSocket #"," not opened"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WebSocket #"," errored: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["WebSocket #"," dropped "," bytes"]);j=function(){return a};return a}var k=1,l=function(){function a(a){var b=this;this.$2=!1;this.onData=null;this.onClose=null;this.onError=null;this.dataToSend=new(d("WABinary").Binary)();this.$3=function(a){if(b.$2)return;a=new Uint8Array(a.data);b.onData?b.onData(a):d("WALogger").ERROR(j(),b.id,a.length)};this.$4=function(a){d("WAConnectivityReports").onWebSocketCloseEvent(b.id,a);if(b.$2)return;b.$6()};this.$5=function(a){d("WALogger").DEV(i(),b.id,a);if(b.$2)return;var c=b.onError;c&&c(String(a))};var c=k++;this.id=c;this.$1=a;a.onmessage=this.$3;a.onclose=this.$4;a.onerror=this.$5}var b=a.prototype;b.close=function(){if(this.$2)return;this.$1.close();this.$6()};b.requestSend=function(){if(this.$2){d("WALogger").ERROR(h(),this.id);return}if(!this.dataToSend.size())return;this.$1.send(this.dataToSend.readBuffer())};b.$6=function(){this.$2=!0,this.onClose&&this.onClose()};return a}();function a(a){var e=new WebSocket(a);e.binaryType="arraybuffer";return new(b("Promise"))(function(a,b){e.onopen=a,e.onclose=function(a){d("WAConnectivityReports").onWebSocketCloseEvent(null,a),b(c("WAErr")("WebSocket closed immediately: "+a.reason+" "+a.code))}}).then(function(){return new l(e)})}g.openWebSocket=a}),98);
__d("MAWChatSocketPlatformDetails",["MAWClientPayload","URI","WABase64","WACert.pb","WACryptoCurve25519","WACryptoCurve25519Dependencies","WAErrors","WAGetRoutingInfoApi","WAHex","WALogger","WALongInt","WASignalCertificateSignatures","WATreasureHunt","WAWa5.pb","WAWapDict","WAWebSocketTransport","decodeProtobuf","encodeProtobuf","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["openSocketWithLoop (round ",") failed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openSocketWithLoop (round ",") to "," succeeded"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["openSocketWithLoop (round ",") connecting to ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["openSocketWithLoop"]);k=function(){return a};return a}var l="wss://web-chat-e2ee.facebook.com/ws/chat";function m(a){return d("encodeProtobuf").encodeProtobuf(d("WAWa5.pb").HandshakeMessageSpec,{clientHello:a}).readByteArray()}function n(a){return d("encodeProtobuf").encodeProtobuf(d("WAWa5.pb").HandshakeMessageSpec,{clientFinish:a}).readByteArray()}function o(a){return d("decodeProtobuf").decodeProtobuf(d("WAWa5.pb").HandshakeMessageSpec,a).serverHello}function p(a){return d("decodeProtobuf").decodeProtobuf(d("WACert.pb").NoiseCertificateSpec,a)}function q(a){var b=a.certificate;a=a.serverStatic;b=p(b);var e=b.details;b=b.signature;if(!e)throw new(c("err"))("noiseFullHandshake cert missing details");if(!b)throw new(c("err"))("noiseFullHandshake cert missing signature");var f={details:e,signature:b};return d("WASignalCertificateSignatures").verifyCertificate({cert:f,serverStatic:a}).then(function(){var a=d("decodeProtobuf").decodeProtobuf(d("WACert.pb").NoiseCertificate$DetailsSpec,f.details);d("WALongInt").maybeNumberOrThrowIfTooLarge(a.expires)})}function r(){return null}function s(){d("WALogger").DEV(k());function a(a){var e=new(c("URI"))(l).toString(),f=function(){var a,c,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WAGetRoutingInfoApi").getRoutingInfo());case 2:a=h.sent;c=a.edgeInfo;f=void 0;c&&(f="?ED="+d("WABase64").encodeB64UrlSafe(c));g=""+e+(f!=null?f:"");return h.abrupt("return",d("WAWebSocketTransport").openWebSocket(g));case 8:case"end":return h.stop()}},null,this)};d("WALogger").LOG(j(),a,e);return f().then(function(b){d("WALogger").LOG(i(),a,e);return b})["catch"](function(b){d("WALogger").WARN(h(),a,b).devConsole(b);throw b})}return d("WATreasureHunt").treasureHunt(a,3,15e3,function(a){return void a.close()})["catch"](function(a){if(!navigator.onLine)throw new(d("WAErrors").Offline)("offline when openSocketWithLoop treasureHunt failed");throw a})}function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(d("WAGetRoutingInfoApi").getRoutingInfo());case 2:c=g.sent;e=c.edgeInfo==null?null:d("WAHex").bytesToBuffer(c.edgeInfo);f=new Uint8Array([87,65,5,d("WAWapDict").DICT_VERSION]);return g.abrupt("return",{curveSignalDependencies:d("WACryptoCurve25519Dependencies").CURVE25519_SIGNAL_DEPENDENCIES,decodeServerHello:o,edgeInfo:e,encodeHandshakeFinish:n,encodeHandshakeHello:m,getClientPayload:d("MAWClientPayload").getClientPayload,openSocket:s,processCertificate:q,protoHeader:f,serverInfoIfKnown:r,staticKeyPair:new(d("WACryptoCurve25519").Curve25519)(d("WACryptoCurve25519Dependencies").CURVE25519_SIGNAL_DEPENDENCIES,a)});case 6:case"end":return g.stop()}},null,this)}g.getChatSocketPlatformDetails=a}),98);
__d("WADevToolsStanzaViewer",["WADevToolsBridge","WASmaxParseUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").attrInt(a,"t");c=c.success?d("WATimeUtils").castToUnixTime(c.value):d("WATimeUtils").unixTime();d("WADevToolsBridge").getDevToolBridge().fireAndForget("devtool","newStanza",{ts:c,type:a.tag,isOutgoing:b,stanza:a.toString()})}g.sendNewStanzaToDevTool=a}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,(a=a)!=null?a:c)||this;a.name=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength,d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);this.$8(c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArray(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WALogger","WAPromiseQueue","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);j=function(){return a};return a}a=b("Promise").reject("UNINITIALIZED HANDSHAKE");var k=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(j()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(i())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(n(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.sendFrame(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};c.sendFrame=function(a){if(this.$9)return b("Promise").resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(h(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(m(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function l(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function m(a,b,c,d){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:l(b),additionalData:c?new Uint8Array(c):k},a,d)}function n(a,b,c,d){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:l(b),additionalData:c?new Uint8Array(c):k},a,d)}g.NoiseSocket=c}),98);
__d("WANoiseHandshake",["Promise","WABinary","WACryptoHkdf","WACryptoSha256","WAErrors","WANoiseSocket","WAResolvable"],(function(a,b,c,d,e,f,g){var h=b("Promise").reject("UNINITIALIZED HANDSHAKE"),i=new Uint8Array(0);h["catch"](function(){});a=function(){function a(a){var b=this;this.$2=h;this.$3=h;this.$4=h;this.$5=0;this.$1=a;this.$6=new(d("WAResolvable").Resolvable)();a.onClose=function(){b.$6.reject(new(d("WAErrors").Disconnected)("NoiseHandshake: SocketClosed"))};o(this.$6.promise)}var c=a.prototype;c.start=function(a,c){a=d("WABinary").Binary.build(a).readBuffer();a=a.byteLength===32?b("Promise").resolve(a):d("WACryptoSha256").sha256(a);this.$2=a;this.$3=a;this.$4=a.then(k);this.authenticate(c)};c.sendAndReceive=function(a){var c=this.$1,d=new(b("Promise"))(function(b){c.onFrame=function(a){c.onFrame=null,b(a)},c.sendFrame(a)});return this.$7(d)};c.send=function(a){this.$1.sendFrame(a)};c.authenticate=function(a){this.$2=b("Promise").all([this.$2,a]).then(function(a){var b=a[0];a=a[1];b=d("WABinary").Binary.build(b,a).readByteArray();return d("WACryptoSha256").sha256(b)})};c.encrypt=function(a){var c=this.$5++;a=b("Promise").all([this.$4,this.$2,a]).then(function(a){var b=a[0],d=a[1];a=a[2];return l(b,c,d,a)});this.authenticate(a);return this.$7(a)};c.decrypt=function(a){var c=this.$5++,d=b("Promise").all([this.$4,this.$2]).then(function(b){var d=b[0];b=b[1];return m(d,c,b,a)});this.authenticate(a);return this.$7(d)};c.finish=function(){var a=this,c=this.$3.then(function(a){return n(a,new Uint8Array(0))}).then(function(a){var c=a[0];a=a[1];return b("Promise").all([k(c,["encrypt"]),k(a,["decrypt"])])}).then(function(b){var c=b[0];b=b[1];return new(d("WANoiseSocket").NoiseSocket)(a.$1,c,b)});return this.$7(c)};c.mixIntoKey=function(a){this.$5=0;a=b("Promise").all([this.$3,a]).then(function(a){var b=a[0];a=a[1];return n(b,new Uint8Array(a))});this.$3=a.then(function(a){return a[0]});this.$4=a.then(function(a){return k(a[1])});o(this.$3);o(this.$4)};c.$7=function(a){var c=this;return b("Promise").race([a,this.$6.promise]).then(function(a){return c.$6.resolveWasCalled()?c.$6.promise:a})};return a}();function j(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function k(a,b){b===void 0&&(b=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",new Uint8Array(a),"AES-GCM",!1,b)}function l(a,b,c,d){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:j(b),additionalData:c?new Uint8Array(c):i},a,d)}function m(a,b,c,d){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:j(b),additionalData:c?new Uint8Array(c):i},a,d)}function n(a,b){return d("WACryptoHkdf").extractWithSaltAndExpand(b,new Uint8Array(a),"",64).then(function(a){return[a.slice(0,32),a.slice(32)]})}function o(a){a["catch"](function(){})}g.NoiseHandshake=a}),98);
__d("WAOpenChatSocket",["Promise","WABinary","WACryptoCurve25519","WAErr","WAFrameSocket","WALogger","WANoiseHandshake","WAResultOrError"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket performing full handshake"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket performing resume handshake"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket preIntro ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFallbackHandshake continuing handshake with given server hello"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake performing fallback handshake"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake deriving secrets"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake continuing resume handshake"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake rcv hello"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake send hello"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullNoiseHandshake rcv hello"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullNoiseHandshake send hello"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFullHandshakeCore client finish and deriving secrets"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFullHandshakeCore parsing and verifying server certificate"]);t=function(){return a};return a}var u="Noise_XX_25519_AESGCM_SHA256\0\0\0\0",v="Noise_IK_25519_AESGCM_SHA256\0\0\0\0",w="Noise_XXfallback_25519_AESGCM_SHA256";function x(a,e,f,g,h){e=e||{};var i=e.ephemeral,j=e["static"];e=e.payload;if(i==null||j==null||e==null)return b("Promise").reject(c("WAErr")("doFullHandshakeCore server hello invalid proto"));a.authenticate(i);a.mixIntoKey(g.generateSharedSecret(i));j=a.decrypt(j);a.mixIntoKey(j.then(function(a){return g.generateSharedSecret(a)}));e=a.decrypt(e);return b("Promise").all([j,e]).then(function(a){var b=a[0];a=a[1];d("WALogger").LOG(t());return h.processCertificate({certificate:a,serverStatic:b})}).then(function(){var c=a.encrypt(h.staticKeyPair.generatePublicKey());a.mixIntoKey(h.staticKeyPair.generateSharedSecret(i));var d=a.encrypt(b("Promise").resolve(f));return b("Promise").all([c,d])}).then(function(b){var c=b[0];b=b[1];d("WALogger").LOG(s());a.send(h.encodeHandshakeFinish({"static":c,payload:b}));return a.finish()})}function y(a,b,c,e){var f=new(d("WANoiseHandshake").NoiseHandshake)(a);f.start(u,e.protoHeader);a=c.generatePublicKey();f.authenticate(a);return a.then(function(a){d("WALogger").LOG(r());return f.sendAndReceive(e.encodeHandshakeHello({ephemeral:a}))}).then(function(a){d("WALogger").LOG(q());a=e.decodeServerHello(a);return x(f,a,b,c,e)})}function z(a,e,f,g,h){var i=new(d("WANoiseHandshake").NoiseHandshake)(a);i.start(v,h.protoHeader);var j=g.generatePublicKey();i.authenticate(f);i.authenticate(j);i.mixIntoKey(g.generateSharedSecret(f));var k=i.encrypt(h.staticKeyPair.generatePublicKey());i.mixIntoKey(h.staticKeyPair.generateSharedSecret(f));f=i.encrypt(b("Promise").resolve(e));return b("Promise").all([j,f,k]).then(function(b){var a=b[0],c=b[1];b=b[2];d("WALogger").LOG(p());return i.sendAndReceive(h.encodeHandshakeHello({ephemeral:a,payload:c,"static":b}))}).then(function(b){d("WALogger").LOG(o());b=h.decodeServerHello(b);var f=b||{},j=f.ephemeral,k=f["static"];f=f.payload;if(k==null){d("WALogger").LOG(n());if(!j)throw c("WAErr")("serverHello missing serverEphemeral");if(!f)throw c("WAErr")("serverHello missing certificateCiphertext");i.authenticate(j);i.mixIntoKey(g.generateSharedSecret(j));i.mixIntoKey(h.staticKeyPair.generateSharedSecret(j));return i.decrypt(f).then(function(){d("WALogger").LOG(m());return i.finish()})}else{d("WALogger").LOG(l());return A(a,b,e,g,h)}})}function A(a,b,c,e,f){a=new(d("WANoiseHandshake").NoiseHandshake)(a);a.start(w,f.protoHeader);var g=e.generatePublicKey();a.authenticate(g);d("WALogger").LOG(k());return x(a,b,c,e,f)}function a(a,c){return a.openSocket().then(d("WAResultOrError").onResult(function(e){b("Promise").resolve().then(c);var f=void 0,g=a.edgeInfo;if(g){var k=new(d("WABinary").Binary)();k.write("ED",0,1);k.writeUint8(g.byteLength>>16);k.writeUint16(g.byteLength&65535);k.writeBuffer(g);f=k.readByteArray();d("WALogger").LOG(j(),f)}g=a.getClientPayload();k=new(d("WACryptoCurve25519").Curve25519)(a.curveSignalDependencies);f=f?d("WABinary").Binary.build(f,a.protoHeader).readByteArray():a.protoHeader;e=new(d("WAFrameSocket").FrameSocket)(e,f);f=a.serverInfoIfKnown();if(f){d("WALogger").LOG(i());return z(e,g,f.staticKey,k,a)}else{d("WALogger").LOG(h());return y(e,g,k,a)}}))}g.doFullHandshake=y;g.openChatSocket=a}),98);
__d("WASetClockSkewApi",["WAGlobals"],(function(a,b,c,d,e,f,g){a=function(a){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(b){b=b.MetaInfoStore;return b.patch(a)},"setClockSkew")};g.setClockSkew=a}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]);h=function(){return a};return a}function a(){d("WALogger").LOG(h()),d("WAComms").sendPing()}function c(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:d("WATimeUtils").setClockSkew(a);c.next=3;return b("regeneratorRuntime").awrap(d("WASetClockSkewApi").setClockSkew({clockSkew:a}));case 3:case"end":return c.stop()}},null,this)}g.sendPing=a;g.updateClockSkew=c}),98);
__d("MAWCommsConfig",["MAWChatSocketPlatformDetails","WAComms","WADevToolsStanzaViewer","WALogger","WAOpenChatSocket","WASendPing","WATimeUtils","gkx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["comms change: ",""]);h=function(){return a};return a}function i(a){d("WALogger").LOG(h(),a),a==="connected"&&d("WAComms").startHandlingRequests()}function a(a){var e,f,g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=a.authKeyPair,f=a.handleConnectionChange,g=a.handleOptimisticConnectionChange;j.next=3;return b("regeneratorRuntime").awrap(d("MAWChatSocketPlatformDetails").getChatSocketPlatformDetails(e));case 3:h=j.sent;return j.abrupt("return",{deadSocketTime:2e4,handlers:{onCastStanza:function(a){c("gkx")("5147")&&d("WADevToolsStanzaViewer").sendNewStanzaToDevTool(a,!0)},onClockSkewUpdate:function(a){var b=d("WATimeUtils").getClockSkew();Math.abs(b-a)>10&&d("WASendPing").updateClockSkew(a)},onConnectionChange:function(a){f==null?void 0:f(a),i(a)},onHandleStanza:function(a){c("gkx")("5147")&&d("WADevToolsStanzaViewer").sendNewStanzaToDevTool(a,!1)},onOptimisticConnectionChange:function(a){g==null?void 0:g(a)}},healthCheckInterval:20,maxSocketLoopWaitTime:6e4,openChatSocket:function(a){return d("WAOpenChatSocket").openChatSocket(h,a)},shouldBlockReceivingUntilSuccess:!1,shouldCloseStaleSocket:!0});case 5:case"end":return j.stop()}},null,this)}g.baseOnConnectionChange=i;g.getCommsConfig=a}),98);
__d("WAJobBuilder",["Promise","WAPersistedJobManager","WATimeUtils"],(function(a,b,c,d,e,f,g){var h=function(){function a(a){this.steps=a}var b=a.prototype;b.step=function(a,b){return this.$1(a,typeof b==="function"?{code:b}:b)};b.$1=function(b,c){var e=c.stopRetryIf,f=c.requirements;c=c.code;f=j(f,c,e);if(e){var g=e.timePassedSeconds;c=e.appCrashed;var h=e.onStopRetry;h=j(null,k(h),e);g!=null&&(f=i(function(a,b,c){a=c.jobStartTime;return d("WATimeUtils").happenedWithin(a,g)},f,h));c&&(f=i(function(a,b,c){a=c.afterCrash;return!a},f,h))}return new a([].concat(this.steps,[{stepName:b,info:f}]))};b.finalStep=function(a,b){var c=this.step(a,b);return{end:function(){return c.steps}}};return a}();function a(){return new h([])}function i(a,b,c){return function(d,e,f){return a(d,e,f)?b(d,e,f):c(d,e,f)}}function j(a,b,c){var d={requirements:a,code:b,stopRetryIf:c};return function(){return d}}function k(a){return function(c,e,f){return b("Promise").resolve(a(c,e,f)).then(function(a){return a instanceof d("WAPersistedJobManager").InterruptJob?a:new(d("WAPersistedJobManager").InterruptJob)(a)})}}g.JobBuilder=h;g.definePersistedJob=a}),98);
__d("MAWDefinePersistedJob",["MAWGlobals","Promise","WAJobBuilder"],(function(a,b,c,d,e,f,g){"use strict";c={definePersistedJob:function(){return d("WAJobBuilder").definePersistedJob()}};function a(a){var c=d("MAWGlobals").getJobManager();Object.keys(a).forEach(function(d){var e=a[d];c.addPersistedJobImplementation(d,function(){return b("Promise").resolve(e)})})}g.persistedJobsApi=c;g.setMsgrJobImplementations=a}),98);
__d("WAAppData",[],(function(a,b,c,d,e,f){"use strict";a=1;b=2;f.EPOCH_STATUS_OPEN=a;f.EPOCH_STATUS_CLOSE=b}),66);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a=babelHelpers["extends"]({},null);b=babelHelpers["extends"]({},null);c=babelHelpers["extends"]({},null);e=babelHelpers["extends"]({},null);f=babelHelpers["extends"]({},null);var h=babelHelpers["extends"]({},null),i=babelHelpers["extends"]({},null),j=babelHelpers["extends"]({},null),k=babelHelpers["extends"]({},null),l=babelHelpers["extends"]({},null),m=babelHelpers["extends"]({},null);a.internalSpec={payload:[1,d("WAProtoConst").TYPES.MESSAGE,c],metadata:[2,d("WAProtoConst").TYPES.MESSAGE,b]};b.internalSpec={};c.internalSpec={applicationData:[1,d("WAProtoConst").TYPES.MESSAGE,e],signal:[2,d("WAProtoConst").TYPES.MESSAGE,m],__oneofs__:{payload:["applicationData","signal"]}};e.internalSpec={appStateSyncKeyShare:[1,d("WAProtoConst").TYPES.MESSAGE,h],appStateSyncKeyRequest:[2,d("WAProtoConst").TYPES.MESSAGE,f],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}};f.internalSpec={keyIds:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,l]};h.internalSpec={keys:[1,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,i]};i.internalSpec={keyId:[1,d("WAProtoConst").TYPES.MESSAGE,l],keyData:[2,d("WAProtoConst").TYPES.MESSAGE,j]};j.internalSpec={keyData:[1,d("WAProtoConst").TYPES.BYTES],fingerprint:[2,d("WAProtoConst").TYPES.MESSAGE,k],timestamp:[3,d("WAProtoConst").TYPES.INT64]};k.internalSpec={rawId:[1,d("WAProtoConst").TYPES.UINT32],currentIndex:[2,d("WAProtoConst").TYPES.UINT32],deviceIndexes:[3,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").FLAGS.PACKED|d("WAProtoConst").TYPES.UINT32]};l.internalSpec={keyId:[1,d("WAProtoConst").TYPES.BYTES]};m.internalSpec={};g.MultiDeviceSpec=a;g.MultiDevice$MetadataSpec=b;g.MultiDevice$PayloadSpec=c;g.MultiDevice$ApplicationDataSpec=e;g.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=f;g.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=h;g.MultiDevice$ApplicationData$AppStateSyncKeySpec=i;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=j;g.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=k;g.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=l;g.MultiDevice$SignalSpec=m}),98);
__d("MAWConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAJids","WALogger","WALongInt","WAMultiDevice.pb","WAStanzaUtils","WASyncdKeyManagementUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""]);v=function(){return a};return a}function w(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function x(a){a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="msgrDevice")return d("WAJids").extractUserJid(a.deviceJid);else{a.jidType;throw c("err")("Incorrect jid type: "+a.jidType)}}function y(a){return a!=null?typeof a==="number"&&a>d("WATimeUtils").MAX_INT?d("WATimeUtils").castMilliSecondsToUnixTime(a):d("WATimeUtils").castLongIntToUnixTime(a):void 0}function z(a){return a==null?void 0:{lastMessageTimestamp:y(a.lastMessageTimestamp),lastSystemMessageTimestamp:y(a.lastSystemMessageTimestamp),messages:a.messages==null?[]:a.messages.map(function(a){return{ts:y(a.timestamp),key:a.key==null?void 0:{id:a.key.id,fromMe:a.key.fromMe}}})}}function A(a,b){var c=a.chatId;if(c==null){d("WALogger").WARN(v(),a);return null}if(a.chatArchive!=null){var e=a.chatArchive;e=z(e.messageRange);return{type:"chat_archive",chatJid:w(c),ts:b,messageRange:e}}else if(a.chatDelete!=null){e=a.chatDelete;e=z(e.messageRange);return{type:"chat_delete",chatJid:w(c),ts:b,messageRange:e}}else if(a.chatRead!=null){e=a.chatRead;var f=z(e.messageRange);return{type:"chat_read",chatJid:w(c),read:e.read,ts:b,messageRange:f}}else{d("WALogger").WARN(u(),a);return null}}function B(a){var b=a.key,c=b==null?void 0:b.remoteJid,e=b==null?void 0:b.id,f=b==null?void 0:b.fromMe;if(b==null||c==null||f==null||e==null){d("WALogger").WARN(t(),a);return null}var g=w(c),h=d("WAJids").interpretAsGroupJid(g)!=null;if(h&&!f){if((b==null?void 0:b.participant)==null){d("WALogger").WARN(s(),a);return null}h=x(b.participant)}else f?h=d("WAJids").AUTHOR_ME:h=x(c);b={chat:g,author:h,externalId:d("WAStanzaUtils").toStanzaId(e)};if(a.messageDelete!=null)return{type:"delete_for_me",protocolMsgId:b};else{d("WALogger").WARN(r(),a);return null}}function C(a){var b=[];for(var c=0;c<a.length;c++){var e=a[c],f=y(e.actionTimestamp);if(e.chatAction!=null){f=A(e.chatAction,f);f!=null&&b.push({chatAction:f})}else if(e.messageAction!=null){f=B(e.messageAction);f!=null&&b.push({messageAction:f})}else d("WALogger").WARN(q(),e)}return b}function D(a){var b=a.status,c=a.id,e=a.anonId;a=a.rootKey;if(b==null||c==null||e==null||a==null){d("WALogger").WARN(p());return null}var f;if(b===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)f=d("WAAppData").EPOCH_STATUS_OPEN;else if(b===d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)f=d("WAAppData").EPOCH_STATUS_CLOSE;else{d("WALogger").WARN(o());return null}return{id:c,anonId:e,rootKey:a,status:f}}function E(a){var b=a.backupId,c=a.serverDataId,e=a.tempOcmfClientState,f=a.mailboxRootKey,g=a.obliviousValidationToken;a=a.epoch;if(b==null||c==null||e==null||f==null||g==null){d("WALogger").WARN(n());return null}return{backupId:b,serverDataId:c,tempOcmfClientState:e,mailboxRootKey:f,obliviousValidationToken:g,epoch:a.map(D).reduce(function(a,b){if(b!=null)return a.concat([b]);else return a},[])}}function F(a){var b;if(((b=a.applicationData)==null?void 0:(b=b.metadataSync)==null?void 0:b.actions)!=null){return{type:"meta_sync",actions:C((b=a.applicationData)==null?void 0:(b=b.metadataSync)==null?void 0:b.actions)}}else if(((b=a.signal)==null?void 0:b.encryptedBackupsSecrets)!=null){b=E(a.signal.encryptedBackupsSecrets);return b==null?null:{type:"backups_secrets",encryptedBackupsSecrets:b}}else{d("WALogger").WARN(m(),a);return null}}function G(a){var b,c,e,f,g,h;if(((b=a.keyId)==null?void 0:b.keyId)==null){d("WALogger").WARN(l());return null}b=d("WASyncdKeyTypes").toSyncKeyId(a.keyId.keyId);c=(c=a.keyData)==null?void 0:c.keyData;e=d("WALongInt").maybeNumberOrThrowIfTooLarge((e=a.keyData)==null?void 0:e.timestamp);f=(f=a.keyData)==null?void 0:(f=f.fingerprint)==null?void 0:f.currentIndex;g=(g=a.keyData)==null?void 0:(g=g.fingerprint)==null?void 0:g.deviceIndexes;h=(h=a.keyData)==null?void 0:(h=h.fingerprint)==null?void 0:h.rawId;return a.keyData==null||c==null||e==null||f==null||g==null||h==null?{type:"orphan",keyId:b}:{type:"key",keyData:{keyId:b,keyData:d("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:d("WASyncdKeyManagementUtils").getKeyEpoch(b),timestamp:e,fingerprint:{currentIndex:f,deviceIndexes:g,rawId:h}}}}function H(a){var b=[],c=[];for(var a=a.keys,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;f=G(f);f!=null&&(f.type==="orphan"?c.push(f.keyId):(f.type,b.push(f.keyData)))}return{keys:b,orphanKeys:c}}function I(a){var b=[];for(var a=a.keyIds,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;f.keyId!=null&&b.push(d("WASyncdKeyTypes").toSyncKeyId(f.keyId))}return{keyIds:b}}function J(a){var b;if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare)!=null){return{type:"sync_key_share",syncKeyShare:H((b=a.applicationData)==null?void 0:b.appStateSyncKeyShare)}}else if(((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest)!=null){return{type:"sync_key_request",syncKeyRequest:I((b=a.applicationData)==null?void 0:b.appStateSyncKeyRequest)}}else{d("WALogger").WARN(k(),a);return null}}function a(a){if(a.subprotocolType==="armadillo"){var b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return F(b.payload)}else if(a.subprotocolType==="multiDevice"){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMultiDevice.pb").MultiDeviceSpec,a.payload);if(b.payload==null)throw c("err")("Appdata contains unparseable armadillo data.");return J(b.payload)}else throw c("err")("Appdata contains unexpected message application: "+a.subprotocolType)}function K(a){return a==null?void 0:{lastMessageTimestamp:a.lastMessageTimestamp,lastSystemMessageTimestamp:a.lastSystemMessageTimestamp,messages:a.messages.map(function(a){return{timestamp:a.ts,key:a.key==null?void 0:{id:a.key.id,fromMe:a.key.fromMe}}})}}function L(a){switch(a.type){case"meta_sync":return{payload:{applicationData:T(a)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:R(a.encryptedBackupsSecrets)}}};default:a.type;d("WALogger").WARN(j(),a.type);return{}}}function M(a){return{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a)}}function N(a){return{keyId:M(a.keyId),keyData:{keyData:d("WASyncdKeyTypes").fromSyncKeyData(a.keyData),timestamp:a.timestamp,fingerprint:{rawId:a.fingerprint.rawId,currentIndex:a.fingerprint.currentIndex,deviceIndexes:a.fingerprint.deviceIndexes}}}}function O(a){var b=a.keys.map(N);a=a.orphanKeys==null?[]:a.orphanKeys.map(function(a){return{keyId:M(a)}});b.push.apply(b,a);return{keys:b}}function P(a){return{keyIds:a.keyIds.map(M)}}function Q(a){switch(a.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:O(a.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:P(a.syncKeyRequest)}}};default:a.type;d("WALogger").WARN(i(),a.type);return{}}}function b(a){var b;switch(a.type){case"meta_sync":case"backups_secrets":var c=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,L(a));b={armadillo:{payload:c.readByteArray(),version:1}};break;case"sync_key_share":case"sync_key_request":c=d("encodeProtobuf").encodeProtobuf(d("WAMultiDevice.pb").MultiDeviceSpec,Q(a));b={multiDevice:{payload:c.readByteArray(),version:1}};break;default:a.type,d("WALogger").WARN(h(),a.type),b={}}return{payload:{subProtocol:b}}}function R(a){return{backupId:a.backupId,serverDataId:a.serverDataId,epoch:a.epoch.map(S),tempOcmfClientState:a.tempOcmfClientState,mailboxRootKey:a.mailboxRootKey,obliviousValidationToken:a.obliviousValidationToken}}function S(a){var b;a.status===d("WAAppData").EPOCH_STATUS_OPEN?b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:a.status===d("WAAppData").EPOCH_STATUS_CLOSE&&(b=d("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE);return{id:a.id,anonId:a.anonId,rootKey:a.rootKey,status:b}}function T(a){return{metadataSync:{actions:a.actions.map(function(a){if(a.chatAction)return{actionTimestamp:a.chatAction.ts,chatAction:U(a.chatAction)};else return{messageAction:V(a.messageAction)}})}}}function U(a){var b=K(a.messageRange),c=a.chatJid;switch(a.type){case"chat_archive":return{chatId:c,chatArchive:{archived:a.archived,messageRange:b}};case"chat_delete":return{chatId:c,chatDelete:{messageRange:b}};default:a.type;return{chatId:c,chatRead:{read:a.read,messageRange:b}}}}function V(a){if(a.type==="delete_for_me"){var b=a.protocolMsgId.chat,e=d("WAJids").interpretAsGroupJid(b)!=null;return{messageDelete:{},key:{remoteJid:b,fromMe:d("WAJids").isAuthorMe(a.protocolMsgId.author),participant:!d("WAJids").isAuthorMe(a.protocolMsgId.author)&&e?a.protocolMsgId.author:void 0,id:a.protocolMsgId.externalId}}}else throw c("err")("No other available type")}g.parseArmadilloAppData=F;g.parseSyncKeyRequest=I;g.parseMultiDeviceAppData=J;g.parseAppData=a;g.convertArmadilloAppData=L;g.convertMultiDeviceAppData=Q;g.convertAppData=b}),98);
__d("WASyncdHandleKeyRequest",["Promise","WAGetSyncKey","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=[];e=[];f.next=4;return b("regeneratorRuntime").awrap(b("Promise").all(a.map(function(a){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getSyncKeyInTransaction_DO_NOT_USE(a));case 2:f=g.sent,f?c.push(f):e.push(a);case 4:case"end":return g.stop()}},null,this)})));case 4:return f.abrupt("return",{keys:c,orphanKeys:e});case 5:case"end":return f.stop()}},null,this)}g.getKeysForKeyRequest=a}),98);
__d("WASyncdHandleKeyShare",["Promise","WAGetSyncKey","WALogger","WASyncd","WASyncdCryptoUtils","WASyncdStoreMissingKeys","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: stored key share key id "," from device ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: key share from device "," has no keys with keydata."]);i=function(){return a};return a}function a(a,c){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c.some(function(a){return a.fullKey!=null})||d("WALogger").LOG(i(),a);e.next=3;return b("regeneratorRuntime").awrap(b("Promise").all(c.map(function(c){var e,f,g;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=c.keyId,f=c.fullKey;if(!(f==null)){i.next=3;break}return i.abrupt("return");case 3:i.next=5;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").getSyncKeyInTransaction_DO_NOT_USE(e));case 5:g=i.sent;if(g){i.next=10;break}i.next=9;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").setSyncKeyInTransaction(f));case 9:d("WALogger").LOG(h(),d("WASyncdCryptoUtils").syncKeyIdToHex(e),a);case 10:case"end":return i.stop()}},null,this)})));case 3:e.next=5;return b("regeneratorRuntime").awrap(d("WASyncdStoreMissingKeys").updateMissingKeys(c.map(function(a){var b=a.keyId;a=a.fullKey;return{keyId:b,keyData:a==null?void 0:a.keyData}}),a));case 5:return e.abrupt("return",d("WASyncd").syncBlockedCollections());case 6:case"end":return e.stop()}},null,this)}g.handleKeyShare=a}),98);
__d("MAWHandleKeyUtil",["MAWGlobals","MAWJobDefinitions","WAJids","WASyncdHandleKeyRequest","WASyncdHandleKeyShare","WASyncdMetricCriticalBootstrapStage","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){d("WASyncdMetricCriticalBootstrapStage").reportSyncdCriticalBootstrapStage(d("WASyncdMetricCriticalBootstrapStage").SyncdCriticalBootstrapStageType.MISSING_KEYS_RECEIVED);var c=b.keys.map(function(a){return{fullKey:a,keyId:a.keyId}});if(b.orphanKeys!=null){c.push.apply(c,(b=b.orphanKeys)==null?void 0:b.map(function(a){return{fullKey:null,keyId:a}}))}return d("WASyncdHandleKeyShare").handleKeyShare(d("WAJids").extractDeviceId(a),c)}function c(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WASyncdHandleKeyRequest").getKeysForKeyRequest(c.keyIds));case 2:e=h.sent;f=e.keys;g=e.orphanKeys;h.next=7;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:{syncKeyShare:{keys:f,orphanKeys:g},type:"sync_key_share"},deviceIds:[d("WAJids").extractDeviceId(a)]})));case 7:case"end":return h.stop()}},null,this)}g.handleSyncKeyShare=a;g.handleSyncKeyRequest=c}),98);
__d("MAWHandleAppDataUtil",["MAWConvertAppData","MAWGlobals","MAWHandleKeyUtil","WAComms","WACryptoManagerUtils","WALogger","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WAReceiptUtils","WAResultOrError","WASyncdDisabled","WAWap","decodeProtobuf","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ignored AppData sync key request"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ignored AppData sync key share"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata ",""]);k=function(){return a};return a}function a(a){var e,f,g,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:d("WALogger").DEV(k(),a);e=a.encs,f=a.from;if(!(e.length!==1)){u.next=4;break}throw c("err")("Appdata should contain one message, this one has: "+e.length);case 4:g=e[0];u.next=7;return b("regeneratorRuntime").awrap(l(g,f));case 7:o=u.sent;if(o.success){u.next=13;break}u.next=11;return b("regeneratorRuntime").awrap(n(a));case 11:u.next=50;break;case 13:p=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,o.value);q=d("WAParseMessageTransport").parseMessageTransport(p,null);if(!(q.type!=="applicationPayload")){u.next=17;break}throw c("err")("Appdata contains unexpected message transport.");case 17:r=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,q.applicationPayload.payload);s=d("WAParseMessageApplication").parseMessageApplication(r);if(!(s.type==="error")){u.next=21;break}throw c("err")("Appdata contains unparseable message application.");case 21:t=d("MAWConvertAppData").parseAppData(s);if(!(t!=null)){u.next=48;break}u.t0=t.type;u.next=u.t0==="meta_sync"?26:u.t0==="backups_secrets"?29:u.t0==="sync_key_share"?32:u.t0==="sync_key_request"?39:46;break;case 26:u.next=28;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeMetaSyncs(t.actions));case 28:return u.abrupt("break",48);case 29:u.next=31;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().handleEncryptedBackupsSecret(t.encryptedBackupsSecrets));case 31:return u.abrupt("break",48);case 32:if(d("WASyncdDisabled").isSyncdDisabled()){u.next=37;break}u.next=35;return b("regeneratorRuntime").awrap(d("MAWHandleKeyUtil").handleSyncKeyShare(f,t.syncKeyShare));case 35:u.next=38;break;case 37:d("WALogger").WARN(j());case 38:return u.abrupt("break",48);case 39:if(d("WASyncdDisabled").isSyncdDisabled()){u.next=44;break}u.next=42;return b("regeneratorRuntime").awrap(d("MAWHandleKeyUtil").handleSyncKeyRequest(f,t.syncKeyRequest));case 42:u.next=45;break;case 44:d("WALogger").WARN(i());case 45:return u.abrupt("break",48);case 46:t.type,d("WALogger").WARN(h(),t.type);case 48:u.next=50;return b("regeneratorRuntime").awrap(m(a));case 50:return u.abrupt("return","NO_ACK");case 51:case"end":return u.stop()}},null,this)}function l(a,e){var f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(!(a.e2eType==="skmsg")){i.next=2;break}throw c("err")("Appdata should not contain skmsg encs");case 2:i.next=4;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").decryptMsg(a.e2eType,e,a.ciphertext,a.retryCount));case 4:g=i.sent;if(!(g.success&&((f=g.value)==null?void 0:f.plaintext)!=null)){i.next=7;break}return i.abrupt("return",d("WAResultOrError").makeResult((h=g.value)==null?void 0:h.plaintext));case 7:if(!g.success){i.next=9;break}throw c("err")("Failed to parse appdata for unknown reason.");case 9:return i.abrupt("return",d("WAResultOrError").makeError("identity-missing"));case 10:case"end":return i.stop()}},null,this)}function m(a){var b=a.externalId;a=a.from;d("WAComms").deprecatedCastStanza(d("WAWap").wap("receipt",{category:"peer_appdata",id:d("WAWap").CUSTOM_STRING(b),to:d("WAWap").DEVICE_JID(a)}))}function n(a){var b=a.encs,c=a.externalId,e=a.from;a=a.ts;return d("WAReceiptUtils").sendRetryReceipt({category:"peer_appdata",deviceIdentity:null,externalId:c,from:{deviceJid:e,type:"device"},participant:null,recipient:null,retryCount:b[0].retryCount,ts:a})}g.handleParsedAppData=a}),98);
__d("MAWHandleAppData",["MAWHandleAppDataUtil","WAParseEnc","WAServerHandler","WAStanzaUtils","WAWapParser","err"],(function(a,b,c,d,e,f,g){"use strict";a=new(d("WAWapParser").WapParser)("appdataParser",function(a){a.assertTag("appdata");var b=a.attrJidWithType();if(b.jidType!=="msgrDevice")throw c("err")("Incorrect from type in appdata message: "+b.jidType);return{externalId:d("WAStanzaUtils").toStanzaId(a.attrString("id")),from:b.deviceJid,ts:a.attrTime("t"),encs:a.mapChildrenWithTag("enc",d("WAParseEnc").parseEncNode)}});b=d("WAServerHandler").serverHandler("handleAppdata",a,d("MAWHandleAppDataUtil").handleParsedAppData);g.appdataParser=a;g.handleAppdata=b}),98);
__d("WASmaxInChatstateComposingMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"composing");if(!b.success)return b;a=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,b.value,"media","audio");return!a.success?a:d("WAResultOrError").makeResult({composingMedia:a.value})}g.parseComposingMixin=a}),98);
__d("WASmaxInChatstatePausedMixin",["WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"paused");return!b.success?b:d("WASmaxParseUtils").voidSuccess}g.parsePausedMixin=a}),98);
__d("WASmaxInChatstateComposingOrPausedMixinGroup",["WAResultOrError","WASmaxInChatstateComposingMixin","WASmaxInChatstatePausedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInChatstateComposingMixin").parseComposingMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"Composing",value:b.value});var c=d("WASmaxInChatstatePausedMixin").parsePausedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"Paused",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Composing","Paused"],[b,c])}g.parseComposingOrPausedMixinGroup=a}),98);
__d("WASmaxInChatstateFromGroupMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"from");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(a,"participant");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,participant:a.value})}g.parseFromGroupMixin=a}),98);
__d("WASmaxInChatstateFromUserMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");return!b.success?b:d("WAResultOrError").makeResult({from:b.value})}g.parseFromUserMixin=a}),98);
__d("WASmaxInChatstateFromUserOrGroupMixinGroup",["WAResultOrError","WASmaxInChatstateFromGroupMixin","WASmaxInChatstateFromUserMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInChatstateFromUserMixin").parseFromUserMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FromUser",value:b.value});var c=d("WASmaxInChatstateFromGroupMixin").parseFromGroupMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FromGroup",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["FromUser","FromGroup"],[b,c])}g.parseFromUserOrGroupMixinGroup=a}),98);
__d("WASmaxInChatstateServerNotificationRequest",["WAResultOrError","WASmaxInChatstateComposingOrPausedMixinGroup","WASmaxInChatstateFromUserOrGroupMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxInChatstateFromUserOrGroupMixinGroup").parseFromUserOrGroupMixinGroup(a);if(!b.success)return b;a=d("WASmaxInChatstateComposingOrPausedMixinGroup").parseComposingOrPausedMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({fromUserOrGroupMixinGroup:b.value,composingOrPausedMixinGroup:a.value})}g.parseServerNotificationRequest=a}),98);
__d("WAHandleChatState",["WAErr","WASmaxInChatstateServerNotificationRequest"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=d("WASmaxInChatstateServerNotificationRequest").parseServerNotificationRequest(a);if(!a.success)throw c("WAErr")("Failed to parse chat state notification");var b=a.value.composingOrPausedMixinGroup,e;b.name==="Paused"?e="idle":(b.name,e=b.value.composingMedia==="audio"?"recording_audio":"typing");b=a.value.fromUserOrGroupMixinGroup;if(b.name==="FromUser")return{type:"user",status:e,jid:b.value.from};else{b.name;return{type:"group",status:e,jid:b.value.from,participant:b.value.participant}}}g.parseChatState=a}),98);
__d("MAWHandleChatState",["MAWBridge","MAWBridgeTypes","MAWGlobals","Promise","WAHandleChatState","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleChatStatus status for ",": ",""]);h=function(){return a};return a}function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:c=d("WAHandleChatState").parseChatState(a);d("WALogger").LOG(h(),c.jid,c.status);i.next=4;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getThreadIdByJid(c.jid));case 4:e=i.sent;e!=null&&(f=c.type==="user"?c.jid:c.participant,g={tag:"ReceivedChatState",value:d("MAWBridgeTypes").createBridgeReceivedChatState(e,f,c.status)},d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[g]}));return i.abrupt("return",b("Promise").resolve("NO_ACK"));case 7:case"end":return i.stop()}},null,this)}g.handleChatState=a}),98);
__d("WAHandleFailure",["WAWapParser"],(function(a,b,c,d,e,f,g){a=new(d("WAWapParser").WapParser)("failureParser",function(a){a.assertTag("failure");return{reason:a.attrInt("reason",400,599),location:a.attrString("location"),expire:a.hasAttr("expire")?a.attrInt("expire"):null}});g.failureParser=a}),98);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){b={GENERIC_FAILURE:400,NOT_AUTHORIZED:401,TEMP_BANNED:402,BANNED:403,CAT_EXPIRED:413,CAT_INVALID:414,NOT_FOUND:415,INTERNAL_ERROR:500,SERVER_UNAVAILABLE:503};function h(){return d("WAGlobals").getDbImpls().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}g.FAILURE_CODES=b;g.clearRegistrationAndTempData=h;g.deregisterPhone=a}),98);
__d("MAWHandleFailure",["MAWRotateCAT","Promise","WAHandleFailure","WAHandleFailureUtils","WALogger","WAPREList","WAPREMetrics","WAServerHandler","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["failure reason "," not implemented yet"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleFailure: got failure code ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crypto auth token Error: ",", rotating CAT"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received <failure> stanza with "," code. DeregisterPhone"]);k=function(){return a};return a}function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_FAILURE_STANZA,{"int":{code:a.reason},string:{type:"failure"}});e.t0=a.reason;e.next=e.t0===d("WAHandleFailureUtils").FAILURE_CODES.GENERIC_FAILURE?4:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.NOT_AUTHORIZED?4:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.TEMP_BANNED?4:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.BANNED?4:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.NOT_FOUND?4:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.CAT_EXPIRED?8:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.CAT_INVALID?8:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.INTERNAL_ERROR?12:e.t0===d("WAHandleFailureUtils").FAILURE_CODES.SERVER_UNAVAILABLE?12:14;break;case 4:d("WALogger").WARN(k(),a.reason);e.next=7;return b("regeneratorRuntime").awrap(d("WAHandleFailureUtils").deregisterPhone());case 7:return e.abrupt("break",16);case 8:d("WALogger").WARN(j(),a.reason);e.next=11;return b("regeneratorRuntime").awrap(d("MAWRotateCAT").rotateCAT());case 11:return e.abrupt("break",16);case 12:d("WALogger").WARN(i(),a.reason);return e.abrupt("break",16);case 14:d("WALogger").WARN(h(),a.reason);return e.abrupt("return",b("Promise").reject("failure reason "+a.reason+" not implemented yet"));case 16:c.endSuccess();return e.abrupt("return",b("Promise").resolve("NO_ACK"));case 18:case"end":return e.stop()}},null,this)}c=d("WAServerHandler").serverHandler("handleFailure",d("WAHandleFailure").failureParser,a);g.handleFailure=c}),98);
__d("MAWBulkGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY})(function(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.appData.where("externalId").anyOf(c).toArray().then(function(a){var c=new Map(a.map(function(a){return[a.externalId,a]}));return b.map(function(a){var b=a.deviceJid;a=a.externalId;a=c.get(a);if(a==null)return{type:"missing"};b=a.permittedIdentitiesPerDevice.get(b);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})})});g.bulkGetAppDataForRetry=a}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";b="image/jpeg";e="video/mp4";f="audio/wav";var h="image/gif",i="image/webp";function a(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return j(a);default:return c("WAAssertUnreachable")(a.type)}}function j(a){var b={payload:{content:{messageText:{mentionedJid:[],text:a.msgContent.content}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}g.IMAGE_MIME_TYPE=b;g.VIDEO_MIME_TYPE=e;g.AUDIO_MIME_TYPE=f;g.GIF_MIME_TYPE=h;g.STICKER_MIME_TYPE=i;g.asConsumerApplication=a;g.encodeTextMessage=j}),98);
__d("WAAsMessageApplication",["WAAsConsumerApplication","WAConsumerApplication.pb","WAFranking","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;switch(a.type){default:b=d("WAAsConsumerApplication").asConsumerApplication(a)}var c=a.forwardingScore!=null?a.forwardingScore:0;a=a.isForwarded!=null?a.isForwarded:!1;c={metadata:{chatEphemeralSetting:null,forwardingScore:c,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:a,quotedMessage:null}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);c.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c).readByteArray()}function b(a){return a}g.asMessageApplication=a;g.castToMessageApplicationBytes=b}),98);
__d("WACryptoPkcs7",["WAErr"],(function(a,b,c,d,e,f,g){function a(a){var b=new Uint8Array(1);do self.crypto.getRandomValues(b);while(b[0]===0);h(a,b[0])}function b(a){var b=new Uint8Array(1);self.crypto.getRandomValues(b);h(a,(b[0]&15)+1)}function h(a,b){for(var c=0;c<b;c++)a.writeUint8(b)}function d(a){if(a.length===0)throw c("WAErr")("unpadPkcs7 given empty bytes");var b=a[a.length-1];if(b>a.length)throw c("WAErr")("unpadPkcs7 given "+a.length+" bytes, but pad is "+b);return new Uint8Array(a.buffer,a.byteOffset,a.length-b)}g.writeRandomPad=a;g.writeRandomPadMax16=b;g.writePad=h;g.unpadPkcs7=d}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7"],(function(a,b,c,d,e,f,g){function a(a,b,c,e){var f;b!=null&&(f={destinationJid:b});var g;a!=null&&(g={applicationPayload:{payload:a,version:2}});b=new(d("WABinary").Binary)();d("WACryptoPkcs7").writeRandomPadMax16(b);return{payload:g,protocol:{integral:{padding:b.readBuffer(),dsm:f},ancillary:{skdm:c==null?void 0:c,icdc:e==null?void 0:e}}}}g.asMessageTransport=a}),98);
__d("WAProtocolMediaType",[],(function(a,b,c,d,e,f){function a(a){switch(a){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":case"product":return a;case"xma-image":return"document";default:return null}}f.castToProtocolMediaType=a}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAErr","WAGlobals","WALogger","WAMsgTransport.pb","WAProtocolMediaType","WAWap","encodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""]);h=function(){return a};return a}function a(a,b,c,e,f,g){var l;switch(b.type){case"message":l=i({messageBytes:b.messageBytes,to:a,icdc:g,chat:b.chat});break;case"appdata":l=j({messageBytes:b.messageBytes});break;default:b.type,l=k({skdm:b.skdm,icdc:g})}g=d("WACryptoManagerUtils").encryptMsgWithMetrics(a,l,e,f,b==null?void 0:b.chat);return g.then(function(a){var e;if(!a.success){d("WALogger").ERROR(h(),a.error);return null}var f=b.type==="message"&&b.messageType.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(b.messageType.mediaType):null,g=a.value,i=g.type;g=g.ciphertext;return{node:d("WAWap").wap("enc",{v:d("WAWap").CUSTOM_STRING(((e=b.messageBytes)==null?void 0:e.version)==="v2"?"2":"3"),type:d("WAWap").CUSTOM_STRING(i),mediatype:(e=f)!=null?e:d("WAWap").DROP_ATTR,count:(c==null?void 0:c.count)!=null?d("WAWap").INT(c.count):d("WAWap").DROP_ATTR},g),baseKey:a.value.baseKey}})}function i(a){var b=a.messageBytes,c=a.to,e=a.icdc;a=a.chat;if(b.version==="v3"){var f=null;d("WAGlobals").isPeerDevice(c)&&(f=a);a=d("WAAsMessageTransport").asMessageTransport(b.bytes,f,null,e);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArray()}else if(d("WAGlobals").isPeerDevice(c))return b.bytesForPeer;else return b.bytes}function j(a){a=a.messageBytes;if(a.version==="v3"){a=d("WAAsMessageTransport").asMessageTransport(a.bytes);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,a).readByteArray()}else throw c("WAErr")("Plaintext v2 not supported yet")}function k(a){var b=a.skdm;a=a.icdc;b=d("WAAsMessageTransport").asMessageTransport(null,null,b,a);return d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray()}g.getEncNode=a}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WALogger","WASortedLists"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"]);i=function(){return a};return a}function a(a){d("WALogger").LOG(i());a=d("WASortedLists").sortAndDedupe(a);var c=new(d("WABinary").Binary)();for(var e=0;e<a.length;e++)c.writeString(a[e]);return b("Promise").resolve(self.crypto.subtle.digest("SHA-256",c.readByteArray()).then(function(a){d("WALogger").LOG(h());a=new Uint8Array(a,0,6);return"2:"+d("WABase64").encodeB64(a)}))}g.calculatePHash=a}),98);
__d("WAEncUserMsg",["Promise","WAEncNode","WAGlobals","WAICDCUtils","WAJids","WALogger","WAPhash","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["participant userJid is different with chatJid in 1:1 chat"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- DONE for JID "," in chat ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- encNode -- NULL"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no other recipient"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"]);r=function(){return a};return a}function a(a,c,e){d("WALogger").LOG(r());a.length===0&&d("WALogger").ERROR(q());var f=a.find(function(a){return a.user===d("WAGlobals").getMyUserJid()});f==null&&(f={user:d("WAGlobals").getMyUserJid(),devicesInfo:[]});var g=a.filter(function(a){return a.user!==d("WAGlobals").getMyUserJid()});g.length===0&&c.type!=="appdata"&&d("WALogger").ERROR(p());var h=null;d("WAGlobals").getConfig().isICDCEnabled()&&(h=d("WAICDCUtils").computeICDCParticipantDevices(f,g,e));d("WALogger").LOG(o());f=a.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});return b("Promise").all([s(f,c,h),d("WAPhash").calculatePHash(f.concat(d("WAGlobals").getMyDeviceJid()))]).then(function(a){var b=a[0];a=a[1];d("WALogger").LOG(n());return{participants:b,phash:a}})}function c(a,b){return s(a,b)}function s(a,b,c){return t(a,b,c).then(function(a){if(a.length===0){d("WALogger").WARN(m());return}return d("WAWap").wap("participants",null,a)})}function e(a,b,c,e,f){return d("WAEncNode").getEncNode(a,b,c,e,f)}function t(a,c,e){var f=!1;d("WALogger").LOG(l());(c.type!=="message"||d("WAJids").interpretAsGroupJid(c.chat)!=null)&&(f=!0);a=a.map(function(a){return d("WAEncNode").getEncNode(a,c,void 0,void 0,void 0,e).then(function(b){if(b==null){d("WALogger").ERROR(k());return null}d("WALogger").LOG(j(),a,c.chat);var e=d("WAJids").extractUserJid(a);f=f||c.type==="message"&&e===c.chat;c.type==="message"&&d("WAJids").interpretAsGroupJid(c.chat)==null&&e!==d("WAGlobals").getMyUserJid()&&e!==c.chat&&d("WALogger").ERROR(i());return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a)},b.node)})});return b("Promise").all(a).then(function(a){if(f)return a;else{d("WALogger").ERROR(h());return[]}}).then(function(a){return a.filter(Boolean)})}g.encryptUserMsg=a;g.encryptGroupFanoutMsg=c;g.encryptDeviceJidMessage=e}),98);
__d("MAWSendAppDataUtils",["MAWBridge","MAWConvertAppData","MAWGlobals","MAWJobDefinitions","WAAsMessageApplication","WAComms","WAEncUserMsg","WALogger","WAMsgApplication.pb","WAOdsEnums","WAWap","WAWapParser","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendAppData Failed to encrypt appdata"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"]);k=function(){return a};return a}function a(a,c,e,f,g){var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;return b("regeneratorRuntime").async(function(F){while(1)switch(F.prev=F.next){case 0:n=d("MAWConvertAppData").convertAppData(a);o={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray()),version:"v3"};p=null;q=null;r=null;s=null;if(!(f==null)){F.next=19;break}t=Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return{identity:a.pubKey,jid:b}});u=d("MAWGlobals").getConfig().maxAppDataRecipients();t.length>u&&(d("WALogger").WARN(k(),t.length),d("WALogger").ERROR(j(),u),t=t.slice(0,u));v=[{devicesInfo:t,user:d("MAWGlobals").getMyUserJid()}];F.next=13;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptUserMsg(v,{messageBytes:o,type:"appdata"},[]));case 13:w=F.sent;p=g===!0?null:w.phash;q=w.participants;r=d("WAWap").USER_JID(d("MAWGlobals").getMyUserJid());F.next=26;break;case 19:x=f.encProps,y=f.identityKey,z=f.sessionInfo,A=f.to;F.next=22;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptDeviceJidMessage(A,{messageBytes:o,type:"appdata"},x,z,y));case 22:B=F.sent,r=d("WAWap").DEVICE_JID(A),q=B==null?void 0:B.node,s=B==null?void 0:B.baseKey;case 26:if(!(q==null)){F.next=29;break}d("WALogger").LOG(i());return F.abrupt("return",{type:"error"});case 29:C=l(c,r,q,p!=null);F.next=32;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendStanzaAndReturnAck(C,{"class":"appdata",from:f==null?d("MAWGlobals").getMyUserJid():f.to,id:c,participant:null}));case 32:D=F.sent;E=m.parse(D);if(!E.success){F.next=43;break}if(!(E.success.phash!=null&&p!=null&&E.success.phash!==p)){F.next=40;break}d("WALogger").LOG(h(),p,E.success.phash);d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"});F.next=40;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.resendWrittenAppData(c)));case 40:return F.abrupt("return",{baseKey:s,type:"success"});case 43:return F.abrupt("return",{type:"error"});case 44:case"end":return F.stop()}},null,this)}function l(a,b,c,e){return d("WAWap").wap("appdata",{category:"peer",device_list_check:e?"true":"false",id:d("WAWap").CUSTOM_STRING(a),to:b},c)}var m=new(d("WAWapParser").WapParser)("sendAppData",function(a){a.assertTag("ack");return{phash:a.maybeAttrString("phash"),t:a.maybeAttrInt("t")}});g.sendAppData=a}),98);
__d("WAGetGroupParticipantDevicesApi",["WAGlobals","WAResultOrError","WAResultOrErrorUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WAGlobals").runInTransaction({ContactsStore:!0,ParticipantsStore:!0,GroupInfoStore:!0},function(b){return h(b,a)},"getGroupParticipantDevices")};var h=function(a,c){var e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e=a.ContactsStore,f=a.ParticipantsStore,g=a.GroupInfoStore;m.next=3;return b("regeneratorRuntime").awrap(g.has(c));case 3:h=m.sent;if(!(h===!1)){m.next=6;break}return m.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 6:m.next=8;return b("regeneratorRuntime").awrap(f.bulkGetInGroup(c));case 8:i=m.sent;if(i.success){m.next=11;break}return m.abrupt("return",d("WAResultOrError").makeError("missing_group"));case 11:j=i.value;if(!(j.length===0)){m.next=14;break}return m.abrupt("return",d("WAResultOrError").makeError("missing_participants"));case 14:m.next=16;return b("regeneratorRuntime").awrap(e.bulkGet(j.map(function(a){return a.user})).then(d("WAResultOrErrorUtils").unpackValues));case 16:k=m.sent;l=k.flatMap(function(a){return a.identities}).map(function(a){return a.device}).filter(function(a){return a!==d("WAGlobals").getMyDeviceJid()});return m.abrupt("return",d("WAResultOrError").makeResult({deviceJids:new Set(l)}));case 19:case"end":return m.stop()}},null,this)};g.getGroupParticipantDevices=a;g.getGroupParticipantDevicesTransactor=h}),98);
__d("WAEncGroupMsg",["Promise","WAAsMessageTransport","WACryptoManager","WACryptoManagerUtils","WADualSendMsgUtils","WAEncNode","WAEncUserMsg","WAErr","WAGetGroupParticipantDevicesApi","WAGlobals","WAHex","WALogger","WAMsgTransport.pb","WAPhash","WAPromiseQueue","WAProtocolMediaType","WASortedLists","WATimeUtils","WAWap","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - end key distribution"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - start key distribution"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Encrypt success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish encrypt group content"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish group fanout msg "]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptGroupMsg - Finish rotate participant info "]);m=function(){return a};return a}var n=30*d("WATimeUtils").DAY_SECONDS,o=new(d("WAPromiseQueue").PromiseQueue)();function p(a,e,f){return o.enqueue(function(){var g,h,i,j,k,l,m,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:s.next=2;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getSenderKeyStatus(a));case 2:g=s.sent;h=g.ts,i=g.rotateSenderKey,j=g.hasSenderKey;k=g.senderKeyId;l=k==null||i||!d("WATimeUtils").happenedWithin(h,n);if(!(l||k==null)){s.next=22;break}s.next=9;return b("regeneratorRuntime").awrap(d("WACryptoManager").rotateGroupSenderKey(d("WAGlobals").getCryptoManager(),a,d("WAGlobals").getMyDeviceJid()));case 9:m=s.sent;k=m.senderKeyId;s.next=13;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markSenderKeyAsRotated(a,k,d("WATimeUtils").unixTime()));case 13:o=s.sent;if(o.success){s.next=16;break}throw c("WAErr")("markSenderKeyAsRotated failed with error "+o.error);case 16:e==null?void 0:e.addPoint("finish_sk_rotation");f==null?void 0:f.addPoint("finish_sk_rotation");p=o.value.needsSenderKey;return s.abrupt("return",{senderKeyId:k,needsSenderKey:p,groupParticipants:p});case 22:s.next=24;return b("regeneratorRuntime").awrap(d("WAGetGroupParticipantDevicesApi").getGroupParticipantDevices(a));case 24:q=s.sent;if(!q.error){s.next=27;break}throw c("WAErr")(q.error);case 27:r=new Set(q.value.deviceJids);(j||[]).forEach(function(a){return r["delete"](a)});e==null?void 0:e.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:r.size}});f==null?void 0:f.addPoint("no_sk_rotation",{"int":{noRotationNeedsSK:r.size}});return s.abrupt("return",{senderKeyId:k,needsSenderKey:r,groupParticipants:q.value.deviceJids});case 32:case"end":return s.stop()}},null,this)})}function a(a,c,e,f,g,n){var o,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;return b("regeneratorRuntime").async(function(N){while(1)switch(N.prev=N.next){case 0:g==null?void 0:g.addPoint("enc_group_start");n==null?void 0:n.addPoint("enc_group_start");N.next=4;return b("regeneratorRuntime").awrap(p(a,g,n));case 4:o=N.sent;r=o.senderKeyId;s=o.needsSenderKey;t=o.groupParticipants;d("WALogger").LOG(m());g==null?void 0:g.addPoint("rotated_participant_info");n==null?void 0:n.addPoint("rotated_participant_info");u=null;x=c.flatMap(function(a){return a.devicesInfo}).map(function(a){return a.jid});y=!d("WASortedLists").areEqual(d("WASortedLists").asSortedSet(t),d("WASortedLists").sortAndDedupe(x));z=f.type==="text"&&f.isRevoked;A=f.type==="media"?d("WAProtocolMediaType").castToProtocolMediaType(f.mediaType):null;if(!(y||z)){N.next=26;break}N.next=19;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptGroupFanoutMsg(x,{type:"message",messageBytes:e,messageType:f,chat:a}));case 19:B=N.sent;B&&!(f.type==="text"&&f.isInvisible===!0)&&(v=B,w=d("WAWap").wap("enc",{v:d("WAWap").CUSTOM_STRING(e.version==="v3"?"3":"2"),type:"skmsg",mediatype:(C=A)!=null?C:d("WAWap").DROP_ATTR}));d("WALogger").LOG(l());g==null?void 0:g.addPoint("finish_group_fanout_msg");n==null?void 0:n.addPoint("finish_group_fanout_msg");N.next=51;break;case 26:e.version==="v3"?(E=d("WAAsMessageTransport").asMessageTransport(e.bytes),D=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,E).readByteArray()):D=e.bytes;N.next=29;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").encryptGroupContentWithMetrics(a,D));case 29:F=N.sent;d("WALogger").LOG(k());g==null?void 0:g.addPoint("finish_encrypt_group_content");n==null?void 0:n.addPoint("finish_encrypt_group_content");if(!F.success){N.next=51;break}d("WALogger").LOG(j());H=F.value;r!==H.senderKeyId&&t.forEach(function(a){return s.add(a)});if(!(s.size>0)){N.next=49;break}I=d("WADualSendMsgUtils").isDualSendJid(a)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a):a;J={groupId:I.toString(),axolotlSenderKeyDistributionMessage:d("WAHex").bytesToBuffer(H.senderKeyDistributionProto)};d("WALogger").LOG(i());K=x.filter(function(a){return s.has(a)});N.next=44;return b("regeneratorRuntime").awrap(q(K,J));case 44:L=N.sent,d("WALogger").LOG(h()),g==null?void 0:g.addPoint("finish_skdm_enc_node"),n==null?void 0:n.addPoint("finish_skdm_enc_node"),L.length>0&&(v=d("WAWap").wap("participants",null,L),u={group:I,senderKeyId:H.senderKeyId,knowsSenderKey:new Set(K)});case 49:w=d("WAWap").wap("enc",{v:d("WAWap").CUSTOM_STRING(e.version==="v2"?"2":"3"),type:d("WAWap").CUSTOM_STRING(H.ciphertext.type),mediatype:(G=A)!=null?G:d("WAWap").DROP_ATTR},H.ciphertext.ciphertext),f.type==="text"&&f.isInvisible===!0&&(w=d("WAWap").wap("enc",{v:d("WAWap").CUSTOM_STRING(e.version==="v2"?"2":"3"),type:"skmsg"}));case 51:N.next=53;return b("regeneratorRuntime").awrap(d("WAPhash").calculatePHash(x.concat(d("WAGlobals").getMyDeviceJid())));case 53:M=N.sent;g==null?void 0:g.addPoint("phash_finish");n==null?void 0:n.addPoint("phash_finish");return N.abrupt("return",{phash:M,participants:v,encNode:w,senderKeyDistributionInfo:u});case 57:case"end":return N.stop()}},null,this)}function q(a,c){if(d("WAGlobals").getConfig().isBulkGroupEncEnabled())return r(a,c);a=a.map(function(a){return d("WAEncNode").getEncNode(a,{type:"skdm",skdm:c}).then(function(b){if(b!=null)return d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(a)},b.node);else return null})});return b("Promise").all(a).then(function(a){return a.filter(Boolean)})}function r(a,b){b=d("WAAsMessageTransport").asMessageTransport(null,null,b,null);b=d("encodeProtobuf").encodeProtobuf(d("WAMsgTransport.pb").MessageTransportSpec,b).readByteArray();return d("WACryptoManagerUtils").bulkEncryptSKDM(a,b).then(function(a){var b=[];a.forEach(function(a,c){b.push(d("WAWap").wap("to",{jid:d("WAWap").DEVICE_JID(c)},d("WAWap").wap("enc",{v:"3",type:d("WAWap").CUSTOM_STRING(a.type)},a.ciphertext)))});return b})}g.encryptGroupMsg=a}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]);i=function(){return a};return a}function a(a,c,e){if(c==null){d("WALogger").ERROR(i());return b("Promise").resolve(null)}if(e!=null&&e!==0){d("WALogger").ERROR(h(),e);return b("Promise").resolve(null)}return d("WAFranking").genFrankingTag(c,a)}function c(a){return a!=null?d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,a)):null}g.genFrankingTagFromMessageApplicationEncode=a;g.getFrankingNode=c}),98);
__d("WASendMsgUtil",["Promise","WABridge","WAComms","WADualSendMsgUtils","WAEncGroupMsg","WAEncUserMsg","WAFranking","WAFrankingNode","WAGlobals","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAOdsEnums","WAParseFranking","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- user message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", chatType:",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during send message post-processing. Err: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"]);o=function(){return a};return a}var p=10002;function a(a,c,e){var f,g,h,i,j,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;return b("regeneratorRuntime").async(function(Z){while(1)switch(Z.prev=Z.next){case 0:f=null;g=null;h=null;i=null;j=null;v=null;w=d("WAWap").DROP_ATTR;x=null;y=d("WAWap").DROP_ATTR;z=null;B=0;a.type==="chat"&&(B=a.recipients.reduce(function(b,a){return b+a.devicesInfo.length},0));C=a.messageType.type==="text"&&a.messageType.isRevoked;D=C?"revoke":a.messageType.type;c==null?void 0:c.addPoint("start_encrypt",{string:{messageType:D},"int":{numDevices:B},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}});e==null?void 0:e.addPoint("start_encrypt",{string:{messageType:D},"int":{numDevices:B},bool:{isInvisibleMsg:a.messageType.type==="text"&&a.messageType.isInvisible===!0}});if(!(a.type==="chat")){Z.next=27;break}Z.next=19;return b("regeneratorRuntime").awrap(u(a,c,e));case 19:E=Z.sent;j=q(a);f=E.messageTo;x=E.phash;E.type==="user"?g=E.participants:(E.type,y=d("WAWap").CUSTOM_STRING(E.phash),g=E.participants,h=E.encGroupMsg,i=E.senderKeyDistributionInfo);A=E.type;Z.next=39;break;case 27:a.type;j=q(a);H=d("WAJids").interpretAsUserJid(a.chat);H!=null&&d("WAGlobals").isPeerDevice(a.to)&&(w=d("WAWap").USER_JID(H));Z.next=33;return b("regeneratorRuntime").awrap(t(a));case 33:I=Z.sent,f=I.messageTo,v=I.participant,h=(F=I.encResult)==null?void 0:F.node,z=(G=I.encResult)==null?void 0:G.baseKey,A="direct";case 39:c==null?void 0:c.addPoint("finish_encrypt",{string:{chatType:A}});e==null?void 0:e.addPoint("finish_encrypt",{string:{chatType:A}});J=a.protocolMsgId,K=a.externalId;if(!(g==null&&h==null)){Z.next=49;break}c==null?void 0:c.endFail("fail_encrypt");e==null?void 0:e.endFail("fail_encrypt");d("WALogger").ERROR(o(),A);Z.next=48;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markMsgSendFailed(J));case 48:return Z.abrupt("return",{type:"error"});case 49:L=C?"7":d("WAWap").DROP_ATTR;M=null;N=null;if(!(d("WAGlobals").getConfig().isFrankingEnabled()&&a.messageBytes.version==="v3")){Z.next=57;break}Z.next=55;return b("regeneratorRuntime").awrap(d("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(a.messageBytes.bytes,a.frankingKey,a.frankingVersion));case 55:N=Z.sent,M=d("WAFrankingNode").getFrankingNode(N);case 57:c==null?void 0:c.addPoint("finish_franking");e==null?void 0:e.addPoint("finish_franking");O=a.messageType.type==="text"&&a.messageType.invitedParticipantUserJid!=null;P=d("WAJids").interpretAsGroupJid(a.protocolMsgId.chat);Q=!O||P==null?null:d("WAWap").wap("meta",{group_invite:d("WAWap").CUSTOM_STRING(P)});R=a.messageType.isInvisible===!0?d("WAWap").wap("meta",{"decrypt-fail":"hide"}):null;S=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;T=d("WAWap").wap("message",{device_fanout:a.messageType.isInvisible===!0?"false":d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(K),to:d("WAWap").TO_WAP_JID(f),type:d("WAWap").CUSTOM_STRING(a.messageType.type),participant:v?d("WAWap").TO_WAP_JID(v):d("WAWap").DROP_ATTR,recipient:w,phash:y,edit:L},Q,M,g,h,j,R,S);Z.next=67;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendStanzaAndReturnAck(T,{id:K,"class":"message",from:d("WAJids").extractJidFromJidWithType(f),participant:v&&v.jidType==="msgrDevice"?v.deviceJid:null}));case 67:U=Z.sent;c==null?void 0:c.addPoint("ack_returned");e==null?void 0:e.addPoint("ack_returned");V=s.parse(U);if(!(V.success&&V.success.errorCode==null)){Z.next=87;break}W=function(){var f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:f=V.success.phash;if(!(f!=null&&x!==f)){h.next=9;break}d("WAGlobals").getDbImpls().writeDebugMsg(a.chat,"Outgoing msg "+a.externalId+" got a phash mismatch: local["+((g=x)!=null?g:"undefined")+"] server["+f+"]");d("WALogger").LOG(n(),x,f);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:A});h.next=7;return b("regeneratorRuntime").awrap(r(a.chat));case 7:c==null?void 0:c.addPoint("participant_recovery_finished"),e==null?void 0:e.addPoint("participant_recovery_finished");case 9:case"end":return h.stop()}},null,this)};X=function(){var a,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:f={frankingTag:N,reportingTag:(a=V.success.reportingMeta)==null?void 0:a.reportingTag,frankingVersion:d("WAFranking").getFrankingVersion(),reportingContent:null};g.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markMsgSent(J,V.success.ts,V.success.count,f));case 3:c==null?void 0:c.addPoint("mark_msg_sent"),e==null?void 0:e.addPoint("mark_msg_sent");case 5:case"end":return g.stop()}},null,this)};Y=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!(i!=null)){a.next=5;break}a.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markSenderKeyAsSent(i.group,i.senderKeyId,i.knowsSenderKey));case 3:c==null?void 0:c.addPoint("mark_sender_key_sent"),e==null?void 0:e.addPoint("mark_sender_key_sent");case 5:case"end":return a.stop()}},null,this)};Z.prev=75;Z.next=78;return b("regeneratorRuntime").awrap(b("Promise").all([W(),X(),Y()]));case 78:Z.next=84;break;case 80:Z.prev=80;Z.t0=Z["catch"](75);d("WALogger").ERROR(m(),Z.t0.message);return Z.abrupt("return",{type:"error"});case 84:return Z.abrupt("return",{type:"success",baseKey:z});case 87:if(!(V.success&&V.success.applicationError===p)){Z.next=92;break}Z.next=90;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().handleReachabilityErrorAdminMsg(a.chat));case 90:c==null?void 0:c.addPoint("reachability_error_code"),e==null?void 0:e.addPoint("reachability_error_code");case 92:Z.next=94;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markMsgSendFailed(J));case 94:V.success?(d("WALogger").ERROR(l(),V.success.errorCode,A),V.success.errorCode!=null&&(c==null?void 0:c.addPoint("ack_success_error_"+V.success.errorCode)),V.success.errorCode!=null&&(e==null?void 0:e.addPoint("ack_success_error_"+V.success.errorCode))):(d("WALogger").ERROR(k(),A),c==null?void 0:c.addPoint("ack_parse_fail"),e==null?void 0:e.addPoint("ack_parse_fail"));c==null?void 0:c.endFail("failed");e==null?void 0:e.endFail("failed");return Z.abrupt("return",{type:"error"});case 98:case"end":return Z.stop()}},null,this,[[75,80]])}function q(a){if(d("WADualSendMsgUtils").isDualSendJid(a.chat)){a.chat=d("WADualSendMsgUtils").removeDualSendPrefix(a.chat);return d("WAWap").wap("test",{config:d("WAJids").switchOnMsgrChatJidType(a.chat,{user:function(){return"xapp_shadow_delivery"},group:function(){return"group_dual_send"}})})}}function r(a){return d("WAJids").switchOnMsgrChatJidType(a,{user:function(a){return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(new Set([a,d("WAGlobals").getMyUserJid()]),"phash-mismatch",!1,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}))},group:function(a){return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.queryGroups(a))}})}var s=new(d("WAWapParser").WapParser)("sendMsgAck",function(a){a.assertTag("ack");return{count:a.maybeAttrInt("count"),errorCode:a.maybeAttrInt("error"),phash:a.maybeAttrString("phash"),applicationError:a.maybeAttrInt("application_error"),ts:a.attrTime("t"),reportingMeta:d("WAParseFranking").parseFrankingNode(a.maybeChild("franking"))}});function t(a){var c,e,f,g,h,i,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:c=a.chat,e=a.to,f=a.messageBytes,g=a.messageType,h=a.encProps,i=a.sessionInfo,j=a.identityKey;o.next=3;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptDeviceJidMessage(e,{type:"message",chat:c,messageBytes:f,messageType:g},h,i,j));case 3:k=o.sent;l=d("WAJids").switchOnChatJidType(c,{lidUser:function(b){return{messageTo:{jidType:"lidDevice",deviceJid:a.to},participant:null}},phoneUser:function(b){return{messageTo:{jidType:"phoneDevice",deviceJid:a.to},participant:null}},msgrUser:function(){return{messageTo:{jidType:"msgrDevice",deviceJid:a.to},participant:null}},group:function(b){return{messageTo:{jidType:"group",groupJid:b},participant:{jidType:"msgrDevice",deviceJid:a.to}}}}),m=l.messageTo,n=l.participant;return o.abrupt("return",{messageTo:m,participant:n,encResult:k});case 6:case"end":return o.stop()}},null,this)}function u(a,c,e){var f=a.recipients,g=a.messageBytes,k=a.messageType,l=a.chat,m=a.icdcInfo;return d("WAJids").switchOnChatJidType(l,{lidUser:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptUserMsg(f,{type:"message",messageBytes:g,messageType:k,chat:a},m));case 2:c=e.sent;return e.abrupt("return",{type:"user",messageTo:{jidType:"lidUser",userJid:a},participants:c.participants,phash:c.phash});case 4:case"end":return e.stop()}},null,this)},phoneUser:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptUserMsg(f,{type:"message",messageBytes:g,messageType:k,chat:a},m));case 2:c=e.sent;return e.abrupt("return",{type:"user",messageTo:{jidType:"phoneUser",userJid:a},participants:c.participants,phash:c.phash});case 4:case"end":return e.stop()}},null,this)},msgrUser:function(a){var c,e,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:d("WALogger").LOG(j());c=a;e=d("WADualSendMsgUtils").isDualSendJid(c)?d("WADualSendMsgUtils").removeDualSendPrefixForUser(c):c;i.next=5;return b("regeneratorRuntime").awrap(d("WAEncUserMsg").encryptUserMsg(f,{type:"message",messageBytes:g,messageType:k,chat:e},m));case 5:h=i.sent;return i.abrupt("return",{type:"user",messageTo:{jidType:"msgrUser",userJid:e},participants:h.participants,phash:h.phash});case 7:case"end":return i.stop()}},null,this)},group:function(a){var j;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:d("WALogger").LOG(i());m.next=3;return b("regeneratorRuntime").awrap(d("WAEncGroupMsg").encryptGroupMsg(a,f,g,k,c,e));case 3:j=m.sent;d("WALogger").LOG(h());return m.abrupt("return",{type:"group",messageTo:{jidType:"group",groupJid:d("WADualSendMsgUtils").isDualSendJid(l)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a):a},participants:j.participants,encGroupMsg:j.encNode,senderKeyDistributionInfo:j.senderKeyDistributionInfo,phash:j.phash});case 6:case"end":return m.stop()}},null,this)}})}g.sendMessage=a}),98);
__d("MAWHandleRetryRequest",["MAWBulkGetAppDataForRetryApi","MAWConstants","MAWGating","MAWGlobals","MAWQplProxy","MAWSendAppDataUtils","Promise","WAAsMessageApplication","WAComms","WACryptoManagerUtils","WACryptoUtils","WAFranking","WAJids","WALogger","WAMsgApplication.pb","WAPreKeysStanzaUtils","WAScheduleAfterOfflineResume","WASendMsgUtil","WAServerHandler","WAStanzaUtils","WAWap","WAWapParser","encodeProtobuf","err","gkx","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type "," id: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt categories: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received retry request from peer without recipient set"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest unexpected receipt"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest called for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt category: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest called ",""]);r=function(){return a};return a}a=new(d("WAWapParser").WapParser)("receipt",function(a){a.assertTag("receipt");a.assertAttr("type","retry");var b=null;a.hasChild("keys")&&(b=babelHelpers["extends"]({regId:a.child("registration").contentUint(4)},d("WAPreKeysStanzaUtils").readSessionInfo(a.child("keys"))));var c=a.child("retry");return{category:a.maybeAttrString("category"),externalId:d("WAStanzaUtils").toStanzaId(a.attrString("id")),from:a.attrFromJidChat(),keys:b,offline:a.maybeAttrInt("offline"),recipient:a.maybeAttrUserJid("recipient"),regId:a.child("registration").contentUint(4),retryCount:c.hasAttr("count")?c.attrInt("count"):0,timestamp:c.attrTime("t")}});function s(a){var e,f,g,h,i,j,k,l,m,n,s,t,u,v,w,x,z,A,B,C,E,F;return b("regeneratorRuntime").async(function(G){while(1)switch(G.prev=G.next){case 0:h=a.externalId,i=a.from,j=a.retryCount;d("WALogger").LOG(r(),h);k=d("WAWap").wap("ack",{"class":"receipt",id:d("WAWap").CUSTOM_STRING(h),participant:d("WAWap").PARTICIPANT_JID(i),to:d("WAWap").TO_JID(i),type:"retry"});l=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25308942,"164"),{bool:{bulk:!1},"int":{retries:j},string:{category:a.category}});if(!(j>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT)){G.next=8;break}d("WALogger").LOG(q(),j);l.endFail("retry-count");return G.abrupt("return",k);case 8:if(!(a.category==="peer_appdata"||a.category==="peer")){G.next=17;break}G.next=11;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getAppDataForRetry(h,i.author));case 11:m=G.sent;G.next=14;return b("regeneratorRuntime").awrap(D(a,m,l));case 14:n=G.sent;(n==null?void 0:n.type)==="success"?l.endSuccess():n!=null&&l.endFail("send_app_data_error");return G.abrupt("return",k);case 17:if(!(a.category!=null)){G.next=21;break}d("WALogger").WARN(p(),a.category);l.endFail("unknown-category");return G.abrupt("return",k);case 21:s=i.chat;if(!(i.type==="device"&&d("WAJids").extractUserJid(i.author)===d("WAJids").extractUserJid(d("MAWGlobals").getMyDeviceJid()))){G.next=28;break}t=a.recipient;if(!(t==null)){G.next=27;break}l.endFail("no_recipient");throw c("err")("Received retry request from peer without recipient set");case 27:s=t;case 28:u={author:"@me",chat:s,externalId:h};G.next=31;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgForRetry(u,i.author));case 31:v=G.sent;l.addPoint("get_msg_for_retry_complete");if(!(v.type!=="unacked")){G.next=37;break}l.endFail(v.type);d("WALogger").LOG(o(),v.type);return G.abrupt("return",k);case 37:if(!(i.type==="group")){G.next=41;break}G.next=40;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markParticipantNeedsKey(i.chat,i.author));case 40:l.addPoint("mark_participant_needs_key_complete");case 41:w=v.deviceIdentity,x=v.messageApplication,z=v.messageType,A=v.protocolMsgId;B={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,x).readByteArray()),version:"v3"};G.next=45;return b("regeneratorRuntime").awrap(y(a,w));case 45:C=G.sent;l.addPoint("get_session_info_complete");c("gkx")("8497")&&d("MAWGlobals").getDbImpls().writeDebugMsg(s,"Handling retry request for message: "+v.protocolMsgId.externalId.toString()+" to user "+i.author);G.next=50;return b("regeneratorRuntime").awrap(d("WASendMsgUtil").sendMessage({chat:s,deviceIdentity:null,encProps:{count:j},externalId:h,frankingKey:((e=x.metadata)==null?void 0:e.frankingKey)?d("WAFranking").castToFrankingKey(new Uint8Array((f=x.metadata)==null?void 0:f.frankingKey)):null,frankingVersion:(g=x.metadata)==null?void 0:g.frankingVersion,identityKey:w.pubKey,messageBytes:B,messageType:z,protocolMsgId:A,sessionInfo:C,to:i.author,type:"direct"}));case 50:E=G.sent;l.addPoint("send_message_complete");if(!(j>=2&&E.type==="success"&&E.baseKey!=null)){G.next=56;break}F=E.baseKey;G.next=56;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeMsgRetry(u,i.author,F));case 56:E.type==="success"?l.endSuccess():l.endFail("send_error");return G.abrupt("return",k);case 58:case"end":return G.stop()}},null,this)}function t(){var a=0,b=0;return{getMetrics:function(){return{receiptFailures:b,receiptSuccesses:a}},markError:function(){return b++},markSuccess:function(){return a++}}}function u(a,e){var f,g,h,i,j,k,l,o,p,q,r,s,u;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:if(!(a.length===0)){w.next=2;break}return w.abrupt("return",[]);case 2:d("WALogger").LOG(n(),a.map(function(a){a=a.externalId;return a}).join(","));f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25308942,"164"),{bool:{bulk:!0},"int":{receipts:a.length}});g=new Set(a.filter(function(a){return a.category!=null&&!A(a)||B(a)}).map(function(a){return a.externalId}));h=a.filter(function(a){return!g.has(a.externalId)&&!A(a)});i=a.filter(A);w.next=9;return b("regeneratorRuntime").awrap(b("Promise").all([v(i),x(h)]));case 9:j=w.sent,k=j[0],l=j[1],f.addPoint("get_msg_for_retry_complete"),o=[],p=t(),q=0;case 16:if(!(q<a.length)){w.next=49;break}r=a[q];s=k.get(r.externalId);u=l.get(r.externalId);if(!(e!=null&&!d("WAComms").isActiveSocket(e))){w.next=23;break}f.endSuccess({"int":babelHelpers["extends"]({},p.getMetrics())});return w.abrupt("return",o);case 23:if(!g.has(r.externalId)){w.next=29;break}f.addPoint("just_ack");p.markError();C(r);w.next=45;break;case 29:if(!(s!=null)){w.next=36;break}f.addPoint("app_data_for_retry");w.next=33;return b("regeneratorRuntime").awrap(D(r,s,f,!1,p));case 33:f.addPoint("app_data_for_retry_complete");w.next=45;break;case 36:if(!(u!=null)){w.next=43;break}f.addPoint("msg_for_retry");w.next=40;return b("regeneratorRuntime").awrap(E(r,u,f,!1,p));case 40:f.addPoint("msg_for_retry_complete");w.next=45;break;case 43:d("WALogger").ERROR(m()),p.markError();case 45:o.push(z(r));case 46:q++;w.next=16;break;case 49:f.endSuccess({"int":babelHelpers["extends"]({},p.getMetrics())});return w.abrupt("return",o);case 51:case"end":return w.stop()}},null,this)}function v(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.map(function(a){var b=a.externalId;a=a.from;return{deviceJid:a.author,externalId:b}});f.next=3;return b("regeneratorRuntime").awrap(d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry(c));case 3:e=f.sent;return f.abrupt("return",new Map(e.map(function(b,c){c=a[c];return[c.externalId,b]})));case 5:case"end":return f.stop()}},null,this)}function w(a){return a.map(function(a){var b=a.externalId,c=a.from;a=a.recipient;var e=c.chat;if(c.type==="device"&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("MAWGlobals").getMyDeviceJid())){if(a==null){d("WALogger").ERROR(l());return}e=a}a={author:"@me",chat:e,externalId:b};return{deviceJid:c.author,protocolMsgId:a}})}function x(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=w(a);e=a.filter(function(a,b){return c[b]!=null});f=c.filter(Boolean);h.next=5;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgsForRetry(f));case 5:g=h.sent;return h.abrupt("return",new Map(g.map(function(a,b){return[e[b].externalId,{msgForRetry:a,retryRequest:f[b]}]})));case 7:case"end":return h.stop()}},null,this)}function y(a,c){var e,f,g,h,i,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:e=void 0;l.next=3;return b("regeneratorRuntime").awrap(d("WACryptoManagerUtils").getParticipantInfo(a.from.author));case 3:f=l.sent;a.keys!=null?((g=a.keys,h=a.timestamp),i={baseKey:c.baseKey,keys:g,timestamp:h},j=F(a,f),j?e={session:i,type:"compareTSAndUseSession"}:e={session:i,type:"useSession"}):(k=f==null||a.regId!==f.regId,k&&(e={type:"requestNewSession"}));return l.abrupt("return",e);case 6:case"end":return l.stop()}},null,this)}function z(a){var b=a.externalId;a=a.from;return d("WAWap").wap("ack",{"class":"receipt",id:d("WAWap").CUSTOM_STRING(b),participant:d("WAWap").PARTICIPANT_JID(a),to:d("WAWap").TO_JID(a),type:"retry"})}function A(a){a=a.category;return a==="peer_appdata"||a==="peer"}function B(a){a=a.retryCount;return a>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT}function C(a){if(B(a)){d("WALogger").LOG(k());return}if(a.category!=null){d("WALogger").WARN(j(),a.category);return}}function D(a,c,e,f,g){var h,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:f===void 0&&(f=!0);h=a.externalId,j=a.from,k=a.retryCount;e.addPoint("get_app_data_for_retry");if(!(c.type!=="unacked")){r.next=8;break}d("WALogger").LOG(i(),c.type,h);f?e.endFail(c.type):e.addPoint(c.type);g==null?void 0:g.markError();return r.abrupt("return");case 8:l=c.appData,m=c.deviceIdentity,n=c.permittedIdentitiesPerDevice;r.next=11;return b("regeneratorRuntime").awrap(y(a,m));case 11:o=r.sent;e.addPoint("get_session_info");r.next=15;return b("regeneratorRuntime").awrap(d("MAWSendAppDataUtils").sendAppData(l,h,n,{encProps:{count:k},identityKey:m.pubKey,sessionInfo:o,to:j.author}));case 15:p=r.sent;e.addPoint("send_app_data");if(!(k>=2&&p.type==="success"&&p.baseKey!=null)){r.next=21;break}q=p.baseKey;r.next=21;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeAppDataRetry(h,j.author,q));case 21:g==null?void 0:g.markSuccess();return r.abrupt("return",p);case 23:case"end":return r.stop()}},null,this)}function E(a,e,f,g,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,z,A;return b("regeneratorRuntime").async(function(B){while(1)switch(B.prev=B.next){case 0:g===void 0&&(g=!0);m=e.msgForRetry,n=e.retryRequest;o=a.externalId,p=a.from,q=a.retryCount;r=n.protocolMsgId.chat;if(!(m.type!=="unacked")){B.next=9;break}g&&f.endFail(m.type);d("WALogger").LOG(h(),m.type);i==null?void 0:i.markError();return B.abrupt("return");case 9:if(!(p.type==="group")){B.next=13;break}B.next=12;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markParticipantNeedsKey(p.chat,p.author));case 12:f.addPoint("mark_participant_needs_key_complete");case 13:s=m.deviceIdentity,t=m.messageApplication,u=m.messageType,v=m.protocolMsgId;w={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,t).readByteArray()),version:"v3"};B.next=17;return b("regeneratorRuntime").awrap(y(a,s));case 17:x=B.sent;f.addPoint("get_session_info_complete");c("gkx")("8497")&&d("MAWGlobals").getDbImpls().writeDebugMsg(r,"Handling retry request for message: "+m.protocolMsgId.externalId.toString()+" to user "+p.author);B.next=22;return b("regeneratorRuntime").awrap(d("WASendMsgUtil").sendMessage({chat:r,deviceIdentity:null,encProps:{count:q},externalId:o,frankingKey:((j=t.metadata)==null?void 0:j.frankingKey)?d("WAFranking").castToFrankingKey(new Uint8Array((k=t.metadata)==null?void 0:k.frankingKey)):null,frankingVersion:(l=t.metadata)==null?void 0:l.frankingVersion,identityKey:s.pubKey,messageBytes:w,messageType:u,protocolMsgId:v,sessionInfo:x,to:p.author,type:"direct"}));case 22:z=B.sent;f.addPoint("send_message_complete");if(!(q>=2&&z.type==="success"&&z.baseKey!=null)){B.next=28;break}A=z.baseKey;B.next=28;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeMsgRetry(n.protocolMsgId,p.author,A));case 28:i==null?void 0:i.markSuccess();case 29:case"end":return B.stop()}},null,this)}function F(a,b){if(a.offline==null)return!1;var c=b==null||a.regId!==b.regId;b=b!=null&&a.keys!=null&&!d("WACryptoUtils").uint8ArraysEqual(b.pubKey,a.keys.identity);return c||b}e=d("WAServerHandler").serverHandler("handleRetryRequest",a,function(a){return d("MAWGating").isBulkRetryReceiptProcessing()?u([a]).then(function(a){a=a[0];return a}):s(a)});f=d("WAServerHandler").bulkServerHandler("handleRetryRequestBulk",a,function(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:if(d("MAWGlobals").getConfig().isPullMode()){i.next=17;break}if(!d("MAWGating").isBulkRetryReceiptProcessing()){i.next=5;break}return i.abrupt("return",u(a));case 5:e=[],f=0;case 7:if(!(f<a.length)){i.next=16;break}g=a[f];i.next=11;return b("regeneratorRuntime").awrap(s(g));case 11:h=i.sent,e.push(h);case 13:f++;i.next=7;break;case 16:return i.abrupt("return",e);case 17:d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=[];if(!d("MAWGating").isBulkRetryReceiptProcessing()){i.next=7;break}i.next=4;return b("regeneratorRuntime").awrap(u(a,c));case 4:e=i.sent;i.next=19;break;case 7:f=0;case 8:if(!(f<a.length)){i.next=19;break}g=a[f];if(d("WAComms").isActiveSocket(c)){i.next=12;break}return i.abrupt("return");case 12:i.next=14;return b("regeneratorRuntime").awrap(s(g));case 14:h=i.sent,e.push(h);case 16:f++;i.next=8;break;case 19:d("MAWGlobals").getServerRPC().castStanzas(e,c);case 20:case"end":return i.stop()}},null,this)},combine:!0,id:"retry-receipts"});return i.abrupt("return",[]);case 19:case"end":return i.stop()}},null,this)});g.RetryReceiptParser=a;g.bulkHandleRetryRequest=u;g.handleRetryRequest=e;g.handleRetryRequestsBulk=f}),98);
__d("MAWAcceptGroupInvite",["MAWDbThread","MAWGlobals","MAWJids","WAComms","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get group invite info ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite called"]);i=function(){return a};return a}var j=new(d("WAWapParser").WapParser)("getAcceptGroupInviteResponse",function(a){a.assertTag("iq"),a.assertAttr("type","result")});a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a){var c,e,f,g,k,l,m,n,o,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:d("WALogger").LOG(i());c=a.chatId,e=a.inviterUserId,f=a.invitedParticipantUserId;g=d("MAWDbThread").unsafeCoerceToChatId(c);k=d("MAWJids").toUserJid(e);l=d("MAWJids").toUserJid(f);t.next=7;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getGroupInvite(g,k,l));case 7:m=t.sent;if(m.success){t.next=11;break}d("WALogger").DEV(h(),m.error);return t.abrupt("return",!1);case 11:n=m.value,o=n.groupJid,p=n.groupInvite;q=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(o),type:"set",xmlns:"w:g2"},d("WAWap").wap("accept",{admin:d("WAWap").USER_JID(k),code:d("WAWap").CUSTOM_STRING(p.inviteCode),expiration:d("WAWap").LONG_INT(p.inviteExpirationTs)}));t.next=15;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(q,j));case 15:r=t.sent;if(r.success){t.next=21;break}s=r.errorCode.toString().startsWith("5");if(!s){t.next=20;break}throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1});case 20:return t.abrupt("return",!1);case 21:t.next=23;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().removeGroupInvites(g,l));case 23:return t.abrupt("return",!0);case 24:case"end":return t.stop()}},null,this)}).end();g.acceptGroupInvite=a}),98);
__d("MAWGetMediaByObjectId",["MAWDbMediaTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAMediaUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{media:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMediaByObjectId",!1)))(function(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,d("WAMediaUtils").stringToDeliveryObjectId(b)).then(function(a){return!a?d("WAResultOrError").makeError("media-not-found"):d("WAResultOrError").makeResult(a)})});b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{mediaBackup:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMediaBackupByObjectId",!1)))(function(a,b){return d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,d("WAMediaUtils").stringToDeliveryObjectId(b)).then(function(a){return!a?d("WAResultOrError").makeError("mediaBackup-not-found"):d("WAResultOrError").makeResult(a)})});g.getMediaByObjectId=a;g.getMediaBackupByObjectId=b}),98);
__d("MAWBackupMessageWithMedia",["LSDataTraceCheckPoint.re","MAWDbMsgTxns","MAWGating","MAWGetMediaByObjectId","MAWGlobals","MAWIndexedDb","MAWTraceUtils","MAWTransactionMode","MAWUploadMessagesBackup","WALogger","WASortedLists","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No affected messages for media"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No mediaBackup entry found for fbid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No media entry found for fbid: ",""]);j=function(){return a};return a}var k=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds);function l(a,e,f){var g,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:g=null;if(d("MAWGating").isMediaBackupTableEnabled()){n.next=12;break}n.next=4;return b("regeneratorRuntime").awrap(d("MAWGetMediaByObjectId").getMediaByObjectId(e));case 4:l=n.sent;if(l.success){n.next=9;break}d("WALogger").ERROR(j(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"No media entry found");throw c("err")("No media entry found");case 9:g=l.value.msgIds;n.next=20;break;case 12:n.next=14;return b("regeneratorRuntime").awrap(d("MAWGetMediaByObjectId").getMediaBackupByObjectId(e));case 14:m=n.sent;if(m.success){n.next=19;break}d("WALogger").ERROR(i(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"No media entry found");throw c("err")("No mediaBackup entry found");case 19:m.value.msgId!=null&&(g=d("WASortedLists").asSortedSet(new Set([m.value.msgId])));case 20:if(!(g==null||g.length===0)){n.next=24;break}d("WALogger").ERROR(h());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"No affected messages for media");throw c("err")("No affected messages for media");case 24:n.t0=b("regeneratorRuntime");n.t1=d("MAWUploadMessagesBackup").uploadUniqueMessage;n.next=28;return b("regeneratorRuntime").awrap(k(g));case 28:n.t2=n.sent;n.t3=n.t1(n.t2);n.next=32;return n.t0.awrap.call(n.t0,n.t3);case 32:d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupSuccess,[],!1),d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").flowEndAndFlush,[],!0);case 34:case"end":return n.stop()}},null,this)}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("backup",function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.backupEntFbid,d=a.deliveryObjectId,e=a.traceId;f.next=3;return b("regeneratorRuntime").awrap(l(c,d,e));case 3:case"end":return f.stop()}},null,this)}).end();g.processUpload=l;g.backupMessageWithMedia=a}),98);
__d("MAWGetMsgTsByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgTsByProtocolMsgId",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];c=c||b||a;return c==null?void 0:c.ts})});g.getMsgTsByProtocolMsgId=a}),98);
__d("MAWWriteMetaSyncsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","MAWWriteMetaSyncsTxns"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWWriteMetaSyncsTxns").handleMetaSyncAction(a,b)})).then(function(){})});g.writeMetaSyncs=a}),98);
__d("WASyncdAction",["Promise","WASyncdConst"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var c=a.prototype;c.getChatJidAndMessageKey=function(a){return};c.resolveConflicts=function(a,c){c=c.timestamp;return c>=a.timestamp?b("Promise").resolve(d("WASyncdConst").ConflictResolutionState.ApplyRemoteAndDropLocal):b("Promise").resolve(d("WASyncdConst").ConflictResolutionState.SkipRemote)};c.dropMutationDueToCrossIndexConflict=function(a,c){return b("Promise").resolve(!1)};return a}();g.SyncActionBase=a}),98);
__d("WASyncdActionUtils",["WASyncAction.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){function h(a,b){return JSON.stringify([a].concat(b))}function a(a){var b=a.action,c=a.indexArgs,e=a.collection,f=a.value,g=a.version,i=a.operation;a=a.timestamp;return{collection:e,index:h(b,c),binarySyncAction:d("encodeProtobuf").encodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,babelHelpers["extends"]({},f,{timestamp:a})).readBuffer(),version:g,operation:i,timestamp:a,action:b}}function b(a){var b=a.remoteJid,c=a.id,d=a.fromMe;a=a.participant;return[b,c,d?"1":"0",a!=null&&!d?a:"0"]}g.buildIndex=h;g.buildPendingMutation=a;g.buildMessageKey=b}),98);
__d("WADeleteMessageForMeSyncBase",["WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.version=3,c.action=d("WASyncdConst").Actions.DeleteMessageForMe,b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.buildDeleteForMeMutation=function(a){var b=a.timestamp,c=a.deleteMedia,e=a.messageTimestamp;a=babelHelpers.objectWithoutPropertiesLoose(a,["timestamp","deleteMedia","messageTimestamp"]);c={deleteMessageForMeAction:{deleteMedia:c,messageTimestamp:e}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.RegularHigh,indexArgs:d("WASyncdActionUtils").buildMessageKey(a),value:c,version:this.version,operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:b,action:this.action})};return b}(d("WASyncdAction").SyncActionBase);g.DeleteMessageForMeSyncBase=a}),98);
__d("MAWSyncdDeleteMessageForMeAction",["MAWGetMsgTsByProtocolMsgId","MAWJidUtils","MAWWriteMetaSyncsApi","Promise","WADeleteMessageForMeSyncBase","WAJids","WAStanzaUtils","WASyncdConst","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var e=c.prototype;e.applyMutations=function(a){var b=[],c=a.map(function(a){if(a.operation==="remove")return{actionState:d("WASyncdConst").SyncActionState.Unsupported};a=a.indexParts;var c=a[1],e=a[2],f=a[3];a=a[4];e=d("WAStanzaUtils").toStanzaId(e);f=f==="1";var g=d("WAJids").validateChatJid(c);if(g==null)return{actionState:d("WASyncdConst").SyncActionState.Malformed};g;var h=null;f?h=d("WAJids").AUTHOR_ME:h=d("WAJids").validateUserJid(c);if(h==null){if(a==="0")return{actionState:d("WASyncdConst").SyncActionState.Malformed};h=d("WAJids").validateUserJid(a)}if(h==null)return{actionState:d("WASyncdConst").SyncActionState.Malformed};h;f=d("MAWJidUtils").maybeToProtocolMsgId(h,g,e);if(f==null)return{actionState:d("WASyncdConst").SyncActionState.Malformed};b.push({messageAction:{protocolMsgId:f,type:"delete_for_me"}});return{actionState:d("WASyncdConst").SyncActionState.Success}});return d("MAWWriteMetaSyncsApi").writeMetaSyncs(b).then(function(){return c})};e.getMutations=function(a){var c=this,e=d("WATimeUtils").unixTimeMs();return b("Promise").all(a.map(function(a){return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.t0=c;f.t1=d("WAJids").isAuthorMe(a.author);f.t2=a.externalId;f.next=5;return b("regeneratorRuntime").awrap(d("MAWGetMsgTsByProtocolMsgId").getMsgTsByProtocolMsgId(a));case 5:f.t3=f.sent;if(f.t3){f.next=8;break}f.t3=e;case 8:f.t4=f.t3;f.t5=!d("WAJids").isAuthorMe(a.author)&&a.author!==a.chat?a.author:null;f.t6=a.chat;f.t7=e;f.t8={deleteMedia:!0,fromMe:f.t1,id:f.t2,messageTimestamp:f.t4,participant:f.t5,remoteJid:f.t6,timestamp:f.t7};return f.abrupt("return",f.t0.buildDeleteForMeMutation.call(f.t0,f.t8));case 14:case"end":return f.stop()}},null,this)}))};return c}(d("WADeleteMessageForMeSyncBase").DeleteMessageForMeSyncBase);c=new a();e=c;g["default"]=e}),98);
__d("MAWSyncdTxn",["MAWDbPendingMutations","WAShiftTimer","WASyncd"],(function(a,b,c,d,e,f,g){"use strict";var h=100,i=new Set(),j=new(d("WAShiftTimer").ShiftTimer)(a);function a(){var a=Array.from(i);i=new Set();d("WASyncd").markCollectionsForSync(a)}function b(a,b){return a.pendingMutations.bulkAdd(b.map(d("MAWDbPendingMutations").convertPendingMutationTypeToNewDbPendingMutation)).then(function(){b.forEach(function(a){return i.add(a.collection)}),j.onOrAfter(h)})}g.sendSyncdMutations=b}),98);
__d("MAWDeleteMsgsForMe",["MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWSyncdDeleteMessageForMeAction","MAWSyncdTxn","MAWTransactionMode","MAWWriteMsgTxns","WALogger","WASyncdDisabled","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteMsgsForMe on syncd: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteMsgsForMe: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a){var e,f,g,j,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:e=a.msgIds;d("WALogger").DEV(i(),e);f=e.map(function(a){return{protocolMsgId:a,type:"delete_for_me"}});if(!d("WASyncdDisabled").isSyncdDisabled()){l.next=9;break}g=f.map(function(a){return{messageAction:a}});j={actions:g,type:"meta_sync"};return l.abrupt("return",d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:j})).then(function(){return void 0}));case 9:d("WALogger").DEV(h(),e);l.next=12;return b("regeneratorRuntime").awrap(c("MAWSyncdDeleteMessageForMeAction").getMutations(e));case 12:k=l.sent;return l.abrupt("return",d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingMutations:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDexieTable").dexieAll(f.map(function(b){return d("MAWWriteMsgTxns").handleDeleteForMe(a,b)})).then(function(){return d("MAWSyncdTxn").sendSyncdMutations(a,k)})})());case 14:case"end":return l.stop()}},null,this)}).end();g.deleteMsgsForMe=a}),98);
__d("WADeleteChatSyncBase",["WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.version=6,c.action=d("WASyncdConst").Actions.DeleteChat,b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.buildDeleteChatMutation=function(a){var b=a.timestamp,c=a.chatId,e=a.mergedRange;a=a.deleteMediaFiles;e={deleteChatAction:{messageRange:e}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.RegularHigh,indexArgs:this.buildDeleteChatIndexArgs(c,a),value:e,version:this.version,operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:b,action:this.action})};c.buildDeleteChatIndexArgs=function(a,b){return[a,b?"1":"0"]};return b}(d("WASyncdAction").SyncActionBase);g.DeleteChatSyncBase=a}),98);
__d("MAWSyncdDeleteChatAction",["MAWWriteMetaSyncsApi","WADeleteChatSyncBase","WAJids","WASyncdConst","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.applyMutations=function(a){var b=[],c=a.map(function(a){if(a.operation==="remove")return{actionState:d("WASyncdConst").SyncActionState.Unsupported};var c=a.indexParts;a=a.value;c=c[1];c=d("WAJids").validateChatJid(c);if(c==null)return{actionState:d("WASyncdConst").SyncActionState.Malformed};a=(a=a.deleteChatAction)==null?void 0:(a=a.messageRange)==null?void 0:a.lastMessageTimestamp;a=a==null?void 0:d("WATimeUtils").castLongIntToUnixTime(a);b.push({chatAction:{chatJid:c,messageRange:{lastMessageTimestamp:a,messages:[]},type:"chat_delete"}});return{actionState:d("WASyncdConst").SyncActionState.Success}});return d("MAWWriteMetaSyncsApi").writeMetaSyncs(b).then(function(){return c})};c.getMutation=function(a,b){var c=d("WATimeUtils").unixTimeMs();return this.buildDeleteChatMutation({chatId:a,deleteMediaFiles:!0,mergedRange:{lastMessageTimestamp:b,messages:[]},timestamp:c})};return b}(d("WADeleteChatSyncBase").DeleteChatSyncBase);b=new a();c=b;g["default"]=c}),98);
__d("MAWDeleteThread",["MAWDbThread","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWSyncdDeleteChatAction","MAWSyncdTxn","MAWThreadTypes","MAWTransactionMode","MAWWriteMetaSyncsTxns","WALogger","WAPREList","WAPREMetrics","WASyncdDisabled","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteThread job: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a){var e,f,g,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:e=a.chatId;d("WALogger").DEV(h(),e);f=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DELETE_THREAD,void 0,e);g=d("MAWDbThread").unsafeCoerceToChatId(e);n.next=6;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getThreadInfoForDeletion(g));case 6:i=n.sent;j=i.newestMsgTs!=null?d("WATimeUtils").futureUnixTime(1,i.newestMsgTs):void 0;k={chatJid:i.chatJid,messageRange:{lastMessageTimestamp:j,messages:[]},type:"chat_delete"};if(!d("WASyncdDisabled").isSyncdDisabled()){n.next=14;break}l={actions:[{chatAction:k}],type:"meta_sync"};return n.abrupt("return",d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:l})).then(function(){f.endSuccess()})["catch"](function(){f.endFail("delete_thread_failed")}));case 14:m=c("MAWSyncdDeleteChatAction").getMutation(i.chatJid,j);return n.abrupt("return",d("MAWIndexedDb").makeMsgrTransactor(babelHelpers["extends"]({},d("MAWThreadTypes").ThreadRelatedTablesPermissions,{pendingMutations:d("MAWTransactionMode").READWRITE}))(function(a){return d("MAWWriteMetaSyncsTxns").handleChatDelete(a,k).then(function(){return d("MAWSyncdTxn").sendSyncdMutations(a,[m])})})());case 16:case"end":return n.stop()}},null,this)}).end();g.deleteThread=a}),98);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWDbMsgTxns","MAWDownloadMedia","MAWGlobals","MAWIndexedDb","MAWTransactionMode","WAJids","WALogger","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId"]);j=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(a){var c,e,f,g,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:c=a.hash,e=a.protocolMsgId,f=a.qplEntryPoint;g=d("WAJids").switchOnMsgrChatJidType(e.chat,{group:function(a){return"group"},user:function(a){return"user"}});d("WALogger").DEV(j(),c,e);k=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{string:{chat_type:g,downloadEntry:f}},void 0,{string:{jid:e.chat}});n.next=6;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(e));case 6:l=n.sent;if(!(l==null)){n.next=11;break}k.endFail("missingMsgIdInDb");d("WALogger").ERROR(i());return n.abrupt("return");case 11:n.next=13;return b("regeneratorRuntime").awrap(d("MAWDownloadMedia").downloadMedia(e,c,k));case 13:m=n.sent;if(m.success){n.next=21;break}k.endFail(m.error);d("WALogger").LOG(h(),l);n.next=19;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").updateSystemAck)(l,d("MAWAckLevel").ACK.failed));case 19:n.next=22;break;case 21:k.endSuccess();case 22:case"end":return n.stop()}},null,this)}).end();g.downloadAndHandleMedia=a}),98);
__d("MAWHandleMediaDownloadAndRestoreApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWIndexedDb","MAWMediaManagementTxns","MAWTransactionMode","WAJids","WALogger","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry missing from the db"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message entry missing from the db"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] encoded data entries missing from the db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] encoded data entry missing from the db for the given message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory data for media download is missing in the access check restore flow"]);l=function(){return a};return a}a=function(a,b){var c=d("WAMediaUtils").stringToDeliveryObjectId(a);return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READONLY})(function(a){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,c).then(function(c){if(c!=null){var e=c.msgIds.pop();return d("MAWDbMsgTxns").maybeGetMsg(a,e).then(function(f){if(f!=null){var g=c==null?void 0:c.mediaEntries;if(g!=null){g=g.get(e);if(g!=null){var h=c.hashedPlaintextHash;m(a,g,b,h,e);g=f.threadJid;var o=f.author,p=c.mediaType;if(g!=null&&!d("WAJids").isAuthorSystem(o))return n(c,p,f.externalId,h,g,o);else d("WALogger").ERROR(l())}else d("WALogger").ERROR(k())}else d("WALogger").ERROR(j())}else d("WALogger").ERROR(i())})}else d("WALogger").ERROR(h());return null})})()};function m(a,b,c,e,f){b=d("WAMediaUtils").decodeMediaEntryData(b);b=d("WAMediaUtils").encodeMediaEntryWithUpdatedPath(b,c);d("MAWMediaManagementTxns").updateMediaWithEncodedMediaEntryData(a,e,f,b)}function n(a,b,c,d,e,f){var g=a.plaintextHash;if(b==="Video"){var h,i,j,k,l;h=(h=a.validatedVideoInfo)==null?void 0:h.width;i=(i=a.validatedVideoInfo)==null?void 0:i.height;j=(j=a.validatedVideoInfo)==null?void 0:j.jpegThumbnailWidth;k=(k=a.validatedVideoInfo)==null?void 0:k.jpegThumbnailHeight;l=(l=a.validatedVideoInfo)==null?void 0:l.duration;return{author:f,externalId:c,hashedPlaintextHash:d,height:i,mediaPlayableDuration:l,mediaType:b,plaintextHash:g,previewContentHeight:k,previewContentWidth:j,threadJId:e,width:h}}else if(b==="Image"||b==="Sticker"||b==="Gif"){l=(i=a.validatedImageInfo)==null?void 0:i.width;j=(k=a.validatedImageInfo)==null?void 0:k.height;i=(h=a.validatedImageInfo)==null?void 0:h.jpegThumbnailWidth;h=(k=a.validatedImageInfo)==null?void 0:k.jpegThumbnailHeight;return{author:f,externalId:c,hashedPlaintextHash:d,height:j,mediaType:b,plaintextHash:g,previewContentHeight:h,previewContentWidth:i,threadJId:e,width:l}}else if(b==="Ptt"){j=(k=a.validatedAudioInfo)==null?void 0:k.duration;return{author:f,externalId:c,hashedPlaintextHash:d,mediaPlayableDuration:j,mediaType:b,plaintextHash:g,threadJId:e}}}g.writeCdnUrlAndBakeDownloadPayload=a}),98);
__d("MAWDownloadAndRestoreMedia",["LSDataTraceCheckPoint.re","MAWGlobals","MAWHandleEchoMediaMsgsRestore","MAWHandleMediaDownloadAndRestoreApi","MAWTraceUtils","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job completed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] download metadata is missing"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job started"]);j=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndRestoreMedia",function(a){var e,f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:e=a.deliveryObjectId,f=a.restorationCdnUrl,g=a.traceId;d("WALogger").LOG(j());l.next=4;return b("regeneratorRuntime").awrap(d("MAWHandleMediaDownloadAndRestoreApi").writeCdnUrlAndBakeDownloadPayload(e,f));case 4:k=l.sent;if(!k){l.next=10;break}l.next=8;return b("regeneratorRuntime").awrap(d("MAWHandleEchoMediaMsgsRestore").handleDownloadMedia(k,g));case 8:l.next=12;break;case 10:d("WALogger").ERROR(i()),d("MAWTraceUtils").recordFailureAndFlushForTraceId(g,c("LSDataTraceCheckPoint.re").labyrinthMediaRestoreFailure,[],"Download metadata is missing");case 12:d("WALogger").LOG(h());case 13:case"end":return l.stop()}},null,this)}).end();g.downloadAndRestoreMedia=a}),98);
__d("MAWWriteForwardedMsgApi",["MAWAckLevel","MAWBridgeTypes","MAWBridgeXMA","MAWDbMsg","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWJidUtils","MAWMediaManagementTxns","MAWMsgReceiptPreparationTxns","MAWTransactionMode","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","WAJids","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE})(function(a,b,c,e,f,g,k,l,m){k===void 0&&(k=!1);return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e),a.messages.where("externalId").equals(b).toArray()]).then(function(c){var n=c[0],o=c[1];c=c[2];if(n==null)return{type:"missing_thread"};if(o==null)return{type:"missing_msg"};if(o.ephemeralSetting!=null&&o.ephemeralSetting.ephemeralExpirationInSec!==0)return{type:"forwarding_ephemeral_msg"};c=c.find(function(a){return a.thread===n.chatId&&a.author===d("WAJids").AUTHOR_ME});if(c!=null)return c.ack>=d("MAWAckLevel").ACK.sent?{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:c.externalId},type:"already_sent"}:{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:c.externalId},type:"not_sent"};else{var p;c=d("MAWDbMsg").craftMsgId(n.chatId,n.nextInChatMsgId);p={ack:d("MAWAckLevel").ACK.clock,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_ME,ephemeralSetting:d("MAWGating").isEphemeralMessagesEnabled()&&g!=null?g:void 0,externalId:b,forwardingScore:((p=o.forwardingScore)!=null?p:0)+1,isForwarded:o.author!==d("WAJids").AUTHOR_ME,mediaId:o.mediaId,msgContent:o.type==="Text"?o.msgContent:void 0,msgId:c,specialTextSize:o.specialTextSize,thread:n.chatId,threadJid:n.jid,ts:f};var q=h(o.type,p,o.type==="Text"?o.msgContent:{content:""},o.xmaMessageType);p=o.mediaId;var r=j(a,e,q,o,n.chatId,n.jid);p=i(a,p,q,o,n.chatId);return d("MAWDexieTable").dexieAll([d("MAWWriteMsgTxns").writeMsg(a,q,n,{isFirstMsg:k,openMessageParticipantCount:l,participantCount:m}).then(function(a){return a.rowId}),d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,c,n.jid),r,p]).then(function(a){return{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:n.jid,externalId:q.externalId},type:"not_sent"}})}})});function h(a,b,e,f){switch(a){case"Text":return babelHelpers["extends"]({},b,{msgContent:e,type:d("WAMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.IMAGE});case"Video":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.STICKER});case"XMA":if(f==null)throw c("err")("XMA type is null in forward msg");return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:f});default:throw c("err")("Should not be forwarding a message of type: "+a)}}function i(a,b,e,f,g){b=b!=null?a.media.get({mediaId:b}):d("MAWDexieTable").dexieResolve(null);return b.then(function(b){if(b==null&&d("MAWDbMsg").isMediaMsg(e))throw c("err")("Could not find media of forwarded message");return b!=null?d("MAWMediaManagementTxns").linkMedia(a,e.msgId,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},b.hashedPlaintextHash).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(g,a,!0)})}):d("MAWDexieTable").dexieResolve()})}function j(a,b,e,f,g,h){return!d("MAWGating").isXMAFeedPostShareEnabled()||!d("MAWXMAUtils").isXMAShare(f.xmaMessageType)?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null)return;var i=b.defaultPreviewMediaId,j=b.faviconMediaId,k=b.headerMediaId,l=Array.from(new Set([i,j,k].filter(Boolean)));l=l.map(function(b){return a.media.get(b).then(function(a){if(a==null)throw c("err")("Could not find media of forwarded xma message");return a})});return d("MAWDexieTable").dexieAll(l).then(function(l){l=l.map(function(b){return d("MAWMediaManagementTxns").linkMedia(a,e.msgId,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},b.hashedPlaintextHash,void 0,void 0,!0)});return d("MAWDexieTable").dexieAll(l).then(function(f){f=f.reduce(function(a,b){return a.set(b.mediaId,b)},new Map());var l=i==null?void 0:f.get(i);if(i==null)throw c("err")("Preview Media is missing");f=d("MAWJidUtils").maybeToProtocolMsgId(e.author,h,e.externalId);if(f==null)throw c("err")("ProtocolMsgId is null for forward XMA Share");return d("MAWXMAManagementTxns").saveXMA(a,i,k,j,b.targetType,e.msgId,void 0,f,{defaultCTA:b.defaultCTA,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(g,l,a)})})})})})}g.writeForwardedMsg=a;g.maybeLinkMediaMsg=i;g.maybeLinkXMAShareMsg=j}),98);
__d("MAWForwardMsg",["MAWGlobals","MAWJobDefinitions","MAWWriteForwardedMsgApi","WAJobOrchestratorTypes","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward an ephemeral message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward a non-existent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot send to a non-existent thread"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg already sent message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: ",""]);l=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a,c,e){var f,g,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:c=a.chatJid,f=a.ephemeralSetting,g=a.externalId,m=a.protocolMsgId;d("WALogger").DEV(l(),c);o.next=4;return b("regeneratorRuntime").awrap(d("MAWWriteForwardedMsgApi").writeForwardedMsg(g,c,m,e.jobStartTime,f));case 4:n=o.sent;if(!(n.type==="already_sent")){o.next=10;break}d("WALogger").LOG(k());return o.abrupt("return");case 10:if(!(n.type==="missing_thread")){o.next=15;break}d("WALogger").LOG(j());return o.abrupt("return");case 15:if(!(n.type==="missing_msg")){o.next=20;break}d("WALogger").LOG(i());return o.abrupt("return");case 20:if(!(n.type==="forwarding_ephemeral_msg")){o.next=23;break}d("WALogger").LOG(h());return o.abrupt("return");case 23:o.next=25;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(n.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 25:case"end":return o.stop()}},null,this)}).end();g.forwardMsg=a}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return!b.success?b:b}g.parseNonRetryableIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableIQError"],[b,c])}g.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchSelfResponseError=a}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"manufacturer");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"seen");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"creation");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"ip");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"location");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"latitude");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"longitude");if(!c.success)return c;a=d("WASmaxParseUtils").contentString(a);return!a.success?a:d("WAResultOrError").makeResult({latitude:b.value,longitude:c.value,elementValue:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"manufacturer",i);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"model",j);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"seen",k);if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"creation",l);if(!g.success)return g;var o=d("WASmaxParseUtils").optionalChildWithTag(a,"ip",m);if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"location",n);if(!p.success)return p;var q=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!q.success)return q;a=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({id:q.value},a.value,{platform:b.value,manufacturer:c.value,model:e.value,seen:f.value,creation:g.value,ip:o.value,location:p.value}))}g.parseDeviceInfoPlatform=h;g.parseDeviceInfoManufacturer=i;g.parseDeviceInfoModel=j;g.parseDeviceInfoSeen=k;g.parseDeviceInfoCreation=l;g.parseDeviceInfoIp=m;g.parseDeviceInfoLocation=n;g.parseDeviceInfoMixin=a}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"self");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"device",1,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{selfDevice:b.value}))}g.parseFetchSelfResponseSuccessSelfDevice=h;g.parseFetchSelfResponseSuccess=a}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("self",null)));return a}g.makeFetchSelfRequest=a}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=d("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest();h.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=h.sent;f=d("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(e,c);if(!f.success){h.next=7;break}return h.abrupt("return",{name:"FetchSelfResponseSuccess",value:f.value});case 7:g=d("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(e,c);if(!g.success){h.next=10;break}return h.abrupt("return",{name:"FetchSelfResponseError",value:g.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:f,Error:g}));case 11:case"end":return h.stop()}},null,this)}g.sendFetchSelfRPC=a}),98);
__d("MAWGetCurrentUserDeviceList",["MAWGlobals","WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]);h=function(){return a};return a}function i(a,b){if(a.isCurrentDevice&&b.isCurrentDevice){d("WALogger").ERROR(h());return 0}if(a.isCurrentDevice)return-1;if(b.isCurrentDevice)return 1;if(a.lastSeen!=null&&b.lastSeen==null)return-1;if(a.lastSeen==null&&b.lastSeen!=null)return 1;if(a.lastSeen!=null&&b.lastSeen!=null){a=a.lastSeen;b=b.lastSeen;return b.getTime()-a.getTime()}return 0}a=function(){var a,e,f,g,h;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC());case 2:a=j.sent;j.t0=a.name;j.next=j.t0==="FetchSelfResponseError"?6:j.t0==="FetchSelfResponseSuccess"?19:21;break;case 6:e=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;j.t1=e.name;j.next=j.t1==="RetryableIQError"?10:16;break;case 10:f=e.value.backoff;if(!(f!=null)){j.next=15;break}throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:f,type:"constant"},jitter:0});case 15:throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});case 16:e.name;g=e.value.code;throw c("err")("Failed with an error code "+g);case 19:h=d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid());return j.abrupt("return",a.value.selfDevice.map(function(a){var b=a.creation,c=a.elementValue,e=a.id,f=a.ip,g=a.location,i=a.manufacturer,j=a.model,k=a.platform;a=a.seen;return{creationTime:b==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(b.elementValue)),id:d("WAJids").interpretAsDeviceId(e),identityKey:d("WASignalKeys").serializeIdentity(c),ipAddress:(b=f==null?void 0:f.elementValue)!=null?b:null,isCurrentDevice:e===h,lastSeen:a==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(a.elementValue)),latitude:g==null?null:parseFloat(g.latitude),location:(c=g==null?void 0:g.elementValue)!=null?c:null,longitude:g==null?null:parseFloat(g.longitude),manufacturer:(f=i==null?void 0:i.elementValue)!=null?f:null,model:(b=j==null?void 0:j.elementValue)!=null?b:null,platform:(e=k==null?void 0:k.elementValue)!=null?e:null}}).sort(i));case 21:return j.abrupt("return",c("WAAssertUnreachable")(a.name));case 22:case"end":return j.stop()}},null,this)};e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("getCurrentUserDeviceList",a).end();g.getCurrentUserDeviceListFn=a;g.getCurrentUserDeviceList=e}),98);
__d("MAWGetSpams",["MAWGlobals","WAComms","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams result: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams called"]);i=function(){return a};return a}var j=new(d("WAWapParser").WapParser)("getSpamsResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")});a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("getSpams",function(){var a,c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d("WALogger").LOG(i());a=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"get",xmlns:"fbid:thread"},d("WAWap").wap("spam_request",null));f.next=4;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(a,j));case 4:c=f.sent;d("WALogger").LOG(h(),c);if(c.success){f.next=11;break}e=c.errorCode.toString().startsWith("5");if(!e){f.next=10;break}throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1});case 10:return f.abrupt("return",!1);case 11:return f.abrupt("return",!0);case 12:case"end":return f.stop()}},null,this)}).end();g.getSpams=a}),98);
__d("MAWProcessFutureproofMsgApi",["MAWConvertFutureproofMsgTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","MAWUnstoredContentToUnstoredDbContentUtils","WADecodeIncomingMsg","WAJids","WALogger","WAMsgType","WAParseV3Protocol"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs doesn't support system message for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for ephemeral setting msg"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for skdm"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs tried to decode non plaintext v3 message ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs get a futureproof message for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs got error for message ",", delete this message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["there is no support for receiving admin messages, they are only generated locally"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs thread for "," no longer exists"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{appMeta:d("MAWTransactionMode").READWRITE,chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("processFutureProofMsgs",!1)))(function(a,b){return d("MAWDbMsgTypeVersionTxns").getMsgTypeVersion(a).then(function(c){var e=[];if(c!=null&&c<b){d("MAWDbMsgTypeVersionTxns").updateMsgTypeVersion(a,b);return d("MAWDbMsgTxns").getFutureProofMsgs(a).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbThreadTxns").getThread(a,b.thread).then(function(c){if(!c.success){d("WALogger").WARN(o(),b.thread);return}c=c.value;var f=c.jid,g=p(b,f);if(!g)return;if(d("WAJids").isAuthorSystem(g.author)){d("WALogger").WARN(n());return}if(g.msg.type==="error"){d("WALogger").WARN(m(),b.msgId);return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId).then(function(){})}f=d("WAParseV3Protocol").parseV3Protocol(g.msg,f,g.externalId,g.author,g.ts);g=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(f);f=g.unstoredDbMedia;g=g.unstoredDbMsg;if(!g)return;if(g.type===d("WAMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").WARN(l(),b.msgId);return}return d("MAWConvertFutureproofMsgTxns").convertFutureproofMsg(a,g,b,f,c).then(function(a){a!=null&&e.push(a)})})}))}).then(function(){return e})}else if(c==null)return d("MAWDbMsgTypeVersionTxns").addMsgTypeVersion(a,1).then(function(){return e});return e})});function p(a,b){var c=d("WADecodeIncomingMsg").decodeIncomingMsg(new Uint8Array(a.msgContent.protobuf),"v3",a.author===d("WAJids").AUTHOR_ME?b:null);if(c.version!=="v3"){d("WALogger").WARN(k(),a.msgId);return null}else if(c.type==="skdm"||c.type==="msgWithSKDM"){d("WALogger").WARN(j());return null}else if(c.type==="ephemeral"){d("WALogger").WARN(i());return null}var e=a.author;if(d("WAJids").isAuthorSystem(e)){d("WALogger").WARN(h(),a.msgId);return null}return{author:e,chat:b,externalId:a.externalId,msg:c,ts:a.ts}}g.processFutureProofMsgs=a}),98);
__d("MAWHandleFutureProofMsg",["MAWGlobals","MAWJobDefinitions","MAWProcessFutureproofMsgApi","Promise","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWProcessFutureproofMsgApi").processFutureProofMsgs(d("MAWGlobals").getConfig().supportedTypesVersion()));case 2:a=e.sent,c=[],a.forEach(function(a){c.push(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(a.protocolMsgId,a.plaintextHash,"MAWHandleFutureproofMsg")))}),b("Promise").all(c);case 6:case"end":return e.stop()}},null,this)};c=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("checkMessageTypeUpdateAndHandleMsg",a).end();g.handleFutureproofMsgFn=a;g.handleFutureproofMsg=c}),98);
__d("MAWLinkReactionsToMsgs",["MAWGlobals","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["linkReactionsToMsgs called"]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("linkReactionsToMsgs",function(a){a=a.externalIds;d("WALogger").LOG(h());return d("MAWGlobals").getDbImpls().linkReactionsToMsgs(a)}).end();g.linkReactionsToMsgs=a}),98);
__d("MAWGetUnreadMsgsApi",["MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getUnreadMsgs",!1)))(function(a,b,c){return a.threads.get({jid:b}).then(function(b){if(b==null)return{type:"missing"};var e=d("MAWDbMsgTxns").maybeGetMsg(a,b.lastReadMsg);return e.then(function(e){if(b.lastReadMsg==null)return{type:"none"};var f=(e=e==null?void 0:e.msgId)!=null?e:b.lastReadMsg;return d("MAWDbMsgTxns").getMsgsNeedingRetroactiveReadReceiptsUpTo(a,b.chatId,f).then(function(e){var g=b.lastReadMsgReceiptSent,i=b.oldestMsg,j=b.jid,k=d("MAWDexieTable").dexieResolve(),l=c-e.length;if(i==null||g!=null&&f<=g||l<=0){if(e.length===0)return{type:"none"}}else{var m=g==null;k=a.messages.where("msgId").between(g||i,f,m,!0).limit(l).toArray().then(function(b){var c=h(b,j);return c.length===0?a.messages.where("msgId").between(g||i,f,m,!0).toArray().then(function(b){var a=h(b,j);return{nextMsgs:b.slice(0,l),unreadNextMsgs:a.slice(0,l)}}):{nextMsgs:b,unreadNextMsgs:c}})}return k.then(function(a){var b,d;a==null?(b=e,d=h(b,j)):(b=[].concat(e,a.nextMsgs),d=[].concat(h(e,j),a.unreadNextMsgs));if(b.length==0||d.length===0)return{type:"none"};a=b[b.length-1];var g=d[d.length-1];return{loadedUpTo:{author:g.author,chat:j,externalId:g.externalId},maybeMore:a.msgId!==f&&b.length===c,type:"found",unreadMsgs:d}})})})})});function h(a,b){var c=[];a.forEach(function(a){var e=a.author,f=a.externalId;a=a.type;a=a!==d("WAMsgType").MSG_TYPE.CIPHERTEXT&&a!==d("WAMsgType").MSG_TYPE.UNAVAILABLE&&a!==d("WAMsgType").MSG_TYPE.FUTUREPROOF;!d("WAJids").isAuthorMe(e)&&!d("WAJids").isAuthorSystem(e)&&a&&c.push({author:e,chat:b,externalId:f})});return c}g.getUnreadMsgs=a}),98);
__d("MAWMarkReadReceiptsSentUpToApi",["MAWBridge","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markReadReceiptsSentUpTo",!1)))(function(a,b,c){h("success");return d("MAWDexieTable").dexieAll([a.threads.get({jid:b}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(b){var c=b[0],e=b[1];if(c==null){h("missingThread");return{type:"missing_thread"}}else if(e==null){h("invalidMsg");return{type:"invalid_msg"}}return d("MAWDbMsgTxns").clearRetroactiveReadReceiptStatusFromMsgsUpTo(a,c.chatId,e.msgId).then(function(){if(e.thread!==c.chatId){h("invalidMsg");return{type:"invalid_msg"}}var b=c.lastReadMsgReceiptSent;if(b!=null&&e.msgId<b){h("unchanged");return{type:"unchanged"}}return a.threads.put(babelHelpers["extends"]({},c,{lastReadMsgReceiptSent:e.msgId})).then(function(){h("updateLastReadMsgReceiptSent");return{type:"success"}})})})});function h(a){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.SEND_READ_RECEIPTS,key:a})}g.markReadReceiptsSentUpTo=a}),98);
__d("MAWMarkThreadAsReadUpToApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWMarkThreadAsReadTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markThreadAsReadUpTo",!1)))(function(a,b,c){return a.threads.get({jid:b}).then(function(b){if(b==null)return{shouldSendReadReceipts:!1,type:"missing"};return b.newestMsg==null?{shouldSendReadReceipts:!1,type:"missing"}:d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgId(a,b.chatId,b.newestMsg)})});g.markThreadAsReadUpTo=a}),98);
__d("MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi",["MAWEphemeralMsgTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateEphemeralityOnMarkMsgsFromOtherAsRead ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateEphemeralityOnMarkMsgsFromOtherAsRead",!1)))(function(a,b,c){d("WALogger").LOG(h(),b.map(function(a){return a.externalId}));b=b.map(function(a){return{msgId:a,ts:c}});return d("MAWEphemeralMsgTxns").bulkMarkEphemeralMessageAsRead(a,b)});g.updateEphemeralityOnMarkMsgsFromOtherAsRead=a}),98);
__d("MAWMarkThreadAsRead",["MAWGetUnreadMsgsApi","MAWGlobals","MAWMarkReadReceiptsSentUpToApi","MAWMarkThreadAsReadUpToApi","MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi","Promise","WAComms","WAJids","WALogger","WAPromiseQueue","WAWap","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);i=function(){return a};return a}var j=256,k=new(d("WAPromiseQueue").PromiseQueueMap)();a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("markThreadAsRead",function(a,c,e){var f,g,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:f=a.chatJid,c=a.upTo;g=e.interruptJob,m=e.jobStartTime;o.next=4;return b("regeneratorRuntime").awrap(d("MAWMarkThreadAsReadUpToApi").markThreadAsReadUpTo(f,c));case 4:n=o.sent;if(!(n.type==="missing")){o.next=8;break}d("WALogger").DEV(i(),f);return o.abrupt("return",g());case 8:if(n.shouldSendReadReceipts){o.next=11;break}d("WALogger").DEV(h(),f);return o.abrupt("return",g());case 11:n.type;return o.abrupt("return",k.enqueue(String(f),function(){var a,c,e,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:a=!0;case 1:if(!a){h.next=18;break}h.next=4;return b("regeneratorRuntime").awrap(d("MAWGetUnreadMsgsApi").getUnreadMsgs(f,j));case 4:c=h.sent;if(!(c.type!=="found")){h.next=8;break}c.type;return h.abrupt("break",18);case 8:e=c.loadedUpTo,g=c.unreadMsgs;h.next=11;return b("regeneratorRuntime").awrap(l(g,m));case 11:h.next=13;return b("regeneratorRuntime").awrap(d("MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi").updateEphemeralityOnMarkMsgsFromOtherAsRead(g,m));case 13:h.next=15;return b("regeneratorRuntime").awrap(d("MAWMarkReadReceiptsSentUpToApi").markReadReceiptsSentUpTo(f,e));case 15:a=c.maybeMore;h.next=1;break;case 18:case"end":return h.stop()}},null,this)}));case 13:case"end":return o.stop()}},null,this)}).end();function l(a,e){if(a.length===0)return b("Promise").resolve();var f=a[0].chat;return d("WAJids").switchOnChatJidType(f,{group:function(c){var g=d("WAWap").GROUP_JID(c),h=new Map();a.forEach(function(a){var b=a.author,c=h.get(b)||[];c.push(a.externalId);h.set(b,c)});var i=[];h.forEach(function(a,b){i.push(m(g,f,a,b,e))});return b("Promise").all(i)},lidUser:function(a){throw c("err")("LidUserJid is not supported yet")},msgrUser:function(b){b=d("WAWap").USER_JID(b);var c=a.map(function(a){return a.externalId});return m(b,f,c,null,e)},phoneUser:function(a){throw c("err")("PhoneUserJid is not supported yet")}}).then(function(){})}function m(a,b,c,e,f){var g=null;c.length>1&&(g=d("WAWap").wap("list",null,c.slice(1).map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})));c=c[0];f=d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(c),participant:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,t:d("WAWap").CUSTOM_STRING(String(f)),to:a,type:"read"},g);return d("WAComms").deprecatedSendStanzaAndWaitForAck(f,{"class":"receipt",from:b,id:c,participant:e!=null?d("WAJids").defaultDeviceJidForUser(e):null,type:"read"})}g.markThreadAsRead=a}),98);
__d("MAWMediaTypeAttribute",["WAAssertUnreachable","WAMsgType","WAWap"],(function(a,b,c,d,e,f,g){function a(a){if(a==null)return d("WAWap").DROP_ATTR;switch(a.type){case d("WAMsgType").MSG_TYPE.IMAGE:return"image";case d("WAMsgType").MSG_TYPE.VIDEO:return"video";case d("WAMsgType").MSG_TYPE.PTT:return"ptt";case d("WAMsgType").MSG_TYPE.GIF:return"gif";case d("WAMsgType").MSG_TYPE.STICKER:return"sticker";case d("WAMsgType").MSG_TYPE.XMA:return"xma-image";case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.GROUP_INVITE:return d("WAWap").DROP_ATTR;default:return c("WAAssertUnreachable")(a.type)}}function b(a){switch(a.type){case d("WAMsgType").MSG_TYPE.IMAGE:return"image";case d("WAMsgType").MSG_TYPE.VIDEO:return"video";case d("WAMsgType").MSG_TYPE.PTT:return"ptt";case d("WAMsgType").MSG_TYPE.GIF:return"gif";case d("WAMsgType").MSG_TYPE.STICKER:return"sticker";case d("WAMsgType").MSG_TYPE.XMA:return"xma-image";case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.GROUP_INVITE:case d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION:return null;default:return c("WAAssertUnreachable")(a.type)}}g.getMediaTypeAttribute=a;g.getMediaType=b}),98);
__d("MAWSpamReportUtils",["I64","LSMessageContentType.re","MAWAsMessageApplication","MAWGlobals","MAWMediaTypeAttribute","MAWMediaUtils","WAJids","WAMsgApplication.pb","WAMsgType","WAWap","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f){var g,h=d("I64").to_string(a.timestampMs),i=a.isUnsent?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),j=d("WAWap").DROP_ATTR,k,l,m=d("WAWap").DROP_ATTR;g=(g=a==null?void 0:a.text)!=null?g:null;if(d("I64").equal(a.displayedContentTypes,c("LSMessageContentType.re").futureproofPlaceholder)&&g!==null)g=new TextEncoder().encode(g),k=d("WAWap").DROP_ATTR,l=d("WAWap").CUSTOM_STRING("3");else if(d("I64").equal(a.displayedContentTypes,c("LSMessageContentType.re").encryptionPlaceholder))g=null,k=d("WAWap").DROP_ATTR,l=d("WAWap").DROP_ATTR;else if(d("I64").equal(a.displayedContentTypes,c("LSMessageContentType.re").tombstone)||a.isUnsent){var n=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);g=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray();k="text";l=d("WAWap").CUSTOM_STRING("3");m=a.isUnsent?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR}else{n=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);g=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray();k="text";l=d("WAWap").CUSTOM_STRING("3")}return d("WAWap").wap("message",{edit:m,from:e!=null?d("WAWap").GROUP_JID(e):f!=null?d("WAWap").USER_JID(f):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.messageId),participant:f?d("WAWap").USER_JID(f):d("WAWap").DROP_ATTR,t:d("WAWap").CUSTOM_STRING(h),to:b!=null?d("WAWap").USER_JID(b):d("WAWap").DROP_ATTR,type:k,unsent:i},d("WAWap").wap("raw",{mediatype:j,v:l},g))}function b(a,b,c,e,f){var g=(a.ts*1e3).toString(),h=a.type===d("WAMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),i=d("WAWap").DROP_ATTR,j,k,l,m=d("WAWap").DROP_ATTR;if(a.type===d("WAMsgType").MSG_TYPE.FUTUREPROOF)j=new Uint8Array(a.msgContent.protobuf),k=d("WAWap").DROP_ATTR,l=d("WAWap").CUSTOM_STRING("3");else if(a.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT)j=null,k=d("WAWap").DROP_ATTR,l=d("WAWap").DROP_ATTR;else if(a.type===d("WAMsgType").MSG_TYPE.REVOKED||a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var n=d("MAWAsMessageApplication").deletedMsgAsMessageApplicationForSpamReporting(a);if(n==null)return null;j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray();k="text";l=d("WAWap").CUSTOM_STRING("3");m=a.type===d("WAMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR;b!=null&&(i=d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType));g=a.originalTs!=null?(a.originalTs*1e3).toString():g}else{n=d("MAWAsMessageApplication").asMessageApplication(a,b);j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,n).readByteArray();k="text";l=d("WAWap").CUSTOM_STRING("3");i=d("MAWMediaTypeAttribute").getMediaTypeAttribute(a)}b=null;if(d("MAWGlobals").getConfig().isFrankingEnabled()&&((n=a.reportingMeta)==null?void 0:n.frankingTag)!=null&&((n=a.reportingMeta)==null?void 0:n.reportingTag)!=null){b=d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,(n=a.reportingMeta)==null?void 0:n.frankingTag),d("WAWap").wap("reporting_tag",null,(n=a.reportingMeta)==null?void 0:n.reportingTag))}return d("WAWap").wap("message",{edit:m,from:e!=null?d("WAWap").GROUP_JID(e):f!=null?d("WAWap").USER_JID(f):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:f?d("WAWap").USER_JID(f):d("WAWap").DROP_ATTR,t:d("WAWap").CUSTOM_STRING(g),to:c!=null?d("WAWap").USER_JID(c):d("WAWap").DROP_ATTR,type:k,unsent:h},d("WAWap").wap("raw",{mediatype:i,v:l},j),b)}function e(a){var b;a.author===d("WAJids").AUTHOR_ME?b=d("MAWGlobals").getMyUserJid():b=d("WAJids").authorAsUserJid(a.author);if(b==null)throw c("err")("Impossible message author");return b}function f(a,b){a.author===d("WAJids").AUTHOR_ME?a=b:a=d("MAWGlobals").getMyUserJid();if(a==null)throw c("err")("Impossible message recipient");return a}g.formatLSDbMsgForSpamReport=a;g.formatMsgForSpamReport=b;g.getAuthorAsJidForSpam=e;g.getRecipientAsJidForSpam=f}),98);
__d("WAGetGroupInfo",["WAGlobals","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WAGlobals").runInTransaction({GroupInfoStore:!0},function(b){b=b.GroupInfoStore;return h({GroupInfoStore:b},a)},"getGroupInfo")};function h(a,c){var d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d=a.GroupInfoStore;f.next=3;return b("regeneratorRuntime").awrap(d.get(c));case 3:e=f.sent;return f.abrupt("return",e.success?e.value:null);case 5:case"end":return f.stop()}},null,this)}g.getGroupInfo=a;g.getGroupInfoTransactor=h}),98);
__d("MAWReportUserSpam",["I64","MAWGlobals","MAWJids","MAWSpamReportUtils","WAComms","WAGetGroupInfo","WAGlobals","WAJids","WAResultOrError","WAWap","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=30;a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(a){var e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:t=function(a){var b=a;if(n.length<h){var c,d=h-a.length;if(d<((c=s==null?void 0:s.length)!=null?c:0)){b=[].concat(((c=s)!=null?c:[]).slice(0,d),a)}else{b=[].concat((c=s)!=null?c:[],a)}}return b};f=a.chatJid,g=a.context,i=a.frxParams,j=a.frxTags,k=a.openMsgs,l=a.spamFlow,m=a.userJid;v.next=4;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getLastMsgsInChatForSpamReport(f,h));case 4:n=v.sent;o=null;if(!(j!=null)){v.next=10;break}if(!(j.length===0)){v.next=9;break}throw c("err")("spam reasons should not be an empty array");case 9:o=d("WAWap").wap("tagset",null,j.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}));case 10:p=null;i!=null&&i!==""&&(p=d("WAWap").wap("parameters",null,i));q=null;g!=null&&(q=d("WAWap").wap("context",null,g));r=null;(o!=null||q!=null||p!=null)&&(r=d("WAWap").wap("frx",null,o,q,p));s=((e=k)!=null?e:[]).map(function(a){var b=d("MAWJids").toUserJid(d("I64").to_string(a.senderId));if(d("WAJids").interpretAsGroupJid(f)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("MAWJids").toGroupJid(f),b);else{var c=d("I64").equal(a.senderId,d("I64").of_string(d("MAWJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?m:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,c,null,b)}});v.next=19;return b("regeneratorRuntime").awrap(d("WAJids").switchOnMsgrChatJidType(f,{group:function(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:c=d("WAWap").DROP_ATTR;e=d("WAWap").DROP_ATTR;i.next=4;return b("regeneratorRuntime").awrap(d("WAGetGroupInfo").getGroupInfo(a));case 4:f=i.sent;f!=null&&f.subject!=null&&f.subject.content!=null&&(c=d("WAWap").CUSTOM_STRING(f.subject.content));f!=null&&f.inviter!=null&&(e=d("WAWap").USER_JID(f.inviter));g=n.map(function(b){return d("MAWSpamReportUtils").formatMsgForSpamReport(b.msg,b.mediaInfo,null,a,d("MAWSpamReportUtils").getAuthorAsJidForSpam(b.msg))});h=t(g);return i.abrupt("return",d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"spam"},d("WAWap").wap("spam_list",{jid:d("WAWap").GROUP_JID(a),reportee:d("WAWap").USER_JID(m),source:e,spam_flow:d("WAWap").CUSTOM_STRING(l),subject:c},h),r));case 10:case"end":return i.stop()}},null,this)},user:function(){var a=n.map(function(a){return d("MAWSpamReportUtils").formatMsgForSpamReport(a.msg,a.mediaInfo,d("MAWSpamReportUtils").getRecipientAsJidForSpam(a.msg,m),null,d("MAWSpamReportUtils").getAuthorAsJidForSpam(a.msg))}).filter(function(a){return a!=null});a=t(a);return d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"spam"},d("WAWap").wap("spam_list",{jid:d("WAWap").USER_JID(m),reportee:d("WAWap").USER_JID(m),spam_flow:d("WAWap").CUSTOM_STRING(l)},a),r)}}));case 19:u=v.sent;d("WAComms").deprecatedCastStanza(u);return v.abrupt("return",d("WAResultOrError").makeResult());case 22:case"end":return v.stop()}},null,this)}).end();g.reportUserSpam=a}),98);
__d("MAWGetMsgForRequestReuploadMediaApi",["MAWDbMsgTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgForREquestReuploadMedia",!1)))(function(a,b){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a?d("WAResultOrError").makeResult("message-found"):d("WAResultOrError").makeError("message-not-found")})});g.getMsgForRequestReuploadMedia=a}),98);
__d("MAWRequestUploadMedia",["MAWGetMsgForRequestReuploadMediaApi","MAWGlobals","WAComms","WAGetDecodedMediaEntry","WAJids","WALogger","WAMediaRetryCrypto","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestReuploadMedia: executed for msg with invalid author ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestReuploadMedia: msg has been deleted"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestReuploadMedia: missing mediaEntry or mediaKey"]);j=function(){return a};return a}a=function(a){var c,e,f,g,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:c=a.hash,e=a.protocolMsgId;q.next=3;return b("regeneratorRuntime").awrap(d("WAGetDecodedMediaEntry").getDecodedMediaEntry(e,c));case 3:f=q.sent;g=f==null?void 0:f.mediaKey;if(!(g==null)){q.next=8;break}d("WALogger").LOG(j());return q.abrupt("return");case 8:q.next=10;return b("regeneratorRuntime").awrap(d("MAWGetMsgForRequestReuploadMediaApi").getMsgForRequestReuploadMedia(e));case 10:k=q.sent;if(k.success){q.next=14;break}d("WALogger").LOG(i());return q.abrupt("return");case 14:l=d("WAJids").authorAsUserJid(e.author);if(!(l==null)){q.next=18;break}d("WALogger").LOG(h(),e.author);return q.abrupt("return");case 18:q.next=20;return b("regeneratorRuntime").awrap(d("WAMediaRetryCrypto").encryptServerErrorReceipt(g,e.externalId));case 20:m=q.sent;n=m.ciphertext;o=m.iv;p={"class":"receipt",from:l,id:e.externalId,participant:null,type:"server-error"};q.next=26;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendStanzaAndWaitForAck(d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(e.externalId),participant:d("WAWap").DROP_ATTR,to:d("WAWap").JID(l),type:"server-error"},d("WAWap").wap("encrypt",null,d("WAWap").wap("enc_p",null,n),d("WAWap").wap("enc_iv",null,o))),p));case 26:case"end":return q.stop()}},null,this)};c=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("requestReuploadMedia",a).end();g.requestReuploadMediafn=a;g.requestReuploadMedia=c}),98);
__d("WAArrayChunk",[],(function(a,b,c,d,e,f){function a(a,b,c,d){c===void 0&&(c=!1);var e=0,f=[];while(e<a.length){var g=[],h=0;while(e<a.length){var i=a[e],j=d?d(i):1;if(!c&&h===0||h+j<=b)h+=j,g.push(i),e++;else{c&&j>b&&e++;break}}g.length>0&&f.push(g)}return f}f.chunk=a}),66);
__d("WAGetContactsApi",["WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a=a.ContactsStore;return a.bulkGet(b)}a=function(a){return d("WAGlobals").runInTransaction({ContactsStore:!0},function(b){b=b.ContactsStore;return h({ContactsStore:b},a)},"getContacts")};g.getContactsTransactor=h;g.getContacts=a}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchResponseError=a}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return!b.success?b:b}g.parseFetchNonRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:b.value})}g.parseFetchRetryableUserErrorMixin=a}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:b.value});var c=d("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableUserError","NonRetryableUserError"],[b,c])}g.parseFetchOrFetchNonRetryableUserErrorMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(a,"jid");if(!a.success)return a;b=d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult({jid:a.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:b.value})}g.parseFetchUserResponseFailureMixin=a}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"devices");if(!b.success)return b;b=d("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"icdc");if(!b.success)return b;b=d("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"devices",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"icdc",i);if(!c.success)return c;a=d("WASmaxParseJid").attrUserJid(a,"jid");return!a.success?a:d("WAResultOrError").makeResult({jid:a.value,devices:b.value,icdc:c.value})}g.parseFetchUserResponseSuccessDevices=h;g.parseFetchUserResponseSuccessIcdc=i;g.parseFetchUserResponseSuccessMixin=a}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:b.value});var c=d("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UserResponseFailure","UserResponseSuccess"],[b,c])}g.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=a}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:b.value})}g.parseFetchUserResponseMixin=a}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"user");if(!b.success)return b;b=d("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"users");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"user",0,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{usersUser:b.value}))}g.parseFetchResponseSuccessUsersUser=h;g.parseFetchResponseSuccess=a}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyDhash;a=d("WASmaxJsx").smax("smax$any",{dhash:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDhashMixin=a}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySeq;a=d("WASmaxJsx").smax("smax$any",{seq:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeICDCSeqMixin=a}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.userJid,c=a.dhashMixinArgs;a=a.iCDCSeqMixinArgs;b=d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutDevicesDhashMixin").mergeDhashMixin,d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(b)}),c),a);return b}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeFetchRequestUsersUser=h;g.makeFetchRequest=a}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesFetchRequest").makeFetchRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"FetchResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesFetchResponseError").parseFetchResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"FetchResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendFetchRPC=a}),98);
__d("WAFetchDevicesProtocol",["Promise","WAArrayChunk","WADeviceUpdateUtils","WAErr","WAGetContactsApi","WAResultOrErrorUtils","WASmaxDevicesFetchRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=25;function a(a,e,f){var g,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:g=f.onDhashDone,i=f.onAckReturned;if(!(a.length===0)){m.next=3;break}return m.abrupt("return",[]);case 3:j=d("WAArrayChunk").chunk(a,h);if(!e){m.next=8;break}m.t0=[];m.next=11;break;case 8:m.next=10;return b("regeneratorRuntime").awrap(d("WAGetContactsApi").getContacts(a).then(d("WAResultOrErrorUtils").unpackValues));case 10:m.t0=m.sent;case 11:k=m.t0;l=k.reduce(function(a,b){b&&b.dhash!=null&&a.set(b.contactJid,b.dhash);return a},new Map());g==null?void 0:g();return m.abrupt("return",b("Promise").all(j.map(function(a){return d("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:a.map(function(a){var b=l.get(a);b=b!=null?{anyDhash:b}:null;return{userJid:a,dhashMixinArgs:b}})}).then(function(a){if(a.name==="FetchResponseError")throw c("WAErr")("Failed to fetch user devices");i==null?void 0:i();return a.value.usersUser.map(function(a){a=a.userResponseFetchFailureOrFetchSuccessMixinGroup;if(a.name==="FetchUserResponseFailure")return null;a=a.value;var b=a.jid,c=a.devices;a=a.icdc;return d("WADeviceUpdateUtils").parseUserResponseMixin(b,c,a)})})})).then(function(a){return a.flatMap(function(a){return a.filter(Boolean)})}));case 15:case"end":return m.stop()}},null,this)}g.fetchDevicesProtocol=a}),98);
__d("WAGetDevices",["Promise","WABridge","WADeviceUpdateUtils","WAFetchDevicesProtocol","WAJobs","WALogger","WAOdsEnums","WAPREList","WAPREMetrics","WAPromiseQueue","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices User "," already has pending request"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users with reason: ",""]);i=function(){return a};return a}var j=new(d("WAPromiseQueue").PromiseQueueMap)();function k(a,c,e){var f,g,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:e===void 0&&(e=!1);d("WALogger").LOG(i(),c);f=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.GET_DEVICES,{"int":{usersAmount:a.size},bool:{ignoreDhash:e}});g=[];k=[];l=function(a){var b=d("WAFetchDevicesProtocol").fetchDevicesProtocol(a,e,{onDhashDone:function(){return f.addPoint("db_dhash_done")},onAckReturned:function(){return f.addPoint("ack_returned")}}).then(function(a){f.addPoint("request_devices");return d("WADeviceUpdateUtils").updateUsersDevicesSignalAndDB(a)}).then(function(){f.addPoint("user_devices_signal_and_db_updated")});g.push(b);a.forEach(function(a){return j.enqueueHandlers(a,b)})};a.forEach(function(a){var b=j.waitIfPending(a);b!=null?(d("WALogger").DEV(h(),a),g.push(b)):k.push(a)});k.length>0&&l(k);m.next=10;return b("regeneratorRuntime").awrap(b("Promise").all(g).then(function(){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GET_DEVICES,key:"success"});f.endSuccess();return})["catch"](function(a){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GET_DEVICES,key:"fail"});f.endFail("get_devices_fail");throw a}));case 10:case"end":return m.stop()}},null,this)}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("getDevices",function(a){var b=a.users,c=a.reason;a=a.ignoreDhash;return k(b,c,a)}).end();g.fetchAndSaveDevices=k;g.getDevices=a}),98);
__d("MAWResendWrittenAppData",["MAWGlobals","MAWSendAppDataUtils","WAGetDevices","WALogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["resendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("resendWrittenAppData",{code:function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.appDataExternalId;g.next=3;return b("regeneratorRuntime").awrap(d("WAGetDevices").fetchAndSaveDevices(new Set([d("MAWGlobals").getMyUserJid()]),"resend-written-app-data"));case 3:g.next=5;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getAppDataForResend(c));case 5:e=g.sent;if(!(e.type!=="not_sent")){g.next=9;break}d("WALogger").LOG(i(),e.type);return g.abrupt("return");case 9:g.next=11;return b("regeneratorRuntime").awrap(d("MAWSendAppDataUtils").sendAppData(e.appData,c,e.permittedIdentitiesPerDevice,null,!0));case 11:f=g.sent;if(!(f.type==="error")){g.next=15;break}g.next=15;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markAppDataSendFailed(c));case 15:case"end":return g.stop()}},null,this)},stopRetryIf:{onStopRetry:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.appDataExternalId;d("WALogger").LOG(h(),c);e.next=4;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markAppDataDropped(c));case 4:case"end":return e.stop()}},null,this)},timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.resendWrittenAppData=a}),98);
__d("MAWRestoreMessagesFromEncryptedBackups",["MAWBridge","MAWGlobals","MAWHandleEchoMsgsRestoreApi","MAWUpdateClientRestoreStatusOperationType.bs","Promise","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encountered unhandled exception while running job restoreMessagesFromEncryptedBackups: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Job restoreMessagesFromEncryptedBackups, thread: ",", messages count: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreMessages",function(a){var c=a.isPointQuery,e=a.messages,f=a.minMsgId,g=a.startSortKey,j=a.threadId;a=a.traceId;var k={messageIds:[],pendingRestoreSortKeys:[]};k=d("WAResultOrError").makeResult(k);try{d("WALogger").LOG(i(),j,e.length);return d("MAWHandleEchoMsgsRestoreApi").handleEchoMsgsRestore(new Map([[j,e]]),c,f,a,g)}catch(a){d("WALogger").ERROR(h(),a)}finally{g==null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateClientRestoreStatus",value:{action:d("MAWUpdateClientRestoreStatusOperationType.bs").removeClientRestoreStatus,threadId:j}}]})}return b("Promise").resolve(k)}).end();g.restoreMessagesFromEncryptedBackups=a}),98);
__d("MAWHandleEchoThreadsRestoreApi",["EchoThread","MAWDexieTable","MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b){var c=new Set();b=b.reduce(function(b,e){var f;e=d("EchoThread").decodeEchoThread(e);if(e==null)return b;f=(f=e.xThreadId)!=null?f:e.threadId;if(c.has(f))return b;c.add(f);return[].concat(b,[d("MAWThreadManagementTxns").getOrCreateThreadFromEchoThread(a,e).then(function(a){return a==null?void 0:a.thread})])},[]);return d("MAWDexieTable").dexieAll(b).then(function(){return Array.from(c)})});g.handleEchoThreadsRestore=a}),98);
__d("MAWRestoreThreadsFromEncryptedBackups",["MAWGlobals","MAWHandleEchoThreadsRestoreApi","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Job restoreThreadsFromEncryptedBackups, count of threads: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreThreads",function(a){a=a.threads;d("WALogger").LOG(h(),a.length);return d("MAWHandleEchoThreadsRestoreApi").handleEchoThreadsRestore(a)}).end();g.restoreThreadsFromEncryptedBackups=a}),98);
__d("MAWRevokeMsgsApi",["MAWAckLevel","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWMsgReceiptPreparationTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,identity:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("revokeMsgs",!1)))(function(a,b,c){return d("MAWDexieTable").dexieAll(b.filter(function(a){return a.author===d("WAJids").AUTHOR_ME}).map(function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(c){return c==null?d("MAWDbMsgTxns").maybeGetRevokedMsgByProtocolMsgId(a,b):c}),d("MAWDexieTable").dexieResolve(b)])})).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var e=b[0];b=b[1];if(e==null)return;if(e.type==="Revoked"){b={author:d("WAJids").AUTHOR_ME,chat:b.chat,externalId:e.externalId};return{icdcResults:null,plaintextHashs:null,protocolMsgId:b,unknownDevice:!1,unknownGroup:!1}}var f=d("MAWGlobals").getDependencies().generateExternalId();return a.threads.get(e.thread).then(function(b){if(b==null)return{icdcResults:null,plaintextHashs:null,protocolMsgId:null,unknownDevice:!1,unknownGroup:!1};var g={ack:d("MAWAckLevel").ACK.clock,altIndex:null,author:d("WAJids").AUTHOR_ME,externalId:f,mediaId:e.mediaId,msgContent:d("MAWDbMsg").getMsgContent(e),msgId:e.msgId,originalTs:e.ts,quote:e.quote,revokedExternalId:e.externalId,rowId:e.rowId,sortOrderMs:e.sortOrderMs,thread:e.thread,threadJid:b.jid,ts:c,type:"Revoked",unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(c+d("MAWWriteMsgTxns").REVOKE_CONTENT_EXPIRATION_IN_SEC),xmaMessageType:e.xmaMessageType};return d("MAWDexieTable").dexieAll([d("MAWWriteMsgTxns").markMsgAsRevoke(a,e,g,b,!1),d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,e.msgId,b.jid,!0,!0)]).then(function(){return{icdcResults:null,plaintextHashs:null,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:b.jid,externalId:f},unknownDevice:!1,unknownGroup:!1}})})}).filter(Boolean))})});g.revokeMsgs=a}),98);
__d("MAWRevokeMsg",["MAWGlobals","MAWJobDefinitions","MAWRevokeMsgsApi","Promise","WAJids","WAJobOrchestratorTypes","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["revokeMsg: ",""]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("revokeMsg",function(a,c,e){var f,g;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:c=a.msgIds;d("WALogger").DEV(h(),JSON.stringify(c));i.next=4;return b("regeneratorRuntime").awrap(d("MAWRevokeMsgsApi").revokeMsgs(c,e.jobStartTime));case 4:f=i.sent;g=f.map(function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.protocolMsgId;if(!(c!=null&&!d("WAJids").isAuthorSystem(c.author))){e.next=4;break}e.next=4;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(c,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 4:case"end":return e.stop()}},null,this)});return i.abrupt("return",b("Promise").all(g).then(function(){}));case 7:case"end":return i.stop()}},null,this)}).end();g.revokeMsgs=a}),98);
__d("MAWSendGroupInviteMsg",["MAWGlobals","MAWJobDefinitions","WAJobOrchestratorTypes","WALogger","WAMsgType","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg for group "," to invited user ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg failed to store a new group invite"]);k=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a,c,e){var f,g,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=a.args,g=a.externalId;n.next=3;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeGroupInvite(f.groupJid,{expiration:f.expiration,inviteCode:f.inviteCode,invitedParticipantUserJid:f.invitedParticipantUserJid,inviterUserJid:f.inviterUserJid}));case 3:l=n.sent;if(l.success){n.next=7;break}d("WALogger").LOG(k());return n.abrupt("return");case 7:n.next=9;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeOutgoingMsg(g,f.groupJid,e.jobStartTime,babelHelpers["extends"]({},f,{groupName:(c=l.value)!=null?c:void 0}),d("WAMsgType").MSG_TYPE.GROUP_INVITE));case 9:m=n.sent;d("WALogger").DEV(j(),a.args.groupJid,a.args.invitedParticipantUserJid);if(!(m.type==="already_sent")){n.next=16;break}d("WALogger").LOG(i());return n.abrupt("return");case 16:if(!(m.type==="missing_thread")){n.next=19;break}d("WALogger").LOG(h());return n.abrupt("return");case 19:n.next=21;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(m.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 21:case"end":return n.stop()}},null,this)}).end();g.sendGroupInviteMsg=a}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgIdByProtocolMsgId",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b!=null)return b.msgId;else if(c!=null)return c.reactionId;else if(a!=null&&a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME)return a.msgId;else return null})});g.getMsgIdByProtocolMsgId=a}),98);
__d("MAWOptimisticUploadManager",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(){return g}function b(){g.clear()}f.getOptimisticUploadManager=a;f.clearOptimisticUploadManager=b}),66);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWAuthor","MAWDbContactsTxns","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWLLAMigrationUtils","MAWLoadReplyMediaTxns","MAWMsgReceiptPreparationTxns","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAAssertUnreachable","WAJids","WAMsgType","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("writeOutgoingMsg",!1)))(function(a,b,c,e,f,g){f.content!=null&&(f.content=d("MAWVault").vault(f.content));return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),h(a,f.quote,c)]).then(function(c){var h=c[0],k=c[1];c=c[2];if(h==null)return{type:"missing_thread"};k=k.find(function(a){return a.thread===h.chatId&&a.author===d("WAJids").AUTHOR_ME});if(k!=null)return k.ack>=d("MAWAckLevel").ACK.sent?{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:k.externalId},type:"already_sent"}:{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:k.externalId},type:"not_sent"};else{k=d("MAWDbMsg").craftMsgId(h.chatId,h.nextInChatMsgId);if(!d("MAWDbMsg").isUnrenderedMsgType(g)){var m={ack:d("MAWAckLevel").ACK.clock,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_ME,ephemeralSetting:d("MAWGating").isEphemeralMessagesEnabled()?f.ephemeralSetting:void 0,externalId:b,isForwarded:f.isForwarded,msgId:k,specialTextSize:f.specialTextSize,thread:h.chatId,threadJid:h.jid,ts:e},n=i(g,m,f,c),o=f.isFirstMsg,p=f.openMessageOtid,q=f.openMessageParticipantCount,r=f.optimisticMsg,s=f.participantCount;m=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,n).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,n,h,{isCiphertextUpdateForXMAMessageWithAssociatedMsg:!1,isCurrentDeviceSendingMsg:!0,isFirstMsg:o,isOutgoing:!0,openMessageOtid:p,openMessageParticipantCount:q,optimisticMsg:r,participantCount:s,quotedReplyAttachmentMeta:b})}).then(function(a){return a.rowId})}else{c={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,msgId:k,thread:h.chatId,threadJid:h.jid,ts:e};c=j(g,c,f);m=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,c,h)}return d("MAWDexieTable").dexieAll([m,d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,k,h.jid),l(a,g,h.jid,e)]).then(function(){return{protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:h.jid,externalId:b},type:"not_sent"}})}})});function h(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get(b.thread).then(function(a){var e=b?k(b):null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&e!=null&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function i(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{content:e.content!=null?e.content:""},type:d("WAMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.IMAGE});case"Video":return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.STICKER});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");return babelHelpers["extends"]({},f,{type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action or group invite");default:throw c("WAAssertUnreachable")(a)}}function j(a,b,e){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":var f=d("WAJids").interpretAsGroupJid(b.threadJid);if(f==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("WAMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION});default:throw c("WAAssertUnreachable")(a)}}function k(a){var b={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.GIF});case d("WAMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("WAMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.UNAVAILABLE});default:throw c("err")("Trying to reply to a message type that does not support replies")}}function l(a,b,c,e){if(b===d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return d("MAWDbContactsTxns").getContact(a,b).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:e};return a.contacts.put(b)}).then(function(){})}});return b===d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return d("MAWDbContactsTxns").getContact(a,b).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.contacts.put(b).then(function(){})})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=a}),98);
__d("MAWSendMediaMsg",["FBLogger","MAWAckLevel","MAWAsConsumerApplication","MAWBridge","MAWBridgeTypes","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWFrontendMediaUtils","MAWGating","MAWGetMsgIdByProtocolMsgId","MAWGetThreadsInfoApi","MAWGlobals","MAWIndexedDb","MAWJidUtils","MAWJobDefinitions","MAWMediaBackupTxns","MAWMediaManagementTxns","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","MAWWriteOutgoingMsgApi","Promise","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaQplHelper","WAMediaUtils","WAMsgType","WAPREList","WAPREMetrics","WASortedLists","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required args for media backup in send media"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send media: "," - missing thread"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMediaMsg - begin writing "," media msg"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chat ",": "," is received in job"]);l=function(){return a};return a}function m(a,e){var f,g,h,i,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:f=a.args,g=a.chatJid,h=a.externalId,i=a.file;d("WALogger").LOG(l(),g,i.name);m=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(i.type),n=m.mediaType,o=m.serverMediaType;r.t0=n;r.next=r.t0===d("MAWDbMedia").MEDIA_TYPE.IMAGE?6:r.t0===d("MAWDbMedia").MEDIA_TYPE.VIDEO?8:r.t0===d("MAWDbMedia").MEDIA_TYPE.PTT?10:r.t0===d("MAWDbMedia").MEDIA_TYPE.GIF?12:r.t0===d("MAWDbMedia").MEDIA_TYPE.STICKER?14:16;break;case 6:p=d("WAMsgType").MSG_TYPE.IMAGE;return r.abrupt("break",18);case 8:p=d("WAMsgType").MSG_TYPE.VIDEO;return r.abrupt("break",18);case 10:p=d("WAMsgType").MSG_TYPE.PTT;return r.abrupt("break",18);case 12:p=d("WAMsgType").MSG_TYPE.GIF;return r.abrupt("break",18);case 14:p=d("WAMsgType").MSG_TYPE.STICKER;return r.abrupt("break",18);case 16:c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Expected media msg type");case 18:d("WALogger").LOG(k(),p);r.next=21;return b("regeneratorRuntime").awrap(d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(h,g,e,f,p));case 21:q=r.sent;if(!(q.type==="missing_thread")){r.next=25;break}d("WALogger").LOG(j(),i.name);throw c("err")("Failed to write msg to DB");case 25:return r.abrupt("return",[q,{mediaType:n,serverMediaType:o}]);case 26:case"end":return r.stop()}},null,this)}function n(a,e,f,g,h){var j,k,l,m,n,r,s,t,u,v,w,x,y,z,A;return b("regeneratorRuntime").async(function(B){while(1)switch(B.prev=B.next){case 0:k=e.mediaType,l=e.serverMediaType;m=h.args,n=h.chatJid,h.externalId,r=h.file;s=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(l);if(s){B.next=6;break}c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Media type unsupported: "+((t=l)!=null?t:""));case 6:B.next=8;return b("regeneratorRuntime").awrap(d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(a.protocolMsgId));case 8:u=B.sent;if(!(u==null)){B.next=11;break}throw c("err")("Message missing in db");case 11:v={validatedAudioInfo:k==="Ptt"&&m.duration!=null?{duration:m.duration,mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedImageInfo:k==="Image"?{height:m.height,jpegThumbnail:m.jpegThumbnail,jpegThumbnailHeight:m.jpegThumbnailHeight,jpegThumbnailWidth:m.jpegThumbnailWidth,width:m.width}:k==="Gif"||k==="Sticker"?{height:m.height,jpegThumbnailHeight:m.height,jpegThumbnailWidth:m.width,width:m.width}:null,validatedVideoInfo:k==="Video"?{duration:m.duration,height:m.height,jpegThumbnail:m.jpegThumbnail,jpegThumbnailHeight:m.jpegThumbnailHeight,jpegThumbnailWidth:m.jpegThumbnailWidth,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:m.width}:null};B.next=14;return b("regeneratorRuntime").awrap(d("MAWGetThreadsInfoApi").getThreadIdByJid(n));case 14:w=B.sent;if(!(w==null)){B.next=17;break}throw c("err")("Missing thread with jid: "+n);case 17:B.next=19;return b("regeneratorRuntime").awrap(p(w,u,r,f,g,void 0,void 0,k,v));case 19:x=d("MAWOptimisticUploadManager").getOptimisticUploadManager();y=x.get(f);z=y==null?void 0:y.optimisticUploadPromise;if(!(z!=null)){B.next=28;break}B.next=25;return b("regeneratorRuntime").awrap(z);case 25:B.t0=B.sent;B.next=31;break;case 28:B.next=30;return b("regeneratorRuntime").awrap(d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",{chatJid:n,hash:f,mediaTypeDetails:{serverMediaType:l},protocolMsgId:a.protocolMsgId,size:r.size,uploadMediaFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{bool:{isOptimisticUpload:!1},string:{chat_type:d("WAJids").switchOnMsgrChatJidType(n,{group:function(a){return"group"},user:function(a){return"user"}}),media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(r.size),media_type:k}},void 0,{string:{jid:n}})}));case 30:B.t0=B.sent;case 31:A=B.t0;if(A.success){B.next=35;break}d("WALogger").LOG(i(),r.name);return B.abrupt("return",o(u,d("MAWAckLevel").ACK.failed));case 35:B.next=37;return b("regeneratorRuntime").awrap(q(f,u,n,a.protocolMsgId.externalId,(j=A.value)==null?void 0:j.objectId,l));case 37:B.next=39;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(a.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 39:x["delete"](f),(y==null?void 0:y.previewPlaintextHash)!=null&&x["delete"](y.previewPlaintextHash);case 41:case"end":return B.stop()}},null,this)}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendMediaMsg",function(a,c,e){var f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:k.next=2;return b("regeneratorRuntime").awrap(m(a,e.jobStartTime));case 2:c=k.sent;f=c[0];g=c[1];k.next=7;return b("regeneratorRuntime").awrap(d("MAWMediaUtils").genBlobHashes(a.file));case 7:h=k.sent;i=h[0];j=h[1];k.next=12;return b("regeneratorRuntime").awrap(n(f,g,i,j,a));case 12:case"end":return k.stop()}},null,this)}).end();var o=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c).then(function(){})});function p(a,c,e,f,g,h,i,j,k){var l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(e));case 2:l=m.sent;return m.abrupt("return",d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE})(function(b){return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(b,c,f,g,h,i,j,e.size,k,!1),d("MAWDbChunkTxns").getOrCreateMediaChunk(b,f,g,l,e.type)]).then(function(b){b=b[0];d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(a,b,!0)})})})());case 4:case"end":return m.stop()}},null,this)}function q(a,e,f,g,i,j){var k=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),l=k.get(a),m=l==null?void 0:l.mediaEntry;if(l==null)return b("Promise").resolve();k.set(a,babelHelpers["extends"]({},l,{msgId:e}));return m==null?b("Promise").resolve():d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE})(function(b){var k=d("MAWMediaUtils").genHMACPlaintextHash(a);return d("MAWDbMediaTxns").maybeGetMediaFromHash(b,k).then(function(a){if(a){var k=babelHelpers["extends"]({},a,{mediaEntries:a.mediaEntries.set(e,m),msgIds:d("WASortedLists").addToSet(a.msgIds,e)});i!=null&&(k=babelHelpers["extends"]({},k,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(i)}));return b.media.update(a.mediaId,k).then(function(c){return i!=null?d("MAWMediaBackupTxns").linkMediaBackup(b,a.mediaId,e,d("WAMediaUtils").stringToDeliveryObjectId(i)):d("MAWDexieTable").dexieResolve()}).then(function(){if(d("MAWGating").isAttachmentBackupEnabled()){var a=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(j);i!=null&&a!=null?d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(i,a,g,d("MAWGlobals").getConfig().productTypeForEBAttachments,d("MAWJidUtils").threadIdForChatJid(f))}):d("WALogger").WARN(h())}})}else throw c("err")("media should already exist upon this point")})})()}g.writeToDb=m;g.saveAndPassOff=n;g.sendMediaMsg=a;g.maybePersistMediaEntry=q}),98);
__d("MAWSendMsg",["MAWGlobals","MAWJobDefinitions","MAWWriteOutgoingMsgApi","WAJobOrchestratorTypes","WALogger","WAMsgType","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg: ",""]);j=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("writeToDb",function(a,c,e){var f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=a.args,f=a.chatJid,g=a.externalId;l.next=3;return b("regeneratorRuntime").awrap(d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(g,f,e.jobStartTime,c,d("WAMsgType").MSG_TYPE.TEXT));case 3:k=l.sent;d("WALogger").DEV(j(),f);if(!(k.type==="already_sent")){l.next=9;break}d("WALogger").LOG(i());l.next=15;break;case 9:if(!(k.type==="missing_thread")){l.next=13;break}d("WALogger").LOG(h());l.next=15;break;case 13:l.next=15;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(k.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 15:case"end":return l.stop()}},null,this)}).end();g.sendMsg=a}),98);
__d("MAWWriteReactionMsgApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWMsgReceiptPreparationTxns","MAWTransactionMode","MAWWriteReactionTxns","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("writeReactionMsg",!1)))(function(a,b,c,e,f,g){g===void 0&&(g=d("WAJids").AUTHOR_ME);var h=e.groupingKey,i=e.reaction,j=e.reactToAuthor;e=e.reactToExternalId;var k={author:g,externalId:b,groupingKey:h,reaction:i,reactToAuthor:j,reactToExternalId:e,ts:f};return a.threads.get({jid:c}).then(function(b){return b==null?"missing_thread":d("MAWWriteReactionTxns").writeReaction(a,k,b.jid)}).then(function(b){return b==="missing_thread"?{type:"missing_thread"}:d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,b.reactionId,c).then(function(){return{protocolMsgId:{author:g,chat:c,externalId:b.externalId},type:"not_sent"}})})});g.writeReactionMsg=a}),98);
__d("MAWSendReactionMsg",["MAWGlobals","MAWJobDefinitions","MAWWriteReactionMsgApi","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot react to a non-existent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot send to a non-existent thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg already sent message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg: ",""]);k=function(){return a};return a}function l(a){return a==="\u2764\ufe0f"?"\u2764":a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a,c,e){var f,g,m,n,o,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:c=a.args,f=a.chatJid,g=a.externalId;d("WALogger").DEV(k(),f);m=c.reaction,n=c.reactToProtocolMsgId;o=l(m);p=d("MAWGlobals").getJidUtilsApi(),q=p.toUserJid;r=q(c.reactToAuthor);t.next=8;return b("regeneratorRuntime").awrap(d("MAWWriteReactionMsgApi").writeReactionMsg(g,f,{groupingKey:o,reaction:o,reactToAuthor:r,reactToExternalId:n.externalId},e.jobStartTime));case 8:s=t.sent;if(!(s.type==="already_sent")){t.next=14;break}d("WALogger").LOG(j());return t.abrupt("return");case 14:if(!(s.type==="missing_thread")){t.next=19;break}d("WALogger").LOG(i());return t.abrupt("return");case 19:if(!(s.type==="missing_msg")){t.next=22;break}d("WALogger").LOG(h());return t.abrupt("return");case 22:t.next=24;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(s.protocolMsgId,"reaction")));case 24:case"end":return t.stop()}},null,this)}).end();g.sendReactionMsg=a}),98);
__d("MAWSendWrittenAppData",["MAWGlobals","MAWSendAppDataUtils","WALogger","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.appDataExternalId;g.next=3;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getAppData(c));case 3:e=g.sent;if(!(e.type!=="not_sent")){g.next=7;break}d("WALogger").LOG(i(),e.type);return g.abrupt("return");case 7:g.next=9;return b("regeneratorRuntime").awrap(d("MAWSendAppDataUtils").sendAppData(e.appData,c,e.permittedIdentitiesPerDevice,null,e.sendPartial));case 9:f=g.sent;if(!(f.type==="success")){g.next=15;break}g.next=13;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markAppDataSent(c));case 13:g.next=18;break;case 15:f.type;g.next=18;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markAppDataSendFailed(c));case 18:case"end":return g.stop()}},null,this)},stopRetryIf:{onStopRetry:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.appDataExternalId;d("WALogger").LOG(h(),c);e.next=4;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().markAppDataDropped(c));case 4:case"end":return e.stop()}},null,this)},timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.sendWrittenAppData=a}),98);
__d("MAWMsgUtil",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c).then(function(){})});g.updateSystemAckWithTxn=a}),98);
__d("MAWThreadUtil",["MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{userJid:b})});g.getOrSetupOneToOneThreadInTxns=a}),98);
__d("MAWSendXMAShareMsg",["MAWAckLevel","MAWBridge","MAWBridgeMsg","MAWBridgeXMA","MAWDbMsgTxns","MAWDexieTable","MAWExpiredXMACleaner","MAWFrontendMediaUtils","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWLLAMigrationUtils","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgUtil","MAWOptimisticUploadManager","MAWSendMediaMsg","MAWThreadUtil","MAWTransactionMode","MAWVault","MAWXMAManagementTxns","MAWXMAUtils","Promise","WAArmadilloXMA.pb","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAMsgType","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Missing thread with jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Associated Message missing in db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma associated msg - missing thread"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - wrong userJid when story reply"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - XMAMessageType is null"]);o=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("sendXMAShareMsg",function(a,c,e){var f,g,p,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;return b("regeneratorRuntime").async(function(J){while(1)switch(J.prev=J.next){case 0:g=Boolean(a.associatedMsgContent)&&a.associatedMsgContent!=null?d("MAWVault").vault(a.associatedMsgContent):void 0;p=void 0;s=a.args.xmaMessageType;if(!(s==null)){J.next=6;break}d("WALogger").ERROR(o());return J.abrupt("return");case 6:t=d("WAJids").interpretAsUserJid(a.chatJid);if(!d("MAWXMAUtils").isXMAStoryReply(s)){J.next=13;break}if(!(t==null)){J.next=11;break}d("WALogger").ERROR(n());return J.abrupt("return");case 11:J.next=13;return b("regeneratorRuntime").awrap(d("MAWThreadUtil").getOrSetupOneToOneThreadInTxns(t));case 13:if(!(d("MAWXMAUtils").isXMAGamingCustomUpdate(s)&&t!=null)){J.next=16;break}J.next=16;return b("regeneratorRuntime").awrap(d("MAWThreadUtil").getOrSetupOneToOneThreadInTxns(t));case 16:J.next=18;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeOutgoingMsg(a.xmaMsgExternalId,a.chatJid,e.jobStartTime,a.args,d("WAMsgType").MSG_TYPE.XMA));case 18:u=J.sent;if(!(g!=null)){J.next=33;break}c=babelHelpers["extends"]({},a.args,{content:g});J.next=23;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().writeOutgoingMsg(a.associatedMsgContentExternalId,a.chatJid,e.jobStartTime,c,d("WAMsgType").MSG_TYPE.TEXT));case 23:v=J.sent;if(!(v.type==="missing_thread")){J.next=27;break}d("WALogger").ERROR(m());return J.abrupt("return");case 27:J.next=29;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(v.protocolMsgId));case 29:p=J.sent;if(!(p==null)){J.next=33;break}d("WALogger").ERROR(l());return J.abrupt("return");case 33:if(!(u.type==="missing_thread")){J.next=36;break}d("WALogger").ERROR(k());return J.abrupt("return");case 36:J.next=38;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(u.protocolMsgId));case 38:w=J.sent;if(!(w==null)){J.next=42;break}d("WALogger").ERROR(j());return J.abrupt("return");case 42:J.next=44;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getThreadIdByJid(a.chatJid));case 44:x=J.sent;if(!(x==null)){J.next=48;break}d("WALogger").ERROR(i(),a.chatJid);return J.abrupt("return");case 48:y=a.previewFile;z=a.headerFile;A=a.faviconFile;B=babelHelpers["extends"]({},a.xmaArgs,{overlayIconGlyph:(f=a.xmaArgs.overlayIconGlyph)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE});J.next=54;return b("regeneratorRuntime").awrap(r(y,z,A,w,s,p,x,u.protocolMsgId,B,a.chatJid));case 54:C=J.sent;D=B.targetExpiringAtSec;E=d("MAWXMAUtils").isXMAExpired(!1,D);if(!(!E&&D!=null)){J.next=61;break}d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(D);J.next=63;break;case 61:if(!E){J.next=63;break}return J.abrupt("return",d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(u.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 63:F=d("MAWOptimisticUploadManager").getOptimisticUploadManager();J.next=66;return b("regeneratorRuntime").awrap(q(C,a.chatJid,u.protocolMsgId,F));case 66:G=J.sent;H=G.filter(function(a){return!a.uploadResult.success}).length;if(!(H>0)){J.next=71;break}d("WALogger").ERROR(h());return J.abrupt("return",d("MAWMsgUtil").updateSystemAckWithTxn(w,d("MAWAckLevel").ACK.failed));case 71:I=G.map(function(b){var c=b.uploadResult;b=b.media;return d("MAWSendMediaMsg").maybePersistMediaEntry(b.plaintextHash,w,a.chatJid,u.protocolMsgId.externalId,c==null?void 0:(c=c.value)==null?void 0:c.objectId,d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType,"xma-media"))});J.next=74;return b("regeneratorRuntime").awrap(b("Promise").all(I));case 74:J.next=76;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(u.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 76:G.forEach(function(a){F["delete"](a.media.plaintextHash)});case 77:case"end":return J.stop()}},null,this)}).end();function p(a,c,e,f,g,h){var i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:i=h.get(a);j=i==null?void 0:i.optimisticUploadPromise;if(!(j!=null)){k.next=8;break}k.next=5;return b("regeneratorRuntime").awrap(j);case 5:k.t0=k.sent;k.next=11;break;case 8:k.next=10;return b("regeneratorRuntime").awrap(d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",{chatJid:c,hash:a,mediaTypeDetails:{serverMediaType:f},protocolMsgId:e,size:g,uploadMediaFlow:void 0}));case 10:k.t0=k.sent;case 11:return k.abrupt("return",k.t0);case 12:case"end":return k.stop()}},null,this)}function q(a,c,e,f){a=[a.previewDbMedia,a.faviconDbMedia,a.headerDbMedia].filter(Boolean);a=a.reduce(function(a,b){a.includes(b.plaintextHash)||a.push(b);return a},[]);a=a.map(function(a){var b=d("MAWMediaUtils").getServerMediaTypeFromMediaType(a.mediaType,"xma-media");return p(a.plaintextHash,c,e,b,a.size,f).then(function(b){return{media:a,uploadResult:b}})});return b("Promise").all(a)}function r(a,c,d,e,f,g,h,i,j,k){var l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:p.next=2;return b("regeneratorRuntime").awrap(b("Promise").all([s(a),s(c),s(d)]));case 2:l=p.sent;m=l[0];n=l[1];o=l[2];p.next=8;return b("regeneratorRuntime").awrap(t(e,m,n,o,f,g,h,i,j,k));case 8:return p.abrupt("return",p.sent);case 9:case"end":return p.stop()}},null,this)}function s(a){var e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:if(!(a==null)){m.next=2;break}return m.abrupt("return",a);case 2:e=a.file;f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type),g=f.mediaType,h=f.serverMediaType;m.next=6;return b("regeneratorRuntime").awrap(d("MAWMediaUtils").genBlobHashes(e));case 6:i=m.sent;j=i[0];k=i[1];if(!(g!=="Image")){m.next=11;break}throw c("err")("Expected Image when sending XMA share");case 11:m.next=13;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(e));case 13:l=m.sent;return m.abrupt("return",{blobArrayBuffer:l,file:e,hashedPlaintextHash:k,mediaInfo:{validatedAudioInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:g,plaintextHash:j,serverMediaType:h});case 15:case"end":return m.stop()}},null,this)}function t(a,b,c,e,f,g,h,i,j,k){return d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveXMAMediaAndMetadata",!1,{},!0)))(function(l){var m=new Map();b!=null&&m.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,a,b.blobArrayBuffer,b.plaintextHash,b.hashedPlaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!0));if(c!=null){var n=m.get(c.plaintextHash);n==null&&m.set(c.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,a,c.blobArrayBuffer,c.plaintextHash,c.hashedPlaintextHash,void 0,void 0,c.mediaType,c.mediaInfo,c.file,!0))}if(e!=null){n=m.get(e.plaintextHash);n==null&&m.set(e.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,a,e.blobArrayBuffer,e.plaintextHash,e.hashedPlaintextHash,void 0,void 0,e.mediaType,e.mediaInfo,e.file,!0))}n=Array.from(m.values());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(l,g),d("MAWDexieTable").dexieAll(n)]).then(function(m){var n=m[0];m=m[1];m=m.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var o=b!=null?m.get(b.plaintextHash):void 0,p=c!=null?m.get(c.plaintextHash):void 0,q=e!=null?m.get(e.plaintextHash):void 0,r=d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(l,o==null?void 0:o.mediaId,p==null?void 0:p.mediaId,q==null?void 0:q.mediaId,f,a,g,i,j).then(function(a){d("MAWXMAUtils").isXMAStoryReply(f)&&n!=null?r=u(l,k,a,o,n):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(h,o,a)});return r.then(function(){return{faviconDbMedia:q,headerDbMedia:p,previewDbMedia:o}})})})})()}function u(a,b,e,f,g){var h=d("WAJids").interpretAsUserJid(b);if(h==null)throw c("err")("this is a flow check, participant jid can not be null");var i=e.defaultCTA;i=i==null?void 0:i.nativeUrl;h={author:h,externalId:e.externalId,mediaId:f==null?void 0:f.mediaId,sourceId:i,ts:void 0,type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};f={content:h,remoteJid:b};if(g.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("err")("flow check, this message type is only in text type");var j=babelHelpers["extends"]({},g,{quote:f});return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)})})}g.sendXMAShareMsg=a}),98);
__d("MAWUpdateBackupEntFbidForMedia",["LSDataTraceCheckPoint.re","MAWDbMediaTxns","MAWGating","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWLLAMigrationUtils","MAWMediaBackupTxns","MAWMediaManagementTxns","MAWTraceUtils","MAWTransactionMode","Promise","WAJobOrchestratorTypes","WALogger","WAMediaUtils","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in updateBackupEntForFbid job for objectId ",": ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media is null for deliveryObjectId provided"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in makeMsgrTransactor while updating the media object with fbid ",": ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupEntFbid is empty"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] deliveryObjectId is empty"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in updateBackupEntForFbid job for objectId ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaBackup is null for deliveryObjectId provided"]);n=function(){return a};return a}var o=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE})(function(a,b,c,d){return p(a,b,c,d)});function p(a,b,e,f){return d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,b).then(function(g){if(g==null){d("WALogger").ERROR(n());throw c("err")("mediaBackup is null for deliveryObjectId provided")}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,g.mediaId).then(function(c){if(c!=null){var f=d("MAWMediaManagementTxns").updateBackupFbidInMediaEntries(c,b,e);f=babelHelpers["extends"]({},c,{fbid:e,mediaEntries:f});return a.media.update(f.mediaId,f).then(function(){if(c.msgIds.length>0)return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,g.msgId,b,e)})}})["catch"](function(a){d("WALogger").ERROR(m(),a),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"Caught Error in updateBackupEntForFbid job")}).then(function(){})})}function q(a,e,f){if(a==null||a.length===0){d("WALogger").ERROR(l());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"deliveryObjectId is empty");return b("Promise").reject(c("err")("deliveryObjectId is empty"))}if(e==null||e.length===0){d("WALogger").ERROR(k());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"backupEntFbid is empty");return b("Promise").reject(c("err")("backupEntFbid is empty"))}if(d("MAWGating").isMediaBackupTableEnabled())if(a!=null&&e!=null)return o(a,e,f);else return b("Promise").resolve();else return d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{media:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateBackupEntFbid",!1,{},!0)))(function(b){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(b,a).then(function(g){if(g!=null){var h=d("MAWMediaManagementTxns").updateBackupFbidInMediaEntries(g,a,e);g=babelHelpers["extends"]({},g,{fbid:e,mediaEntries:h});return b.media.update(g.mediaId,g)["catch"](function(a){d("WALogger").ERROR(j(),e,a),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"Caught Error in makeMsgrTransactor while updating the media object with fbid")}).then(function(){})}else{d("WALogger").ERROR(i());throw c("err")("media is null for deliveryObjectId provided")}})["catch"](function(b){d("WALogger").ERROR(h(),a,b),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,c("LSDataTraceCheckPoint.re").labyrinthMediaBackupFailure,[],"Caught Error in updateBackupEntForFbid job")})})()}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("writeToDb",function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.backupEntFbid,e=a.deliveryObjectId,f=a.traceId;g.next=3;return b("regeneratorRuntime").awrap(q(d("WAMediaUtils").stringToDeliveryObjectId(e),d("WAMediaUtils").stringToBackupEntFbid(c)));case 3:g.next=5;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.backupMessageWithMedia(e,c,f,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 5:case"end":return g.stop()}},null,this)}).end();g.updateBackupEntFbidInMediaBackupTxn=p;g.updateBackupEntFbid=q;g.updateBackupEntFbidForMedia=a}),98);
__d("MAWUploadRetroactiveMessageBatchApi",["$InternalEnum","LSDataTraceCheckPoint.re","LSDataTraceType.re","MAWBridge","MAWBridgeUpload","MAWDbMediaTxns","MAWDbMsg","MAWDbThread","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWJidUtils","MAWQplProxy","MAWTraceUtils","MAWTransactionMode","MAWUploadMessagesBackup","Promise","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] retroactive backups not enabled, can't upload message batch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] error uploading retroactive message batch: ",";"]);i=function(){return a};return a}var j=b("$InternalEnum")({ATTACHMENT:"attachment",MSG_METADATA:"msg_metadata"}),k=d("MAWIndexedDb").makeMsgrTransactor({retroactiveBackupsState:d("MAWTransactionMode").READWRITE})(a);function a(a,b,c,e){if(d("MAWGating").isRetroactiveBackupsRetriesEnabled())if(c==="delete")return a.retroactiveBackupsState["delete"](b);else return a.retroactiveBackupsState.update(b,{msgId:e,threadId:b});else return d("MAWDexieTable").dexieResolve()}var l=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias);function m(a,e){var f=[],g=[],h=[],m=[],n=e.map(function(b){var e=b.msgId,i=d("MAWDbMsg").isMediaMsg(b)?j.ATTACHMENT:j.MSG_METADATA;e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521480458,"1218"),{"int":{threadId:a},string:{msgId:e,uploadType:i}});e.addPoint("retroactive_message_upload_start");d("MAWGating").isRetroactiveBackupsAttachmentsEnabled()&&d("MAWDbMsg").isMediaMsg(b)&&b.mediaId!=null&&(f.push(b.mediaId),g.push(b.threadJid),h.push(b.externalId),m.push(b.msgId));return e});n.forEach(function(a){return a.addPoint("retroactive_message_upload_calling_upload_unique_message")});if(e.length===1)k(d("MAWDbThread").unsafeCoerceToChatId(a),"delete");else{var o=e[e.length-1].msgId;k(d("MAWDbThread").unsafeCoerceToChatId(a),"update",o)}o=d("MAWUploadMessagesBackup").uploadUniqueMessage(e,void 0,!0).then(function(){n.forEach(function(a){a.endSuccess()})});e=l(f).then(function(b){return b.forEach(function(b,e){var f=d("MAWTraceUtils").startNewTrace(c("LSDataTraceType.re").encryptedBackupsMediaBackup,d("MAWTraceUtils").CONTEXT_MEDIA_BACKUP);d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").labyrinthWebRetroactiveBackupsStartUploadMedia,[],!1);var i=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521480458,"1218"),{"int":{threadId:a},string:{msgId:m[e],uploadType:j.ATTACHMENT}});i.addPoint("retroactive_attachment_upload_start");var k=g[e];if((b==null?void 0:b.objectId)!=null&&k!=null){b=[{tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(b.objectId,b.mediaType,h[e],d("MAWGlobals").getConfig().productTypeForEBAttachments,d("MAWJidUtils").threadIdForChatJid(k),f)}];d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:b});i.endSuccess()}else k==null?(d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").labyrinthWebRetroactiveBackupsUploadMediaError,[],!1),i.endFail("retroactive_attachments_upload_error_null_chatjid")):(d("MAWTraceUtils").recordCheckpointForTrace(f,c("LSDataTraceCheckPoint.re").labyrinthWebRetroactiveBackupsUploadMediaError,[],!1),i.endFail("retroactive_attachments_upload_error_null_media"))})});return b("Promise").all([e,o]).then(function(){})["catch"](function(a){d("WALogger").ERROR(i(),a)})}e=function(a,c){if(d("MAWGating").isRetroactiveBackupsEnabled())return m(a,c);d("WALogger").WARN(h());return b("Promise").resolve()};g.getMessagesAndUploadBatchSeparateTx=m;g.uploadRetroactiveMessageBatch=e}),98);
__d("MAWUploadRetroactiveMessageBatch",["MAWGlobals","MAWUploadRetroactiveMessageBatchApi","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot upload retroactive message batch - null dbMsgArray"]);h=function(){return a};return a}a=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("uploadRetroactiveMessageBatch",function(a){var b=a.dbMsgArray;a=a.threadId;b!=null?d("MAWUploadRetroactiveMessageBatchApi").uploadRetroactiveMessageBatch(a,b):d("WALogger").ERROR(h())}).end();g.uploadRetroactiveMessageBatch=a}),98);
__d("MAWUploadRetroactiveThreadsAndMessages",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","Promise","WALogger","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] consider enabling enable_encrypted_backups_retroactive_backups"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Retroactive backups failed - no threads containing messages to upload"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Initiating job: upload retroactive backups"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread.newestMsg is null - retroactive message uploads for thread "," cannot proceed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unknown error with retroactive uploads}"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error with retroactive uploads, err: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] thread.newestMsg is null - retroactive message uploads for thread "," cannot proceed"]);n=function(){return a};return a}var o=50,p=200,q=new Map(),r=new Map(),s=new Map();function t(a){return a}function u(a,b,c,e){return d("MAWDbMsgTxns").getMsgsFromOffset(a,b.chatId,e,o,c,!1).then(function(c){var d;c=c.msgs;(d=q.get(b.chatId))==null?void 0:d.push(c);if(c.length===o)return u(a,b,!1,c[c.length-1].msgId)})}function v(a,b){var e=q.get(b);if(e!=null){var f=e[a];d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveMessageBatch(f,void 0,void 0,t(b)));a<e.length-1&&c("setTimeout")(function(){return v(a+1,b)},p)}}function a(a,b,e){if(e!=null)return u(a,b,!0,e).then(function(){c("setTimeout")(function(){return v(0,b.chatId)},p)});else{d("WALogger").ERROR(n(),b.chatId);return d("MAWDexieTable").dexieResolve()}}function e(a){return d("MAWDbThreadTxns").getAllThreadsForUser(a,d("MAWGlobals").getMyUserJid()).then(function(a){a.forEach(function(a){q.set(a.chatId,[]),r.set(a.chatId,a),s.set(a.chatId,a.newestMsg)});return a})["catch"](function(a){a instanceof Error?d("WALogger").ERROR(m(),a):d("WALogger").ERROR(l())})}var w=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY})(e);function f(a,b){return a.retroactiveBackupsState.count().then(function(c){if(c===0){var e=[];b.forEach(function(a){a.newestMsg!=null?e.push({msgId:a.newestMsg,threadId:a.chatId}):d("WALogger").ERROR(k(),a.chatId)});return a.retroactiveBackupsState.bulkAdd(e).then(function(){})}else{var f=[];return a.retroactiveBackupsState.each(function(a){f.push(a.threadId),s.set(a.threadId,a.msgId)}).then(function(){var a=[];q.forEach(function(b,c){f.includes(c)||a.push(c)});a.forEach(function(a){q["delete"](a),r["delete"](a),s["delete"](a)})})}})}var x=d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(a),y=d("MAWIndexedDb").makeMsgrTransactor({retroactiveBackupsState:d("MAWTransactionMode").READWRITE})(f);e=d("MAWGlobals").getPersistedJobsApi().definePersistedJob().finalStep("uploadAllThreadsAndMessages",function(){d("WALogger").LOG(j());if(d("MAWGating").isRetroactiveBackupsEnabled())return w().then(function(a){if(a!=null)if(d("MAWGating").isRetroactiveBackupsRetriesEnabled())return y(a).then(function(){r.forEach(function(a,b){a=r.get(b);a!=null&&x(a,s.get(b))})});else{r.forEach(function(a,b){a=r.get(b);a!=null&&x(a,s.get(b))});return b("Promise").resolve()}else{d("WALogger").ERROR(i());return b("Promise").resolve()}});else{d("WALogger").WARN(h());return b("Promise").resolve()}}).end();g.uploadRetroactiveThreadsAndMessages=e}),98);
__d("WACreateGroupInvitesStep",["WAAddGroupParticipantsApi","WAGetDevices","WAJids","WAJobDefinitions","WAJobs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f){var g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:f===void 0&&(f=!0);if(!(e.length===0)){i.next=3;break}return i.abrupt("return",[]);case 3:g=e.map(function(a){return a.user});h=e.map(function(a){return{user:a.user,type:"invitedParticipant",addressable:!0}});i.next=7;return b("regeneratorRuntime").awrap(d("WAGetDevices").fetchAndSaveDevices(new Set(g),"create-group-invite"));case 7:if(f){i.next=10;break}i.next=10;return b("regeneratorRuntime").awrap(d("WAAddGroupParticipantsApi").addGroupParticipants(null,a,d("WAJids").AUTHOR_ME,h,!0));case 10:e.forEach(function(b){var e=b.user,f=b.inviteCode;b=b.expiration;d("WAJobs").getJobManager().fireAndForget(d("WAJobDefinitions").jobSerializers.sendGroupInviteMsg({groupJid:a,inviterUserJid:c,invitedParticipantUserJid:e,inviteCode:f,expiration:b}))});return i.abrupt("return",h);case 12:case"end":return i.stop()}},null,this)}g.createGroupInvitesStep=a}),98);
__d("WASmaxInGroupsIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","405");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInGroupsGroupOperationNotAllowedMixin",["WASmaxInGroupsIQErrorNotAllowedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(b.value);return!a.success?a:a}g.parseGroupOperationNotAllowedMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsFallbackClientMixin","WASmaxInGroupsGroupDoesNotExistMixin","WASmaxInGroupsGroupIsSuspendedMixin","WASmaxInGroupsGroupOperationNotAllowedMixin","WASmaxInGroupsInvalidParticipantJIDMixin","WASmaxInGroupsMalformedStanzaMixin","WASmaxInGroupsRateLimitedMixin","WASmaxInGroupsUnsupportedOperationMixin","WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin","WASmaxInGroupsUserIsNotAParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsUnsupportedOperationMixin").parseUnsupportedOperationMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"UnsupportedOperation",value:b.value});var c=d("WASmaxInGroupsMalformedStanzaMixin").parseMalformedStanzaMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"MalformedStanza",value:c.value});var e=d("WASmaxInGroupsGroupDoesNotExistMixin").parseGroupDoesNotExistMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"GroupDoesNotExist",value:e.value});var f=d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin").parseUserDoesNotHaveAdminPermissionMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"UserDoesNotHaveAdminPermission",value:f.value});var g=d("WASmaxInGroupsUserIsNotAParticipantMixin").parseUserIsNotAParticipantMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"UserIsNotAParticipant",value:g.value});var h=d("WASmaxInGroupsInvalidParticipantJIDMixin").parseInvalidParticipantJIDMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"InvalidParticipantJID",value:h.value});var i=d("WASmaxInGroupsRateLimitedMixin").parseRateLimitedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"RateLimited",value:i.value});var j=d("WASmaxInGroupsGroupOperationNotAllowedMixin").parseGroupOperationNotAllowedMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"GroupOperationNotAllowed",value:j.value});var k=d("WASmaxInGroupsGroupIsSuspendedMixin").parseGroupIsSuspendedMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"GroupIsSuspended",value:k.value});var l=d("WASmaxInGroupsFallbackClientMixin").parseFallbackClientMixin(a);return l.success?d("WAResultOrError").makeResult({name:"FallbackClient",value:l.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UnsupportedOperation","MalformedStanza","GroupDoesNotExist","UserDoesNotHaveAdminPermission","UserIsNotAParticipant","InvalidParticipantJID","RateLimited","GroupOperationNotAllowed","GroupIsSuspended","FallbackClient"],[b,c,e,f,g,h,i,j,k,l])}g.parseAddParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsAddParticipantsClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!c.success)return c;b=d("WASmaxInGroupsAddParticipantsClientErrors").parseAddParticipantsClientErrors(a);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{addParticipantsClientErrors:b.value}))}g.parseAddParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseAddParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantTemporarilyBlockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","408");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseAddParticipantsParticipantTemporarilyBlockedMixin=a}),98);
__d("WASmaxInGroupsParticipantConflictMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","409");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantConflictMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","406");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","401");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"add_request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","403");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"code");if(!c.success)return c;b=d("WASmaxParseUtils").attrIntRange(b.value,"expiration",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({error:a.value,addRequestCode:c.value,addRequestExpiration:b.value})}g.parseParticipantRequestCodeCanBeSentMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceConstraintMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceConstraintMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","419");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceLimitMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantMixins",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantTemporarilyBlockedMixin","WASmaxInGroupsParticipantConflictMixin","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxInGroupsParticipantNotAuthorizedMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantResourceConstraintMixin","WASmaxInGroupsParticipantResourceLimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantNotAuthorizedMixin").parseParticipantNotAuthorizedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAuthorized",value:b.value});var c=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:c.value});var e=d("WASmaxInGroupsAddParticipantsParticipantTemporarilyBlockedMixin").parseAddParticipantsParticipantTemporarilyBlockedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"AddParticipantsParticipantTemporarilyBlocked",value:e.value});var f=d("WASmaxInGroupsParticipantConflictMixin").parseParticipantConflictMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"ParticipantConflict",value:f.value});var g=d("WASmaxInGroupsParticipantResourceLimitMixin").parseParticipantResourceLimitMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceLimit",value:g.value});var h=d("WASmaxInGroupsParticipantResourceConstraintMixin").parseParticipantResourceConstraintMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceConstraint",value:h.value});var i=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:i.value});var j=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return j.success?d("WAResultOrError").makeResult({name:"ParticipantNotAddressable",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantNotAuthorized","ParticipantRequestCodeCanBeSent","ParticipantTemporarilyBlocked","ParticipantConflict","ParticipantResourceLimit","ParticipantResourceConstraint","ParticipantNotAcceptable","ParticipantNotAddressable"],[b,c,e,f,g,h,i,j])}g.parseAddParticipantsParticipantMixins=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxInGroupsAddParticipantsParticipantMixins").parseAddParticipantsParticipantMixins(a);return d("WAResultOrError").makeResult({jid:b.value,addParticipantsParticipantMixins:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"add");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,19999,h);return!b.success?b:d("WAResultOrError").makeResult({type:e.value,addParticipant:b.value})}g.parseAddParticipantsResponseSuccessAddParticipant=h;g.parseAddParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseSetGroupMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqTo;a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").GROUP_JID(a),xmlns:"w:g2"}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetGroupMixin=a}),98);
__d("WASmaxOutGroupsAddParticipantsRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function a(a){var b=a.participantArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("add",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return b}g.makeAddParticipantsRequestAddParticipant=h;g.makeAddParticipantsRequest=a}),98);
__d("WASmaxGroupsAddParticipantsRPC",["WAComms","WASmaxInGroupsAddParticipantsResponseClientError","WASmaxInGroupsAddParticipantsResponseServerError","WASmaxInGroupsAddParticipantsResponseSuccess","WASmaxOutGroupsAddParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsAddParticipantsRequest").makeAddParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsAddParticipantsResponseSuccess").parseAddParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"AddParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsAddParticipantsResponseClientError").parseAddParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"AddParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsAddParticipantsResponseServerError").parseAddParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"AddParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AddParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendAddParticipantsRPC=a}),98);
__d("WAAddGroupParticipants",["WAAddGroupParticipantsApi","WABridge","WACreateGroupInvitesStep","WADualSendMsgUtils","WAGlobals","WAGroupInviteUtils","WAJids","WAJobs","WALogger","WAOdsEnums","WAResultOrError","WASmaxGroupsAddParticipantsRPC","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("addGroupParticipants",function(a){var c,e,f,g,j,k,l,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:c=a.group,e=a.users;f=d("WAGlobals").getJidUtilsApi(),g=f.toUserJid;j=e.map(function(a){return g(a)});if(!(j.length===0)){s.next=5;break}return s.abrupt("return",d("WAResultOrError").makeResult({groupJid:c,participants:[]}));case 5:k=c;c.startsWith("shadow_")&&(k=d("WADualSendMsgUtils").removeDualSendPrefixForGroup(c));s.next=9;return b("regeneratorRuntime").awrap(d("WASmaxGroupsAddParticipantsRPC").sendAddParticipantsRPC({participantArgs:j.map(function(a){return{participantJid:a}}),iqTo:k}));case 9:l=s.sent;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_ADD_PARTICIPANT,key:l.name==="AddParticipantsResponseSuccess"?"success":"fail"});if(!(l.name==="AddParticipantsResponseClientError")){s.next=15;break}m=l.value.addParticipantsClientErrors.name;d("WALogger").ERROR(i(),m);return s.abrupt("return",d("WAResultOrError").makeError(m));case 15:if(!(l.name==="AddParticipantsResponseServerError")){s.next=19;break}n=l.value.errorServerErrors.name;d("WALogger").ERROR(h(),n);return s.abrupt("return",d("WAResultOrError").makeError(n));case 19:l.name;o=l.value.addParticipant.filter(function(a){a=a.addParticipantsParticipantMixins;return(a==null?void 0:a.value.error)==null}).map(function(a){var b=a.jid;a=a.addParticipantsParticipantMixins;return{user:b,type:"participant",addressable:(a==null?void 0:a.name)!=="ParticipantNotAddressable"}});s.next=23;return b("regeneratorRuntime").awrap(d("WAAddGroupParticipantsApi").addGroupParticipants(null,c,d("WAJids").AUTHOR_ME,o,!0));case 23:s.next=25;return b("regeneratorRuntime").awrap(d("WACreateGroupInvitesStep").createGroupInvitesStep(c,d("WAGlobals").getMyUserJid(),l.value.addParticipant.map(function(a){var b=a.jid;a=a.addParticipantsParticipantMixins;return(a==null?void 0:a.name)==="ParticipantRequestCodeCanBeSent"?{user:b,inviteCode:d("WAGroupInviteUtils").toInviteCode(a.value.addRequestCode),expiration:d("WATimeUtils").castToUnixTime(a.value.addRequestExpiration)}:void 0}).filter(Boolean),!1));case 25:p=s.sent;q=[].concat(o,p);s.next=29;return b("regeneratorRuntime").awrap(d("WAJobs").getJobResultConvertersImpls().convertAddGroupParticipantsResult==null?void 0:d("WAJobs").getJobResultConvertersImpls().convertAddGroupParticipantsResult(c,q));case 29:r=s.sent;if(!r){s.next=32;break}return s.abrupt("return",d("WAResultOrError").makeResult(r));case 32:return s.abrupt("return",d("WAResultOrError").makeResult({groupJid:c,participants:q}));case 33:case"end":return s.stop()}},null,this)}).end();g.addGroupParticipants=a}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WAComms","WAGetContactsApi","WAGlobals","WAICDCUtils","WAIdentityUtils","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAResultOrErrorUtils","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo failed because the user current user has no stored contact information"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""]);j=function(){return a};return a}var k=new(d("WAWapParser").WapParser)("parseUploadICDCInfoResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")});a=function(a){var c,e,f,g,l,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:c=a.sequence;d("WALogger").LOG(j(),c);s.next=4;return b("regeneratorRuntime").awrap(d("WAGetContactsApi").getContacts([d("WAGlobals").getMyUserJid()]).then(d("WAResultOrErrorUtils").unpackValues));case 4:e=s.sent;if(e.length){s.next=8;break}d("WALogger").LOG(i());return s.abrupt("return");case 8:f=e[0];g=f.identities;l=d("WAGlobals").getCryptoManager().regInfo;m=d("WAICDCUtils").computeICDCInfoForUpload(l.staticKeyPair,c,g.map(function(a){a=a.identity;return a})),n=m.icdcInfo,o=m.encodedSignedICDC;s.next=14;return b("regeneratorRuntime").awrap(d("WAIdentityUtils").computeIdentitiesHash(g.map(function(a){a=a.identity;return a})));case 14:p=s.sent;q=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices",type:"set",id:d("WAWap").generateId()},d("WAWap").wap("icdc",{seq:d("WAWap").INT(n.seq),ts:d("WAWap").INT(n.timestamp),ihash:d("WAWap").CUSTOM_STRING(d("WABase64").encodeB64(p))},o));s.next=18;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(q,k));case 18:r=s.sent;if(!r.success){s.next=24;break}s.next=22;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().updateICDCForUser(d("WAGlobals").getMyUserJid(),{sequence:n.seq,timestamp:n.timestamp,devices:n.devices,signingDeviceIndex:n.signingDeviceIndex,dirty:!1}));case 22:s.next=30;break;case 24:if(!(r.errorCode===406||r.errorCode===500)){s.next=29;break}s.next=27;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(new Set().add(d("WAGlobals").getMyUserJid()),"compute-Upload-icdc",!1,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 27:s.next=30;break;case 29:d("WALogger").WARN(h(),r.errorCode);case 30:case"end":return s.stop()}},null,this)};c=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("computeAndUploadICDCInfo",a).end();g.computeAndUploadICDCInfo=c}),98);
__d("WACreateGroupStep",["WAComms","WACreateGroupInvitesStep","WAGlobals","WAGroupParserUtils","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAPREList","WAPREMetrics","WAResultOrError","WAScheduleAfterOfflineResume","WASendSenderKeyDistributionMsg","WATimeUtils","WAWap","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group: ",", isDST:",""]);h=function(){return a};return a}var i=new(d("WAWapParser").WapParser)("createGroupResponse",function(a){a.assertTag("iq");return d("WAGroupParserUtils").parseGroupNode(a.child("group"))});function a(a,c,e,f){var g,h,i,j,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.CREATE_GROUP,{"int":{users:e.length}});i=d("WAGlobals").getJidUtilsApi(),j=i.toUserJid;l=e.map(function(a){return j(a)});r.next=5;return b("regeneratorRuntime").awrap(k(a,c,l,f==null?void 0:f.isDualSend,h,f==null?void 0:f.deduplicationKey));case 5:m=r.sent;h.addPoint("finish_send_create_group_stanza");if(m.success){r.next=9;break}return r.abrupt("return",m);case 9:n=m.value.group;h.addPoint("start_create_group");r.next=13;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().createGroup(n,"added",d("WATimeUtils").unixTime(),null,a,f));case 13:h.addPoint("finish_create_group");d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:n.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(n.jid,n.participants.length)}});o=n.participants.map(function(a){return a.success?a.value.user:void 0}).filter(Boolean);r.next=18;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(new Set(o),"create-group",!1,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})));case 18:h.addPoint("persist_get_devices_create_group");r.next=21;return b("regeneratorRuntime").awrap(d("WACreateGroupInvitesStep").createGroupInvitesStep(n.jid,(g=n.creator)!=null?g:d("WAGlobals").getMyUserJid(),n.participants.map(function(a){return!a.success&&a.error.errorCode===403?{user:a.error.user,inviteCode:a.error.code,expiration:a.error.expiration}:void 0}).filter(Boolean)));case 21:h.addPoint("finish_create_group_invites_step");p=d("WAJobs").getJobResultConvertersImpls().convertCreateGroupResult;if(!p){r.next=29;break}r.next=26;return b("regeneratorRuntime").awrap(p(n));case 26:r.t0=r.sent;r.next=30;break;case 29:r.t0={type:"default",group:n};case 30:q=r.t0;h.endSuccess();return r.abrupt("return",d("WAResultOrError").makeResult(q));case 33:case"end":return r.stop()}},null,this)}function j(a){return a?d("WAWap").wap("shadow",null):null}function k(a,b,c,e,f,g){var k=j(!!e);c=c.map(function(a){return d("WAWap").wap("participant",{jid:d("WAWap").USER_JID(a)})});b=d("WAWap").wap("iq",{to:d("WAWap").G_US,type:"set",xmlns:"w:g2",id:d("WAWap").generateId()},d("WAWap").wap("create",{subject:b!=null?d("WAWap").CUSTOM_STRING(b):d("WAWap").DROP_ATTR,id:a!=null?d("WAWap").CUSTOM_STRING(a):d("WAWap").DROP_ATTR,key:g!=null?d("WAWap").CUSTOM_STRING(g):d("WAWap").DROP_ATTR},[].concat(c,[k])));return d("WAComms").deprecatedSendIq(b,i).then(function(a){if(!a.success){d("WALogger").ERROR(h(),a.errorCode,!!e);f.endFail("fail_send_create_group_stanza",{"int":{errorCode:a.errorCode},bool:{isDST:!!e}});return d("WAResultOrError").makeError(a.errorText)}return d("WAResultOrError").makeResult({type:"default",group:a.result})})}g.createGroupStep=a}),98);
__d("WACreateGroup",["WACreateGroupStep","WAJobs"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("createGroup",function(a){var b=a.key,c=a.subject,e=a.users;a=a.extras;return d("WACreateGroupStep").createGroupStep(b,c,e,a)}).end();g.createGroup=a}),98);
__d("WADeleteGroups",["WAGlobals","WAJids","WAJobs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("deleteGroups",function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=a.groups;e.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().deleteGroups(c.map(function(a){return{group:a,deleter:d("WAJids").AUTHOR_ME}})));case 3:case"end":return e.stop()}},null,this)}).end();g.deleteGroups=a}),98);
__d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","blocked-integrity-enforcement");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","486");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBlockedIntegrityEnforcementMixin=a}),98);
__d("WASmaxInGroupsBlockedIntegrityEnforcementMixin",["WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin").parseIQErrorBlockedIntegrityEnforcementMixin(b.value);return!a.success?a:a}g.parseBlockedIntegrityEnforcementMixin=a}),98);
__d("WASmaxInGroupsPromoteDemoteClientErrors",["WAResultOrError","WASmaxInGroupsBlockedIntegrityEnforcementMixin","WASmaxInGroupsFallbackClientMixin","WASmaxInGroupsGroupDoesNotExistMixin","WASmaxInGroupsGroupIsSuspendedMixin","WASmaxInGroupsInvalidParticipantJIDMixin","WASmaxInGroupsMalformedStanzaMixin","WASmaxInGroupsRateLimitedMixin","WASmaxInGroupsUnsupportedOperationMixin","WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin","WASmaxInGroupsUserIsNotAParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsRateLimitedMixin").parseRateLimitedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RateLimited",value:b.value});var c=d("WASmaxInGroupsBlockedIntegrityEnforcementMixin").parseBlockedIntegrityEnforcementMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"BlockedIntegrityEnforcement",value:c.value});var e=d("WASmaxInGroupsUnsupportedOperationMixin").parseUnsupportedOperationMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"UnsupportedOperation",value:e.value});var f=d("WASmaxInGroupsInvalidParticipantJIDMixin").parseInvalidParticipantJIDMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"InvalidParticipantJID",value:f.value});var g=d("WASmaxInGroupsMalformedStanzaMixin").parseMalformedStanzaMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"MalformedStanza",value:g.value});var h=d("WASmaxInGroupsGroupDoesNotExistMixin").parseGroupDoesNotExistMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"GroupDoesNotExist",value:h.value});var i=d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin").parseUserDoesNotHaveAdminPermissionMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"UserDoesNotHaveAdminPermission",value:i.value});var j=d("WASmaxInGroupsUserIsNotAParticipantMixin").parseUserIsNotAParticipantMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"UserIsNotAParticipant",value:j.value});var k=d("WASmaxInGroupsGroupIsSuspendedMixin").parseGroupIsSuspendedMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"GroupIsSuspended",value:k.value});var l=d("WASmaxInGroupsFallbackClientMixin").parseFallbackClientMixin(a);return l.success?d("WAResultOrError").makeResult({name:"FallbackClient",value:l.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RateLimited","BlockedIntegrityEnforcement","UnsupportedOperation","InvalidParticipantJID","MalformedStanza","GroupDoesNotExist","UserDoesNotHaveAdminPermission","UserIsNotAParticipant","GroupIsSuspended","FallbackClient"],[b,c,e,f,g,h,i,j,k,l])}g.parsePromoteDemoteClientErrors=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsPromoteDemoteClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!c.success)return c;b=d("WASmaxInGroupsPromoteDemoteClientErrors").parsePromoteDemoteClientErrors(a);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{promoteDemoteClientErrors:b.value}))}g.parsePromoteDemoteResponseClientError=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parsePromoteDemoteResponseServerError=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_406);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,error:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"demote");if(!c.success)return c;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{demoteParticipant:b.value}))}g.parsePromoteDemoteResponseSuccessDemoteDemoteParticipant=h;g.parsePromoteDemoteResponseSuccessDemote=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"type","admin");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_419);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,type:c.value,error:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"promote");if(!c.success)return c;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{promoteParticipant:b.value}))}g.parsePromoteDemoteResponseSuccessPromotePromoteParticipant=h;g.parsePromoteDemoteResponseSuccessPromote=a}),98);
__d("WASmaxOutGroupsPromoteDemoteRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function i(a){a=a.participantArgs;a=d("WASmaxJsx").smax("promote",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,1024));return a}function j(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function k(a){a=a.participantArgs;a=d("WASmaxJsx").smax("demote",null,d("WASmaxChildren").REPEATED_CHILD(j,a,0,1024));return a}function a(a){var b=a.promoteArgs,c=a.demoteArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxChildren").OPTIONAL_CHILD(i,b),d("WASmaxChildren").OPTIONAL_CHILD(k,c)),a);return b}g.makePromoteDemoteRequestPromoteParticipant=h;g.makePromoteDemoteRequestPromote=i;g.makePromoteDemoteRequestDemoteParticipant=j;g.makePromoteDemoteRequestDemote=k;g.makePromoteDemoteRequest=a}),98);
__d("WASmaxGroupsPromoteDemoteRPC",["WAComms","WASmaxInGroupsPromoteDemoteResponseClientError","WASmaxInGroupsPromoteDemoteResponseServerError","WASmaxInGroupsPromoteDemoteResponseSuccessDemote","WASmaxInGroupsPromoteDemoteResponseSuccessPromote","WASmaxOutGroupsPromoteDemoteRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutGroupsPromoteDemoteRequest").makePromoteDemoteRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote").parsePromoteDemoteResponseSuccessPromote(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessPromote",value:g.value});case 7:h=d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote").parsePromoteDemoteResponseSuccessDemote(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessDemote",value:h.value});case 10:i=d("WASmaxInGroupsPromoteDemoteResponseClientError").parsePromoteDemoteResponseClientError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"PromoteDemoteResponseClientError",value:i.value});case 13:j=d("WASmaxInGroupsPromoteDemoteResponseServerError").parsePromoteDemoteResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"PromoteDemoteResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PromoteDemote",{SuccessPromote:g,SuccessDemote:h,ClientError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendPromoteDemoteRPC=a}),98);
__d("WADemoteGroupParticipants",["WABridge","WAChangeGroupParticipantAdminStatusApi","WAGlobals","WAJids","WAJobs","WALogger","WAOdsEnums","WAResultOrError","WASmaxGroupsPromoteDemoteRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to demote participant: ",""]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("demoteGroupParticipants",function(a){var c,e,f,g,i,j,k,l,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:l=function(){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"fail"}),d("WALogger").WARN(h(),k.name)};e=a.group,f=a.users;g=d("WAGlobals").getJidUtilsApi(),i=g.toUserJid;j=f.map(function(a){return i(a)});if(!(j.length===0)){q.next=6;break}return q.abrupt("return",d("WAResultOrError").makeResult({type:"default",groupJid:e,participants:[]}));case 6:q.next=8;return b("regeneratorRuntime").awrap(d("WASmaxGroupsPromoteDemoteRPC").sendPromoteDemoteRPC({demoteArgs:{participantArgs:j.map(function(a){return{participantJid:a}})},iqTo:e}));case 8:k=q.sent;if(!(k.name==="PromoteDemoteResponseClientError")){q.next=15;break}m=k.value.promoteDemoteClientErrors.name;l();return q.abrupt("return",d("WAResultOrError").makeError(m));case 15:if(!(k.name==="PromoteDemoteResponseServerError")){q.next=19;break}n=k.value.errorServerErrors.name;l();return q.abrupt("return",d("WAResultOrError").makeError(n));case 19:d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"success"});o=((c=k.value.demoteParticipant)==null?void 0:c.filter(function(a){return!a.error}).map(function(a){return{user:a.jid,type:"participant",addressable:!1}}))||[];q.next=23;return b("regeneratorRuntime").awrap(d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,e,d("WAJids").AUTHOR_ME,o,"participant"));case 23:q.next=25;return b("regeneratorRuntime").awrap(d("WAJobs").getJobResultConvertersImpls().convertDemoteGroupParticipantsResult==null?void 0:d("WAJobs").getJobResultConvertersImpls().convertDemoteGroupParticipantsResult(e,o));case 25:p=q.sent;return q.abrupt("return",p?d("WAResultOrError").makeResult(p):d("WAResultOrError").makeResult({type:"default",groupJid:e,participants:o}));case 27:case"end":return q.stop()}},null,this)}).end();g.demoteGroupParticipants=a}),98);
__d("WAGetKeysForUpload",["WAGlobals","WALogger","WAResultOrError","WASignalKeys"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]);h=function(){return a};return a}function a(a){var b=d("WAGlobals").getCryptoManager();return b.storage.runInTransaction(function(c){c=c.loadPreKeys;return c(a).then(function(a){var c=a.preKeys;a=a.signedPreKey;var e=[];c.forEach(function(a){a=d("WASignalKeys").deserializePreKey(a);a==null?d("WALogger").ERROR(h()):e.push(a)});return d("WAResultOrError").makeResult({regInfo:b.regInfo,keyType:d("WASignalKeys").KEY_TYPE,preKeys:e,signedPreKey:a})})})}g.getKeysForUpload=a}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureBadRequestMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureFallbackMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");return!b.success?b:d("WAResultOrError").makeResult({text:b.value})}g.parseSetVnameFailureInternalServerErrorMixin=a}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"violation");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"reason");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"max");if(!e.success)return e;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,b.value,"length");return!b.success?b:d("WAResultOrError").makeResult({text:a.value,violationReason:c.value,violationMax:e.value,violationLength:b.value})}g.parseSetVnameFailureNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:c.value});var e=d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:e.value});var f=d("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(a);return f.success?d("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[b,c,e,f])}g.parseVnameFailures=a}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"error");if(!e.success)return e;var f=d("WASmaxParseUtils").attrString(c.value,"text");if(!f.success)return f;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,c.value,"code",207);if(!c.success)return c;var g=d("WASmaxParseUtils").attrIntRange(e.value,"code",400,599);if(!g.success)return g;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysVnameFailures").parseVnameFailures(e.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:f.value,errorCode:c.value,errorErrorCode:g.value},a.value,{errorErrorVnameFailures:b.value}))}g.parseSetResponsePreKeySuccessVnameFailure=a}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","406");return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorFallbackClient"],[b,c])}g.parseRequestErrors=a}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseSetResponseRequestError=a}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseSetResponseServerError=a}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetResponseSuccess=a}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("type",null,new Uint8Array([5])));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyTypeMixin=a}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.idElementValue;a=d("WASmaxJsx").smax("id",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyIDMixin=a}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyIDMixinArgs;a=a.keyDataMixinArgs;b=d("WASmaxJsx").smax("key",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(d("WASmaxJsx").smax("id",null),b),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("value",null),a));return b}function i(a){a=a.keyArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("list",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,2e4)));return a}function a(a,b){b=i(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makePreKeyListListKey=h;g.mergePreKeyListMixin=a}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.registrationElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("registration",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeRegistrationIDMixin=a}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyIDMixinArgs,c=a.keyDataMixinArgs;a=a.signatureElementValue;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("skey",null,d("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(d("WASmaxJsx").smax("id",null),b),d("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("value",null),c),d("WASmaxJsx").smax("signature",null,a)));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSignedPreKeyMixin=a}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.verifiedNameElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("verified_name",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeVerifiedNameMixin=a}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(a,b,c,d,e,f,g){function h(a){var b=a.verifiedNameMixinArgs;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,d("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(d("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(d("WASmaxJsx").smax("smax$any",null),a),a),a),a)),b);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyBundleMixin=a}),98);
__d("WASmaxOutPreKeysFBIDIdentityTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",{identity_type:"fbid"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeFBIDIdentityTypeMixin=a}),98);
__d("WASmaxOutPreKeysLIDIdentityTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",{identity_type:"lid"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeLIDIdentityTypeMixin=a}),98);
__d("WASmaxOutPreKeysPNIdentityTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",{identity_type:"pn"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePNIdentityTypeMixin=a}),98);
__d("WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutPreKeysFBIDIdentityTypeMixin","WASmaxOutPreKeysLIDIdentityTypeMixin","WASmaxOutPreKeysPNIdentityTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isLIDIdentityType)return d("WASmaxOutPreKeysLIDIdentityTypeMixin").mergeLIDIdentityTypeMixin(a);if(b.isPNIdentityType)return d("WASmaxOutPreKeysPNIdentityTypeMixin").mergePNIdentityTypeMixin(a);if(b.isFBIDIdentityType)return d("WASmaxOutPreKeysFBIDIdentityTypeMixin").mergeFBIDIdentityTypeMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup=a}),98);
__d("WASmaxOutPreKeysDualIdentityBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyBundleMixin","WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){var b=a.identityKeyBundleMixinArgs;a=a.lIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroupArgs;b=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup").mergeLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup(d("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(d("WASmaxJsx").smax("set",null),b),a));return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDualIdentityBundleMixin=a}),98);
__d("WASmaxOutPreKeysSoleIdentityBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(d("WASmaxJsx").smax("smax$any",null),a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSoleIdentityBundleMixin=a}),98);
__d("WASmaxOutPreKeysDualOrSoleIdentityBundleMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutPreKeysDualIdentityBundleMixin","WASmaxOutPreKeysSoleIdentityBundleMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.dualIdentityBundle)return d("WASmaxOutPreKeysDualIdentityBundleMixin").mergeDualIdentityBundleMixin(a,b.dualIdentityBundle);if(b.soleIdentityBundle)return d("WASmaxOutPreKeysSoleIdentityBundleMixin").mergeSoleIdentityBundleMixin(a,b.soleIdentityBundle);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeDualOrSoleIdentityBundleMixinGroup=a}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysDualOrSoleIdentityBundleMixinGroup"],(function(a,b,c,d,e,f,g){function a(a){a=a.dualOrSoleIdentityBundleMixinGroupArgs;a=d("WASmaxOutPreKeysDualOrSoleIdentityBundleMixinGroup").mergeDualOrSoleIdentityBundleMixinGroup(d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"})),a);return a}g.makeSetRequest=a}),98);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutPreKeysSetRequest").makeSetRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"SetResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"SetResponsePreKeySuccessVnameFailure",value:h.value});case 10:i=d("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"SetResponseRequestError",value:i.value});case 13:j=d("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"SetResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:g,PreKeySuccessVnameFailure:h,RequestError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendSetRPC=a}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WACryptoManager","WAErr","WAGetKeysForUpload","WAGlobals","WAJobs","WALogger","WAOdsEnums","WAPreKeysStanzaUtils","WAPromiseRetryLoop","WARetryUtils","WASmaxPreKeysSetRPC","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[generateAndUpload] Got server error code on upload pre keys attempt"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[generateAndUpload] Got Malformed upload keys IQ on upload pre keys attempt"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[generateAndUpload] Keys are successfully uploaded"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[generateAndUpload] Attempt to upload keys"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[generateAndUpload] about to upload pre keys"]);m=function(){return a};return a}a=function(){var a,c,e,f,g,h,i,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:p.next=2;return b("regeneratorRuntime").awrap(d("WACryptoManager").generatePreKeys(d("WAGlobals").getCryptoManager()));case 2:a=p.sent;d("WALogger").LOG(m()).devConsole("generation "+a);p.next=6;return b("regeneratorRuntime").awrap(d("WAGetKeysForUpload").getKeysForUpload(a));case 6:c=p.sent;if(!(c.success===!1)){p.next=10;break}d("WALogger").ERROR(l(),c.error);return p.abrupt("return");case 10:e=c.value,f=e.regInfo,g=e.preKeys,h=e.signedPreKey;i={dualOrSoleIdentityBundleMixinGroupArgs:{soleIdentityBundle:babelHelpers["extends"]({registrationElementValue:d("WAWap").BIG_ENDIAN_CONTENT(f.regId),anyElementValue:f.staticKeyPair.publicKey,keyArgs:g.map(d("WAPreKeysStanzaUtils").makePreKeyMixin)},d("WAPreKeysStanzaUtils").makeSignedPreKeyMixin(h))}};o=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"uploadKeys",timer:d("WARetryUtils").FIBONACCI_BACKOFF,code:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:d("WALogger").LOG(k());e.next=3;return b("regeneratorRuntime").awrap(n(i));case 3:c=e.sent,c&&(d("WALogger").LOG(j()),d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:g.length},!0),a());case 5:case"end":return e.stop()}},null,this)}});o.start();return p.abrupt("return",o.promise());case 15:case"end":return p.stop()}},null,this)};e=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("generateAndUploadPreKeys",a).end();function n(a){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysSetRPC").sendSetRPC(a));case 2:e=f.sent;f.t0=e.name;f.next=f.t0==="SetResponseRequestError"?6:f.t0==="SetResponseSuccess"?9:10;break;case 6:d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0);d("WALogger").WARN(i());throw c("WAErr")("Malformed upload keys IQ");case 9:return f.abrupt("return",!0);case 10:e.name;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"fail"},!0);d("WALogger").WARN(h());return f.abrupt("return",!1);case 14:case"end":return f.stop()}},null,this)}g.generateAndUploadPreKeysFn=a;g.generateAndUploadPreKeys=e}),98);
__d("WAHandleSpamMsg",["WAGlobals","WAJobs","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg processed spam msgs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg starts processing spam msgs"]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("updateAndHandleMsg",function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:d("WALogger").DEV(i());a.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().processSpamMsgs());case 3:d("WALogger").DEV(h());case 4:case"end":return a.stop()}},null,this)}).end();g.handleSpamMsg=a}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseNotifyResponseError=a}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseNotifyResponseSuccess=a}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.userJid;a=d("WASmaxJsx").smax("user",{jid:d("WAWap").USER_JID(a)});return a}function a(a){a=a.userArgs;a=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("users",null,d("WASmaxChildren").REPEATED_CHILD(h,a,1,25))));return a}g.makeNotifyRequestUsersUser=h;g.makeNotifyRequest=a}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"NotifyResponseSuccess",value:g.value});case 7:h=d("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"NotifyResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendNotifyRPC=a}),98);
__d("WANotifyDeviceChange",["WAErr","WAGlobals","WAJobs","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("notifyDeviceChange",function(a){a=a.users;if(a.size===0)return;var b=d("WAGlobals").getConfig().maxUsersForNotifyDeviceChange(),c=Array.from(a);a.size>b&&(d("WALogger").ERROR(h(),b),c=c.slice(0,b));return i(c)}).end();function i(a){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(d("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:a.map(function(a){return{userJid:a}})}));case 2:e=h.sent;if(!(e.name==="NotifyResponseSuccess")){h.next=5;break}return h.abrupt("return");case 5:e.name;f=e.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(!(f.name==="RetryableIQError")){h.next=14;break}g=f.value.backoff;if(!(g!=null)){h.next=13;break}throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:g},jitter:0});case 13:throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1});case 14:throw c("WAErr")("Failed with an unexpected error code "+f.value.code);case 15:case"end":return h.stop()}},null,this)}g.notifyDeviceChange=a}),98);
__d("WAPromoteGroupParticipants",["WABridge","WAChangeGroupParticipantAdminStatusApi","WADualSendMsgUtils","WAGlobals","WAJids","WAJobs","WALogger","WAOdsEnums","WAResultOrError","WASmaxGroupsPromoteDemoteRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to promote participant: "," ",""]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("promoteGroupParticipants",function(a){var c,e,f,g,i,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:m=function(a){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"fail"}),d("WALogger").WARN(h(),l.name,a)};e=a.group,f=a.users;g=e;e.startsWith("shadow_")&&(g=d("WADualSendMsgUtils").removeDualSendPrefixForGroup(e));i=d("WAGlobals").getJidUtilsApi(),j=i.toUserJid;k=f.map(function(a){return j(a)});if(!(k.length===0)){r.next=8;break}return r.abrupt("return",d("WAResultOrError").makeResult({type:"default",groupJid:e,participants:[]}));case 8:r.next=10;return b("regeneratorRuntime").awrap(d("WASmaxGroupsPromoteDemoteRPC").sendPromoteDemoteRPC({promoteArgs:{participantArgs:k.map(function(a){return{participantJid:a}})},iqTo:g}));case 10:l=r.sent;if(!(l.name==="PromoteDemoteResponseClientError")){r.next=17;break}n=l.value.promoteDemoteClientErrors.name;m(n);return r.abrupt("return",d("WAResultOrError").makeError(n));case 17:if(!(l.name==="PromoteDemoteResponseServerError")){r.next=21;break}o=l.value.errorServerErrors.name;m(o);return r.abrupt("return",d("WAResultOrError").makeError(o));case 21:d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"success"});p=((c=l.value.promoteParticipant)==null?void 0:c.filter(function(a){return!a.error}).map(function(a){return{user:a.jid,type:"participant",addressable:!0}}))||[];r.next=25;return b("regeneratorRuntime").awrap(d("WAChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,e,d("WAJids").AUTHOR_ME,p,"admin"));case 25:r.next=27;return b("regeneratorRuntime").awrap(d("WAJobs").getJobResultConvertersImpls().convertPromoteGroupParticipantsResult==null?void 0:d("WAJobs").getJobResultConvertersImpls().convertPromoteGroupParticipantsResult(e,p));case 27:q=r.sent;return r.abrupt("return",q?d("WAResultOrError").makeResult(q):d("WAResultOrError").makeResult({type:"default",groupJid:e,participants:p}));case 29:case"end":return r.stop()}},null,this)}).end();g.promoteGroupParticipants=a}),98);
__d("WAQueryGroups",["WAErr","WAGetDevices","WAGlobals","WAJobs","WAQueryGroup","WAScheduleAfterOfflineResume","WASendSenderKeyDistributionMsg","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:if(!(a.type==="all")){j.next=9;break}j.next=3;return b("regeneratorRuntime").awrap(d("WAQueryGroup").queryAllGroups());case 3:f=j.sent;if(!(f.success===!1)){j.next=6;break}throw c("WAErr")("Failed to parse queryAllGroup response with error "+JSON.stringify(f.error));case 6:e=f.value;j.next=16;break;case 9:a.type;j.next=12;return b("regeneratorRuntime").awrap(d("WAQueryGroup").queryGroup(a.group));case 12:g=j.sent;if(!(g.success===!1)){j.next=15;break}throw c("WAErr")("Failed to parse queryGroup response with error "+JSON.stringify(g.error));case 15:e={groups:[g.value]};case 16:j.next=18;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().createGroups(e.groups));case 18:j.next=20;return b("regeneratorRuntime").awrap(d("WAJobs").getJobResultConvertersImpls().convertQueryGroupsResult==null?void 0:d("WAJobs").getJobResultConvertersImpls().convertQueryGroupsResult(e.groups));case 20:h=j.sent;i=new Set();e.groups.forEach(function(a){return a.participants.forEach(function(a){a.success?i.add(a.value.user):i.add(a.error.user)})});j.next=25;return b("regeneratorRuntime").awrap(d("WAGetDevices").fetchAndSaveDevices(i,"query-groups"));case 25:e.groups.forEach(function(a){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({id:a.jid+"-e2e-session",code:function(){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(a.jid,a.participants.length)}})});return j.abrupt("return",h||{type:"default",groups:e.groups});case 27:case"end":return j.stop()}},null,this)}e=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("queryGroups",a).end();g.queryGroupsImpl=a;g.queryGroups=e}),98);
__d("WASmaxInGroupsIQErrorPayloadTooLargeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","payload-too-large");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","413");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPayloadTooLargeMixin=a}),98);
__d("WASmaxInGroupsRequestTooLargeMixin",["WASmaxInGroupsIQErrorPayloadTooLargeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorPayloadTooLargeMixin").parseIQErrorPayloadTooLargeMixin(b.value);return!a.success?a:a}g.parseRequestTooLargeMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsFallbackClientMixin","WASmaxInGroupsGroupDoesNotExistMixin","WASmaxInGroupsGroupIsSuspendedMixin","WASmaxInGroupsInvalidParticipantJIDMixin","WASmaxInGroupsMalformedStanzaMixin","WASmaxInGroupsRateLimitedMixin","WASmaxInGroupsRequestTooLargeMixin","WASmaxInGroupsUnsupportedOperationMixin","WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin","WASmaxInGroupsUserIsNotAParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsRateLimitedMixin").parseRateLimitedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RateLimited",value:b.value});var c=d("WASmaxInGroupsRequestTooLargeMixin").parseRequestTooLargeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"RequestTooLarge",value:c.value});var e=d("WASmaxInGroupsUnsupportedOperationMixin").parseUnsupportedOperationMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"UnsupportedOperation",value:e.value});var f=d("WASmaxInGroupsInvalidParticipantJIDMixin").parseInvalidParticipantJIDMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"InvalidParticipantJID",value:f.value});var g=d("WASmaxInGroupsMalformedStanzaMixin").parseMalformedStanzaMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"MalformedStanza",value:g.value});var h=d("WASmaxInGroupsGroupDoesNotExistMixin").parseGroupDoesNotExistMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"GroupDoesNotExist",value:h.value});var i=d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin").parseUserDoesNotHaveAdminPermissionMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"UserDoesNotHaveAdminPermission",value:i.value});var j=d("WASmaxInGroupsUserIsNotAParticipantMixin").parseUserIsNotAParticipantMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"UserIsNotAParticipant",value:j.value});var k=d("WASmaxInGroupsGroupIsSuspendedMixin").parseGroupIsSuspendedMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"GroupIsSuspended",value:k.value});var l=d("WASmaxInGroupsFallbackClientMixin").parseFallbackClientMixin(a);return l.success?d("WAResultOrError").makeResult({name:"FallbackClient",value:l.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RateLimited","RequestTooLarge","UnsupportedOperation","InvalidParticipantJID","MalformedStanza","GroupDoesNotExist","UserDoesNotHaveAdminPermission","UserIsNotAParticipant","GroupIsSuspended","FallbackClient"],[b,c,e,f,g,h,i,j,k,l])}g.parseRemoveParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsRemoveParticipantsClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!c.success)return c;b=d("WASmaxInGroupsRemoveParticipantsClientErrors").parseRemoveParticipantsClientErrors(a);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{removeParticipantsClientErrors:b.value}))}g.parseRemoveParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseRemoveParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsParticipantNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAllowedMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotInGroupMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseRemoveParticipantsLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAllowedMixin","WASmaxInGroupsParticipantNotInGroupMixin","WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantNotInGroupMixin").parseParticipantNotInGroupMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantNotInGroup",value:b.value});var c=d("WASmaxInGroupsParticipantNotAllowedMixin").parseParticipantNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAllowed",value:c.value});var e=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:e.value});var f=d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin").parseRemoveParticipantsLinkedGroupsServerErrorMixin(a);return f.success?d("WAResultOrError").makeResult({name:"RemoveParticipantsLinkedGroupsServerError",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantNotInGroup","ParticipantNotAllowed","ParticipantNotAcceptable","RemoveParticipantsLinkedGroupsServerError"],[b,c,e,f])}g.parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup").parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({jid:b.value,participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"remove");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"linked_groups","true");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,1024,h);return!a.success?a:d("WAResultOrError").makeResult({type:e.value,removeLinkedGroups:b.value,removeParticipant:a.value})}g.parseRemoveParticipantsResponseSuccessRemoveParticipant=h;g.parseRemoveParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsRemoveParticipantsRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function a(a){var b=a.participantArgs,c=a.hasRemoveLinkedGroupsTrue;c=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("remove",{linked_groups:d("WASmaxAttrs").OPTIONAL_LITERAL("true",c)},d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return c}g.makeRemoveParticipantsRequestRemoveParticipant=h;g.makeRemoveParticipantsRequest=a}),98);
__d("WASmaxGroupsRemoveParticipantsRPC",["WAComms","WASmaxInGroupsRemoveParticipantsResponseClientError","WASmaxInGroupsRemoveParticipantsResponseServerError","WASmaxInGroupsRemoveParticipantsResponseSuccess","WASmaxOutGroupsRemoveParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsRemoveParticipantsRequest").makeRemoveParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsRemoveParticipantsResponseSuccess").parseRemoveParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"RemoveParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsRemoveParticipantsResponseClientError").parseRemoveParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"RemoveParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsRemoveParticipantsResponseServerError").parseRemoveParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"RemoveParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RemoveParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendRemoveParticipantsRPC=a}),98);
__d("WARemoveGroupParticipants",["WABridge","WADualSendMsgUtils","WAGlobals","WAJids","WAJobs","WALogger","WAOdsEnums","WAPREList","WAPREMetrics","WARemoveGroupParticipantsApi","WAResultOrError","WASmaxGroupsRemoveParticipantsRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove a participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove participants: ",""]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("sendIq",function(a,c,e){var f,g,j,k,l,m,n,o,p,q,r;return b("regeneratorRuntime").async(function(s){while(1)switch(s.prev=s.next){case 0:f=a.group,c=a.users;g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS,{bool:{isDualSendGroup:d("WADualSendMsgUtils").isDualSendJid(f)},"int":{removedParticipants:c.length}});e=d("WAGlobals").getJidUtilsApi(),j=e.toUserJid;k=d("WADualSendMsgUtils").isDualSendJid(f)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(f):f;l=c.map(function(a){return j(a)});m=[];if(!(l.length>0)){s.next=23;break}n=function(a){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"fail"}),d("WALogger").ERROR(i(),o.name),g.endFail("send_iq_fail "+a)};s.next=10;return b("regeneratorRuntime").awrap(d("WASmaxGroupsRemoveParticipantsRPC").sendRemoveParticipantsRPC({participantArgs:l.map(function(a){return{participantJid:a}}),iqTo:k,hasRemoveLinkedGroupsTrue:!1}));case 10:o=s.sent;g.addPoint("finish_send_iq");s.t0=o.name;s.next=s.t0==="RemoveParticipantsResponseClientError"?15:s.t0==="RemoveParticipantsResponseServerError"?18:s.t0==="RemoveParticipantsResponseSuccess"?21:23;break;case 15:p=o.value.removeParticipantsClientErrors.name;n(p);return s.abrupt("return",d("WAResultOrError").makeError(p));case 18:q=o.value.errorServerErrors.name;n(q);return s.abrupt("return",d("WAResultOrError").makeError(q));case 21:d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"success"}),o.value.removeParticipant.forEach(function(a){var b=a.jid;a=a.participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup;a==null?m.push({user:b,type:"nonparticipant",addressable:!0}):d("WALogger").ERROR(h(),a.name)});case 23:g.addPoint("start_remove_participant_txn");s.next=26;return b("regeneratorRuntime").awrap(d("WARemoveGroupParticipantsApi").removeGroupParticipants(null,f,d("WAJids").AUTHOR_ME,m,!0));case 26:g.addPoint("finish_remove_participant_txn");s.next=29;return b("regeneratorRuntime").awrap(d("WAJobs").getJobResultConvertersImpls().convertRemoveGroupParticipantsResult==null?void 0:d("WAJobs").getJobResultConvertersImpls().convertRemoveGroupParticipantsResult(f,m));case 29:r=s.sent;g.endSuccess();if(!r){s.next=33;break}return s.abrupt("return",d("WAResultOrError").makeResult(r));case 33:return s.abrupt("return",d("WAResultOrError").makeResult({groupJid:f,participants:m}));case 34:case"end":return s.stop()}},null,this)}).end();g.removeGroupParticipants=a}),98);
__d("WARequestAllSyncdMissingKeys",["WAJobs","WALogger","WASyncdHandleMissingKeys","WASyncdStoreMissingKeys","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: periodic sync all missing keys"]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("requestAllMissingKeys",function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:d("WALogger").LOG(h());a.next=3;return b("regeneratorRuntime").awrap(d("WASyncdHandleMissingKeys").requestAllMissingKeys());case 3:self.setTimeout(d("WASyncdStoreMissingKeys").setMissingKeyTimeoutInTransaction,1e3*20);case 4:case"end":return a.stop()}},null,this)}).end();g.requestAllSyncdMissingKeys=a}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","404");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:c.value});var e=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorFallbackClient","IQErrorItemNotFound"],[b,c,e])}g.parseIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup","WASmaxInPreKeysIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup").parseIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorNotAcceptableOrFallbackClientOrItemNotFoundMixinGroup:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup"],(function(a,b,c,d,e,f,g){function a(a){a=a.lIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroupArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup").mergeLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup(d("WASmaxJsx").smax("digest",null),a)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"FetchDigestResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"FetchDigestResponseRequestError",value:h.value});case 10:i=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"FetchDigestResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:g,RequestError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigest",["Promise","WABinary","WABridge","WACryptoUtils","WAErr","WAGetKeysForUpload","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAOdsEnums","WAPreKeysStanzaUtils","WAPromiseManagement","WASmaxPreKeysFetchDigestRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("requestPreKeyDigest",d("WAPromiseManagement").nullaryCacheWhilePending(function(){var a,e,f,g,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:a=d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({lIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroupArgs:{isFBIDIdentityType:!0}});m.next=3;return b("regeneratorRuntime").awrap(b("Promise").all([a,d("WAGetKeysForUpload").getKeysForUpload()]));case 3:e=m.sent;f=e[0];g=e[1];if(!(f.name!=="FetchDigestResponseSuccess"||g.success===!1)){m.next=9;break}d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});throw c("WAErr")("Error while requesting key digest: "+f.name);case 9:f.name;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"});j=d("WAPreKeysStanzaUtils").convertIdentityDigestBundle(f.value.digestIdentityDigestBundleMixin);k={regId:j.regId,skeyId:j.skey.id,preKeyIds:j.keys,hash:j.hash};m.next=15;return b("regeneratorRuntime").awrap(i(k,g.value));case 15:l=m.sent;if(!(l!=="ok")){m.next=20;break}d("WALogger").ERROR(h(),l);m.next=20;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})));case 20:case"end":return m.stop()}},null,this)})).end();function i(a,c){var e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!(a.regId!==c.regInfo.regId)){h.next=2;break}return h.abrupt("return","RegIdMismatch");case 2:if(!(a.skeyId!==c.signedPreKey.id)){h.next=4;break}return h.abrupt("return","SignedPreKeyIdMismatch");case 4:e=new Set();c.preKeys.forEach(function(a){a=a.id;return void e.add(a)});f=a.preKeyIds.some(function(a){return!e.has(a)});if(!f){h.next=9;break}return h.abrupt("return","UnknownPreKey");case 9:h.next=11;return b("regeneratorRuntime").awrap(j(c));case 11:g=h.sent;if(d("WACryptoUtils").uint8ArraysEqual(g,a.hash)){h.next=14;break}return h.abrupt("return","HashMismatch");case 14:return h.abrupt("return","ok");case 15:case"end":return h.stop()}},null,this)}function j(a){var b=new(d("WABinary").Binary)();b.writeByteArray(a.regInfo.staticKeyPair.publicKey);b.writeByteArray(a.signedPreKey.keyPair.publicKey);b.writeByteArray(a.signedPreKey.signature);a.preKeys.sort(k).forEach(function(a){b.writeByteArray(a.keyPair.publicKey)});return self.crypto.subtle.digest("SHA-1",b.readByteArray()).then(function(a){return new Uint8Array(a)})}function k(a,b){return a.id-b.id}g.requestPreKeyDigest=a}),98);
__d("WACreateRetrier",["WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:a}));case 2:c=j.sent;if(c.success){j.next=5;break}return j.abrupt("return",c);case 5:e=c.value,f=e.selectedHost,g=e.fallbackHost,h=e.authToken;i=new(d("WAMediaOperationsRetrier").MediaOperationsRetrier)("upload",{host:{domain:f.domain,"class":f["class"]},fallbackHost:g&&{domain:g.domain,"class":g["class"]},authToken:h,timeElapsed:null});return j.abrupt("return",d("WAResultOrError").makeResult(i));case 8:case"end":return j.stop()}},null,this)}g.createUploadRetrier=a}),98);
__d("WAHttpResumeCheck",["WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""]);j=function(){return a};return a}function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:g.prev=0;g.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}}));case 3:c=g.sent;g.next=10;break;case 6:g.prev=6;g.t0=g["catch"](0);d("WALogger").ERROR(j(),g.t0);throw g.t0;case 10:e=c,f=e.status;d("WALogger").LOG(i(),f);g.t1=f;g.next=g.t1===200?15:g.t1===404?16:g.t1===408?17:g.t1===429?18:g.t1===507?18:19;break;case 15:return g.abrupt("return",c.json().then(function(a){a=a.resume;return a==="complete"?d("WAResultOrError").makeResult("media-found"):d("WAResultOrError").makeResult("media-not-found")})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return g.abrupt("return",d("WAResultOrError").makeResult("media-not-found"));case 17:return g.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 18:return g.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 19:if(!(f>=400&&f<500)){g.next=21;break}return g.abrupt("return",d("WAResultOrError").makeError("request-error"));case 21:return g.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 22:case"end":return g.stop()}},null,this,[[0,6]])}g.httpResumeCheck=a}),98);
__d("WACheckCiphertextInServer",["WAHttpResumeCheck","WAMediaUrl","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f){return f.run(function(f,g){var h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:h=d("WAMediaUrl").buildUploadUrl(a,e,c,f.domain,g,!0);k.next=3;return b("regeneratorRuntime").awrap(d("WAHttpResumeCheck").httpResumeCheck(h));case 3:i=k.sent;if(!i.success){k.next=8;break}return k.abrupt("return",d("WAResultOrError").makeResult(i));case 8:j=i.error;k.t0=j;k.next=k.t0==="server-timeout"?12:k.t0==="unspecified-http-error"?12:13;break;case 12:return k.abrupt("return",d("WAResultOrError").makeError({progressMade:!0}));case 13:return k.abrupt("return",d("WAResultOrError").makeResult(d("WAResultOrError").makeError(j)));case 14:case"end":return k.stop()}},null,this)}).then(function(a){return(a=a)!=null?a:d("WAResultOrError").makeError("max-attempts-exceeded")})}g.checkCiphertextInServer=a}),98);
__d("WAIsMediaKeyReusable",["WATimeUtils"],(function(a,b,c,d,e,f,g){var h=2*d("WATimeUtils").DAY_SECONDS;function a(a){var b=Math.floor(Math.random()*d("WATimeUtils").DAY_SECONDS);return a!=null&&d("WATimeUtils").happenedWithin(a,h+b)}g.MMS_MEDIA_KEY_TTL=h;g.isMediaKeyReusable=a}),98);
__d("WAFindReusableMediaEntry",["Promise","WAGlobals","WAIsMediaKeyReusable","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return b("Promise").all([d("WAGlobals").getDbImpls().getMediaKnownEntries(a)]).then(function(a){a=a[0];if(c==null)return null;a=a.get(c);if(a==null)return null;a=d("WAMediaUtils").decodeMediaEntryData(a);var b=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken,g=a.fileEncSha256;a=babelHelpers.objectWithoutPropertiesLoose(a,["mediaKey","mediaKeyTimestamp","uploadToken","fileEncSha256"]);return b!=null&&f!=null&&g!=null&&e!=null&&d("WAIsMediaKeyReusable").isMediaKeyReusable(e)?babelHelpers["extends"]({},a,{mediaKey:b,mediaKeyTimestamp:e,uploadToken:f,fileEncSha256:g}):null})}g.findReusableMediaEntryForArmadillo=a}),98);
__d("WAHttpRegularUploadMedia",["WAErr","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""]);j=function(){return a};return a}function a(a,e){var f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.prev=0;l.next=3;return b("regeneratorRuntime").awrap(fetch(a,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([e])}));case 3:f=l.sent;l.next=10;break;case 6:l.prev=6;l.t0=l["catch"](0);d("WALogger").ERROR(j(),l.t0);throw l.t0;case 10:g=f,k=g.status;d("WALogger").LOG(i(),k);l.t1=k;l.next=l.t1===200?15:l.t1===408?16:l.t1===413?17:l.t1===415?18:l.t1===429?19:l.t1===507?19:20;break;case 15:return l.abrupt("return",f.json().then(function(a){if(!Object.prototype.hasOwnProperty.call(a,"direct_path"))throw c("WAErr")("direct_path not available in wa upload http response");if(typeof a.direct_path!=="string")throw c("WAErr")('directPath: "'+a.direct_path+'" is not a string');if(a.object_id&&typeof a.object_id!=="string")throw c("WAErr")('objectId: "'+a.object_id+'" is not a string');if(a.handle&&typeof a.handle!=="string")throw c("WAErr")('handle: "'+a.handle+'" is not a string');a={directPath:a.direct_path,objectId:a.object_id,handle:a.handle};return d("WAResultOrError").makeResult(a)})["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("body-network-error")}));case 16:return l.abrupt("return",d("WAResultOrError").makeError("server-timeout"));case 17:return l.abrupt("return",d("WAResultOrError").makeError("payload-too-large"));case 18:return l.abrupt("return",d("WAResultOrError").makeError("invalid-media"));case 19:return l.abrupt("return",d("WAResultOrError").makeError("upload-throttled"));case 20:if(!(k>=400&&k<500)){l.next=22;break}return l.abrupt("return",d("WAResultOrError").makeError("request-error"));case 22:return l.abrupt("return",d("WAResultOrError").makeError("unspecified-http-error"));case 23:case"end":return l.stop()}},null,this,[[0,6]])}g.httpRegularUploadMedia=a}),98);
__d("WAUploadMedia",["WABase64","WACheckCiphertextInServer","WACreateRetrier","WAErr","WAFindReusableMediaEntry","WAGlobals","WAHttpRegularUploadMedia","WALogger","WAMediaCrypto","WAMediaUrl","WAMediaUtils","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: mediaTypeDetails has neither previewMediaType nor serverMediaType"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is not on the server, start uploading"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is on the server"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume/exist check exhausted available retries"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: async upload"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: fail to gather media routes"]);s=function(){return a};return a}function a(a){var c,e,f,g,h,i,j,k,l,m,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;return b("regeneratorRuntime").async(function(L){while(1)switch(L.prev=L.next){case 0:a.chatJid,f=a.hash,g=a.mediaTypeDetails,h=a.protocolMsgId,i=a.size,j=a.uploadMediaFlow;(g==null?void 0:g.serverMediaType)!=null?k=g.serverMediaType:k="preview";L.next=4;return b("regeneratorRuntime").awrap(d("WACreateRetrier").createUploadRetrier(k));case 4:l=L.sent;if(l.success){L.next=9;break}d("WALogger").WARN(s());j==null?void 0:j.endFail("failToGatherMediaRoutes");return L.abrupt("return",l);case 9:m=l.value;v=u(h,f);L.next=13;return b("regeneratorRuntime").awrap(d("WAFindReusableMediaEntry").findReusableMediaEntryForArmadillo(f,h));case 13:w=L.sent;if(!(w!=null)){L.next=39;break}x=w.fileEncSha256,y=w.fileSha256,z=w.uploadToken,A=w.mediaKey,B=w.mediaKeyTimestamp,C=w.directPath,D=w.objectId,E=w.downloadableThumbnail;F={fileSha256:y||d("WABase64").decodeB64UrlSafe(f),fileEncSha256:x,mediaKey:A,mediaKeyTimestamp:B,serverMediaType:k,uploadToken:z,directPath:C,objectId:D,downloadableThumbnail:E};if(!(C!=null)){L.next=25;break}d("WALogger").LOG(r());L.next=21;return b("regeneratorRuntime").awrap(v(F));case 21:j==null?void 0:j.endSuccess();return L.abrupt("return",d("WAResultOrError").makeResult({objectId:D}));case 25:L.next=27;return b("regeneratorRuntime").awrap(d("WACheckCiphertextInServer").checkCiphertextInServer(k,x,z,m));case 27:G=L.sent;if(G.success){L.next=32;break}d("WALogger").WARN(q());j==null?void 0:j.endFail("failToUpload");return L.abrupt("return",G);case 32:if(!(G.value==="media-found")){L.next=38;break}d("WALogger").LOG(p());L.next=36;return b("regeneratorRuntime").awrap(v(F));case 36:j==null?void 0:j.endSuccess();return L.abrupt("return",d("WAResultOrError").makeResult({objectId:D}));case 38:G.value;case 39:d("WALogger").LOG(o());H=(c=w==null?void 0:w.mediaKey)!=null?c:d("WAMediaUtils").createMediaKey();I=(e=w==null?void 0:w.uploadToken)!=null?e:d("WAMediaUtils").createUploadToken();J=d("WATimeUtils").unixTime();L.next=45;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaPlaintext(f));case 45:K=L.sent;if(!(K==null)){L.next=50;break}d("WALogger").ERROR(n());j==null?void 0:j.endFail("missingPlaintext");return L.abrupt("return",d("WAResultOrError").makeError("no-plaintext"));case 50:return L.abrupt("return",t(g,f,K,H,J,I,i,m,v,j));case 51:case"end":return L.stop()}},null,this)}function t(a,e,f,g,n,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;return b("regeneratorRuntime").async(function(K){while(1)switch(K.prev=K.next){case 0:if(!(a.previewMediaType!=null)){K.next=10;break}K.next=3;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").computeMediaKeysForPreview(g));case 3:p=K.sent;t=p.iv;u=p.cipherKey;v=p.hmacKey;w="preview";K.next=22;break;case 10:if(!((a==null?void 0:a.serverMediaType)!=null)){K.next=20;break}K.next=13;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").computeMediaKeys(g,a.serverMediaType));case 13:x=K.sent;t=x.iv;u=x.cipherKey;v=x.hmacKey;w=a.serverMediaType;K.next=22;break;case 20:d("WALogger").ERROR(m());throw c("WAErr")("mediaTypeDetails has neither previewMediaType nor serverMediaType");case 22:K.next=24;return b("regeneratorRuntime").awrap(d("WAMediaCrypto").encryptAndHmac(u,t,v,f,w));case 24:y=K.sent;z=y.ciphertext;A=y.ciphertextHash;B=y.sidecar;C={fileSha256:d("WABase64").decodeB64UrlSafe(e),fileEncSha256:A,mediaKey:g,mediaKeyTimestamp:n,serverMediaType:w,uploadToken:o,sidecar:B};K.next=31;return b("regeneratorRuntime").awrap(r(C));case 31:K.next=33;return b("regeneratorRuntime").awrap(q.run(function(a,b){a=a.domain;a=d("WAMediaUrl").buildUploadUrl(w,o,A,a,b,!1);d("WALogger").LOG(l(),a);return d("WAHttpRegularUploadMedia").httpRegularUploadMedia(a,z).then(function(a){if(a.success)return d("WAResultOrError").makeResult(a);else{a=a.error;d("WALogger").LOG(k(),a);switch(a){case"server-timeout":case"unspecified-http-error":return d("WAResultOrError").makeError({progressMade:!0});default:return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(a))}}})["catch"](function(a){d("WALogger").ERROR(j(),a);return d("WAResultOrError").makeError({progressMade:!1})})}));case 33:D=K.sent;if(!(D==null)){K.next=38;break}d("WALogger").WARN(i());s==null?void 0:s.endFail("maxAttemptsExceeded");return K.abrupt("return",d("WAResultOrError").makeError("max-attempts-exceeded"));case 38:if(!(D.success===!1)){K.next=41;break}s==null?void 0:s.endFail(D.error);return K.abrupt("return",D);case 41:E=D.value,F=E.directPath,G=E.objectId,H=E.handle;K.next=44;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getDownloadableThumbnailForMedia(e));case 44:I=K.sent;if(!(G==null?void 0:G.length)){K.next=50;break}K.next=48;return b("regeneratorRuntime").awrap(r(babelHelpers["extends"]({},C,{directPath:F,downloadableThumbnail:I,handle:H,objectId:G})));case 48:K.next=52;break;case 50:K.next=52;return b("regeneratorRuntime").awrap(r(babelHelpers["extends"]({},C,{directPath:F,downloadableThumbnail:I,handle:H})));case 52:d("WALogger").LOG(h(),{directPath:F},{objectId:G});s==null?void 0:s.endSuccess();J={objectId:G};return K.abrupt("return",d("WAResultOrError").makeResult(J));case 56:case"end":return K.stop()}},null,this)}function u(a,b){return function(c){var e=d("WAMediaUtils").encodeMediaEntryForUpload(c);if(a==null)return d("WAGlobals").getDbImpls().updateMediaEntryForOptimisticUpload(b,function(){return e},c==null?void 0:c.objectId,c==null?void 0:c.serverMediaType);else return d("WAGlobals").getDbImpls().updateMediaEntryForMsg(b,a,function(){return e},c==null?void 0:c.objectId,c==null?void 0:c.serverMediaType)}}g.uploadMedia=a;g.encryptAndUploadPlaintext=t}),98);
__d("WAReuploadMedia",["WAComms","WACreateRetrier","WAGetDecodedMediaEntry","WAGlobals","WAJids","WAJobs","WALogger","WAMediaRetryCrypto","WAMediaUtils","WAServerMediaType","WAUploadMedia","WAWap","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["notifyMediaRetry: Msg "," mediaEntry is invalid"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["notifyMediaRetry: Msg "," mediaEntry no longer exists"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: failed to upload"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: no plaintext"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: failed to create upload retrier"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: stanzaId mismatch"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: Msg "," mediaEntry is invalid"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: msg "," or media no longer exists."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: msg "," or media no longer exists."]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["reuploadMedia: receiver "," is not authorized for ",""]);q=function(){return a};return a}a=function(a){var c,e,f,g,h,i,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;return b("regeneratorRuntime").async(function(J){while(1)switch(J.prev=J.next){case 0:c=a.externalId,e=a.receiver,f=a.chatJid,g=a.encProto,h=a.encIv;J.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaIfAuthorized(f,c,e));case 3:i=J.sent;if(i.success){J.next=7;break}i.error==="error-unknown-device"?d("WALogger").LOG(q(),e,c):d("WALogger").LOG(p(),c);return J.abrupt("return");case 7:s=i.value,t=s.plaintextHash,u=s.size,v=s.mediaEntryData;if(!(v==null)){J.next=11;break}d("WALogger").LOG(o(),c);return J.abrupt("return");case 11:w=d("WAMediaUtils").decodeMediaEntryData(v);x={chat:f,externalId:c,author:d("WAJids").AUTHOR_ME};y=w.serverMediaType,z=w.mediaKey,A=w.mediaKeyTimestamp,B=w.uploadToken;C=y?d("WAServerMediaType").castToServerMediaType(y):null;if(!(C==null||z==null||A==null||B==null)){J.next=18;break}d("WALogger").LOG(n(),c);return J.abrupt("return");case 18:J.next=20;return b("regeneratorRuntime").awrap(d("WAMediaRetryCrypto").decryptServerErrorReceipt(z,c,h,g));case 20:D=J.sent;E=D.stanzaId;if(!(E==null||E!==c)){J.next=25;break}d("WALogger").LOG(m());return J.abrupt("return");case 25:J.next=27;return b("regeneratorRuntime").awrap(d("WACreateRetrier").createUploadRetrier(C));case 27:F=J.sent;if(F.success){J.next=31;break}d("WALogger").LOG(l());return J.abrupt("return");case 31:G=F.value;J.next=34;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMediaPlaintext(t));case 34:H=J.sent;if(!(H==null)){J.next=38;break}d("WALogger").ERROR(k());return J.abrupt("return");case 38:J.next=40;return b("regeneratorRuntime").awrap(d("WAUploadMedia").encryptAndUploadPlaintext({serverMediaType:C},t,H,z,A,B,u,G,function(a){return d("WAGlobals").getDbImpls().updateMediaEntryForMsg(t,x,function(){return d("WAMediaUtils").encodeMediaEntryForUpload(a)},a.objectId,C)}));case 40:I=J.sent;if(I.success){J.next=44;break}d("WALogger").LOG(j());return J.abrupt("return");case 44:J.next=46;return b("regeneratorRuntime").awrap(r(x,t,c,f));case 46:case"end":return J.stop()}},null,this)};c=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("reuploadMedia",a).end();function r(a,c,e,f){var g,j,k,l,m,n;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:o.next=2;return b("regeneratorRuntime").awrap(d("WAGetDecodedMediaEntry").getDecodedMediaEntry(a,c));case 2:g=o.sent;if(!(g==null)){o.next=6;break}d("WALogger").LOG(i(),a);return o.abrupt("return");case 6:j=g.mediaKey,k=g.directPath;if(!(j==null||k==null)){o.next=10;break}d("WALogger").LOG(h(),a);return o.abrupt("return");case 10:o.next=12;return b("regeneratorRuntime").awrap(d("WAMediaRetryCrypto").encryptMediaRetryNotification(j,e,k));case 12:l=o.sent;m=l.ciphertext;n=l.iv;o.next=17;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendStanzaAndWaitForAck(d("WAWap").wap("notification",{to:d("WAWap").JID(f),from:d("WAWap").DEVICE_JID(d("WAGlobals").getMyDeviceJid()),participant:d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(e),type:"mediaretry"},d("WAWap").wap("encrypt",null,d("WAWap").wap("enc_p",null,m),d("WAWap").wap("enc_iv",null,n))),{id:e,"class":"notification",from:f,participant:null,type:"mediaretry"}));case 17:case"end":return o.stop()}},null,this)}g.reuploadMediaFn=a;g.reuploadMedia=c}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=a.signedPreKeyMixinArgs;a=a.lIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroupArgs;b=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup").mergeLIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroup(d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),b),a)));return b}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"RotateSignedResponseSuccess",value:g.value});case 7:h=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"RotateSignedResponseValidationError",value:h.value});case 10:i=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"RotateSignedResponseRequestError",value:i.value});case 13:j=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"RotateSignedResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:g,ValidationError:h,RequestError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKey",["WACryptoManager","WAErr","WAGlobals","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAPreKeysStanzaUtils","WASmaxPreKeysRotateSignedRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey RPC failed: "," ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey successfully uploaded new skey"]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("rotateSignedPreKey",function(){var a,e,f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("WACryptoManager").generateSignedPreKey(d("WAGlobals").getCryptoManager()));case 2:a=j.sent;j.next=5;return b("regeneratorRuntime").awrap(d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAPreKeysStanzaUtils").makeSignedPreKeyMixin(a),lIDIdentityOrPNIdentityOrFBIDIdentityTypeMixinGroupArgs:{isFBIDIdentityType:!0}}));case 5:e=j.sent;j.t0=e.name;j.next=j.t0==="RotateSignedResponseValidationError"?9:j.t0==="RotateSignedResponseRequestError"?12:j.t0==="RotateSignedResponseServerError"?15:18;break;case 9:f=e.value.errorCode;g=e.value.errorText;return j.abrupt("break",21);case 12:f=e.value.errorRequestErrors.value.code;g=e.value.errorRequestErrors.name;return j.abrupt("break",21);case 15:f=e.value.errorServerErrors.value.code;g=e.value.errorServerErrors.name;return j.abrupt("break",21);case 18:e.name;d("WALogger").LOG(i());return j.abrupt("return");case 21:if(!(f===409)){j.next=25;break}return j.abrupt("return",d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})));case 25:d("WALogger").ERROR(h(),f,g);throw c("WAErr")("rotateSignedPreKey RPC failed: "+f+" "+g);case 27:case"end":return j.stop()}},null,this)}).end();g.rotateSignedPreKey=a}),98);
__d("WASendAppData",["WAGlobals","WAJobDefinitions","WAJobs","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["no other devices"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAppData already sent message"]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a,c,e){var f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.externalId,f=a.args;j.next=3;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().writeOutgoingAppData(c,e.jobStartTime,f));case 3:g=j.sent;if(!(g.type==="already_sent")){j.next=9;break}d("WALogger").LOG(i());return j.abrupt("return",g.devices);case 9:if(!(g.type==="no_devices")){j.next=14;break}d("WALogger").LOG(h());return j.abrupt("return",[]);case 14:g.type;j.next=17;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.sendWrittenAppData(g.appDataExternalId)));case 17:return j.abrupt("return",g.devices);case 18:case"end":return j.stop()}},null,this)}).end();g.sendAppData=a}),98);
__d("WASendEphemeralSettingMsg",["WAErr","WAGlobals","WAJids","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAMsgType","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["send ephemeral setting message: chatJid ",", type ",", externalId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemeral sync response backed off"]);k=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("sendEphemeralSettingMsg",function(a,e,f){var g,m,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:g=a.chatJid,m=a.externalId,n=a.args;if(!n.isForSyncResponse){q.next=8;break}q.next=4;return b("regeneratorRuntime").awrap(d("WAJids").switchOnMsgrChatJidType(g,{user:function(a){return d("WAGlobals").getDbImpls().getSyncResponseBackoffInfoByJid(a)},group:function(){throw c("WAErr")("ChatJid is not supposed to be a group")}}));case 4:e=q.sent;if(!(e.success&&l(f.jobStartTime,e.value))){q.next=8;break}d("WALogger").LOG(k());return q.abrupt("return");case 8:o=n.isForSyncResponse?d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE;q.next=11;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().writeOutgoingMsg(m,g,f.jobStartTime,n,o));case 11:p=q.sent;d("WALogger").LOG(j(),g,o,m);if(!(p.type==="already_sent")){q.next=18;break}d("WALogger").LOG(i());return q.abrupt("return");case 18:if(!(p.type==="missing_thread")){q.next=21;break}d("WALogger").LOG(h());return q.abrupt("return");case 21:q.next=23;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.sendWrittenMsg(p.protocolMsgId,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 23:case"end":return q.stop()}},null,this)}).end();function l(a,b){if(b==null)return!1;var c=b.syncResponseRetries;b=b.syncResponseSentTs;switch(c){case 1:return d("WATimeUtils").happenedWithinAt(a,b,3*60);case 2:return d("WATimeUtils").happenedWithinAt(a,b,15*60);default:return!0}}g.sendEphemeralSettingMsg=a}),98);
__d("WAPushNotificationsSetup",["WAComms","WAWap","WAWapParser"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAWapParser").WapParser)("pushResult",function(a){a.assertAttr("type","result")});function a(a,b,c){return d("WAComms").deprecatedSendIq(d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,xmlns:"urn:xmpp:whatsapp:push",type:"set"},d("WAWap").wap("config",{platform:d("WAWap").CUSTOM_STRING(c),appid:d("WAWap").CUSTOM_STRING(a),deviceid:d("WAWap").CUSTOM_STRING(b)})),h)}g.setupPushNotifications=a}),98);
__d("WASendPushNotificationConfig",["WAJobs","WALogger","WAPushNotificationsSetup","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Push notification setup failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPushNotificationSetup"]);i=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("sendPushNotificationSetup",function(a){var c,e,f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.appId,e=a.deviceId,f=a.platform;d("WALogger").LOG(i());j.next=4;return b("regeneratorRuntime").awrap(d("WAPushNotificationsSetup").setupPushNotifications(c,e,f));case 4:g=j.sent,g.success||d("WALogger").ERROR(h());case 6:case"end":return j.stop()}},null,this)}).end();g.sendPushNotificationSetup=a}),98);
__d("WASendWrittenMsg",["WAAsMessageApplication","WADualSendMsgUtils","WAErr","WAFranking","WAGlobals","WAICDCUtils","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","WAMsgApplication.pb","WAPREList","WAPREMetrics","WAPromiseQueue","WASendMsgUtil","WATimeUtils","encodeProtobuf","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing icdc info."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg encryptAndSend message to chat ",". IsICDCEnabled: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);o=function(){return a};return a}a=24*60*60;var p=new(d("WAPromiseQueue").PromiseQueueMap)();function q(a,e,f){var g,h,i,j,p,q,r,s,u,v,w,x,y,z,A,B,C,D,E,F,G;return b("regeneratorRuntime").async(function(H){while(1)switch(H.prev=H.next){case 0:d("WALogger").LOG(o(),a.originalProtocolMsgId);j=null;e.addPoint("get_msg_for_sending",{string:{type:a.type}});f.addPoint("get_msg_for_sending",{string:{type:a.type}});if(!(typeof a.originalProtocolMsgId.externalId!=="string")){H.next=10;break}e.addPoint("invalid_protocol_msg_id");e.endSuccess();f.addPoint("invalid_protocol_msg_id");f.endSuccess();return H.abrupt("return",{type:"error"});case 10:if(!(a.type==="message")){H.next=16;break}H.next=13;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getMsgForSending(a.originalProtocolMsgId));case 13:j=H.sent;H.next=23;break;case 16:if(!(a.type==="reaction")){H.next=22;break}H.next=19;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().getReactionForSending(a.originalProtocolMsgId));case 19:j=H.sent;H.next=23;break;case 22:throw c("WAErr")("This cannot happen because type has `message` as default argument but flow does not know that");case 23:if(!(j.type!=="unsent")){H.next=28;break}d("WALogger").LOG(n(),j.type);e.endFail(j.type);f.endFail(j.type);return H.abrupt("return",{type:"error"});case 28:p=j,q=p.messageApplication,r=p.messageType,s=p.recipients,u=p.icdcInfo,v=p.contactsSyncInfo,w=p.protocolMsgId,x=p.isDeviceMismatch,y=p.contactsInThread,z=p.isReplyMsg,A=p.isXMAMsg;B=r.type==="text"&&r.invitedParticipantUserJid!=null?s.filter(function(a){return a.user===r.invitedParticipantUserJid||a.user===d("WAGlobals").getMyUserJid()}):s;e.addPoint("message-fetched-from-db",{"int":{recipientsCount:B.length},bool:{isReplyMsg:z,isXMAMsg:A},string:{msgType:r.type}});f.addPoint("message-fetched-from-db",{"int":{recipientsCount:B.length},bool:{isReplyMsg:z,isXMAMsg:A},string:{msgType:r.type}});C=r.type==="text"&&r.invitedParticipantUserJid!=null?r.invitedParticipantUserJid:w.chat;D=d("WAGlobals").getConfig().isICDCEnabled();d("WALogger").LOG(m(),C,D);H.next=37;return b("regeneratorRuntime").awrap(t(v,u,B));case 37:e.addPoint("icdc-processed",{bool:{isICDCEnabled:D}});f.addPoint("icdc-processed",{bool:{isICDCEnabled:D}});E={version:"v3",bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,q).readByteArray())};H.next=42;return b("regeneratorRuntime").awrap(d("WASendMsgUtil").sendMessage({type:"chat",chat:C,recipients:B,externalId:w.externalId,messageBytes:E,messageType:r,protocolMsgId:w,icdcInfo:u,frankingKey:((g=q.metadata)==null?void 0:g.frankingKey)?d("WAFranking").castToFrankingKey(new Uint8Array((h=q.metadata)==null?void 0:h.frankingKey)):null,frankingVersion:(i=q.metadata)==null?void 0:i.frankingVersion,deviceIdentity:null},e,f));case 42:F=H.sent;F.type==="error"?(e.endFail(F.type),f.endFail(F.type),d("WALogger").ERROR(l(),F.type)):(e.endSuccess(),f.endSuccess(),d("WALogger").LOG(k(),F.type));if(!(x===!0&&y!=null)){H.next=48;break}G=new Set(y);H.next=48;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(G,"miss-recipient-in-sendWrittenMsg",!0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 48:return H.abrupt("return",F);case 49:case"end":return H.stop()}},null,this)}e=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a,b,c){var e=a.protocolMsgId,f=a.type,g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SEND_MESSAGE,{bool:{afterCrash:c.afterCrash,isSenderKeyPredistriubtionEnabled:d("WAGlobals").getConfig().isSenderKeyPredistributionEnabled(),isSmartSenderKeyRotationEnabled:d("WAGlobals").getConfig().isSmartSenderKeyRotationEnabled()},"int":{isDualSend:d("WADualSendMsgUtils").isDualSendJid(e.chat)?1:0}},void 0,{string:{jid:e.chat}}),h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.TEST_MAW_WA_SEND_MESSAGE,{bool:{afterCrash:c.afterCrash,isSenderKeyPredistriubtionEnabled:d("WAGlobals").getConfig().isSenderKeyPredistributionEnabled(),isSmartSenderKeyRotationEnabled:d("WAGlobals").getConfig().isSmartSenderKeyRotationEnabled()},"int":{isDualSend:d("WADualSendMsgUtils").isDualSendJid(e.chat)?1:0}});return p.enqueue(e.chat,function(){return q({originalProtocolMsgId:e,type:f},g,h)})},stopRetryIf:{timePassedSeconds:a,onStopRetry:function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.protocolMsgId;d("WALogger").LOG(j(),c);f.next=4;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().markMsgDropped(c));case 4:e=f.sent;d("WALogger").LOG(i(),c,e);return f.abrupt("return",{type:"error"});case 7:case"end":return f.stop()}},null,this)}}}).end();var r=4*d("WATimeUtils").HOUR_SECONDS;function s(a){return a==null?!0:!d("WATimeUtils").happenedWithin(a,r)}function t(a,b,c){if(!d("WAGlobals").getConfig().isICDCEnabled())return;var e=new Map();a.forEach(function(a){return e.set(a.user,a)});var f=new Set(),g=d("WAGlobals").getMyUserJid();a=b.find(function(a){return a.user===g});(a==null||d("WAICDCUtils").isICDCIndexInvalid(a))&&f.add(g);c.forEach(function(a){a=a.user;var b=e.get(a);b=b==null||s(b.lastSyncTs);b&&f.add(a)});if(f.size>0){d("WALogger").LOG(h());return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getDevices(f,"missing-icdc-info",!0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH}))}}g.sendWrittenMsgImplementation=q;g.sendWrittenMsg=e}),98);
__d("WASmaxInGroupsIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","406");return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsNotAcceptableMixin",["WASmaxInGroupsIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!b.success)return b;a=d("WASmaxInGroupsIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(b.value);return!a.success?a:a}g.parseNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsSetSubjectClientErrors",["WAResultOrError","WASmaxInGroupsFallbackClientMixin","WASmaxInGroupsGroupDoesNotExistMixin","WASmaxInGroupsGroupIsSuspendedMixin","WASmaxInGroupsInvalidParticipantJIDMixin","WASmaxInGroupsMalformedStanzaMixin","WASmaxInGroupsNotAcceptableMixin","WASmaxInGroupsRateLimitedMixin","WASmaxInGroupsUnsupportedOperationMixin","WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin","WASmaxInGroupsUserIsNotAParticipantMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsUnsupportedOperationMixin").parseUnsupportedOperationMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"UnsupportedOperation",value:b.value});var c=d("WASmaxInGroupsInvalidParticipantJIDMixin").parseInvalidParticipantJIDMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"InvalidParticipantJID",value:c.value});var e=d("WASmaxInGroupsMalformedStanzaMixin").parseMalformedStanzaMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"MalformedStanza",value:e.value});var f=d("WASmaxInGroupsGroupDoesNotExistMixin").parseGroupDoesNotExistMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"GroupDoesNotExist",value:f.value});var g=d("WASmaxInGroupsUserDoesNotHaveAdminPermissionMixin").parseUserDoesNotHaveAdminPermissionMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"UserDoesNotHaveAdminPermission",value:g.value});var h=d("WASmaxInGroupsUserIsNotAParticipantMixin").parseUserIsNotAParticipantMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"UserIsNotAParticipant",value:h.value});var i=d("WASmaxInGroupsNotAcceptableMixin").parseNotAcceptableMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"NotAcceptable",value:i.value});var j=d("WASmaxInGroupsGroupIsSuspendedMixin").parseGroupIsSuspendedMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"GroupIsSuspended",value:j.value});var k=d("WASmaxInGroupsRateLimitedMixin").parseRateLimitedMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"RateLimited",value:k.value});var l=d("WASmaxInGroupsFallbackClientMixin").parseFallbackClientMixin(a);return l.success?d("WAResultOrError").makeResult({name:"FallbackClient",value:l.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["UnsupportedOperation","InvalidParticipantJID","MalformedStanza","GroupDoesNotExist","UserDoesNotHaveAdminPermission","UserIsNotAParticipant","NotAcceptable","GroupIsSuspended","RateLimited","FallbackClient"],[b,c,e,f,g,h,i,j,k,l])}g.parseSetSubjectClientErrors=a}),98);
__d("WASmaxInGroupsSetSubjectResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsSetSubjectClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!c.success)return c;b=d("WASmaxInGroupsSetSubjectClientErrors").parseSetSubjectClientErrors(a);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},c.value,{setSubjectClientErrors:b.value}))}g.parseSetSubjectResponseClientError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseServerError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseSuccess",["WASmaxInGroupsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseSuccess=a}),98);
__d("WASmaxOutGroupsSetSubjectChangeSubjectMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.subjectElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("subject",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSetSubjectChangeSubjectMixin=a}),98);
__d("WASmaxOutGroupsSetSubjectRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WASmaxOutGroupsSetSubjectChangeSubjectMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutGroupsSetSubjectChangeSubjectMixin").mergeSetSubjectChangeSubjectMixin(d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null),a),a);return a}g.makeSetSubjectRequest=a}),98);
__d("WASmaxGroupsSetSubjectRPC",["WAComms","WASmaxInGroupsSetSubjectResponseClientError","WASmaxInGroupsSetSubjectResponseServerError","WASmaxInGroupsSetSubjectResponseSuccess","WASmaxOutGroupsSetSubjectRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsSetSubjectRequest").makeSetSubjectRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsSetSubjectResponseSuccess").parseSetSubjectResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"SetSubjectResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsSetSubjectResponseClientError").parseSetSubjectResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"SetSubjectResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsSetSubjectResponseServerError").parseSetSubjectResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"SetSubjectResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetSubject",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendSetSubjectRPC=a}),98);
__d("WASetGroupSubject",["WAJobs","WALogger","WAResultOrError","WASmaxGroupsSetSubjectRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to change subject: ",""]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("sendSetSubjectRPC",function(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=a.group,e=a.subject;g.next=3;return b("regeneratorRuntime").awrap(d("WASmaxGroupsSetSubjectRPC").sendSetSubjectRPC({iqTo:c,subjectElementValue:e}));case 3:f=g.sent;if(!(f.name==="SetSubjectResponseSuccess")){g.next=6;break}return g.abrupt("return",d("WAResultOrError").makeResult());case 6:f.name;d("WALogger").ERROR(h(),f.name);return g.abrupt("return",d("WAResultOrError").makeError(f.name));case 9:case"end":return g.stop()}},null,this)}).end();g.setGroupSubject=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","400");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","501");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[b,c])}g.parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup=a}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup").parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrFeatureNotImplementedMixinGroup:b.value}))}g.parseGetExperimentConfigResponseErrorNoRetry=a}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","500");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseGetExperimentConfigResponseErrorRetry=a}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"config_code",1,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"config_value");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"config_expo_key",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({configCode:b.value,configValue:c.value,configExpoKey:a.value})}g.parseExperimentConfigMixin=a}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"event_code",1,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"sampling_weight",-1e4,1e4);return!a.success?a:d("WAResultOrError").makeResult({eventCode:b.value,samplingWeight:a.value})}g.parseSamplingConfigMixin=a}),98);
__d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ExperimentConfig",value:b.value});var c=d("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(a);return c.success?d("WAResultOrError").makeResult({name:"SamplingConfig",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ExperimentConfig","SamplingConfig"],[b,c])}g.parseExperimentOrSamplingConfigMixinGroup=a}),98);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup").parseExperimentOrSamplingConfigMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({experimentOrSamplingConfigMixinGroup:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"props");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"protocol","1");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"ab_key");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"hash");if(!g.success)return g;var i=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh",0,void 0);if(!i.success)return i;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh_id",0,void 0);if(!j.success)return j;a=d("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"prop",0,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({propsProtocol:e.value,propsAbKey:f.value,propsHash:g.value,propsRefresh:i.value,propsRefreshId:j.value},a.value,{propsProp:b.value}))}g.parseGetExperimentConfigResponseSuccessPropsProp=h;g.parseGetExperimentConfigResponseSuccess=a}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"abt",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("props",{protocol:"1",hash:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeGetExperimentConfigRequest=a}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetExperimentConfigResponseSuccess",value:g.value});case 7:h=d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorNoRetry",value:h.value});case 10:i=d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorRetry",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:g,ErrorNoRetry:h,ErrorRetry:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetExperimentConfigRPC=a}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""]);h=function(){return a};return a}function a(a){var c,e,f,g,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(d("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC({propsHash:a}));case 2:c=m.sent;if(!(c.name==="GetExperimentConfigResponseSuccess")){m.next=6;break}e=c.value,f=e.propsAbKey,g=e.propsHash,j=e.propsRefresh,k=e.propsRefreshId,l=e.propsProp;return m.abrupt("return",d("WAResultOrError").makeResult({abKey:f,hash:g,refresh:j,refreshId:k,props:i(l)}));case 6:d("WALogger").WARN(h(),c.value);return m.abrupt("return",d("WAResultOrError").makeError());case 8:case"end":return m.stop()}},null,this)}function i(a){var b=[];a.forEach(function(a){a=a.experimentOrSamplingConfigMixinGroup;if(a.name==="ExperimentConfig"){b.push({configCode:a.value.configCode,configValue:a.value.configValue,configExpoKey:(a=a.value.configExpoKey)==null?void 0:a.toString()})}});return b}g.getAbPropsProtocol=a}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"]);k=function(){return a};return a}c=d("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},a);function a(a){var b=a.sendHash;b=b===void 0?!0:b;var c=a.eventFlow;c==null?void 0:c.addPoint("sync_ab_props",{bool:{sendHash:b}});return b==null||b===!1?l(null,c):d("WAAbProps").getHash().then(function(a){return l(a,c)})}e=a;function l(a,c){var e,f,g,h,i,l,n,o,p;return b("regeneratorRuntime").async(function(q){while(1)switch(q.prev=q.next){case 0:c==null?void 0:c.addPoint("fetch_ab_props");q.next=3;return b("regeneratorRuntime").awrap(d("WAGetAbPropsProtocol").getAbPropsProtocol(a));case 3:e=q.sent;if(e.success){q.next=8;break}d("WALogger").ERROR(k());q.next=15;break;case 8:f=e.value,g=f.abKey,h=f.hash,i=f.refresh,l=f.props;n=d("WAAbPropsHelpers").parseAbProps(d("WAAbProps").getConfig(),l);c==null?void 0:c.addPoint("save_ab_props");q.next=13;return b("regeneratorRuntime").awrap(m(g,h,i,n));case 13:o=q.sent,o.success===!1&&(o.error,d("WALogger").LOG(j()));case 15:q.next=17;return b("regeneratorRuntime").awrap(d("WAAbProps").getRefreshSecs());case 17:p=q.sent;return q.abrupt("return",{seconds:p});case 19:case"end":return q.stop()}},null,this)}function m(a,c,e,f){var g,j,k,l,m,n,o,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:v.next=2;return b("regeneratorRuntime").awrap(d("WAAbProps").getAbProps());case 2:k=v.sent;l={abKey:(g=a)!=null?g:k.abKey,hash:(j=c)!=null?j:k.hash,refresh:d("WAAbPropsHelpers").maybeUpdateRefresh(e),lastSyncTime:d("WATimeUtils").unixTime(),propValues:k.propValues,propExpoKeys:k.propExpoKeys,internalExpoKeys:k.internalExpoKeys,expoKeyStr:k.expoKeyStr};if(!(c==null)){v.next=9;break}v.next=7;return b("regeneratorRuntime").awrap(d("WAAbProps").setAbProps(l));case 7:d("WALogger").LOG(i());return v.abrupt("return",d("WAResultOrError").makeError("noHash"));case 9:d("WALogger").LOG(h());m=f.values,n=f.expoKeys;o=d("WAAbPropsHelpers").maybeUpdatePropValues(m,k.propValues,d("WAAbProps").getConfig());p=d("WAAbPropsHelpers").maybeUpdateExpoKeys(n,k.propExpoKeys,d("WAAbProps").getConfig()),q=p.propExpoKeys,r=p.expoKeysToDelete;u=d("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(r,k.internalExpoKeys);u!=null&&(s=u.internalExpoKeys,t=u.expoKeyStr);v.next=17;return b("regeneratorRuntime").awrap(d("WAAbProps").setAbProps(babelHelpers["extends"]({},l,{propValues:o,propExpoKeys:q,internalExpoKeys:s,expoKeyStr:t})));case 17:return v.abrupt("return",d("WAResultOrError").makeResult());case 18:case"end":return v.stop()}},null,this)}g.syncAbProps=c;g.syncAbPropsDebug=e}),98);
__d("WASyncAbProps",["WAAbPropsSync","WAJobs","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("syncAbProps",{code:function(a,c,e){return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.sendHash;d("WALogger").LOG(h());f.next=4;return b("regeneratorRuntime").awrap(d("WAAbPropsSync").syncAbProps({sendHash:c,eventFlow:e==null?void 0:e.eventFlow}));case 4:case"end":return f.stop()}},null,this)}}).end();g.syncAbProps=a}),98);
__d("WASyncdSyncAllCollections",["WAJobs","WALogger","WASyncd","WASyncdConst"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: periodic sync for all collection"]);h=function(){return a};return a}a=d("WAJobs").getPersistedJobsApi().definePersistedJob().finalStep("syncAllCollections",function(){d("WALogger").LOG(h());return i()}).end();function i(){var a=Array.from(d("WASyncdConst").CollectionName.members());return d("WASyncd").markCollectionsForSync(a)}g.syncdSyncAllCollections=a;g.syncdSyncAllCollectionsFn=i}),98);
__d("MAWJobHandlers",["MAWAcceptGroupInvite","MAWBackupMessageWithMedia","MAWDeleteMsgsForMe","MAWDeleteThread","MAWDownloadAndHandleMedia","MAWDownloadAndRestoreMedia","MAWForwardMsg","MAWGetCurrentUserDeviceList","MAWGetSpams","MAWHandleFutureProofMsg","MAWLinkReactionsToMsgs","MAWMarkThreadAsRead","MAWReportUserSpam","MAWRequestUploadMedia","MAWResendWrittenAppData","MAWRestoreMessagesFromEncryptedBackups","MAWRestoreThreadsFromEncryptedBackups","MAWRevokeMsg","MAWSendGroupInviteMsg","MAWSendMediaMsg","MAWSendMsg","MAWSendReactionMsg","MAWSendWrittenAppData","MAWSendXMAShareMsg","MAWUpdateBackupEntFbidForMedia","MAWUploadMessagesBackup","MAWUploadRetroactiveMessageBatch","MAWUploadRetroactiveThreadsAndMessages","MAWUploadRetryStatusUtil","WAAddGroupParticipants","WAComputeAndUploadICDCInfo","WACreateGroup","WADeleteGroups","WADemoteGroupParticipants","WAGenerateAndUploadPreKeys","WAGetDevices","WAHandleSpamMsg","WALeaveGroups","WANotifyDeviceChange","WAPromoteGroupParticipants","WAQueryGroups","WARemoveDevice","WARemoveGroupParticipants","WARequestAllSyncdMissingKeys","WARequestPreKeyDigest","WAReuploadMedia","WARotateSignedPreKey","WASendAppData","WASendEphemeralSettingMsg","WASendPushNotificationConfig","WASendWrittenMsg","WASetGroupSubject","WASyncAbProps","WASyncdSyncAllCollections"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{acceptGroupInvite:d("MAWAcceptGroupInvite").acceptGroupInvite,addGroupParticipants:d("WAAddGroupParticipants").addGroupParticipants,backupMessageWithMedia:d("MAWBackupMessageWithMedia").backupMessageWithMedia,computeAndUploadICDCInfo:d("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo,createGroup:d("WACreateGroup").createGroup,deleteGroups:d("WADeleteGroups").deleteGroups,deleteMsgsForMe:d("MAWDeleteMsgsForMe").deleteMsgsForMe,deleteThread:d("MAWDeleteThread").deleteThread,demoteGroupParticipants:d("WADemoteGroupParticipants").demoteGroupParticipants,downloadAndHandleMedia:d("MAWDownloadAndHandleMedia").downloadAndHandleMedia,downloadAndRestoreMedia:d("MAWDownloadAndRestoreMedia").downloadAndRestoreMedia,forwardMsg:d("MAWForwardMsg").forwardMsg,generateAndUploadPreKeys:d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys,getCurrentUserDeviceList:d("MAWGetCurrentUserDeviceList").getCurrentUserDeviceList,getDevices:d("WAGetDevices").getDevices,getSpams:d("MAWGetSpams").getSpams,handleFutureproofMsg:d("MAWHandleFutureProofMsg").handleFutureproofMsg,handleSpamMsg:d("WAHandleSpamMsg").handleSpamMsg,leaveGroups:d("WALeaveGroups").leaveGroups,linkReactionsToMsgs:d("MAWLinkReactionsToMsgs").linkReactionsToMsgs,markThreadAsRead:d("MAWMarkThreadAsRead").markThreadAsRead,notifyDeviceChange:d("WANotifyDeviceChange").notifyDeviceChange,postBackupWriteCompletionHook:d("MAWUploadRetryStatusUtil").postBackupWriteCompletionHook,promoteGroupParticipants:d("WAPromoteGroupParticipants").promoteGroupParticipants,queryGroups:d("WAQueryGroups").queryGroups,removeDevice:d("WARemoveDevice").removeDeviceJob,removeGroupParticipants:d("WARemoveGroupParticipants").removeGroupParticipants,reportUserSpam:d("MAWReportUserSpam").reportUserSpam,requestAllSyncdMissingKeys:d("WARequestAllSyncdMissingKeys").requestAllSyncdMissingKeys,requestPreKeyDigest:d("WARequestPreKeyDigest").requestPreKeyDigest,requestReuploadMedia:d("MAWRequestUploadMedia").requestReuploadMedia,resendWrittenAppData:d("MAWResendWrittenAppData").resendWrittenAppData,restoreMessagesFromEncryptedBackups:d("MAWRestoreMessagesFromEncryptedBackups").restoreMessagesFromEncryptedBackups,restoreThreadsFromEncryptedBackups:d("MAWRestoreThreadsFromEncryptedBackups").restoreThreadsFromEncryptedBackups,reuploadMedia:d("WAReuploadMedia").reuploadMedia,revokeMsgs:d("MAWRevokeMsg").revokeMsgs,rotateSignedPreKey:d("WARotateSignedPreKey").rotateSignedPreKey,sendAppData:d("WASendAppData").sendAppData,sendEphemeralSettingMsg:d("WASendEphemeralSettingMsg").sendEphemeralSettingMsg,sendGroupInviteMsg:d("MAWSendGroupInviteMsg").sendGroupInviteMsg,sendMediaMsg:d("MAWSendMediaMsg").sendMediaMsg,sendMsg:d("MAWSendMsg").sendMsg,sendPushNotificationSetup:d("WASendPushNotificationConfig").sendPushNotificationSetup,sendReactionMsg:d("MAWSendReactionMsg").sendReactionMsg,sendWrittenAppData:d("MAWSendWrittenAppData").sendWrittenAppData,sendWrittenMsg:d("WASendWrittenMsg").sendWrittenMsg,sendXMAShareMsg:d("MAWSendXMAShareMsg").sendXMAShareMsg,setGroupSubject:d("WASetGroupSubject").setGroupSubject,syncAbProps:d("WASyncAbProps").syncAbProps,syncdSyncAllCollections:d("WASyncdSyncAllCollections").syncdSyncAllCollections,updateBackupEntFbidForMedia:d("MAWUpdateBackupEntFbidForMedia").updateBackupEntFbidForMedia,uploadMessagesBackup:d("MAWUploadMessagesBackup").uploadMessagesBackup,uploadRetroactiveMessageBatch:d("MAWUploadRetroactiveMessageBatch").uploadRetroactiveMessageBatch,uploadRetroactiveThreadsAndMessages:d("MAWUploadRetroactiveThreadsAndMessages").uploadRetroactiveThreadsAndMessages}}g.getJobHandlers=a}),98);
__d("MAWPREListeners",["MAWBridge","MAWQplProxy","WALogger","WAOdsEnums","WAPREList","WAPREMetrics","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the event"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was failed already"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed already"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot RESUME without instanceKey"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA PRE implementation sends duplicated instance ids on START stage. ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the ODS event"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ODS event "," shouldn't have "," stage"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Event "," not implemented"]);p=function(){return a};return a}function a(){d("WAPREMetrics").subscribe(s)}var q=new Map(),r=new Map();function s(a){switch(a.name){case d("WAPREList").PRE_METRIC.DELETE_THREAD:u(c("qpl")._(1056845732,"691"),a);break;case d("WAPREList").PRE_METRIC.SAVE_SIGNAL_SESSION_RETRIES:u(c("qpl")._(25309040,"8112"),a);break;case d("WAPREList").PRE_METRIC.FRANKING_VALIDATION:u(c("qpl")._(25299246,"150"),a);break;case d("WAPREList").PRE_METRIC.RETRY_RECEIPTS_SENT:u(c("qpl")._(25301644,"165"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUPS:u(c("qpl")._(25304433,"6303"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUP:u(c("qpl")._(25310326,"6339"),a);break;case d("WAPREList").PRE_METRIC.OFFLINE_RETRY:u(c("qpl")._(25309990,"124"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD:u(c("qpl")._(25312150,"83"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_UPLOAD:u(c("qpl")._(25313100,"131"),a);break;case d("WAPREList").PRE_METRIC.GET_DEVICES:u(c("qpl")._(25307483,"127"),a);break;case d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION:u(c("qpl")._(25306682,"11176"),a);break;case d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL:u(c("qpl")._(25307464,"300"),a);break;case d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION:u(c("qpl")._(25299294,"12933"),a);break;case d("WAPREList").PRE_METRIC.OFFLINE_QUEUE:u(c("qpl")._(25306361,"5664"),a);break;case d("WAPREList").PRE_METRIC.SAVE_SESSION_RETRIES:u(c("qpl")._(25309040,"8112"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_FATAL_ERROR:u(c("qpl")._(25310891,"540"),a);break;case d("WAPREList").PRE_METRIC.SEND_MESSAGE:u(c("qpl")._(25304093,"753"),a);break;case d("WAPREList").PRE_METRIC.CREATE_GROUP:u(c("qpl")._(25307987,"970"),a);break;case d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS:u(c("qpl")._(25312342,"971"),a);break;case d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE:u(c("qpl")._(1056840931,"814"),a);break;case d("WAPREList").PRE_METRIC.TEST_RECEIVE_MESSAGE:u(c("qpl")._(1056835450,"1140"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_EVENT:u(c("qpl")._(25311142,"804"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE:u(c("qpl")._(25308084,"807"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:u(c("qpl")._(25300196,"808"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_DECRYPT_MUTATIONS:u(c("qpl")._(25305739,"809"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED:u(c("qpl")._(25300822,"810"),a);break;case d("WAPREList").PRE_METRIC.SYNCD:u(c("qpl")._(25308683,"812"),a);break;case d("WAPREList").PRE_METRIC.APP_STATE_SYNC_DAILY:u(c("qpl")._(25306941,"813"),a);break;case d("WAPREList").PRE_METRIC.WA_FAILURE_STANZA:u(c("qpl")._(25299391,"190"),a);break;case d("WAPREList").PRE_METRIC.ICDC_ERROR:u(c("qpl")._(25313187,"948"),a);break;case d("WAPREList").PRE_METRIC.WA_DISCONNECT:t(d("WAOdsEnums").Entity.WA_DISCONNECT,a);break;case d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR:u(c("qpl")._(25311870,"1004"),a);break;case d("WAPREList").PRE_METRIC.WA_JOB_MANAGER:u(c("qpl")._(25308825,"136"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_KEY_ROTATION:u(c("qpl")._(25304909,"1204"),a);break;case d("WAPREList").PRE_METRIC.TEST_MAW_ENCRYPT_MESSAGE:u(c("qpl")._(25306602,"1022"),a);break;case d("WAPREList").PRE_METRIC.TEST_MAW_WA_SEND_MESSAGE:u(c("qpl")._(25303259,"1208"),a);break;case d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER:break;case d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT:d("WALogger").ERROR(p(),a.name);break}}function t(a,b){var c;switch(b.stage){case"START":break;case"RESUME":case"POINT":d("WALogger").ERROR(o(),a,b);break;case"SUCCESS":d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:a,key:(c=(c=b.annotations)==null?void 0:(c=c.string)==null?void 0:c.key)!=null?c:"success"},!0);break;case"FAIL":d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:a,key:b.reason},!0);break;default:d("WALogger").ERROR(n());break}}function u(a,b){switch(b.stage){case"START":if(q.has(b.instanceKey)){d("WALogger").ERROR(m(),b.name);return}var c=d("MAWQplProxy").startQplUserFlow(a,b.annotations);q.set(b.instanceKey,c);b.nonTrackableAnnotations!=null&&r.set(b.instanceKey,b.nonTrackableAnnotations);break;case"RESUME":if(b.instanceKey==null){d("WALogger").ERROR(l());return}if(q.has(b.instanceKey))return;c=d("MAWQplProxy").startQplUserFlow(a,b.annotations,b.instanceKey);q.set(b.instanceKey,c);break;case"POINT":a=q.get(b.instanceKey);if(a==null){d("WALogger").WARN(k(),b.name);return}a.addPoint(b.reason,b.annotations);break;case"SUCCESS":c=q.get(b.instanceKey);if(c==null){d("WALogger").WARN(j(),b.name);return}a=r.get(b.instanceKey);a!=null&&r["delete"](b.instanceKey);c.endSuccess(b.annotations,a);q["delete"](b.instanceKey);break;case"FAIL":c=q.get(b.instanceKey);if(c==null){d("WALogger").WARN(i(),b.name);return}a=r.get(b.instanceKey);a!=null&&r["delete"](b.instanceKey);c.endFail(b.reason,b.annotations,a);q["delete"](b.instanceKey);break;default:d("WALogger").ERROR(h());break}}g.initializeWAPREMetrics=a}),98);
__d("MAWCollectionVersionStore",["MAWDbCollectionVersions","MAWDbCollectionVersionsTxns","MAWDexieCastToPromise","MAWTransactionMode","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempted to update non-existing collection ",""]);h=function(){return a};return a}a=function(){function a(a){this.db=a}var c=a.prototype;c.get=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbCollectionVersionsTxns").getCollectionVersionByCollection(this.db,a)));case 2:c=e.sent;if(!(c==null)){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",d("MAWDbCollectionVersions").convertFromDbCollectionVersion(c));case 6:case"end":return e.stop()}},null,this)};c.bulkGet=function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.collectionVersions.where("collection").anyOf(a).toArray()));case 2:c=f.sent;e=new Map();c.map(function(a){return e.set(a.collection,d("MAWDbCollectionVersions").convertFromDbCollectionVersion(a))});return f.abrupt("return",a.map(function(a){return e.get(a)}));case 6:case"end":return f.stop()}},null,this)};c.getAll=function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.collectionVersions.toArray()));case 2:a=c.sent;return c.abrupt("return",a.map(d("MAWDbCollectionVersions").convertFromDbCollectionVersion));case 4:case"end":return c.stop()}},null,this)};c.update=function(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.collectionVersions.where("collection").equals(a).modify(function(a){Object.assign(a,c)})));case 2:e=f.sent,e<1&&d("WALogger").WARN(h(),a);case 4:case"end":return f.stop()}},null,this)};c.bulkUpdate=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:c=new Map(a.map(function(a){return[a.collection,a]}));d.next=3;return b("regeneratorRuntime").awrap(this.db.collectionVersions.where("collection").anyOf(Array.from(c.keys())).modify(function(a){Object.assign(a,c.get(a.collection)),c["delete"](a.collection)}));case 3:d.next=5;return b("regeneratorRuntime").awrap(this.db.collectionVersions.bulkAdd(Array.from(c.values())));case 5:case"end":return d.stop()}},null,this)};c.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.collectionVersions.clear())};return a}();a.tableLocks={collectionVersions:d("MAWTransactionMode").READWRITE};g.MAWCollectionVersionStore=a}),98);
__d("MAWContactStore",["MAWBridge","MAWDbIdentityTxns","MAWDexieCastToPromise","MAWDexieTable","MAWTransactionMode","WAHasProperty","WAOdsEnums","WAResultOrError","zip"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.contacts.get(a).then(b.$1))};this.bulkGet=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.contacts.bulkGet(a).then(function(a){return d("MAWDexieTable").dexieAll(a.map(b.$1))}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.contacts.bulkGet(a.map(function(a){a=a.contactJid;return a})).then(function(b){return c("zip")(a,b).map(function(a){var b,d=a[0];a=a[1];return{contact:babelHelpers["extends"]({},a,{contactJid:d.contactJid,devices:d.identities.map(function(a){return a.device}),dhash:c("WAHasProperty")(d,"dhash")?d.dhash:a==null?void 0:a.dhash,ephemeralSetting:d.ephemeralSetting?{ephemeralExpirationInSec:d.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:d.ephemeralSetting.updatedTs}:a==null?void 0:a.ephemeralSetting,ephemeralSyncResponseBackoffInfo:(b=d.ephemeralSyncResponseBackoffInfo)!=null?b:a==null?void 0:a.ephemeralSyncResponseBackoffInfo,icdcFails:(b=d.icdcFails)!=null?b:a==null?void 0:a.icdcFails,icdcInfo:(b=d.icdcInfo)!=null?b:a==null?void 0:a.icdcInfo,lastSyncTs:(b=d.lastSyncTs)!=null?b:a==null?void 0:a.lastSyncTs,nameForSearch:(b=d.nameForSearch)!=null?b:a==null?void 0:a.nameForSearch}),newContactIdentities:d.identities.map(function(a){return{deviceJid:a.device,identity:a.identity,userJid:d.contactJid}}),oldContactIdentities:(a==null?void 0:a.devices)||[]}})}).then(function(a){return d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.contact,e=a.newContactIdentities,f=a.oldContactIdentities;return d("MAWDbIdentityTxns").compareIdentityMismatch(b.db,e).then(function(a){a&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"contact_store_identity_mismatch"});return b.db.contacts.put(c).then(function(){return b.db.identity.bulkDelete(f)}).then(function(){return d("MAWDbIdentityTxns").bulkPutIdentities(b.db,e)})})})).then(function(){})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.contacts.clear())};this.$1=function(a){return a!=null?d("MAWDbIdentityTxns").getIdentitiesForUser(b.db,a.contactJid).then(function(b){b=b.map(function(a){return{id:a.deviceJid,identity:a.identity}});return d("WAResultOrError").makeResult(h(a,b))}):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"))};this.db=a};a.tableLocks={contacts:d("MAWTransactionMode").READWRITE,deviceChangeAlerts:d("MAWTransactionMode").READWRITE,identity:d("MAWTransactionMode").READWRITE};function h(a,b){return{contactJid:a.contactJid,dhash:a.dhash,ephemeralSetting:a.ephemeralSetting?{expirationTs:a.ephemeralSetting.ephemeralExpirationInSec,updatedTs:a.ephemeralSetting.ephemeralLastUpdatedOrSetTimestamp}:void 0,ephemeralSyncResponseBackoffInfo:a.ephemeralSyncResponseBackoffInfo,icdcFails:a.icdcFails,icdcInfo:a.icdcInfo,identities:b.map(function(a){return{device:a.id,identity:a.identity}}),lastSyncTs:a.lastSyncTs,nameForSearch:a.nameForSearch}}g.MAWContactsStore=a}),98);
__d("MAWGroupInfoStore",["MAWBridgeTypes","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGating","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WADualSendMsgUtils","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getOrRepairGroupThreadByJid(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1).then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a,f.chatId);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedGroupInfo(g)})}).then(function(){return f.newestMsg!=null?d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(b.db,f.chatId,f.newestMsg,10,!0):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.chatId]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):b.db.threads["delete"](a.chatId).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a,f.chatId);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWGating").isOccamadillo()&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypes").createBridgeUpdateE2EEMetadataParticipants(f.chatId,d("WADualSendMsgUtils").isDualSendJid(f.jid))});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a,b){var c=a.subject.content;c!=null&&c.length===0&&(c=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,name:c,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion,threadId:b}}g.MAWGroupInfoStore=a}),98);
__d("MAWGetExpiredMsgs",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){var b=a.author,c=a.externalId;a=a.threadJid;return a==null?null:{author:b,chat:a,externalId:c}}).filter(Boolean)})}g.getExpiredMsgs=a}),98);
__d("MAWMessageStore",["MAWAckLevel","MAWAdminMsgTxnsUtils","MAWAuthor","MAWBridgeMsg","MAWBridgeTypes","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGating","MAWGetExpiredMsgs","MAWIndexedDb","MAWLocalizationUtils","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WADualSendMsgUtils","WAJids","WALogger","WAMsgType","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);h=function(){return a};return a}function i(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function j(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function k(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}function l(a){return a!=null&&typeof a==="object"&&a.unknownNameJids!=null&&Array.isArray(a.unknownNameJids)?a.unknownNameJids.filter(function(a){return a!=null}):[]}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=i(b),g=j(b),h=k(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,h).then(function(h){if(h==null)return d("WAResultOrError").makeError({type:"missing_thread"});var i=h.thread;if(a.type===d("WAMsgType").MSG_TYPE.TEXT){h=void 0;d("MAWGating").isEphemeralMessagesEnabled()&&a.ephemeralSetting!=null&&(h={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});var j=d("MAWDbMsg").craftMsgId(i.chatId,i.nextInChatMsgId);h={ack:a.ack,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:a.id.author,ephemeralSetting:h,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((h=a.msgContent)==null?void 0:h.content)||""},msgId:j,thread:i.chatId,threadJid:i.jid,ts:a.ts,type:d("WAMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("WAMsgType").MSG_TYPE.ICDC_ALERT){j=d("MAWDbMsg").craftMsgId(i.chatId,i.nextInChatMsgId);h={ack:a.ack,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},msgId:j,thread:i.chatId,threadJid:i.jid,ts:a.ts,type:d("WAMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&(d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]}),d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:d("MAWBridgeTypes").createBridgeBumpedThreadServer(i.chatId,d("WADualSendMsgUtils").isDualSendJid(i.jid),d("WATimeUtils").castUnixTimeToMillisTime(a.ts),!1)}));return d("WAResultOrError").makeResult()})}else if(a.type===d("WAMsgType").MSG_TYPE.ADMIN){j=d("MAWDbMsg").craftMsgId(i.chatId,i.nextInChatMsgId);h={ack:a.ack,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),msgId:j,thread:i.chatId,threadJid:i.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,h,i).then(function(){var a=l(b);a.length>0&&d("MAWAdminMsgTxnsUtils").afterTransactionFetchContactsNames(a)}).then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.thread===e.chatId&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.thread===e.chatId&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;d("MAWGating").isEphemeralMessagesEnabled()&&a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;var h=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);g=h!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{lastReadMsgTs:h,newestMsgTs:h,threadOrder:d("MAWDbThread").craftThreadOrder(h,e.jid)})).then(function(){f.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&f.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:d("MAWBridgeTypes").createBridgeBumpedThreadServer(e.chatId,d("WADualSendMsgUtils").isDualSendJid(e.jid),h,!1)})}):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),g]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkGetExpiredMsgIds=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetExpiredMsgs").getExpiredMsgs(this.db))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(h(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){a=a.msgs;var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("MAWMetaInfoStore",["MAWBridge","MAWDexieCastToPromise","MAWTransactionMode","Promise","SignalDbTypes","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){a=a.edgeInfo;if(a==null)throw c("err")("EdgeInfo was null when trying to set")};e=function(a){a=a.clockSkew;d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ClockSkewUpdated",value:a}]})};var h=(f={},f[d("SignalDbTypes").MetaKeysEnum.edgeInfo]=a,f),i=(a={},a[d("SignalDbTypes").MetaKeysEnum.clockSkew]=e,a),j=function(a){};function k(a){switch(a){case d("SignalDbTypes").MetaKeysEnum.deviceUUID:case d("SignalDbTypes").MetaKeysEnum.deviceId:case d("SignalDbTypes").MetaKeysEnum.regId:case d("SignalDbTypes").MetaKeysEnum.identityKeyPair:case d("SignalDbTypes").MetaKeysEnum.lastSignedPrekeyId:case d("SignalDbTypes").MetaKeysEnum.lastPrekeyId:case d("SignalDbTypes").MetaKeysEnum.lastPrekeyGenerationId:case d("SignalDbTypes").MetaKeysEnum.edgeInfo:case d("SignalDbTypes").MetaKeysEnum.clockSkew:case d("SignalDbTypes").MetaKeysEnum.abProps:case d("SignalDbTypes").MetaKeysEnum.authKeyPair:return!0;default:return!1}}var l=Object.keys(d("SignalDbTypes").MetaKeysEnum).filter(function(a){return k(a)});f=function(){function a(a){this.db=a}var e=a.prototype;e.get=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.meta.bulkGet(l).then(function(a){return l.reduce(function(b,c,d){return babelHelpers["extends"]({},b,(b={},b[c]=(d=a[d])==null?void 0:(d=d.value)==null?void 0:d[c],b))},{})}))};e.patch=function(a){a=Object.entries(a);var e=a.map(function(a){var b,c=a[0];a=a[1];return{key:d("SignalDbTypes").MetaKeysEnum[c],value:(b={},b[c]=a,b)}});if(a.some(function(a){a=a[0];return!k(a)}))throw c("err")("Invalid MetaInfoStore key specified");if(e.length===0)return b("Promise").resolve();e.forEach(function(a){var b=a.key;a=a.value;b=h[b]||j;b(a)});return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.meta.bulkPut(e)).then(function(){e.filter(function(a){return i[a.key]}).forEach(function(a){var b=i[a.key];b(a.value)})})};return a}();f.tableLocks={meta:d("MAWTransactionMode").READWRITE};g.MAWMetaInfoStore=f}),98);
__d("MAWMissingKeyStore",["MAWDbMissingKeys","MAWDbMissingKeysTxns","MAWDexieCastToPromise","MAWTransactionMode","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var c=a.prototype;c.count=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.missingKeys.count())};c.getAll=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMissingKeysTxns").getAllMissingKeys(this.db)).then(function(a){return a.map(d("MAWDbMissingKeys").convertDbMissingKeysToMissingKeyType)})};c.bulkGet=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.missingKeys.bulkGet(a.map(d("MAWDbMissingKeys").unsafeCoerceToKeyHex))));case 2:c=e.sent;return e.abrupt("return",c.map(function(a){return a==null?null:d("MAWDbMissingKeys").convertDbMissingKeysToMissingKeyType(a)}));case 4:case"end":return e.stop()}},null,this)};c.bulkUpdate=function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.missingKeys.bulkPut(a.map(d("MAWDbMissingKeys").convertMissingKeyTypeToDbMissingKeys))));case 2:case"end":return c.stop()}},null,this)};c.bulkRemove=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.missingKeys.bulkDelete(a.map(d("MAWDbMissingKeys").unsafeCoerceToKeyHex)))};c.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.missingKeys.clear())};return a}();a.tableLocks={missingKeys:d("MAWTransactionMode").READWRITE};g.MAWMissingKeyStore=a}),98);
__d("WAArrayZip",[],(function(a,b,c,d,e,f){function a(a,b){var c=Math.min(a.length,b.length);return a.slice(0,c).map(function(a,c){return[a,b[c]]})}f.zip=a}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypes","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWGating","MAWGlobals","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WADualSendMsgUtils","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.chatId).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){var c=d("WADualSendMsgUtils").isDualSendJid(a.jid)?d("WADualSendMsgUtils").removeDualSendPrefix(a.jid):a.jid;return h(b,c)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){var c=b.get(a.chatJid);return c==null?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({chatId:c,participant:a,participantId:d("MAWDbParticipant").craftParticipantId(c,a.user)})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0],c=b.chatId;b=b.participant;a=a[1];return{chatId:c,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,i(b,c)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;var f=a.get(c);return f==null?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({chatId:f,groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(f,b.userJid),userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantId;return a}),g=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatId;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}})]});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a,b){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(b,a.user),threadId:b,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("MAWGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){var c=a.threads;return d("MAWDexieTable").dexieAll(b.map(function(a){return c.get({jid:a})})).then(function(a){return new Map(a.filter(Boolean).map(function(a){var b=a.chatId;a=a.jid;return[a,b]}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatId;a=a.participant;return{chatId:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatId;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){var b=a.dbParticipantToPut;a=a.participant;d("MAWIndexedDb").afterTransaction({tag:"ParticipantUpdated",value:d("MAWBridgeParticipants").createBridgeParticipant(b,d("WADualSendMsgUtils").isDualSendJid(a.chatJid))})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);d("MAWGating").isOccamadillo()&&b.forEach(function(a){var b=a[0];a=a[1];return a.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypes").createBridgeUpdateE2EEMetadataParticipants(b,d("WADualSendMsgUtils").isDualSendJid(a))})})});var e=new Set(b.filter(function(a){a[0];a=a[1];return a.some(function(a){a=a.userJid;return a===d("MAWGlobals").getMyUserJid()&&(c===d("MAWGlobals").getMyUserJid()||c==="@me")})}).map(function(a){a=a[0];return a}));b=new Set(b.filter(function(a){a[0];a=a[1];return a.some(function(a){a=a.userJid;return a!==c&&(a===d("MAWGlobals").getMyUserJid()||a==="@me")})}).filter(function(a){a=a[0];return!e.has(a)}).map(function(a){a=a[0];return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWPendingMutationStore",["MAWDbPendingMutations","MAWDbPendingMutationsTxns","MAWDexieCastToPromise","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var b=a.prototype;b.getAll=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbPendingMutationsTxns").getAllPendingMutations(this.db)).then(function(a){return a.map(d("MAWDbPendingMutations").convertDbPendingMutationToPendingMutationType)})};b.getByCollection=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbPendingMutationsTxns").getPendingMutationsByCollection(this.db,a)).then(function(a){return a.map(d("MAWDbPendingMutations").convertDbPendingMutationToPendingMutationType)})};b.bulkCreate=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingMutations.bulkAdd(a.map(d("MAWDbPendingMutations").convertPendingMutationTypeToNewDbPendingMutation))).then(function(){})};b.bulkRemove=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingMutations.bulkDelete(a.map(d("MAWDbPendingMutations").unsafeCoerceToPendingMutationId)))};b.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingMutations.clear())};return a}();a.tableLocks={pendingMutations:d("MAWTransactionMode").READWRITE};g.MAWPendingMutationStore=a}),98);
__d("MAWPendingReceiptsStore",["MAWDbPendingReceipt","MAWDexieCastToPromise","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingReceipts.put({author:a.id.author,deliveryReceipts:a.deliveryReceipts,externalId:a.id.externalId,id:d("MAWDbPendingReceipt").craftPendingReceiptId(a.id.chat,a.id.externalId,a.id.author),readReceipts:a.readReceipts,thread:a.id.chat}).then(function(){}))};b.get=function(a){a=d("MAWDbPendingReceipt").craftPendingReceiptId(a.chat,a.externalId,a.author);return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingReceipts.get(a).then(function(a){return a==null?null:{deliveryReceipts:a.deliveryReceipts,id:{author:a.author,chat:a.thread,externalId:a.externalId},readReceipts:a.readReceipts}}))};b["delete"]=function(a){a=d("MAWDbPendingReceipt").craftPendingReceiptId(a.chat,a.externalId,a.author);return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingReceipts["delete"](a))};return a}();a.tableLocks={pendingStanzas:d("MAWTransactionMode").READWRITE};g.MAWPendingReceiptsStore=a}),98);
__d("MAWPendingStanzasStore",["MAWDbMsg","MAWDbPendingStanza","MAWDexieCastToPromise","MAWDexieTable","MAWTransactionMode","WAAssertUnreachable","WAErr","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a){var b=this,e=a.deleteTs,f=a.externalId,g=a.stanza,h;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.threads.get({jid:g.id.chat}).then(function(a){if(a==null)throw c("WAErr")("thread does not exist");switch(g.type){case d("WAMsgType").MSG_TYPE.REVOKED:h={deleteTs:e,externalIdWithType:f+"_"+d("MAWDbPendingStanza").PENDING_REVOKED,pendingContent:{content:{ack:g.ack,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:g.id.author,externalId:g.id.externalId,revokedExternalId:g.revokedExternalId,thread:a.chatId,threadJid:g.id.chat,ts:g.ts,type:d("WAMsgType").MSG_TYPE.REVOKED},type:d("MAWDbPendingStanza").PENDING_TYPE.REVOKED}};break;case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:h={deleteTs:e,externalIdWithType:f+"_"+d("MAWDbPendingStanza").PENDING_DELETE_FOR_ME,pendingContent:{content:{ack:g.ack,author:g.id.author,externalId:g.id.externalId,thread:a.chatId,threadJid:g.id.chat,type:d("WAMsgType").MSG_TYPE.DELETE_FOR_ME},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_FOR_ME}};break;default:return c("WAAssertUnreachable")(g.type)}return b.db.pendingStanzas.add(h).then(function(){})}))};b.get=function(a,b){b=h(a,b);return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingStanzas.get({externalIdWithType:b}).then(function(b){if(b==null)return null;var c=b.pendingContent;if(c.type===d("MAWDbPendingStanza").REVOKED){var e=c.content;return e.threadJid==null?null:{deleteTs:b.deleteTs,externalId:a,stanza:{ack:e.ack,id:{author:e.author,chat:e.threadJid,externalId:e.externalId},revokedExternalId:e.revokedExternalId,ts:e.ts,type:d("WAMsgType").MSG_TYPE.REVOKED}}}else if(c.type===d("MAWDbPendingStanza").DELETE_FOR_ME){e=c.content;return e.threadJid==null?null:{deleteTs:b.deleteTs,externalId:a,stanza:{ack:e.ack,id:{author:e.author,chat:e.threadJid,externalId:e.externalId},type:d("WAMsgType").MSG_TYPE.DELETE_FOR_ME}}}else return null}))};b["delete"]=function(a,b){var c=this;a=h(a,b);return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.pendingStanzas.get({externalIdWithType:a}).then(function(a){return a?c.db.pendingStanzas["delete"](a.rowId):d("MAWDexieTable").dexieResolve()}))};return a}();a.tableLocks={pendingStanzas:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY};function h(a,b){if(b===d("WAMsgType").MSG_TYPE.REVOKED)return a+"_"+d("MAWDbPendingStanza").PENDING_REVOKED;else if(b===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME)return a+"_"+d("MAWDbPendingStanza").PENDING_DELETE_FOR_ME;else throw c("WAErr")("Unexpected pending stanza type: "+b)}g.MAWPendingStanzasStore=a}),98);
__d("MAWPersonalSenderKeySessionsMetadataStore",["MAWDexieCastToPromise","MAWDexieTable","MAWSmartSenderKeyRotationTxns","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a){a=a;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.personalSenderKeyStatuses.put(a).then(function(){return d("MAWDexieTable").dexieResolve()}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.personalSenderKeyStatuses.get(a)).then(function(a){if(a==null)return;return{groupJid:a.groupJid,hasSenderKey:a.hasSenderKey,rotateSenderKey:a.rotateSenderKey,senderKeyId:a.senderKeyId,senderKeyTs:a.senderKeyTs}})};b.bulkDeleteInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.personalSenderKeyStatuses["delete"](a))};b.update=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.personalSenderKeyStatuses.put(a).then(function(){return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}))};b.bulkPerformSmartSenderKeyRotationForParticipantRemoval=function(a,b){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWSmartSenderKeyRotationTxns").bulkPerformSmartSenderKeyRotationForParticipantRemoval(this.db,a,b).then(function(){}))};return a}();a.tableLocks={personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE};g.MAWPersonalSenderKeySessionsMetadataStore=a}),98);
__d("MAWSenderKeySessionsStore",["MAWDexieCastToPromise","MAWDexieTable","MAWTransactionMode","SignalDbTypes","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a){var b=d("WAJids").extractUserJid(a.deviceJid),c=d("WAJids").extractDeviceId(a.deviceJid),e=d("SignalDbTypes").buildSenderKeySessionId(a.groupJid,b,c);c={deviceId:c,groupJid:a.groupJid,id:e,record:a.record,userJid:b};return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.senderKeySessions.put(c).then(function(){return d("MAWDexieTable").dexieResolve()}))};b.get=function(a,b){var c=d("WAJids").extractUserJid(b),e=d("WAJids").extractDeviceId(b);a=d("SignalDbTypes").buildSenderKeySessionId(a,c,e);return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.senderKeySessions.get(a).then(function(a){if(a==null)return;return{deviceJid:b,groupJid:a.groupJid,record:a.record}}))};b.bulkDeleteInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.senderKeySessions.where("groupJid").equals(a)["delete"]()).then(function(){return void 0})};return a}();a.tableLocks={senderKeySessions:d("MAWTransactionMode").READWRITE};g.MAWSenderKeySessionsStore=a}),98);
__d("MAWStanzaQueueStore",["MAWDexieCastToPromise","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.get=function(){throw c("err")("RawStanza Get is not implemented yet")};this.getInChat=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.where("jid").equals(a).toArray().then(function(a){return a.reduce(function(a,b){return b!=null?[].concat(a,[b]):a},[])}))};this.getAll=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.toCollection().toArray())};this.remove=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.bulkDelete(a))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.clear())};this.modify=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.toCollection().modify(a)).then(function(){return void 0})};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.stanzaQueue.bulkAdd(a)).then(function(){})};this.db=a};a.tableLocks={stanzaQueue:d("MAWTransactionMode").READWRITE};g.MAWStanzaQueueStore=a}),98);
__d("MAWSyncActionStore",["MAWDbSyncActions","MAWDbSyncActionsTxns","MAWDexieCastToPromise","MAWTransactionMode","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var c=a.prototype;c.count=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.count())};c.get=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncActionsTxns").getSyncActionBySyncActionIndex(this.db,d("MAWDbSyncActions").unsafeCoerceToSyncActionIndex(a))));case 2:c=e.sent;if(!(c==null)){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType(c));case 6:case"end":return e.stop()}},null,this)};c.getByCollections=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncActionsTxns").getSyncActionsByCollections(this.db,a)));case 2:c=e.sent;return e.abrupt("return",c.map(d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType));case 4:case"end":return e.stop()}},null,this)};c.getByIndexMacs=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.where("indexMac").anyOf(a).toArray()));case 2:c=e.sent;return e.abrupt("return",c.map(d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType));case 4:case"end":return e.stop()}},null,this)};c.getByActionStates=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncActionsTxns").getSyncActionsByActionStates(this.db,a)));case 2:c=e.sent;return e.abrupt("return",c.map(d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType));case 4:case"end":return e.stop()}},null,this)};c.getByModelInfos=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.where(["modelId","modelType","actionState"]).anyOf(a.map(function(a){var b=a[0],c=a[1];a=a[2];return[b,c,a]})).toArray()));case 2:c=e.sent;return e.abrupt("return",c.map(d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType));case 4:case"end":return e.stop()}},null,this)};c.getAll=function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.toArray()));case 2:a=c.sent;return c.abrupt("return",a.map(d("MAWDbSyncActions").convertDbSyncActionsToSyncActionType));case 4:case"end":return c.stop()}},null,this)};c.bulkSet=function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(this.db.syncActions.bulkPut(a.map(d("MAWDbSyncActions").convertSyncActionTypeToDbSyncActions)));case 2:case"end":return c.stop()}},null,this)};c.bulkUpdate=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=new Map(a.map(function(a){return[d("MAWDbSyncActions").unsafeCoerceToSyncActionIndex(a.index),d("MAWDbSyncActions").convertSyncActionTypeToDbSyncActions(a)]}));e.next=3;return b("regeneratorRuntime").awrap(this.db.syncActions.where("index").anyOf(Array.from(c.keys())).modify(function(a){Object.assign(a,c.get(a.index)),c["delete"](a.index)}));case 3:e.next=5;return b("regeneratorRuntime").awrap(this.db.syncActions.bulkPut(Array.from(c.values())));case 5:case"end":return e.stop()}},null,this)};c.bulkRemove=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.bulkDelete(a.map(d("MAWDbSyncActions").unsafeCoerceToSyncActionIndex)))};c.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncActions.clear())};return a}();a.tableLocks={syncActions:d("MAWTransactionMode").READWRITE};g.MAWSyncActionStore=a}),98);
__d("MAWSyncKeyStore",["MAWDbSyncKeys","MAWDbSyncKeysTxns","MAWDexieCastToPromise","MAWTransactionMode","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.db=a}var c=a.prototype;c.get=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncKeysTxns").getSyncKeyBySyncKeyId(this.db,a)));case 2:c=e.sent;if(!(c!=null)){e.next=5;break}return e.abrupt("return",d("MAWDbSyncKeys").convertDbSyncKeysToSyncKeyData(c));case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}},null,this)};c.getAll=function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncKeysTxns").getAllSyncKeys(this.db)));case 2:a=c.sent;return c.abrupt("return",a.map(d("MAWDbSyncKeys").convertDbSyncKeysToSyncKeyData));case 4:case"end":return c.stop()}},null,this)};c.expire=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncKeys.where("keyEpoch").equals(a).toArray().then(function(a){return b.db.syncKeys.bulkPut(a.map(function(a){return babelHelpers["extends"]({},a,{timestamp:0})}))}).then(function(){}))};c.set=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=babelHelpers["extends"]({},a);e.next=3;return b("regeneratorRuntime").awrap(d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbSyncKeysTxns").addSyncKey(this.db,c)));case 3:case"end":return e.stop()}},null,this)};c.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.syncKeys.clear())};return a}();a.tableLocks={syncKeys:d("MAWTransactionMode").READWRITE};g.MAWSyncKeyStore=a}),98);
__d("MAWRunInTransaction",["MAWCollectionVersionStore","MAWContactStore","MAWGroupInfoStore","MAWIndexedDb","MAWLLAMigrationUtils","MAWMessageStore","MAWMetaInfoStore","MAWMissingKeyStore","MAWParticipantsStore","MAWPendingMutationStore","MAWPendingReceiptsStore","MAWPendingStanzasStore","MAWPersonalSenderKeySessionsMetadataStore","MAWSenderKeySessionsStore","MAWStanzaQueueStore","MAWSyncActionStore","MAWSyncKeyStore","MAWTransactionMode","dexie_alpha"],(function(a,b,c,d,e,f,g){"use strict";var h={CollectionVersionStore:d("MAWCollectionVersionStore").MAWCollectionVersionStore.tableLocks,ContactsStore:d("MAWContactStore").MAWContactsStore.tableLocks,GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,MetaInfoStore:d("MAWMetaInfoStore").MAWMetaInfoStore.tableLocks,MissingKeyStore:d("MAWMissingKeyStore").MAWMissingKeyStore.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks,PendingMutationStore:d("MAWPendingMutationStore").MAWPendingMutationStore.tableLocks,PendingReceiptsStore:d("MAWPendingReceiptsStore").MAWPendingReceiptsStore.tableLocks,PendingStanzasStore:d("MAWPendingStanzasStore").MAWPendingStanzasStore.tableLocks,PersonalSenderKeySessionsMetadataStore:d("MAWPersonalSenderKeySessionsMetadataStore").MAWPersonalSenderKeySessionsMetadataStore.tableLocks,SenderKeySessionsStore:d("MAWSenderKeySessionsStore").MAWSenderKeySessionsStore.tableLocks,StanzaQueueStore:d("MAWStanzaQueueStore").MAWStanzaQueueStore.tableLocks,SyncActionStore:d("MAWSyncActionStore").MAWSyncActionStore.tableLocks,SyncKeyStore:d("MAWSyncKeyStore").MAWSyncKeyStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.reduce(function(a,b){b=h[b];b=Object.entries(b);for(var c=0;c<b.length;c++){var e=b[c],f=e[0];e=e[1];if(a[f]===d("MAWTransactionMode").READWRITE)continue;a[f]=e}return a},{});f=e!=null?d("MAWLLAMigrationUtils").getTransactorQPLParam(e,!0):[];e=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[g].concat(f))(function(e){var f={CollectionVersionStore:a.CollectionVersionStore===!0?new(d("MAWCollectionVersionStore").MAWCollectionVersionStore)(e):null,ContactsStore:a.ContactsStore===!0?new(d("MAWContactStore").MAWContactsStore)(e):null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MetaInfoStore:a.MetaInfoStore===!0?new(d("MAWMetaInfoStore").MAWMetaInfoStore)(e):null,MissingKeyStore:a.MissingKeyStore===!0?new(d("MAWMissingKeyStore").MAWMissingKeyStore)(e):null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:a.PendingMutationStore===!0?new(d("MAWPendingMutationStore").MAWPendingMutationStore)(e):null,PendingReceiptsStore:a.PendingReceiptsStore===!0?new(d("MAWPendingReceiptsStore").MAWPendingReceiptsStore)(e):null,PendingStanzasStore:a.PendingStanzasStore===!0?new(d("MAWPendingStanzasStore").MAWPendingStanzasStore)(e):null,PersonalSenderKeySessionsMetadataStore:a.PersonalSenderKeySessionsMetadataStore===!0?new(d("MAWPersonalSenderKeySessionsMetadataStore").MAWPersonalSenderKeySessionsMetadataStore)(e):null,SenderKeySessionsStore:a.SenderKeySessionsStore===!0?new(d("MAWSenderKeySessionsStore").MAWSenderKeySessionsStore)(e):null,StanzaQueueStore:a.StanzaQueueStore===!0?new(d("MAWStanzaQueueStore").MAWStanzaQueueStore)(e):null,SyncActionStore:a.SyncActionStore===!0?new(d("MAWSyncActionStore").MAWSyncActionStore)(e):null,SyncKeyStore:a.SyncKeyStore===!0?new(d("MAWSyncKeyStore").MAWSyncKeyStore)(e):null};return new(c("dexie_alpha").Promise)(function(a){a(b(f))})});return e()};g.runInTransaction=a}),98);
__d("MAWStanzaGroupBy",["WAIncomingStanza","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=[],c=[];for(var e=0;e<a.length;e++){var f=a[e];f.type===d("WAIncomingStanza").INCOMING_STANZA.RETRY_RECEIPT?c.push(f):b.length===0||b[b.length-1].type!==f.type?b.push({items:[f],type:f.type}):b[b.length-1].items.push(f)}return{groupedStanzas:b,retryStanzas:c}}function b(a){var b=new Map(a.map(function(a){if(a.type===d("WAIncomingStanza").INCOMING_STANZA.MESSAGE||a.type===d("WAIncomingStanza").INCOMING_STANZA.RETRY_RECEIPT||a.type===d("WAIncomingStanza").INCOMING_STANZA.RECEIPT)return[a.jid,[]]}).filter(Boolean)),e=function(){var e=a[f];switch(e.type){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:var g=b.get(e.jid);g==null?void 0:g.push(e);break;case d("WAIncomingStanza").INCOMING_STANZA.RETRY_RECEIPT:b.forEach(function(a){a.push(e)});break;default:throw c("err")("Got unhandled message type "+e.type)}};for(var f=0;f<a.length;f++)e();return b}g.groupStanzaEntryByOperation=a;g.groupStanzaEntryByChatJid=b}),98);
__d("MAWHandleIncomingCiphertextMsgApi",["MAWAckLevel","MAWBridge","MAWDbMsg","MAWWriteMsgTxns","WALogger","WAMsgType","WAOdsEnums","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingCiphertextMsg: Message from ",", chat ",""]);h=function(){return a};return a}function a(a,b,c,e){var f=b.author,g=b.chat;b=b.externalId;b={ack:d("MAWAckLevel").ACK.received,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:f,externalId:b,serverTs:c,ts:c,type:d("WAMsgType").MSG_TYPE.CIPHERTEXT};d("WALogger").DEV(h(),f,g);return d("MAWWriteMsgTxns").writeIncomingMsg(a,b,g,e).then(function(a){if(a.success){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WEB_PLACEHOLDER,key:"ciphertext"});return d("WAResultOrError").makeResult(null)}return a})}g.handleIncomingCiphertextMsgInternal=a}),98);
__d("MAWPromiseCastToDexie",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.promiseCastToDexie=a}),66);
__d("WAWriteICDCAlertTransactor",["Promise","WAAckLevel","WAGlobals","WAJids","WAMsgType","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h="User";function a(a){var c=a.ContactsStore,d=a.MessagesStore;a=a.alerts;var e=[];for(var a=a,f=Array.isArray(a),g=0,a=f?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;var j=h.userJid,k=h.chatJid;h=h.serverTs;e.push(i({MessagesStore:d,ContactsStore:c},k,j,h))}return b("Promise").all(e).then(function(a){return void 0})}function i(a,c,e,f,g){var i,j,k,l,m,n,o,p,q;return b("regeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:i=a.ContactsStore,j=a.MessagesStore;r.next=3;return b("regeneratorRuntime").awrap(i.get(e));case 3:k=r.sent;l=k.success===!0?k.value.nameForSearch:null;m=l==null||l==="";n=l==null||l===""?h:l;o=e===d("WAGlobals").getMyUserJid();p={type:d("WAMsgType").MSG_TYPE.ICDC_ALERT,id:{chat:c,externalId:d("WAGlobals").getDependencies().generateExternalId(),author:o?d("WAJids").AUTHOR_ME:e},ts:f,ack:d("WAAckLevel").ACK.RECEIVED,msgContent:{adminType:o?"yourDeviceICDCAlertAdminMessage":"icdcAlertAdminMessage",authorName:n},hasUnknownName:m};r.next=11;return b("regeneratorRuntime").awrap(j.create(p,{folder:g}));case 11:q=r.sent;if(!(q.success===!1)){r.next=14;break}return r.abrupt("return",q);case 14:return r.abrupt("return",d("WAResultOrError").makeResult(p));case 15:case"end":return r.stop()}},null,this)}g.UNKNOWN_USER=h;g.writeBulkICDCAlertTransactor=a;g.writeICDCAlertTransactor=i}),98);
__d("addQPLPointForHandleIncomingMsgApi",["MAWDexieTable","MAWGating"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(!d("MAWGating").isDetailedHandleIncomingMsgQPLEnabled())return;var c=d("MAWDexieTable").getDexiePSDItem("transactorQPLEvent"),e=d("MAWDexieTable").getDexiePSDItem("offlineQueueSize");e===1&&(c==null?void 0:c.addPoint(a,b))}g["default"]=a}),98);
__d("postprocessMessageData",["MAWBridge","MAWDexieTable","MAWEphemeralMsgTxns","MAWGlobals","MAWMsgReceiptPreparationTxns","MAWPendingReceiptProcessingTxns","WAJids","WALogger","WAMsgType","WAOdsEnums","WAResultOrError","addQPLPointForHandleIncomingMsgApi"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming message"]);h=function(){return a};return a}function a(a,b,e,f,g,i,j){var k=e.author,l=e.chat;e=d("WAJids").isAuthorMe(k)?d("MAWGlobals").getMyUserJid():k;if(!b.success)return d("MAWDexieTable").dexieResolve(b);var m=b.value,n=m.dbAssociatedMsg,o=m.dbMedias,p=m.dbMsg,q=d("MAWDexieTable").dexieResolve(),r=d("MAWDexieTable").dexieResolve();m=d("MAWDexieTable").dexieResolve();if(p!=null){if(p.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var s=p&&!d("WAJids").isAuthorSystem(p.author)?{author:p.author,chat:l,externalId:p.externalId}:null;o=o!=null?o.map(function(a){return a.plaintextHash}):null;return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:i,plaintextHashs:o,protocolMsgId:s,unknownDevice:j,unknownGroup:!1}))}p.type===d("WAMsgType").MSG_TYPE.FUTUREPROOF&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WEB_PLACEHOLDER,key:"unknown_futureproof"});m=d("MAWEphemeralMsgTxns").maybeUpdateEphemeralSettingOrCheckOutOfSyncAfterWritingIncomingMsg(a,p,e,l,f,g,b.value.outOfSyncEphemeralSetting);k===d("WAJids").AUTHOR_ME?(n!=null&&n.type!==d("WAMsgType").MSG_TYPE.DELETE_FOR_ME&&(r=d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,n.msgId,l,!1).then(function(){return d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,l,n)})),q=d("MAWMsgReceiptPreparationTxns").prepareReceiptForMsg(a,p.msgId,l,!1).then(function(){return d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,l,p)})):q=d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,l,p)}return m.then(function(a){c("addQPLPointForHandleIncomingMsgApi")("maybeUpdateEphemeralSettingOrCheckOutOfSync");return d("MAWDexieTable").dexieAll([q,r]).then(function(){var f;c("addQPLPointForHandleIncomingMsgApi")("postWriteStpes");d("WALogger").LOG(h());var g=b.value,e=g.dbMedias;g=g.dbMsg;g=g&&!d("WAJids").isAuthorSystem(g.author)?{author:g.author,chat:l,externalId:g.externalId}:null;e=e!=null?e.map(function(a){return a.plaintextHash}):null;return d("WAResultOrError").makeResult({icdcResults:i,outOfSyncEphemeralSetting:(f=a)!=null?f:void 0,plaintextHashs:e,protocolMsgId:g,unknownDevice:j,unknownGroup:!1})})})}g["default"]=a}),98);
__d("WAICDCCheckTransactor",["Promise","WAErr","WAGlobals","WAICDCUtils","WAJids","WALogger","WAPREList","WAPREMetrics","WASignalKeys","WATimeUtils","WAWriteICDCAlertTransactor","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["The number of ICDC failures is higher "," than allowed amount ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received non-user jid during ICDC validation"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received message(s) without ICDC payload"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received message(s) without ICDC payload"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received non-user jid during ICDC validation"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["The number of ICDC failures is higher "," than allowed amount ",""]);m=function(){return a};return a}function n(a,b,c){if(b==null)return{jid:a,icdcResult:{action:"none"}};c=d("WAICDCUtils").validateICDCInfo(c,b.icdcInfo,((c=b.icdcInfo)==null?void 0:c.devices.map(function(a){return d("WASignalKeys").serializeIdentity(a)}))||[]);if(c.action==="error"){var e=c.failureTs,f=[];b.icdcFails!=null&&(f=b.icdcFails);if(f.length>0&&d("WATimeUtils").futureUnixTime(d("WAGlobals").getConfig().icdcCooldownIntervalInMinutes()*60,f[f.length-1].timeBucket)>e)return{jid:a,icdcResult:c};while(f.length>0&&f[0].timeBucket<d("WATimeUtils").pastUnixTime(d("WAGlobals").getConfig().icdcIntervalInMinutes()*60,e))f.shift();var g=d("WAGlobals").getConfig().icdcAlertTriggerFailureCounter(),h=f.length+1>=g&&!f.some(function(a){return a.alert!=null&&a.alert===!0});h&&d("WALogger").WARN(m(),f.length,g);f.push({timeBucket:e,alert:h});return{jid:a,icdcResult:c,update:{contact:babelHelpers["extends"]({},b,{icdcFails:f,dhash:c.sync?null:b.dhash}),shouldAlert:h}}}return{jid:a,icdcResult:c}}function o(a,b,c){b=d("WAJids").interpretAndValidateJid(b);if(b.jidType!=="msgrUser"){d("WALogger").ERROR(l());return}var e=a.get(b.userJid);e==null&&(e=[],a.set(b.userJid,e));e.push(c)}function p(a,c){var e,f,g,h,i,j,l,m,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;return b("regeneratorRuntime").async(function(Z){while(1)switch(Z.prev=Z.next){case 0:e=a.MessagesStore,f=a.ContactsStore;if(d("WAGlobals").getConfig().isICDCEnabled()){Z.next=3;break}return Z.abrupt("return",b("Promise").resolve());case 3:g=c.filter(function(a){return a.msg.icdc!==null});if(!(g.length===0)){Z.next=7;break}d("WALogger").DEV(k());return Z.abrupt("return",b("Promise").resolve());case 7:h=new Map();g.forEach(function(d){var e=d.msg,b=d.chatJid,a=d.userJid,c=d.serverTs,f=e.icdc;f!=null&&(o(h,a,{serverTs:c,chatJid:b,icdcPayload:f.senderIdentity}),f.recipientUserJids.forEach(function(a,d){o(h,a,{serverTs:c,chatJid:b,icdcPayload:f.recipientIdentities[d]})}))});Z.next=11;return b("regeneratorRuntime").awrap(f.bulkGet(Array.from(h.keys())));case 11:i=Z.sent,j=i.reduce(function(a,b){b.success&&a.set(b.value.contactJid,{contact:b.value,dirty:!1});return a},new Map()),l=new Map(),m=new Map(),(p=h.entries(),q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 16:if(!q){Z.next=22;break}if(!(r>=p.length)){Z.next=19;break}return Z.abrupt("break",42);case 19:s=p[r++];Z.next=26;break;case 22:r=p.next();if(!r.done){Z.next=25;break}return Z.abrupt("break",42);case 25:s=r.value;case 26:t=s,u=t[0],v=t[1],w=0;case 30:if(!(w<v.length)){Z.next=40;break}y=v[w].icdcPayload;z=n(u,(x=j.get(u))==null?void 0:x.contact,y),A=z.jid,B=z.icdcResult,C=z.update;l.set(u,{jid:A,icdcResult:B});C!=null&&((D=v[w],E=D.chatJid,F=D.serverTs),(G=C.contact,H=C.shouldAlert),j.set(u,{contact:G,dirty:!0}),H&&m.set(u,{chatJid:E,serverTs:F}));if(!(B.action==="error")){Z.next=37;break}return Z.abrupt("break",40);case 37:w++;Z.next=30;break;case 40:Z.next=16;break;case 42:I=[],(J=j.entries(),K=Array.isArray(J),L=0,J=K?J:J[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 44:if(!K){Z.next=50;break}if(!(L>=J.length)){Z.next=47;break}return Z.abrupt("break",60);case 47:M=J[L++];Z.next=54;break;case 50:L=J.next();if(!L.done){Z.next=53;break}return Z.abrupt("break",60);case 53:M=L.value;case 54:N=M,N[0],O=N[1],O.dirty&&I.push(O.contact);case 58:Z.next=44;break;case 60:if(!(I.length>0)){Z.next=63;break}Z.next=63;return b("regeneratorRuntime").awrap(f.bulkPut(I));case 63:if(!(m.size>0)){Z.next=88;break}d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.ICDC_ERROR).endFail("icdc_error");if(!d("WAGlobals").getConfig().isICDCErrorEnabled()){Z.next=88;break}P=[];Q=m.entries(),R=Array.isArray(Q),S=0,Q=R?Q:Q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 68:if(!R){Z.next=74;break}if(!(S>=Q.length)){Z.next=71;break}return Z.abrupt("break",86);case 71:T=Q[S++];Z.next=78;break;case 74:S=Q.next();if(!S.done){Z.next=77;break}return Z.abrupt("break",86);case 77:T=S.value;case 78:U=T,V=U[0],W=U[1],X=W.chatJid,Y=W.serverTs,P.push({userJid:V,chatJid:X,serverTs:Y});case 84:Z.next=68;break;case 86:Z.next=88;return b("regeneratorRuntime").awrap(d("WAWriteICDCAlertTransactor").writeBulkICDCAlertTransactor({ContactsStore:f,MessagesStore:e,alerts:P}));case 88:return Z.abrupt("return",b("Promise").resolve(Array.from(l.values())));case 89:case"end":return Z.stop()}},null,this)}function a(a,b,c,d,e){var f=a.MessagesStore;a=a.ContactsStore;return p({MessagesStore:f,ContactsStore:a},[{msg:b,chatJid:c,userJid:d,serverTs:e}]).then(function(a){return a||[]})}function e(a,e){var f=a.ContactsStore;if(!d("WAGlobals").getConfig().isICDCEnabled())return b("Promise").resolve({icdcResultMap:new Map(),messagesToWrite:[]});a=e.filter(function(a){return a.msg.icdc!==null});if(a.length===0){d("WALogger").DEV(j());return b("Promise").resolve({icdcResultMap:new Map(),messagesToWrite:[]})}var g=new Map(),k=new Map();a.forEach(function(a){var b=a.msg.icdc;if(b==null)throw c("WAErr")("Unexpected ICDC null payload - for flow");var d=a.userJid;k.set(d,[a.chatJid,a.serverTs]);a=g.get(d);var e=[{jid:d,identity:b.senderIdentity}].concat(b.recipientIdentities.map(function(a,c){return{jid:b.recipientUserJids[c],identity:a}}));a==null?g.set(d,e):a.push.apply(a,e)});var l=new Map(),m=[];g.forEach(function(a,e){var g=k.get(e);if(g==null)throw c("WAErr")("Should not happen for flow");var j=g[0],n=g[1];g=a.map(function(a){return function(){var c,g,k,l,o,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:g=d("WAJids").interpretAndValidateJid(a.jid);k=a.identity;if(!(g.jidType!=="msgrUser")){t.next=5;break}d("WALogger").ERROR(i());return t.abrupt("return",null);case 5:t.t0=b("regeneratorRuntime");t.next=8;return b("regeneratorRuntime").awrap(f.get(g.userJid));case 8:t.t1=t.sent;t.next=11;return t.t0.awrap.call(t.t0,t.t1);case 11:l=t.sent;if(!(l!==null)){t.next=14;break}return t.abrupt("return",{jid:g.userJid,icdcResult:{action:"none"}});case 14:o=d("WAICDCUtils").validateICDCInfo(k,l.value.icdcInfo,((c=l.value.icdcInfo)==null?void 0:c.devices.map(function(a){return d("WASignalKeys").serializeIdentity(a)}))||[]);if(!(o.action==="error")){t.next=27;break}p=o.failureTs;q=[];l.value.icdcFails!=null&&(q=l.value.icdcFails);if(!(q.length>0&&d("WATimeUtils").futureUnixTime(d("WAGlobals").getConfig().icdcCooldownIntervalInMinutes()*60,q[q.length-1].timeBucket)>p)){t.next=21;break}return t.abrupt("return",{jid:g.userJid,icdcResult:o});case 21:while(q.length>0&&q[0].timeBucket<d("WATimeUtils").pastUnixTime(d("WAGlobals").getConfig().icdcIntervalInMinutes()*60,p))q.shift();r=d("WAGlobals").getConfig().icdcAlertTriggerFailureCounter();s=q.length+1>=r&&!q.some(function(a){return a.alert!=null&&a.alert===!0});q.push({timeBucket:p,alert:s});s&&(d("WALogger").WARN(h(),q.length,r),d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.ICDC_ERROR).endFail("icdc_error"),d("WAGlobals").getConfig().isICDCErrorEnabled()&&m.push({chatJid:j,userJid:e,serverTs:n}));return t.abrupt("return",f.bulkPut([babelHelpers["extends"]({},l.value,{icdcFails:q,dhash:o.sync?null:l.value.dhash})]).then(function(){return{jid:g.userJid,icdcResult:o}}));case 27:return t.abrupt("return",{jid:g.userJid,icdcResult:o});case 28:case"end":return t.stop()}},null,this)}});l.set(e,g)});var n=Array.from(l.entries());e=n.map(function(a){a[0];a=a[1];return a});return b("Promise").all(e.map(function(a){return q(a)})).then(function(a){a=a.reduce(function(a,b,c){c=n[c][0];return a.set(c,b)},new Map());return{messagesToWrite:m,icdcResultMap:a}})}function q(a){return a.reduce(function(a,b){return a.then(function(a){return b().then(function(b){a.push(b);return a})})},b("Promise").resolve([])).then(function(a){var b=[];for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e!=null&&b.push(e)}return b})}g.bulkICDCTransactor=p;g.icdcCheckTransactor=a;g.bulkCheckICDCTransactor=e}),98);
__d("preprocessMessageData",["MAWContactStore","MAWDbIdentityTxns","MAWDexieTable","MAWGating","MAWGetMsgQuoteTxn","MAWGlobals","MAWIncomingMsgUtils","MAWJids","MAWMessageStore","MAWPromiseCastToDexie","MAWUpdateDevicesForUserApi","MAWWriteGroupInviteTxns","MAWWriteReactionTxns","WAICDCCheckTransactor","WAJids","WALogger","WAResultOrError","addQPLPointForHandleIncomingMsgApi"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWHandleIncomingMsg: Group Invite from ",", chat ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Reaction from ",", chat ",""]);i=function(){return a};return a}function a(a,b,e,f,g,j,k,l){var m=b.author,n=b.chat,o=b.externalId,p=d("WAJids").isAuthorMe(m)?d("MAWGlobals").getMyUserJid():m,q=d("MAWJids").toDeviceJid(p,e.id);return d("MAWDbIdentityTxns").hasDeviceJid(a,q).then(function(b){c("addQPLPointForHandleIncomingMsgApi")("hasDeviceJid",{bool:{known_device:b}});return d("MAWPromiseCastToDexie").promiseCastToDexie(d("WAICDCCheckTransactor").icdcCheckTransactor({ContactsStore:new(d("MAWContactStore").MAWContactsStore)(a),MessagesStore:new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(a)},g,n,p,f)).then(function(r){var s=!b;c("addQPLPointForHandleIncomingMsgApi")("icdcCheckTransactor");var t=d("MAWIncomingMsgUtils").getDbMsg({author:m,chat:n,externalId:o,folder:k,msg:g,reportingMeta:l,serverTs:f}),u=t.unstoredDbMedia,v=t.unstoredDbMsg,w=t.unstoredDbReaction,x=t.unstoredIncomingDbGroupInvite;t=t.unstoredXMA;var y={icdcResults:r,unknownDevice:s,unstoredDbMedia:u,unstoredXMA:t,userJid:p};if(w!=null){d("WALogger").LOG(i(),m,n);if(d("MAWGating").isBulkifyHIMEnabled())return{resultOrError:d("WAResultOrError").makeResult({icdcResults:r,plaintextHashs:null,protocolMsgId:{author:m,chat:w.threadJid,externalId:w.externalId},reactToExternalId:w.reactToExternalId,unknownDevice:s,unknownGroup:!1}),state:y};else return d("MAWWriteReactionTxns").writeIncomingReactionMsg(a,w,n,s,r).then(function(a){return{resultOrError:a,state:y}})}if(x!=null){d("WALogger").LOG(h(),m,n);var z=e.identity;if(s&&z==null)return{resultOrError:d("WAResultOrError").makeError({type:"identity_missing"}),state:y};u=d("MAWDexieTable").dexieResolve();z!=null&&(u=d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,p).then(function(b){c("addQPLPointForHandleIncomingMsgApi")("unstoredIncomingDbGroupInvite");return d("MAWDbIdentityTxns").bulkGetIdentities(a,b).then(function(e){e.push({id:q,identity:z});return d("MAWUpdateDevicesForUserApi").updateDeviceIdentities(a,p,e,b,void 0,"MAWHandleIncomingMsgApi").then(function(){c("addQPLPointForHandleIncomingMsgApi")("unstoredIncomingDbGroupInviteUpdateDeviceIdentities")})})}));return u.then(function(){return!d("MAWGating").isGroupInvitesEnabled()?{resultOrError:d("WAResultOrError").makeResult({icdcResults:r,plaintextHashs:null,protocolMsgId:null,unknownDevice:s,unknownGroup:!1}),state:y}:d("MAWWriteGroupInviteTxns").writeIncomingGroupInviteMsg(a,x,n,m,o,k,s,r).then(function(a){c("addQPLPointForHandleIncomingMsgApi")("writeIncomingGroupInviteMsg");return{resultOrError:a,state:y}})})}if(v==null)return{resultOrError:d("WAResultOrError").makeResult({icdcResults:r,plaintextHashs:null,protocolMsgId:null,unknownDevice:s,unknownGroup:!1}),state:y};j!=null;var A=e.identity;if(s&&A==null)return{resultOrError:d("WAResultOrError").makeError({type:"identity_missing"}),state:y};t=d("MAWDexieTable").dexieResolve();A!=null&&(t=d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,p).then(function(b){c("addQPLPointForHandleIncomingMsgApi")("unknownIdentityGetAllDeviceJidsForUser");return d("MAWDbIdentityTxns").bulkGetIdentities(a,b).then(function(e){c("addQPLPointForHandleIncomingMsgApi")("getAllDeviceJidsForUserBulkGetIdentities");e.push({id:q,identity:A});return d("MAWUpdateDevicesForUserApi").updateDeviceIdentities(a,p,e,b).then(function(){c("addQPLPointForHandleIncomingMsgApi")("unknownIdentityUpdateDeviceIdentities")})})}));return t.then(function(){c("addQPLPointForHandleIncomingMsgApi")("handleUnknownDevicePromise");return d("MAWGetMsgQuoteTxn").enhanceMsgWithQuoteInfo(a,v,n).then(function(a){c("addQPLPointForHandleIncomingMsgApi")("enhanceMsgWithQuoteInfo");return{state:y,unstoredDbMsg:a}})})})})}g["default"]=a}),98);
__d("MAWHandleIncomingMsgApi",["MAWContactStore","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralSettingsTxns","MAWGating","MAWMessageStore","MAWPromiseCastToDexie","MAWWriteMsgTxns","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","WAWriteICDCAlertTransactor","addQPLPointForHandleIncomingMsgApi","err","postprocessMessageData","preprocessMessageData"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Message from ",", chat ",", type ",""]);h=function(){return a};return a}function a(a,b,e,f,g,j,k,l){var m=b.author,n=b.chat,o=b.externalId;return c("preprocessMessageData")(a,b,e,f,g,j,k,l).then(function(j){var l=j.resultOrError,p=j.state;j=j.unstoredDbMsg;if(l!=null)return l;if(j==null)throw c("err")("resultOrError and unstoredDbMsg cannot both be missing");var q=p.icdcResults,r=p.unknownDevice;l=p.unstoredDbMedia;var s=p.unstoredXMA;p=p.userJid;var t;d("WALogger").LOG(h(),m,n,j.type);switch(j.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:t=d("MAWWriteMsgTxns").writeIncomingMsg(a,j,n,k).then(function(a){return a.success?d("WAResultOrError").makeResult({dbMedias:null,dbMsg:a.value}):a});break;case d("WAMsgType").MSG_TYPE.REVOKED:t=d("MAWWriteMsgTxns").writeIncomingRevokeMsg(a,j,n,k).then(function(a){return a.success?d("WAResultOrError").makeResult({dbMedias:null,dbMsg:a.value}):a});break;case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.PTT:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.STICKER:if(!l)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:q,plaintextHashs:null,protocolMsgId:null,unknownDevice:r,unknownGroup:!1}));t=d("MAWWriteMsgTxns").writeIncomingMediaMsg(a,j,l,n,k);break;case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:if(g.version==="v3"&&g.type==="ephemeral"){if(!d("MAWGating").isEphemeralMessagesEnabled())return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:q,plaintextHashs:null,protocolMsgId:null,unknownDevice:r,unknownGroup:!1}));if(g.ephemeralExpirationInSec<0||g.ephemeralExpirationInSec>86400){l=d("WAJids").interpretAndValidateJid(n);l=l.jidType;throw c("err")("MAWHandleIncomingMsgApi - ephemeralSetting duration is invalid "+g.ephemeralExpirationInSec+", jidType: "+l)}t=d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,p,e,{ephemeralExpirationInSec:g.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:g.ephemeralLastUpdatedOrSetTimestamp},n,f,o).then(function(a){var b;return a.success?d("WAResultOrError").makeResult({dbMedias:null,dbMsg:(b=a.value)==null?void 0:b.dbEphemeralSettingMsg,outOfSyncEphemeralSetting:(b=a.value)==null?void 0:b.outOfSyncEphemeralSetting}):a})}else throw c("err")("Unexpected msg type when writing ephemeral setting message");break;case d("WAMsgType").MSG_TYPE.ICDC_ALERT:if(!d("MAWGating").isICDCEnabled())return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:q,plaintextHashs:null,protocolMsgId:null,unknownDevice:r,unknownGroup:!1}));t=d("MAWPromiseCastToDexie").promiseCastToDexie(d("WAWriteICDCAlertTransactor").writeICDCAlertTransactor({ContactsStore:new(d("MAWContactStore").MAWContactsStore)(a),MessagesStore:new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(a)},n,p,f,k)).then(function(b){return b.success?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b.value.id).then(function(a){return d("WAResultOrError").makeResult({dbMedias:null,dbMsg:a})}):b});break;case d("WAMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:if(!d("MAWGating").isEphemeralMessagesEnabled())return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:q,plaintextHashs:null,protocolMsgId:null,unknownDevice:r,unknownGroup:!1}));t=d("MAWWriteMsgTxns").writeIncomingEphemeralScreenshotActionMsg(a,p,f,n,j.msgContent.screenshotActionType,k,o).then(function(a){return a.success?d("WAResultOrError").makeResult({dbMedias:null,dbMsg:a.value}):a});break;case d("WAMsgType").MSG_TYPE.XMA:if(!d("MAWGating").isXMAFeedPostShareEnabled()||s==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({icdcResults:q,plaintextHashs:null,protocolMsgId:null,unknownDevice:r,unknownGroup:!1}));t=i(a,j,s,n,k);break;case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.ADMIN:throw c("err")("We do not support handleIncomingMsgInternal with msg in "+j.type+" type","messenger_e2ee_web");default:return c("WAAssertUnreachable")(j.type)}return t.then(function(d){var g;c("addQPLPointForHandleIncomingMsgApi")("writeMsg");g=d.success?{success:d.success,value:{dbAssociatedMsg:d==null?void 0:(g=d.value)==null?void 0:g.dbAssociatedMsg,dbMedias:d==null?void 0:(g=d.value)==null?void 0:g.dbMedias,dbMsg:d==null?void 0:(g=d.value)==null?void 0:g.dbMsg,outOfSyncEphemeralSetting:d==null?void 0:(g=d.value)==null?void 0:g.outOfSyncEphemeralSetting}}:d;return c("postprocessMessageData")(a,g,b,e,f,q,r)})})}function i(a,b,c,e,f){d("MAWDexieTable").dexieResolve();a=d("MAWWriteMsgTxns").writeIncomingXMAMsg(a,b,c,e,f);return a}g.handleIncomingMsgInternal=a}),98);
__d("MAWHandleUnavailableMsgApi",["MAWAckLevel","MAWBridge","MAWDbMsg","MAWWriteMsgTxns","WALogger","WAMsgType","WAOdsEnums","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleUnavailableMsg: Message from ",", chat ",""]);h=function(){return a};return a}function a(a,b,c){var e=b.author,f=b.chat;b=b.externalId;b={ack:d("MAWAckLevel").ACK.failed,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:e,externalId:b,serverTs:c,ts:c,type:d("WAMsgType").MSG_TYPE.UNAVAILABLE};d("WALogger").DEV(h(),e,f);return d("MAWWriteMsgTxns").writeIncomingMsg(a,b,f).then(function(a){if(a.success){d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WEB_PLACEHOLDER,key:"unavailable"});return d("WAResultOrError").makeResult(null)}return a})}g.handleUnavailableMsgInternal=a}),98);
__d("MAWBulkHandleIncomingMsgApi",["MAWBridge","MAWBulkWriteReactionsTxns","MAWDexieTable","MAWGating","MAWGlobals","MAWHandleIncomingCiphertextMsgApi","MAWHandleIncomingMsgApi","MAWHandleUnavailableMsgApi","MAWIndexedDb","MAWJobDefinitions","MAWOfflineThreadTxns","MAWProcessOfflineMsgsTxns","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteBulkWriteIncomingAdminMsgTxns","Promise","WAOdsEnums","WAResultOrError","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY,chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READWRITE,existingUsers:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,meta:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,pendingReceipts:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE},c("qpl")._(25311150,"7077"))(function(b){var c=d("MAWDexieTable").dexieResolve(),e=[];d("MAWGating").isArmadilloTotalMessageCollectionEnabled()&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{amount:a.length,entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"msgs"});d("MAWDexieTable").setDexiePSDItem("offlineQueueSize",a.length);var f=function(){return d("MAWDexieTable").dexieResolve()};if(d("MAWGating").isBulkifyHIMEnabled()){var g=a.filter(function(a){return a.type!=="InvisibleMsg"}).map(function(a){return a.id.chat});f=function(){return d("MAWOfflineThreadTxns").createAllThreadsForOfflineMsgs(b,g).then(function(a){return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(b,a)})}}var h=function(){return d("MAWDexieTable").dexieResolve()};if(d("MAWGating").isBulkifyHIMEnabled()){var i=d("MAWProcessOfflineMsgsTxns").classifyOfflineMsgs(a);i=i.reactionMsgs;var j=i.map(function(a){return{chatJid:a.chat,unstoredReaction:a.unstoredDbReaction}});h=function(){return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(b,j)}}return f().then(function(){return h().then(function(){var f=new Set();a.forEach(function(a){switch(a.type){case"IncomingMsg":var g=a.device,h=a.folder,i=a.id,j=a.msg,k=a.recipientsCount,l=a.reportingMeta,m=a.ts;f.add(i.chat);c=c.then(function(){return d("MAWHandleIncomingMsgApi").handleIncomingMsgInternal(b,i,g,m,j,k,h,l).then(function(a){e.push(a);if(!a.success&&a.error.type==="identity_missing")return d("MAWHandleIncomingCiphertextMsgApi").handleIncomingCiphertextMsgInternal(b,i,m)}).then(function(){})});break;case"InvisibleMsg":e.push(d("WAResultOrError").makeResult({icdcResults:null,plaintextHashs:null,protocolMsgId:a.id,unknownDevice:!1,unknownGroup:!1}));break;case"IncomingCiphertextMsg":var n=a.id,o=a.ts;f.add(n.chat);c=c.then(function(){if(!a.createPlaceholder){e.push(d("WAResultOrError").makeResult());return d("MAWDexieTable").dexieResolve()}else return d("MAWHandleIncomingCiphertextMsgApi").handleIncomingCiphertextMsgInternal(b,n,o).then(function(a){return e.push(a)})});break;default:var p=a.id,q=a.ts;f.add(p.chat);c=c.then(function(){return d("MAWHandleUnavailableMsgApi").handleUnavailableMsgInternal(b,p,q)}).then(function(a){e.push(a)})}c=c.then(function(){var a;(a=d("MAWGlobals").getServerRPC().offlineQueueManager())==null?void 0:(a=a.getStats())==null?void 0:a.track({processedStanzas:{message:1}})})});var g=f.size>0?function(){return d("MAWThreadFetchAndEmitTxns").emitThreadContents(b,f)}:function(){return d("MAWDexieTable").dexieResolve()};return c.then(function(){return g().then(function(){return e})})})})})().then(function(a){var c=new Set();a.forEach(function(a){if(a.success){a=a.value;if((a==null?void 0:a.reactToExternalId)!=null)c.add(a.reactToExternalId);else if((a==null?void 0:a.protocolMsgId)!=null){a=a.protocolMsgId.externalId;c.add(a)}}});var e=c.size>0?d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.linkReactionsToMsgs(Array.from(c))):b("Promise").resolve();return e.then(function(){return a})})}g.bulkHandleIncomingMsgs=a}),98);
__d("MAWStanzaQueueMsg",["MAWBulkHandleIncomingMsgApi","Promise","WAIncomingMsg","WAIncomingMsgUtils","WAMessageHandlingFollowUps","WAPREList","WAPREMetrics","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.map(function(){return{encDecryption:[],receive:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER),receiveEU:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER)}});return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(a.map(function(a){a=a.message;return a.decrypted})).then(function(c){var e=a.map(function(a){a=a.message;return a});return d("WAResultOrError").makeResult(function(){return h(e,c,b)})})}function h(a,c,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:f=d("WAIncomingMsgUtils").combineDbResultsAndMsg(a.map(function(a,b){return babelHelpers["extends"]({},a,{metrics:e[b]})}),c,"StanzaQueue");g=f.map(function(a){return d("WAIncomingMsgUtils").processSingleDBResult(a)});h=d("WAIncomingMsg").splitActionsByType(g);n.next=5;return b("regeneratorRuntime").awrap(d("WAMessageHandlingFollowUps").processQueryGroupActions(h,"StanzaQueue"));case 5:i=n.sent;n.next=8;return b("regeneratorRuntime").awrap(d("WAMessageHandlingFollowUps").processQueryGroupInviteActions(i,"StanzaQueue"));case 8:j=n.sent;k=d("WAIncomingMsg").sortReceiptByType(j),l=k.getDevices,m=k.queryGroup;n.next=12;return b("regeneratorRuntime").awrap(b("Promise").all([d("WAIncomingMsgUtils").scheduleGetDeviceRequests(l),d("WAMessageHandlingFollowUps").processQueryGroups(Array.from(m.groupJids))]));case 12:case"end":return n.stop()}},null,this)}g.handleIncomingMessagesStanzas=a}),98);
__d("MAWStanzaQueueGroupNotification",["WAHandleGroupNotifications","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.notification;return d("WAHandleGroupNotifications").persistGroupNotification(a).then(function(a){return a.success?a:d("WAResultOrError").makeResult(function(){return d("WAHandleGroupNotifications").groupRecovery(a,b)})})}g.handleStanzaQueueGroupNotification=a}),98);
__d("MAWUpdateUserDevicesApi",["MAWContactStore","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWJids","MAWLLAMigrationUtils","MAWTransactionMode","MAWUpdateDevicesForUserApi","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{appMeta:d("MAWTransactionMode").READONLY,chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READWRITE,deviceChangeAlerts:d("MAWTransactionMode").READWRITE,existingUsers:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,session:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateUserDevices",!1)))(function(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=[],e=b.map(function(a){a=a.jid;return a});return d("MAWDexieCastToPromise").promiseCastToDexiePromise(new(d("MAWContactStore").MAWContactsStore)(a).bulkGet(e).then(function(a){return a.map(function(a){if(!a.success)return d("WAResultOrError").makeError("missing");else{a=a.value;return d("WAResultOrError").makeResult({contact:{devices:a.identities.map(function(a){return a.device}),dhash:a.dhash,icdcInfo:a.icdcInfo},identities:a.identities})}})}).then(function(e){var f=b.map(function(b,f){var g=b.devices,h=b.dhash,i=b.icdcInfo,j=b.jid,k=b.lastSyncTs;b=b.notificationTs;var l=g.map(function(a){a=a.id;return a}),m=null;e[f].success&&(m=e[f].value.contact.icdcInfo);f=g.map(function(a){var b=a.id;a=a.identity;return{device:d("MAWJids").toDeviceJid(j,b),identity:a}});c.push({devices:l,dhash:h,icdcInfo:i||m,identities:f,jid:j,lastSyncTs:k});return d("MAWUpdateDevicesForUserApi").updateDevicesForUserTxn(a,j,g.map(function(a){var b=a.id,c=a.identity,e=a.model;a=a.platform;return{id:d("MAWJids").toDeviceJid(j,b),identity:c,model:e,platform:a}}),void 0,"updateUserDevicesLLA",b)});return d("MAWDexieTable").dexieAll(f)}).then(function(){var b=c.map(function(a){var b=a.dhash,c=a.icdcInfo,d=a.identities,e=a.jid;a=a.lastSyncTs;return{contactJid:e,dhash:b,icdcInfo:(e=c)!=null?e:void 0,identities:d,lastSyncTs:a}});return new(d("MAWContactStore").MAWContactsStore)(a).bulkPut(b)}).then(function(){}))});g.updateUserDevices=a}),98);
__d("MAWStanzaQueueNotification",["MAWFolderTypes","MAWGlobals","MAWJobDefinitions","MAWStanzaQueueGroupNotification","MAWUpdateMediaEntryForMsgApi","MAWUpdateUserDevicesApi","Promise","WAGlobals","WAHandleMediaRetryNotification","WAICDCUtils","WAJids","WALogger","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function l(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:if(!d("WAGlobals").getConfig().isICDCEnabled()){g.next=8;break}c=d("WAGlobals").getMyUserJid();e=a.notification.jid===c?a.notification:null;if(!(e!=null)){g.next=8;break}f=e.icdcInfo;if(!(f==null||d("WAICDCUtils").isICDCIndexInvalid(f)||(f==null?void 0:f.dirty))){g.next=8;break}g.next=8;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.computeAndUploadICDCInfo()));case 8:case"end":return g.stop()}},null,this)}function m(a){return d("MAWUpdateUserDevicesApi").updateUserDevices([a.notification]).then(function(){return d("WAResultOrError").makeResult(function(){return l(a)})})}function n(a){var c=a.stanzaId;a=a.notification;var e=a.actions,f=a.chatJid;return b("Promise").all(e.map(function(a){switch(a.type){case"folder":var e;e=(e=a.folderId)!=null?e:d("MAWFolderTypes").FOLDER_ID.INBOX;d("WALogger").LOG(k(),c,e,f);return d("MAWGlobals").getDbImpls().updateThreadFolder(f,e);case"connected":d("WALogger").LOG(j(),c,f);return d("MAWGlobals").getDbImpls().handleConnectedAdminMsg(f);default:a.type;d("WALogger").ERROR(i(),c,f);return b("Promise").reject()}})).then(function(){})}function o(a){return b("Promise").resolve(d("WAResultOrError").makeResult(function(){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a.notification.from,e=a.stanzaId;f={author:d("WAJids").extractUserJid(c.author),chat:c.chat,externalId:e};j.next=4;return b("regeneratorRuntime").awrap(d("WAHandleMediaRetryNotification").prepareMediaRetry(a,f));case 4:g=j.sent;if(!(g==null)){j.next=7;break}return j.abrupt("return");case 7:h=g.plaintextHash,i=g.updateEntry;j.next=10;return b("regeneratorRuntime").awrap(d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(h,f,i));case 10:j.next=12;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(f,h,"WAHandleMediaRetryNotification")));case 12:case"end":return j.stop()}},null,this)}))}function a(a){return a.map(function(a){a=a.notification;switch(a.type){case"devices":return m(a);case"group":return d("MAWStanzaQueueGroupNotification").handleStanzaQueueGroupNotification(a);case"thread":return n(a).then(function(){return d("WAResultOrError").makeResult()});case"mediaretry":return o(a);default:a;d("WALogger").TAGS(["StanzaQueue"]).ERROR(h(),a.type);return b("Promise").resolve(d("WAResultOrError").makeResult())}})}g.handleIncomingNotificationStanzas=a}),98);
__d("MAWWriteAppDataReceiptsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b,c){return h(a,b,c)});function h(a,b,c){return d("MAWDexieTable").dexieAll(b.map(function(b){return i(a,b,c)})).then(function(){})}function i(a,b,c){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var d=b.permittedIdentitiesPerDevice;for(var e=0;e<c.length;e++){var f=c[e];d["delete"](f)}if(d.size===0)return a.appData["delete"](b.appDataId).then(function(){});else return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:d}).then(function(){})})}g.writeAppDataReceipts=a;g.writeAppDataReceiptsInternal=h}),98);
__d("MAWWritePeerMsgReceiptsApi",["MAWDbMsgTxns","MAWDbPendingReceiptTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWMarkThreadAsReadTxns","MAWTransactionMode","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," receipt for messages not from me"]);h=function(){return a};return a}function i(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a==null||a.type===d("WAMsgType").MSG_TYPE.CIPHERTEXT?{msg:b,readReceipt:c,type:"missing"}:{dbMsg:a,msg:b,readReceipt:c,type:"found"}})}function j(a){var b=new Map();a.forEach(function(a){if(a.type==="missing")return;var c=a.dbMsg.thread;a=a.dbMsg.msgId;var d=b.get(c);(d==null||a>d)&&b.set(c,a)});return b}function k(a,b){b=b.map(function(a){d("WALogger").LOG(h(),a.type);if(a.type==="delivered")return;var b={device:void 0,ts:void 0};a.receivers.forEach(function(a){var c=a.device;a=a.ts;var e=d("WAJids").extractUserJid(c);e===d("MAWGlobals").getMyUserJid()&&(b.ts==null||a<b.ts)&&(b.device=c,b.ts=a)});if(b.device!=null&&b.ts!=null)return babelHelpers["extends"]({},a,{receivers:{device:b.device,ts:b.ts}});else return}).filter(Boolean);if(b.length==0)return d("MAWDexieTable").dexieResolve();var c=[];b.forEach(function(a){a.msgs.forEach(function(b){c.push([b,a.receivers])})});return d("MAWDexieTable").dexieAll(c.map(function(b){var c=b[0];b=b[1];return i(a,c,b)})).then(function(b){var c=[],e=[];b.map(function(a){a.type==="missing"?c.push({author:a.msg.author,deliveryReceipts:[],externalId:a.msg.externalId,readReceipts:[a.readReceipt],thread:a.msg.chat}):e.push({msgId:a.msg,ts:a.readReceipt.ts})});var f=j(b);b=Array.from(f.keys()).map(function(a){var b=f.get(a);if(b!=null)return{threadId:a,upToMsgId:b};else return null}).filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,c),d("MAWMarkThreadAsReadTxns").bulkMarkThreadAsReadUpToMsgId(a,b),d("MAWEphemeralMsgTxns").bulkMarkEphemeralMessageAsRead(a,e)]).then(function(){})})}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,pendingReceipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("writePeerReceiptsForMsgsNotFromMe",!1)))(function(a,b,c,d){return k(a,[{msgs:b,receivers:d,type:c}])});g.bulkWritePeerReceiptsForMsgsNotFromMeInternal=k;g.writePeerReceiptsForMsgsNotFromMe=a}),98);
__d("MAWBulkWriteReceiptsApi",["MAWDexieTable","MAWIncomingReceiptTxns","MAWIndexedDb","MAWTransactionMode","MAWWriteAppDataReceiptsApi","MAWWritePeerMsgReceiptsApi","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE,chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingReceipts:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY},c("qpl")._(25297955,"552"))(function(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=[],e=[],f=[];b.forEach(function(a){switch(a.type){case"msg-receipt":c.push(a.params);break;case"not-from-me":e.push(a.params);break;default:f.push(a.params);break}});var g=d("MAWDexieTable").dexieResolve();f.forEach(function(b){var c=b.externalIds,e=b.receivers;g=g.then(function(){return d("MAWWriteAppDataReceiptsApi").writeAppDataReceiptsInternal(a,c,e)})});return d("MAWDexieTable").dexieAll([c.length>0?d("MAWIncomingReceiptTxns").bulkHandleIncomingReceipts(a,c):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWWritePeerMsgReceiptsApi").bulkWritePeerReceiptsForMsgsNotFromMeInternal(a,e):d("MAWDexieTable").dexieResolve(),g]).then(function(){})});g.bulkWriteReceipts=a}),98);
__d("MAWStanzaQueueReceipt",["MAWBulkWriteReceiptsApi","WAHandleReceipt","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.map(function(a){return d("WAHandleReceipt").receiptMapper(a.receipt)});return d("MAWBulkWriteReceiptsApi").bulkWriteReceipts(a).then(function(){return d("WAResultOrError").makeResult()})}g.handleIncomingReceiptStanza=a}),98);
__d("MAWProcessStanzaQueue",["MAWHandleRetryRequest","MAWStanzaGroupBy","MAWStanzaQueueMsg","MAWStanzaQueueNotification","MAWStanzaQueueReceipt","MAWTransactor","Promise","WAIncomingStanza","WALogger","WAPromiseQueue","WAResultOrError","promiseDone","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing batch, see transactor error reports"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got unhandled message type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Receipt consumer: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Notification consumer: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Messages consumer: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["invoked ",""]);m=function(){return a};return a}function n(a){c("promiseDone")(d("MAWHandleRetryRequest").bulkHandleRetryRequest(a.map(function(a){a=a.retry;return a})))}var o=d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaConsumer"]);function a(a,c,e){var f,g,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:o.LOG(m(),a);f=d("MAWStanzaGroupBy").groupStanzaEntryByOperation(c),g=f.groupedStanzas,p=f.retryStanzas;e.addPoint("persist_start");u.next=5;return b("regeneratorRuntime").awrap(d("MAWTransactor").runInBulkTransaction(function(){return b("Promise").allSettled(g.flatMap(function(a){switch(a.type){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:return d("MAWStanzaQueueMsg").handleIncomingMessagesStanzas(a.items)["catch"](function(a){o.ERROR(l(),a);return b("Promise").reject(a)});case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:return d("MAWStanzaQueueNotification").handleIncomingNotificationStanzas(a.items).map(function(a){return a["catch"](function(a){o.ERROR(k(),a);return b("Promise").reject(a)})});case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:return d("MAWStanzaQueueReceipt").handleIncomingReceiptStanza(a.items)["catch"](function(a){o.ERROR(j(),a);return b("Promise").reject(a)});default:o.ERROR(i(),a.type);return b("Promise").reject("Got unhandled message type "+a.type)}}))}));case 5:q=u.sent;e.addPoint("persist_end");r=q.filter(function(a){return a.status==="fulfilled"});if(!(r.length!==q.length)){u.next=11;break}o.ERROR(h());return u.abrupt("return",d("WAResultOrError").makeError("persist_fail"));case 11:s=r.flatMap(function(a){return a.value}).filter(Boolean);t=new(d("WAPromiseQueue").PromiseQueue)();e.addPoint("follow_up_start");s.forEach(function(a){if(a.success===!0&&a.value!=null){var b=a.value;t.enqueue(function(){return b()})}});return u.abrupt("return",t.wait().then(function(){p.length>0&&(e.addPoint("process_retries"),n(p));e.addPoint("follow_up_end");return d("WAResultOrError").makeResult()})["catch"](function(){return d("WAResultOrError").makeError("follow_up_fail")}));case 16:case"end":return u.stop()}},null,this)}g.processStanzaQueue=a}),98);
__d("MAWStanzaQueueConsumerStats",["MAWQplProxy","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed:\nTime taken: "," ms;\nEnd time: ",";\n"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Succeeded:\nId: ",";\nStanzas: ",";\nTime taken: "," ms;\nEnd time: ",";"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Start:\nId: ",";\nConsumer: ",";\nStanzas: ",";\nBucket description: ",";\nStart time: ",";"]);j=function(){return a};return a}var k=500,l=0;a=function(){function a(a,b,e){var f=Math.floor(a/k);this.$1=d("MAWQplProxy").performanceAbsoluteNow();this.$2=a;this.$3=++l;f="["+f*k+"-"+(f+1)*k+")";d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaConsumer"]).LOG(j(),this.$3,b,a,f,this.$1);this.userFlow=d("MAWQplProxy").startQplUserFlow(c("qpl")._(1056845300,"1338"),babelHelpers["extends"]({},e,{bool:{firstConsumer:this.$3===1},"int":{size:a},string:{bucket:f,version:b}}))}var b=a.prototype;b.addPoint=function(a,b){this.userFlow.addPoint(a,b)};b.endSuccess=function(a){var b=d("MAWQplProxy").performanceAbsoluteNow();this.userFlow.endSuccess(a);d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaConsumer"]).LOG(i(),this.$3,this.$2,b-this.$1,b)};b.endFail=function(a,b){var c=d("MAWQplProxy").performanceAbsoluteNow();this.userFlow.endFail(a,b);d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaConsumer"]).WARN(h(),c-this.$1,c)};return a}();g.StanzaQueueStats=a}),98);
__d("MAWAllStanzaSubscriber",["MAWProcessStanzaQueue","MAWStanzaQueueConsumerStats","WALogger","WAPromiseQueue","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["StanzaQueue consumer fails: ",""]);h=function(){return a};return a}var i=new(d("WAPromiseQueue").PromiseQueue)();function a(a,b){return i.enqueue(function(){var c="all_stanza_consumer",e=new(d("MAWStanzaQueueConsumerStats").StanzaQueueStats)(a.length,c);return d("MAWProcessStanzaQueue").processStanzaQueue(c,a,e).then(function(c){if(c.success){e.endSuccess();b(a.map(function(a){return a.stanzaQueueId}));return d("WAResultOrError").makeResult()}else{e.endFail(((c=c.payload)==null?void 0:c.name)||"");return d("WAResultOrError").makeError()}})["catch"](function(a){d("WALogger").TAGS(["ServerRPC","StanzaQueue","StanzaConsumer"]).ERROR(h(),a);e.endFail("unexpected_error");return d("WAResultOrError").makeError()})})}g.allStanzaSubscriber=a}),98);
__d("MAWGetSortedThreadJidsApi",["MAWDbThreadTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","sortBy"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getSortedThreadJidsApi",!1)))(function(a){return d("MAWDbThreadTxns").getAllThreads(a).then(function(a){return c("sortBy")(a,function(a){return a.threadOrder}).map(function(a){return a.jid})})});g.getSortedThreadJidsApi=a}),98);
__d("MAWChatStanzaSubscriber",["MAWGetSortedThreadJidsApi","MAWProcessStanzaQueue","MAWStanzaGroupBy","MAWStanzaQueueConsumerStats","WAPromiseQueue","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWGetSortedThreadJidsApi").getSortedThreadJidsApi());case 2:c=e.sent;return e.abrupt("return",c.concat(a.filter(function(a){return!c.includes(a)})));case 4:case"end":return e.stop()}},null,this)}function a(a){var c,e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c="chat_stanza_consumer";e=new(d("MAWStanzaQueueConsumerStats").StanzaQueueStats)(a.length,c);f=d("MAWStanzaGroupBy").groupStanzaEntryByChatJid(a);g=new(d("WAPromiseQueue").PromiseQueue)();j.next=6;return b("regeneratorRuntime").awrap(h(Array.from(f.keys())));case 6:i=j.sent;i.filter(function(a){return f.has(a)}).forEach(function(a){var b=f.get(a)||[];g.enqueue(function(){return d("MAWProcessStanzaQueue").processStanzaQueue("chat_stanza_consumer",b,e).then(function(a){if(a.success){e.endSuccess();return d("WAResultOrError").makeResult()}else{e.endFail(((a=a.payload)==null?void 0:a.name)||"");return d("WAResultOrError").makeError()}})})});return j.abrupt("return",g.wait().then(function(){return d("WAResultOrError").makeResult()})["catch"](function(){return d("WAResultOrError").makeError()}));case 9:case"end":return j.stop()}},null,this)}g.chatStanzaSubscriber=a}),98);
__d("MAWStanzaQueueInit",["MAWAllStanzaSubscriber","MAWChatStanzaSubscriber","MAWGating","WAStanzaQueueState"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWGating").enableStanzaQueueChatProcessing()?d("MAWChatStanzaSubscriber").chatStanzaSubscriber:d("MAWAllStanzaSubscriber").allStanzaSubscriber;d("WAStanzaQueueState").initStanzaQueue(a)}g.initStanzaQueue=a}),98);
__d("MAWSyncdBootstrap",["MAWRunInTransaction","WASyncdConst","WASyncdSyncAllCollections","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:a=Array.from(d("WASyncdConst").CollectionName.members());e.next=3;return b("regeneratorRuntime").awrap(d("MAWRunInTransaction").runInTransaction({CollectionVersionStore:!0},function(b){b=b.CollectionVersionStore;return b.bulkGet(a)}));case 3:c=e.sent;return e.abrupt("return",a.length!==c.filter(Boolean).length);case 5:case"end":return e.stop()}},null,this)}function c(){return d("WASyncdSyncAllCollections").syncdSyncAllCollectionsFn()}g.isBootstrapNeeded=a;g.bootstrapSyncd=c}),98);
__d("MAWSyncd",["MAWSyncdBootstrap","Promise","WALogger","WAScheduleAfterOfflineResume","WASyncd","WASyncdDisabled","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting syncd..."]);h=function(){return a};return a}function a(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:if(!d("WASyncdDisabled").isSyncdDisabled()){a.next=2;break}return a.abrupt("return");case 2:d("WALogger").LOG(h());a.next=5;return b("regeneratorRuntime").awrap(i());case 5:a.next=7;return b("regeneratorRuntime").awrap(d("WASyncd").initializeStateMachine());case 7:a.next=9;return b("regeneratorRuntime").awrap(d("MAWSyncdBootstrap").isBootstrapNeeded());case 9:if(!a.sent){a.next=12;break}a.next=12;return b("regeneratorRuntime").awrap(d("MAWSyncdBootstrap").bootstrapSyncd());case 12:d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:d("WASyncd").processOnAppResume,id:"syncdOnAppResume"});case 13:case"end":return a.stop()}},null,this)}function i(){return b("Promise").resolve()}g.initializeSyncd=a}),98);
__d("MAWDeleteOrphanedReactionsApi",["MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=90*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{reactions:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("deleteOrphanedReactions",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.reactions.filter(function(a){return a.reactToMsgId==null&&a.ts<b-h}).toArray().then(function(b){var c=b.map(function(a){return a.rowId});c=a.reactions.bulkDelete(c);return d("MAWDexieTable").dexieAll(c).then(function(){return d("MAWDexieTable").dexieResolve(b.length)})})});g.DELETE_ORPHANED_TIMESPAN=h;g.deleteOrphanedReactions=a}),98);
__d("MAWPreKeysCleaner",["WACryptoManagerUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=60*d("WATimeUtils").DAY_SECONDS;function a(){return d("WACryptoManagerUtils").getPreKeyGenerationsTimestamps().then(function(a){a=i(a);if(a.length>0)return d("WACryptoManagerUtils").deletePreKeyGenerations(a)})}function i(a){var b=[];for(var c=0;c+2<a.length;++c)d("WATimeUtils").happenedWithin(a[c+2].timestamp,h)||b.push(a[c].id);return b}g.EXPIRATION_SECONDS=h;g.clearExpiredPreKeys=a}),98);
__d("WATaskScheduler",["Promise","WAErr","WALogger","WAPromiseBackoffs","WATimeUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["startScheduler invoked"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Task "," failed, try again later: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Task "," will try again later"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Task "," complete, waiting ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Task "," complete, deactivating"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Firing task ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduling task "," in ","ms"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Task "," deactivated"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Tried to start task "," before registering its implementation"]);p=function(){return a};return a}var q="no_reschedule",r=function(){function a(a){this.$1=!1,this.$2={},this.$3={},this.$4={},this.$5=new Map(),this.$6=a.scheduledTimeResolver}var c=a.prototype;c.$7=function(a){var c=this,e=this.$5.get(a);if(e==null){d("WALogger").ERROR(p(),a).devConsole("start-task-without-impl");return}this.$6.get(a).then(function(f){var g=f==null,h=!g&&f===d("WATimeUtils").DEFAULT_UNIXTIME;if(h){d("WALogger").LOG(o(),a);return}h=f==null?0:f*1e3-d("WATimeUtils").unixTimeMs();h=Math.max(0,h);h=Math.min(h,~(1<<31));d("WALogger").LOG(n(),a,h);c.$4[a]=setTimeout(function(){delete c.$4[a],d("WALogger").LOG(m(),a),e(g).then(function(e){if(e==="no_reschedule")return new(b("Promise"))(function(){});var f;e===d("WATimeUtils").DEFAULT_UNIXTIME?(d("WALogger").LOG(l(),a),delete c.$3[a],f=d("WATimeUtils").DEFAULT_UNIXTIME):e>=0?(d("WALogger").LOG(k(),a,e),delete c.$3[a],f=d("WATimeUtils").futureUnixTime(e)):(d("WALogger").LOG(j(),a),f=c.$8(a));return c.$6.set(a,f)}).then(function(){c.$7(a),c.$2[a]&&(c.$2[a].forEach(function(a){return a()}),delete c.$2[a])})["catch"](function(b){d("WALogger").LOG(i(),a,b);return c.$6.set(a,c.$8(a)).then(function(){c.$7(a)})})},h)})};c.$8=function(a){this.$3[a]||(this.$3[a]=d("WAPromiseBackoffs").createTimer({jitter:.1,max:d("WATimeUtils").HOUR_SECONDS*1e3,algo:{type:"fibonacci",first:1e3,second:2e3}}));return d("WATimeUtils").futureUnixTime(Math.round(this.$3[a]()/1e3))};c.$9=function(a,b){this.$2[a]||(this.$2[a]=[]),this.$2[a].push(b)};c.awaitTaskPromise=function(a){var c=this;return new(b("Promise"))(function(b){c.$9(a,b)})};c.reschedule=function(a,b){this.$1?(this.$6.set(a,b),this.$4[a]!=null&&clearTimeout(this.$4[a]),this.$7(a)):this.$6.set(a,b)};c.registerTask=function(a,b){this.$1||(this.$1=!0),this.$5.set(a,b),this.$7(a)};c.getScheduledTime=function(a){return this.$6.get(a)};return a}(),s=null;function a(a){d("WALogger").LOG(h()),s||(s=new r(a))}function e(a){var b=x("awaitTaskPromise");return b.awaitTaskPromise(a)}function t(a,b){var c=x("reschedule");c.reschedule(a,b)}function f(a){t(a,d("WATimeUtils").unixTime())}function u(a){t(a,d("WATimeUtils").DEFAULT_UNIXTIME)}function v(a){var b=x("getScheduledTime");return b.getScheduledTime(a)}function w(a,b){var c=x("registerTask");c.registerTask(a,b)}function x(a){if(s)return s;else throw c("WAErr")("TaskScheduler::"+a+" called before startScheduler")}g.DO_NOT_RESCHEDULE=q;g.startScheduler=a;g.awaitTaskPromise=e;g.reschedule=t;g.rescheduleNow=f;g.deactivate=u;g.getScheduledTime=v;g.registerTask=w}),98);
__d("MAWTaskDefinitions",["MAWAbProps","MAWDbTasks","MAWDeleteOrphanedReactionsApi","MAWGating","MAWGlobals","MAWJobDefinitions","MAWPreKeysCleaner","MAWRotateCAT","Promise","WAJobOrchestratorTypes","WALogger","WASyncdDisabled","WATaskScheduler","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to notify "," contacts of device change"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Notified "," contacts of device change"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["requestAllSyncdMissingKeys skip first run"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncdSyncAllCollections skip first run"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateCAT skip first run"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeleteExpiredPreKeys skip first run"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["RotateKeyTask skip first run"]);o=function(){return a};return a}var p=27*d("WATimeUtils").DAY_SECONDS,q=7*d("WATimeUtils").DAY_SECONDS,r=d("WATimeUtils").DAY_SECONDS/2,s=d("WATimeUtils").HOUR_SECONDS*6,t=Object.keys(d("MAWDbTasks").Tasks);function u(){return{scheduledTimeResolver:{get:function(a){return d("MAWGlobals").getDbImpls().getTaskScheduledTime(a)},set:function(a,b){return d("MAWGlobals").getDbImpls().setTaskScheduledTime(a,b)}}}}function a(a){d("WATaskScheduler").startScheduler(u()),t.forEach(function(b){var c=v(b,a);d("WATaskScheduler").registerTask(b,c)})}function v(a,c){switch(a){case"rotateKey":return function(a){a?(d("WALogger").LOG(o()),a=b("Promise").resolve()):a=d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.rotateSignedPreKey());return a.then(function(){return p})};case"syncAbProps":return function(a){var b=!a;return c.then(function(){return d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.syncAbProps(b)).then(function(){return d("MAWAbProps").getRefreshSecs()})})};case"deleteExpiredKeys":return function(a){a?(d("WALogger").LOG(n()),a=b("Promise").resolve()):a=d("MAWPreKeysCleaner").clearExpiredPreKeys();return a.then(function(){return q})};case"rotateCAT":return function(a){a?(d("WALogger").LOG(m()),a=b("Promise").resolve()):a=d("MAWRotateCAT").tryRotateCAT();return a.then(function(){return r})};case"generatePrekeys":return function(a){a?a=d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.generateAndUploadPreKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})):a=b("Promise").resolve();return a.then(function(){return d("WATimeUtils").DEFAULT_UNIXTIME})};case"queryGroups":return function(a){a&&!d("MAWGating").isOccamadillo()?a=d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.queryGroups()):a=b("Promise").resolve();return a.then(function(){return d("WATimeUtils").DEFAULT_UNIXTIME})};case"deleteOrphanedReactions":return function(){var a=d("MAWGating").isReactionsCleanerEnabled()?d("MAWDeleteOrphanedReactionsApi").deleteOrphanedReactions():b("Promise").resolve();return a.then(function(){return d("WATimeUtils").DAY_SECONDS})};case"syncdSyncAllCollections":return function(a){a||d("WASyncdDisabled").isSyncdDisabled()?(d("WALogger").LOG(l()),a=b("Promise").resolve()):a=d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.syncdSyncAllCollections({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));return a.then(function(){return d("WATimeUtils").DAY_SECONDS})};case"requestAllSyncdMissingKeys":return function(a){a||d("WASyncdDisabled").isSyncdDisabled()?(d("WALogger").LOG(k()),a=b("Promise").resolve()):a=d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.requestAllSyncdMissingKeys({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));return a.then(function(){return s})};case"notifyDeviceRegistration":return function(a){if(!a)return b("Promise").resolve(d("WATimeUtils").DEFAULT_UNIXTIME);a=d("MAWGlobals").getMyUserJid();return d("MAWGlobals").getDbImpls().loadRecentParticipants(d("MAWGlobals").getConfig().maxUsersForNotifyDeviceChange(),a).then(function(a){var b=d("WALogger").TAGS(["notifyDeviceRegistration"]);return d("MAWGlobals").getJobManager().waitUntilCompletedNonPersisted(d("MAWJobDefinitions").jobSerializers.notifyDeviceChange(a)).then(function(){b.LOG(j(),a.size)})["catch"](function(c){b.LOG(i(),a.size),b.ERROR(h(),c)})}).then(function(){return d("WATimeUtils").DEFAULT_UNIXTIME})}}}g.ROTATE_SIGNED_PRE_KEY_TIMESPAN=p;g.DELETE_EXPIRED_KEYS_TIMESPAN=q;g.ROTATE_CAT_TIMESPAN=r;g.DO_NOT_RESCHEDULE=d("WATimeUtils").DEFAULT_UNIXTIME;g.DELETE_ORPHANED_REACTIONS_TIMESPAN=d("WATimeUtils").DAY_SECONDS;g.SYNCD_SYNC_ALL_COLLECTIONS_TIMESPAN=d("WATimeUtils").DAY_SECONDS;g.SYNCD_REQUEST_ALL_MISSING_KEYS_TIMESPAN=s;g.TASK_TYPES=t;g.getSchedulerOptions=u;g.registerTasks=a;g.getTaskExecution=v}),98);
__d("WABackendHandleError",["Promise","WALogger","WAWapParser"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown error code: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid stanza sent (smax-invalid)"]);i=function(){return a};return a}var j={SMAX_INVALID:479},k=new(d("WAWapParser").WapParser)("errorParser",function(a){a.assertTag("error");a=a.attrInt("code");switch(a){case j.SMAX_INVALID:return l();default:return m(a)}});function a(a){k.parse(a);return b("Promise").resolve("NO_ACK")}function l(){d("WALogger").ERROR(i()).devConsole("check tracelogs for more info").sendLogs("smax-invalid")}function m(a){d("WALogger").ERROR(h(),a).sendLogs("unknown-error-code")}g.backendErrorParser=k;g.handleError=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);
__d("WAGetClockSkewApi",["WAGlobals","regeneratorRuntime"],(function(a,b,c,d,e,f,g){a=function(){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(a){var c,d,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:c=a.MetaInfoStore;f.next=3;return b("regeneratorRuntime").awrap(c.get());case 3:d=f.sent;e=d.clockSkew;return f.abrupt("return",{clockSkew:e||0});case 6:case"end":return f.stop()}},null,this)},"getClockSkew")};g.getClockSkew=a}),98);
__d("WASmaxInDirtyBitsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","400");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInDirtyBitsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","501");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInDirtyBitsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","500");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInDirtyBitsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"code","503");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInDirtyBitsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup",["WAResultOrError","WASmaxInDirtyBitsIQErrorBadRequestMixin","WASmaxInDirtyBitsIQErrorFeatureNotImplementedMixin","WASmaxInDirtyBitsIQErrorInternalServerErrorMixin","WASmaxInDirtyBitsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDirtyBitsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInDirtyBitsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value});var e=d("WASmaxInDirtyBitsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:e.value});var f=d("WASmaxInDirtyBitsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented","IQErrorServiceUnavailable","IQErrorInternalServerError"],[b,c,e,f])}g.parseIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup=a}),98);
__d("WASmaxInDirtyBitsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInDirtyBitsCleanResponseError",["WAResultOrError","WASmaxInDirtyBitsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup","WASmaxInDirtyBitsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDirtyBitsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDirtyBitsIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup").parseIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrFeatureNotImplementedOrServiceUnavailableOrInternalServerErrorMixinGroup:b.value}))}g.parseCleanResponseError=a}),98);
__d("WASmaxInDirtyBitsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInDirtyBitsCleanResponseSuccess",["WASmaxInDirtyBitsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDirtyBitsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseCleanResponseSuccess=a}),98);
__d("WASmaxOutDirtyBitsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutDirtyBitsCleanLegacyTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.cleanType;a=a.cleanTimestamp;b=d("WASmaxJsx").smax("clean",{type:d("WAWap").CUSTOM_STRING(b),timestamp:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeCleanLegacyTypeMixin=a}),98);
__d("WASmaxOutDirtyBitsCleanModernTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.cleanTimestamp;a=d("WASmaxJsx").smax("clean",{type:"syncd_app_state",timestamp:d("WAWap").INT(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeCleanModernTypeMixin=a}),98);
__d("WASmaxOutDirtyBitsCleanLegacyOrCleanModernTypeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutDirtyBitsCleanLegacyTypeMixin","WASmaxOutDirtyBitsCleanModernTypeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.cleanLegacyType)return d("WASmaxOutDirtyBitsCleanLegacyTypeMixin").mergeCleanLegacyTypeMixin(a,b.cleanLegacyType);if(b.cleanModernType)return d("WASmaxOutDirtyBitsCleanModernTypeMixin").mergeCleanModernTypeMixin(a,b.cleanModernType);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeCleanLegacyOrCleanModernTypeMixinGroup=a}),98);
__d("WASmaxOutDirtyBitsCleanRequest",["WASmaxJsx","WASmaxOutDirtyBitsBaseIQSetRequestMixin","WASmaxOutDirtyBitsCleanLegacyOrCleanModernTypeMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.cleanLegacyOrCleanModernTypeMixinGroupArgs;a=d("WASmaxOutDirtyBitsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"urn:xmpp:whatsapp:dirty"},d("WASmaxOutDirtyBitsCleanLegacyOrCleanModernTypeMixinGroup").mergeCleanLegacyOrCleanModernTypeMixinGroup(d("WASmaxJsx").smax("clean",null),a)));return a}g.makeCleanRequest=a}),98);
__d("WASmaxDirtyBitsCleanRPC",["WAComms","WASmaxInDirtyBitsCleanResponseError","WASmaxInDirtyBitsCleanResponseSuccess","WASmaxOutDirtyBitsCleanRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutDirtyBitsCleanRequest").makeCleanRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInDirtyBitsCleanResponseSuccess").parseCleanResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"CleanResponseSuccess",value:g.value});case 7:h=d("WASmaxInDirtyBitsCleanResponseError").parseCleanResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"CleanResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Clean",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendCleanRPC=a}),98);
__d("WACleanDirtyBitsProtocol",["WALogger","WASmaxDirtyBitsCleanRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to clean dirty bits for type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendCleanRPC error: ",""]);i=function(){return a};return a}function a(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:a.type==="syncd_app_state"?c={cleanModernType:{cleanTimestamp:a.timestamp}}:c={cleanLegacyType:{cleanTimestamp:a.timestamp,cleanType:a.type}};f.next=3;return b("regeneratorRuntime").awrap(d("WASmaxDirtyBitsCleanRPC").sendCleanRPC({cleanLegacyOrCleanModernTypeMixinGroupArgs:c}));case 3:e=f.sent,e.name!=="CleanResponseSuccess"&&(d("WALogger").WARN(i(),e),d("WALogger").ERROR(h(),a.type));case 5:case"end":return f.stop()}},null,this)}g.cleanDirtyBitsProtocol=a}),98);
__d("WAHandleDirtyBits",["Promise","WACleanDirtyBitsProtocol","WALogger","WASyncdDisabled","WASyncdSyncAllCollections","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unhandled dirty bit type: ",""]);h=function(){return a};return a}c={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};function a(a){return b("Promise").all(a.values.map(function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.t0=a.type;c.next=c.t0==="syncd_app_state"?3:7;break;case 3:if(d("WASyncdDisabled").isSyncdDisabled()){c.next=6;break}c.next=6;return b("regeneratorRuntime").awrap(d("WASyncdSyncAllCollections").syncdSyncAllCollectionsFn());case 6:return c.abrupt("break",8);case 7:d("WALogger").WARN(h(),a.type);case 8:return c.abrupt("return",d("WACleanDirtyBitsProtocol").cleanDirtyBitsProtocol(a));case 9:case"end":return c.stop()}},null,this)})).then(function(){})}g.DIRTY_BIT_TYPES=c;g.handleDirtyBits=a}),98);
__d("WASetRoutingInfoApi",["WAGlobals"],(function(a,b,c,d,e,f,g){a=function(a){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(b){b=b.MetaInfoStore;var c=a.edgeInfo;return b.patch({edgeInfo:c!=null?c:void 0})},"setRoutingInfo")};g.setRoutingInfo=a}),98);
__d("WASmaxInDirtyBitsEnums",[],(function(a,b,c,d,e,f){a={account_sync:"account_sync",groups:"groups",syncd_app_state:"syncd_app_state"};f.ENUM_ACCOUNTSYNC_GROUPS_SYNCDAPPSTATE=a}),66);
__d("WASmaxInDirtyBitsNotifyRequest",["WAResultOrError","WASmaxInDirtyBitsEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"dirty");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;var c=d("WASmaxParseUtils").attrIntRange(b.value,"timestamp",0,void 0);if(!c.success)return c;b=d("WASmaxParseUtils").attrStringEnum(b.value,"type",d("WASmaxInDirtyBitsEnums").ENUM_ACCOUNTSYNC_GROUPS_SYNCDAPPSTATE);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,dirtyTimestamp:c.value,dirtyType:b.value})}g.parseNotifyRequest=a}),98);
__d("WASmaxDirtyBitsNotifyRPC",["WASmaxInDirtyBitsNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInDirtyBitsNotifyRequest").parseNotifyRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Request:a}));return{parsedRequest:a.value}}g.receiveNotifyRPC=a}),98);
__d("WASmaxInEdgeEdgeRoutingRequest",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"edge_routing");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"routing_info");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;b=d("WASmaxParseUtils").contentBytesRange(b.value,1,1024);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,edgeRoutingRoutingInfoElementValue:b.value})}g.parseEdgeRoutingRequest=a}),98);
__d("WASmaxEdgeEdgeRoutingRPC",["WASmaxInEdgeEdgeRoutingRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInEdgeEdgeRoutingRequest").parseEdgeRoutingRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("EdgeRouting",{Request:a}));return{parsedRequest:a.value}}g.receiveEdgeRoutingRPC=a}),98);
__d("WASmaxInMessageRequestEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={complete:"complete","continue":"continue"};b={validators:[d("WAJids").validateGroupJid,d("WAJids").validateUserJid],typeName:"GroupJid|UserJid"};g.ENUM_COMPLETE_CONTINUE=a;g.GROUPJID_USERJID=b}),98);
__d("WASmaxInMessageRequestSpamMarkerRequest",["WAResultOrError","WASmaxInMessageRequestEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"spam");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;b=d("WASmaxParseUtils").attrStringEnum(b.value,"state",d("WASmaxInMessageRequestEnums").ENUM_COMPLETE_CONTINUE);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,spamState:b.value})}g.parseSpamMarkerRequest=a}),98);
__d("WASmaxMessageRequestSpamMarkerRPC",["WASmaxInMessageRequestSpamMarkerRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInMessageRequestSpamMarkerRequest").parseSpamMarkerRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SpamMarker",{Request:a}));return{parsedRequest:a.value}}g.receiveSpamMarkerRPC=a}),98);
__d("WASmaxInOfflineCompletionRequest",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"offline");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"count",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,offlineCount:b.value})}g.parseCompletionRequest=a}),98);
__d("WASmaxOfflineCompletionRPC",["WASmaxInOfflineCompletionRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInOfflineCompletionRequest").parseCompletionRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Completion",{Request:a}));return{parsedRequest:a.value}}g.receiveCompletionRPC=a}),98);
__d("WASmaxInOfflinePreviewRequest",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"offline_preview");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;var c=d("WASmaxParseUtils").attrIntRange(b.value,"count",0,void 0);if(!c.success)return c;var e=d("WASmaxParseUtils").attrIntRange(b.value,"message",0,void 0);if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(b.value,"receipt",0,void 0);if(!f.success)return f;var g=d("WASmaxParseUtils").attrIntRange(b.value,"notification",0,void 0);if(!g.success)return g;b=d("WASmaxParseUtils").attrIntRange(b.value,"appdata",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,offlinePreviewCount:c.value,offlinePreviewMessage:e.value,offlinePreviewReceipt:f.value,offlinePreviewNotification:g.value,offlinePreviewAppdata:b.value})}g.parsePreviewRequest=a}),98);
__d("WASmaxOfflinePreviewRPC",["WASmaxInOfflinePreviewRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInOfflinePreviewRequest").parsePreviewRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Preview",{Request:a}));return{parsedRequest:a.value}}g.receivePreviewRPC=a}),98);
__d("WAHandleInfoBulletin",["Promise","WACryptoUtils","WAGetRoutingInfoApi","WAGlobals","WAHandleDirtyBits","WAJobDefinitions","WAJobs","WALogger","WASetRoutingInfoApi","WASmaxDecisionTreeUtils","WASmaxDirtyBitsNotifyRPC","WASmaxEdgeEdgeRoutingRPC","WASmaxMessageRequestSpamMarkerRPC","WASmaxOfflineCompletionRPC","WASmaxOfflinePreviewRPC"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin unrecognized info bulletin"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin unrecognized spam state"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin spam messages have been drained"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin continues to fetch spam messages"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin receives spam marker"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin setting edge info"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin no change to edge info"]);n=function(){return a};return a}function o(a){var b=d("WASmaxDecisionTreeUtils").firstChild(a);if(b.success===!1)return{type:"unknown"};b=b.value.tag;switch(b){case"edge_routing":b=d("WASmaxEdgeEdgeRoutingRPC").receiveEdgeRoutingRPC(a).parsedRequest;b=b.edgeRoutingRoutingInfoElementValue;return{type:"routing",edgeInfo:b};case"offline_preview":b=d("WASmaxOfflinePreviewRPC").receivePreviewRPC(a).parsedRequest;return{type:"offline-start",stats:{count:b.offlinePreviewCount,message:b.offlinePreviewMessage,receipt:b.offlinePreviewReceipt,notification:b.offlinePreviewNotification,appdata:b.offlinePreviewAppdata}};case"offline":b=d("WASmaxOfflineCompletionRPC").receiveCompletionRPC(a).parsedRequest.offlineCount;return{type:"offline-end",count:b};case"spam":b=d("WASmaxMessageRequestSpamMarkerRPC").receiveSpamMarkerRPC(a).parsedRequest.spamState;return{type:"spam",state:b};case"dirty":b=d("WASmaxDirtyBitsNotifyRPC").receiveNotifyRPC(a).parsedRequest;return{type:"dirty",values:[{type:b.dirtyType,timestamp:b.dirtyTimestamp}]};default:return{type:"unknown"}}}function p(a){switch(a.type){case"routing":var c=a.edgeInfo;return d("WAGetRoutingInfoApi").getRoutingInfo().then(function(a){a=a.edgeInfo;if(a!=null&&d("WACryptoUtils").uint8ArraysEqual(a,c))d("WALogger").LOG(n());else{d("WALogger").LOG(m());return d("WASetRoutingInfoApi").setRoutingInfo({edgeInfo:c})}}).then(function(){return"NO_ACK"});case"offline-start":var e;(e=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:e.offlineStart(a.stats);break;case"offline-end":(e=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:e.offlineEnd(a.count);break;case"spam":d("WALogger").LOG(l());e=a.state;if(e==="continue"){d("WALogger").LOG(k());return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.getSpams()).then(function(){return"NO_ACK"})}else if(e==="complete"){d("WALogger").LOG(j());return d("WAJobs").getJobManager().waitUntilPersisted(d("WAJobDefinitions").jobSerializers.handleSpamMsg()).then(function(){return"NO_ACK"})}else d("WALogger").WARN(i());break;case"dirty":return d("WAHandleDirtyBits").handleDirtyBits(a).then(function(){return"NO_ACK"});default:a.type,d("WALogger").WARN(h())}return b("Promise").resolve("NO_ACK")}function a(a){return p(o(a))}g.handleInfoBulletin=a}),98);
__d("WASmaxInStreamErrorEnums",[],(function(a,b,c,d,e,f){a={appdata:"appdata",call:"call",message:"message",notification:"notification",receipt:"receipt"};f.ENUM_APPDATA_CALL_MESSAGE_NOTIFICATION_RECEIPT=a}),66);
__d("WASmaxInStreamErrorAckKickRequest",["WAResultOrError","WASmaxInStreamErrorEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"ack");if(!b.success)return b;a=d("WASmaxParseUtils").attrStringEnum(b.value,"class",d("WASmaxInStreamErrorEnums").ENUM_APPDATA_CALL_MESSAGE_NOTIFICATION_RECEIPT);if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"type");if(!c.success)return c;b=d("WASmaxParseUtils").attrStanzaId(b.value,"id");return!b.success?b:d("WAResultOrError").makeResult({ackClass:a.value,ackType:c.value,ackId:b.value})}g.parseAckKickRequest=a}),98);
__d("WASmaxStreamErrorAckKickRPC",["WASmaxInStreamErrorAckKickRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorAckKickRequest").parseAckKickRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AckKick",{Request:a}));return{parsedRequest:a.value}}g.receiveAckKickRPC=a}),98);
__d("WASmaxInStreamErrorBadMacRequest",["WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"bad-mac");return!b.success?b:d("WASmaxParseUtils").voidSuccess}g.parseBadMacRequest=a}),98);
__d("WASmaxStreamErrorBadMacRPC",["WASmaxInStreamErrorBadMacRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorBadMacRequest").parseBadMacRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BadMac",{Request:a}));return{parsedRequest:a.value}}g.receiveBadMacRPC=a}),98);
__d("WASmaxInStreamErrorCodeRequest",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"code");return!b.success?b:d("WAResultOrError").makeResult({code:b.value})}g.parseCodeRequest=a}),98);
__d("WASmaxStreamErrorCodeRPC",["WASmaxInStreamErrorCodeRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorCodeRequest").parseCodeRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Code",{Request:a}));return{parsedRequest:a.value}}g.receiveCodeRPC=a}),98);
__d("WASmaxInStreamErrorConflictRequest",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"conflict");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"code");if(!a.success)return a;var c=d("WASmaxParseUtils").attrString(b.value,"type");if(!c.success)return c;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"reason");return!b.success?b:d("WAResultOrError").makeResult({code:a.value,conflictType:c.value,conflictReason:b.value})}g.parseConflictRequest=a}),98);
__d("WASmaxStreamErrorConflictRPC",["WASmaxInStreamErrorConflictRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorConflictRequest").parseConflictRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Conflict",{Request:a}));return{parsedRequest:a.value}}g.receiveConflictRPC=a}),98);
__d("WASmaxInStreamErrorPingKickRequest",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"ping");if(!b.success)return b;a=d("WASmaxParseUtils").attrStanzaId(b.value,"id");return!a.success?a:d("WAResultOrError").makeResult({pingId:a.value})}g.parsePingKickRequest=a}),98);
__d("WASmaxStreamErrorPingKickRPC",["WASmaxInStreamErrorPingKickRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorPingKickRequest").parsePingKickRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PingKick",{Request:a}));return{parsedRequest:a.value}}g.receivePingKickRPC=a}),98);
__d("WASmaxInStreamErrorXMLNotWellFormedRequest",["WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"stream:error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"xml-not-well-formed");return!b.success?b:d("WASmaxParseUtils").voidSuccess}g.parseXMLNotWellFormedRequest=a}),98);
__d("WASmaxStreamErrorXMLNotWellFormedRPC",["WASmaxInStreamErrorXMLNotWellFormedRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInStreamErrorXMLNotWellFormedRequest").parseXMLNotWellFormedRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("XMLNotWellFormed",{Request:a}));return{parsedRequest:a.value}}g.receiveXMLNotWellFormedRPC=a}),98);
__d("WAUnknownStanzaError",["WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAResultOrError").makeError({type:"unknown-stanza"});g.unknownStanzaError=a}),98);
__d("WACreateHandleStreamError",["Promise","WAResultOrError","WASmaxDecisionTreeUtils","WASmaxStreamErrorAckKickRPC","WASmaxStreamErrorBadMacRPC","WASmaxStreamErrorCodeRPC","WASmaxStreamErrorConflictRPC","WASmaxStreamErrorPingKickRPC","WASmaxStreamErrorXMLNotWellFormedRPC","WAUnknownStanzaError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c=a.md,e=a.streamError;return function(a){var f=d("WASmaxDecisionTreeUtils").firstChild(a);if(f.success){f=f.value;switch(f.tag){case"ack":f=d("WASmaxStreamErrorAckKickRPC").receiveAckKickRPC(a);f=f.parsedRequest;return e.handleAckKick(f).then(d("WAResultOrError").makeResult);case"ping":f=d("WASmaxStreamErrorPingKickRPC").receivePingKickRPC(a);f=f.parsedRequest;return e.handlePingKick(f).then(d("WAResultOrError").makeResult);case"xml-not-well-formed":d("WASmaxStreamErrorXMLNotWellFormedRPC").receiveXMLNotWellFormedRPC(a);return e.handleXmlNotWellFormed().then(d("WAResultOrError").makeResult);case"bad-mac":d("WASmaxStreamErrorBadMacRPC").receiveBadMacRPC(a);return e.handleBadMac().then(d("WAResultOrError").makeResult);case"conflict":f=d("WASmaxStreamErrorConflictRPC").receiveConflictRPC(a);f=f.parsedRequest;return e.handleConflict(f).then(d("WAResultOrError").makeResult);default:return b("Promise").resolve(d("WAUnknownStanzaError").unknownStanzaError)}}else{f=d("WASmaxStreamErrorCodeRPC").receiveCodeRPC(a);a=f.parsedRequest;f=a.code;switch(f){case"515":a=c==null?void 0:c.handleRegistrateCompanionSuccess;if(a!=null)return a().then(d("WAResultOrError").makeResult);break;case"516":a=c==null?void 0:c.handleRegistrateCompanionFailure;if(a!=null)return a().then(d("WAResultOrError").makeResult);break;default:return e.handleStreamErrorCode({code:f}).then(d("WAResultOrError").makeResult)}return b("Promise").resolve(d("WAUnknownStanzaError").unknownStanzaError)}}}g.createHandleStreamError=a}),98);
__d("WAHandleStreamError",["Promise","WACreateHandleStreamError","WAGlobals","WAHandleFailureUtils","WALogger","WAPREList","WAPREMetrics","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError received an unknown-stanza ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stream error of type "," is causing a closed socket"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Code "," stream:error is received"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conflict stream:error is received"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["bad-mac stream:error is received"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["xml-not-well-formed stream:error is received"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unacked ping id: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Client didn't send 'ack' back (type: ",", class: ","), closing socket, mode: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unacked id: ",""]);p=function(){return a};return a}a=function(a){var b=a.ackClass,c=a.ackId;a=a.ackType;var e="ack",f=s({type:e,subType:a,ackClass:b});d("WALogger").WARN(p(),c);d("WALogger").ERROR(o(),a,b,(c=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:c.getStatus());return t(e,f)};c=function(a){a=a.pingId;var b="ping",c=s({type:b});d("WALogger").WARN(n(),a);return t(b,c)};e=function(){var a="xml-not-well-formed",b=s({type:a});d("WALogger").WARN(m());return t(a,b)};f=function(){var a="bad-mac",b=s({type:a});d("WALogger").WARN(l());return t(a,b)};var q=function(a){var b=a.code;a=a.conflictReason;var c="conflict";b=Number(b);a=s({type:c,code:b,reason:a});if(b===d("WAHandleFailureUtils").FAILURE_CODES.NOT_AUTHORIZED)return u(a);d("WALogger").WARN(k());return t(c,a)},r=function(a){a=a.code;var b="other";d("WALogger").WARN(j(),a);a=Number(a);var c=s({type:b,code:a});return a===d("WAHandleFailureUtils").FAILURE_CODES.NOT_AUTHORIZED?u(c):t(b,c)};function s(a){var b=a.code,c=a.type,e=a.reason,f=a.subType;a=a.ackClass;return d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_FAILURE_STANZA,{"int":{code:b},string:{type:"stream:error",subtype:c,reason:e,reasonType:f,"class":a}})}function t(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:d("WALogger").WARN(i(),a);f.next=3;return b("regeneratorRuntime").awrap((e=d("WAGlobals").getServerRPC().offlineQueueManager())==null?void 0:e.connectionDropped());case 3:c.endSuccess();return f.abrupt("return","CLOSE_SOCKET");case 5:case"end":return f.stop()}},null,this)}function u(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.next=2;return b("regeneratorRuntime").awrap(d("WAHandleFailureUtils").deregisterPhone());case 2:a.endSuccess();return c.abrupt("return",b("Promise").resolve("NO_ACK"));case 4:case"end":return c.stop()}},null,this)}var v=d("WACreateHandleStreamError").createHandleStreamError({md:null,streamError:{handleAckKick:a,handleBadMac:f,handleConflict:q,handlePingKick:c,handleStreamErrorCode:r,handleXmlNotWellFormed:e}}),w=function(a){return v(a).then(function(b){if(b.success)return b.value;else{b.error.type;d("WALogger").WARN(h(),a.toString());return"CLOSE_SOCKET"}})};g.handleAckKick=a;g.handlePingKick=c;g.handleXmlNotWellFormed=e;g.handleBadMac=f;g.handleConflict=q;g.handleStreamErrorCode=r;g.handleStreamError=w}),98);
__d("WAHandleSuccess",["Promise","WAServerHandler","WAWapParser"],(function(a,b,c,d,e,f,g){a=new(d("WAWapParser").WapParser)("success",function(a){a.assertTag("success")});c=d("WAServerHandler").serverHandler("handleSuccess",a,function(){return b("Promise").resolve("NO_ACK")});g.successParser=a;g.handleSuccess=c}),98);
__d("WAOfflineQueueConfig",["WAErr","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OfflineQueue config is not defined"]);h=function(){return a};return a}var i;function a(){if(i==null){d("WALogger").TAGS(["ServerRPC"]).ERROR(h());throw c("WAErr")("[ServerRPC] OfflineQueue config is not defined")}return i}function b(a){var b=500,c=500,d=a.isPullMode?2e3:500;i={batchSize:function(){return b},cacheSize:function(){return d},minMsgAmountInBulk:function(){return c},isPullMode:function(){return a.isPullMode}}}g.getOfflineQueueConfig=a;g.initOfflineQueueConfig=b}),98);
__d("WAOfflineQueueTimers",["WALogger","WAOfflineUtils","WAShiftTimer"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Offline session completed by timeout."]);h=function(){return a};return a}var i=1e4,j=6e4;function a(a){var b=new(d("WAShiftTimer").ShiftTimer)(function(){a.flush("timer",{msgsAndNotifications:!0,receipts:!0,retryReceipts:!1})}),c=new(d("WAShiftTimer").ShiftTimer)(function(){if(a.getMode()===d("WAOfflineUtils").ServerRPCMode.ONLINE)return;d("WALogger").TAGS(["ServerRPC"]).ERROR(h());a.offlineEnd()});function e(){c.cancel(),c.onOrAfter(j)}function f(){c.cancel()}return{offlineComplete:{start:e,refresh:e,stop:f},flushCache:{refresh:function(){b.cancel(),b.onOrAfter(i)},stop:function(){b.cancel()}}}}g.makeOfflineQueueTimers=a}),98);
__d("WAThrottle",[],(function(a,b,c,d,e,f){function b(b,c){var d=0,e=null,f;function g(){var g=Date.now(),h=g-d;for(var i=arguments.length,j=new Array(i),k=0;k<i;k++)j[k]=arguments[k];f=j;h>=c?(a.clearTimeout(e),e=null,b.apply(void 0,j),d=Date.now()):e==null&&(e=a.setTimeout(function(){return b.apply(void 0,f)},c-h))}return g}f.throttle=b}),66);
__d("WAOfflineStats",["WABridge","WAGlobals","WAIncomingStanza","WALogger","WAOfflineUtils","WAPREList","WAPREMetrics","WAThrottle","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] offline failed as per ",". ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] offline completed.\ntime: "," sec;\nMsgs: "," / ",";\nNotifications: "," / ",";\nReceipts: "," / ",";\nmaxOffline: ",";\n"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] "," offline stanzas,\n"," messages,\n"," receipts,\n"," notifications,\n"," appdatas"]);j=function(){return a};return a}var k=500,l=200,m=1e3/3;a=function(){function a(){var a=this;this.downloadedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0};this.expectedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0};this.processedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0};this.isBatchRequested=!1;this.$2=0;this.$3=0;this.$4=d("WAOfflineUtils").OfflineStatus.Initializing;this.$5=null;this.$6=0;this.$7=0;this.$8=0;this.$9=0;this.$10=0;this.$11=0;this.$13=d("WAThrottle").throttle(function(){a.$4===d("WAOfflineUtils").OfflineStatus.Processing&&a.$12()},m)}var b=a.prototype;b.start=function(a,b){if(!this.$1){var c=Math.floor(a.count/k),e=Math.floor(a.message/l);this.$1=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.OFFLINE_QUEUE,{string:{mode:b,stanzaBucket:"["+c*k+"-"+(c+1)*k+")",messageBucket:"["+e*l+"-"+(e+1)*l+")"},bool:{stanzaQueue:d("WAGlobals").getConfig().enableRawStanzaQueueStore(),stanzaQueueRetries:!1}});this.$2=d("WATimeUtils").performanceAbsoluteNow()}b=a.count;c=a.appdata;e=a.message;var f=a.notification;a=a.receipt;this.expectedStanzas.count+=b;this.expectedStanzas.appdata+=c;this.expectedStanzas.message+=e;this.expectedStanzas.notification+=f;this.expectedStanzas.receipt+=a;this.$4=d("WAOfflineUtils").OfflineStatus.Initializing;this.$12();d("WALogger").LOG(j(),b,e,a,f,c)};b.complete=function(){var a,b={"int":babelHelpers["extends"]({},this.expectedStanzas,{processedStanzasCount:this.downloadedStanzas.count,maxOffline:this.$3,queryGroup:this.$7,queryGroupInvite:this.$8,errors:this.$10,decryptionErrors:this.$9,retries:this.$11})},c=d("WATimeUtils").performanceAbsoluteNow()-this.getStartTime();(a=this.$1)==null?void 0:a.endSuccess(b);d("WALogger").LOG(i(),c/1e3,this.downloadedStanzas.message,this.expectedStanzas.message,this.downloadedStanzas.notification,this.expectedStanzas.notification,this.downloadedStanzas.receipt,this.expectedStanzas.receipt,this.$3);this.$4=d("WAOfflineUtils").OfflineStatus.Complete;this.$12();this.clear()};b.track=function(a){var b;this.$4=d("WAOfflineUtils").OfflineStatus.Processing;this.$7+=(b=a.queryGroup)!=null?b:0;this.$8+=(b=a.queryGroupInvite)!=null?b:0;this.$9+=(b=a.decryptErrors)!=null?b:0;this.$10+=(b=a.errors)!=null?b:0;this.$11+=(b=a.retries)!=null?b:0;this.processedStanzas.appdata+=(b=(b=a.processedStanzas)==null?void 0:b.appdata)!=null?b:0;this.processedStanzas.message+=(b=(b=a.processedStanzas)==null?void 0:b.message)!=null?b:0;this.processedStanzas.notification+=(b=(b=a.processedStanzas)==null?void 0:b.notification)!=null?b:0;this.processedStanzas.receipt+=(a=(b=a.processedStanzas)==null?void 0:b.receipt)!=null?a:0;this.processedStanzas.count=this.processedStanzas.appdata+this.processedStanzas.message+this.processedStanzas.notification+this.processedStanzas.receipt;this.$13()};b.offlinePreviewEndReport=function(){this.expectedStanzas.count===0&&(this.$4=d("WAOfflineUtils").OfflineStatus.Complete,this.$12())};b.drop=function(a){var b,c={"int":babelHelpers["extends"]({},this.expectedStanzas,{processedStanzasCount:this.downloadedStanzas.count,maxOffline:this.$3,queryGroup:this.$7,queryGroupInvite:this.$8,errors:this.$10,decryptionErrors:this.$9,retries:this.$11})},e=d("WATimeUtils").performanceAbsoluteNow()-this.getStartTime();(b=this.$1)==null?void 0:b.endFail(a,c);d("WALogger").LOG(h(),a,babelHelpers["extends"]({},c["int"],{timeTaken:e}));this.$4=d("WAOfflineUtils").OfflineStatus.Failed;this.$5=a;this.$12();this.clear()};b.clear=function(){this.downloadedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0},this.expectedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0},this.processedStanzas={count:0,appdata:0,message:0,notification:0,receipt:0},this.$4=d("WAOfflineUtils").OfflineStatus.Initializing,this.$5=null,this.$1=null,this.$6=0,this.$2=0,this.$3=0,this.$7=0,this.$8=0};b.newStanza=function(a,b){this.downloadedStanzas.count++;this.measureMaxOffline(b);switch(a){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:this.downloadedStanzas.message++;break;case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:this.downloadedStanzas.receipt++;break;case d("WAIncomingStanza").INCOMING_STANZA.RETRY_RECEIPT:this.downloadedStanzas.receipt++;break;case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:this.downloadedStanzas.notification++;break}this.$4=d("WAOfflineUtils").OfflineStatus.Processing;this.$13()};b.stats=function(){return{count:this.expectedStanzas.count,stanzas:this.expectedStanzas}};b.measureMaxOffline=function(a){this.$3=Math.max(this.$3,a)};b.getStartTime=function(){return this.$2};b.$12=function(){d("WABridge").getBridge().fireAndForget("event","offlineSnapshot",{status:this.$4,downloaded:this.downloadedStanzas,expected:this.expectedStanzas,processed:this.processedStanzas,failureReason:this.$5})};return a}();g.OfflineQueueStats=a}),98);
__d("WAOfflineBatchIb",["WAComms","WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WAComms").deprecatedCastStanza(d("WAWap").wap("ib",null,d("WAWap").wap("offline_batch",{count:d("WAWap").INT(a)})))}g.sendBatchRequestIb=a}),98);
__d("WARequestBatch",["WALogger","WAOfflineBatchIb","WAOfflineQueueConfig","WAOfflineUtils","WAShiftTimer","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] request next batch"]);h=function(){return a};return a}var i=0;a=function(){function a(a){var b=this;this.$2=!1;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){b.maybeRequestMoreStanzas()});this.$1=a}var c=a.prototype;c.receivedMsgFromBatch=function(){this.$2=!1,this.scheduleRequestMoreStanzas()};c.batchIsFlushing=function(){this.$2=!1};c.$4=function(){this.$2=!0};c.maybeRequestMoreStanzas=function(){var a,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(this.$1.getCache().wait());case 2:a=this.$1.getCache().sizes();c=this.$1.getStats();if(!(c==null)){e.next=6;break}return e.abrupt("return");case 6:!this.$2&&a.msg<d("WAOfflineQueueConfig").getOfflineQueueConfig().minMsgAmountInBulk()&&a.msg+a.notification+a.receipt<d("WAOfflineQueueConfig").getOfflineQueueConfig().cacheSize()&&c.downloadedStanzas.count<c.expectedStanzas.count&&this.$1.getMode()===d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME&&(d("WAOfflineBatchIb").sendBatchRequestIb(d("WAOfflineQueueConfig").getOfflineQueueConfig().batchSize()),this.$4(),d("WALogger").TAGS(["ServerRPC"]).LOG(h()));case 7:case"end":return e.stop()}},null,this)};c.stop=function(){this.$3.cancel(),this.$2=!1};c.scheduleRequestMoreStanzas=function(){this.$3.cancel(),this.$2||this.$3.onOrAfter(i)};return a}();g.BatchRequester=a}),98);
__d("WAStanzaCache",["WAIncomingStanza","WALogger","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] flush retry-receipts. Reason: ",";\nRetry-receipts: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] flush. Reason: ",";\nMsgs: ",";\nNotifications: ","\nReceipts: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] received an impossible stanza to the cache"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] ",""]);m=function(){return a};return a}function a(a){var b=[],c=[],e=[],f=new(d("WAPromiseQueue").PromiseQueue)(),g={msg:0,receipt:0,notification:0,retryReceipt:0};function n(){return b.length===0&&c.length===0&&e.length===0}function o(){return g}function p(){q(),r(),s()}function q(){b=[],g.msg=0,g.notification=0}function r(){c=[],g.receipt=0}function s(){e=[],g.retryReceipt=0}function t(a){switch(a.tag){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:b.push(a);g.msg++;return;case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:b.push(a);g.notification++;return;case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:if(a.attrs.type==="retry"){e.push(a);g.retryReceipt++;return}c.push(a);g.receipt++;return;default:d("WALogger").WARN(m(),a),d("WALogger").ERROR(l())}}function u(){return f.wait()}function v(l,m,n){var o=[],p=0,t=0,u=0;n.msgsAndNotifications===!0&&(p=g.msg,t=g.notification,o=o.concat(b),q());n.receipts===!0&&(u=g.receipt,o=o.concat(c),r());o.length>0&&f.enqueue(function(){d("WALogger").LOG(k(),l,p,t,u);return a.main(o,m)})["catch"](function(a){d("WALogger").ERROR(j(),a)});if(n.retryReceipts===!0){var v=e;s();v.length>0&&f.enqueue(function(){d("WALogger").LOG(i(),l,v.length);return a.retryReceipts(v,m)})["catch"](function(a){d("WALogger").ERROR(h(),a)})}return f.wait()}return{flush:v,wait:u,add:t,drop:p,sizes:o,isEmpty:n}}g.makeStanzaCache=a}),98);
__d("WAOfflineQueueManager",["Promise","WAIncomingStanza","WALogger","WAOfflineQueueConfig","WAOfflineQueueTimers","WAOfflineStats","WAOfflineUtils","WAParsableWapNode","WARequestBatch","WAScheduleAfterOfflineResume","WAStanzaCache","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Drop offline queue as per loosing connection"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Connection was dropped during offline queue, with non-empty cache"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Expected stats: ",". Downloaded: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["less stanzas downloaded then expected from <offline> ib before the end of the queue"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Offline queue end"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Socket is not provided"]);n=function(){return a};return a}a=function(){function a(a){var c=this;this.$7=d("WAOfflineUtils").ServerRPCMode.INIT;this.handleStanza=function(a,e){e==null&&d("WALogger").TAGS(["ServerRPC"]).WARN(n());e=(e=e)!=null?e:0;c.ensureSocketIsActive(e);switch(a.tag){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:return c.$8(a,c.$1.message,e);case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:return c.$8(a,c.$1.notification,e);case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:return a.attrs.type==="retry"?c.$8(a,c.$1.retryReceipt,e):c.$8(a,c.$1.receipt,e)}return b("Promise").resolve("NO_ACK")};this.$1=a;this.$2=d("WAStanzaCache").makeStanzaCache({main:a.bulk.handler,retryReceipts:a.bulk.retry});this.$3=new(d("WAOfflineStats").OfflineQueueStats)();this.$5=d("WAOfflineQueueTimers").makeOfflineQueueTimers(this);this.$4=new(d("WARequestBatch").BatchRequester)(this)}var c=a.prototype;c.getCache=function(){return this.$2};c.$8=function(a,b,c){var e=new(d("WAParsableWapNode").ParsableWapNode)("offline",a).maybeAttrInt("offline");if(this.$7!==d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME)return this.$2.wait().then(function(){return b(a,c)});if(e==null)return this.handleInCache(a);this.$3.newStanza(a.tag,e);this.$4.receivedMsgFromBatch();this.$5.offlineComplete.refresh();return this.handleInCache(a)};c.handleInCache=function(a){this.$2.add(a);this.$5.flushCache.refresh();this.$9();return b("Promise").resolve("NO_ACK")};c.$9=function(){var a=this.$2.sizes();d("WAOfflineQueueConfig").getOfflineQueueConfig().isPullMode()&&a.msg>=d("WAOfflineQueueConfig").getOfflineQueueConfig().minMsgAmountInBulk()&&this.flush("enough_amount_of_messages_to_flush",{msgsAndNotifications:!0,receipts:!1,retryReceipts:!1});d("WAOfflineQueueConfig").getOfflineQueueConfig().isPullMode()&&a.msg+a.notification>=d("WAOfflineQueueConfig").getOfflineQueueConfig().cacheSize()&&this.flush("too_big_cache",{msgsAndNotifications:!0,receipts:!1,retryReceipts:!1});!d("WAOfflineQueueConfig").getOfflineQueueConfig().isPullMode()&&a.msg+a.receipt+a.notification+a.retryReceipt>=d("WAOfflineQueueConfig").getOfflineQueueConfig().cacheSize()&&this.flush("cache_size",{msgsAndNotifications:!0,receipts:!0,retryReceipts:!0})};c.offlineStart=function(a){if(a.count===0)return;this.$7=d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME;this.$3.start(a,d("WAOfflineQueueConfig").getOfflineQueueConfig().isPullMode()?"pull":"server-push");this.$5.offlineComplete.start()};c.flush=function(a,b){var c=this;this.$5.flushCache.stop();this.$4.batchIsFlushing();a=this.$2.flush(a,this.$6,b);a.then(function(){c.$4.maybeRequestMoreStanzas(),c.$5.flushCache.refresh()})["catch"](function(a){d("WALogger").TAGS(["ServerRPC"]).ERROR(m(),a)});return a};c.getStats=function(){if(this.$7===d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME)return this.$3};c.getStatus=function(){return this.$7};c.offlineEnd=function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:d("WALogger").TAGS(["ServerRPC"]).LOG(l());if(!(this.$7!==d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME)){c.next=6;break}this.$7=d("WAOfflineUtils").ServerRPCMode.ONLINE;this.$3.offlinePreviewEndReport();d("WAScheduleAfterOfflineResume").flushPostponedActions();return c.abrupt("return");case 6:a!=null&&this.$3.downloadedStanzas.count<a&&d("WALogger").TAGS(["ServerRPC"]).WARN(k());this.$3.downloadedStanzas.count!==this.$3.expectedStanzas.count&&d("WALogger").TAGS(["ServerRPC"]).WARN(j(),this.$3.expectedStanzas,this.$3.downloadedStanzas);this.$5.offlineComplete.stop();c.next=11;return b("regeneratorRuntime").awrap(this.flush("offline_end",{msgsAndNotifications:!0,receipts:!0,retryReceipts:!0}));case 11:this.$7=d("WAOfflineUtils").ServerRPCMode.ONLINE;this.$3.complete();c.next=15;return b("regeneratorRuntime").awrap(this.flush("process online queue",{msgsAndNotifications:!0,receipts:!0,retryReceipts:!0}));case 15:d("WAScheduleAfterOfflineResume").flushPostponedActions();case 16:case"end":return c.stop()}},null,this)};c.ensureSocketIsActive=function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:this.$6==null&&(this.$6=a);if(!(this.$6!==a&&!this.$2.isEmpty())){c.next=5;break}d("WALogger").TAGS(["ServerRPC"]).ERROR(i());c.next=5;return b("regeneratorRuntime").awrap(this.connectionDropped());case 5:this.$6=a;case 6:case"end":return c.stop()}},null,this)};c.connectionDropped=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:d("WALogger").TAGS(["ServerRPC"]).WARN(h());this.$3.drop("disconnect");this.$6=null;this.$2.drop();this.$4.stop();this.$5.flushCache.stop();a.next=8;return b("regeneratorRuntime").awrap(this.$2.wait());case 8:case"end":return a.stop()}},null,this)};c.getMode=function(){return this.$7};return a}();g.OfflineQueueManager=a}),98);
__d("WAJobPriorityBucket",["WAJobOrchestratorTypes","WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"]);i=function(){return a};return a}a=function(){function a(a){this.tasks=[];this.pendingTasks=[];this.lastJobStartedTimestampMs=null;this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}}var b=a.prototype;b.updateConfig=function(a){this.jobMaxConcurrency=(a=a.jobMaxConcurrencyMap)!=null?a:{}};b.getStats=function(){return[].concat(this.tasks,this.pendingTasks).reduce(function(a,b){var c;c=(c=a[b.jobName])!=null?c:0;a[b.jobName]=c+1;return a},{})};b.next=function(){var a=this;if(this.tasks.length===0)return null;var b=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.tasks.filter(function(c){var e;return((e=b.get(c.jobName))!=null?e:0)<((e=a.jobMaxConcurrency[c.jobName])!=null?e:d("WAJobOrchestratorTypes").DEFAULT_CONCURRENCY)});return c.length>0?[c[0]]:null};b.add=function(a,b,c,d){c={jobId:c,jobInfo:b,jobName:a,run:d};this.tasks.push(c);return c};b.markJobTaskPending=function(a){this.pendingTasks.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(i(),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.lastJobStartedTimestampMs=Date.now(),this.pendingTasks.push(a),this.tasks=this.tasks.filter(function(b){return b.jobId!==a.jobId})};b.markJobTaskDone=function(a){this.pendingTasks=this.pendingTasks.filter(function(b){return b.jobId!==a}),this.tasks.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(h(),a).sendLogs("JobOrchestrator::markJobTaskDone")};b.count=function(){return this.tasks.length};b.pendingCount=function(){return this.pendingTasks.length};b.clear=function(){this.tasks=[],this.pendingTasks=[]};b.getLastJobStartedTimestamp=function(){return this.lastJobStartedTimestampMs};return a}();b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.next=function(){var a=this,b,c;if(this.tasks.length===0)return null;var d=this.pendingTasks.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),e=this.tasks.filter(function(b){var c;return((c=d.get(b.jobName))!=null?c:0)<((c=a.jobMaxConcurrency[b.jobName])!=null?c:1)});if(e.length===0)return null;b=(b=this.jobMaxConcurrency[e[0].jobName])!=null?b:1;c=(c=d.get(e[0].jobName))!=null?c:0;if(b>1&&c<b){var f=e.filter(function(a){return a.jobName===e[0].jobName});b=Math.min(f.length,b-c);return f.slice(0,b)}return[e[0]]};return b}(a);g.BaseJobBucket=a;g.LowJobBucket=b}),98);
__d("WAMetrics",["Promise","WATimeUtils"],(function(a,b,c,d,e,f,g){function a(){var a=d("WATimeUtils").performanceAbsoluteNow();return new(b("Promise"))(function(b){setTimeout(function(){b(d("WATimeUtils").performanceAbsoluteNow()-a)},0)})}g.getEventLoopDelay=a}),98);
__d("WAPromiseTimeout",["Promise","WACustomError","WAErr"],(function(a,b,c,d,e,f,g){a=function(a,e,f){var g=null,h=null,i=new(b("Promise"))(function(a,b){h=b,g=setTimeout(function(){b(new(d("WACustomError").TimeoutError)(f)),clearTimeout(g)},e)});return b("Promise").race([a,i])["finally"](function(){h&&h(c("WAErr")()),clearTimeout(g)})};g.promiseTimeout=a}),98);
__d("WAConcurrentBucketJobQueue",["Promise","WABase64","WACustomError","WAErr","WAJobOrchestratorTypes","WAJobPriorityBucket","WALogger","WAMetrics","WANullthrows","WAPromiseTimeout","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated WAConcurrentBucketJobQueue config"]);i=function(){return a};return a}var j=30,k=new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,5],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,1]]);a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4=0,this.$5=new Map(),this.$6=new Map(),this.$7=new Map(),this.$9=0}var e=a.prototype;e.init=function(a,b){var e;if(this.$1)throw c("WAErr")("WAConcurrentBucketJobQueue has already initialized");this.$4=(e=a==null?void 0:a.bestEffortWaitTimeoutSec)!=null?e:j;this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$8=b;this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota);this.$6=new Map(this.$7);this.$5=new Map();this.$9=Date.now();b=new(d("WAJobPriorityBucket").BaseJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});e=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(e=a.maxConcurrencyPerJob)!=null?e:{}});a=new(d("WAJobPriorityBucket").LowJobBucket)({jobMaxConcurrencyMap:(a=a.maxConcurrencyPerJob)!=null?a:{}});this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,b);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,e);this.$5.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,a);this.$1=!0};e.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2,this.$2=a.maxConcurrency,this.$5.forEach(function(b){return b.updateConfig({jobMaxConcurrencyMap:(b=a.maxConcurrencyPerJob)!=null?b:{}})}),this.$7=this.$11(a==null?void 0:a.jobPrioritiesQuota),d("WALogger").LOG(i())};e.isInitialized=function(){return this.$1};e.clearQueue=function(){if(!this.$1)throw c("WAErr")("WAConcurrentBucketJobQueue not initialized");this.$5.forEach(function(a){return a.clear()})};e.getIntStats=function(){var a=this,b=function(b){var c;b=a.$5.get(b);return((c=b==null?void 0:b.count())!=null?c:0)+((c=b==null?void 0:b.pendingCount())!=null?c:0)};return{highPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityBucketSize:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};e.getStringStats=function(){var a=this,b=function(b){var c=(b=(b=a.$5.get(b))==null?void 0:b.getStats())!=null?b:{};b=Object.keys(c).reduce(function(a,b){var d=a[0];a=a[1];var e=c[b];return e>d?[e,b]:[d,a]},[0,null]);b=b[1];return b};return{highPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH),lowPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW),bestEffortPriorityMaxJob:b(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT)}};e.enqueue=function(a,e,f,g){var h,i=this;if(!this.$1)return b("Promise").reject(c("WAErr")("WAConcurrentBucketJobQueue not initialized"));var j,k,l=new(b("Promise"))(function(a,b){j=a,k=b}),m=babelHelpers["extends"]({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},f),n=this.getJobBucketByType(m.priority);if(!n)return b("Promise").reject(c("WAErr")("WAConcurrentBucketJobQueue no bucket for job with name "+a+" was found."));d("WAMetrics").getEventLoopDelay().then(function(a){g==null?void 0:g.addPoint("measure_event_loop_delay",{"int":{eventLoopDelay:a}})});g==null?void 0:g.addPoint("scheduling_job",{string:babelHelpers["extends"]({},this.getStringStats(),{priority:m.priority}),"int":babelHelpers["extends"]({},this.getIntStats(),{maxTimeoutMs:(h=f==null?void 0:f.maxTimeoutMs)!=null?h:0})});var o=m.priority+"-"+a+"-"+((h=f==null?void 0:f.jobId)!=null?h:d("WABase64").randomBase64(8));h=n.add(a,m,o,function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.prev=0;i.$8.logJobStarted(o);c.next=4;return b("regeneratorRuntime").awrap(i.$12(e(),f==null?void 0:f.maxTimeoutMs));case 4:a=c.sent;i.$8.logJobCompleted(o);j(a);c.next=13;break;case 9:c.prev=9,c.t0=c["catch"](0),c.t0 instanceof d("WACustomError").TimeoutError?i.$8.logJobTimeout(o):i.$8.logJobError(o),k(c.t0);case 13:case"end":return c.stop()}},null,this,[[0,9]])});this.$8.logJobCreated({jobId:o,jobName:a,jobPriority:m.priority,pendingJobsCount:n.count()});f&&f.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$13(h);this.$14();return l};e.getAvailableThreadsCount=function(){return this.$3};e.getJobQuotaConfig=function(){return this.$7};e.getRemainingJobCountMap=function(){return this.$6};e.getJobBucketByType=function(a){return this.$5.get(a)};e.$11=function(a){var b;!a?b=new Map(k):b=new Map(a);b.set(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,0);return b};e.$15=function(a){return(a=this.$6.get(a))!=null?a:0};e.$16=function(){this.$6=new Map(this.$7)};e.$17=function(a){var b=this;a===void 0&&(a=!0);var c=0,e=null,f=0;this.$5.forEach(function(a,d){c+=a==null?void 0:a.count();f+=b.$15(d);if(e!=null)return;a.count()>0&&b.$15(d)>0&&(e=a)});var g=e==null||f===0;g&&this.$16();if(this.$18(c,g))return this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);return e==null&&a?this.$17(!1):e};e.$18=function(a,b){var c=this;function e(a,b){var c=Date.now();return a>c?!1:c-a<b*1e3}function f(a,b){a=Math.ceil(a-Date.now())+b*1e3;return a>0?a:0}var g=this.getJobBucketByType(d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT);a=a-((a=g==null?void 0:g.count())!=null?a:0);var h=g==null?void 0:g.getLastJobStartedTimestamp();if((g==null?void 0:g.count())===0)return!1;if(h==null&&e(this.$9,this.$4)){if(this.$10==null){g=f(this.$9,this.$4);this.$10=setTimeout(function(){c.$14(),c.$10=null},g)}return!1}return a>0&&h!=null&&e(h,this.$4)?!1:b};e.$19=function(a){a=this.$20(a);return c("WANullthrows")(this.$5.get(a))};e.$20=function(a){var b=a.split("-")[0];b=d("WAJobOrchestratorTypes").JOB_PRIORITY.cast(b);if(!b)throw c("WAErr")("ConcurrentBucketQueue cannot extract known job priority type from id: "+a);return b};e.$21=function(a){a=this.$20(a);this.$15(a)>0?this.$6.set(a,this.$15(a)-1):this.$6.set(a,0)};e.$14=function(){var a=this;while(this.$3>0){var b=this.$17();b=b==null?void 0:b.next();if(b==null)break;b.forEach(function(b){a.$21(b.jobId),a.$13(b)})}};e.$12=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};e.$13=function(a){var c=this,e,f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=this.$19(a.jobId);this.$3--;e.markJobTaskPending(a);f=a.run,g=a.jobId,i=a.jobName;k.prev=4;k.next=7;return b("regeneratorRuntime").awrap(this.$12(f(),((j=a.jobInfo)==null?void 0:j.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0));case 7:k.next=17;break;case 9:k.prev=9;k.t0=k["catch"](4);if(!(k.t0 instanceof d("WACustomError").TimeoutError)){k.next=16;break}this.$8.logJobTimeout(g);d("WALogger").LOG(h(),i);k.next=17;break;case 16:throw k.t0;case 17:k.prev=17;this.$3++;e.markJobTaskDone(g);this.$3>0&&setTimeout(function(){return c.$14()},0);return k.finish(17);case 22:case"end":return k.stop()}},null,this,[[4,9,17,22]])};return a}();g.WAConcurrentBucketJobQueue=a}),98);
__d("WAConcurrentPreemptiveJobQueue",["Promise","WACustomError","WAErr","WAHex","WAJobOrchestratorTypes","WALogger","WAPromiseTimeout","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskDone found jobId: "," in scheduled tasks"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed::markJobTaskPending found jobId: "," in pending tasks"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: "," exceeding the timeout, release the thread."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[job-orchestator]: updated ConcurrentPreemptiveJobQueue config"]);k=function(){return a};return a}a=function(){function a(){this.$1=!1,this.$2=0,this.$3=0,this.$4={},this.$5=[],this.$6=[]}var e=a.prototype;e.init=function(a,b){if(this.$1)throw c("WAErr")("ConcurrentPreemptiveJobQueue has already initialized");this.$2=a.maxConcurrency;this.$3=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};this.$7=b;this.$1=!0};e.updateConfig=function(a){this.$3+=a.maxConcurrency-this.$2;this.$2=a.maxConcurrency;this.$4=(a=a.maxConcurrencyPerJob)!=null?a:{};d("WALogger").LOG(k())};e.isInitialized=function(){return this.$1};e.clearQueue=function(){if(!this.$1)throw c("WAErr")("ConcurrentPreemptiveJobQueue not initialized");this.$5=[];this.$6=[]};e.enqueue=function(a,e,f){var g,h=this;if(!this.$1)return b("Promise").reject(c("WAErr")("ConcurrentPreemptiveJobQueue not initialized"));var i,j,k=new(b("Promise"))(function(a,b){i=a,j=b}),l=babelHelpers["extends"]({priority:d("WAJobOrchestratorTypes").DEFAULT_JOB_PRIORITY},f),m=(g=f==null?void 0:f.jobId)!=null?g:d("WAHex").randomHex(8).substr(0,64);g=this.$8(a,l,m,function(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:c.prev=0;h.$7.logJobStarted(m);c.next=4;return b("regeneratorRuntime").awrap(h.$9(e(),f==null?void 0:f.maxTimeoutMs));case 4:a=c.sent;h.$7.logJobCompleted(m);i(a);c.next=13;break;case 9:c.prev=9,c.t0=c["catch"](0),c.t0 instanceof d("WACustomError").TimeoutError?h.$7.logJobTimeout(m):h.$7.logJobError(m),j(c.t0);case 13:case"end":return c.stop()}},null,this,[[0,9]])});f&&f.priority===d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION&&this.$10(g);this.$11();return k};e.getAvailableThreadsCount=function(){return this.$3};e.getJobMaxConcurrency=function(){return this.$4};e.$11=function(){while(this.$3>0){var a=this.$12();if(a==null)break;this.$10(a)}};e.$9=function(a,b){return b!==void 0?d("WAPromiseTimeout").promiseTimeout(a,b):a};e.$10=function(a){var c=this,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:this.$3--;this.$13(a);e=a.run,f=a.jobId,g=a.jobName;i.prev=3;i.next=6;return b("regeneratorRuntime").awrap(this.$9(e(),((h=a.jobInfo)==null?void 0:h.maxTimeoutMs)===void 0?d("WAJobOrchestratorTypes").DEFAULT_JOB_TIMEOUT_MS:void 0));case 6:i.next=16;break;case 8:i.prev=8;i.t0=i["catch"](3);if(!(i.t0 instanceof d("WACustomError").TimeoutError)){i.next=15;break}this.$7.logJobTimeout(f);d("WALogger").LOG(j(),g);i.next=16;break;case 15:throw i.t0;case 16:i.prev=16;this.$3++;this.$14(f);setTimeout(function(){return c.$11()},0);return i.finish(16);case 21:case"end":return i.stop()}},null,this,[[3,8,16,21]])};e.$8=function(a,b,c,d){d={jobId:c,jobInfo:b,jobName:a,run:d};this.$7.logJobCreated({jobId:c,jobName:a,jobPriority:b.priority,pendingJobsCount:this.$5.length});this.$5.push(d);return d};e.$13=function(a){this.$6.includes(function(b){return b.jobId===a.jobId})&&d("WALogger").ERROR(i(),a.jobId).sendLogs("JobOrchestrator::markJobTaskPending"),this.$6.push(a),this.$5=this.$5.filter(function(b){return b.jobId!==a.jobId})};e.$14=function(a){this.$6=this.$6.filter(function(b){return b.jobId!==a}),this.$5.includes(function(b){return b.jobId===a})&&d("WALogger").ERROR(h(),a).sendLogs("JobOrchestrator::markJobTaskDone")};e.$12=function(){var a=this;if(this.$5.length===0)return null;var b=this.$6.reduce(function(a,b){var c;c=(c=a.get(b.jobName))!=null?c:0;a.set(b.jobName,c+1);return a},new Map()),c=this.$5.filter(function(c){var d;return((d=b.get(c.jobName))!=null?d:0)<((d=a.$4[c.jobName])!=null?d:1)});return c[0]};return a}();g.WAConcurrentPreemptiveJobQueue=a}),98);
__d("WADefaultJobNoQueue",["WAErr","WAHex","WAJobOrchestratorTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){a=function(){function a(){this.$2=!1}var e=a.prototype;e.init=function(a,b){if(this.$2)throw c("WAErr")("DefaultNoQueue has already initialized");this.$1=b;this.$2=!0};e.updateConfig=function(a){};e.isInitialized=function(){return this.$2};e.clearQueue=function(){};e.enqueue=function(a,c,e){var f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:h=(f=e==null?void 0:e.jobId)!=null?f:d("WAHex").randomHex(8).substr(0,64);this.$1.logJobCreated({jobId:h,jobName:a,jobPriority:(g=e==null?void 0:e.priority)!=null?g:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,pendingJobsCount:0});j.prev=2;this.$1.logJobStarted(h);j.next=6;return b("regeneratorRuntime").awrap(c());case 6:i=j.sent;this.$1.logJobCompleted(h);return j.abrupt("return",i);case 11:j.prev=11;j.t0=j["catch"](2);this.$1.logJobError(h);throw j.t0;case 15:case"end":return j.stop()}},null,this,[[2,11]])};return a}();g.WADefaultJobNoQueue=a}),98);
__d("WAOrchestratorJobStatsLogger",["WABaseGlobals","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){var h=function(){function a(a,b,c){this.jobName=a,this.pendingJobsCount=c,this.jobPriority=b}var b=a.prototype;b.logJobAdded=function(){this.webcJobAddedT=Date.now(),this.eventFlow=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR,{string:{name:this.jobName,jobPriority:this.jobPriority,orchestratorVersion:d("WABaseGlobals").getConfig().orchestratorVersion()},"int":{pendingJobsCount:this.pendingJobsCount,addedAt:this.webcJobAddedT},bool:{nonPersistedExperiment:d("WABaseGlobals").getConfig().forceNonPersistedJobs(),waitForConnectionExperiment:d("WABaseGlobals").getConfig().waitForConnection()}})};b.logJobStarted=function(){this.webcJobStartedT=Date.now(),this.eventFlow.addPoint("start_job",{"int":{startedAt:this.webcJobStartedT}})};b.logJobCompleted=function(a){this.webcJobCompletedT=Date.now();this.jobResultType=a;var b={"int":{pendingJobsCount:this.pendingJobsCount,completedAt:this.webcJobCompletedT}};a==="completed"?this.eventFlow.endSuccess(b):this.eventFlow.endFail(a,b)};return a}();a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.logJobCreated=function(a){var b=a.jobName,c=a.jobId,d=a.jobPriority;a=a.pendingJobsCount;b=new h(b,d,a);b.logJobAdded();this.$1.set(c,b)};b.logJobStarted=function(a){a=this.$1.get(a);a==null?void 0:a.logJobStarted()};b.logJobCompleted=function(a){this.$2(a,"completed")};b.logJobError=function(a){this.$2(a,"error")};b.logJobTimeout=function(a){this.$2(a,"timeout")};b.logJobAborted=function(a){this.$2(a,"aborted")};b.$2=function(a,b){var c=this.$1.get(a);c==null?void 0:c.logJobCompleted(b);this.$1["delete"](a)};return a}();g.JobInfoEvent=h;g.JobStatsLogger=a}),98);
__d("WAOrchestrator",["WABaseGlobals","WAConcurrentBucketJobQueue","WAConcurrentPreemptiveJobQueue","WADefaultJobNoQueue","WAErr","WAJobOrchestratorTypes","WALogger","WAOrchestratorJobStatsLogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing job orchestrator config error: ",""]);h=function(){return a};return a}function a(){var a={maxConcurrency:1},b="default";function e(){var b=babelHelpers["extends"]({},a);try{var e=d("WABaseGlobals").getConfig().orchestratorConfig(),f=JSON.parse(e),g=f.maxConcurrency,i=f.bestEffortWaitTimeoutSec,j=f.highPriorityQuota;f=f.lowPriorityQuota;if(typeof g!=="number"||typeof j!=="number"||typeof f!=="number"||typeof i!=="number")throw c("WAErr")("Job orchestrator config is incorrect: "+e);b.maxConcurrency=g;b.bestEffortWaitTimeoutSec=i;b.jobPrioritiesQuota=new Map([[d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH,j],[d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,f]])}catch(c){b=a,d("WALogger").ERROR(h(),c)}return b}var f={},g=a,j=new(d("WAOrchestratorJobStatsLogger").JobStatsLogger)();return function(a,c){a===void 0&&(a=!1);a=a?b:d("WABaseGlobals").getConfig().orchestratorVersion();var h=e(),k;c==null?void 0:c.addPoint("get_orchestrator",{string:{orchestrator:a},"int":{maxConcurrency:h.maxConcurrency,highPriorityQuota:(c=(c=h.jobPrioritiesQuota)==null?void 0:c.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH))!=null?c:0,lowPriorityQuota:(c=(c=h.jobPrioritiesQuota)==null?void 0:c.get(d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW))!=null?c:0}});if(f[a]){i(g,h)&&(g=h,f[a].updateConfig(h));return f[a]}switch(a){case"preemptive":k=new(d("WAConcurrentPreemptiveJobQueue").WAConcurrentPreemptiveJobQueue)();break;case"bucket":k=new(d("WAConcurrentBucketJobQueue").WAConcurrentBucketJobQueue)();break;default:k=new(d("WADefaultJobNoQueue").WADefaultJobNoQueue)();break}k.init(h,j);f[a]=k;g=h;return k}}function i(a,b){var c;if(a.maxConcurrency!==b.maxConcurrency)return!0;if(((c=a.jobPrioritiesQuota)==null?void 0:c.size)!==((c=b.jobPrioritiesQuota)==null?void 0:c.size))return!0;return Object.keys((c=a.maxConcurrencyPerJob)!=null?c:{}).length!==Object.keys((c=b.maxConcurrencyPerJob)!=null?c:{}).length?!0:JSON.stringify(a)!==JSON.stringify(b)}g.getInstanceDelegate=a}),98);
__d("WaJobInMemoryAccessors",["Promise","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=-1,c=new Map();return{deletePersistedJob:function(a){return b("Promise").resolve(c["delete"](a))},loadAllJobs:function(){return b("Promise").resolve(Array.from(c.values()))},maybeCreateJob:function(e){var f;f=JSON.stringify([e.type,(f=e.uniqKey)!=null?f:d("WAHex").randomHex(32)]);var g={backedOffCount:0,current:e.args,original:e.args,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:e.type,uniqKey:f,version:e.version,waitUntil:null};f=function(){var d=a--,e=babelHelpers["extends"]({},g,{jobId:d});c.set(d,e);return b("Promise").resolve({id:d,newlyCreated:!0})};if(e.uniqKey!=null){var h=Array.from(c.values()).filter(function(a){return a.uniqKey===e.uniqKey});if(h.length===0)return f();var i=null;h.forEach(function(a){a.step!=="$finished"?i=a:c["delete"](a.jobId)});return i!=null?b("Promise").resolve({id:i.jobId,newlyCreated:!1}):f()}return f()},readPersistedJob:function(a){a=c.get(a);return b("Promise").resolve(a&&babelHelpers["extends"]({},a))},updatePersistedJob:function(a){return b("Promise").resolve(c.set(a.jobId,babelHelpers["extends"]({},a)))}}}g.getJobInMemoryAccessors=a}),98);
__d("WAPersistedJobManagerV2",["Promise","WABaseGlobals","WAErr","WAJobOrchestratorTypes","WAJobRequirement","WALogger","WAOrchestrator","WAPREList","WAPREMetrics","WAPersistedJobManager","WAPromiseBackoffs","WAResolvable","WATimeUtils","WaJobInMemoryAccessors","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running in forced non-persisted mode"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"]);s=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""]);a=function(){return b};return b}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose([""," error: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running step"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["[JOB MANAGER] Restarting job with the same id"]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"]);J=function(){return a};return a}var K=1;function L(a){var b=a.code,c=a.annotations;c=c===void 0?{}:c;a=a.eventFlow;var d=a===void 0?M(c):a;return b(d).then(function(a){d.endSuccess();return a})["catch"](function(a){d.endFail("error",{string:{error:""+a}});throw a})}function M(a){a===void 0&&(a={});return d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOB_MANAGER,a)}e=function(){function a(a){var c=this,e=a.isRestartAfterCrash,f=a.accessors,g=a.unfinishedJobEntries;this.getOrchestratorDelegate=d("WAOrchestrator").getInstanceDelegate();this.activeJobs=new Map();this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=f;this.isRestartAfterCrash=e||!1;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs;this.inMemoryAccessors=d("WaJobInMemoryAccessors").getJobInMemoryAccessors();this.initialJobsPromise=g.then(function(a){var e=[],f=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?e.push(a):f.push(a)});return b("Promise").all(e.map(function(a){d("WALogger").ERROR(J(),O(a),a.step).devConsole(N(a)).sendLogs("job-stuck-"+a.type);return c.accessors.deletePersistedJob(a.jobId)})).then(function(){f.forEach(function(a){var b=c.$1(a.jobId);if(b.alreadyActive===!0){d("WALogger").ERROR(I());return}b.deferred.resolve(L({code:function(b){return c.$2(a,c.accessors,{eventFlow:b})},annotations:{string:{name:a.type}}}))})})})}var e=a.prototype;e.loadAndRunJobFromId=function(a){var c=this;return L({code:function(d){return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:d.addPoint("job_is_persisted_externally");e.next=3;return b("regeneratorRuntime").awrap(c.initialJobsPromise);case 3:d.addPoint("initial_jobs_promise_fulfilled");return e.abrupt("return",c.$3(a,c.accessors,{eventFlow:d}));case 5:case"end":return e.stop()}},null,this)}})};e.$3=function(a,e,f){var g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:f===void 0&&(f={});(g=f.eventFlow)==null?void 0:g.addPoint("start_load_and_run");h=this.$1(a);if(!(h.alreadyActive===!0)){j.next=5;break}return j.abrupt("return",h.deferred);case 5:j.next=7;return b("regeneratorRuntime").awrap(e.readPersistedJob(a));case 7:i=j.sent;if(!(i==null)){j.next=11;break}d("WALogger").ERROR(H()).sendLogs("missing-job-entry");throw c("WAErr")("Persisted job missing for given ID "+a);case 11:h.deferred.resolve(this.$2(i,e,f));return j.abrupt("return",h.deferred.promise);case 13:case"end":return j.stop()}},null,this)};e.$2=function(a,b,c){var e;c===void 0&&(c={});(e=c.eventFlow)==null?void 0:e.addPoint("enqueueing_job",{string:{name:a.type}});return this.getOrchestratorDelegate(((e=a.scheduleConfig)==null?void 0:e.priority)===d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP,c.eventFlow).enqueue(a.type,this.$4(a,b,c),a.scheduleConfig,c.eventFlow)};e.$5=function(a,c,d){var e,f=this;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d===void 0&&(d={});g.next=3;return b("regeneratorRuntime").awrap(this.initialJobsPromise);case 3:(e=d.eventFlow)==null?void 0:e.addPoint("initial_jobs_promise_fulfilled");return g.abrupt("return",c.maybeCreateJob(a).then(function(a){var b;a=a.id;(b=d.eventFlow)==null?void 0:b.addPoint("job_persisted",{"int":{jobId:a},bool:{nonPersisted:c===f.inMemoryAccessors}});return a}));case 5:case"end":return g.stop()}},null,this)};e.$1=function(a){var b=this.activeJobs.get(a);if(b!=null)return{alreadyActive:!0,deferred:b};b=new(d("WAResolvable").Resolvable)();this.activeJobs.set(a,b.promise);return{alreadyActive:!1,deferred:b}};e.$4=function(a,b,c){var d=this;return function(){return d.$6(a,b,c)}};e.$7=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};e.$8=function(a,c){if(c==null||c.length===0)return b("Promise").resolve();var e=this.stepBlockers,f=e.get(c);f==null&&(f=d("WAJobRequirement").joinRequirements(c.map(function(a){return a()}),Q),e.set(c,f));return f(a)};e.$9=function(a,b,c,e,f){var g,h=this;f===void 0&&(f={});var i=a.step;(g=f.eventFlow)==null?void 0:g.addPoint("start_step");var j=b.findIndex(function(a){return a.stepName===i});g=b[j].info(a.current,a.original,R(a,this.isRestartAfterCrash));var k=g.requirements,l=g.code;g=this.$8(a,k);e&&(g=g.then(e));return g.then(function(){var b;d("WALogger").LOG(G(),P(a));(b=f.eventFlow)==null?void 0:b.addPoint("run_step");return l(a.current,a.original,R(a,h.isRestartAfterCrash,f.eventFlow))}).then(function(e){var g;(g=f.eventFlow)==null?void 0:g.addPoint("step_is_complete");if(e instanceof d("WAPersistedJobManager").InterruptJob){d("WALogger").LOG(F(),P(a));return e.result}g=j+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return c.updatePersistedJob(a).then(function(){return h.$9(a,b,c,void 0,f)})})};e.$6=function(a,c,e){var f,g,h=this,i,j,k,l,m,n,F,G,H,I,J,L,M,Q,S;return b("regeneratorRuntime").async(function(T){while(1)switch(T.prev=T.next){case 0:e===void 0&&(e={});i=this.activeJobs,j=this.deprecatedJobs,k=this.listeners,l=k.onJobFinished,m=k.onJobStarted;(f=e.eventFlow)==null?void 0:f.addPoint("run_job");T.next=5;return b("regeneratorRuntime").awrap(this.$7(a.type));case 5:n=T.sent;F=j[a.type];if(n){T.next=23;break}if(F){T.next=15;break}d("WALogger").ERROR(E(),a.type).sendLogs("missing-job-implementation");T.next=12;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 12:return T.abrupt("return",null);case 15:if(!(F==="NOOP")){T.next=20;break}d("WALogger").WARN(D(),a.type);T.next=19;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 19:return T.abrupt("return",null);case 20:T.next=22;return b("regeneratorRuntime").awrap(F());case 22:n=T.sent;case 23:G=n;F&&d("WALogger").LOG(C(),a.type);H=(g=a.stepFirstStartTime)!=null?g:d("WATimeUtils").unixTime();a.stepFirstStartTime=H;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(!(a.step===d("WAPersistedJobManager").FINISHED_JOB)){T.next=46;break}I=a.waitUntil;J=d("WATimeUtils").secondsUntil(H);if(!(I!=null&&d("WATimeUtils").isInFuture(I)&&J>0)){T.next=40;break}d("WALogger").LOG(B(),N(a));I=d("WATimeUtils").castToUnixTime(I-J);if(!d("WATimeUtils").isInFuture(I)){T.next=40;break}a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(H-J);a.waitUntil=I;T.next=40;return b("regeneratorRuntime").awrap(c.updatePersistedJob(a));case 40:if(!(I==null||!d("WATimeUtils").isInFuture(I))){T.next=44;break}d("WALogger").LOG(A(),N(a));T.next=44;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 44:i["delete"](a.jobId);return T.abrupt("return",a.current);case 46:L=a.step!==d("WAPersistedJobManager").UNSTARTED_JOB?n.find(function(b){return b.stepName===a.step}):n[0];if(L){T.next=52;break}d("WALogger").ERROR(z(),a.type,a.step).sendLogs("missing-job-step");T.next=51;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 51:return T.abrupt("return",null);case 52:a.step=L.stepName;M=function f(){var g=a.waitUntil,i=b("Promise").resolve();if(g!=null){var j=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);g>j?(d("WALogger").LOG(y(),P(a),g,j),a.waitUntil=j,i=c.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(j)})):(d("WALogger").LOG(x(),P(a),g),i=d("WATimeUtils").delayUntil(g))}return i.then(function(){var g=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(H,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return c.updatePersistedJob(a)};return h.$9(a,G,c,g,e)["catch"](function(g){if(g instanceof d("WAPersistedJobManager").RequiresPage){var h;d("WALogger").LOG(w(),P(a));(h=e.eventFlow)==null?void 0:h.addPoint("error_job_requires_page");a.stepHardStartCountAfterTimeout>0&&(--a.stepHardStartCountAfterTimeout,c.updatePersistedJob(a));return new(b("Promise"))(function(){})}else if(g instanceof d("WAPersistedJobManager").RetryOnBackoff){d("WALogger").LOG(v(),P(a));(h=e.eventFlow)==null?void 0:h.addPoint("retry_on_backoff");h=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,g.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(h/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return c.updatePersistedJob(a).then(f)}else{d("WALogger").ERROR(u(),O(a),g);if(a.stepUnexpectedErrorCount<K){(h=e.eventFlow)==null?void 0:h.addPoint("retry_on_unexpected_error");d("WALogger").WARN(t(),P(a),a.stepUnexpectedErrorCount);a.stepUnexpectedErrorCount++;return c.updatePersistedJob(a).then(f)}throw g}})})};Q=M();S=Q.then(function(e){var f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").LOG(s(),P(a));f=null;try{f=l(a.jobId,a.type,a.original,e)}catch(b){d("WALogger").ERROR(r(),a.type,b).sendLogs("onJobFinished-threw")}if(!(f!=null&&f>0)){g.next=12;break}a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(f/1e3));a.step=d("WAPersistedJobManager").FINISHED_JOB;a.current=e;a.stepFirstStartTime=d("WATimeUtils").unixTime();g.next=10;return b("regeneratorRuntime").awrap(c.updatePersistedJob(a));case 10:g.next=15;break;case 12:g.next=14;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 14:i["delete"](a.jobId);case 15:case"end":return g.stop()}},null,this)},function(e){var f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:d("WALogger").ERROR(q(),a.type,e).sendLogs("job-threw-exception-"+a.type);f=G.find(function(b){return b.stepName===a.step});if(f){j.next=6;break}d("WALogger").ERROR(p(),a.type,a.step);j.next=10;break;case 6:g=f.info(a.current,a.original,R(a,h.isRestartAfterCrash));if(!(g.stopRetryIf!=null)){j.next=10;break}j.next=10;return b("regeneratorRuntime").awrap(g.stopRetryIf.onStopRetry(a.current,a.original,R(a,h.isRestartAfterCrash)));case 10:j.next=12;return b("regeneratorRuntime").awrap(c.deletePersistedJob(a.jobId));case 12:i["delete"](a.jobId);case 13:case"end":return j.stop()}},null,this)});try{m(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(o(),a.type,b).sendLogs("onJobStarted-threw")}return T.abrupt("return",S.then(function(){return Q}));case 58:case"end":return T.stop()}},null,this)};e.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(n(),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(m(),a);c.set(a,b)};e.fireAndForget=function(a){var b=this,c=d("WABaseGlobals").getConfig().ignoreForceNonPersistedJobList()||[];if(d("WABaseGlobals").getConfig().forceNonPersistedJobs()===!0&&c.indexOf(a.type)===-1){d("WALogger").LOG(l(),a.type);this.fireAndForgetNonPersisted(a);return}L({code:function(c){var d={eventFlow:c};return b.$5(a,b.accessors,d).then(function(a){return b.$3(a,b.accessors,d)})},annotations:{string:{name:a.type}}})};e.waitUntilPersisted=function(a){var c=this,e=M({string:{name:a.type}}),f=d("WABaseGlobals").getConfig().ignoreForceNonPersistedJobList()||[];if(d("WABaseGlobals").getConfig().forceNonPersistedJobs()===!0&&f.indexOf(a.type)===-1){d("WALogger").LOG(k(),a.type);this.fireAndForgetNonPersisted(a);return b("Promise").resolve()}return this.$5(a,this.accessors,{eventFlow:e}).then(function(a){L({code:function(b){b={eventFlow:b};return c.$3(a,c.accessors,b)},eventFlow:e})})["catch"](function(a){e.endFail("error",{string:{error:""+a}});throw a})};e.waitUntilCompleted=function(a){var b=this,c=d("WABaseGlobals").getConfig().ignoreForceNonPersistedJobList()||[];if(d("WABaseGlobals").getConfig().forceNonPersistedJobs()===!0&&c.indexOf(a.type)===-1){d("WALogger").LOG(j(),a.type);return this.waitUntilCompletedNonPersisted(a)}return L({code:function(c){var d={eventFlow:c};return b.$5(a,b.accessors,d).then(function(a){return b.$3(a,b.accessors,d)})},annotations:{string:{name:a.type}}})};e.fireAndForgetNonPersisted=function(a){var b=this;L({code:function(c){var d={eventFlow:c};return b.$5(a,b.inMemoryAccessors,d).then(function(a){return b.$3(a,b.inMemoryAccessors,d)})},annotations:{string:{name:a.type}}})};e.waitUntilCompletedNonPersisted=function(a){var b=this;return L({code:function(c){var d={eventFlow:c};return b.$5(a,b.inMemoryAccessors,d).then(function(a){return b.$3(a,b.inMemoryAccessors,d)})},annotations:{string:{name:a.type}}})};return a}();function N(a){return"Job["+a.jobId+"] ("+a.type+")"}function O(a){return"[Job "+a.type+"] "}function P(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function Q(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(i(),P(c),b):a==="unsatisfied"?d("WALogger").LOG(h(),P(c),b):a}function R(a,b,c){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:S,eventFlow:c}}function S(a){return new(d("WAPersistedJobManager").InterruptJob)(a)}g.PersistedJobManager=e}),98);
__d("WASmaxOutChatstateComposingMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasComposingMediaAudio;a=d("WASmaxJsx").smax("chatstate",null,d("WASmaxJsx").smax("composing",{media:d("WASmaxAttrs").OPTIONAL_LITERAL("audio",a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeComposingMixin=a}),98);
__d("WASmaxOutChatstatePausedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("chatstate",null,d("WASmaxJsx").smax("paused",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePausedMixin=a}),98);
__d("WASmaxOutChatstateComposingOrPausedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutChatstateComposingMixin","WASmaxOutChatstatePausedMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.composing)return d("WASmaxOutChatstateComposingMixin").mergeComposingMixin(a,b.composing);if(b.isPaused)return d("WASmaxOutChatstatePausedMixin").mergePausedMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeComposingOrPausedMixinGroup=a}),98);
__d("WASmaxOutChatstateClientNotificationRequest",["WASmaxJsx","WASmaxOutChatstateComposingOrPausedMixinGroup","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.chatstateTo;a=a.composingOrPausedMixinGroupArgs;b=d("WASmaxOutChatstateComposingOrPausedMixinGroup").mergeComposingOrPausedMixinGroup(d("WASmaxJsx").smax("chatstate",{to:d("WAWap").JID(b)}),a);return b}g.makeClientNotificationRequest=a}),98);
__d("WASmaxChatstateClientNotificationRPC",["WAComms","WASmaxOutChatstateClientNotificationRequest","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=d("WASmaxOutChatstateClientNotificationRequest").makeClientNotificationRequest(a);e.next=3;return b("regeneratorRuntime").awrap(d("WAComms").castSmaxStanza(c));case 3:case"end":return e.stop()}},null,this)}g.sendClientNotificationRPC=a}),98);
__d("WASendChatStateRPC",["WALogger","WASmaxChatstateClientNotificationRPC"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendChatStateRPC Sending "," to ",""]);h=function(){return a};return a}function a(a,b){d("WALogger").LOG(h(),b,a);var c;b==="idle"?c={isPaused:!0}:(b,c={composing:{hasComposingMediaAudio:b==="recording_audio"}});return d("WASmaxChatstateClientNotificationRPC").sendClientNotificationRPC({chatstateTo:a,composingOrPausedMixinGroupArgs:c})}g.sendChatStateRPC=a}),98);
__d("WASmaxOutPresenceAvailabilityRequest",["WASmaxAttrs","WASmaxJsx","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.presenceType;a=a.presenceName;b=d("WASmaxJsx").smax("presence",{type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b),name:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return b}g.makeAvailabilityRequest=a}),98);
__d("WASmaxPresenceAvailabilityRPC",["WAComms","WASmaxOutPresenceAvailabilityRequest","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=d("WASmaxOutPresenceAvailabilityRequest").makeAvailabilityRequest(a);e.next=3;return b("regeneratorRuntime").awrap(d("WAComms").castSmaxStanza(c));case 3:case"end":return e.stop()}},null,this)}g.sendAvailabilityRPC=a}),98);
__d("WASendPresenceStatus",["WALogger","WASmaxPresenceAvailabilityRPC"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[smax] sendPresenceStatus: ",""]);h=function(){return a};return a}function a(a){a=a.status;d("WALogger").DEV(h(),a);return d("WASmaxPresenceAvailabilityRPC").sendAvailabilityRPC({presenceType:a})}g.sendPresenceStatus=a}),98);
__d("WAServerRPC",["Promise","WAComms","WAIncomingStanza","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ServerRPC] OfflineQueueManager is not defined"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Drop acks, due to changed socket"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported stanza: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported stanza: ",""]);k=function(){return a};return a}function a(a,c){var e=function(c,e){switch(c.tag){case d("WAIncomingStanza").INCOMING_STANZA.MESSAGE:return a.message(c,e);case d("WAIncomingStanza").INCOMING_STANZA.NOTIFICATION:return a.notification(c,e);case d("WAIncomingStanza").INCOMING_STANZA.RECEIPT:return c.attrs.type==="retry"?a.retryReceipt(c,e):a.receipt(c,e);case d("WAIncomingStanza").INCOMING_STANZA.CHATSTATE:return a.chatstate(c,e);case d("WAIncomingStanza").INCOMING_STANZA.APPDATA:return a.appdata(c,e);case d("WAIncomingStanza").INCOMING_STANZA.FAILURE:return a.failure(c,e);case d("WAIncomingStanza").INCOMING_STANZA.STREAM_ERROR:return a.streamError(c,e);case d("WAIncomingStanza").INCOMING_STANZA.IB:return a.ib(c,e);case d("WAIncomingStanza").INCOMING_STANZA.ERROR:return a.error(c,e);case d("WAIncomingStanza").INCOMING_STANZA.SUCCESS:return a.success(c,e);case d("WAIncomingStanza").INCOMING_STANZA.XML_STREAM_ERROR:return b("Promise").resolve("NO_ACK");default:d("WALogger").WARN(k(),c);d("WALogger").ERROR(j(),c.tag);return b("Promise").resolve("NO_ACK")}};function f(a,b){if(!d("WAComms").isActiveSocket(b)){d("WALogger").WARN(i());return}a.forEach(function(a){a!=="NO_ACK"&&a!=="CLOSE_SOCKET"&&d("WAComms").castSmaxStanza(a)})}return{handleStanza:e,castStanzas:f,offlineQueueManager:function(){c==null&&d("WALogger").TAGS(["ServerRPC"]).ERROR(h());return c}}}g.makeServerRPC=a}),98);
__d("WASetAuthKeyPair",["WAGlobals"],(function(a,b,c,d,e,f,g){a=function(a){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(b){b=b.MetaInfoStore;return b.patch({authKeyPair:a})},"setAuthKeyPair")};g.setAuthKeyPair=a}),98);
__d("MAWBackend",["MAWAbProps","MAWBridge","MAWBulkServerHandler","MAWCommonWorkerActions","MAWCommsConfig","MAWDebug","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWDeleteForMeMsgContentCleaner","MAWDyiBatchRestoreDataSync","MAWEphemeralCleaner","MAWExpiredXMACleaner","MAWExternalId","MAWFTSDataSync","MAWGating","MAWGlobals","MAWHandleAppData","MAWHandleChatState","MAWHandleFailure","MAWHandleNotification","MAWHandleRetryRequest","MAWJobHandlers","MAWMailboxUploadDataSync","MAWPREListeners","MAWPendingStanzaCleaner","MAWQplProxy","MAWRunInTransaction","MAWStanzaQueueInit","MAWSyncd","MAWTaskDefinitions","MAWUnsendMsgContentCleaner","Promise","WAArrayBufferUtils","WABackendHandleError","WAComms","WACryptoCurve25519","WACryptoCurve25519Dependencies","WACryptoManagerUtils","WADebugTools","WADevToolsBridge","WAGetClockSkewApi","WAGzip","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandleReceipt","WAHandleStreamError","WAHandleSuccess","WALogger","WAOfflineQueueConfig","WAOfflineQueueManager","WAPersistedJobManagerV2","WAResolvable","WAScheduleAfterOfflineResume","WASendChatStateRPC","WASendPresenceStatus","WAServerRPC","WASetAuthKeyPair","WATimeUtils","WAUploadMedia","gkx","promiseDone","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete dual send messages ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket retried"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add/delete dual send media ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["backend"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);m=function(){return a};return a}b("MAWDebug");function n(a){return b("Promise").resolve(d("WAGzip").inflate(a))}function o(a){return a.regInfo.authKeyPair!=null?b("Promise").resolve(a.regInfo.authKeyPair):new(d("WACryptoCurve25519").Curve25519)(d("WACryptoCurve25519Dependencies").CURVE25519_SIGNAL_DEPENDENCIES).keyPair.then(function(a){return d("WASetAuthKeyPair").setAuthKeyPair(a).then(function(){return a})})}function a(a,e,f,g,p){var q,r,s,t,u,v,w,x;return b("regeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:d("WALogger").TAGS(l()).LOG(m());d("WALogger").LOG(k(),a.deviceJid);q=new(d("WAResolvable").Resolvable)();r=new(d("WAPersistedJobManagerV2").PersistedJobManager)({accessors:g.jobPersistenceAccessors,deprecatedJobs:{removeCurrentDevice:"NOOP"},isRestartAfterCrash:!1,listeners:{onJobFinished:function(a,b,e,f){d("MAWBridge").getBridge().fireAndForget("event","onJobFinished",{id:a,originalArgs:e,result:f,type:b},!0);c("gkx")("5147")&&d("WADevToolsBridge").getDevToolBridge().fireAndForget("devtool","jobStep",{action:"finished",args:e,id:a,jobName:b,result:f});return null},onJobStarted:function(a,b,e){c("gkx")("5147")&&d("WADevToolsBridge").getDevToolBridge().fireAndForget("devtool","jobStep",{action:"starting",args:e,id:a,jobName:b})}},unfinishedJobEntries:q.promise.then(function(){return g.jobPersistenceAccessors.loadAllJobs()})});s=d("WACryptoManagerUtils").createCryptoManager(g.crypto,p.useCryptoManagerV2());d("WAOfflineQueueConfig").initOfflineQueueConfig({isPullMode:p.isPullMode()});t=new(d("WAOfflineQueueManager").OfflineQueueManager)({bulk:{handler:d("MAWBulkServerHandler").handleBulkStanzas,retry:d("MAWHandleRetryRequest").handleRetryRequestsBulk},message:d("WAHandleIncomingMsg").handleMsg,notification:d("MAWHandleNotification").handleNotification,receipt:d("WAHandleReceipt").handleReceipt,retryReceipt:d("MAWHandleRetryRequest").handleRetryRequest});d("MAWGlobals").setGlobals({config:p,crypto:s,db:g.dbCallbacks,dependencies:{generateExternalId:d("MAWExternalId").generateExternalId},fbCat:d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat),hmacKey:e,jidUtils:g.jidUtils,jobResultConverter:g.jobResultConverters,myJids:{deviceJid:a.deviceJid,userJid:a.userJid},persistedJobs:{api:g.persistedJobs,manager:r},runInTransaction:d("MAWRunInTransaction").runInTransaction,serverRPC:d("WAServerRPC").makeServerRPC({appdata:d("MAWHandleAppData").handleAppdata,chatstate:d("MAWHandleChatState").handleChatState,error:d("WABackendHandleError").handleError,failure:d("MAWHandleFailure").handleFailure,ib:d("WAHandleInfoBulletin").handleInfoBulletin,message:t.handleStanza,notification:t.handleStanza,receipt:t.handleStanza,retryReceipt:t.handleStanza,streamError:d("WAHandleStreamError").handleStreamError,success:d("WAHandleSuccess").handleSuccess},t)});d("MAWDefinePersistedJob").setMsgrJobImplementations(d("MAWJobHandlers").getJobHandlers());u=new(b("Promise"))(function(a){d("WAScheduleAfterOfflineResume").scheduleAfterOfflineResume({code:function(){a();return b("Promise").resolve()},id:"task-scheduler"})});c("promiseDone")(q.promise.then(function(){return d("MAWTaskDefinitions").registerTasks(u)}));f.setHandlers("backend",babelHelpers["extends"]({},g.bridgeHandlers,{runJob:function(a){var b=a.id;return q.promise.then(function(){return r.loadAndRunJobFromId(b)})},runJobFireAndForget:function(a){return q.promise.then(function(){return r.fireAndForget(a)})},runJobWaitUntilCompleted:function(a){return q.promise.then(function(){return r.waitUntilCompleted(a)})},runJobWaitUntilPersisted:function(a){return q.promise.then(function(){return r.waitUntilPersisted(a)})},sendChatState:function(a){var b=a.chatJid;a=a.state;d("WASendChatStateRPC").sendChatStateRPC(b,a)},uploadMedia:d("WAUploadMedia").uploadMedia}));d("MAWPREListeners").initializeWAPREMetrics();d("MAWFTSDataSync").initFTS();d("MAWMailboxUploadDataSync").initMailboxUpload();d("MAWDyiBatchRestoreDataSync").initDyiBatchUpload();d("MAWStanzaQueueInit").initStanzaQueue();y.next=19;return b("regeneratorRuntime").awrap(d("WAGetClockSkewApi").getClockSkew());case 19:v=y.sent;w=v.clockSkew;d("WATimeUtils").setClockSkew(w);d("MAWEphemeralCleaner").startEphemeralCleaner({getNextTs:g.dbCallbacks.getNextExpirationTs,purgeEnabled:d("MAWGating").isEphemeralMessagesEnabled,removeExpired:g.dbCallbacks.removeExpiredMsgsFromUI},{getNextTs:g.dbCallbacks.getNextDeletionTs,purgeEnabled:d("MAWGating").isEphemeralMessagesEnabled,removeExpired:g.dbCallbacks.deleteExpiredMsgs});d("MAWUnsendMsgContentCleaner").startUnsendMsgContentCleaner({getNextTs:g.dbCallbacks.getNextDeleteUnsendContentTs,purgeEnabled:d("MAWGating").isUnsendGlobalEnabled,removeExpired:g.dbCallbacks.removeExpiredUnsendMsgsContent});d("MAWDeleteForMeMsgContentCleaner").startDeleteForMeMsgContentCleaner({getNextTs:g.dbCallbacks.getNextDeleteDFMContentTs,purgeEnabled:d("MAWGating").isUnsendLocallyEnabled,removeExpired:g.dbCallbacks.removeExpiredDFMMsgsContent});d("MAWPendingStanzaCleaner").startPendingStanzaCleaner({getNextTs:g.dbCallbacks.getNextDeletePendingStanzaTs,purgeEnabled:d("MAWGating").isUnsendLocallyEnabled||d("MAWGating").isUnsendGlobalEnabled,removeExpired:g.dbCallbacks.removeExpiredPendingStanzas});d("MAWExpiredXMACleaner").startExpiredXMACleaner({getNextTs:g.dbCallbacks.getNextExpiredXMATs,purgeEnabled:d("MAWGating").isXMAFeedPostShareEnabled,removeExpired:g.dbCallbacks.removeExpiredXMAMsgsContent});y.prev=27;y.next=30;return b("regeneratorRuntime").awrap(d("MAWCommonWorkerActions").downloadAndAddAllMissingDualSendMedia());case 30:y.next=35;break;case 32:y.prev=32,y.t0=y["catch"](27),d("WALogger").ERROR(j(),y.t0);case 35:y.next=37;return b("regeneratorRuntime").awrap(d("MAWAbProps").initAbProps());case 37:c("gkx")("5421")&&d("WADebugTools").initDebugFunctions(d("MAWDebugDefineFunctions").getAllDebugFunctions());x=null;return y.abrupt("return",o(a).then(function(a){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("MAWCommsConfig").getCommsConfig({authKeyPair:a,handleConnectionChange:function(a){if(a==="in_handshake")x==null?x=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25312111,"2151")):d("WALogger").LOG(i());else if(a==="connected"){var b;if(p.waitForConnection())return q.resolve();d("MAWQplProxy").addQplPoint(c("qpl")._(1056839232,"112"),"wai_ws_connected");(b=x)==null?void 0:b.endSuccess();x=null}else if(a==="disconnected"){(b=x)==null?void 0:b.endFail("disconnected");x=null}},handleOptimisticConnectionChange:function(a){a==="connected"?(d("MAWQplProxy").addQplPoint(c("qpl")._(1056839232,"112"),"wai_ws_optimistic_connected"),d("WASendPresenceStatus").sendPresenceStatus({status:"available"})):a==="disconnected"&&d("WASendPresenceStatus").sendPresenceStatus({status:"unavailable"})}}));case 2:e=f.sent,d("MAWQplProxy").addQplPoint(c("qpl")._(1056839232,"112"),"wai_ws_connection_start"),d("WAComms").startComms(d("MAWGlobals").getServerRPC().handleStanza,e,n),d("MAWSyncd").initializeSyncd(),d("MAWCommonWorkerActions").deleteThreadsIfWasPreviouslyInDualSend()["catch"](function(a){d("WALogger").ERROR(h(),a)});case 7:case"end":return f.stop()}},null,this)}).then(function(){if(p.waitForConnection())return q.promise;else return q.resolve()}));case 40:case"end":return y.stop()}},null,this,[[27,32]])}g.startWABackend=a}),98);
__d("WASentinelMutationSync",["Promise","WAGetSyncKey","WALogger","WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst","WASyncdKeyManagement","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sentinel mutation sync: no key pairs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sentinel mutation sync: operation not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sentinel mutation sync: malformed mutation"]);j=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.version=3,c.action=d("WASyncdConst").Actions.Sentinel,b)||babelHelpers.assertThisInitialized(c)}var e=c.prototype;e.applyMutations=function(a){return b("Promise").all(a.map(function(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.prev=0;if(!(a.operation==="set")){f.next=9;break}e=(c=a.value.keyExpiration)==null?void 0:c.expiredKeyEpoch;if(!(e==null)){f.next=6;break}d("WALogger").ERROR(j());return f.abrupt("return",{actionState:d("WASyncdConst").SyncActionState.Malformed});case 6:f.next=8;return b("regeneratorRuntime").awrap(d("WAGetSyncKey").expireSyncKeyInTransaction(e));case 8:return f.abrupt("return",{actionState:d("WASyncdConst").SyncActionState.Success});case 9:d("WALogger").WARN(i());return f.abrupt("return",{actionState:d("WASyncdConst").SyncActionState.Unsupported});case 13:f.prev=13;f.t0=f["catch"](0);return f.abrupt("return",{actionState:d("WASyncdConst").SyncActionState.Failed});case 16:case"end":return f.stop()}},null,this,[[0,13]])}))};e.getSentinelMutations=function(){var a=this,c,e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=d("WATimeUtils").unixTimeMs();e=Array.from(d("WASyncdConst").CollectionName.members());j.next=4;return b("regeneratorRuntime").awrap(d("WASyncdKeyManagement").getNewestKeyPair());case 4:f=j.sent;if(!(f==null)){j.next=8;break}d("WALogger").ERROR(h());return j.abrupt("return",[]);case 8:g=f.keyEpoch;i={keyExpiration:{expiredKeyEpoch:g}};return j.abrupt("return",e.map(function(b){return d("WASyncdActionUtils").buildPendingMutation({collection:b,indexArgs:[b],operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,version:a.version,value:i,timestamp:c,action:a.action})}));case 11:case"end":return j.stop()}},null,this)};return c}(d("WASyncdAction").SyncActionBase);c=new a();Object.freeze(c);e=c;g["default"]=e}),98);
__d("WABaseConfigValues",["WAErr","WASentinelMutationSync"],(function(a,b,c,d,e,f,g){"use strict";a={isCompanion:function(){return!1},logoutInProgress:function(){return!1},mediaImagePreviewHkdfInfo:function(){throw c("WAErr")("config: No config for mediaImagePreviewHkdfInfo")},mediaVideoPreviewHkdfInfo:function(){throw c("WAErr")("config: No config for mediaVideoPreviewHkdfInfo")},offlineProcessingState:function(){return"idle"},orchestratorVersion:function(){return"default"},primaryPlatform:function(){return void 0},syncdAdditionalMutations:function(){return 1},syncdActionHandlers:function(){return[c("WASentinelMutationSync")]},syncdDisabled:function(){return!0},syncdInlineMutationsMaxCount:function(){return 1e3},syncdKeyMaxUseDays:function(){return 30},syncdMaxMutationsToProcessDuringResume:function(){return 1e3},syncdPatchDeviceIndexIncluded:function(){return!1},syncdPatchProtobufMaxSize:function(){return 100},syncdQPLLoggingEnabled:function(){return!1},syncdShouldFatalOnMissingPatch:function(){return!0},syncdShouldNotFatalOnSnapshotMacMismatchInPatches:function(){return!1},syncdWaitForKeyTimeoutDays:function(){return 2},maxPrekeysToUpload:function(){return 812},forceNonPersistedJobs:function(){return!1},ignoreForceNonPersistedJobList:function(){return[]},orchestratorConfig:function(){return""},waitForConnection:function(){return!1}};a;b=a;g["default"]=b}),98);
__d("MAWBaseConfig",["MAWAbProps","MAWGating","MAWGlobals","MAWSyncdDeleteChatAction","MAWSyncdDeleteMessageForMeAction","WABaseConfigValues","WAOfflineUtils","WASentinelMutationSync"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},c("WABaseConfigValues"),{enableRawStanzaQueueStore:d("MAWGating").enableRawStanzaQueueStore,forceNonPersistedJobs:function(){return d("MAWGating").isForceNonPersistedJobsEnable()},ignoreForceNonPersistedJobList:function(){return["sendMsg","sendReactionMsg","sendMediaMsg"]},maxPrekeysToUpload:function(){return d("MAWAbProps").getAbProp("msgrw_max_keys")},offlineProcessingState:function(){var a;a=(a=d("MAWGlobals").getServerRPC().offlineQueueManager())==null?void 0:a.getStatus();if(a==null)return"idle";switch(a){case d("WAOfflineUtils").ServerRPCMode.OFFLINE_RESUME:return"processing";case d("WAOfflineUtils").ServerRPCMode.ONLINE:case d("WAOfflineUtils").ServerRPCMode.INIT:return"idle"}},orchestratorConfig:function(){return d("MAWAbProps").getAbProp("msgrw_job_manager_conf")},syncdActionHandlers:function(){return[c("WASentinelMutationSync"),c("MAWSyncdDeleteMessageForMeAction"),c("MAWSyncdDeleteChatAction")]}});a;b=a;g["default"]=b}),98);
__d("createReStoreColdEBTablesPersistence",["MAWLSDBEncryption","Promise","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&Object.prototype.hasOwnProperty.call(a,"SENTINEL_DELETED")?!0:!1}function i(a){return new window.Promise(function(b,c){a.onsuccess=function(a){b(a.target.result)},a.onerror=function(a){c(a)}})}function a(a){var e=!0;return{clearCache:function(){},close:function(){a.close(),e=!1},flush:function(c){var f,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:if(!(!e||c.size===0)){j.next=2;break}return j.abrupt("return");case 2:f=a.transaction(a.objectStoreNames,"readwrite",{durability:"relaxed"});g=new window.Promise(function(a,b){f.oncomplete=function(b){a(b.target.result)},f.onerror=function(a){b(a)}});j.next=6;return b("regeneratorRuntime").awrap(b("Promise").all(Array.from(c).map(function(a){var c,e,g;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:c=a[0],e=a[1];g=f.objectStore(c);j.next=4;return b("regeneratorRuntime").awrap(b("Promise").all(Array.from(e).map(function(a){var e,f,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=a[0],f=a[1];if(!h(f)){k.next=6;break}k.next=4;return b("regeneratorRuntime").awrap(i(g["delete"](e)));case 4:k.next=9;break;case 6:j=d("MAWLSDBEncryption").encryptLSDBObj(f,c);k.next=9;return b("regeneratorRuntime").awrap(i(g.put(j,e)));case 9:case"end":return k.stop()}},null,this)})));case 4:case"end":return j.stop()}},null,this)})));case 6:j.next=8;return b("regeneratorRuntime").awrap(g);case 8:case"end":return j.stop()}},null,this)},get:function(a,b,d,e){throw c("err")("Unsupported operation")},runExclusively:function(a){throw c("err")("Unsupported operation")},shouldSync:function(){throw c("err")("Unsupported operation")},types:["indexeddb"]}}g["default"]=a}),98);
__d("MAWPersistedEBLSDB",["EBInMemoryTables","LSMetadata","MAWIndexedDbMetadata","Promise","createReStoreColdEBTablesPersistence","err"],(function(a,b,c,d,e,f,g){"use strict";a.window=a;var h;function i(a){return a.objectStoreNames.length===0}function e(a){return new(b("Promise"))(function(b,e){var f=indexedDB.open(d("MAWIndexedDbMetadata").ebLSDBName(a));f.onerror=function(a){return e(a)};f.onsuccess=function(a){var c=a.target.result;b(c);c.onversionchange=function(a){a.newVersion==null&&c.close()}};f.onupgradeneeded=function(a){a=a.target.result;if(i(a)){var e=Object.keys(d("LSMetadata").metadata.tableIds);for(var f=0;f<e.length;f++){var g=e[f],h=d("LSMetadata").metadata.tableIds[Number(g)].name;c("EBInMemoryTables").has(h)&&a.createObjectStore(d("LSMetadata").metadata.tableIds[Number(g)].name,{autoIncrement:!0})}}b(a)}}).then(function(a){return c("createReStoreColdEBTablesPersistence")(a)}).then(function(a){return h=a}).then(function(a){})}function f(){if(h==null)throw c("err")("EBLSDB initialization error");return h}g.makeEBLSDB=e;g.getEBLSDB=f}),98);
__d("MAWGetAppDataApi",["MAWAckLevel","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send appdata with no permitted identities"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b){return a.appData.get({externalId:b}).then(function(b){if(b==null)return{type:"missing"};else if(b.permittedIdentitiesPerDevice.size===0){d("WALogger").ERROR(h());return a.appData["delete"](b.appDataId).then(function(){return{type:"missing"}})}else if(b.ack>=d("MAWAckLevel").ACK.sent)return{appData:b.contents,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,sendPartial:!0,type:"already_sent"};else return{appData:b.contents,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,sendPartial:b.sendPartial===!0,type:"not_sent"}})});g.getAppData=a}),98);
__d("MAWGetAppDataForResendApi",["MAWDbIdentityTxns","MAWGlobals","MAWIndexedDb","MAWTransactionMode","MAWUpdateDevicesForUserApi","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to resend appdata with no permitted identities"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE,identity:d("MAWTransactionMode").READONLY})(function(a,b){return a.appData.get({externalId:b}).then(function(b){return b==null?{type:"missing"}:d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,d("MAWGlobals").getMyUserJid()).then(function(a){var c=d("MAWGlobals").getMyDeviceJid();return a.filter(function(a){return c!==a&&!b.recipientDevices.has(a)&&!b.permittedIdentitiesPerDevice.has(a)})}).then(function(b){return d("MAWDbIdentityTxns").getIdentitiesForDevices(a,b)}).then(function(c){if(c.size===0)if(b.permittedIdentitiesPerDevice.size===0){d("WALogger").ERROR(h());return a.appData["delete"](b.appDataId).then(function(){return{type:"missing"}})}else return{appData:b.contents,permittedIdentitiesPerDevice:c,sendPartial:!0,type:"already_sent"};var e=new Map([].concat(Array.from(b.permittedIdentitiesPerDevice),Array.from(c))),f=new Set([].concat(Array.from(b.recipientDevices),Array.from(e.keys())));return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:e,recipientDevices:f}).then(function(){return{appData:b.contents,permittedIdentitiesPerDevice:c,sendPartial:!0,type:"not_sent"}})})})});g.getAppDataForResend=a}),98);
__d("MAWGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY})(function(a,b,c){return a.appData.get({externalId:b}).then(function(a){if(a==null)return{type:"missing"};var b=a.permittedIdentitiesPerDevice.get(c);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})});g.getAppDataForRetry=a}),98);
__d("MAWHandleEncryptedBackupsSecretsApi",["MAWDbHistorySyncQRCodeData","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({historySyncQRCodeData:d("MAWTransactionMode").READWRITE})(function(a,b){var c=b.backupId,e=b.epoch,f=b.mailboxRootKey,g=b.obliviousValidationToken,i=b.serverDataId,j=b.tempOcmfClientState;return a.historySyncQRCodeData.get(d("MAWDbHistorySyncQRCodeData").qrCodeRowId).then(function(b){if(!(b==null?void 0:b.isQRScanned))return a.historySyncQRCodeData.put({isQRScanned:!0,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CallFinishAddDevice",value:{backupId:c.toString(),epoch:h(e),mailboxRootKey:f,obliviousValidationToken:g,serverDataId:i.toString(),tempOcmfClientState:j}});return})["catch"](function(b){return a.historySyncQRCodeData.put({isQRScanned:!1,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(){})})})});function h(a){return a.map(function(a){var b=a.anonId,c=a.id,d=a.rootKey;a=a.status;return{epoch_anon_id:b,epoch_id:c.toString(),epoch_root_key:d,epoch_status:a.toString()}})}g.handleEncryptedBackupsSecret=a}),98);
__d("MAWMarkAppDataDroppedApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b){return a.appData.get({externalId:b}).then(function(b){if(b!=null)return a.appData["delete"](b.appDataId)})});g.markAppDataDropped=a}),98);
__d("MAWMarkAppDataSendFailedApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b){return a.appData.where("externalId").equals(b)["delete"]().then(function(){})});g.markAppDataSendFailed=a}),98);
__d("MAWMarkAppDataSentApi",["MAWAckLevel","MAWDbAppDataTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbAppDataTxns").updateAppDataSystemAck(a,b,d("MAWAckLevel").ACK.sent).then(function(){})});g.markAppDataSent=a}),98);
__d("MAWWriteAppDataRetryApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE})(function(a,b,c,d){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:e}).then(function(){})})});g.writeAppDataRetry=a}),98);
__d("MAWWriteOutgoingAppDataApi",["MAWAckLevel","MAWBridge","MAWDbIdentityTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWThreadTypes","MAWTransactionMode","MAWUpdateDevicesForUserApi","MAWWriteMetaSyncsTxns","WAJids","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor(babelHelpers["extends"]({appData:d("MAWTransactionMode").READWRITE,identity:d("MAWTransactionMode").READONLY},d("MAWThreadTypes").ThreadRelatedTablesPermissions))(function(a,b,c,e){return a.appData.get({externalId:b}).then(function(f){if(f!=null)if(f.ack>=d("MAWAckLevel").ACK.sent)return d("MAWDexieTable").dexieResolve({appDataExternalId:b,devices:Array.from(f.recipientDevices),type:"already_sent"});else return d("MAWDexieTable").dexieResolve({appDataExternalId:b,devices:Array.from(f.recipientDevices),type:"not_sent"});var g=e.contents,h=e.deviceIds;g.type==="meta_sync"?f=d("MAWDexieTable").dexieAll(g.actions.map(function(b){b.messageAction&&b.messageAction.type==="delete_for_me"&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.C2C_META_SYNC,key:"delete_for_me"});return d("MAWWriteMetaSyncsTxns").handleMetaSyncAction(a,b)})):(g.type,f=d("MAWDexieTable").dexieResolve([]));return d("MAWDexieTable").dexieAll([d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,d("MAWGlobals").getMyUserJid()),f]).then(function(a){a=a[0];if(h==null)return a;else{var b=new Set(h);return a.filter(function(a){return b.has(d("WAJids").extractDeviceId(a))})}}).then(function(b){return d("MAWDbIdentityTxns").getIdentitiesForDevices(a,b)}).then(function(e){var f=d("MAWGlobals").getMyDeviceJid();e["delete"](f);return e.size===0?{type:"no_devices"}:a.appData.add({ack:d("MAWAckLevel").ACK.clock,contents:g,externalId:b,permittedIdentitiesPerDevice:e,recipientDevices:new Set(e.keys()),sendPartial:h!=null,ts:c}).then(function(){return{appDataExternalId:b,devices:Array.from(e.keys()),type:"not_sent"}})})})});g.writeOutgoingAppData=a}),98);
__d("MAWArchiveThreadApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbThreadTxns").archiveThreads(a,[b],!1).then(function(){})});g.archiveThread=a}),98);
__d("MAWBackfillThreadsForOccamadilloApi",["MAWBridgeThread","MAWDbAppMeta","MAWDexieTable","MAWIndexedDb","MAWTimeUtils.bs","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Backfilled "," threads"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY})(function(a){return a.appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.isBackfilledForOccamadillo).then(function(b){return(b==null?void 0:b.value.isBackfilledForOccamadillo)===!0?d("MAWDexieTable").dexieResolve():a.threads.toArray().then(function(b){b.forEach(function(a){d("MAWTimeUtils.bs").getMillisTime(a.newestMsgTs)!=null&&d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a)})});return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.isBackfilledForOccamadillo,value:{isBackfilledForOccamadillo:!0}}).then(function(){d("WALogger").LOG(h(),b.length)})})})});g.backfillThreadsForOccamadillo=a}),98);
__d("MAWBulkUpdateContactApi",["MAWIndexedDb","MAWJids","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateContacts",!1)))(function(a,b){var c=b.contacts;return a.contacts.bulkGet(c.map(function(a){return d("MAWJids").toUserJid(a.fbid)})).then(function(b){var e=new Map(b.filter(Boolean).map(function(a){return[a.contactJid,a]}));b=c.map(function(a){var b=a.fbid,c=a.isBlocked,f=a.isRestricted,g=a.name;a=a.relationship;b=d("MAWJids").toUserJid(b);var h=e.get(b);return babelHelpers["extends"]({},h,{contactJid:b,devices:(h==null?void 0:h.devices)||[],dhash:(h==null?void 0:h.dhash)!=null?h.dhash:null,isBlocked:c,isRestricted:f,nameForSearch:g,relationship:a})});return a.contacts.bulkPut(b).then(function(){})})});g.updateContacts=a}),98);
__d("MAWChangeSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForContact(a,b)});g.changeSecurityAlertSetting=a}),98);
__d("MAWChangeSecurityAlertSettingForSelfApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForSelf(a,b)});g.changeSecurityAlertSettingForSelf=a}),98);
__d("MAWCheckIfShowOpenMessageHistoryApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWLocalizationType","MAWTimeUtils.bs","MAWTransactionMode","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getOldestNonAdminMsg",!1)))(function(a,b,c){return a.threads.get(b).then(function(e){if((e==null?void 0:e.isMigratedLocally)!=null&&(e==null?void 0:e.isMigratedLocally))return!0;e=a.messages.where(["thread","sortOrderMs"]).between([b,0],[b,d("MAWTimeUtils.bs").maxTimestampMs],!0,!0).filter(function(a){return!(a.type===d("WAMsgType").MSG_TYPE.ADMIN&&((a=a.msgContent)==null?void 0:a.adminType)===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION)}).first();return e.then(function(a){return a==null?!0:a.ts>d("WATimeUtils").castMilliSecondsToUnixTime(c)})})});g.checkIfShowOpenMessageHistory=a}),98);
__d("MAWCompareThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){a=new Set(a);for(var c=0;c<b.length;c++){var d=b[c];if(!a.has(d))return!1;a["delete"](d)}return a.size===0};a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE})(function(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,c.threadId).then(function(a){a=a.map(function(a){return a.userJid.split("@")[0]});var c=b;return h(a,c)})});g.compareThreadParticipants=a}),98);
__d("MAWCompleteUndoThreadCutoverApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["UpdateAdminMessageAfterUndoCutover failed to get the thread"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b){b=b.threadJid;return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return}b=b.value;if(b.isMigratedLocally===!0)return d("MAWDbThreadTxns").markCutoverThreadAsNotMigratedLocally(a,b).then(function(b){return d("MAWAdminWriteCutoverThreadMsgTxn").revertCutoverThreadAdminMsg(a,b).then(function(){return d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg(a,b)})})})});g.completeUndoThreadCutover=a}),98);
__d("MAWCreateThreadApi",["MAWIndexedDb","MAWJids","MAWThreadManagementTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b,c){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{offlineThreadingId:(a=c)!=null?a:void 0,userJid:d("MAWJids").toUserJid(b)}).then(function(a){var b=a.created;a=a.thread;return{chatId:a.chatId,created:b,jid:a.jid}})});g.createThread=a}),98);
__d("MAWCreateThreadByJidApi",["MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadThreadsTxns","MAWQplProxy","MAWThreadManagementTxns","MAWTransactionMode","WAJids","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=!0,i=null,j=0;function a(a){i=a,l()}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b){var e=b.authoritativeThreadKey,f=b.chatJid,g=b.lastActivityTimestampMs;b=b.lastReadWatermarkTimestampMs;h&&(h=!1,d("MAWQplProxy").addQplPoint(c("qpl")._(25300040,"1388"),"created_through_mi_backend_bridge"));var i=d("WATimeUtils").castToMillisTime(g),k=d("WATimeUtils").castToMillisTime(b);return d("WAJids").switchOnMsgrChatJidType(f,{group:function(b){return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,jid:b,lastActivityTimestamp:i,lastReadWatermarkTimestamp:k})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{authoritativeThreadKey:e,lastActivityTimestamp:i,lastReadWatermarkTimestamp:k,userJid:b})}}).then(function(b){return d("MAWLoadThreadsTxns").loadParticipantsAndMsgs(a,b.thread?b.thread:b,1).then(function(){j++;l();return{isCreated:b.created}})})});var k=!1;function l(){!k&&i!=null&&j>=i&&(k=!0,d("MAWQplProxy").addQplPoint(c("qpl")._(25300040,"1388"),"get_or_create_thread_complete"),d("MAWIndexedDb").afterTransaction({tag:"InitSyncComplete",value:void 0}))}g.setNumOccamadilloThreadsToLoad=a;g.createThreadByJid=b}),98);
__d("MAWDeleteThreadApi",["MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted thread ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingStanzas:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE})(function(a,b){return a.threads.get(b).then(function(e){if(e==null)throw c("err")("There was no thread to delete in local delete thread");return d("MAWThreadManagementTxns").deleteAllThreadData(a,e).then(function(){d("WALogger").LOG(h(),b)})})});g.deleteThread=a}),98);
__d("MAWDyiGetThreadList",["MAWDexieTable","MAWDyiBatchRestoreDataSync","MAWIndexedDb","MAWQplProxy","MAWTransactionMode","Promise","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({dyiBatch:d("MAWTransactionMode").READWRITE})(function(a,e){a.dyiBatch.clear();var f=e.reduce(function(b,c){return b.then(function(){return a.dyiBatch.add({isThread:!0,numMessages:0,oldestTs:0,threadId:c})})},b("Promise").resolve()).then(function(){e.forEach(function(a){var b=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521478596,"1329"),{string:{jid:a}});b.addPoint("dyi_backup_restore_start");b.endSuccess();d("MAWDyiBatchRestoreDataSync").restoreMessagesForThread(a,-1)})});c("promiseDone")(f);return d("MAWDexieTable").dexieResolve()});g.dyiGetThreadList=a}),98);
__d("MAWFetchExistingThreadApi",["MAWIndexedDb","MAWLoadThreadsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(function(a,b){b=b.threadId;return a.threads.get(b).then(function(b){b!=null&&d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b],10)})});g.fetchExistingThread=a}),98);
__d("MAWFetchExistingThreadForContactApi",["MAWIndexedDb","MAWLoadThreadsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(function(a,b){var c=b.offlineThreadingId;b=b.userJid;return a.threads.get({jid:b}).then(function(b){if(b==null)return;d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b],10,new Map([[b.jid,c]]))})});g.fetchExistingThreadForContact=a}),98);
__d("MAWFetchThreadMessageCountApi",["MAWDbMsg","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(function(a,b){return a.messages.where("thread").equals(b).filter(function(a){return!d("MAWDbMsg").isAdminMsg(a)}).toArray().then(function(a){return a.length})});g.fetchArmadilloThreadMessageCount=a}),98);
__d("MAWFlushLogsApi",["MAWWebWorkerLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(){d("MAWWebWorkerLogger").flushLogs()};g.flushLogs=a}),98);
__d("MAWGetAllThreadDevicesCountApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY})(function(a,b){return a.participants.where("threadId").equals(b).toArray().then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){b=b.userJid;return a.identity.where("userJid").equals(b).count()}))}).then(function(a){return a.reduce(function(a,b){return a+b},0)})});g.getAllThreadDevicesCount=a}),98);
__d("MAWGetBlobDataUrlByMediaIdApi",["FBLogger","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaDownloadManager","MAWTimedJob","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find media with mediaId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find chunk with mediaId: ",""]);i=function(){return a};return a}a=function(a){return j(a).then(function(e){if(e==null)return d("MAWMaybeWithTimeout").maybeWithTimeout(new(b("Promise"))(function(b){d("MAWMediaDownloadManager").setToMediaDownloadManager(a,b)}).then(function(a){return a}),d("MAWTimedJob").DEFAULT_TIMEOUT_MS,function(){d("WALogger").ERROR(i(),a);throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Failed to getBlobDataUrlByMediaId in time")});else return e})};var j=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY})(function(a,b){return a.media.get(b).then(function(c){if(c==null){d("WALogger").ERROR(h(),b);return}return a.chunk.where("hashedPlaintextHash").equals(c.hashedPlaintextHash).first().then(function(a){if(a==null)return;return new Blob([a.blobData],{type:a.mimetype})})})});g.getBlobDataUrlByMediaId=a}),98);
__d("MAWGetBlobDataUrlByXMAIdApi",["MAWGetBlobDataUrlByMediaIdApi","MAWIndexedDb","MAWTransactionMode","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaIdByXMAIdDbCall does not have valid information type - ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaIdByXMAIdDbCall cannot find xma with xmaId "," and info type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByXMAId cannot find xma chunk with mediaId "," and info type ",""]);j=function(){return a};return a}a=function(a,c){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(k(a,c));case 2:e=f.sent;if(!(e==null)){f.next=6;break}d("WALogger").WARN(j(),e,c);return f.abrupt("return");case 6:return f.abrupt("return",d("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByMediaId(e));case 7:case"end":return f.stop()}},null,this)};var k=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(function(a,b,c){return a.xma.get(b).then(function(a){if(a==null){d("WALogger").ERROR(i(),b,c);return}var e;switch(c){case"preview":e=a.defaultPreviewMediaId;break;case"header":e=a.headerMediaId;break;case"favicon":e=a.faviconMediaId;break;default:d("WALogger").ERROR(h(),c);return}return e})});g.getBlobDataUrlByXMAId=a}),98);
__d("MAWGetContactApi",["MAWDbContact","MAWDbContactsTxns","MAWIndexedDb","MAWJids","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({contacts:d("MAWTransactionMode").READONLY})(function(a,b){b=b.fbid;b=d("MAWJids").toUserJid(b);return d("MAWDbContactsTxns").getContact(a,b).then(function(a){var b;return{isBlocked:(b=a==null?void 0:a.isBlocked)!=null?b:!1,isRestricted:(b=a==null?void 0:a.isRestricted)!=null?b:!1,relationship:(b=a==null?void 0:a.relationship)!=null?b:d("MAWDbContact").NON_CONTACT}})});g.getContact=a}),98);
__d("MAWGetGroupSuperAdminApi",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY})(function(a,b){return a.participants.where("threadId").equals(b).filter(function(a){return a.type==="superadmin"}).first().then(function(a){if(a)return d("WAJids").extractUserId(a.userJid);else return null})});g.getGroupSuperAdmin=a}),98);
__d("MAWGetIdentityKeys",["MAWIndexedDb","MAWTransactionMode","SignalDbTypes","WALogger","WASignalKeys","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);h=function(){return a};return a}var i="IdentityKey was null";a=d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READONLY})(function(a){return a.meta.get(d("SignalDbTypes").MetaKeysEnum.identityKeyPair).then(function(a){a=a==null?void 0:a.value.identityKeyPair;if(a==null){d("WALogger").ERROR(h(),i);throw c("err")(i)}var b=d("WASignalKeys").serializePubKey(a);a=a.privateKey;return{identityPrivateKey:a,identityPublicKey:b}})});g.errNullKey=i;g.getIdentityKeys=a}),98);
__d("MAWGetLatestThreadIdsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WADualSendMsgUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds complete, threads count: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds started"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY})(function(a,b){d("WALogger").LOG(i());a=a.threads.orderBy("threadOrder").reverse().limit(b).toArray();return a.then(function(a){var b=[];a.forEach(function(a){d("WADualSendMsgUtils").isDualSendJid(a.jid)||b.push(a.jid.split("@")[0])});d("WALogger").LOG(h(),b.length);return d("MAWDexieTable").dexieResolve(b)})});g.getLatestThreadIds=a}),98);
__d("MAWGetMaybeNextNonAdminMsgSortOrderMsApi",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWRestoreMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY})(function(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(a,c),d("MAWDbThreadTxns").getThread(a,b)]).then(function(b){var c=b[0];b=b[1];var e=0;if(d("MAWRestoreMsgsTxns").isE2eeOrCutoverAdminMsg(c)&&b.success&&c!=null)return d("MAWRestoreMsgsTxns").getNextMsgBasedOnSortOrderMs(a,b.value,c==null?void 0:c.msgId).then(function(a){a!=null&&a.sortOrderMs!=null&&(e=a.sortOrderMs);return{minMsgTimestampMs:e}});else c!=null&&c.sortOrderMs!=null&&(e=c.sortOrderMs);return{minMsgTimestampMs:e}})});g.getMaybeNextNonAdminMsgSortOrderMs=a}),98);
__d("MAWGetSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY})(function(a){return d("MAWDbMsgTypeVersionTxns").getSecuritySettingForContact(a)});g.getSecurityAlertSetting=a}),98);
__d("MAWGetSecurityAlertSettingForSelfAndContactApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY})(function(a){return d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a)});g.getSecurityAlertSettingForSelfAndContact=a}),98);
__d("MAWGetShadowGroupByOpenThreadKeyApi",["MAWBridgeTypes","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY})(function(a,b){return a.groupInfo.where("correspondingOpenThreadKey").equals(b).toArray().then(function(a){return a.map(d("MAWBridgeTypes").createBridgeGroupInfo)})});g.getShadowGroupByOpenThreadKey=a}),98);
__d("MAWGetThreadDevicesInfoApi",["MAWIndexedDb","MAWJids","MAWSignalUtils","MAWTransactionMode","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY})(function(a,b){b=b.fbid;b=d("MAWJids").toUserJid(b);return a.identity.where("userJid").equals(b).toArray().then(function(a){return a.map(function(a){return{deviceId:d("WAJids").extractDeviceId(a.deviceJid),firstSeenTs:a.firstSeenTs!=null?d("WATimeUtils").toDate(a.firstSeenTs):null,identityKey:d("MAWSignalUtils").getHexRepresentation(a.identity)}})})});g.getThreadDevicesInfo=a}),98);
__d("MAWGetThreadParticipantFBIDsApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY})(function(a,b){b=b.chatId;return a.participants.where("threadId").equals(b).toArray().then(function(a){return a.map(function(a){return a.userJid.split("@msgr")[0]}).filter(function(a){return a!=null&&a!==""})})});g.getThreadParticipantFBIDs=a}),98);
__d("blobToDataUri",["Promise","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var d,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d=new FileReader();e=new(b("Promise"))(function(a,b){d.onloadend=a,d.onerror=b});d.readAsDataURL(a);g.next=5;return b("regeneratorRuntime").awrap(e);case 5:f=d.result;if(!(typeof f!=="string")){g.next=8;break}throw c("err")('Unexpected result type "%s" when reading Blob as DataURL.',f instanceof ArrayBuffer?"ArrayBuffer":typeof f);case 8:return g.abrupt("return",f);case 9:case"end":return g.stop()}},null,this)}g["default"]=a}),98);
__d("MAWGetThumbnailBlobDataUrlByMediaIdApi",["MAWDbChunkTxns","MAWDbMedia","MAWGating","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaPreviewDownloadManager","MAWTransactionMode","Promise","WALogger","WAResultOrError","blobToDataUri","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaIdDbCall cannot generate thumbnail for non image or video mediaType: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaIdDbCall cannot generate thumbnail for mediaType "," for mediaId: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailFromMedia cannot find media"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: returning generated jpegThumbnail from chunk"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: unable to generate jpegThumbnail as chunk is missing"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaId cannot find thumbnail to download"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaId cannot find thumbnail to download with mediaId: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaId: Found jpegThumbnail entry for ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThumbnailBlobDataUrlByMediaId: Get thumbnail blob for ",""]);p=function(){return a};return a}a=function(a){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:d("WALogger").LOG(p(),a);i.next=3;return b("regeneratorRuntime").awrap(s(a));case 3:e=i.sent;i.next=6;return b("regeneratorRuntime").awrap(t(e));case 6:f=i.sent;if(!(f.success===!0)){i.next=10;break}d("WALogger").LOG(o(),a);return i.abrupt("return",c("blobToDataUri")(f.value));case 10:i.t0=f.error;i.next=i.t0==="missing_jpeg_thumbnail"?13:i.t0==="invalid_media"?30:i.t0==="missing_media"?30:31;break;case 13:if(!(e==null)){i.next=15;break}return i.abrupt("return",null);case 15:if(!(e.mediaType===d("MAWDbMedia").MEDIA_TYPE.IMAGE||e.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO)){i.next=29;break}i.next=18;return b("regeneratorRuntime").awrap(q(e));case 18:g=i.sent;if(!(g!=null)){i.next=21;break}return i.abrupt("return",c("blobToDataUri")(g));case 21:if(!((e==null?void 0:e.mediaType)===d("MAWDbMedia").MEDIA_TYPE.VIDEO)){i.next=23;break}return i.abrupt("return",null);case 23:i.next=25;return b("regeneratorRuntime").awrap(r(e));case 25:h=i.sent;if(!(h==null)){i.next=28;break}return i.abrupt("return",null);case 28:return i.abrupt("return",c("blobToDataUri")(h));case 29:return i.abrupt("return",null);case 30:return i.abrupt("return",null);case 31:case"end":return i.stop()}},null,this)};var q=function(a){if(!d("MAWGating").isDownloadablePreviewsEnabled())return b("Promise").resolve(null);var c=d("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(a.hashedPlaintextHash);return c==null?b("Promise").resolve(null):d("MAWMaybeWithTimeout").maybeWithTimeout(c.promise,1e4,function(){d("WALogger").WARN(n(),a.mediaId);d("WALogger").ERROR(m());return null})},r=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){if(a==null){d("WALogger").ERROR(l());return}d("WALogger").WARN(k());return new Blob([a.blobData],{type:a.mimetype})})}),s=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY})(function(a,b){return a.media.get(b)}),t=function(a){var b;if(a==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_media")}switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return((b=a.validatedImageInfo)==null?void 0:b.jpegThumbnail)!=null?d("WAResultOrError").makeResult(new Blob([a.validatedImageInfo.jpegThumbnail])):d("WAResultOrError").makeError("missing_jpeg_thumbnail");case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return((b=a.validatedVideoInfo)==null?void 0:b.jpegThumbnail)!=null?d("WAResultOrError").makeResult(new Blob([a.validatedVideoInfo.jpegThumbnail])):d("WAResultOrError").makeError("missing_jpeg_thumbnail");default:d("WALogger").WARN(i(),a.mediaType,a.mediaId);d("WALogger").ERROR(h(),a.mediaType);return d("WAResultOrError").makeError("invalid_media")}};g.getThumbnailBlobDataUrlByMediaId=a}),98);
__d("MAWGetWorkerHeartbeatApi",["Promise"],(function(a,b,c,d,e,f){"use strict";a=function(){return b("Promise").resolve(!0)};f.getWorkerHeartbeat=a}),66);
__d("MAWInitSyncApi",["MAWBridgeTypes.bs","MAWCreateThreadByJidApi","MAWDexieTable","MAWFolderTypes","MAWGating","MAWIndexedDb","MAWLLAMigrationUtils","MAWLoadThreadsTxns","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("initSync",!1,{bool:{isInitSyncApiImprovementsEnabled:d("MAWGating").isInitSyncApiImprovementsEnabled,newLLA:!1}})))(function(a,b,c){if(d("MAWGating").isOccamadillo()){d("MAWCreateThreadByJidApi").setNumOccamadilloThreadsToLoad(b);return d("MAWDexieTable").dexieResolve()}return d("MAWDexieTable").dexieAll([h(a,b,c,d("MAWFolderTypes").FOLDER_ID.INBOX),h(a,b,c,d("MAWFolderTypes").FOLDER_ID.PENDING),h(a,b,c,d("MAWFolderTypes").FOLDER_ID.OTHER),h(a,b,c,d("MAWFolderTypes").FOLDER_ID.SPAM)]).then(function(){d("MAWIndexedDb").afterTransaction({tag:"InitSyncComplete",value:void 0})})});function h(a,b,c,e){return a.threads.orderBy("threadOrder").filter(function(a){return e===d("MAWFolderTypes").FOLDER_ID.INBOX?a.folder==null||a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX:a.folder===e}).reverse().limit(b).toArray().then(function(b){return d("MAWLoadThreadsTxns").loadContentsForThreads(a,b,c)}).then(function(a){if(a.length===0){d("MAWIndexedDb").afterTransaction({tag:"ThreadsLoaded",value:d("MAWBridgeTypes.bs").makeThreadRangeNoThreads({folderId:e})});return}var c=a[0],f=a[a.length-1];d("MAWIndexedDb").afterTransaction({tag:"ThreadsLoaded",value:d("MAWBridgeTypes.bs").makeInitialThreadRange({folderId:e,hasMore:a.length>=b,maxLastActivityTs:(a=c.newestMsgTs)!=null?a:d("WATimeUtils").castToMillisTime(0),maxThreadId:c.chatId,minLastActivityTs:(a=f.newestMsgTs)!=null?a:d("WATimeUtils").castToMillisTime(0),minThreadId:f.chatId})})})}g.initSync=a;g.loadThreadsByFolderId=h}),98);
__d("MAWInsertAdminMessageInCutoverThreadsApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b){var c=b.openThreadId,e=b.threadJid;b=b.traceId;return d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg(a,e,c,b).then(function(b){b=b.needsMarkThreadAsMigrated;if(b)return d("MAWDbThreadTxns").markCutoverThreadAsMigratedLocally(a,e)}).then(function(){return!0})});g.insertAdminMessageInCutoverThreads=a}),98);
__d("MAWLoadMediaApi",["MAWBridgeTypes","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to load media for thread. ThreadId "," does not exist"]);h=function(){return a};return a}var i=20,j=0;a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY})(function(a,b){var c=b.minRowId,e=b.threadId;return a.threads.get(e).then(function(b){if(b==null)throw d("WALogger").ERROR(h(),e);return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").craftMsgId(b.chatId,c)).filter(function(a){var b=d("WATimeUtils").unixTime(),c=d("MAWDbMsg").isMediaMsg(a);a=a.messageExpirationTs==null||a.messageExpirationTs>b;return c&&a}).limit(i).reverse().toArray()}).then(function(b){var c=b.length===i,f=b[b.length-1];f=f?d("MAWDbMsg").getInChatMsgIdFromMsgId(f.msgId):j;d("MAWIndexedDb").afterTransaction({tag:"NewMediaRange",value:d("MAWBridgeTypes").createBridgeMediaRange(e,f,c)});return d("MAWDbMediaTxns").getMediaFromMsgs(a,b).then(function(b){d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbChunkTxns").hasMediaChunk(a,b.hashedPlaintextHash).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:d("MAWBridgeTypes").createBridgeMedia(e,b,a)})})}))})})});g.loadMoreMedia=a}),98);
__d("MAWLoadMsgsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWLoadMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadMsgs",!1)))(function(a,b,c,e){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b,c,e).then(function(a){a=a.hasMore;return{hasMore:a}})});g.loadMsgs=a}),98);
__d("MAWLoadThreadsApi",["MAWBridgeTypes.bs","MAWDbThread","MAWDexieTable","MAWFolderTypes","MAWGating","MAWIndexedDb","MAWInitSyncApi","MAWLoadThreadsTxns","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,groupInvites:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(function(a,b,c,e,f){if(d("MAWGating").isOccamadillo())return d("MAWDexieTable").dexieResolve();return!b?d("MAWInitSyncApi").loadThreadsByFolderId(a,c,e,f):a.threads.get(b).then(function(b){if(b==null)return;return a.threads.where("threadOrder").between(d("MAWDbThread").MIN_THREAD_ORDER,b.threadOrder,!0,!1).filter(function(a){return f===d("MAWFolderTypes").FOLDER_ID.INBOX?a.folder===null||a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX:a.folder===f}).reverse().limit(c).toArray().then(function(b){return d("MAWLoadThreadsTxns").loadContentsForThreads(a,b,e)}).then(function(a){var b=a.length>=c;if(a.length===0){d("MAWIndexedDb").afterTransaction({tag:"ThreadsLoaded",value:d("MAWBridgeTypes.bs").makeThreadRangeNoThreads({folderId:f})});return}a=a[a.length-1];d("MAWIndexedDb").afterTransaction({tag:"ThreadsLoaded",value:d("MAWBridgeTypes.bs").makeThreadRangeForLoadBefore({folderId:f,hasMore:b,minLastActivityTs:(b=a.newestMsgTs)!=null?b:d("WATimeUtils").castToMillisTime(0),minThreadId:a.chatId})})})})});g.loadMoreThreads=a}),98);
__d("MAWMarkThreadAsUnreadApi",["MAWBridgeThread","MAWIndexedDb","MAWTimeUtils.bs","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE})(function(a,b){return a.threads.get(b).then(function(c){if(c!=null&&c.newestMsgTs){var e=d("MAWTimeUtils.bs").getMillisTime(c.newestMsgTs);if(e!=null){var f=d("WATimeUtils").castToMillisTime(0);return a.threads.update(b,{lastReadMsg:null,lastReadMsgTs:f}).then(function(a){a===1&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(b,f,e)})})}}})});g.markThreadAsUnread=a}),98);
__d("MAWPreEstablishSessionApi",["WAPreEstablishOutgoingSessionForGroup"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WAPreEstablishOutgoingSessionForGroup").maybePreEstablishOutgoingSession(a)};g.preEstablishSession=a}),98);
__d("MAWPredistributeSKDMApi",["WASendSenderKeyDistributionMsg"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){return d("WASendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(a,b)};g.predistributeSKDM=a}),98);
__d("MAWSendChatStateFromComposerApi",["MAWBridge","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY})(function(a,b){var c=b.state;b=b.threadId;return d("MAWDbThreadTxns").getThread(a,b).then(function(a){if(!a.success)return;a=a.value.jid;d("MAWBridge").getBridge().fireAndForget("backend","sendChatState",{chatJid:a,state:c})})});g.sendChatStateFromComposer=a}),98);
__d("MAWUnarchiveThreadApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbThreadTxns").unarchiveThreads(a,[b]).then(function(){})});g.unarchiveThread=a}),98);
__d("MAWUpdateParticipantNameApi",["MAWDbParticipant","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READWRITE})(function(a,b){var c=b.contactId,e=b.nickname;b=b.threadKey;b=d("MAWDbParticipant").craftParticipantId(b,c);return a.participants.update(b,{nickname:e}).then(function(a){})});g.updateParticipantName=a}),98);
__d("MAWUpdateThreadMuteSettingApi",["MAWBridgeTypes","MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE})(function(a,b){var c=b.muteDuration,e=b.threadId,f=c!==0&&c!==-1?d("WATimeUtils").futureUnixTime(c)*1e3:c;return a.threads.update(e,{muteExpireTimeMs:f}).then(function(){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({isDualSend:!1,muteExpireTimeMs:f,threadId:e})})})});g.updateThreadMuteSetting=a}),98);
__d("MAWWriteLSDBToPersistedEBTables",["MAWEBSwitch","MAWPersistedEBLSDB","MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521485383,"1408"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled()}});try{d("MAWPersistedEBLSDB").getEBLSDB().flush(a,{upgrade:!1}),b.endSuccess()}catch(a){b.endFail("uncaught exception")}};g.writeLSDBToPersistedEBTables=a}),98);
__d("MAWFlushCacheToDbApi",["Promise"],(function(a,b,c,d,e,f){"use strict";function a(){return b("Promise").resolve()}f.flushCacheToDb=a}),66);
__d("MAWHandleNewSessionIfMatchesApi",["MAWBridge","MAWDbIdentityTxns","MAWDbPrekeyTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAByteArray","WACryptoManager","WACryptoUtils","WAJids","WAOdsEnums","WAResultOrError","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return b!=null?a.identity.get(c).then(function(e){if(e!=null&&d("WACryptoUtils").serializedPubKeysEqual(e.identity,b))return!1;d("MAWGlobals").getMyDeviceJid()===c&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"handle_new_session_identity_mismatch"});return d("MAWDbIdentityTxns").bulkPutIdentities(a,[{deviceJid:c,identity:b,userJid:d("WAJids").extractUserJid(c)}]).then(function(){return!0})}):d("MAWDexieTable").dexieResolve(!1)}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{identity:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE,session:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("handleNewSessionIfMatches",!1)))(function(a,b,c,e,f,g){return a.session.get(b).then(function(i){i=i?d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(i.session)):null;if((i!=null&&c==null||i==null&&c!=null||i!=null&&c!=null&&!d("WASignalOther").areSessionHashesEqual(i,c))&&!d("MAWGlobals").getConfig().useCryptoManagerV2())return d("WAResultOrError").makeError("mismatch");i=a.session.put({id:b,session:d("WACryptoManager").encodeSession(e)});var j=g!=null?d("MAWDbPrekeyTxns").bulkDeletePreKeys(a,[g]):null;return d("MAWDexieTable").dexieAll([h(a,f,b),i,j]).then(function(a){var b=a[0];a[1];a[2];b;return d("WAResultOrError").makeResult(void 0)})})});g.handleNewSessionIfMatches=a}),98);
__d("MAWLoadRecentParticipantsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadRecentParticipants",!1)))(function(a,b,c){return a.threads.orderBy("threadOrder").filter(function(a){return d("WAJids").interpretAsGroupJid(a.jid)==null}).reverse().limit(b).toArray().then(function(a){var b=[];a.forEach(function(a){a=d("WAJids").interpretAsUserJid(a.jid);a!=null&&a!==c&&b.push(a)});return new Set(b)})});g.loadRecentParticipants=a}),98);
__d("MAWSessionApi",["MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WABase64","WAByteArray","WACryptoManager","WACryptoUtils","WALogger","WASignalOther","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- identity in session table is different with identity table ",", "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- identity in session table is different with identity table "]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSessionApi -- missing identity"]);j=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{identity:d("MAWTransactionMode").READONLY,session:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadSession",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([a.session.get({id:b}),a.identity.get({deviceJid:b})]).then(function(a){var b=a[0];a=a[1];if(b==null)return null;var e=d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(b.session));b=d("WACryptoManager").decodeSession(b.session);a==null?d("WALogger").ERROR(j()):d("WACryptoUtils").uint8ArraysEqual(a.identity,b.remote.pubKey)||(d("WALogger").ERROR(i()),c("gkx")("8498")&&c("gkx")("3827")&&d("WALogger").ERROR(h(),d("WABase64").encodeB64(a.identity),d("WABase64").encodeB64(b.remote.pubKey)));return{hash:e,session:b}})});b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{session:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadSession",!1)))(function(a,b){return a.session.bulkGet(b).then(k)});function k(a){return a.reduce(function(a,b){if(b==null)return a;var c=d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(b.session)),e=d("WACryptoManager").decodeSession(b.session);a.set(b.id,{hash:c,session:e});return a},new Map())}g.loadSession=a;g.bulkLoadSession=b;g.makeSessionMap=k}),98);
__d("MAWSetDevicesApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["User with "," cannot be found in the DB to make ICDC payload updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updated ICDC info for ",". New seq: ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateICDCForUser",!1)))(function(a,b,c){return a.contacts.get(b).then(function(b){if(b==null)return;else return a.contacts.put(babelHelpers["extends"]({},b,{icdcInfo:c}))}).then(function(a){a!=null?d("WALogger").DEV(i(),b,c.sequence):d("WALogger").DEV(h(),a)})});g.updateICDCForUser=a}),98);
__d("MAWGetMyDevicesApi",["MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","MAWUpdateDevicesForUserApi"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{identity:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMyDevices",!1)))(function(a){return d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,d("MAWGlobals").getMyUserJid())});g.getMyDevices=a}),98);
__d("MAWGetDeviceChangeAlertsByOptionsApi",["MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE,meta:d("MAWTransactionMode").READONLY})(function(a,b){return d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn(a,b)});g.getDeviceChangeAlertsByOptions=a}),98);
__d("MAWUpdateDeviceChangeAlertsApi",["MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(function(a,b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,b).then(function(b){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a).then(function(){return b})})});g.updateDeviceChangeAlerts=a}),98);
__d("MAWGetAllThreadsAsJsonApi",["MAWAckLevel","MAWDbChunkTxns","MAWDbGroupInfoTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWTransactionMode","MAWVault","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,d){return[{uri:a!=null?"messages/inbox/"+b+"/"+c+"/"+d[a.toString()]:""}]},i=function(a,b,c,e){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return{common:b,content:d("MAWVault").unvault(a.msgContent.content),jsonType:"text"};case d("WAMsgType").MSG_TYPE.IMAGE:return{common:b,jsonType:"photo",photos:h(a.mediaId,c,"photos",e)};case d("WAMsgType").MSG_TYPE.VIDEO:return{common:b,jsonType:"video",videos:h(a.mediaId,c,"videos",e)};case d("WAMsgType").MSG_TYPE.PTT:return{audio_files:h(a.mediaId,c,"audio",e),common:b,jsonType:"audio"};case d("WAMsgType").MSG_TYPE.GIF:return{common:b,gifs:h(a.mediaId,c,"gifs",e),jsonType:"gif"};case d("WAMsgType").MSG_TYPE.STICKER:return{common:b,jsonType:"sticker",sticker:{uri:a.mediaId!=null?"messages/stickers_used/"+e[a.mediaId.toString()]:""}};default:return null}},j=function(a,b,c){a=a.toString();return c[d("WAJids").isAuthorMe(a)?b:a]},k=function(a,b,c,d,e){var f="";b=b.filter(function(a){return a.userJid.toString()!==c}).map(function(a){return a.userJid.toString()});var g=function(b){return!Object.prototype.hasOwnProperty.call(a,b)||a[b]==null?"NO_FIRST_NAME":a[b].split(" ")[0]};if(e.success){e=e.value.name;if(e!=null)f=e;else switch(b.length){case 2:f=g(b[0])+"and"+g(b[1]);break;case 3:f=""+g(b[0])+g(b[1])+"and"+g(b[2]);break;case 4:f=""+g(b[0])+g(b[1])+g(b[2])+"and1other";break;default:f=""+g(b[0])+g(b[1])+g(b[2])+"and"+(b.length-3)+"others"}}else f=a[b[0]];return f==null?"unknown_user_"+d:f.toLowerCase().replace(/ /g,"")+("_"+d)},l=function(a,b,c){var e=d("MAWGlobals").getMyUserJid().toString(),f=b.chatId,g=b.nextInChatMsgId,h={audio:{},gifs:{},messages:[],participants:[],photos:{},stickers:{},threadName:"",videos:{}};b=b.newestMsg!=null?b.newestMsg:d("MAWDbMsg").craftMsgId(f,0);return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").getParticipantsInThread(a,f),d("MAWDbMsgTxns").getMsgsFromOffset(a,f,b,g,!0,!1),d("MAWDbGroupInfoTxns").getGroupInfoByThreadId(a,f)]).then(function(b){var g=b[0],l=b[1].msgs,m=b[2],n=l.filter(function(a){return a.ephemeralSetting===void 0});b=n.map(function(a){return a.msgId});var o={},p={},q={},r={};l=n.filter(function(a){return a.mediaId!=null});return d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaFromMsgs(a,l),d("MAWDbReactionsTxns").getReactionsFromMessages(a,b)]).then(function(b){var l=b[0];b=b[1];b.forEach(function(a){var b=a.author,d=a.reaction;a=a.reactToMsgId;if(a!=null&&d!=null){a=a.toString();a in r||(r[a]=[]);r[a].push({actor:j(b,e,c),reaction:d})}});return d("MAWDexieTable").dexieAll(l.map(function(b){var c=b.hashedPlaintextHash,e=b.mediaId.toString();o[e]=c.toString();q[c.toString()]={mediaId:e,mediaType:b.mediaType};return d("MAWDbChunkTxns").maybeGetChunkFromHash(a,c)})).then(function(a){a.filter(Boolean).forEach(function(a){var b=a.mimetype.split("/");b[0];b=b[1];var c=a.hashedPlaintextHash.toString();b=c+"."+b;c=q[c];var e=c.mediaId;c=c.mediaType;p[e]=b;switch(c){case d("MAWDbMedia").MEDIA_TYPE.GIF:h.gifs[b]=a.blobData;break;case d("MAWDbMedia").MEDIA_TYPE.IMAGE:h.photos[b]=a.blobData;break;case d("MAWDbMedia").MEDIA_TYPE.STICKER:h.stickers[b]=a.blobData;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:h.videos[b]=a.blobData;break;case d("MAWDbMedia").MEDIA_TYPE.PTT:h.audio[b]=a.blobData;break;default:break}});h.threadName=k(c,g,e,f,m);n.forEach(function(a){var b={is_unsent:a.ack<d("MAWAckLevel").ACK.sent,sender_name:j(a.author,e,c),timestamp:a.ts,type:a.type},f=a.msgId.toString();f in r&&(b=babelHelpers["extends"]({},b,{reactions:r[f]}));f=i(a,b,h.threadName,p);f!=null&&h.messages.push(f)});h.participants=g.map(function(a){return{name:c[a.userJid.toString()]}});return h})})})};a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY})(function(a){var b={};return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getAllThreadsForUser(a,d("MAWGlobals").getMyUserJid()),a.contacts.toArray()]).then(function(c){var e=c[0];c=c[1];var f={};c.forEach(function(a){f[a.contactJid.toString()]=a.nameForSearch});return d("MAWDexieTable").dexieAll(e.map(function(b){return l(a,b,f)})).then(function(a){a.forEach(function(a){b[a.threadName]=a});return b})})});g.getAllThreadsAsJson=a}),98);
__d("MAWEncryptedBackupsStateManager",["MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return;case 3:c("MAWEBSwitch").set(!0);return;case 2:case 4:default:c("MAWEBSwitch").set(!1);return}}g.setEncryptedBackupsState=a}),98);
__d("MAWDeleteExpiredMsgsApi",["MAWDbMsg","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWTransactionMode","WAArmadilloXMA.pb","WALogger","WASortedLists","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," XMA rows"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," media rows, "," chunk rows."]);i=function(){return a};return a}function j(a,b){return a.media.bulkGet(b.map(function(a){return a[0]})).then(function(c){var e=[],f=[];c.forEach(function(a,c){if(a!=null){var g=b[c][1];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.hashedPlaintextHash!=null&&e.push(a.hashedPlaintextHash),f.push(a.mediaId))}});c=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(e)["delete"]();return d("MAWDexieTable").dexieAll([c,g]).then(function(){d("WALogger").LOG(i(),f.length,e.length)})})}function k(a,b){var c=[];if(d("MAWGating").isXMAFeedPostShareEnabled()){var e=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b[0])});return d("MAWDexieTable").dexieAll(e).then(function(e){e.forEach(function(a,d){if(a!=null){var e=b[d][1];a.faviconMediaId!=null&&c.push([a.faviconMediaId,e]);a.headerMediaId!=null&&c.push([a.headerMediaId,e]);if(a.previewMediaIds!=null){(d=a.previewMediaIds)==null?void 0:d.forEach(function(a){c.push([a,e])})}}});e=a.xma.bulkDelete(e.filter(Boolean).map(function(a){a=a.xmaId;return a}));var f=j(a,c);return d("MAWDexieTable").dexieAll([f,e]).then(function(){d("WALogger").LOG(h(),b.length)})})}else return d("MAWDexieTable").dexieResolve()}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("deleteExpiredMsgs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(b){var c=[],e=[],f=[],g=[],h=[];b.forEach(function(a){a.mediaId!=null&&c.push([a.mediaId,a.msgId]);if(d("MAWDbMsg").isXMAMsg(a)){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId);b!=null&&h.push([b,a.msgId])}if(a.quote!=null&&a.quote.content.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY){b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.quote.content.externalId);b!=null&&h.push([b,a.msgId])}e.push(a.msgId);f.push({author:a.author,chatId:a.thread,externalId:a.externalId});g.push(a.rowId)});b=a.messages.bulkDelete(g);var i=a.receipts.bulkDelete(e),l=j(a,c),m=k(a,h),n=d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,f);return d("MAWDexieTable").dexieAll([b,i,n,l,m]).then(function(){return d("MAWDexieTable").dexieResolve(g.length)})})});g.deleteOrUpdateMediaAndChunkForExpiredMsgs=j;g.deleteOrUpdateXMAForExpiredMsgs=k;g.deleteExpiredMsgs=a}),98);
__d("MAWGetEphemeralSettingsApi",["MAWDbContactsTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received invalid chat jid for getting ephemeral settings"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getEphemeralSettings",!1)))(function(a,b){b=d("WAJids").interpretAsUserJid(b);if(!b){d("WALogger").ERROR(h());return d("MAWDexieTable").dexieResolve()}return d("MAWDbContactsTxns").getContact(a,b).then(function(a){return a==null?void 0:a.ephemeralSetting})});g.getEphemeralSettings=a}),98);
__d("MAWGetNextDeletionTsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextDeletionTs",!1)))(function(a){return a.messages.orderBy("messageDeleteTs").first().then(function(a){return a==null?void 0:a.messageDeleteTs})});g.getNextDeletionTs=a}),98);
__d("MAWGetNextExpirationTsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextExpirationTs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.messages.orderBy("messageExpirationTs").filter(function(a){return a.messageExpirationTs!=null?a.messageExpirationTs>b:!1}).first().then(function(a){return a==null?void 0:a.messageExpirationTs})});g.getNextExpirationTs=a}),98);
__d("MAWGetSyncResponseBackoffInfoByJidApi",["MAWDbContactsTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getSyncResponseBackoffInfoByJid",!1)))(function(a,b){return d("MAWDbContactsTxns").getContact(a,b).then(function(a){return a==null?d("WAResultOrError").makeError("missing_contact"):d("WAResultOrError").makeResult(a.ephemeralSyncResponseBackoffInfo)})});g.getSyncResponseBackoffInfoByJid=a}),98);
__d("MAWRemoveExpiredMsgsFromUIApi",["MAWBridgeTypes","MAWBridgeXMA","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWGating","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWTransactionMode","MAWUpdateQuotedMsgTxns","MAWXMAUtils","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("removeExpiredMsgsFromUI",!1)))(function(a){return a.messages.where("messageExpirationTs").belowOrEqual(d("WATimeUtils").unixTime()).filter(function(a){return a.ephemeralMsgDisappeared!==!0}).toArray().then(function(b){if(b.length===0)return 0;var c=b.reduce(function(a,b){var c;c=(c=a.get(b.thread))!=null?c:new Set();c.add(b.msgId);a.set(b.thread,c);return a},new Map()),e=b.map(function(a){return babelHelpers["extends"]({},a,{ephemeralMsgDisappeared:!0})}),f=a.messages.bulkPut(e);b=b.map(function(b){return d("MAWUpdateQuotedMsgTxns").disassociateQuotedMsg(a,b.thread,b.externalId,b.author,d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL)});return d("MAWDexieTable").dexieAll([f,d("MAWEphemeralMsgTxns").updateThreadsOnMessagesExpiredFromUi(a,c)].concat(b)).then(function(){var b=[];e.forEach(function(c){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypes").createBridgeDeleteMessages(c.thread,[c])});if(d("MAWDbMsg").isMediaMsg(c)){var e=c.mediaId;e!=null&&d("MAWIndexedDb").afterTransaction({tag:"MediaExpired",value:d("MAWBridgeTypes").createBridgeMediaExpired(c,e)})}d("MAWXMAUtils").isXMAShare(c.xmaMessageType)&&d("MAWGating").isXMAFeedPostShareEnabled()&&b.push(d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.externalId)).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"XMAShareExpired",value:d("MAWBridgeXMA").createBridgeXMAShareExpired(c,a.xmaId)})}))});return d("MAWDexieTable").dexieAll(b).then(function(a){return e.length})})})});g.removeExpiredMsgsFromUI=a}),98);
__d("MAWCreateGroupApi",["MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WADualSendMsgUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("createGroup",!1)))(function(a,b,c,e,f,g,h){return d("MAWGroupManagementTxns").createGroupInternal(a,{deduplicationKey:g!=null?g:void 0,extras:h,folder:f,groupStatus:c,groupToCreate:b,serverTs:e})});b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("createGroups",!1)))(function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWGroupManagementTxns").createGroupInternal(a,{extras:d("WADualSendMsgUtils").isDualSendJid(b.jid)?{isDualSend:!0,platform:"msgr"}:null,groupStatus:"queried",groupToCreate:b,serverTs:d("WATimeUtils").unixTime()})})).then(function(){})});g.createGroup=a;g.createGroups=b}),98);
__d("MAWGetGroupInviteApi",["MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbThreadTxns","MAWIndexedDb","MAWLowLevelApiTypes","MAWTransactionMode","WAJids","WALogger","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite returned an expired group invite from ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite did not find the group invite from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite failed to interpret "," as a group jid"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite failed to get the thread ",""]);k=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY})(function(a,b,c,e){return d("MAWDbThreadTxns").getThread(a,b).then(function(f){var g;if(!f.success){d("WALogger").DEV(k(),b);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.MISSING_GROUP)}var l=d("WAJids").interpretAsGroupJid((g=f.value)==null?void 0:g.jid);if(l==null){d("WALogger").DEV(j(),(g=f.value)==null?void 0:g.jid);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.MISSING_GROUP)}f=d("MAWDbParticipant").craftParticipantId(b,e);return d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,c,f).then(function(a){if(a==null){d("WALogger").DEV(i(),c);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.MISSING_GROUP_INVITE)}if(!d("WATimeUtils").isInFuture(a.inviteExpirationTs)){d("WALogger").DEV(h(),c);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.EXPIRED_GROUP_INVITE)}return d("WAResultOrError").makeResult({groupInvite:a,groupJid:l})})})});g.getGroupInvite=a}),98);
__d("MAWGetSenderKeyStatusApi",["MAWDbPersonalSenderKeyStatusTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WADualSendMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getSenderKeyStatus",!1)))(function(a,b){var c=d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b;return a.personalSenderKeyStatuses.get(c).then(function(b){b!=null?b=d("MAWDexieTable").dexieResolve(b):b=d("MAWDbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus(a,c);return b.then(function(a){var b=a.hasSenderKey,c=a.rotateSenderKey,d=a.senderKeyId;a=a.senderKeyTs;return{hasSenderKey:b,rotateSenderKey:c,senderKeyId:d,ts:a}})})});g.getSenderKeyStatus=a}),98);
__d("MAWLeaveGroupsApi",["MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbPersonalSenderKeyStatusTxns","MAWDbThreadTxns","MAWDexieTable","MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{groupInfo:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("leaveGroups",!1)))(a);function a(a,b){var c=b.groupJids;return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(b){b=b.filter(Boolean);b=b.map(function(a){return a.threadId});var e=d("MAWGlobals").getMyUserJid();return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").bulkDeleteParticipantAcrossThreads(a,b,e),d("MAWDbThreadTxns").archiveThreads(a,b,!0),d("MAWDbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,c)]).then(function(){})})}g.leaveGroups=b;g.leaveGroupsTxn=a}),98);
__d("MAWLoadSenderKeySessionApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WAByteArray","WACryptoManager","WADualSendMsgUtils","WAJids","WAResultOrError","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{senderKeySessions:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadSenderKeySession",!1)))(function(a,b,c){b=d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b;var e=d("WAJids").extractUserJid(c);c=d("WAJids").extractDeviceId(c);b=d("SignalDbTypes").buildSenderKeySessionId(b,e,c);return a.senderKeySessions.get({id:b}).then(function(a){if(a==null)return d("WAResultOrError").makeError("errLoadSenderKeySession");var b=d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(a.record));a=d("WACryptoManager").decodeSenderKeySession(a.record);return d("WAResultOrError").makeResult({hash:b,session:a})})});function h(a){a=d("WACryptoManager").decodeSenderKey(a);var b=a.deviceId;a=a.groupId;a=d("WADualSendMsgUtils").isDualSendJid(a)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(a):a;var c=d("WAJids").extractUserJid(b);b=d("WAJids").extractDeviceId(b);return d("SignalDbTypes").buildSenderKeySessionId(a,c,b)}b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{senderKeySessions:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadSenderKeySessions",!1)))(function(a,b){b=b.map(h);return a.senderKeySessions.bulkGet(b).then(function(a){var b=new Map();for(var a=a,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(f==null)continue;var g=d("WASignalOther").castToSessionHash(d("WAByteArray").uint8ArrayToBuffer(f.record)),h=d("WACryptoManager").decodeSenderKeySession(f.record);b.set(d("WACryptoManager").encodeSenderKey(f.groupJid,d("WAJids").toDeviceJid(f.userJid,f.deviceId)),{hash:g,session:h})}return b})});g.loadSenderKeySession=a;g.toSenderKeySessionId=h;g.bulkLoadSenderKeySessions=b}),98);
__d("MAWMarkParticipantNeedsKeyApi",["MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbPersonalSenderKeyStatusTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{groupInfo:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markParticipantNeedsKey",!1)))(function(a,b,c){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(e){if(!e.success)return d("WAResultOrError").makeError("missing");e=e.value;return d("MAWDbParticipantTxns").getParticipant(a,e.threadId,d("WAJids").extractUserJid(c)).then(function(e){return!e.success?d("WAResultOrError").makeError("missing"):d("MAWDbPersonalSenderKeyStatusTxns").removeDevicesToMultiplePersonalSenderKeyStatuses(a,[b],[c]).then(function(){return d("WAResultOrError").makeResult()})})})});g.markParticipantNeedsKey=a}),98);
__d("MAWMarkSenderKeyAsRotatedApi",["MAWDbGroupInfoTxns","MAWDbPersonalSenderKeyStatusTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWRecipientDevicesTxns","MAWTransactionMode","WADualSendMsgUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markSEnderKeyAsRotated",!1)))(function(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return d("WAResultOrError").makeError("missing");b=b.value;return d("MAWRecipientDevicesTxns").getRecipientDevicesByThread(a,b.threadId)}).then(function(f){return!f.success?d("WAResultOrError").makeError("missing_devices"):d("MAWDbPersonalSenderKeyStatusTxns").updateSenderKeyStatusAsRotated(a,d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b,c,e).then(function(a){return d("WAResultOrError").makeResult({needsSenderKey:new Set(f.value)})})})});g.markSenderKeyAsRotated=a}),98);
__d("MAWMarkSenderKeyAsSentApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markSenderKeyAsSent",!1)))(function(a,b,c,d){return a.personalSenderKeyStatuses.get(b).then(function(b){if(b==null)return;if(b.senderKeyId!=c)return;d.forEach(function(a){b.hasSenderKey.add(a)});return a.personalSenderKeyStatuses.put(b).then(function(){})})});g.markSenderKeyAsSent=a}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWDbParticipant","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE})(function(a,b,c){var e=d("MAWDbParticipant").craftParticipantId(b,c);return d("MAWDbGroupInviteTxns").deleteGroupInvitesByInvitedParticipantId(a,e).then(function(a){d("WALogger").DEV(h(),a,b,c)})});g.removeGroupInvites=a}),98);
__d("MAWSaveSenderKeySessionApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WACryptoManager","WADualSendMsgUtils","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{senderKeySessions:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveSenderKeySession",!1)))(function(a,b,c,e){b=d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b;var f=d("WAJids").extractUserJid(c);c=d("WAJids").extractDeviceId(c);var g=d("SignalDbTypes").buildSenderKeySessionId(b,f,c);c={deviceId:c,groupJid:b,id:g,record:d("WACryptoManager").encodeSenderKeySession(e),userJid:f};return a.senderKeySessions.put(c).then(function(){})});g.saveSenderKeySession=a}),98);
__d("MAWSaveSenderKeySessionIfMatchesApi",["MAWDbSenderKeySessionTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WACryptoManager","WADualSendMsgUtils","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{senderKeySessions:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveSenderKeySessionIfMatches",!1)))(function(a,b,c,e,f){var g=d("WADualSendMsgUtils").isDualSendJid(b)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(b):b,h=d("WAJids").extractUserJid(c),i=d("WAJids").extractDeviceId(c),j=d("SignalDbTypes").buildSenderKeySessionId(g,h,i);return d("MAWDbSenderKeySessionTxns").bulkCheckSenderKeySessionsMatch(a,[{id:j,oldHash:e}]).then(function(b){return!b.success?b:d("MAWDbSenderKeySessionTxns").bulkPutSenderKeySessions(a,[{deviceId:i,groupJid:g,id:j,record:d("WACryptoManager").encodeSenderKeySession(f),userJid:h}]).then(function(){return d("WAResultOrError").makeResult()})})});g.saveSenderKeySessionIfMatches=a}),98);
__d("MAWWriteGroupInviteApi",["MAWDbParticipant","MAWIndexedDb","MAWLLAMigrationUtils","MAWLowLevelApiTypes","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteGroupInviteTxns","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READWRITE,groupInvites:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("leaveGroups",!1)))(function(a,b,c){return d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b).then(function(e){if(e==null||e.groupInfo==null)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP);var f=d("MAWDbParticipant").craftParticipantId(e.thread.chatId,c.invitedParticipantUserJid);f={inviteCode:c.inviteCode,invitedParticipantId:f,inviteExpirationTs:c.expiration,inviterJid:c.inviterUserJid};return d("MAWWriteGroupInviteTxns").writeGroupInvite(a,f,b).then(function(a){if(a===d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP);else if(a===d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE);return d("WAResultOrError").makeResult((a=e.groupInfo)==null?void 0:a.name)})})});g.writeGroupInvite=a}),98);
__d("MAWConvertCreateGroupResultApi",["MAWDbGroupInfoTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{groupInfo:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("convertCreateGroupResult",!1)))(function(a,b){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b.jid).then(function(b){if(!b.success)throw c("err")("Tried to convert a createGroup result for a group that has not persisted in the DB");return a.threads.get(b.value.threadId).then(function(a){if(a==null)throw c("err")("Tried to convert a createGroup result for a group but its thread is not in DB");return{chatJid:a.jid,type:"msgr"}})})});g.convertCreateGroupResult=a}),98);
__d("MAWJobPersistenceAccessorsApi",["MAWJobActionsV2","MAWSignalIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWSignalIndexedDb").makeSignalMsgrTransactor(d("MAWTransactionMode").READWRITE),b=d("MAWSignalIndexedDb").makeSignalMsgrTransactor(d("MAWTransactionMode").READONLY);return{deletePersistedJob:a(d("MAWJobActionsV2").deletePersistedJob),loadAllJobs:b(d("MAWJobActionsV2").readAllPersistedJobs),maybeCreateJob:a(d("MAWJobActionsV2").maybeCreateJob),readPersistedJob:b(d("MAWJobActionsV2").readPersistedJob),updatePersistedJob:a(d("MAWJobActionsV2").updatePersistedJob)}}g.getJobPersistenceAccessors=a}),98);
__d("MAWLoadAllJobsApi",["MAWJobActionsV2","MAWSignalIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWSignalIndexedDb").makeSignalMsgrTransactor(d("MAWTransactionMode").READONLY)(d("MAWJobActionsV2").readAllPersistedJobs);g.loadAllJobs=a}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAMediaUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""]);h=function(){return a};return a}a=function(a){var c,e,f,g,i,j,k,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:e=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(!(e==null)){p.next=3;break}return p.abrupt("return",null);case 3:f=e.previewPlaintextHash;if(!(f==null)){p.next=6;break}return p.abrupt("return",null);case 6:g=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(f);if(!(g==null)){p.next=9;break}return p.abrupt("return",null);case 9:p.prev=9;p.next=12;return b("regeneratorRuntime").awrap(g.optimisticUploadPromise);case 12:p.next=18;break;case 14:p.prev=14;p.t0=p["catch"](9);d("WALogger").ERROR(h(),p.t0);return p.abrupt("return",null);case 18:i=(c=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(f))==null?void 0:c.mediaEntry;if(!(i==null)){p.next=21;break}return p.abrupt("return",null);case 21:j=d("WAMediaUtils").decodeMediaEntryData(i);k=j.directPath,l=j.fileEncSha256,m=j.fileSha256,n=j.mediaKey,o=j.mediaKeyTimestamp;return p.abrupt("return",{directPath:k,fileEncSha256:l,fileSha256:m,mediaKey:n,mediaKeyTimestamp:o});case 24:case"end":return p.stop()}},null,this,[[9,14]])};g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetDualSendMediaByFileTypeApi",["MAWDbDualSendTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received invalid id for fetting dual send media file"]);h=function(){return a};return a}a=function(a){if(a==null){d("WALogger").ERROR(h());return b("Promise").resolve()}else return d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{dualSendMedia:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getDualSendMediaByFileType",!1)))(function(b){return d("MAWDbDualSendTxns").getDualSendMediaRowByFileType(b,a).then(function(a){return a==null?void 0:a.file})})()};g.getDualSendMediaByFileType=a}),98);
__d("MAWGetMediaIfAuthorizedApi",["MAWDbIdentityTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: Msg "," mediaEntry no longer exists"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: no media for msg "," with mediaId ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: given device "," was not among the original recipients for this message ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: no receipt for msg ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: no media for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: do not find msg sent by sender with chatJid ",", externalId ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaMsgIfAuthorized: rejecting request for removed device ",""]);n=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMediaIfAuthorized",!1)))(function(a,b,c,e){var f=d("WAJids").extractUserJid(e);return d("MAWDexieTable").dexieAll([d("MAWDbIdentityTxns").getIdentitiesForUser(a,f),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,{author:d("WAJids").AUTHOR_ME,chat:b,externalId:c})]).then(function(f){var g=f[0],o=f[1];f=new Set(g.map(function(a){return a.deviceJid}));if(!f.has(e)){d("WALogger").WARN(n(),e);return d("WAResultOrError").makeError("error-unknown-device")}if(o==null){d("WALogger").WARN(m(),b,c);return d("WAResultOrError").makeError("message-not-found")}if(o.mediaId==null){d("WALogger").WARN(l(),o.msgId);return d("WAResultOrError").makeError("media-not-found")}return d("MAWDexieTable").dexieAll([a.receipts.get({msgId:o.msgId}),d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,o.mediaId)]).then(function(a){var b=a[0];a=a[1];if(b==null){d("WALogger").WARN(k(),o.msgId);return d("WAResultOrError").makeError("message-not-found")}if(!b.recipientDevices.has(e)){d("WALogger").WARN(j(),e,o.msgId);return d("WAResultOrError").makeError("error-unknown-device")}if(a==null){d("WALogger").WARN(i(),o.msgId,o.mediaId);return d("WAResultOrError").makeError("media-not-found")}b=a.mediaEntries;var f=a.plaintextHash;a=a.size;b=b.get(o.msgId);if(b==null){d("WALogger").LOG(h(),c);return d("WAResultOrError").makeError("media-not-found")}return d("WAResultOrError").makeResult({mediaEntryData:b,plaintextHash:f,size:a})})})});g.getMediaIfAuthorized=a}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaUtils","MAWTransactionMode","WAJids","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMediaKnownEntries",!1)))(function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return d("MAWDbMediaTxns").maybeGetMediaFromHash(a,b).then(function(b){return!b?new(d("WAMsgMap").MsgMap)():d("MAWDexieTable").dexieAll(Array.from(b.mediaEntries.keys()).map(function(b){return a.messages.get({msgId:b})})).then(function(a){return a.reduce(function(a,c){if(!c)return a;var e=b.mediaEntries.get(c.msgId),f=c.author,g=c.threadJid;e&&!d("WAJids").isAuthorSystem(f)&&g!=null&&a.set({author:f,chat:g,externalId:c.externalId},e);return a},new(d("WAMsgMap").MsgMap)())})})});g.getMediaKnownEntries=a}),98);
__d("MAWGetMediaPlaintextApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);h=function(){return a};return a}a=function(a){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=c.get(a);if(c==null)return i(a);else return b("Promise").resolve(c.file)};function i(a){return d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMediaPlaintextFromDb",!1)))(function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.where("hashedPlaintextHash").equals(b).first().then(function(a){if(!a){d("WALogger").ERROR(h());return null}return new Blob([a.blobData],{type:a.mimetype})})})(a)}g.getMediaPlaintext=a}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["MAWGlobals","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,e,f,g){var h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:h=d("MAWOptimisticUploadManager").getOptimisticUploadManager();i=h.get(a);j=i==null?void 0:i.msgId;k=e();if(!j){m.next=13;break}m.next=7;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getProtocolMsgIdByMsgId(j));case 7:l=m.sent;if(!l){m.next=11;break}m.next=11;return b("regeneratorRuntime").awrap(d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,l,e,f,g));case 11:m.next=16;break;case 13:if(i){m.next=15;break}throw c("err")("Cannot update mediaEntry without both uploadEntry and msgId");case 15:h.set(a,babelHelpers["extends"]({},i,{mediaEntry:k}));case 16:return m.abrupt("return");case 17:case"end":return m.stop()}},null,this)};g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(function(a,b,e,f){return!c("gkx")("8498")||!c("gkx")("3827")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDbMsgTxns").maybeGetMsg(a,c.newestMsg).then(function(a){var b,g=d("MAWDbMsg").craftDebugMsgId(c.chatId,c.nextInChatMsgId-1);b=d("WATimeUtils").castToMillisTime(((a=(b=(b=f)!=null?b:a==null?void 0:a.sortOrderMs)!=null?b:c.newestMsgTs)!=null?a:0)+1);a=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[DEBUG]: "+e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.chatId,c.jid,g);a.sortOrderMs=b;d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})});g.writeDebugMsg=a}),98);
__d("MAWGetLastMsgsInChatForSpamReportApi",["MAWDbMediaTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getLastMsgsInChatForSpamReport",!1)))(function(a,b,e){return e===0?d("MAWDexieTable").dexieResolve([]):a.threads.get({jid:b}).then(function(b){if(b==null)throw c("err")("Missing thread");b=b.chatId;var f=a.unrenderedMessages.where("thread").equals(b).filter(function(a){return a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME}).reverse().limit(e).toArray().then(function(a){var b=[];a.forEach(function(a){a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME&&b.push(a)});return b});return a.messages.where("thread").equals(b).filter(function(a){return d("MAWDbMsg").isContentMsg(a)}).reverse().limit(e).toArray().then(function(a){return f.then(function(b){return b.concat(a)})}).then(function(a){return a.sort(function(a,b){return a.msgId<b.msgId?-1:a.msgId>b.msgId?1:0}).slice(0,e)}).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,b).then(function(a){return{mediaInfo:a.success?a.value:null,msg:b}})}))})})});g.getLastMsgsInChatForSpamReport=a}),98);
__d("MAWGetMsgForRetryApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbIdentityTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipant","MAWDbReaction","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaTypeAttribute","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAMsgType","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);h=function(){return a};return a}var i=30*24*60*60,j=new Set([d("MAWAckLevel").ACK.failed,d("MAWAckLevel").ACK.expired,d("MAWAckLevel").ACK.contentGone,d("MAWAckLevel").ACK.contentTooBig,d("MAWAckLevel").ACK.contentUnuploadable]);a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{groupInvites:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgForRetry",!1)))(function(a,b,c){return n(a,b,c).then(function(d){var e=d[0],f=d[1],g=d[2];d=d[3];return o(a,b,c,e,f,g,d)}).then(function(a){if(!a.success)return{type:a.error};a=a.value;if(a.type==="message")return k(a);else{a.type;return l(a)}})});b=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{groupInvites:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgsForRetry",!1)))(function(a,b){return m(a,b).then(function(c){var e=c[0],f=c[1],g=c[2],h=c[3];return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.deviceJid;b=b.protocolMsgId;var d=b,i=e.get(d),j=f.get(d);d=g.get(d);var m=h.filter(function(a){a=a.deviceJid;return a===c});return o(a,b,c,i,j,d,m).then(function(a){if(!a.success)return{type:a.error};a=a.value;if(a.type==="message")return k(a);else{a.type;return l(a)}})}))})});function k(a){var b=a.deviceIdentity,e=a.groupInvite,f=a.media,g=a.msg,h=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(g.type)&&!d("MAWDbMsg").isContentMsg(g))throw c("err")("We do not support converting to protoMsg with "+g.type+" type");f=d("MAWAsMessageApplication").asMessageApplication(g,f,e,h);h=null;var i=d("MAWMediaTypeAttribute").getMediaType(g),j=g.type===d("WAMsgType").MSG_TYPE.REVOKED;i!=null?h={mediaType:i,type:"media"}:g.type===d("WAMsgType").MSG_TYPE.GROUP_INVITE&&e?h={invitedParticipantUserJid:d("MAWDbParticipant").getThreadIdAndUserJidFromParticipantId(e.invitedParticipantId).userJid,isRevoked:!1,type:"text"}:g.type===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION?h={isInvisible:!0,isRevoked:!1,type:"text"}:h={isRevoked:j,type:"text"};if(d("WAJids").isAuthorSystem(g.author))throw c("err")("We do not support sending system messages");return{deviceIdentity:b,messageApplication:f,messageType:h,protocolMsgId:{author:g.author,chat:a.chat,externalId:g.externalId},type:"unacked"}}function l(a){var b=a.deviceIdentity,e=a.reaction,f=d("MAWAsMessageApplication").asReactionMessageApplication(e);if(d("WAJids").isAuthorSystem(e.author))throw c("err")("We do not support sending system messages");return{deviceIdentity:b,messageApplication:f,messageType:{type:"reaction"},protocolMsgId:{author:e.author,chat:a.chat,externalId:e.externalId},type:"unacked"}}function m(a,b){var c=b.map(function(a){a=a.protocolMsgId;return a});b=b.map(function(a){a=a.deviceJid;return a});b=b.map(function(a){return d("WAJids").extractUserJid(a)});return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgMapByProtocolMsgId(a,c),d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgMapByProtocolMsgId(a,c),d("MAWDbReactionsTxns").getReactionMapByProtocolMsgId(a,c),d("MAWDbIdentityTxns").getIdentitiesForUsers(a,b)])}function n(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbIdentityTxns").getIdentitiesForUser(a,d("WAJids").extractUserJid(c))])}function o(a,b,e,f,g,i,j){var k=null,l=null,m=null,n=null,o=null,r=d("MAWDexieTable").dexieResolve(null),s=d("MAWXMAUtils").maybeXMAMessage(f),t=null,u=null,v=null;if(f!=null)g!=null&&d("WALogger").ERROR(h()),k=f.ack,l=f.ts,m=f.msgId,n=d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,f),o=f.thread,v=s?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):d("MAWDexieTable").dexieResolve(),t=d("MAWDbXMATxns").maybeGetDbXMAMsgByAssociatedMsgId(a,f.msgId),u=d("MAWDbXMATxns").maybeGetXMAPayloadFromAssociatedMsgId(a,f.msgId);else if(g!=null){if(g.type===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("unsupported"));k=g.ack;l=g.ts;m=g.msgId;n=d("WAResultOrError").makeResult();o=g.thread;r=d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,g)}else if(i!=null)k=i.ack,l=i.ts,m=d("MAWDbReaction").reactionIdToMsgId(i.reactionId),n=d("WAResultOrError").makeResult();else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));return p(k,l,j,e)?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("unauthorized")):d("MAWDexieTable").dexieAll([q(a,m,e),n,o?a.threads.get(o):null,r,v,t,u]).then(function(a){var b=a[0],e=a[1],h=a[2],j=a[3],k=a[4],l=a[5];a=a[6];if(!b.success)return b;else if(!e.success)return e;else if(k!=null&&!k.success)return d("WAResultOrError").makeError("missing");else if(a!=null&&!a.success)return d("WAResultOrError").makeError("missing");var m=f||g;if(l!=null&&h!=null&&a!=null&&(d("MAWXMAUtils").isXMAShare(l.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReply(l.xmaMessageType)))return d("WAResultOrError").makeResult({chat:h.jid,deviceIdentity:b.value,groupInvite:j,media:e.value,msg:l,type:"message",xmaPayload:a.value});else if(m!=null&&h!=null)return d("WAResultOrError").makeResult({chat:h.jid,deviceIdentity:b.value,groupInvite:j,media:e.value,msg:m,type:"message",xmaPayload:k!=null?k.value:null});else if(i!=null)return d("WAResultOrError").makeResult({chat:i.threadJid,deviceIdentity:b.value,reaction:i,type:"reaction"});else throw c("err")("unknown item for retry")})}function p(a,b,c,e){c=c.map(function(a){return a.deviceJid});return j.has(a)||!d("WATimeUtils").happenedWithin(b,i)||c.indexOf(e)<0}function q(a,b,c){return a.receipts.get(b).then(function(a){if(a==null)return d("WAResultOrError").makeError("unauthorized");a=a.permittedIdentitiesPerDevice;a=a==null?void 0:a.get(c);return a==null?d("WAResultOrError").makeError("unauthorized"):d("WAResultOrError").makeResult(a)})}g.getMsgForRetry=a;g.getMsgsForRetry=b}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaTypeAttribute","MAWMsgRecipientsTxns","MAWRecipientDevicesTxns","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAMsgType","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Entering"]);k=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInvites:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getMsgForSending",!1)))(function(a,b){return l(a,b).then(function(a){d("WALogger").LOG(k(),b);if(!a.success){d("WALogger").LOG(j(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.contactsSyncInfo,g=a.groupInvite,l=a.icdcInfo,m=a.isDeviceMismatch,n=a.isReplyMsg,o=a.media,p=a.msg,q=a.recipients,r=a.thread;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(p.type)&&!d("MAWDbMsg").isContentMsg(p)){d("WALogger").LOG(i(),b,p.type);throw c("err")("We do not support message sending with "+p.type+" type")}o=d("MAWAsMessageApplication").asMessageApplication(p,o,g,a);var s=null,t=d("MAWMediaTypeAttribute").getMediaType(p),u=p.type===d("WAMsgType").MSG_TYPE.REVOKED;t!=null?s={mediaType:t,type:"media"}:p.type===d("WAMsgType").MSG_TYPE.GROUP_INVITE&&g?s={invitedParticipantUserJid:d("MAWDbParticipant").getThreadIdAndUserJidFromParticipantId(g.invitedParticipantId).userJid,isRevoked:!1,type:"text"}:p.type===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION?s={isInvisible:!0,isRevoked:!1,type:"text"}:s={isRevoked:u,type:"text"};if(d("WAJids").isAuthorSystem(p.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(h(),b);return{contactsInThread:e,contactsSyncInfo:f,icdcInfo:l,isDeviceMismatch:m,isReplyMsg:n,isXMAMsg:a!=null,messageApplication:o,messageType:s,protocolMsgId:{author:p.author,chat:r.jid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:p.externalId},recipients:q,type:"unsent"}})});function l(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=e||c;if(f==null)return d("WAResultOrError").makeError("missing");else if(f.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var g;f.type===d("WAMsgType").MSG_TYPE.REVOKED?g=d("MAWMsgRecipientsTxns").getRevokedMsgRecipients(a,f.msgId):g=d("MAWMsgRecipientsTxns").getMsgRecipients(a,f.msgId);var h=d("MAWXMAUtils").maybeXMAMessage(e),i=f.quote!=null;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,f.thread),e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c):d("MAWDexieTable").dexieResolve(),g,d("MAWRecipientDevicesTxns").getICDCInfoForUsersInThread(a,f.thread),h?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,f.thread).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2],g=a[3],h=a[4],j=a[5];a=a[6];if(!c.success)return c;if(!b.success||!h.success)return d("WAResultOrError").makeError("missing");if(j!=null&&!j.success)return d("WAResultOrError").makeError("missing");c=c.value;b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,contactsSyncInfo:h.value.contactsSyncInfo,groupInvite:e,icdcInfo:h.value.icdcInfoList,isDeviceMismatch:g.isDeviceMismatch,isReplyMsg:i,media:c,msg:f,recipients:g.recipients,thread:b,xmaPayload:j!=null?j.value:null})})})}g.getMsgForSending=a}),98);
__d("MAWGetNextDeleteDFMContentTs",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{unrenderedMessages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextDeleteDFMContentTs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.unrenderedMessages.orderBy("messageDeleteForMeTs").filter(function(a){return(a==null?void 0:a.messageDeleteForMeTs)!=null?a.messageDeleteForMeTs>=b:!1}).first().then(function(a){return a==null?void 0:a.messageDeleteForMeTs})});g.getNextDeleteDFMContentTs=a}),98);
__d("MAWGetNextDeletePendingStanzaTs",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{pendingStanzas:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextDeletePendingStanzaTs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.pendingStanzas.orderBy("deleteTs").filter(function(a){return a.deleteTs!=null?a.deleteTs>b:!1}).first().then(function(a){return a==null?void 0:a.deleteTs})});g.getNextDeletePendingStanzaTs=a}),98);
__d("MAWGetNextDeleteUnsendContentTs",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextDeleteUnsendContentTs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.messages.orderBy("unsendMsgContentDeleteTs").filter(function(a){return(a==null?void 0:a.unsendMsgContentDeleteTs)!=null?a.unsendMsgContentDeleteTs>=b:!1}).first().then(function(a){return a==null?void 0:a.unsendMsgContentDeleteTs})});g.getNextDeleteUnsendContentTs=a}),98);
__d("MAWGetNextExpiredXMATs",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getNextDeleteUnsendContentTs",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.xma.orderBy("targetExpiringAtSec").filter(function(a){return(a==null?void 0:a.targetExpiringAtSec)!=null?a.targetExpiringAtSec>=b:!1}).first().then(function(a){return a==null?void 0:a.targetExpiringAtSec})});g.getNextExpiredXMATs=a}),98);
__d("MAWGetProtocolMsgIdByMediaMsgId",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getProtocolMsgIdByMediaMsgId",!1)))(function(a,b){return a.messages.get({msgId:b}).then(function(b){return b==null?null:a.threads.get(b.thread).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(b.author)?null:{author:b.author,chat:a.jid,externalId:b.externalId}})})});g.getProtocolMsgIdByMediaMsgId=a}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getProtocolMsgByMsgId",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get(f.thread).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})});g.getProtocolMsgIdByMsgId=a}),98);
__d("MAWHandleConnectedAdminMsgApi",["MAWAdminWriteUsersConnectedMsgTxn","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleConnectedAdminMsg: chat ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("handleConnectedAdminMsg",!1)))(function(a,b){d("WALogger").LOG(h(),b);return d("MAWAdminWriteUsersConnectedMsgTxn").writeUsersConnectedAdminMsg(a,b)});g.handleConnectedAdminMsg=a}),98);
__d("MAWHandleReachabilityErrorAdminMsgApi",["MAWAdminMsgBuildTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleReachabilityErrorAdminMsg: chat ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("handleReachabilityErrorAdminMsg",!1)))(function(a,b){d("WALogger").DEV(h(),b);return d("MAWAdminMsgBuildTxns").writeReachabilityErrorAdminMsg(a,b).then(function(){})});g.handleReachabilityErrorAdminMsg=a}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markMsgDropped",!1)))(function(a,b){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?"missing":d("MAWDbMsgTxns").updateSystemAck(a,b.msgId,d("MAWAckLevel").ACK.expired).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})})});g.markMsgDropped=a}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType.bs","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent.bs","MAWBridgeTypes","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WADualSendMsgUtils","WALogger","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);j=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("markMsgSent",!1)))(function(a,b,c,e,f){e!=null;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(e){var g=e[0],k=e[1];if(g==null&&k==null){d("WALogger").LOG(j());return}else if(g!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([g.externalId],d("MAWBridgeTraceEvent.bs").receivedSent,d("ArmadilloDataTraceType.bs").armadilloMessageSend)});k!=null&&d("WALogger").ERROR(i());var l=g.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,g.msgId,d("MAWAckLevel").ACK.sent,c,f),d("MAWDbThreadTxns").getThread(a,g.thread)]).then(function(b){var e=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(h());return}var f=b.value,i=d("WATimeUtils").castUnixTimeToMillisTime(c);b=babelHelpers["extends"]({},f,{lastReadMsgTs:i,newestMsgTs:i,threadOrder:d("MAWDbThread").craftThreadOrder(i,f.jid)});b=l?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").maybeUpdateEphemeralMessageWhenMarkedSent(a,e,c),b]).then(function(){g.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&g.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&l&&d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:d("MAWBridgeTypes").createBridgeBumpedThreadServer(f.chatId,d("WADualSendMsgUtils").isDualSendJid(f.jid),i,!0)})})})}else if(k!=null)return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,k.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(k.type===d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,c)})}).then(function(){})});g.markMsgSent=a}),98);
__d("MAWProcessSpamMsgApi",["ArmadilloDataTraceType.bs","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypes","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWThreadSnippetBuildTxns","MAWTransactionMode","WADualSendMsgUtils","WALogger","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processSpamMsgs: "," for thread ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processSpamMsgs thread for "," no longer exists"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("processSpamMsgs",!1)))(function(a){return d("MAWDbMsgTxns").getSpamMsgs(a).then(function(b){d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.thread;return d("MAWDbThreadTxns").getThread(a,c).then(function(e){if(!e.success){d("WALogger").WARN(i(),c);return[]}e=e.value;d("WALogger").DEV(h(),b.rowId,e.chatId);b.type===d("WAMsgType").MSG_TYPE.FUTUREPROOF?b.altIndex=d("MAWDbMsg").FUTUREPROOF_ALT_INDEX:b.altIndex=d("MAWDbMsg").UNDEFINED_ALT_INDEX;return d("MAWDexieTable").dexieAll([a.messages.put(b),d("MAWDexieTable").dexieResolve(e),d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b,e)])}).then(function(a){a[0];var e=a[1];a=a[2];if(!e)return;var f=e.jid,g=e.lastReadMsgTs,h=e.newestMsgTs;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(b,f,d("ArmadilloDataTraceType.bs").armadilloMessageSend)});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b)});d("MAWIndexedDb").afterTransaction({tag:"ThreadBumped",value:d("MAWBridgeTypes").createBridgeBumpedThread(c,d("WADualSendMsgUtils").isDualSendJid(e.jid),h||d("WATimeUtils").castUnixTimeToMillisTime(b.ts),g,a.snippetType,a.snippetParams,a.snippetSenderContactId)});e.oldestMsg==null&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypes").createBridgeMsgsLoadedInfo(c,[b],!0,!1,d("WADualSendMsgUtils").isDualSendJid(e.jid))})})}))})});g.processSpamMsgs=a}),98);
__d("MAWRemoveExpiredDFMMsgsContent",["MAWDeleteExpiredMsgsApi","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWTransactionMode","MAWXMAUtils","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("removeExpiredDFMMsgsContent",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.unrenderedMessages.where("messageDeleteForMeTs").belowOrEqual(b).toArray().then(function(b){var c=b.map(function(a){if(a.mediaId!=null)return[a.mediaId,a.msgId]}).filter(Boolean),e=b.map(function(a){if(a.type===d("WAMsgType").MSG_TYPE.DELETE_FOR_ME)return babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,quote:void 0,xmaMessageType:void 0})}).filter(Boolean),f=b.map(function(a){if(d("MAWXMAUtils").isXMAShare(a.xmaMessageType)&&a.externalId!=null){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId);if(b!=null)return[b,a.msgId]}else if(a.quote!=null&&d("MAWXMAUtils").isXMAStoryReply(a.quote.content.xmaMessageType)){b=d("MAWJidUtils").maybeToProtocolMsgId(a.quote.content.author,a.threadJid,a.quote.content.externalId);if(b!=null)return[b,a.msgId]}}).filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWDeleteExpiredMsgsApi").deleteOrUpdateXMAForExpiredMsgs(a,f),d("MAWDeleteExpiredMsgsApi").deleteOrUpdateMediaAndChunkForExpiredMsgs(a,c),a.unrenderedMessages.bulkPut(e)]).then(function(){return d("MAWDexieTable").dexieResolve(b.length)})})});g.removeExpiredDFMMsgsContent=a}),98);
__d("MAWRemoveExpiredPendingStanzas",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{pendingStanzas:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("removeExpiredPendingStanzas",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.pendingStanzas.where("deleteTs").belowOrEqual(b).toArray().then(function(b){var c=b.map(function(a){return a.rowId});return a.pendingStanzas.bulkDelete(c).then(function(){return c.length})})});g.removeExpiredPendingStanzas=a}),98);
__d("MAWRemoveExpiredUnsendMsgsContent",["MAWDeleteExpiredMsgsApi","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLLAMigrationUtils","MAWTransactionMode","MAWXMAUtils","WAArmadilloXMA.pb","WAMsgType","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("removeExpiredUnsendMsgsContent",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.messages.where("unsendMsgContentDeleteTs").belowOrEqual(b).toArray().then(function(b){var c=b.map(function(a){if(a.mediaId!=null)return[a.mediaId,a.msgId]}).filter(Boolean),e=b.map(function(a){if(a.type===d("WAMsgType").MSG_TYPE.REVOKED)return babelHelpers["extends"]({},a,{mediaId:void 0,msgContent:void 0,quote:void 0,xmaMessageType:void 0})}).filter(Boolean),f=b.map(function(a){if(d("MAWXMAUtils").isXMAShare(a.xmaMessageType)&&a.revokedExternalId!=null){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.revokedExternalId);if(b!=null)return[b,a.msgId]}else if(a.quote!=null&&a.quote.content.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY){b=d("MAWJidUtils").maybeToProtocolMsgId(a.quote.content.author,a.threadJid,a.quote.content.externalId);if(b!=null)return[b,a.msgId]}}).filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWDeleteExpiredMsgsApi").deleteOrUpdateXMAForExpiredMsgs(a,f),d("MAWDeleteExpiredMsgsApi").deleteOrUpdateMediaAndChunkForExpiredMsgs(a,c),a.messages.bulkPut(e)]).then(function(){return d("MAWDexieTable").dexieResolve(b.length)})})});g.removeExpiredUnsendMsgsContent=a}),98);
__d("MAWRemoveExpiredXMAMsgsContentApi",["MAWBridgeMsg","MAWBridgeXMA","MAWDbMsgTxns","MAWDeleteExpiredMsgsApi","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","MAWXMAExpirationTxns","MAWXMAUtils","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMAId is null when handling tombstone, something went wrong"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to expire an non-story share XMA in XMA Cleaner"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("removeExpiredXMAMsgsContent",!1)))(function(a){var b=d("WATimeUtils").unixTime();return a.xma.where("targetExpiringAtSec").belowOrEqual(b).filter(function(a){return a.isTombstoned!=null&&!a.isTombstoned||a.isTombstoned==null}).toArray().then(function(b){var c=[],e=new Map(),f=[],g=[],h=[];b.forEach(function(a){d("MAWXMAUtils").isXMAShare(a.targetType)&&!d("MAWXMAUtils").isXMAStoryShare(a.targetType)&&d("WALogger").ERROR(i());var b=a.msgId;if(b==null)return;d("MAWXMAUtils").isXMAStoryShare(a.targetType)&&(e.set(b,a.xmaId),f.push({author:a.author,chat:a.threadJid,externalId:a.externalId}));d("MAWXMAUtils").isXMAStoryReply(a.targetType)&&(g.push(b),a.associatedMessageId!=null&&h.push(a.associatedMessageId));var j=a.previewMediaIds;j!=null&&j.forEach(function(a){c.push([a,b])});a.faviconMediaId!=null&&c.push([a.faviconMediaId,b]);a.headerMediaId!=null&&c.push([a.headerMediaId,b])});var l=b.map(function(a){return d("MAWXMAUtils").buildTombstonedDbXMA(a)}),m=Array.from(e.keys());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").bulkUpdateDbMsgXMAExpired(a,[].concat(m,g)),d("MAWXMAExpirationTxns").getXMAShareReplyMsgsToUpdate(a,f),d("MAWXMAExpirationTxns").updateExpiredStoryReplyMsg(a,h),d("MAWDeleteExpiredMsgsApi").deleteOrUpdateMediaAndChunkForExpiredMsgs(a,c),a.xma.bulkPut(l)]).then(function(a){var c=a[0],f=a[1];a=a[2];j(c,e,f);k(a);return d("MAWDexieTable").dexieResolve(b.length)})})});function j(a,b,c){a.forEach(function(a){if(!d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType))return;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)});var c=b.get(a.msgId);if(c==null){d("WALogger").ERROR(h());return}d("MAWIndexedDb").afterTransaction({tag:"XMAShareTombstoned",value:d("MAWBridgeXMA").createBridgeXMAShareTombstoned(a,c)})}),c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a,void 0,void 0)})})}function k(a){a.map(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})}g.removeExpiredXMAMsgsContent=a}),98);
__d("MAWWriteLocalXMAMsgApi",["MAWAckLevel","MAWAuthor","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWGating","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WAMsgType","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READONLY,contacts:d("MAWTransactionMode").READONLY,groupInfo:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("writeLocalXMAMsg",!1)))(function(a,b,c,e,f,g){f.content!=null&&(f.content=d("MAWVault").vault(f.content));return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),h(a,f.quote,c)]).then(function(c){var h=c[0],j=c[1];c=c[2];if(h==null)return{type:"missing_thread"};j=j.find(function(a){return a.thread===h.chatId&&a.author===g});if(j!=null)return{protocolMsgId:{author:g,chat:h.jid,externalId:j.externalId},type:"already_sent"};else{j=d("MAWDbMsg").craftMsgId(h.chatId,h.nextInChatMsgId);j={ack:d("MAWAckLevel").ACK.clock,altIndex:d("MAWDbMsg").UNDEFINED_ALT_INDEX,author:g,ephemeralSetting:d("MAWGating").isEphemeralMessagesEnabled()?f.ephemeralSetting:void 0,externalId:b,isForwarded:f.isForwarded,msgId:j,specialTextSize:f.specialTextSize,thread:h.chatId,threadJid:h.jid,ts:e};j=i(j,f,c);c=f.isFirstMsg;var k=f.openMessageOtid,l=f.openMessageParticipantCount,m=f.optimisticMsg,n=f.participantCount;return d("MAWWriteMsgTxns").writeMsg(a,j,h,{isCiphertextUpdateForXMAMessageWithAssociatedMsg:!1,isCurrentDeviceSendingMsg:!0,isFirstMsg:c,isOutgoing:!0,openMessageOtid:k,openMessageParticipantCount:l,optimisticMsg:m,participantCount:n}).then(function(){return{protocolMsgId:{author:g,chat:h.jid,externalId:b},type:"sent"}})}})});function h(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get(b.thread).then(function(a){var e=b?j(b):null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&e!=null&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function i(a,b,e){var f,g;if(b.quote!=null&&(e==null?void 0:e.content)!=null){var h;g=e==null?void 0:(h=e.content)==null?void 0:h.externalId;f={content:e==null?void 0:e.content,remoteJid:(h=e==null?void 0:e.remoteJid)!=null?h:void 0}}if(b.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");return babelHelpers["extends"]({},a,{quote:f,quoteExternalId:g,type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:b.xmaMessageType})}function j(a){var b={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.GIF});case d("WAMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});default:throw c("err")("Trying to reply to a message type that does not support replies")}}g.writeLocalXMAMsg=a}),98);
__d("MAWWriteMsgRetryApi",["MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("writeMsgRetry",!1)))(function(a,b,c,e){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var f=b[0];b=b[1];if(f!=null)f=f.msgId;else if(b!=null)f=d("MAWDbReaction").reactionIdToMsgId(b.reactionId);else return;return h(a,f,c,e)})});function h(a,b,c,d){return a.receipts.get(b).then(function(b){if(b==null||b.permittedIdentitiesPerDevice==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.receipts.update(b.msgId,{permittedIdentitiesPerDevice:e}).then(function(){})})}g.writeMsgRetry=a}),98);
__d("MAWDeletePreKeyGenerationsApi",["MAWDbPrekeyTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWSignalUtils","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{prekey:d("MAWTransactionMode").READWRITE,prekeyGeneration:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("deletePreKeyGenerations",!1)))(function(a,b){return a.prekeyGeneration.bulkGet(b).then(function(c){var e=[];c.forEach(function(a){if(a==null){d("WALogger").WARN(h());return}d("MAWSignalUtils").getPrekeyIdsInRange(a.startingId,a.endingId).forEach(function(a){e.push(a)})});c=a.prekeyGeneration.bulkDelete(b);var f=d("MAWDbPrekeyTxns").bulkDeletePreKeys(a,e);return d("MAWDexieTable").dexieAll([c,f]).then(function(){})})});g.deletePreKeyGenerations=a}),98);
__d("MAWGetLastPreKeyGenerationIdApi",["MAWDbMetaTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{meta:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getLastPreKeyGenerationId",!1)))(function(a){var b=d("MAWDbMetaTxns").maybeGetLastPrekeyId(a);a=d("MAWDbMetaTxns").maybeGetLastPrekeyGenerationId(a);return d("MAWDexieTable").dexieAll([b,a]).then(function(a){var b=a[0];a=a[1];if(b==null&&a!=null||b!=null&&a==null)throw c("err")("Last prekey id and Last prekey generation id should both be non-null");if(b!=null&&a!=null)return{lastGenerationId:a,lastPreKeyId:b};else return null})});g.getLastPreKeyGenerationId=a}),98);
__d("MAWGetPreKeyGenerationsTimestampsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{prekeyGeneration:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getPreKeyGenerationsTimestamps",!1)))(function(a){return a.prekeyGeneration.toArray().then(function(a){return a.map(function(a){return{id:a.generationId,timestamp:a.createdTs}})})});g.getPreKeyGenerationsTimestamps=a}),98);
__d("MAWLoadLatestSignedPreKeyApi",["MAWDbSignedPrekeyTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{meta:d("MAWTransactionMode").READONLY,signedPrekey:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadLatestSignedPreKey",!1)))(d("MAWDbSignedPrekeyTxns").getLatestSignedPreKey);g.loadLatestSignedPreKey=a}),98);
__d("MAWLoadOneTimePreKeyApi",["MAWBridge","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{prekey:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadOneTimePreKey",!1)))(function(a,b){return a.prekey.get(b).then(function(a){if(a==null)d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GET_PREKEY,key:"miss_prekey_in_db"});else if(a.isDeleted===!0)d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.GET_PREKEY,key:"prekey_is_deleted"});else return a.encoded})});g.loadOneTimePreKey=a}),98);
__d("MAWLoadPreKeysApi",["MAWCompareIdentity","MAWDbMetaTxns","MAWDbPrekeyTxns","MAWDbSignedPrekeyTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WASignalSignatures","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY,prekey:d("MAWTransactionMode").READONLY,prekeyGeneration:d("MAWTransactionMode").READONLY,signedPrekey:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadPreKeys",!1)))(function(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbSignedPrekeyTxns").getLatestSignedPreKey(a),d("MAWCompareIdentity").compareIdentity(a)]).then(function(e){e=e[0];var f=d("WASignalSignatures").deserializeSignedPreKey(e);if(f==null)throw c("err")("Failed to deserialize signed prekey");e=b!=null?d("MAWDexieTable").dexieResolve(b):d("MAWDbMetaTxns").maybeGetLastPrekeyGenerationId(a);return e.then(function(b){if(b==null)throw c("err")("No last prekey generation id");return d("MAWDbPrekeyTxns").getPrekeysForGeneration(a,b).then(function(a){return{preKeys:a,signedPreKey:f}})})})});g.loadPreKeys=a}),98);
__d("MAWLoadSignedPreKeyApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{signedPrekey:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("loadSignedPreKey",!1)))(function(a,b){return a.signedPrekey.get(b).then(function(a){return a==null?void 0:a.encoded})});g.loadSignedPreKey=a}),98);
__d("MAWSaveOneTimePreKeyIfMatchesApi",["MAWDbMetaTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{meta:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveOneTimePreKeyIfMatches",!1)))(function(a,b,c){return d("MAWDbMetaTxns").maybeGetLastPrekeyId(a).then(function(e){if(e==null)return d("WAResultOrError").makeError("missing_last_prekey");return e!==b?d("WAResultOrError").makeError("mismatch"):d("MAWDexieTable").dexieAll([a.prekey.put(babelHelpers["extends"]({},c,{isDeleted:!1})),a.meta.put({key:d("SignalDbTypes").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:c.keyId}})]).then(function(){return d("WAResultOrError").makeResult()})})});g.saveOneTimePreKeyIfMatches=a}),98);
__d("MAWSavePreKeysGenerationIfMatchesApi",["MAWDbMetaTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{meta:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE,prekeyGeneration:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("savePreKeysGenerationIfMatches",!1)))(function(a,b,c,e){return d("MAWDbMetaTxns").maybeGetLastPrekeyGenerationId(a).then(function(f){if(e.length==0||f==null&&b!=null||f!=null&&b==null||f!=null&&b!=null&&f!==b)return d("WAResultOrError").makeError("errPreKeyMismatch");f=e[0].keyId;var g=e[e.length-1].keyId,h=e.map(function(a){return babelHelpers["extends"]({},a,{isDeleted:!1})});h=a.prekey.bulkPut(h);var i=a.meta.bulkPut([{key:d("SignalDbTypes").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:g}},{key:d("SignalDbTypes").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:c}}]);g=a.prekeyGeneration.put({createdTs:d("WATimeUtils").unixTime(),endingId:g,generationId:c,startingId:f});return d("MAWDexieTable").dexieAll([h,i,g]).then(function(){return d("WAResultOrError").makeResult()})})});g.savePreKeysGenerationIfMatches=a}),98);
__d("MAWSaveSignedPreKeyIfNewApi",["MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WASignalSignatures"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{meta:d("MAWTransactionMode").READWRITE,signedPrekey:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveSignedPreKeyIfNew",!1)))(function(a,b,c){return a.signedPrekey.get(b).then(function(e){if(e!=null){e=d("WASignalSignatures").deserializeSignedPreKey(e.encoded);if(e!=null)return{key:e,type:"duplicate"}}e=a.signedPrekey.put({encoded:c,keyId:b});var f=a.meta.put({key:d("SignalDbTypes").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:b}});return d("MAWDexieTable").dexieAll([e,f]).then(function(){return{type:"success"}})})});g.saveSignedPreKeyIfNew=a}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWMsgRecipientsTxns","MAWRecipientDevicesTxns","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThreadByJid(a,b.threadJid).then(function(c){return!c.success?d("WAResultOrError").makeError(c.error):d("MAWDexieTable").dexieAll([d("MAWMsgRecipientsTxns").getMsgRecipients(a,b.reactionId),d("MAWRecipientDevicesTxns").getICDCInfoForUsersInThread(a,c.value.chatId)]).then(function(a){var c=a[0];a=a[1];return!a.success?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult({contactsSyncInfo:a.value.contactsSyncInfo,icdcInfo:a.value.icdcInfoList,msg:b,recipients:c.recipients})})})})}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,receipts:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getReactionForSending",!1)))(function(a,b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value;var b=a.contactsSyncInfo,e=a.icdcInfo,f=a.msg;a=a.recipients;var g=d("MAWAsMessageApplication").asReactionMessageApplication(f);if(d("WAJids").isAuthorSystem(f.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:f.threadJid,contactsSyncInfo:b,externalId:f.externalId,icdcInfo:e,messageApplication:g,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:f.author,chat:f.threadJid,externalId:f.externalId},recipients:a,type:"unsent"}})});g.getReactionForSending=a}),98);
__d("MAWLinkReactionsToMsgsApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWLinkReactionsToMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("linkReactionsToMsgs",!1)))(function(a,b){return d("MAWLinkReactionsToMsgsTxns").linkReactionsToMsgs(a,b)});g.linkReactionsToMsgs=a}),98);
__d("MAWWriteMsgReceiptsApi",["MAWIncomingReceiptTxns","MAWIndexedDb","MAWTransactionMode","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," receipt"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,pendingReceipts:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY},c("qpl")._(25299660,"7057"))(function(a,b,c,e){d("WALogger").LOG(h(),c);return d("MAWIncomingReceiptTxns").bulkHandleIncomingReceipts(a,[{msgs:b,receivers:e,type:c}])});g.writeMsgReceipts=a}),98);
__d("MAWTaskScheduleApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","Promise","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["setTaskScheduledTime "," ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getTaskScheduledTime ",""]);i=function(){return a};return a}var j=new Map(),k=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{tasks:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getTasksScheduledTime",!1)))(function(a,b){return a.tasks.get(b).then(function(a){return a==null?null:a.scheduledTime})});f=function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:d("WALogger").DEV(i(),a);if(!j.has(a)){e.next=3;break}return e.abrupt("return",b("Promise").resolve(j.get(a)));case 3:e.next=5;return b("regeneratorRuntime").awrap(k(a));case 5:c=e.sent;c!=null&&j.set(a,c);return e.abrupt("return",c);case 8:case"end":return e.stop()}},null,this)};var l=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{tasks:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("setTaskScheduledTime",!1)))(function(a,b,c){d("WALogger").DEV(h(),b,c);j.set(b,c);return a.tasks.put({scheduledTime:c,taskName:b}).then(function(){})});function a(){return j}function c(a,b){j.set(a,b)}function e(){j.clear()}g.getTaskScheduledTime=f;g.setTaskScheduledTime=l;g.getTaskScheduleCache=a;g.setTaskScheduleCache=c;g.clearTaskScheduleCache=e}),98);
__d("MAWBulkSaveSignalDataApi",["MAWBridge","MAWDbIdentityTxns","MAWDbPrekeyTxns","MAWDbSenderKeySessionTxns","MAWDbSessionTxns","MAWDexieTable","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","SignalDbTypes","WACryptoManager","WADualSendMsgUtils","WAJids","WAOdsEnums","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{identity:d("MAWTransactionMode").READWRITE,prekey:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE,session:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("bulkSaveSignalData",!1)))(function(a,b){var c=b.identityUpdate,e=b.preKeyRemove,f=b.senderKeySessionUpdate,g=b.sessionUpdate;b=g.map(function(a){var b=a.id;a=a.original;return{id:b,oldHash:a}});var h=g.map(function(a){var b=a.id;a=a.updated;return{id:b,session:d("WACryptoManager").encodeSession(a)}}),i=[],j=[];f.forEach(function(a){var b=a.author,c=a.groupId,e=a.original;a=a.updated;c=d("WADualSendMsgUtils").isDualSendJid(c)?d("WADualSendMsgUtils").removeDualSendPrefixForGroup(c):c;var f=d("WAJids").extractUserJid(b);b=d("WAJids").extractDeviceId(b);var g=d("SignalDbTypes").buildSenderKeySessionId(c,f,b);i.push({id:g,oldHash:e});j.push({deviceId:b,groupJid:c,id:g,record:d("WACryptoManager").encodeSenderKeySession(a),userJid:f})});return d("MAWDexieTable").dexieAll([g.length>0?d("MAWDbSessionTxns").bulkCheckSessionsMatch(a,b):d("WAResultOrError").makeResult(),f.length>0?d("MAWDbSenderKeySessionTxns").bulkCheckSenderKeySessionsMatch(a,i):d("WAResultOrError").makeResult()]).then(function(b){for(var i=0;i<b.length;i++){var k=b[i];if(!k.success)return k}var l=c.map(function(a){var b=a.id;a=a.identity;return{deviceJid:b,identity:a,userJid:d("WAJids").extractUserJid(b)}});return d("MAWDexieTable").dexieAll([g.length>0?d("MAWDbSessionTxns").bulkSaveSessions(a,h):d("MAWDexieTable").dexieResolve(),f.length>0?d("MAWDbSenderKeySessionTxns").bulkPutSenderKeySessions(a,j):d("MAWDexieTable").dexieResolve(),c.length>0?d("MAWDbIdentityTxns").compareIdentityMismatch(a,l).then(function(b){b&&d("MAWBridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"bulk_save_signal_data_identity_mismatch"});return d("MAWDbIdentityTxns").bulkPutIdentities(a,l)}):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWDbPrekeyTxns").bulkDeletePreKeys(a,e.map(function(a){a=a.id;return a})):d("MAWDexieTable").dexieResolve()]).then(function(){return d("WAResultOrError").makeResult()})})});g.bulkSaveSignalData=a}),98);
__d("MAWDownloadSyncBlobApi",["WADownloadPlaintext","WAMediaUtils","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("WADownloadPlaintext").downloadPlaintext({serverMediaType:"md-app-state"},a.fileEncSha256,a.directPath,d("WAMediaUtils").castToMediaKey(a.mediaKey),d("WAMediaUtils").toPlaintextHash(a.fileSha256)));case 2:e=f.sent;if(e.success){f.next=5;break}throw c("err")("syncd: error when downloading blob: "+e.error);case 5:return f.abrupt("return",e.value);case 6:case"end":return f.stop()}},null,this)};g.downloadSyncBlob=a}),98);
__d("MAWGetDeviceFingerprint",["MAWIndexedDb","MAWTransactionMode","MAWUpdateDevicesForUserApi","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({identity:d("MAWTransactionMode").READONLY})(function(a){return d("MAWUpdateDevicesForUserApi").getAllDeviceJidsForUser(a,d("WAGlobals").getMyUserJid()).then(function(a){var b=d("WAGlobals").getMyDeviceJid();return{currentIndex:d("WAJids").extractDeviceId(b),deviceIndexes:a.map(d("WAJids").extractDeviceId),rawId:0}})});g.getDeviceFingerprint=a}),98);
__d("MAWHandleSyncBeforeApplyPatch",["Promise"],(function(a,b,c,d,e,f){"use strict";a=function(){return b("Promise").resolve()};f.handleSyncBeforeApplyPatch=a}),66);
__d("MAWHandleSyncCompletedApi",["Promise"],(function(a,b,c,d,e,f){"use strict";a=function(){return b("Promise").resolve()};f.handleSyncCompleted=a}),66);
__d("MAWHandleSyncDelayApplyingPatchUntilUIUnblocks",["Promise"],(function(a,b,c,d,e,f){"use strict";a=function(){return b("Promise").resolve()};f.handleSyncDelayApplyingPatchUntilUIUnblocks=a}),66);
__d("WASyncdRequestDelete",["WAComms","WALogger","WASyncdRequestBuilderBuild","WAWapParser","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: succeeded in deleting all server data"]);h=function(){return a};return a}var i=new(d("WAWapParser").WapParser)("syncDelete",function(){d("WALogger").LOG(h())});function a(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(d("WAComms").deprecatedSendIq(d("WASyncdRequestBuilderBuild").buildDeleteAllIqNode(),i));case 2:case"end":return a.stop()}},null,this)}g.deleteAllServerData=a}),98);
__d("MAWHandleSyncdFatal",["MAWSyncd","WAComms","WALogger","WASyncd","WASyncdRequestDelete","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling syncd fatal"]);h=function(){return a};return a}a=function(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:d("WALogger").LOG(h());c.next=3;return b("regeneratorRuntime").awrap(d("WASyncd").clearSyncdData());case 3:if(!((a==null?void 0:a.fromServer)===!0)){c.next=7;break}d("WAComms").forceResetSocketLoop();c.next=9;break;case 7:c.next=9;return b("regeneratorRuntime").awrap(d("WASyncdRequestDelete").deleteAllServerData());case 9:return c.abrupt("return",d("MAWSyncd").initializeSyncd());case 10:case"end":return c.stop()}},null,this)};g.handleSyncdFatal=a}),98);
__d("MAWSendSyncdKeyRequestApi",["MAWGlobals","MAWJobDefinitions","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("MAWGlobals").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:{syncKeyRequest:{keyIds:a},type:"sync_key_request"}})).then(function(a){return a.map(d("WAJids").extractDeviceId)})};g.sendSyncdKeyRequest=a}),98);
__d("MAWSendSyncdKeyRotation",["MAWGlobals","MAWJobDefinitions"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:{syncKeyShare:{keys:a},type:"sync_key_share"}}))};g.sendSyncdKeyRotation=a}),98);
__d("MAWUploadSyncExternalPatchApi",["MAWMediaUtils","Promise","WACreateRetrier","WAMediaUtils","WATimeUtils","WAUploadMedia","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.next=2;return b("regeneratorRuntime").awrap(d("MAWMediaUtils").hashArrayBuffer(a));case 2:e=j.sent;f=d("WAMediaUtils").toPlaintextHash(e);j.next=6;return b("regeneratorRuntime").awrap(d("WACreateRetrier").createUploadRetrier("md-app-state"));case 6:g=j.sent;if(g.success){j.next=9;break}throw c("err")("Failed to create a retrier");case 9:h=g.value;i=null;j.next=13;return b("regeneratorRuntime").awrap(d("WAUploadMedia").encryptAndUploadPlaintext({serverMediaType:"md-app-state"},f,new Blob([a]),d("WAMediaUtils").createMediaKey(),d("WATimeUtils").unixTime(),d("WAMediaUtils").createUploadToken(),a.byteLength,h,function(a){i=a;return b("Promise").resolve()}));case 13:if(!(i==null||i.directPath==null||i.fileEncSha256==null||i.handle==null||i.mediaKey==null)){j.next=15;break}throw c("err")("Incorrect media entry");case 15:return j.abrupt("return",{directPath:i.directPath,encFilehash:i.fileEncSha256,handle:i.handle,mediaKey:i.mediaKey});case 16:case"end":return j.stop()}},null,this)};g.uploadSyncExternalPatch=a}),98);
__d("MAWGetThreadInfoForDeletionApi",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WALogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getThreadInfoForDeletion",!1)))(function(a,b){return a.threads.get(b).then(function(a){if(a==null){var b="Thread was null when getting thread for deletion";d("WALogger").ERROR(h(),b);throw c("err")(b)}return{chatJid:a.jid,newestMsgTs:(b=d("WATimeUtils").castMillisTimeToUnixTime(a.newestMsgTs))!=null?b:void 0}})});g.getThreadInfoForDeletion=a}),98);
__d("MAWGetThreadJidByChatId",["MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READONLY}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("getThreadJidByChatId",!1)))(function(a,b){return a.threads.get(b).then(function(a){return a==null?void 0:a.jid})});g.getThreadJidByChatId=a}),98);
__d("MAWUpdateThreadFolderApi",["MAWBridgeTypes","MAWDbThreadTxns","MAWIndexedDb","MAWLLAMigrationUtils","MAWTransactionMode","WADualSendMsgUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread "," folder with folder id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{threads:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("updateThreadFolder",!1)))(function(a,b,c){d("WALogger").LOG(i(),b);return d("MAWDbThreadTxns").getThreadByJid(a,b).then(function(e){if(!e.success)return;var f=e.value.chatId;return a.threads.update(f,{folder:c}).then(function(a){d("WALogger").LOG(h(),f,c);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypes").createBridgeUpdatedThread({folder:c,isDualSend:d("WADualSendMsgUtils").isDualSendJid(b),threadId:f})});return})})});g.updateThreadFolder=a}),98);
__d("MAWOptimisticUploadMedia",["MAWBridge","MAWFrontendMediaUtils","MAWGating","MAWGlobals","MAWMediaUtils","MAWOptimisticUploadManager","WAJids","WALogger","WAMediaCrypto","WAMediaQplHelper","WAMediaUtils","WAPREList","WAPREMetrics","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: File is already being uploaded"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: fileUploadResult success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: previewUploadResult success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: preview uploading"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: downloadable_preview_gk_enabled: ",", thumbnail_exists: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["optimisticUploadMedia: file uploading"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Expected chatJid in optimisticUploadMedia"]);n=function(){return a};return a}function o(a,c,e){var f,g,h,i,j,k,l,m;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:o.next=2;return b("regeneratorRuntime").awrap(d("MAWMediaUtils").hashBlob(a));case 2:f=o.sent;g=d("WAMediaUtils").toPlaintextHash(f);h=d("MAWOptimisticUploadManager").getOptimisticUploadManager();i=h.get(g);if(!(i!=null)){o.next=8;break}return o.abrupt("return",d("WAResultOrError").makeError("already_uploading"));case 8:if(!(c==null)){o.next=11;break}d("WALogger").ERROR(n());return o.abrupt("return",d("WAResultOrError").makeError("missing_chat_jid"));case 11:j=null;(e==null?void 0:e.serverMediaType)!=null?j=e.serverMediaType:j="preview";k=d("WAJids").switchOnMsgrChatJidType(c,{group:function(a){return"group"},user:function(a){return"user"}});l=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{bool:{isOptimisticUpload:!0},string:{chat_type:k,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(a.size),media_type:j}},void 0,{string:{jid:c}});m=d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",{chatJid:c,hash:g,mediaTypeDetails:e,protocolMsgId:null,size:a.size,uploadMediaFlow:l});return o.abrupt("return",d("WAResultOrError").makeResult({plaintextHash:g,uploadPromise:m}));case 17:case"end":return o.stop()}},null,this)}function a(a){var c,e,f,g,n,p,q,r,s,t,u;return b("regeneratorRuntime").async(function(v){while(1)switch(v.prev=v.next){case 0:c=a.file,e=a.threadId,f=a.thumbnail;v.next=3;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getThreadJidByChatId(e));case 3:g=v.sent;n=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(c.type),p=n.serverMediaType;d("WALogger").LOG(m());v.next=8;return b("regeneratorRuntime").awrap(o(c,g,{serverMediaType:p}));case 8:q=v.sent;r=null;s=d("MAWOptimisticUploadManager").getOptimisticUploadManager();t=d("MAWGating").isDownloadablePreviewsEnabled();d("WALogger").LOG(l(),t,f!=null);if(!(f&&t)){v.next=19;break}d("WALogger").LOG(k());v.next=17;return b("regeneratorRuntime").awrap(o(f,g,{previewMediaType:d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(p)}));case 17:u=v.sent,u.success===!0&&(d("WALogger").LOG(j()),r=u.value.plaintextHash,s.set(u.value.plaintextHash,{file:f,optimisticUploadPromise:u.value.uploadPromise}));case 19:if(!(q.success===!0)){v.next=24;break}d("WALogger").LOG(i());s.set(q.value.plaintextHash,{file:c,optimisticUploadPromise:q.value.uploadPromise,previewPlaintextHash:r});v.next=30;break;case 24:v.t0=q.error;v.next=v.t0==="already_uploading"?27:v.t0==="missing_chat_jid"?29:30;break;case 27:d("WALogger").LOG(h());return v.abrupt("break",30);case 29:return v.abrupt("break",30);case 30:case"end":return v.stop()}},null,this)}g.optimisticUploadMedia=a}),98);
__d("MAWRetryUploadMedia",["MAWAckLevel","MAWBridge","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWFrontendMediaUtils","MAWGlobals","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","WAJobOrchestratorTypes","WALogger","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media again for "," mediaId"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["retryUploadMedia for "," msgId"]);i=function(){return a};return a}function a(a){var e,f,g,k,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:e=a.msgId;d("WALogger").DEV(i(),e);p.next=4;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").maybeGetMsg)(e));case 4:f=p.sent;if(f){p.next=7;break}throw c("err")("No message associated with the given msgId");case 7:p.next=9;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaFromMediaId)(f.mediaId));case 9:g=p.sent;if(g){p.next=12;break}throw c("err")("No media entry associated with the given mediaId");case 12:p.next=14;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").maybeGetChunkFromHash)(g.hashedPlaintextHash));case 14:k=p.sent;if(k){p.next=17;break}throw c("err")("No chunk/blob associated with media entry");case 17:l=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(k.mimetype),m=l.serverMediaType;p.next=20;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getProtocolMsgIdByMediaMsgId(e));case 20:n=p.sent;if(n){p.next=23;break}throw c("err")("Db missing message with msgId: "+e);case 23:p.next=25;return b("regeneratorRuntime").awrap(d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",{chatJid:n.chat,hash:g.plaintextHash,msgId:e,size:new Blob([k.blobData],{type:k.mimetype}).size,type:m}));case 25:o=p.sent;if(o.success){p.next=29;break}d("WALogger").LOG(h(),g.mediaId);return p.abrupt("return",j(e,d("MAWAckLevel").ACK.failed));case 29:p.next=31;return b("regeneratorRuntime").awrap(j(e,d("MAWAckLevel").ACK.clock));case 31:p.next=33;return b("regeneratorRuntime").awrap(d("MAWGlobals").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenMsg(n,"message",{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})));case 33:case"end":return p.stop()}},null,this)}var j=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READONLY})(function(a,b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c).then(function(){})});g.retryUploadMedia=a}),98);
__d("MAWTransactionsConfig",[],(function(a,b,c,d,e,f){"use strict";a={setContacts:function(){return!0}};f.transactions=a}),66);
__d("MAWSaveRTCCallXMAMsg",["MAWAckLevel","MAWBridge","MAWBridgeXMA","MAWDexieTable","MAWExternalId","MAWFrontendMediaUtils","MAWGlobals","MAWIndexedDb","MAWLLAMigrationUtils","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgUtil","MAWOptimisticUploadManager","MAWSendMediaMsg","MAWTransactionMode","MAWWriteLocalXMAMsgApi","MAWXMAManagementTxns","Promise","WAArmadilloXMA.pb","WALogger","WAMediaUtils","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSaveRTCCallXMAMsg - Missing thread with jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSaveRTCCallXMAMsg - Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSaveRTCCallXMAMsg - XMAMessageType is null"]);l=function(){return a};return a}a=function(a){var c,e,f,g,m,p,q,r,s,t,u,v;return b("regeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:f=a.args.xmaMessageType;if(!(f==null)){w.next=4;break}d("WALogger").ERROR(l());return w.abrupt("return");case 4:w.next=6;return b("regeneratorRuntime").awrap(d("MAWWriteLocalXMAMsgApi").writeLocalXMAMsg(d("MAWExternalId").generateExternalId(),a.chatJid,a.ts,a.args,a.author));case 6:g=w.sent;if(!(g.type==="missing_thread")){w.next=10;break}d("WALogger").ERROR(k());return w.abrupt("return");case 10:w.next=12;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getMsgIdByProtocolMsgId(g.protocolMsgId));case 12:m=w.sent;if(!(m==null)){w.next=16;break}d("WALogger").ERROR(j());return w.abrupt("return");case 16:w.next=18;return b("regeneratorRuntime").awrap(d("MAWGlobals").getDbImpls().getThreadIdByJid(a.chatJid));case 18:p=w.sent;if(!(p==null)){w.next=22;break}d("WALogger").ERROR(i(),a.chatJid);return w.abrupt("return");case 22:q=babelHelpers["extends"]({},a.xmaArgs,{overlayIconGlyph:(c=a.xmaArgs.overlayIconGlyph)!=null?c:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE});w.next=25;return b("regeneratorRuntime").awrap(o(a.faviconFile,m,f,p,g.protocolMsgId,q));case 25:r=w.sent;s=d("MAWOptimisticUploadManager").getOptimisticUploadManager();w.next=29;return b("regeneratorRuntime").awrap(n(r,a.chatJid,g.protocolMsgId,s));case 29:t=w.sent;if(t==null?void 0:t.uploadResult.success){w.next=33;break}d("WALogger").ERROR(h());return w.abrupt("return",d("MAWMsgUtil").updateSystemAckWithTxn(m,d("MAWAckLevel").ACK.failed));case 33:u=t.uploadResult;v=t.media;w.next=37;return b("regeneratorRuntime").awrap(d("MAWSendMediaMsg").maybePersistMediaEntry(v.plaintextHash,m,a.chatJid,g.protocolMsgId.externalId,u==null?void 0:(e=u.value)==null?void 0:e.objectId,d("MAWMediaUtils").getServerMediaTypeFromMediaType(v.mediaType,"xma-media")));case 37:s["delete"](t.media.plaintextHash);case 38:case"end":return w.stop()}},null,this)};function m(a,b,c,e,f,g){g=g.get(a);g=g==null?void 0:g.optimisticUploadPromise;return g!=null?g:d("MAWBridge").getBridge().sendAndReceive("backend","uploadMedia",{chatJid:b,hash:a,mediaTypeDetails:{serverMediaType:e},protocolMsgId:c,size:f,uploadMediaFlow:void 0})}function n(a,c,e,f){if(a==null)return b("Promise").resolve();var g=d("MAWMediaUtils").getServerMediaTypeFromMediaType(a.mediaType,"xma-media");return m(a.plaintextHash,c,e,g,a.size,f).then(function(b){return{media:a,uploadResult:b}})}function o(a,c,d,e,f,g){var h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(p(a));case 2:h=i.sent;return i.abrupt("return",q(c,h,d,e,f,g));case 4:case"end":return i.stop()}},null,this)}function p(a){var e,f,g,h,i,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:if(!(a==null)){m.next=2;break}return m.abrupt("return",a);case 2:e=a.file;f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type),g=f.mediaType,h=f.serverMediaType;m.next=6;return b("regeneratorRuntime").awrap(d("MAWMediaUtils").genBlobHashes(e));case 6:i=m.sent;j=i[0];k=i[1];if(!(g!=="Image")){m.next=11;break}throw c("err")("Expected Image when sending XMA share");case 11:m.next=13;return b("regeneratorRuntime").awrap(d("WAMediaUtils").blobToArrayBuffer(e));case 13:l=m.sent;return m.abrupt("return",{blobArrayBuffer:l,file:e,hashedPlaintextHash:k,mediaInfo:{validatedAudioInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:g,plaintextHash:j,serverMediaType:h});case 15:case"end":return m.stop()}},null,this)}function q(a,b,c,e,f,g){return d("MAWIndexedDb").makeMsgrTransactor.apply(void 0,[{chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE,xma:d("MAWTransactionMode").READWRITE}].concat(d("MAWLLAMigrationUtils").getTransactorQPLParam("saveRTCXMAMediaAndMetadata",!1,{},!0)))(function(h){var i=new Map();if(b!=null){var j=i.get(b.plaintextHash);j==null&&i.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(h,a,b.blobArrayBuffer,b.plaintextHash,b.hashedPlaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!1))}j=Array.from(i.values());return d("MAWDexieTable").dexieAll(j).then(function(i){i=i.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var j=b!=null?i.get(b.plaintextHash):void 0;return d("MAWXMAManagementTxns").saveXMA(h,void 0,void 0,j==null?void 0:j.mediaId,c,a,void 0,f,g).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(e,j,a)});return j})})})()}g.saveRTCCallXMAMsg=a}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGlobals","WASignalKeys","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGlobals").runInTransaction({MetaInfoStore:!0},function(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:c=a.MetaInfoStore;i.next=3;return b("regeneratorRuntime").awrap(c.get());case 3:e=i.sent;f=e.deviceId;g=e.identityKeyPair;if(!(f==null||g==null)){i.next=8;break}return i.abrupt("return",null);case 8:h=d("WASignalKeys").serializePubKey(g);return i.abrupt("return",{deviceId:f,identityKey:h});case 10:case"end":return i.stop()}},null,this)},"getCurrentUserDeviceInfo")};g.getCurrentUserDeviceInfo=a}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WAJobDefinitions","WAJobOrchestratorTypes","WAJobs","WALogger","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeCurrentDevice called for current device"]);i=function(){return a};return a}a=function(){var a,c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:d("WALogger").DEV(i());g.next=3;return b("regeneratorRuntime").awrap(d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());case 3:a=g.sent;if(!(a==null)){g.next=7;break}d("WALogger").WARN(h());return g.abrupt("return",!0);case 7:c=a.deviceId,e=a.identityKey;g.next=10;return b("regeneratorRuntime").awrap(d("WAJobs").getJobManager().waitUntilCompleted(d("WAJobDefinitions").jobSerializers.removeDevice(c,e,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH})));case 10:f=g.sent;if(!f){g.next=15;break}g.next=14;return b("regeneratorRuntime").awrap(d("WAGlobals").getDbImpls().clearSignalAndTempStores());case 14:return g.abrupt("return",!0);case 15:return g.abrupt("return",!1);case 16:case"end":return g.stop()}},null,this)};g.removeCurrentDevice=a}),98);
__d("MAWCommonLowLevelApiBridgeHandlers",["MAWArchiveThreadApi","MAWBackfillThreadsForOccamadilloApi","MAWBulkUpdateContactApi","MAWChangeSecurityAlertSettingApi","MAWChangeSecurityAlertSettingForSelfApi","MAWCheckIfShowOpenMessageHistoryApi","MAWClearSignalAndTempStores","MAWCompareThreadParticipantsApi","MAWCompleteUndoThreadCutoverApi","MAWCreateThreadApi","MAWCreateThreadByJidApi","MAWDeleteThreadApi","MAWDualSendMediaUtils","MAWDyiGetThreadList","MAWEncryptedBackupsStateManager","MAWFTSDataSync","MAWFetchExistingThreadApi","MAWFetchExistingThreadForContactApi","MAWFetchThreadMessageCountApi","MAWFlushLogsApi","MAWGetAllThreadDevicesCountApi","MAWGetAllThreadsAsJsonApi","MAWGetBlobDataUrlByMediaIdApi","MAWGetBlobDataUrlByXMAIdApi","MAWGetContactApi","MAWGetDeviceChangeAlertsByOptionsApi","MAWGetDualSendMediaByFileTypeApi","MAWGetEphemeralSettingsApi","MAWGetGroupSuperAdminApi","MAWGetIdentityKeys","MAWGetLatestThreadIdsApi","MAWGetMaybeNextNonAdminMsgSortOrderMsApi","MAWGetProtocolMsgIdByMediaMsgId","MAWGetProtocolMsgIdByMsgId","MAWGetSecurityAlertSettingApi","MAWGetSecurityAlertSettingForSelfAndContactApi","MAWGetShadowGroupByOpenThreadKeyApi","MAWGetThreadDevicesInfoApi","MAWGetThreadJidByChatId","MAWGetThreadParticipantFBIDsApi","MAWGetThreadsInfoApi","MAWGetThumbnailBlobDataUrlByMediaIdApi","MAWGetWorkerHeartbeatApi","MAWInitSyncApi","MAWInsertAdminMessageInCutoverThreadsApi","MAWLoadMediaApi","MAWLoadMsgsApi","MAWLoadThreadsApi","MAWMarkThreadAsUnreadApi","MAWOptimisticUploadMedia","MAWPreEstablishSessionApi","MAWPredistributeSKDMApi","MAWRetryUploadMedia","MAWSaveRTCCallXMAMsg","MAWSendChatStateFromComposerApi","MAWSetEphemeralSettingsFromFrontendApi","MAWUnarchiveThreadApi","MAWUpdateDeviceChangeAlertsApi","MAWUpdateParticipantNameApi","MAWUpdateThreadMuteSettingApi","MAWWriteLSDBToPersistedEBTables","WAGetCurrentUserDeviceInfoApi","WARemoveCurrentDevice"],(function(a,b,c,d,e,f,g){"use strict";a={archiveThread:function(a){return d("MAWArchiveThreadApi").archiveThread(a.threadId)},backfillThreadsForOccamadillo:function(){return d("MAWBackfillThreadsForOccamadilloApi").backfillThreadsForOccamadillo()},changeSecurityAlertSetting:function(a){return d("MAWChangeSecurityAlertSettingApi").changeSecurityAlertSetting(a.isEnableAlert)},changeSecurityAlertSettingForSelf:function(a){return d("MAWChangeSecurityAlertSettingForSelfApi").changeSecurityAlertSettingForSelf(a.isEnableSelfAlert)},checkIfShowOpenMessageHistory:function(a){return d("MAWCheckIfShowOpenMessageHistoryApi").checkIfShowOpenMessageHistory(a.chatId,a.timestampMs)},clearSignalAndTempStores:function(a){return d("MAWClearSignalAndTempStores").clearSignalAndTempStores()},compareThreadParticipants:function(a){return d("MAWCompareThreadParticipantsApi").compareThreadParticipants(a.participantIds,a.existingGroup)},completeUndoThreadCutover:function(a){return d("MAWCompleteUndoThreadCutoverApi").completeUndoThreadCutover(a)},createThread:function(a){return d("MAWCreateThreadApi").createThread(a.contactFbid,a.offlineThreadingId)},createThreadThroughMI:function(a){return d("MAWCreateThreadByJidApi").createThreadByJid(a)},deleteThread:function(a){return d("MAWDeleteThreadApi").deleteThread(a.threadId)},dyiGetThreadList:function(a){return d("MAWDyiGetThreadList").dyiGetThreadList(a.threadJids)},fetchArmadilloThreadMessageCount:function(a){return d("MAWFetchThreadMessageCountApi").fetchArmadilloThreadMessageCount(a.threadId)},fetchExistingThread:function(a){return d("MAWFetchExistingThreadApi").fetchExistingThread(a)},fetchExistingThreadForContact:function(a){return d("MAWFetchExistingThreadForContactApi").fetchExistingThreadForContact(a)},getAllThreadDevicesCount:function(a){return d("MAWGetAllThreadDevicesCountApi").getAllThreadDevicesCount(a.threadKey)},getAllThreadsAsJson:function(){return d("MAWGetAllThreadsAsJsonApi").getAllThreadsAsJson()},getBlobDataUrlByMediaId:function(a){return d("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByMediaId(a.mediaId)},getBlobDataUrlByXMAId:function(a){return d("MAWGetBlobDataUrlByXMAIdApi").getBlobDataUrlByXMAId(a.xmaId,a.infoType)},getContact:function(a){return d("MAWGetContactApi").getContact(a)},getCurrentUserDeviceInfo:function(){return d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo()},getDeviceChangeAlertsByOptions:function(a){return d("MAWGetDeviceChangeAlertsByOptionsApi").getDeviceChangeAlertsByOptions(a.options)},getDualSendMediaByFileType:function(a){return d("MAWGetDualSendMediaByFileTypeApi").getDualSendMediaByFileType(d("MAWDualSendMediaUtils").convertStringToDualSendMediaType(a.fileType))},getEphemeralSettings:function(a){return d("MAWGetEphemeralSettingsApi").getEphemeralSettings(a.threadId)},getGroupSuperAdmin:function(a){return d("MAWGetGroupSuperAdminApi").getGroupSuperAdmin(a.threadId)},getIdentityKeys:function(a){return d("MAWGetIdentityKeys").getIdentityKeys()},getLatestThreadIds:function(a){return d("MAWGetLatestThreadIdsApi").getLatestThreadIds(a.numThreads)},getMaybeNextNonAdminMsgSortOrderMs:function(a){return d("MAWGetMaybeNextNonAdminMsgSortOrderMsApi").getMaybeNextNonAdminMsgSortOrderMs(a.threadId,a.mayBeAdminMsgId)},getProtocolMsgIdByMediaMsgId:function(a){return d("MAWGetProtocolMsgIdByMediaMsgId").getProtocolMsgIdByMediaMsgId(a.msgId)},getProtocolMsgIdByMsgId:function(a){return d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(a.msgId)},getSecurityAlertSetting:function(a){return d("MAWGetSecurityAlertSettingApi").getSecurityAlertSetting()},getSecurityAlertSettingForSelfAndContact:function(a){return d("MAWGetSecurityAlertSettingForSelfAndContactApi").getSecurityAlertSettingForSelfAndContact()},getShadowGroupByOpenThreadKey:function(a){return d("MAWGetShadowGroupByOpenThreadKeyApi").getShadowGroupByOpenThreadKey(a.openThreadKey)},getThreadDevicesInfo:function(a){return d("MAWGetThreadDevicesInfoApi").getThreadDevicesInfo(a)},getThreadIdByChatJid:function(a){return d("MAWGetThreadsInfoApi").getThreadIdByJid(a.chatJid)},getThreadIdByDeduplicationKey:function(a){return d("MAWGetThreadsInfoApi").getThreadIdByDeduplicationKey(a.deduplicationKey)},getThreadJidByChatId:function(a){return d("MAWGetThreadJidByChatId").getThreadJidByChatId(a.threadId)},getThreadParticipantFBIDs:function(a){return d("MAWGetThreadParticipantFBIDsApi").getThreadParticipantFBIDs(a)},getThumbnailBlobDataUrlByMediaId:function(a){return d("MAWGetThumbnailBlobDataUrlByMediaIdApi").getThumbnailBlobDataUrlByMediaId(a.mediaId)},getWorkerHeartbeat:function(){return d("MAWGetWorkerHeartbeatApi").getWorkerHeartbeat()},initSync:function(a){return d("MAWInitSyncApi").initSync(a.numThreads,a.numMsgsPerThread)},insertAdminMessageInCutoverThreads:function(a){return d("MAWInsertAdminMessageInCutoverThreadsApi").insertAdminMessageInCutoverThreads(a)},loadMoreMedia:function(a){return d("MAWLoadMediaApi").loadMoreMedia(a)},loadMoreMsgs:function(a){return d("MAWLoadMsgsApi").loadMsgs(a.threadId,a.offsetMsgId,a.numMsgs)},loadMoreThreads:function(a){return d("MAWLoadThreadsApi").loadMoreThreads(a.offsetThreadId,a.numThreads,a.numMsgsPerThread,a.folderId)},markThreadAsUnread:function(a){return d("MAWMarkThreadAsUnreadApi").markThreadAsUnread(a.threadId)},optimisticUploadMedia:function(a){return d("MAWOptimisticUploadMedia").optimisticUploadMedia(a)},predistributeSKDM:function(a){return d("MAWPredistributeSKDMApi").predistributeSKDM(a.groupJid,a.numParticipants)},preEstablishSession:function(a){return d("MAWPreEstablishSessionApi").preEstablishSession(a.groupJid)},removeCurrentDevice:function(){return d("WARemoveCurrentDevice").removeCurrentDevice()},requestLogs:function(){return d("MAWFlushLogsApi").flushLogs()},retryUploadMedia:function(a){return d("MAWRetryUploadMedia").retryUploadMedia({msgId:a.msgId})},saveRTCCallXMAMsg:function(a){return d("MAWSaveRTCCallXMAMsg").saveRTCCallXMAMsg(a)},search:function(a){return d("MAWFTSDataSync").search(a)},sendChatStateFromComposer:function(a){return d("MAWSendChatStateFromComposerApi").sendChatStateFromComposer(a)},setEncryptedBackupsState:function(a){return d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a.newState)},setEphemeralSettingsFromFrontend:function(a){return d("MAWSetEphemeralSettingsFromFrontendApi").setEphemeralSettingsFromFrontend(a)},unarchiveThread:function(a){return d("MAWUnarchiveThreadApi").unarchiveThread(a.threadId)},updateContacts:function(a){return d("MAWBulkUpdateContactApi").updateContacts(a)},updateDeviceChangeAlerts:function(a){return d("MAWUpdateDeviceChangeAlertsApi").updateDeviceChangeAlerts(a.alert)},updateParticipantName:function(a){return d("MAWUpdateParticipantNameApi").updateParticipantName(a)},updateThreadMuteSetting:function(a){return d("MAWUpdateThreadMuteSettingApi").updateThreadMuteSetting({muteDuration:a.muteDuration,threadId:a.threadId})},writeLSDBToPersistedEBTables:function(a){return d("MAWWriteLSDBToPersistedEBTables").writeLSDBToPersistedEBTables(a.changeSet)}};g.commonBridgeHandlers=a}),98);
__d("MAWCommonLowLevelApiLogWrapper",["Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting"]);j=function(){return a};return a}function a(a){Object.keys(a).forEach(function(c){var e=a[c];a[c]=function(){for(var a=arguments.length,f=new Array(a),g=0;g<a;g++)f[g]=arguments[g];return d("WALogger").runInLoggerContext(c,function(){d("WALogger").DEV(j());return b("Promise").resolve(e.apply(void 0,f)).then(function(a){d("WALogger").DEV(i());return a})["catch"](function(a){d("WALogger").LOG(h());throw a})})}});return a}g.lowLevelApiLogWrapper=a}),98);
__d("MAWCommonLowLevelApiDbCallbacks",["MAWBulkGetAppDataForRetryApi","MAWBulkHandleIncomingMsgApi","MAWBulkWriteReceiptsApi","MAWClearSignalAndTempStores","MAWCommonLowLevelApiLogWrapper","MAWCreateGroupApi","MAWDebugMsg","MAWDeleteExpiredMsgsApi","MAWDeleteGroupsApi","MAWDownloadSyncBlobApi","MAWFlushCacheToDbApi","MAWGetAllThreadsAsJsonApi","MAWGetAppDataApi","MAWGetAppDataForResendApi","MAWGetAppDataForRetryApi","MAWGetContactAndIdentitiesApi","MAWGetDeviceFingerprint","MAWGetDownloadableThumbnailForMediaApi","MAWGetGroupInviteApi","MAWGetIdentityKeys","MAWGetLastMsgsInChatForSpamReportApi","MAWGetMediaByObjectId","MAWGetMediaIfAuthorizedApi","MAWGetMediaKnownEntriesApi","MAWGetMediaPlaintextApi","MAWGetMsgForRetryApi","MAWGetMsgForSendingApi","MAWGetMsgIdByProtocolMsgId","MAWGetMyDevicesApi","MAWGetNextDeleteDFMContentTs","MAWGetNextDeletePendingStanzaTs","MAWGetNextDeleteUnsendContentTs","MAWGetNextDeletionTsApi","MAWGetNextExpirationTsApi","MAWGetNextExpiredXMATs","MAWGetProtocolMsgIdByMediaMsgId","MAWGetProtocolMsgIdByMsgId","MAWGetReactionForSending","MAWGetSenderKeyStatusApi","MAWGetSyncResponseBackoffInfoByJidApi","MAWGetThreadInfoForDeletionApi","MAWGetThreadJidByChatId","MAWGetThreadsInfoApi","MAWGetUnreadMsgsApi","MAWGetWorkerHeartbeatApi","MAWHandleConnectedAdminMsgApi","MAWHandleEchoMsgsRestoreApi","MAWHandleEncryptedBackupsSecretsApi","MAWHandleMediaDownloadAndRestoreApi","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWHandleReachabilityErrorAdminMsgApi","MAWHandleSyncBeforeApplyPatch","MAWHandleSyncCompletedApi","MAWHandleSyncDelayApplyingPatchUntilUIUnblocks","MAWHandleSyncdFatal","MAWLeaveGroupsApi","MAWLinkReactionsToMsgsApi","MAWLoadRecentParticipantsApi","MAWMarkAppDataDroppedApi","MAWMarkAppDataSendFailedApi","MAWMarkAppDataSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMarkParticipantNeedsKeyApi","MAWMarkReadReceiptsSentUpToApi","MAWMarkSenderKeyAsRotatedApi","MAWMarkSenderKeyAsSentApi","MAWMarkThreadAsReadUpToApi","MAWPreEstablishSessionApi","MAWPredistributeSKDMApi","MAWProcessFutureproofMsgApi","MAWProcessSpamMsgApi","MAWRemoveExpiredDFMMsgsContent","MAWRemoveExpiredMsgsFromUIApi","MAWRemoveExpiredPendingStanzas","MAWRemoveExpiredUnsendMsgsContent","MAWRemoveExpiredXMAMsgsContentApi","MAWRemoveGroupInvitesApi","MAWRevokeMsgsApi","MAWSendSyncdKeyRequestApi","MAWSendSyncdKeyRotation","MAWSetDevicesApi","MAWTaskScheduleApi","MAWTransactor","MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUpdateThreadFolderApi","MAWUpdateUserDevicesApi","MAWUploadRetroactiveMessageBatchApi","MAWUploadSyncExternalPatchApi","MAWWriteAppDataReceiptsApi","MAWWriteAppDataRetryApi","MAWWriteForwardedMsgApi","MAWWriteGroupInviteApi","MAWWriteMetaSyncsApi","MAWWriteMsgReceiptsApi","MAWWriteMsgRetryApi","MAWWriteOutgoingAppDataApi","MAWWriteOutgoingMsgApi","MAWWritePeerMsgReceiptsApi","MAWWriteReactionMsgApi","Promise","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWCommonLowLevelApiLogWrapper").lowLevelApiLogWrapper({bulkGetAppDataForRetry:d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry,bulkHandleIncomingMsgs:d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs,bulkWriteReceipts:d("MAWBulkWriteReceiptsApi").bulkWriteReceipts,clearSignalAndTempStores:d("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroup:d("MAWCreateGroupApi").createGroup,createGroups:d("MAWCreateGroupApi").createGroups,deleteExpiredMsgs:d("MAWDeleteExpiredMsgsApi").deleteExpiredMsgs,deleteGroups:d("MAWDeleteGroupsApi").deleteGroups,downloadSyncBlob:d("MAWDownloadSyncBlobApi").downloadSyncBlob,flushCacheToDb:d("MAWFlushCacheToDbApi").flushCacheToDb,getAllThreadsAsJson:d("MAWGetAllThreadsAsJsonApi").getAllThreadsAsJson,getAppData:d("MAWGetAppDataApi").getAppData,getAppDataForResend:d("MAWGetAppDataForResendApi").getAppDataForResend,getAppDataForRetry:d("MAWGetAppDataForRetryApi").getAppDataForRetry,getContactAndIdentitiesForUser:d("MAWGetContactAndIdentitiesApi").getContactAndIdentitiesForUser,getDeviceFingerprint:d("MAWGetDeviceFingerprint").getDeviceFingerprint,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getGroupInvite:d("MAWGetGroupInviteApi").getGroupInvite,getIdentityKeys:d("MAWGetIdentityKeys").getIdentityKeys,getLastMsgsInChatForSpamReport:d("MAWGetLastMsgsInChatForSpamReportApi").getLastMsgsInChatForSpamReport,getMediaByObjectId:d("MAWGetMediaByObjectId").getMediaByObjectId,getMediaIfAuthorized:d("MAWGetMediaIfAuthorizedApi").getMediaIfAuthorized,getMediaKnownEntries:d("MAWGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaMsgForRedownload:function(){return b("Promise").resolve(d("WAResultOrError").makeError("message-not-found"))},getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,getMsgForRetry:d("MAWGetMsgForRetryApi").getMsgForRetry,getMsgForSending:d("MAWGetMsgForSendingApi").getMsgForSending,getMsgIdByProtocolMsgId:d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId,getMsgsForRetry:d("MAWGetMsgForRetryApi").getMsgsForRetry,getMyDevices:d("MAWGetMyDevicesApi").getMyDevices,getNextDeleteDFMContentTs:d("MAWGetNextDeleteDFMContentTs").getNextDeleteDFMContentTs,getNextDeletePendingStanzaTs:d("MAWGetNextDeletePendingStanzaTs").getNextDeletePendingStanzaTs,getNextDeleteUnsendContentTs:d("MAWGetNextDeleteUnsendContentTs").getNextDeleteUnsendContentTs,getNextDeletionTs:d("MAWGetNextDeletionTsApi").getNextDeletionTs,getNextExpirationTs:d("MAWGetNextExpirationTsApi").getNextExpirationTs,getNextExpiredXMATs:d("MAWGetNextExpiredXMATs").getNextExpiredXMATs,getProtocolMsgIdByMediaMsgId:d("MAWGetProtocolMsgIdByMediaMsgId").getProtocolMsgIdByMediaMsgId,getProtocolMsgIdByMsgId:d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId,getReactionForSending:d("MAWGetReactionForSending").getReactionForSending,getSenderKeyStatus:d("MAWGetSenderKeyStatusApi").getSenderKeyStatus,getSyncResponseBackoffInfoByJid:d("MAWGetSyncResponseBackoffInfoByJidApi").getSyncResponseBackoffInfoByJid,getTaskScheduledTime:d("MAWTaskScheduleApi").getTaskScheduledTime,getThreadIdByJid:d("MAWGetThreadsInfoApi").getThreadIdByJid,getThreadInfoForDeletion:d("MAWGetThreadInfoForDeletionApi").getThreadInfoForDeletion,getThreadJidByChatId:d("MAWGetThreadJidByChatId").getThreadJidByChatId,getUnreadMsgs:d("MAWGetUnreadMsgsApi").getUnreadMsgs,getWorkerHeartbeat:d("MAWGetWorkerHeartbeatApi").getWorkerHeartbeat,handleConnectedAdminMsg:d("MAWHandleConnectedAdminMsgApi").handleConnectedAdminMsg,handleEchoMsgsRestore:d("MAWHandleEchoMsgsRestoreApi").handleEchoMsgsRestore,handleEncryptedBackupsSecret:d("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret,handleMediaDownload:d("MAWHandleMediaDownloadApi").handleMediaDownload,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,handleReachabilityErrorAdminMsg:d("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,handleSyncBeforeApplyPatch:d("MAWHandleSyncBeforeApplyPatch").handleSyncBeforeApplyPatch,handleSyncCompleted:d("MAWHandleSyncCompletedApi").handleSyncCompleted,handleSyncDelayApplyingPatchUntilUIUnblocks:d("MAWHandleSyncDelayApplyingPatchUntilUIUnblocks").handleSyncDelayApplyingPatchUntilUIUnblocks,handleSyncdFatal:d("MAWHandleSyncdFatal").handleSyncdFatal,leaveGroups:d("MAWLeaveGroupsApi").leaveGroups,linkReactionsToMsgs:d("MAWLinkReactionsToMsgsApi").linkReactionsToMsgs,loadRecentParticipants:d("MAWLoadRecentParticipantsApi").loadRecentParticipants,markAppDataDropped:d("MAWMarkAppDataDroppedApi").markAppDataDropped,markAppDataSendFailed:d("MAWMarkAppDataSendFailedApi").markAppDataSendFailed,markAppDataSent:d("MAWMarkAppDataSentApi").markAppDataSent,markMsgDropped:d("MAWMarkMsgDroppedApi").markMsgDropped,markMsgSendFailed:function(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("MAWMarkMsgDroppedApi").markMsgDropped(a));case 2:c=e.sent;if(!(c==="dropped")){e.next=7;break}return e.abrupt("return",d("WAResultOrError").makeResult());case 7:return e.abrupt("return",d("WAResultOrError").makeError("missing"));case 8:case"end":return e.stop()}},null,this)},markMsgSent:d("MAWMarkMsgSentApi").markMsgSent,markParticipantNeedsKey:d("MAWMarkParticipantNeedsKeyApi").markParticipantNeedsKey,markReadReceiptsSentUpTo:d("MAWMarkReadReceiptsSentUpToApi").markReadReceiptsSentUpTo,markSenderKeyAsRotated:d("MAWMarkSenderKeyAsRotatedApi").markSenderKeyAsRotated,markSenderKeyAsSent:d("MAWMarkSenderKeyAsSentApi").markSenderKeyAsSent,markThreadAsReadUpTo:d("MAWMarkThreadAsReadUpToApi").markThreadAsReadUpTo,predistributeSKDM:d("MAWPredistributeSKDMApi").predistributeSKDM,preEstablishSession:d("MAWPreEstablishSessionApi").preEstablishSession,processFutureProofMsgs:d("MAWProcessFutureproofMsgApi").processFutureProofMsgs,processSpamMsgs:d("MAWProcessSpamMsgApi").processSpamMsgs,removeExpiredDFMMsgsContent:d("MAWRemoveExpiredDFMMsgsContent").removeExpiredDFMMsgsContent,removeExpiredMsgsFromUI:d("MAWRemoveExpiredMsgsFromUIApi").removeExpiredMsgsFromUI,removeExpiredPendingStanzas:d("MAWRemoveExpiredPendingStanzas").removeExpiredPendingStanzas,removeExpiredUnsendMsgsContent:d("MAWRemoveExpiredUnsendMsgsContent").removeExpiredUnsendMsgsContent,removeExpiredXMAMsgsContent:d("MAWRemoveExpiredXMAMsgsContentApi").removeExpiredXMAMsgsContent,removeGroupInvites:d("MAWRemoveGroupInvitesApi").removeGroupInvites,revokeMsgs:d("MAWRevokeMsgsApi").revokeMsgs,runInBulkTransaction:d("MAWTransactor").runInBulkTransaction,sendSyncdKeyRequest:d("MAWSendSyncdKeyRequestApi").sendSyncdKeyRequest,sendSyncdKeyRotation:d("MAWSendSyncdKeyRotation").sendSyncdKeyRotation,setTaskScheduledTime:d("MAWTaskScheduleApi").setTaskScheduledTime,updateEphemeralityOnMarkMsgsFromOtherAsRead:d("MAWUpdateEphemeralityOnMarkMsgsFromOtherAsReadApi").updateEphemeralityOnMarkMsgsFromOtherAsRead,updateICDCForUser:d("MAWSetDevicesApi").updateICDCForUser,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,updateThreadFolder:d("MAWUpdateThreadFolderApi").updateThreadFolder,updateUserDevices:d("MAWUpdateUserDevicesApi").updateUserDevices,uploadRetroactiveMessageBatch:d("MAWUploadRetroactiveMessageBatchApi").uploadRetroactiveMessageBatch,uploadSyncExternalPatch:d("MAWUploadSyncExternalPatchApi").uploadSyncExternalPatch,writeAppDataReceipts:d("MAWWriteAppDataReceiptsApi").writeAppDataReceipts,writeAppDataRetry:d("MAWWriteAppDataRetryApi").writeAppDataRetry,writeCdnUrlAndBakeDownloadPayload:d("MAWHandleMediaDownloadAndRestoreApi").writeCdnUrlAndBakeDownloadPayload,writeDebugMsg:d("MAWDebugMsg").writeDebugMsg,writeForwardedMsg:d("MAWWriteForwardedMsgApi").writeForwardedMsg,writeGroupInvite:d("MAWWriteGroupInviteApi").writeGroupInvite,writeMetaSyncs:d("MAWWriteMetaSyncsApi").writeMetaSyncs,writeMsgReceipts:d("MAWWriteMsgReceiptsApi").writeMsgReceipts,writeMsgRetry:d("MAWWriteMsgRetryApi").writeMsgRetry,writeOutgoingAppData:d("MAWWriteOutgoingAppDataApi").writeOutgoingAppData,writeOutgoingMsg:d("MAWWriteOutgoingMsgApi").writeOutgoingMsg,writePeerReceiptsForMsgsNotFromMe:d("MAWWritePeerMsgReceiptsApi").writePeerReceiptsForMsgsNotFromMe,writeReactionMsg:d("MAWWriteReactionMsgApi").writeReactionMsg});g.dbCallbacks=a}),98);
__d("MAWCommonBridgeErrorTransport",["MAWBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("MAWBridge").getBridge().fireAndForget("event","fbErrorProxy",a)}g.log=a}),98);
__d("MAWCommonWebWorkerErrorLogging",["Env","ErrorGuard","ErrorPubSub","ErrorSetup","JSErrorLoggingConfig","MAWCommonBridgeErrorTransport","SiteData","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;c("ErrorGuard").skipGuardGlobal(c("Env").nocatch);c("ErrorSetup").setup({appId:c("JSErrorLoggingConfig").appId,client_revision:c("SiteData").client_revision,extra:c("JSErrorLoggingConfig").extra,loggingFramework:"worker",projectBlocklist:c("JSErrorLoggingConfig").projectBlocklist,report_source:c("JSErrorLoggingConfig").report_source,report_source_ref:c("JSErrorLoggingConfig").report_source_ref,sample_weight:(a=c("JSErrorLoggingConfig").sampleWeight)!=null?a:0,site_category:"armadillo-worker"},d("MAWCommonBridgeErrorTransport").log);self.addEventListener("unhandledrejection",function(a){a=a.reason;c("ErrorPubSub").reportError(c("getErrorSafe")(a))})}function b(){return c("ErrorPubSub").history}c("ErrorSetup").preSetup();g.init=a;g.getHistory=b}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("gkx")("6096")?(c("BanzaiLazyQueue").onQueue.add(function(){h(b)}),h(b)):c("BanzaiLazyQueue").onQueue.add(function(){b.queuePost.apply(this,arguments)})}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("MAWCommonMainWebWorker",["MAWBackend","MAWBridge","MAWCommonWebWorkerErrorLogging","MAWCommonWorkerActions","MAWDataSyncMiddlewareDeferred","MAWDeviceRegistrationInitWorker","MAWDeviceRegistrationTypes","MAWEBSwitch","MAWEncyptionIndexedDbV2","MAWGating","MAWHMACKey","MAWIndexedDb","MAWKeychainV2","MAWLocationHost","MAWPersistedEBLSDB","MAWQplProxy","MAWSignalIndexedDb","MAWVaultMaterials","MAWWebWorkerLogger","MAWWorkerCurrentUser","Promise","WACrossWorkerPortal","WADevToolsBridge","WALogger","WorkerMessagePort","WorkerSelf","err","gkx","qpl","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker receive invalid message: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing DevTool port. Not able to setup DevTool"]);i=function(){return a};return a}d("MAWWebWorkerLogger").setupWebWorkerWaLogger();d("MAWCommonWebWorkerErrorLogging").init();e=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;d("WorkerSelf").init(babelHelpers.assertThisInitialized(e));e.$BridgeAdaptor1=b;e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});return e}var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function j(a,e,f,g,h,j,k,l){var m,n,o,p,q,r,s,t;return b("regeneratorRuntime").async(function(u){while(1)switch(u.prev=u.next){case 0:d("MAWWorkerCurrentUser").setCurrentUser(j);d("MAWLocationHost").setLocationHost(k);u.next=4;return b("regeneratorRuntime").awrap(b("Promise").all([d("MAWSignalIndexedDb").makeSignalDB(a),d("MAWEncyptionIndexedDbV2").makeEncryptionDB(a)]));case 4:if(!d("MAWGating").isPersistedEBTableEnabled()){u.next=9;break}m=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521478580,"1409"),{bool:{eb_switch:c("MAWEBSwitch").isEnabled()},"int":{timestamp:Date.now()}});u.next=8;return b("regeneratorRuntime").awrap(d("MAWPersistedEBLSDB").makeEBLSDB(a));case 8:m.endSuccess();case 9:u.next=11;return b("regeneratorRuntime").awrap(d("MAWKeychainV2").fetchEARKeyChainForWorker(e));case 11:u.next=13;return b("regeneratorRuntime").awrap(d("MAWIndexedDb").makeDB(a,d("MAWKeychainV2").getDbEncryptionKey));case 13:if(!d("MAWGating").isBackendRegistrationEnabled()){u.next=20;break}u.next=16;return b("regeneratorRuntime").awrap(d("MAWDeviceRegistrationInitWorker").initDeviceRegistration());case 16:n=u.sent;o=n.registrationState;if(!(o===d("MAWDeviceRegistrationTypes").RegistrationStatesEnum.failed)){u.next=20;break}throw c("err")("registration_failed");case 20:p=d("MAWBridge").getBridge();u.next=23;return b("regeneratorRuntime").awrap(d("MAWCommonWorkerActions").loadAllRegistrationMetaInTransaction());case 23:q=u.sent;u.next=26;return b("regeneratorRuntime").awrap(d("MAWHMACKey").generateAndInsertHMACKey());case 26:r=u.sent,s=d("WACrossWorkerPortal").attachPortal(p,["event","threadEvent"],function(a,b){var c=a.length>0?a[a.length-1]:null;c!=null&&c.type==="request"&&c.content.name==="uiUpdate"&&c.content.arg.events&&b.type==="request"&&b.content.name==="uiUpdate"?Array.prototype.push.apply(c.content.arg.events,b.content.arg.events):a.push(b);return a}),d("MAWBackend").startWABackend(q,r,p,g(q.regInfo),h),s.setPort(f),c("gkx")("5147")&&(l==null?d("WALogger").ERROR(i()):(t=d("WACrossWorkerPortal").attachPortal(d("WADevToolsBridge").getDevToolBridge(),["devtool"],function(a,b){a.push(b);return a}),t.setPort(l)));case 31:case"end":return u.stop()}},null,this)}function a(a,e,f){c("MAWDataSyncMiddlewareDeferred")!=null&&a.addMessageListener("force-flush-data",function(){c("MAWDataSyncMiddlewareDeferred").forceFlushDataSyncQueue()}),a.addMessageListener("worker-setup",function(g){var i;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:if(!(g!=null&&g.type!=="worker-setup")){k.next=3;break}d("WALogger").WARN(h(),g);return k.abrupt("return");case 3:k.prev=3;k.next=6;return b("regeneratorRuntime").awrap(j(g.content.fbId,g.content.latestKeyVersionForEAR,a.getBridgePort(),e,f,g.content.currentUser,g.content.hostname,g.content.devToolMessageChannelPort2));case 6:i=g.content.vaultMaterials;if(!d("MAWGating").isVaultingEnabled()){k.next=11;break}if(!(i==null||i.encryptionKey==null||i.prefixAndSuffix==null)){k.next=10;break}throw c("err")("Vault materials was null in worker setup");case 10:d("MAWVaultMaterials").initializeVaultMaterials(i);case 11:a.postMessage({status:"success",type:"worker-setup"});k.next=18;break;case 14:k.prev=14;k.t0=k["catch"](3);a.postMessage({logs:d("MAWGating").isFlushingLogsFromWorkerInBulkEnabled()?d("MAWWebWorkerLogger").flushLogs():void 0,msg:k.t0.message,status:"failure",type:"worker-setup"});throw c("err")(k.t0);case 18:case"end":return k.stop()}},null,this,[[3,14]])})}g.BridgeAdaptor=e;g.initWorker=a}),98);
__d("PolarisCreationActionAddGeoTag",[],(function(a,b,c,d,e,f){"use strict";function a(a){return{type:"CREATION_GEO_TAG_ADDED",geoTag:a}}f.addGeoTag=a}),66);
__d("PolarisCreationLocationPage.react",["cx","fbt","IGRouter","PolarisCreationActionAddGeoTag","PolarisCreationLogger","PolarisCreationShell.react","PolarisGenericStrings","PolarisIGCoreBox","PolarisIGCorePressable","PolarisIGCoreSearchPanoOutlineIcon","PolarisIGCoreTextInput","PolarisIGCoreXPanoOutlineIcon","PolarisMediaConstants","PolarisNavigationalHeader.react","PolarisPageMetadata.react","PolarisReactRedux","PolarisSearchConstants","PolarisStoriesStrings","PolarisTypeaheadContainer.react","nullthrows","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k="CreationLocationPage",l=i._("Find a location");function m(a){var b=a.geoTag;a=a.onClick;return j.jsx("div",{className:"_aabt",onClick:a,role:"button",tabIndex:"0",children:j.jsxs("div",{className:"_aabu",children:[j.jsx("span",{className:"_aabv",children:b.name}),j.jsx("span",{className:"_aabw",children:b.address})]})})}m.displayName=m.name+" [from "+f.id+"]";e=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.$1=function(){c.props.history.replace("/create/details/")};c.$2=function(a){c.setState({pendingQuery:a.target.value})};c.$3=function(a){c.props.onGeoTagChanged(a),c.$1()};c.$4=function(){d("PolarisCreationLogger").logCreationEvent(c.props.sessionId,"location_search_cleared","location_page",c.props.mediaType),c.setState({pendingQuery:""})};c.$5=function(){d("PolarisCreationLogger").logCreationEvent(c.props.sessionId,"location_search_performed","location_page",c.props.mediaType)};c.$6=function(a){d("PolarisCreationLogger").logCreationEvent(c.props.sessionId,"suggested_location_added","location_page",c.props.mediaType),c.$3(a)};c.$7=function(a,b){d("PolarisCreationLogger").logCreationEvent(c.props.sessionId,"searched_location_added","location_page",c.props.mediaType),a.type===d("PolarisSearchConstants").LOCATION_RESULT&&c.$3(a)};c.state={pendingQuery:""};return c}var e=b.prototype;e.componentDidMount=function(){d("PolarisCreationLogger").logCreationEvent(this.props.sessionId,"location_page_loaded","location_page",this.props.mediaType)};e.render=function(){var a=this,b=this.props.suggestedGeoTags;return j.jsxs(c("PolarisCreationShell.react"),{className:"_aabx",children:[j.jsx(c("PolarisPageMetadata.react"),{id:k}),j.jsx(c("PolarisNavigationalHeader.react"),{className:"_aaby",onCancel:this.$1,title:i._("Add Location")}),j.jsx("div",{className:"_aabz",children:j.jsx(c("PolarisIGCoreTextInput"),{autoComplete:"off",endAdornment:!!this.state.pendingQuery.length&&j.jsx(c("PolarisIGCorePressable"),{onPress:this.$4,children:j.jsx(c("PolarisIGCoreXPanoOutlineIcon"),{alt:d("PolarisStoriesStrings").ALT_TEXT_CLOSE_ICON,size:16})}),name:"location-query",onChange:this.$2,onFocus:this.$5,placeholder:l,startAdornment:j.jsx(c("PolarisIGCoreBox"),{marginStart:2,children:j.jsx(c("PolarisIGCoreSearchPanoOutlineIcon"),{alt:d("PolarisGenericStrings").SEARCH_TEXT,size:16})}),value:this.state.pendingQuery})}),j.jsx(c("PolarisTypeaheadContainer.react"),{currentLocation:this.props.searchFromLocation,cursorIndex:this.state.pendingQuery.length,initialSearchContext:d("PolarisSearchConstants").SEARCH_CONTEXT.LOCATION,inputString:this.state.pendingQuery,onResultSelect:this.$7,showResultsCondensed:!1,useSearchTriggers:!1}),b&&!this.state.pendingQuery.length&&b.map(function(b,c){return j.jsx(m,{geoTag:b,onClick:function(){return a.$6(b)}},c)})]})};return b}(j.Component);function a(a){a=a.creation;var b=a.finalizedMedia,e=a.sessionId;a=a.sourceImage;var f=(a==null?void 0:a.dataURL)===void 0?d("PolarisMediaConstants").MediaTypes.VIDEO:d("PolarisMediaConstants").MediaTypes.IMAGE;return{mediaType:f,sessionId:e,searchFromLocation:c("nullthrows")(a).location||b.currentLocation,suggestedGeoTags:b.suggestedGeoTags}}function b(a){return{onGeoTagChanged:function(b){a(d("PolarisCreationActionAddGeoTag").addGeoTag(b))}}}h=d("IGRouter").withIGRouter(d("PolarisReactRedux").connect(a,b)(e));g.PAGE_ID=k;g.SuggestedLocationItem=m;g.CreationLocationPage=h}),98);
__d("PolarisCreateLocationRoot.react",["PolarisCreationLocationPage.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsx("div",{style:{height:"100vh"},children:h.jsx(d("PolarisCreationLocationPage.react").CreationLocationPage,{})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PolarisAPICreationLoadSuggestedGeoTags",["PolarisInstapi"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("PolarisInstapi").apiGet("/api/v1/web/location_search/",{query:{latitude:a.latitude,longitude:a.longitude}}).then(function(a){return a.data})}g.creationLoadSuggestedGeoTags=a}),98);
__d("PolarisCreationActionLoadSuggestedGeoTags",["PolarisAPICreationLoadSuggestedGeoTags"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,c){return d("PolarisAPICreationLoadSuggestedGeoTags").creationLoadSuggestedGeoTags(a).then(function(a){b({type:"CREATION_SUGGESTED_GEO_TAGS_LOADED",suggestedGeoTags:a.venues})})}}g.loadSuggestedGeoTags=a}),98);
__d("PolarisCreationActionRenderCroppedPhoto",["invariant","PolarisImageFactory","PolarisrenderCroppedImage","Promise"],(function(a,b,c,d,e,f,g,h){"use strict";function a(){return function(a,d){d=d().creation;var e=d.croppedImage,f=d.sourceImage,g=c("PolarisImageFactory").createImage();f!=null||h(0,50427);e!=null||h(0,50428);return new(b("Promise"))(function(b){g.onload=function(){var d=c("PolarisrenderCroppedImage")({sourceImg:g,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,imageWidth:f.width,imageHeight:f.height,scaleFactor:e.scaleFactor,rotationAngle:e.rotationAngle});b(a({type:"CREATION_CROP_RENDERED",canvas:d}))},g.src=f.dataURL})}}g.renderCroppedPhoto=a}),98);
__d("PolarisCreationActionChangeCrop",[],(function(a,b,c,d,e,f){"use strict";function a(a){return{type:"CREATION_PHOTO_CROP_CHANGED",croppedImage:a}}f.changeCrop=a}),66);
__d("PolarisCroppableImage.react",["cx","fbt","PolarisCreationCompositionGrid.react","Polarisprefix","react","warning"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react");function a(a){var b=a.disableAnimation,d=a.height,e=a.hideGridLines,f=a.mirrored,g=a.offsetLeft,h=a.offsetTop,k=a.onExpandTap,l=a.onRotateTap,m=a.onTouchEnd,n=a.onTouchMove,o=a.onTouchStart,p=a.rotationAngle,q=a.scaleFactor,r=a.src;a=a.width;var s=q*d/a,t=-1*q*(g/a);q<1&&(c("warning")(s>=1,"Image should fill box in at least one dimension"),t=(1-q)/2);var u=-1*s*(h/d);s<1&&(u=(1-s)/2);var v=Math.min.bind(Math,1);v=v(q)/v(s);var w=[],x;if(v===1){var y=Math.min(a,d);g=(g+y/2)/a*100;h=(h+y/2)/d*100;x=g+"% "+h+"%"}f&&w.push("scaleX(-1)");w.push("rotate("+p+"deg)");y=w.join(" ")||void 0;var z;b!==!0&&(z="all 0.2s ease");return j.jsx("div",{className:"_abf8",children:j.jsxs("div",{className:"_abf9",children:[j.jsx("div",{className:"_abfa",onTouchEnd:m,onTouchMove:n,onTouchStart:o,style:c("Polarisprefix")({backgroundImage:"url("+r+")",position:"absolute",height:s*100+"%",left:t*100+"%",top:u*100+"%",width:q*100+"%",transition:z,transform:y,transformOrigin:x})}),e!==!0&&v===1&&j.jsx(c("PolarisCreationCompositionGrid.react"),{}),d!==a&&k&&j.jsx("button",{className:"_abfb",onClick:k,children:j.jsx("span",{className:"_a9_u _9z_k",children:i._("Expand")})}),l&&j.jsx("button",{className:"_abfc",onClick:l,children:j.jsx("span",{className:"_a9_u _9z_m",children:i._("Rotate")})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PolarisCreationCroppingUnit.react",["cx","invariant","PolarisCreationActionChangeCrop","PolarisCreationLogger","PolarisCreationUtils","PolarisCroppableImage.react","PolarisIGCoreSpinner","PolarisMediaConstants","PolarisReactRedux","nullthrows","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=4/5,l=1.91;function m(){return j.jsx(c("PolarisIGCoreSpinner"),{position:"absolute",size:"medium"})}m.displayName=m.name+" [from "+f.id+"]";e=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var e;e=a.call(this,b)||this;e.isSquareCrop=function(){var a=e.props,b=a.croppedImage,c=a.imageHeight;a=a.imageWidth;c=b.scaleFactor*c/a;a=Math.min.bind(Math,1);b=a(b.scaleFactor)/a(c);return Math.abs(b-1)<1e-4};e.$6=function(){var a=e.props,b=a.croppedImage,c=a.imageHeight,f=a.imageWidth,g=a.onCropChanged;a=a.sessionId;e.state.expandButtonClicked||d("PolarisCreationLogger").logCreationEvent(a,"expand_button_clicked","crop_page",d("PolarisMediaConstants").MediaTypes.IMAGE);if(!e.isSquareCrop()){a=d("PolarisCreationUtils").getDefaultCrop(f,c);g(babelHelpers["extends"]({},b,a));e.setState({expandButtonClicked:!0})}else g(babelHelpers["extends"]({},b,e.$5(0,0,e.$7(),b.rotationAngle))),e.setState({expandButtonClicked:!0})};e.$7=function(){var a=e.props,b=a.imageHeight;a=a.imageWidth;return a>b?1:a/b};e.$8=function(){e.state.rotateButtonClicked||d("PolarisCreationLogger").logCreationEvent(e.props.sessionId,"rotate_button_clicked","crop_page",d("PolarisMediaConstants").MediaTypes.IMAGE);var a=e.props,b=a.croppedImage;a=a.onCropChanged;var c=b.rotationAngle-90,f=e.isSquareCrop()?{}:e.$5(0,0,e.$7(),c);a(babelHelpers["extends"]({},b,{rotationAngle:c},f));e.setState({rotateButtonClicked:!0})};e.$9=function(a){e.setState({disableAnimation:!1});a.preventDefault();if(!e.isSquareCrop()||a.touches.length>1||e.props.imageHeight===e.props.imageWidth){e.$1=e.$2=null;e.$3=e.$4=null;return}e.$1=a.touches[0].clientX;e.$2=a.touches[0].clientY;a=e.props.croppedImage;e.$3=a.offsetLeft;e.$4=a.offsetTop};e.$10=function(a){if(e.$1===null||e.$2===null)return;e.setState({disableAnimation:!0});var b=e.props,d=b.croppedImage,f=b.imageHeight,g=b.imageWidth,h=b.onCropChanged;b=b.viewportWidth;var i=a.touches[0].clientY-c("nullthrows")(e.$2),j=a.touches[0].clientX-c("nullthrows")(e.$1),k=d.rotationAngle%180===0?j:i;i=d.rotationAngle%180===0?i:j;j=d.rotationAngle===180||d.rotationAngle===270?-1:1;var l=d.rotationAngle===180||d.rotationAngle===90?-1:1;g=Math.min(g,f)/b;f=k*g*j;b=i*g*l;k=c("nullthrows")(e.$3)-f;j=c("nullthrows")(e.$4)-b;h(babelHelpers["extends"]({},d,{offsetTop:j,offsetLeft:k}));a.preventDefault()};e.$11=function(a){e.setState({disableAnimation:!1});a.preventDefault();if(e.$1!=null||e.$1!==0||e.$2!=null||e.$2!==0){e.$1=e.$2=null;e.$3=e.$4=null;a=e.props;var b=a.croppedImage,c=a.imageHeight,f=a.imageWidth;a=a.onCropChanged;var g=Math.min(f,c);f=f-g;c=c-g;g=Math.min(f,Math.max(0,b.offsetLeft));f=Math.min(c,Math.max(0,b.offsetTop));a(babelHelpers["extends"]({},b,{offsetLeft:g,offsetTop:f}));e.state.imageRepositioned||(d("PolarisCreationLogger").logCreationEvent(e.props.sessionId,"image_repositioned","crop_page",d("PolarisMediaConstants").MediaTypes.IMAGE),e.setState({imageRepositioned:!0}))}};e.state={rotateButtonClicked:!1,expandButtonClicked:!1,imageRepositioned:!1,disableAnimation:!1};return e}var e=b.prototype;e.$5=function(a,b,c,d){a=a;b=b;var e=this.props,f=e.imageHeight;e=e.imageWidth;d=e>f&&d%180===0||f>e&&d%180!==0?l:1/k;var g;e>f?g=e/(d*f):g=e/(d*e);g=Math.max(c,g);if(c!==g){d=c*f/e;c=e/Math.max(1,c);d=f/Math.max(1,d);c=a+c/2;d=b+d/2;var h=g*f/e;e=e/Math.max(1,g);f=f/Math.max(1,h);a=c-e/2;b=d-f/2}return{offsetLeft:a,offsetTop:b,scaleFactor:g}};e.render=function(){var a=this.props,b=a.croppedImage,d=a.hideControls,e=a.imageDataURL,f=a.imageHeight,g=a.imageWidth;a=a.isProcessing;return j.jsx("div",{className:"_abqh"+(this.props.isVisible?"":" _adb9"),children:j.jsxs("div",{className:"_abqi",children:[a&&j.jsx(m,{}),e&&j.jsx(c("PolarisCroppableImage.react"),{disableAnimation:this.state.disableAnimation,height:f,hideGridLines:d,mirrored:b.mirrored,offsetLeft:b.offsetLeft,offsetTop:b.offsetTop,onExpandTap:d===!0?void 0:this.$6,onRotateTap:d===!0?void 0:this.$8,onTouchEnd:d===!0?void 0:this.$11,onTouchMove:d===!0?void 0:this.$10,onTouchStart:d===!0?void 0:this.$9,rotationAngle:b.rotationAngle,scaleFactor:b.scaleFactor,src:e,width:g})]})})};return b}(j.Component);function a(a){var b=a.creation,c=b.croppedImage,d=b.sessionId;b=b.sourceImage;a=a.displayProperties.viewportWidth;b!=null||i(0,50427);c!=null||i(0,50428);return{croppedImage:c,imageDataURL:b.dataURL,imageHeight:b.height,imageWidth:b.width,isProcessing:b.isProcessing,sessionId:d,viewportWidth:a}}function b(a){return{onCropChanged:function(b){a(d("PolarisCreationActionChangeCrop").changeCrop(b))}}}h=d("PolarisReactRedux").connect(a,b)(e);g["default"]=h}),98);
__d("PolarisCreationEditNav.react",["cx","fbt","PolarisIGCoreBox","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=i._("Filter"),l=i._("Edit");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var d=b.prototype;d.render=function(){return!this.props.hasFilters?null:j.jsx("div",{className:"_abpw",children:j.jsxs("div",{className:"_abpx",children:[j.jsx("button",{className:"_abpy"+(this.props.activeTab==="filter"?" _abpz":""),onClick:this.props.onFilterClick,role:"menuitem",tabIndex:"0",children:j.jsx(c("PolarisIGCoreBox"),{flex:"grow",justifyContent:"center",children:k})},"filter"),j.jsx("button",{className:"_abpy"+(this.props.activeTab==="edit"?" _abpz":""),onClick:this.props.onEditClick,role:"menuitem",tabIndex:"0",children:j.jsx(c("PolarisIGCoreBox"),{flex:"grow",justifyContent:"center",children:l})},"edit")]})})};return b}(j.Component);g["default"]=a}),98);
__d("PolarisCreationActionSetFilterName",[],(function(a,b,c,d,e,f){"use strict";function a(a){return{type:"CREATION_SET_FILTER_NAME",filterName:a}}f.setFilterName=a}),66);
__d("PolarisCreationFilterThumbnail.react",["cx","fbt","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=function(){c.props.onClick(c.props.name)},b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.render=function(){var a=this.props,b=a.filterBuilder,c=a.isSelected;a=a.pixelRatio;return j.jsxs("button",{className:"_abew",onClick:this.$1,children:[j.jsx("div",{className:"_abex"+(c?" _abey":""),children:b.getName()}),j.jsx("img",{alt:i._("Filter: {filter title}",[i._param("filter title",b.getName())]),className:"_abez",src:b.getThumbnail(a)})]})};return b}(j.PureComponent);g["default"]=a}),98);
__d("PolarisFilteredImage.react",["cx","PolarisBatchDOM","PolarisFilterGLContext","PolarisTimer","PolarisgetBlobFromCanvas","Promise","emptyFunction","nullthrows","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j=1080;a=function(a){babelHelpers.inheritsLoose(e,a);function e(){var b,e;for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];return(b=e=a.call.apply(a,[this].concat(g))||this,e.state={cssHeight:0,cssWidth:0,imageHeight:j,imageWidth:j},e.$4=null,e.getBlob=function(){return e.$5().then(function(a){return a.draw()}).then(function(){return c("PolarisgetBlobFromCanvas")(c("nullthrows")(e.$2))})},e.$7=function(){var a=e.props,b=a.onDraw;a=a.onLogTiming;var c=e.$4;c!=null&&c>0&&(a("loadWebGL",d("PolarisTimer").now()-c),e.$4=null);b()},b)||babelHelpers.assertThisInitialized(e)}var f=e.prototype;f.componentDidMount=function(){var a=this;d("PolarisBatchDOM").measure(function(){if(!a.$3)return;a.$2.addEventListener("webglcontextlost",function(b){a.props.onError(b.type),a.$1&&(a.$1.stopDraw(),a.$1=null)});a.$2.addEventListener("webglcontextrestored",function(){a.$5()});a.$4=d("PolarisTimer").now();a.$5()})};f.componentDidUpdate=function(a,b){var c=this,d=a.filter,e=a.filterStrength,f=a.src;this.$5().then(function(a){d!==c.props.filter&&a.setFilter(c.props.filter||"normal");e!==c.props.filterStrength&&a.setParam("filterStrength",c.props.filterStrength);var g=c.state,h=g.cssHeight;g=g.cssWidth;return h===0&&g===0||(b.cssHeight===0||b.cssWidth===0)&&h>0&&g>0||d!==c.props.filter||f!==c.props.src?c.$6(a,c.props.src):null})};f.componentWillUnmount=function(){this.$1&&this.$1.destroy()};f.$5=function(){if(!this.$1)try{var a=new(c("PolarisFilterGLContext"))(c("nullthrows")(this.$2));a.init();a.setOnDraw(this.$7);a.setFilter(this.props.filter);a.setParam("filterStrength",this.props.filterStrength);a.startDraw();this.$6(a,this.props.src);this.$1=a}catch(a){this.props.onError(a==null?void 0:a.type);return b("Promise").reject(a)}return b("Promise").resolve(this.$1)};f.$6=function(a,b){var d=this;return a.setImage(b).then(function(a){a[0];a=a[1];var b=c("nullthrows")(d.$3).getBoundingClientRect(),e=b.height;b=b.width;a.width>a.height?e=a.height/a.width*b:a.width<a.height&&(b=a.width/a.height*e);d.setState({cssHeight:e,cssWidth:b,imageHeight:a.height,imageWidth:a.width})})};f.render=function(){var a=this,b=this.state,c=b.cssHeight,d=b.cssWidth,e=b.imageHeight;b=b.imageWidth;var f=j,g=j;b>e?g=e/b*j:f=b/e*j;return i.jsx("div",{className:"_abqk",ref:function(b){return a.$3=b},children:i.jsx("div",{className:"_abql",children:i.jsx("canvas",{className:"_abqm",height:g,ref:function(b){return a.$2=b},style:{width:d,height:c},width:f})})})};return e}(i.PureComponent);a.defaultProps={filter:"normal",filterStrength:1,onDraw:c("emptyFunction"),onError:c("emptyFunction")};g["default"]=a}),98);
__d("PolarisCreationFilteringUnit.react",["cx","invariant","PolarisCreationActionSetFilterName","PolarisCreationFilterThumbnail.react","PolarisCreationLogger","PolarisFilteredImage.react","PolarisFilters","PolarisIGCoreSpinner","PolarisIGVirtualList.react","PolarisMediaConstants","PolarisReactRedux","PolarisgetBlobFromCanvas","nullthrows","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=1,l=8,m=106;e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,e;for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];return(b=e=a.call.apply(a,[this].concat(g))||this,e.state={filterPickerClicked:!1,shouldHideFilter:!1},e.getBlob=function(){return e.props.filterName==="normal"?e.props.onCropRender().then(function(){var a=c("nullthrows")(e.props.croppedCanvas);return c("PolarisgetBlobFromCanvas")(a)}):c("nullthrows")(e.$1).getBlob()},e.$3=function(a){if(a===e.props.filterName)return;e.state.filterPickerClicked||d("PolarisCreationLogger").logCreationEvent(e.props.sessionId,"filter_picker_clicked","filter_page",d("PolarisMediaConstants").MediaTypes.IMAGE);e.setState({filterPickerClicked:!0});e.props.croppedCanvas||e.props.onCropRender();e.props.onFilterChange(a);e.$2&&e.$2.forceUpdate()},e.$4=function(){e.props.onDraw&&e.props.onDraw()},e.$5=function(){e.setState({shouldHideFilter:!0})},e.$6=function(){e.setState({shouldHideFilter:!1})},e.$7=function(a){d("PolarisCreationLogger").logContextLost("filter_page",a)},e.$8=function(){var a=e.$2;if(a==null)return;var b=d("PolarisFilters").FILTER_NAMES.indexOf(e.props.filterName);a.scrollToItem(b)},e.$9=function(a){a=a.index;var b=e.props,f=b.filterName;b=b.pixelRatio;var g=d("PolarisFilters").FILTER_NAMES[a];return j.jsx(c("PolarisCreationFilterThumbnail.react"),{filterBuilder:d("PolarisFilters").FILTERS[g],isSelected:f===g,name:g,onClick:e.$3,pixelRatio:b},a)},b)||babelHelpers.assertThisInitialized(e)}var e=b.prototype;e.shouldComponentUpdate=function(a,b){return this.props.croppedCanvas!==a.croppedImage||this.props.filterName!==a.filterName||this.props.filterParams!==a.filterParams||this.props.isLoading!==a.isLoading||this.state.filterPickerClicked!==b.filterPickerClicked||this.state.shouldHideFilter!==b.shouldHideFilter};e.render=function(){var a=this,b=this.state.shouldHideFilter,e=this.props,f=e.croppedCanvas,g=e.filterName,h=e.filterParams,i=e.isLoading,n=e.onLogTiming;e=e.viewportWidth;h=h.filterStrength;e=Math.max(l,Math.ceil(e/m));return j.jsxs("div",{className:"_abpr"+(this.props.isVisible?"":" _ae_q"),children:[j.jsxs("div",{className:"_abps",onTouchEnd:this.$6,onTouchStart:this.$5,children:[i&&j.jsx("div",{className:"_abpt",children:j.jsx(c("PolarisIGCoreSpinner"),{position:"absolute",size:"medium"})}),f?j.jsx(c("PolarisFilteredImage.react"),{filter:g,filterStrength:b?0:h,onDraw:this.$4,onError:this.$7,onLogTiming:n,ref:function(b){return a.$1=b},src:f}):j.jsx("div",{className:"_abpu"})]}),j.jsx(c("PolarisIGVirtualList.react"),{className:"_abpv",containerSize:"auto",direction:"horizontal",estimatedItemSize:100,initialRenderCount:e,itemCount:d("PolarisFilters").FILTER_NAMES.length,onInitialize:this.$8,overscanCount:k,pageletName:"creation_filtering_unit",ref:function(b){return a.$2=b},renderer:this.$9})]})};return b}(j.Component);function a(a){var b=a.creation,c=b.cropRenderedCanvas,d=b.croppedImage,e=b.filter,f=b.sessionId;b=b.sourceImage;b!=null||i(0,50427);return{sessionId:f,croppedImage:d,imageHeight:b.height,imageWidth:b.width,isProcessing:b.isProcessing,croppedCanvas:c,filterName:e.filterName,filterParams:e.params,pixelRatio:a.displayProperties.pixelRatio,viewportWidth:a.displayProperties.viewportWidth}}function b(a,b){return{onFilterChange:function(c){a(d("PolarisCreationActionSetFilterName").setFilterName(c)),typeof b.onFilterChange==="function"&&b.onFilterChange(c)}}}f=d("PolarisReactRedux").connect(a,b,null,{forwardRef:!0})(e);g["default"]=f}),98);
__d("PolarisclearTimeout",["TimerStorage"],(function(a,b,c,d,e,f){var g=a.clearTimeout.nativeBackup||a.clearTimeout;e.exports=function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];b("TimerStorage").unset(b("TimerStorage").TIMEOUT,d[0]);return Function.prototype.apply.call(g,a,d)}}),null);
__d("PolariscreateObjectURL",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=window.URL||window.webkitURL;return b.createObjectURL(a)}f["default"]=a}),66);
__d("PolarisCreationStyleImageUnit.react",["cx","PolarisCreationActionLoadSuggestedGeoTags","PolarisCreationActionRenderCroppedPhoto","PolarisCreationActionResetState","PolarisCreationActionStagePhoto","PolarisCreationCameraLogger","PolarisCreationCroppingUnit.react","PolarisCreationEditNav.react","PolarisCreationFilteringUnit.react","PolarisCreationLogger","PolarisCreationMode","PolarisCreationStrings","PolarisCreationUtils","PolarisEventListener","PolarisMediaConstants","PolarisMonitorErrors","PolarisNavigationActions","PolarisNavigationalHeader.react","PolarisPerformanceLogger","PolarisReactRedux","PolarisTimer","PolarisUserActionSetProfilePic","PolarisUserActionShowChangeProfilePicConfirmDialog","PolarisclearTimeout","PolariscreateObjectURL","PolarisgetBlobFromCanvas","PolarisisWebGLSupported","Polarisunexpected","gkx","nullthrows","react","setTimeoutBlue"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j="CreationStylePage";e=function(a){babelHelpers.inheritsLoose(b,a);b.getDerivedStateFromProps=function(a,b){return b.activeTab==="edit"&&a.croppedImage!==b.croppedImage?{croppedImage:a.croppedImage,hideCroppingUnit:!1}:null};function b(b){var e;e=a.call(this,b)||this;e.$6=0;e.$7=function(){c("gkx")("4779")||d("PolarisCreationLogger").logCreationEvent(e.props.sessionId,"quit_style_page","style_page",d("PolarisMediaConstants").MediaTypes.IMAGE),d("PolarisCreationCameraLogger").logFeedCreationEndCameraSession({sessionId:c("nullthrows")(e.props.sessionId)})};e.$8=function(){var a=e.props,b=a.onCropRender,c=a.onLogTiming,f=d("PolarisTimer").now();return b().then(function(){c("creationCropImage",d("PolarisTimer").now()-f)})};e.$9=function(){if(!e.$10())return e.$8().then(function(){var a=c("nullthrows")(e.props.croppedCanvas);return c("PolarisgetBlobFromCanvas")(a)});else if(e.state.activeTab==="filter")return e.$1.getBlob();return e.$8().then(function(){return e.$1.getBlob()})};e.$11=function(a){if(e.$12())e.props.showChangeProfilePicConfirmDialog?e.props.onShowChangeProfilePicConfirmDialog(a,"creationPage","creation"):e.props.onSetProfilePic(a,"creationPage","creation"),e.props.history.goBack();else{var b=c("PolariscreateObjectURL")(a);e.props.onFinish(a,b,e.props.gpsLocation);e.props.history.push("/create/details/")}e.props.onLogTiming("creationRenderFinal",d("PolarisTimer").now()-e.$5);e.$5=0};e.$13=function(){e.setState({activeTab:"edit"})};e.$14=function(){e.setState({activeTab:"filter"}),e.$8()};e.$15=function(a){e.$6=d("PolarisTimer").now(),e.setState({filterName:a,showLoadingSpinner:a!=="normal"})};e.$16=function(){if(e.$6>0){var a=d("PolarisTimer").now()-e.$6;e.props.onLogTiming("creationLoadFilter",a);e.$6=0}c("PolarisclearTimeout")(e.$3);e.$3=c("setTimeoutBlue")(function(){e.$1&&e.setState({hideCroppingUnit:!0,showLoadingSpinner:!1})},50)};e.$17=function(){e.props.onCancel()};e.$18=function(){var a=e.props.sessionId;e.$5=d("PolarisTimer").now();d("PolarisCreationLogger").logCreationEvent(a,"style_page_click_next","style_page",d("PolarisMediaConstants").MediaTypes.IMAGE);e.$9().then(e.$11)["catch"](function(a){a instanceof Error?(a.name="[Filters] "+a.name,d("PolarisMonitorErrors").logError(a)):c("Polarisunexpected")("[Filters] could not render cropped filtered image.")})};e.$19=function(){return e.state.activeTab==="edit"||!e.state.hideCroppingUnit};e.$20=function(){return e.state.activeTab==="filter"};e.$21=function(){return e.$12()};e.$22=function(){return e.$12()?!1:e.$20()};e.$12=function(){return e.props.creationMode===d("PolarisCreationMode").CreationMode.PROFILE_PIC};e.setFilteringUnitRef=function(a){a!=null&&(e.$1=a)};e.state={activeTab:"edit",filterName:"",showLoadingSpinner:!1,croppedImage:void 0,hideCroppingUnit:!!e.props.croppedCanvas};return e}var e=b.prototype;e.componentDidMount=function(){c("gkx")("4779")||d("PolarisCreationLogger").logStylePageLoaded(this.props.sessionId,"style_page_loaded","style_page"),d("PolarisCreationCameraLogger").logFeedCreationFeedGalleryStartEditSession({sessionId:c("nullthrows")(this.props.sessionId)}),this.$2=c("PolarisEventListener").add(window,"beforeunload",this.$7),this.$4=d("PolarisTimer").now()};e.componentWillUnmount=function(){this.$2&&this.$2.remove(),c("PolarisclearTimeout")(this.$3),d("PolarisCreationUtils").hasCreationUrl(this.props.history.location)||this.props.onUnmount()};e.$10=function(){return d("PolarisisWebGLSupported").isWebGLSupported()};e.render=function(){var a=this.props,b=a.isProcessing;a=a.onLogTiming;return i.jsxs(i.Fragment,{children:[i.jsx(c("PolarisNavigationalHeader.react"),{className:"_abqb",nextStepDisabled:b||this.state.showLoadingSpinner,nextStepLabel:this.$12()?d("PolarisCreationStrings").NAV_SAVE:d("PolarisCreationStrings").NAV_NEXT,onCancel:this.$17,onNextStep:this.$18,title:this.$12()?d("PolarisCreationStrings").TITLE_PROFILE_PIC:d("PolarisCreationStrings").TITLE_NEW_PHOTO_POST}),i.jsxs("div",{className:"_abqc",children:[this.$21()&&i.jsx("div",{className:"_abqd"}),this.$10()&&i.jsx(c("PolarisCreationFilteringUnit.react"),{isLoading:this.state.showLoadingSpinner,isVisible:this.$20(),onCancel:this.$17,onCropRender:this.$8,onDraw:this.$16,onFilterChange:this.$15,onLogTiming:a,ref:this.setFilteringUnitRef}),i.jsx(c("PolarisCreationCroppingUnit.react"),{hideControls:this.$22(),isVisible:this.$19(),onFilterClick:this.$14})]}),i.jsx(c("PolarisCreationEditNav.react"),{activeTab:this.state.activeTab,hasFilters:this.$10(),onEditClick:this.$13,onFilterClick:this.$14})]})};return b}(i.Component);function a(a){return{creationMode:a.creation.creationMode,croppedCanvas:a.creation.cropRenderedCanvas,croppedImage:a.creation.croppedImage,gpsLocation:c("nullthrows")(a.creation.sourceImage).location,isProcessing:c("nullthrows")(a.creation.sourceImage).isProcessing,sessionId:a.creation.sessionId,showChangeProfilePicConfirmDialog:a.creation.showChangeProfilePicConfirmDialog,onLogTiming:function(b,c){d("PolarisPerformanceLogger").logComponentPerformanceTiming({component:j,eventType:b,pageId:a.navigation.pageIdentifier,route:a.navigation.route,timeTaken:c})}}}function b(a){return{onCancel:function(){a(d("PolarisNavigationActions").returnToEntrypoint())},onShowChangeProfilePicConfirmDialog:function(b,c,e){a(d("PolarisUserActionShowChangeProfilePicConfirmDialog").showChangeProfilePicConfirmDialog(b,c,e))},onUnmount:function(){return a(d("PolarisCreationActionResetState").resetState())},onCropRender:function(){return a(d("PolarisCreationActionRenderCroppedPhoto").renderCroppedPhoto())},onFinish:function(b,c,e){a(d("PolarisCreationActionStagePhoto").stagePhoto(b,c)),e&&a(d("PolarisCreationActionLoadSuggestedGeoTags").loadSuggestedGeoTags(e))},onSetProfilePic:function(b,c,e){a(d("PolarisUserActionSetProfilePic").setProfilePic(b,c,e))}}}f=d("PolarisReactRedux").connect(a,b)(e);g["default"]=f}),98);
__d("PolarisCreationStyleVideoUnit.react",["cx","PolarisCreationActionResetState","PolarisCreationStrings","PolarisCreationUtils","PolarisGenericStrings","PolarisNavigationActions","PolarisNavigationalHeader.react","PolarisReactRedux","nullthrows","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react");e=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var d;d=a.call(this,b)||this;d.$1=function(){d.props.onCancel()};d.$2=function(){d.props.history.push("/create/details/")};d.$3=function(a){d.videoRef=a};d.$4=function(a){(a.key==="Enter"&&!a.shiftKey||a.key===" ")&&d.$5()};d.$5=function(){c("nullthrows")(d.videoRef).paused?d.play():d.pause()};d.$6=function(){d.setState({isPlaying:!1,showPosterImage:!0}),d.pause()};d.pause=function(){c("nullthrows")(d.videoRef).pause(),d.setState({isPlaying:!1})};d.play=function(){c("nullthrows")(d.videoRef).play(),d.setState({isPlaying:!0,showPosterImage:!1})};d.getWrapperHeightStyle=function(a,b){a=a/b*100;return{paddingBottom:"calc("+a+"% - 1px)"}};d.state={isPlaying:!1,showPosterImage:!0,photoHeight:0,photoWidth:0};return d}b.getDerivedStateFromProps=function(a,b){var c=a.coverPhoto,d=c.uploadMediaHeight;c=c.uploadMediaWidth;var e=b.photoHeight;b=b.photoWidth;return d!==e||c!==b?{photoHeight:a.coverPhoto.uploadMediaHeight,photoWidth:a.coverPhoto.uploadMediaWidth}:null};var e=b.prototype;e.componentWillUnmount=function(){d("PolarisCreationUtils").hasCreationUrl(this.props.history.location)||this.props.onUnmount()};e.render=function(){var a=this.props.coverPhoto.dataURL,b=this.state,e=b.photoHeight;b=b.photoWidth;var f=c("nullthrows")(this.props.sourceVideo),g=f.dataURL;f=f.uploadMediaHeight;var h=this.state,j=h.isPlaying;h=h.showPosterImage;f=f>e;return i.jsxs(i.Fragment,{children:[i.jsx(c("PolarisNavigationalHeader.react"),{className:"_abe-",nextStepLabel:d("PolarisCreationStrings").NAV_NEXT,onCancel:this.$1,onNextStep:this.$2,title:d("PolarisCreationStrings").TITLE_NEW_VIDEO_POST}),i.jsx("div",{className:"_abe_",children:i.jsxs("div",{className:"_abf0",onClick:this.$5,onKeyPress:this.$4,role:"presentation",style:this.getWrapperHeightStyle(e,b),children:[i.jsx("video",{className:(f?"":"_abf1")+(f?" _abf2":""),controls:!1,controlsList:"nodownload nofullscreen noremoteplayback",onEnded:this.$6,poster:a,ref:this.$3,src:g}),h&&i.jsx("img",{alt:"",className:"_abf3",src:a}),i.jsx("span",{className:"_abf4"+(j?"":" _abf5")+" _abf6 _9zwu",role:"button",tabIndex:"0",children:i.jsx("span",{className:"_abf7",children:d("PolarisGenericStrings").ASSISTIVE_TEXT_PLAY_BUTTON})})]})})]})};return b}(i.PureComponent);function a(a){return{sourceVideo:a.creation.sourceVideo,coverPhoto:a.creation.coverPhoto}}function b(a){return{onCancel:function(){a(d("PolarisNavigationActions").returnToEntrypoint())},onUnmount:function(){return a(d("PolarisCreationActionResetState").resetState())}}}f=d("PolarisReactRedux").connect(a,b)(e);g["default"]=f}),98);
__d("PolarisCreationStylePage.react",["IGRouter","PolarisCreationShell.react","PolarisCreationStyleImageUnit.react","PolarisCreationStyleVideoUnit.react","PolarisNavigationActions","PolarisPageMetadata.react","PolarisReactRedux","nullthrows","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i="CreationStylePage";e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.componentDidMount=function(){c.props.imageURL===void 0&&c.props.videoURL===void 0&&c.props.onReturnToEntrypoint()},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.render=function(){return h.jsxs(c("PolarisCreationShell.react"),{children:[h.jsx(c("PolarisPageMetadata.react"),{id:i}),this.props.imageURL!==void 0?h.jsx(c("PolarisCreationStyleImageUnit.react"),{history:this.props.history}):h.jsx(c("PolarisCreationStyleVideoUnit.react"),{history:this.props.history})]})};return b}(h.Component);function a(a){return{imageURL:c("nullthrows")(a.creation.sourceImage).dataURL,videoURL:c("nullthrows")(a.creation.sourceVideo).dataURL}}function b(a){return{onReturnToEntrypoint:function(){a(d("PolarisNavigationActions").returnToEntrypoint())}}}f=d("IGRouter").withIGRouter(d("PolarisReactRedux").connect(a,b)(e));g.Page=e;g.CreationStylePage=f}),98);
__d("PolarisCreateStyleRoot.react",["PolarisCreationStylePage.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsx("div",{children:h.jsx(d("PolarisCreationStylePage.react").CreationStylePage,{})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("ServerRedirect",["ReloadPage","URI"],(function(a,b,c,d,e,f,g){function a(a,b,d){c("URI").go(a,b,d)}function b(){d("ReloadPage").now()}g.redirectPageTo=a;g.reloadPage=b}),98);